!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).THREE={})}(this,(function(e){"use strict";void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t});function t(){}Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners[e];if(void 0!==i){var r=i.indexOf(t);-1!==r&&i.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=t.slice(0),r=0,n=i.length;r<n;r++)i[r].call(this,e)}}}});for(var i=[],r=0;r<256;r++)i[r]=(r<16?"0":"")+r.toString(16);var n=1234567,o={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(i[255&e]+i[e>>8&255]+i[e>>16&255]+i[e>>24&255]+"-"+i[255&t]+i[t>>8&255]+"-"+i[t>>16&15|64]+i[t>>24&255]+"-"+i[63&r|128]+i[r>>8&255]+"-"+i[r>>16&255]+i[r>>24&255]+i[255&n]+i[n>>8&255]+i[n>>16&255]+i[n>>24&255]).toUpperCase()},clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(n=e%2147483647),((n=16807*n%2147483647)-1)/2147483646},degToRad:function(e){return e*o.DEG2RAD},radToDeg:function(e){return e*o.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,i,r,n){var o=Math.cos,s=Math.sin,a=o(i/2),l=s(i/2),u=o((t+r)/2),c=s((t+r)/2),h=o((t-r)/2),p=s((t-r)/2),d=o((r-t)/2),f=s((r-t)/2);switch(n){case"XYX":e.set(a*c,l*h,l*p,a*u);break;case"YZY":e.set(l*p,a*c,l*h,a*u);break;case"ZXZ":e.set(l*h,l*p,a*c,a*u);break;case"XZX":e.set(a*c,l*f,l*d,a*u);break;case"YXY":e.set(l*d,a*c,l*f,a*u);break;case"ZYZ":e.set(l*f,l*d,a*c,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}},s=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),Object.defineProperty(this,"isVector2",{value:!0}),this.x=e,this.y=t},a={width:{configurable:!0},height:{configurable:!0}};a.width.get=function(){return this.x},a.width.set=function(e){this.x=e},a.height.get=function(){return this.y},a.height.set=function(e){this.y=e},s.prototype.set=function(e,t){return this.x=e,this.y=t,this},s.prototype.setScalar=function(e){return this.x=e,this.y=e,this},s.prototype.setX=function(e){return this.x=e,this},s.prototype.setY=function(e){return this.y=e,this},s.prototype.setComponent=function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},s.prototype.getComponent=function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},s.prototype.clone=function(){return new this.constructor(this.x,this.y)},s.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this},s.prototype.add=function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},s.prototype.addScalar=function(e){return this.x+=e,this.y+=e,this},s.prototype.addVectors=function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},s.prototype.addScaledVector=function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},s.prototype.sub=function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},s.prototype.subScalar=function(e){return this.x-=e,this.y-=e,this},s.prototype.subVectors=function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},s.prototype.multiply=function(e){return this.x*=e.x,this.y*=e.y,this},s.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this},s.prototype.divide=function(e){return this.x/=e.x,this.y/=e.y,this},s.prototype.divideScalar=function(e){return this.multiplyScalar(1/e)},s.prototype.applyMatrix3=function(e){var t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this},s.prototype.min=function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},s.prototype.max=function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},s.prototype.clamp=function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},s.prototype.clampScalar=function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},s.prototype.clampLength=function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},s.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},s.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},s.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},s.prototype.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},s.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},s.prototype.dot=function(e){return this.x*e.x+this.y*e.y},s.prototype.cross=function(e){return this.x*e.y-this.y*e.x},s.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},s.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},s.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)},s.prototype.normalize=function(){return this.divideScalar(this.length()||1)},s.prototype.angle=function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e},s.prototype.distanceTo=function(e){return Math.sqrt(this.distanceToSquared(e))},s.prototype.distanceToSquared=function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},s.prototype.manhattanDistanceTo=function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},s.prototype.setLength=function(e){return this.normalize().multiplyScalar(e)},s.prototype.lerp=function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},s.prototype.lerpVectors=function(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this},s.prototype.equals=function(e){return e.x===this.x&&e.y===this.y},s.prototype.fromArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},s.prototype.toArray=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},s.prototype.fromBufferAttribute=function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},s.prototype.rotateAround=function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this},s.prototype.random=function(){return this.x=Math.random(),this.y=Math.random(),this},Object.defineProperties(s.prototype,a);var l,u=function(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};u.prototype.set=function(e,t,i,r,n,o,s,a,l){var u=this.elements;return u[0]=e,u[1]=r,u[2]=s,u[3]=t,u[4]=n,u[5]=a,u[6]=i,u[7]=o,u[8]=l,this},u.prototype.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},u.prototype.clone=function(){return(new this.constructor).fromArray(this.elements)},u.prototype.copy=function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this},u.prototype.extractBasis=function(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this},u.prototype.setFromMatrix4=function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},u.prototype.multiply=function(e){return this.multiplyMatrices(this,e)},u.prototype.premultiply=function(e){return this.multiplyMatrices(e,this)},u.prototype.multiplyMatrices=function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],s=i[3],a=i[6],l=i[1],u=i[4],c=i[7],h=i[2],p=i[5],d=i[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],b=r[7],_=r[2],x=r[5],E=r[8];return n[0]=o*f+s*v+a*_,n[3]=o*m+s*y+a*x,n[6]=o*g+s*b+a*E,n[1]=l*f+u*v+c*_,n[4]=l*m+u*y+c*x,n[7]=l*g+u*b+c*E,n[2]=h*f+p*v+d*_,n[5]=h*m+p*y+d*x,n[8]=h*g+p*b+d*E,this},u.prototype.multiplyScalar=function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},u.prototype.determinant=function(){var e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],l=e[7],u=e[8];return t*o*u-t*s*l-i*n*u+i*s*a+r*n*l-r*o*a},u.prototype.getInverse=function(e,t){void 0!==t&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var i=e.elements,r=this.elements,n=i[0],o=i[1],s=i[2],a=i[3],l=i[4],u=i[5],c=i[6],h=i[7],p=i[8],d=p*l-u*h,f=u*c-p*a,m=h*a-l*c,g=n*d+o*f+s*m;if(0===g)return this.set(0,0,0,0,0,0,0,0,0);var v=1/g;return r[0]=d*v,r[1]=(s*h-p*o)*v,r[2]=(u*o-s*l)*v,r[3]=f*v,r[4]=(p*n-s*c)*v,r[5]=(s*a-u*n)*v,r[6]=m*v,r[7]=(o*c-h*n)*v,r[8]=(l*n-o*a)*v,this},u.prototype.transpose=function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},u.prototype.getNormalMatrix=function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},u.prototype.transposeIntoArray=function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},u.prototype.setUvTransform=function(e,t,i,r,n,o,s){var a=Math.cos(n),l=Math.sin(n);this.set(i*a,i*l,-i*(a*o+l*s)+o+e,-r*l,r*a,-r*(-l*o+a*s)+s+t,0,0,1)},u.prototype.scale=function(e,t){var i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this},u.prototype.rotate=function(e){var t=Math.cos(e),i=Math.sin(e),r=this.elements,n=r[0],o=r[3],s=r[6],a=r[1],l=r[4],u=r[7];return r[0]=t*n+i*a,r[3]=t*o+i*l,r[6]=t*s+i*u,r[1]=-i*n+t*a,r[4]=-i*o+t*l,r[7]=-i*s+t*u,this},u.prototype.translate=function(e,t){var i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this},u.prototype.equals=function(e){for(var t=this.elements,i=e.elements,r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0},u.prototype.fromArray=function(e,t){void 0===t&&(t=0);for(var i=0;i<9;i++)this.elements[i]=e[i+t];return this},u.prototype.toArray=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e};var c={getDataURL:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===l&&(l=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),l.width=e.width,l.height=e.height;var i=l.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=l}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},h=0;function p(e,t,i,r,n,a,l,c,d,f){Object.defineProperty(this,"id",{value:h++}),this.uuid=o.generateUUID(),this.name="",this.image=void 0!==e?e:p.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:p.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:1001,this.wrapT=void 0!==r?r:1001,this.magFilter=void 0!==n?n:1006,this.minFilter=void 0!==a?a:1008,this.anisotropy=void 0!==d?d:1,this.format=void 0!==l?l:1023,this.internalFormat=null,this.type=void 0!==c?c:1009,this.offset=new s(0,0),this.repeat=new s(1,1),this.center=new s(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new u,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==f?f:3e3,this.version=0,this.onUpdate=null}p.DEFAULT_IMAGE=void 0,p.DEFAULT_MAPPING=300,p.prototype=Object.assign(Object.create(t.prototype),{constructor:p,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=o.generateUUID()),!t&&void 0===e.images[r.uuid]){var n;if(Array.isArray(r)){n=[];for(var s=0,a=r.length;s<a;s++)n.push(c.getDataURL(r[s]))}else n=c.getDataURL(r);e.images[r.uuid]={uuid:r.uuid,url:n}}i.image=r.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(p.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});var d=function(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=1),Object.defineProperty(this,"isVector4",{value:!0}),this.x=e,this.y=t,this.z=i,this.w=r},f={width:{configurable:!0},height:{configurable:!0}};function m(e,t,i){this.width=e,this.height=t,this.scissor=new d(0,0,e,t),this.scissorTest=!1,this.viewport=new d(0,0,e,t),i=i||{},this.texture=new p(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:1006,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function g(e,t,i){m.call(this,e,t,i),this.samples=4,this.webglColorRenderbuffer=i?i.webglColorRenderbuffer:null,this.webglDepthRenderbuffer=i?i.webglDepthRenderbuffer:null}f.width.get=function(){return this.z},f.width.set=function(e){this.z=e},f.height.get=function(){return this.w},f.height.set=function(e){this.w=e},d.prototype.set=function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},d.prototype.setScalar=function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},d.prototype.setX=function(e){return this.x=e,this},d.prototype.setY=function(e){return this.y=e,this},d.prototype.setZ=function(e){return this.z=e,this},d.prototype.setW=function(e){return this.w=e,this},d.prototype.setComponent=function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},d.prototype.getComponent=function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},d.prototype.clone=function(){return new this.constructor(this.x,this.y,this.z,this.w)},d.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},d.prototype.add=function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},d.prototype.addScalar=function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},d.prototype.addVectors=function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},d.prototype.addScaledVector=function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},d.prototype.sub=function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},d.prototype.subScalar=function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},d.prototype.subVectors=function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},d.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},d.prototype.applyMatrix4=function(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*n,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*n,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*n,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*n,this},d.prototype.divideScalar=function(e){return this.multiplyScalar(1/e)},d.prototype.setAxisAngleFromQuaternion=function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},d.prototype.setAxisAngleFromRotationMatrix=function(e){var t,i,r,n,o=e.elements,s=o[0],a=o[4],l=o[8],u=o[1],c=o[5],h=o[9],p=o[2],d=o[6],f=o[10];if(Math.abs(a-u)<.01&&Math.abs(l-p)<.01&&Math.abs(h-d)<.01){if(Math.abs(a+u)<.1&&Math.abs(l+p)<.1&&Math.abs(h+d)<.1&&Math.abs(s+c+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(s+1)/2,g=(c+1)/2,v=(f+1)/2,y=(a+u)/4,b=(l+p)/4,_=(h+d)/4;return m>g&&m>v?m<.01?(i=0,r=.707106781,n=.707106781):(r=y/(i=Math.sqrt(m)),n=b/i):g>v?g<.01?(i=.707106781,r=0,n=.707106781):(i=y/(r=Math.sqrt(g)),n=_/r):v<.01?(i=.707106781,r=.707106781,n=0):(i=b/(n=Math.sqrt(v)),r=_/n),this.set(i,r,n,t),this}var x=Math.sqrt((d-h)*(d-h)+(l-p)*(l-p)+(u-a)*(u-a));return Math.abs(x)<.001&&(x=1),this.x=(d-h)/x,this.y=(l-p)/x,this.z=(u-a)/x,this.w=Math.acos((s+c+f-1)/2),this},d.prototype.min=function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},d.prototype.max=function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},d.prototype.clamp=function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},d.prototype.clampScalar=function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},d.prototype.clampLength=function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},d.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},d.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},d.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},d.prototype.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},d.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},d.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},d.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},d.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},d.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},d.prototype.normalize=function(){return this.divideScalar(this.length()||1)},d.prototype.setLength=function(e){return this.normalize().multiplyScalar(e)},d.prototype.lerp=function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},d.prototype.lerpVectors=function(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this},d.prototype.equals=function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},d.prototype.fromArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},d.prototype.toArray=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},d.prototype.fromBufferAttribute=function(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this},d.prototype.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this},Object.defineProperties(d.prototype,f),m.prototype=Object.assign(Object.create(t.prototype),{constructor:m,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),g.prototype=Object.assign(Object.create(m.prototype),{constructor:g,isWebGLMultisampleRenderTarget:!0,copy:function(e){return m.prototype.copy.call(this,e),this.samples=e.samples,this.webglColorRenderbuffer=e.webglColorRenderbuffer,this.webglDepthRenderbuffer=e.webglDepthRenderbuffer,this}});var v=function(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=1),Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=e,this._y=t,this._z=i,this._w=r},y={x:{configurable:!0},y:{configurable:!0},z:{configurable:!0},w:{configurable:!0}};v.slerp=function(e,t,i,r){return i.copy(e).slerp(t,r)},v.slerpFlat=function(e,t,i,r,n,o,s){var a=i[r+0],l=i[r+1],u=i[r+2],c=i[r+3],h=n[o+0],p=n[o+1],d=n[o+2],f=n[o+3];if(c!==f||a!==h||l!==p||u!==d){var m=1-s,g=a*h+l*p+u*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,s=Math.sin(s*_)/b}var x=s*v;if(a=a*m+h*x,l=l*m+p*x,u=u*m+d*x,c=c*m+f*x,m===1-s){var E=1/Math.sqrt(a*a+l*l+u*u+c*c);a*=E,l*=E,u*=E,c*=E}}e[t]=a,e[t+1]=l,e[t+2]=u,e[t+3]=c},v.multiplyQuaternionsFlat=function(e,t,i,r,n,o){var s=i[r],a=i[r+1],l=i[r+2],u=i[r+3],c=n[o],h=n[o+1],p=n[o+2],d=n[o+3];return e[t]=s*d+u*c+a*p-l*h,e[t+1]=a*d+u*h+l*c-s*p,e[t+2]=l*d+u*p+s*h-a*c,e[t+3]=u*d-s*c-a*h-l*p,e},y.x.get=function(){return this._x},y.x.set=function(e){this._x=e,this._onChangeCallback()},y.y.get=function(){return this._y},y.y.set=function(e){this._y=e,this._onChangeCallback()},y.z.get=function(){return this._z},y.z.set=function(e){this._z=e,this._onChangeCallback()},y.w.get=function(){return this._w},y.w.set=function(e){this._w=e,this._onChangeCallback()},v.prototype.set=function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this},v.prototype.clone=function(){return new this.constructor(this._x,this._y,this._z,this._w)},v.prototype.copy=function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},v.prototype.setFromEuler=function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,r=e._y,n=e._z,o=e._order,s=Math.cos,a=Math.sin,l=s(i/2),u=s(r/2),c=s(n/2),h=a(i/2),p=a(r/2),d=a(n/2);switch(o){case"XYZ":this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d;break;case"YXZ":this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d;break;case"ZXY":this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d;break;case"ZYX":this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d;break;case"YZX":this._x=h*u*c+l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c-h*p*d;break;case"XZY":this._x=h*u*c-l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c+h*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this},v.prototype.setFromAxisAngle=function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this},v.prototype.setFromRotationMatrix=function(e){var t=e.elements,i=t[0],r=t[4],n=t[8],o=t[1],s=t[5],a=t[9],l=t[2],u=t[6],c=t[10],h=i+s+c;if(h>0){var p=.5/Math.sqrt(h+1);this._w=.25/p,this._x=(u-a)*p,this._y=(n-l)*p,this._z=(o-r)*p}else if(i>s&&i>c){var d=2*Math.sqrt(1+i-s-c);this._w=(u-a)/d,this._x=.25*d,this._y=(r+o)/d,this._z=(n+l)/d}else if(s>c){var f=2*Math.sqrt(1+s-i-c);this._w=(n-l)/f,this._x=(r+o)/f,this._y=.25*f,this._z=(a+u)/f}else{var m=2*Math.sqrt(1+c-i-s);this._w=(o-r)/m,this._x=(n+l)/m,this._y=(a+u)/m,this._z=.25*m}return this._onChangeCallback(),this},v.prototype.setFromUnitVectors=function(e,t){var i=e.dot(t)+1;return i<1e-6?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()},v.prototype.angleTo=function(e){return 2*Math.acos(Math.abs(o.clamp(this.dot(e),-1,1)))},v.prototype.rotateTowards=function(e,t){var i=this.angleTo(e);if(0===i)return this;var r=Math.min(1,t/i);return this.slerp(e,r),this},v.prototype.identity=function(){return this.set(0,0,0,1)},v.prototype.inverse=function(){return this.conjugate()},v.prototype.conjugate=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},v.prototype.dot=function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},v.prototype.lengthSq=function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},v.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},v.prototype.normalize=function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},v.prototype.multiply=function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},v.prototype.premultiply=function(e){return this.multiplyQuaternions(e,this)},v.prototype.multiplyQuaternions=function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,s=t._x,a=t._y,l=t._z,u=t._w;return this._x=i*u+o*s+r*l-n*a,this._y=r*u+o*a+n*s-i*l,this._z=n*u+o*l+i*a-r*s,this._w=o*u-i*s-r*a-n*l,this._onChangeCallback(),this},v.prototype.slerp=function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,s=o*e._w+i*e._x+r*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var a=1-s*s;if(a<=Number.EPSILON){var l=1-t;return this._w=l*o+t*this._w,this._x=l*i+t*this._x,this._y=l*r+t*this._y,this._z=l*n+t*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(a),c=Math.atan2(u,s),h=Math.sin((1-t)*c)/u,p=Math.sin(t*c)/u;return this._w=o*h+this._w*p,this._x=i*h+this._x*p,this._y=r*h+this._y*p,this._z=n*h+this._z*p,this._onChangeCallback(),this},v.prototype.equals=function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},v.prototype.fromArray=function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},v.prototype.toArray=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},v.prototype.fromBufferAttribute=function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this},v.prototype._onChange=function(e){return this._onChangeCallback=e,this},v.prototype._onChangeCallback=function(){},Object.defineProperties(v.prototype,y);var b=function(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),Object.defineProperty(this,"isVector3",{value:!0}),this.x=e,this.y=t,this.z=i};b.prototype.set=function(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this},b.prototype.setScalar=function(e){return this.x=e,this.y=e,this.z=e,this},b.prototype.setX=function(e){return this.x=e,this},b.prototype.setY=function(e){return this.y=e,this},b.prototype.setZ=function(e){return this.z=e,this},b.prototype.setComponent=function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},b.prototype.getComponent=function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},b.prototype.clone=function(){return new this.constructor(this.x,this.y,this.z)},b.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},b.prototype.add=function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},b.prototype.addScalar=function(e){return this.x+=e,this.y+=e,this.z+=e,this},b.prototype.addVectors=function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},b.prototype.addScaledVector=function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},b.prototype.sub=function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},b.prototype.subScalar=function(e){return this.x-=e,this.y-=e,this.z-=e,this},b.prototype.subVectors=function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},b.prototype.multiply=function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},b.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},b.prototype.multiplyVectors=function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},b.prototype.applyEuler=function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(x.setFromEuler(e))},b.prototype.applyAxisAngle=function(e,t){return this.applyQuaternion(x.setFromAxisAngle(e,t))},b.prototype.applyMatrix3=function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this},b.prototype.applyNormalMatrix=function(e){return this.applyMatrix3(e).normalize()},b.prototype.applyMatrix4=function(e){var t=this.x,i=this.y,r=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*o,this},b.prototype.applyQuaternion=function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*i,u=a*i+s*t-n*r,c=a*r+n*i-o*t,h=-n*t-o*i-s*r;return this.x=l*a+h*-n+u*-s-c*-o,this.y=u*a+h*-o+c*-n-l*-s,this.z=c*a+h*-s+l*-o-u*-n,this},b.prototype.project=function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},b.prototype.unproject=function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},b.prototype.transformDirection=function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()},b.prototype.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},b.prototype.divideScalar=function(e){return this.multiplyScalar(1/e)},b.prototype.min=function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},b.prototype.max=function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},b.prototype.clamp=function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},b.prototype.clampScalar=function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},b.prototype.clampLength=function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},b.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},b.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},b.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},b.prototype.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},b.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},b.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},b.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},b.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},b.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},b.prototype.normalize=function(){return this.divideScalar(this.length()||1)},b.prototype.setLength=function(e){return this.normalize().multiplyScalar(e)},b.prototype.lerp=function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},b.prototype.lerpVectors=function(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this},b.prototype.cross=function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},b.prototype.crossVectors=function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this},b.prototype.projectOnVector=function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)},b.prototype.projectOnPlane=function(e){return _.copy(this).projectOnVector(e),this.sub(_)},b.prototype.reflect=function(e){return this.sub(_.copy(e).multiplyScalar(2*this.dot(e)))},b.prototype.angleTo=function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var i=this.dot(e)/t;return Math.acos(o.clamp(i,-1,1))},b.prototype.distanceTo=function(e){return Math.sqrt(this.distanceToSquared(e))},b.prototype.distanceToSquared=function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},b.prototype.manhattanDistanceTo=function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},b.prototype.setFromSpherical=function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},b.prototype.setFromSphericalCoords=function(e,t,i){var r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this},b.prototype.setFromCylindrical=function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},b.prototype.setFromCylindricalCoords=function(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this},b.prototype.setFromMatrixPosition=function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},b.prototype.setFromMatrixScale=function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this},b.prototype.setFromMatrixColumn=function(e,t){return this.fromArray(e.elements,4*t)},b.prototype.setFromMatrix3Column=function(e,t){return this.fromArray(e.elements,3*t)},b.prototype.equals=function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},b.prototype.fromArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},b.prototype.toArray=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},b.prototype.fromBufferAttribute=function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this},b.prototype.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this};var _=new b,x=new v,E=function(e,t){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==e?e:new b(1/0,1/0,1/0),this.max=void 0!==t?t:new b(-1/0,-1/0,-1/0)};function w(e,t,i,r,n){for(var o=0,s=e.length-3;o<=s;o+=3){F.fromArray(e,o);var a=n.x*Math.abs(F.x)+n.y*Math.abs(F.y)+n.z*Math.abs(F.z),l=t.dot(F),u=i.dot(F),c=r.dot(F);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>a)return!1}return!0}E.prototype.set=function(e,t){return this.min.copy(e),this.max.copy(t),this},E.prototype.setFromArray=function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,l=e.length;a<l;a+=3){var u=e[a],c=e[a+1],h=e[a+2];u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,i,r),this.max.set(n,o,s),this},E.prototype.setFromBufferAttribute=function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,l=e.count;a<l;a++){var u=e.getX(a),c=e.getY(a),h=e.getZ(a);u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,i,r),this.max.set(n,o,s),this},E.prototype.setFromPoints=function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},E.prototype.setFromCenterAndSize=function(e,t){var i=M.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this},E.prototype.setFromObject=function(e){return this.makeEmpty(),this.expandByObject(e)},E.prototype.clone=function(){return(new this.constructor).copy(this)},E.prototype.copy=function(e){return this.min.copy(e.min),this.max.copy(e.max),this},E.prototype.makeEmpty=function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},E.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},E.prototype.getCenter=function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new b),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},E.prototype.getSize=function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new b),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},E.prototype.expandByPoint=function(e){return this.min.min(e),this.max.max(e),this},E.prototype.expandByVector=function(e){return this.min.sub(e),this.max.add(e),this},E.prototype.expandByScalar=function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},E.prototype.expandByObject=function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),C.copy(t.boundingBox),C.applyMatrix4(e.matrixWorld),this.union(C));for(var i=e.children,r=0,n=i.length;r<n;r++)this.expandByObject(i[r]);return this},E.prototype.containsPoint=function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},E.prototype.containsBox=function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},E.prototype.getParameter=function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new b),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},E.prototype.intersectsBox=function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},E.prototype.intersectsSphere=function(e){return this.clampPoint(e.center,M),M.distanceToSquared(e.center)<=e.radius*e.radius},E.prototype.intersectsPlane=function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant},E.prototype.intersectsTriangle=function(e){if(this.isEmpty())return!1;this.getCenter(k),O.subVectors(this.max,k),S.subVectors(e.a,k),j.subVectors(e.b,k),P.subVectors(e.c,k),R.subVectors(j,S),D.subVectors(P,j),A.subVectors(S,P);var t=[0,-R.z,R.y,0,-D.z,D.y,0,-A.z,A.y,R.z,0,-R.x,D.z,0,-D.x,A.z,0,-A.x,-R.y,R.x,0,-D.y,D.x,0,-A.y,A.x,0];return!!w(t,S,j,P,O)&&(!!w(t=[1,0,0,0,1,0,0,0,1],S,j,P,O)&&(B.crossVectors(R,D),w(t=[B.x,B.y,B.z],S,j,P,O)))},E.prototype.clampPoint=function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new b),t.copy(e).clamp(this.min,this.max)},E.prototype.distanceToPoint=function(e){return M.copy(e).clamp(this.min,this.max).sub(e).length()},E.prototype.getBoundingSphere=function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(M).length(),e},E.prototype.intersect=function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},E.prototype.union=function(e){return this.min.min(e.min),this.max.max(e.max),this},E.prototype.applyMatrix4=function(e){return this.isEmpty()||(T[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),T[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),T[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),T[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),T[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),T[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),T[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),T[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(T)),this},E.prototype.translate=function(e){return this.min.add(e),this.max.add(e),this},E.prototype.equals=function(e){return e.min.equals(this.min)&&e.max.equals(this.max)};var T=[new b,new b,new b,new b,new b,new b,new b,new b],M=new b,C=new E,S=new b,j=new b,P=new b,R=new b,D=new b,A=new b,k=new b,O=new b,B=new b,F=new b,L=new E,I=function(e,t){this.center=void 0!==e?e:new b,this.radius=void 0!==t?t:-1};I.prototype.set=function(e,t){return this.center.copy(e),this.radius=t,this},I.prototype.setFromPoints=function(e,t){var i=this.center;void 0!==t?i.copy(t):L.setFromPoints(e).getCenter(i);for(var r=0,n=0,o=e.length;n<o;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this},I.prototype.clone=function(){return(new this.constructor).copy(this)},I.prototype.copy=function(e){return this.center.copy(e.center),this.radius=e.radius,this},I.prototype.isEmpty=function(){return this.radius<0},I.prototype.makeEmpty=function(){return this.center.set(0,0,0),this.radius=-1,this},I.prototype.containsPoint=function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},I.prototype.distanceToPoint=function(e){return e.distanceTo(this.center)-this.radius},I.prototype.intersectsSphere=function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},I.prototype.intersectsBox=function(e){return e.intersectsSphere(this)},I.prototype.intersectsPlane=function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},I.prototype.clampPoint=function(e,t){var i=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new b),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},I.prototype.getBoundingBox=function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new E),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)},I.prototype.applyMatrix4=function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},I.prototype.translate=function(e){return this.center.add(e),this},I.prototype.equals=function(e){return e.center.equals(this.center)&&e.radius===this.radius};var N=new b,U=new b,z=new b,H=new b,V=new b,W=new b,G=new b,q=function(e,t){this.origin=void 0!==e?e:new b,this.direction=void 0!==t?t:new b(0,0,-1)};q.prototype.set=function(e,t){return this.origin.copy(e),this.direction.copy(t),this},q.prototype.clone=function(){return(new this.constructor).copy(this)},q.prototype.copy=function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},q.prototype.at=function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new b),t.copy(this.direction).multiplyScalar(e).add(this.origin)},q.prototype.lookAt=function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},q.prototype.recast=function(e){return this.origin.copy(this.at(e,N)),this},q.prototype.closestPointToPoint=function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new b),t.subVectors(e,this.origin);var i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)},q.prototype.distanceToPoint=function(e){return Math.sqrt(this.distanceSqToPoint(e))},q.prototype.distanceSqToPoint=function(e){var t=N.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(N.copy(this.direction).multiplyScalar(t).add(this.origin),N.distanceToSquared(e))},q.prototype.distanceSqToSegment=function(e,t,i,r){U.copy(e).add(t).multiplyScalar(.5),z.copy(t).sub(e).normalize(),H.copy(this.origin).sub(U);var n,o,s,a,l=.5*e.distanceTo(t),u=-this.direction.dot(z),c=H.dot(this.direction),h=-H.dot(z),p=H.lengthSq(),d=Math.abs(1-u*u);if(d>0)if(o=u*c-h,a=l*d,(n=u*h-c)>=0)if(o>=-a)if(o<=a){var f=1/d;s=(n*=f)*(n+u*(o*=f)+2*c)+o*(u*n+o+2*h)+p}else o=l,s=-(n=Math.max(0,-(u*o+c)))*n+o*(o+2*h)+p;else o=-l,s=-(n=Math.max(0,-(u*o+c)))*n+o*(o+2*h)+p;else o<=-a?s=-(n=Math.max(0,-(-u*l+c)))*n+(o=n>0?-l:Math.min(Math.max(-l,-h),l))*(o+2*h)+p:o<=a?(n=0,s=(o=Math.min(Math.max(-l,-h),l))*(o+2*h)+p):s=-(n=Math.max(0,-(u*l+c)))*n+(o=n>0?l:Math.min(Math.max(-l,-h),l))*(o+2*h)+p;else o=u>0?-l:l,s=-(n=Math.max(0,-(u*o+c)))*n+o*(o+2*h)+p;return i&&i.copy(this.direction).multiplyScalar(n).add(this.origin),r&&r.copy(z).multiplyScalar(o).add(U),s},q.prototype.intersectSphere=function(e,t){N.subVectors(e.center,this.origin);var i=N.dot(this.direction),r=N.dot(N)-i*i,n=e.radius*e.radius;if(r>n)return null;var o=Math.sqrt(n-r),s=i-o,a=i+o;return s<0&&a<0?null:s<0?this.at(a,t):this.at(s,t)},q.prototype.intersectsSphere=function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},q.prototype.distanceToPlane=function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},q.prototype.intersectPlane=function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},q.prototype.intersectsPlane=function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},q.prototype.intersectBox=function(e,t){var i,r,n,o,s,a,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),u>=0?(n=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(n=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),i>o||n>r?null:((n>i||i!=i)&&(i=n),(o<r||r!=r)&&(r=o),c>=0?(s=(e.min.z-h.z)*c,a=(e.max.z-h.z)*c):(s=(e.max.z-h.z)*c,a=(e.min.z-h.z)*c),i>a||s>r?null:((s>i||i!=i)&&(i=s),(a<r||r!=r)&&(r=a),r<0?null:this.at(i>=0?i:r,t)))},q.prototype.intersectsBox=function(e){return null!==this.intersectBox(e,N)},q.prototype.intersectTriangle=function(e,t,i,r,n){V.subVectors(t,e),W.subVectors(i,e),G.crossVectors(V,W);var o,s=this.direction.dot(G);if(s>0){if(r)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}H.subVectors(this.origin,e);var a=o*this.direction.dot(W.crossVectors(H,W));if(a<0)return null;var l=o*this.direction.dot(V.cross(H));if(l<0)return null;if(a+l>s)return null;var u=-o*H.dot(G);return u<0?null:this.at(u/s,n)},q.prototype.applyMatrix4=function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},q.prototype.equals=function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)};var X=function(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};X.prototype.set=function(e,t,i,r,n,o,s,a,l,u,c,h,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},X.prototype.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},X.prototype.clone=function(){return(new X).fromArray(this.elements)},X.prototype.copy=function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},X.prototype.copyPosition=function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},X.prototype.extractBasis=function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},X.prototype.makeBasis=function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},X.prototype.extractRotation=function(e){var t=this.elements,i=e.elements,r=1/J.setFromMatrixColumn(e,0).length(),n=1/J.setFromMatrixColumn(e,1).length(),o=1/J.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},X.prototype.makeRotationFromEuler=function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,o=Math.cos(i),s=Math.sin(i),a=Math.cos(r),l=Math.sin(r),u=Math.cos(n),c=Math.sin(n);if("XYZ"===e.order){var h=o*u,p=o*c,d=s*u,f=s*c;t[0]=a*u,t[4]=-a*c,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-s*a,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*a}else if("YXZ"===e.order){var m=a*u,g=a*c,v=l*u,y=l*c;t[0]=m+y*s,t[4]=v*s-g,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-s,t[2]=g*s-v,t[6]=y+m*s,t[10]=o*a}else if("ZXY"===e.order){var b=a*u,_=a*c,x=l*u,E=l*c;t[0]=b-E*s,t[4]=-o*c,t[8]=x+_*s,t[1]=_+x*s,t[5]=o*u,t[9]=E-b*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){var w=o*u,T=o*c,M=s*u,C=s*c;t[0]=a*u,t[4]=M*l-T,t[8]=w*l+C,t[1]=a*c,t[5]=C*l+w,t[9]=T*l-M,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){var S=o*a,j=o*l,P=s*a,R=s*l;t[0]=a*u,t[4]=R-S*c,t[8]=P*c+j,t[1]=c,t[5]=o*u,t[9]=-s*u,t[2]=-l*u,t[6]=j*c+P,t[10]=S-R*c}else if("XZY"===e.order){var D=o*a,A=o*l,k=s*a,O=s*l;t[0]=a*u,t[4]=-c,t[8]=l*u,t[1]=D*c+O,t[5]=o*u,t[9]=A*c-k,t[2]=k*c-A,t[6]=s*u,t[10]=O*c+D}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},X.prototype.makeRotationFromQuaternion=function(e){return this.compose(Z,e,Q)},X.prototype.lookAt=function(e,t,i){var r=this.elements;return ee.subVectors(e,t),0===ee.lengthSq()&&(ee.z=1),ee.normalize(),K.crossVectors(i,ee),0===K.lengthSq()&&(1===Math.abs(i.z)?ee.x+=1e-4:ee.z+=1e-4,ee.normalize(),K.crossVectors(i,ee)),K.normalize(),$.crossVectors(ee,K),r[0]=K.x,r[4]=$.x,r[8]=ee.x,r[1]=K.y,r[5]=$.y,r[9]=ee.y,r[2]=K.z,r[6]=$.z,r[10]=ee.z,this},X.prototype.multiply=function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},X.prototype.premultiply=function(e){return this.multiplyMatrices(e,this)},X.prototype.multiplyMatrices=function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],u=i[1],c=i[5],h=i[9],p=i[13],d=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],_=i[15],x=r[0],E=r[4],w=r[8],T=r[12],M=r[1],C=r[5],S=r[9],j=r[13],P=r[2],R=r[6],D=r[10],A=r[14],k=r[3],O=r[7],B=r[11],F=r[15];return n[0]=o*x+s*M+a*P+l*k,n[4]=o*E+s*C+a*R+l*O,n[8]=o*w+s*S+a*D+l*B,n[12]=o*T+s*j+a*A+l*F,n[1]=u*x+c*M+h*P+p*k,n[5]=u*E+c*C+h*R+p*O,n[9]=u*w+c*S+h*D+p*B,n[13]=u*T+c*j+h*A+p*F,n[2]=d*x+f*M+m*P+g*k,n[6]=d*E+f*C+m*R+g*O,n[10]=d*w+f*S+m*D+g*B,n[14]=d*T+f*j+m*A+g*F,n[3]=v*x+y*M+b*P+_*k,n[7]=v*E+y*C+b*R+_*O,n[11]=v*w+y*S+b*D+_*B,n[15]=v*T+y*j+b*A+_*F,this},X.prototype.multiplyScalar=function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},X.prototype.determinant=function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],s=e[5],a=e[9],l=e[13],u=e[2],c=e[6],h=e[10],p=e[14];return e[3]*(+n*a*c-r*l*c-n*s*h+i*l*h+r*s*p-i*a*p)+e[7]*(+t*a*p-t*l*h+n*o*h-r*o*p+r*l*u-n*a*u)+e[11]*(+t*l*c-t*s*p-n*o*c+i*o*p+n*s*u-i*l*u)+e[15]*(-r*s*u-t*a*c+t*s*h+r*o*c-i*o*h+i*a*u)},X.prototype.transpose=function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},X.prototype.setPosition=function(e,t,i){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this},X.prototype.getInverse=function(e,t){void 0!==t&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var i=this.elements,r=e.elements,n=r[0],o=r[1],s=r[2],a=r[3],l=r[4],u=r[5],c=r[6],h=r[7],p=r[8],d=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],b=r[15],_=d*y*h-v*f*h+v*c*m-u*y*m-d*c*b+u*f*b,x=g*f*h-p*y*h-g*c*m+l*y*m+p*c*b-l*f*b,E=p*v*h-g*d*h+g*u*m-l*v*m-p*u*b+l*d*b,w=g*d*c-p*v*c-g*u*f+l*v*f+p*u*y-l*d*y,T=n*_+o*x+s*E+a*w;if(0===T)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var M=1/T;return i[0]=_*M,i[1]=(v*f*a-d*y*a-v*s*m+o*y*m+d*s*b-o*f*b)*M,i[2]=(u*y*a-v*c*a+v*s*h-o*y*h-u*s*b+o*c*b)*M,i[3]=(d*c*a-u*f*a-d*s*h+o*f*h+u*s*m-o*c*m)*M,i[4]=x*M,i[5]=(p*y*a-g*f*a+g*s*m-n*y*m-p*s*b+n*f*b)*M,i[6]=(g*c*a-l*y*a-g*s*h+n*y*h+l*s*b-n*c*b)*M,i[7]=(l*f*a-p*c*a+p*s*h-n*f*h-l*s*m+n*c*m)*M,i[8]=E*M,i[9]=(g*d*a-p*v*a-g*o*m+n*v*m+p*o*b-n*d*b)*M,i[10]=(l*v*a-g*u*a+g*o*h-n*v*h-l*o*b+n*u*b)*M,i[11]=(p*u*a-l*d*a-p*o*h+n*d*h+l*o*m-n*u*m)*M,i[12]=w*M,i[13]=(p*v*s-g*d*s+g*o*f-n*v*f-p*o*y+n*d*y)*M,i[14]=(g*u*s-l*v*s-g*o*c+n*v*c+l*o*y-n*u*y)*M,i[15]=(l*d*s-p*u*s+p*o*c-n*d*c-l*o*f+n*u*f)*M,this},X.prototype.scale=function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},X.prototype.getMaxScaleOnAxis=function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))},X.prototype.makeTranslation=function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},X.prototype.makeRotationX=function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},X.prototype.makeRotationY=function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},X.prototype.makeRotationZ=function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},X.prototype.makeRotationAxis=function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,s=e.y,a=e.z,l=n*o,u=n*s;return this.set(l*o+i,l*s-r*a,l*a+r*s,0,l*s+r*a,u*s+i,u*a-r*o,0,l*a-r*s,u*a+r*o,n*a*a+i,0,0,0,0,1),this},X.prototype.makeScale=function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},X.prototype.makeShear=function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},X.prototype.compose=function(e,t,i){var r=this.elements,n=t._x,o=t._y,s=t._z,a=t._w,l=n+n,u=o+o,c=s+s,h=n*l,p=n*u,d=n*c,f=o*u,m=o*c,g=s*c,v=a*l,y=a*u,b=a*c,_=i.x,x=i.y,E=i.z;return r[0]=(1-(f+g))*_,r[1]=(p+b)*_,r[2]=(d-y)*_,r[3]=0,r[4]=(p-b)*x,r[5]=(1-(h+g))*x,r[6]=(m+v)*x,r[7]=0,r[8]=(d+y)*E,r[9]=(m-v)*E,r[10]=(1-(h+f))*E,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this},X.prototype.decompose=function(e,t,i){var r=this.elements,n=J.set(r[0],r[1],r[2]).length(),o=J.set(r[4],r[5],r[6]).length(),s=J.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],Y.copy(this);var a=1/n,l=1/o,u=1/s;return Y.elements[0]*=a,Y.elements[1]*=a,Y.elements[2]*=a,Y.elements[4]*=l,Y.elements[5]*=l,Y.elements[6]*=l,Y.elements[8]*=u,Y.elements[9]*=u,Y.elements[10]*=u,t.setFromRotationMatrix(Y),i.x=n,i.y=o,i.z=s,this},X.prototype.makePerspective=function(e,t,i,r,n,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,a=2*n/(t-e),l=2*n/(i-r),u=(t+e)/(t-e),c=(i+r)/(i-r),h=-(o+n)/(o-n),p=-2*o*n/(o-n);return s[0]=a,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},X.prototype.makeOrthographic=function(e,t,i,r,n,o){var s=this.elements,a=1/(t-e),l=1/(i-r),u=1/(o-n),c=(t+e)*a,h=(i+r)*l,p=(o+n)*u;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},X.prototype.equals=function(e){for(var t=this.elements,i=e.elements,r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},X.prototype.fromArray=function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},X.prototype.toArray=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e};var J=new b,Y=new X,Z=new b(0,0,0),Q=new b(1,1,1),K=new b,$=new b,ee=new b,te=function e(t,i,r,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=e.DefaultOrder),Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=i,this._z=r,this._order=n},ie={x:{configurable:!0},y:{configurable:!0},z:{configurable:!0},order:{configurable:!0}};ie.x.get=function(){return this._x},ie.x.set=function(e){this._x=e,this._onChangeCallback()},ie.y.get=function(){return this._y},ie.y.set=function(e){this._y=e,this._onChangeCallback()},ie.z.get=function(){return this._z},ie.z.set=function(e){this._z=e,this._onChangeCallback()},ie.order.get=function(){return this._order},ie.order.set=function(e){this._order=e,this._onChangeCallback()},te.prototype.set=function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._order=r||this._order,this._onChangeCallback(),this},te.prototype.clone=function(){return new this.constructor(this._x,this._y,this._z,this._order)},te.prototype.copy=function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},te.prototype.setFromRotationMatrix=function(e,t,i){var r=o.clamp,n=e.elements,s=n[0],a=n[4],l=n[8],u=n[1],c=n[5],h=n[9],p=n[2],d=n[6],f=n[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(l,f),this._z=Math.atan2(u,c)):(this._y=Math.atan2(-p,s),this._z=0);break;case"ZXY":this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-p,f),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(u,s));break;case"ZYX":this._y=Math.asin(-r(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(u,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(r(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-p,s)):(this._x=0,this._y=Math.atan2(l,f));break;case"XZY":this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(l,s)):(this._x=Math.atan2(-h,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==i&&this._onChangeCallback(),this},te.prototype.setFromQuaternion=function(e,t,i){return re.makeRotationFromQuaternion(e),this.setFromRotationMatrix(re,t,i)},te.prototype.setFromVector3=function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},te.prototype.reorder=function(e){return ne.setFromEuler(this),this.setFromQuaternion(ne,e)},te.prototype.equals=function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},te.prototype.fromArray=function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},te.prototype.toArray=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},te.prototype.toVector3=function(e){return e?e.set(this._x,this._y,this._z):new b(this._x,this._y,this._z)},te.prototype._onChange=function(e){return this._onChangeCallback=e,this},te.prototype._onChangeCallback=function(){},Object.defineProperties(te.prototype,ie),te.DefaultOrder="XYZ",te.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var re=new X,ne=new v,oe=function(){this.mask=1};oe.prototype.set=function(e){this.mask=1<<e|0},oe.prototype.enable=function(e){this.mask|=1<<e|0},oe.prototype.enableAll=function(){this.mask=-1},oe.prototype.toggle=function(e){this.mask^=1<<e|0},oe.prototype.disable=function(e){this.mask&=~(1<<e|0)},oe.prototype.disableAll=function(){this.mask=0},oe.prototype.test=function(e){return 0!=(this.mask&e.mask)};var se=0,ae=new b,le=new v,ue=new X,ce=new b,he=new b,pe=new b,de=new v,fe=new b(1,0,0),me=new b(0,1,0),ge=new b(0,0,1),ve={type:"added"},ye={type:"removed"};function be(){Object.defineProperty(this,"id",{value:se++}),this.uuid=o.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=be.DefaultUp.clone();var e=new b,t=new te,i=new v,r=new b(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new X},normalMatrix:{value:new u}}),this.matrix=new X,this.matrixWorld=new X,this.matrixAutoUpdate=be.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixNeedsUpdate=!0,this.layers=new oe,this.visible=!0,this.renderLayer=null,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}be.DefaultUp=new b(0,1,0),be.DefaultMatrixAutoUpdate=!0,be.prototype=Object.assign(Object.create(t.prototype),{constructor:be,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){(this.matrixAutoUpdate||this.matrixNeedsUpdate)&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return le.setFromAxisAngle(e,t),this.quaternion.multiply(le),this},rotateOnWorldAxis:function(e,t){return le.setFromAxisAngle(e,t),this.quaternion.premultiply(le),this},rotateX:function(e){return this.rotateOnAxis(fe,e)},rotateY:function(e){return this.rotateOnAxis(me,e)},rotateZ:function(e){return this.rotateOnAxis(ge,e)},translateOnAxis:function(e,t){return ae.copy(e).applyQuaternion(this.quaternion),this.position.add(ae.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(fe,e)},translateY:function(e){return this.translateOnAxis(me,e)},translateZ:function(e){return this.translateOnAxis(ge,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(ue.getInverse(this.matrixWorld))},lookAt:function(e,t,i){e.isVector3?ce.copy(e):ce.set(e,t,i);var r=this.parent;this.updateWorldMatrix(!0,!1),he.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ue.lookAt(he,ce,this.up):ue.lookAt(ce,he,this.up),this.quaternion.setFromRotationMatrix(ue),r&&(ue.extractRotation(r.matrixWorld),le.setFromRotationMatrix(ue),this.quaternion.premultiply(le.inverse()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ve),this.dispatchEvent({type:"addedChild",object:e})):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var i=this.children.indexOf(e);return-1!==i&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(ye)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),ue.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ue.multiply(e.parent.matrixWorld)),e.applyMatrix4(ue),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new b),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new v),this.updateMatrixWorld(!0),this.matrixWorld.decompose(he,e,pe),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new b),this.updateMatrixWorld(!0),this.matrixWorld.decompose(he,de,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new b),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0,this.matrixNeedsUpdate=!1},updateMatrixWorld:function(e){(this.matrixAutoUpdate||this.matrixNeedsUpdate)&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),(this.matrixAutoUpdate||this.matrixNeedsUpdate)&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,n=0,o=r.length;n<o;n++)r[n].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function n(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var s=o.shapes;if(Array.isArray(s))for(var a=0,l=s.length;a<l;a++){var u=s[a];n(e.shapes,u)}else n(e.shapes,s)}}if(void 0!==this.material)if(Array.isArray(this.material)){for(var c=[],h=0,p=this.material.length;h<p;h++)c.push(n(e.materials,this.material[h]));r.material=c}else r.material=n(e.materials,this.material);if(this.children.length>0){r.children=[];for(var d=0;d<this.children.length;d++)r.children.push(this.children[d].toJSON(e).object)}if(t){var f=b(e.geometries),m=b(e.materials),g=b(e.textures),v=b(e.images),y=b(e.shapes);f.length>0&&(i.geometries=f),m.length>0&&(i.materials=m),g.length>0&&(i.textures=g),v.length>0&&(i.images=v),y.length>0&&(i.shapes=y)}return i.object=r,i;function b(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var i=0;i<e.children.length;i++){var r=e.children[i];this.add(r.clone())}return this}});var _e=new b,xe=new b,Ee=new u,we=function(e,t){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==e?e:new b(1,0,0),this.constant=void 0!==t?t:0};we.prototype.set=function(e,t){return this.normal.copy(e),this.constant=t,this},we.prototype.setComponents=function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},we.prototype.setFromNormalAndCoplanarPoint=function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},we.prototype.setFromCoplanarPoints=function(e,t,i){var r=_e.subVectors(i,t).cross(xe.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this},we.prototype.clone=function(){return(new this.constructor).copy(this)},we.prototype.copy=function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},we.prototype.normalize=function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},we.prototype.negate=function(){return this.constant*=-1,this.normal.negate(),this},we.prototype.distanceToPoint=function(e){return this.normal.dot(e)+this.constant},we.prototype.distanceToSphere=function(e){return this.distanceToPoint(e.center)-e.radius},we.prototype.projectPoint=function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new b),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},we.prototype.intersectLine=function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new b);var i=e.delta(_e),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var n=-(e.start.dot(this.normal)+this.constant)/r;return n<0||n>1?void 0:t.copy(i).multiplyScalar(n).add(e.start)},we.prototype.intersectsLine=function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},we.prototype.intersectsBox=function(e){return e.intersectsPlane(this)},we.prototype.intersectsSphere=function(e){return e.intersectsPlane(this)},we.prototype.coplanarPoint=function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new b),e.copy(this.normal).multiplyScalar(-this.constant)},we.prototype.applyMatrix4=function(e,t){var i=t||Ee.getNormalMatrix(e),r=this.coplanarPoint(_e).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this},we.prototype.translate=function(e){return this.constant-=e.dot(this.normal),this},we.prototype.equals=function(e){return e.normal.equals(this.normal)&&e.constant===this.constant};var Te=new b,Me=new b,Ce=new b,Se=new b,je=new b,Pe=new b,Re=new b,De=new b,Ae=new b,ke=new b,Oe=function(e,t,i){this.a=void 0!==e?e:new b,this.b=void 0!==t?t:new b,this.c=void 0!==i?i:new b};Oe.getNormal=function(e,t,i,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new b),r.subVectors(i,t),Te.subVectors(e,t),r.cross(Te);var n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)},Oe.getBarycoord=function(e,t,i,r,n){Te.subVectors(r,t),Me.subVectors(i,t),Ce.subVectors(e,t);var o=Te.dot(Te),s=Te.dot(Me),a=Te.dot(Ce),l=Me.dot(Me),u=Me.dot(Ce),c=o*l-s*s;if(void 0===n&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),n=new b),0===c)return n.set(-2,-1,-1);var h=1/c,p=(l*a-s*u)*h,d=(o*u-s*a)*h;return n.set(1-p-d,d,p)},Oe.containsPoint=function(e,t,i,r){return this.getBarycoord(e,t,i,r,Se),Se.x>=0&&Se.y>=0&&Se.x+Se.y<=1},Oe.getUV=function(e,t,i,r,n,o,s,a){return this.getBarycoord(e,t,i,r,Se),a.set(0,0),a.addScaledVector(n,Se.x),a.addScaledVector(o,Se.y),a.addScaledVector(s,Se.z),a},Oe.isFrontFacing=function(e,t,i,r){return Te.subVectors(i,t),Me.subVectors(e,t),Te.cross(Me).dot(r)<0},Oe.prototype.set=function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},Oe.prototype.setFromPointsAndIndices=function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},Oe.prototype.clone=function(){return(new this.constructor).copy(this)},Oe.prototype.copy=function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},Oe.prototype.getArea=function(){return Te.subVectors(this.c,this.b),Me.subVectors(this.a,this.b),.5*Te.cross(Me).length()},Oe.prototype.getMidpoint=function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new b),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},Oe.prototype.getNormal=function(e){return Oe.getNormal(this.a,this.b,this.c,e)},Oe.prototype.getPlane=function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new we),e.setFromCoplanarPoints(this.a,this.b,this.c)},Oe.prototype.getBarycoord=function(e,t){return Oe.getBarycoord(e,this.a,this.b,this.c,t)},Oe.prototype.getUV=function(e,t,i,r,n){return Oe.getUV(e,this.a,this.b,this.c,t,i,r,n)},Oe.prototype.containsPoint=function(e){return Oe.containsPoint(e,this.a,this.b,this.c)},Oe.prototype.isFrontFacing=function(e){return Oe.isFrontFacing(this.a,this.b,this.c,e)},Oe.prototype.intersectsBox=function(e){return e.intersectsTriangle(this)},Oe.prototype.closestPointToPoint=function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new b);var i,r,n=this.a,o=this.b,s=this.c;je.subVectors(o,n),Pe.subVectors(s,n),De.subVectors(e,n);var a=je.dot(De),l=Pe.dot(De);if(a<=0&&l<=0)return t.copy(n);Ae.subVectors(e,o);var u=je.dot(Ae),c=Pe.dot(Ae);if(u>=0&&c<=u)return t.copy(o);var h=a*c-u*l;if(h<=0&&a>=0&&u<=0)return i=a/(a-u),t.copy(n).addScaledVector(je,i);ke.subVectors(e,s);var p=je.dot(ke),d=Pe.dot(ke);if(d>=0&&p<=d)return t.copy(s);var f=p*l-a*d;if(f<=0&&l>=0&&d<=0)return r=l/(l-d),t.copy(n).addScaledVector(Pe,r);var m=u*d-p*c;if(m<=0&&c-u>=0&&p-d>=0)return Re.subVectors(s,o),r=(c-u)/(c-u+(p-d)),t.copy(o).addScaledVector(Re,r);var g=1/(m+f+h);return i=f*g,r=h*g,t.copy(n).addScaledVector(je,i).addScaledVector(Pe,r)},Oe.prototype.equals=function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)};var Be={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Fe={h:0,s:0,l:0},Le={h:0,s:0,l:0};function Ie(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function Ne(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Ue(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var ze=function(e,t,i){return Object.defineProperty(this,"isColor",{value:!0}),void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)};ze.prototype.set=function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},ze.prototype.setScalar=function(e){return this.r=e,this.g=e,this.b=e,this},ze.prototype.setHex=function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},ze.prototype.setRGB=function(e,t,i){return this.r=e,this.g=t,this.b=i,this},ze.prototype.setHSL=function(e,t,i){if(e=o.euclideanModulo(e,1),t=o.clamp(t,0,1),i=o.clamp(i,0,1),0===t)this.r=this.g=this.b=i;else{var r=i<=.5?i*(1+t):i+t-i*t,n=2*i-r;this.r=Ie(n,r,e+1/3),this.g=Ie(n,r,e),this.b=Ie(n,r,e-1/3)}return this},ze.prototype.setStyle=function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r,n=i[1],o=i[2];switch(n){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var s=parseFloat(r[1])/360,a=parseInt(r[2],10)/100,l=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(s,a,l)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(e)){var u=i[1],c=u.length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},ze.prototype.setColorName=function(e){var t=Be[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},ze.prototype.clone=function(){return new this.constructor(this.r,this.g,this.b)},ze.prototype.copy=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},ze.prototype.copyGammaToLinear=function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},ze.prototype.copyLinearToGamma=function(e,t){void 0===t&&(t=2);var i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this},ze.prototype.convertGammaToLinear=function(e){return this.copyGammaToLinear(this,e),this},ze.prototype.convertLinearToGamma=function(e){return this.copyLinearToGamma(this,e),this},ze.prototype.copySRGBToLinear=function(e){return this.r=Ne(e.r),this.g=Ne(e.g),this.b=Ne(e.b),this},ze.prototype.copyLinearToSRGB=function(e){return this.r=Ue(e.r),this.g=Ue(e.g),this.b=Ue(e.b),this},ze.prototype.convertSRGBToLinear=function(){return this.copySRGBToLinear(this),this},ze.prototype.convertLinearToSRGB=function(){return this.copyLinearToSRGB(this),this},ze.prototype.getHex=function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},ze.prototype.getHexString=function(){return("000000"+this.getHex().toString(16)).slice(-6)},ze.prototype.getHSL=function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,i,r=this.r,n=this.g,o=this.b,s=Math.max(r,n,o),a=Math.min(r,n,o),l=(a+s)/2;if(a===s)t=0,i=0;else{var u=s-a;switch(i=l<=.5?u/(s+a):u/(2-s-a),s){case r:t=(n-o)/u+(n<o?6:0);break;case n:t=(o-r)/u+2;break;case o:t=(r-n)/u+4}t/=6}return e.h=t,e.s=i,e.l=l,e},ze.prototype.getStyle=function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},ze.prototype.offsetHSL=function(e,t,i){return this.getHSL(Fe),Fe.h+=e,Fe.s+=t,Fe.l+=i,this.setHSL(Fe.h,Fe.s,Fe.l),this},ze.prototype.add=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},ze.prototype.addColors=function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},ze.prototype.addScalar=function(e){return this.r+=e,this.g+=e,this.b+=e,this},ze.prototype.sub=function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},ze.prototype.multiply=function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},ze.prototype.multiplyScalar=function(e){return this.r*=e,this.g*=e,this.b*=e,this},ze.prototype.lerp=function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},ze.prototype.lerpHSL=function(e,t){this.getHSL(Fe),e.getHSL(Le);var i=o.lerp(Fe.h,Le.h,t),r=o.lerp(Fe.s,Le.s,t),n=o.lerp(Fe.l,Le.l,t);return this.setHSL(i,r,n),this},ze.prototype.equals=function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},ze.prototype.fromArray=function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},ze.prototype.toArray=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},ze.prototype.fromBufferAttribute=function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this},ze.prototype.toJSON=function(){return this.getHex()},ze.NAMES=Be,ze.prototype.r=1,ze.prototype.g=1,ze.prototype.b=1;var He=function(e,t,i,r,n,o){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new b,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new ze,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==o?o:0};He.prototype.clone=function(){return(new this.constructor).copy(this)},He.prototype.copy=function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var r=0,n=e.vertexColors.length;r<n;r++)this.vertexColors[r]=e.vertexColors[r].clone();return this};var Ve=0;function We(){Object.defineProperty(this,"id",{value:Ve++}),this.uuid=o.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.stencilFuncBack=null,this.stencilRefBack=null,this.stencilFuncMaskBack=null,this.stencilFailBack=null,this.stencilZFailBack=null,this.stencilZPassBack=null,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.colorMapping=null,this.colorMappingIntensity=1,this.baseQuaternion=null,this.uvTransform=null,this.uvTransform1=null,this.uvTransform2=null,this.useEnvironment=null,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Ge(e){We.call(this),this.type="MeshBasicMaterial",this.color=new ze(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.highlightColor=new ze(0),this.highlightIntensity=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}We.prototype=Object.assign(Object.create(t.prototype),{constructor:We,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity,i.refractionRatio=this.refractionRatio,void 0!==this.combine&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,i.stencilFuncBack=this.stencilFuncBack,i.stencilRefBack=this.stencilRefBack,i.stencilFuncMaskBack=this.stencilFuncMaskBack,i.stencilFailBack=this.stencilFailBack,i.stencilZFailBack=this.stencilZFailBack,i.stencilZPassBack=this.stencilZPassBack,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){var n=r(e.textures),o=r(e.images);n.length>0&&(i.textures=n),o.length>0&&(i.images=o)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite,this.stencilFuncBack=e.stencilFuncBack,this.stencilRefBack=e.stencilRefBack,this.stencilFuncMaskBack=e.stencilFuncMaskBack,this.stencilFailBack=e.stencilFailBack,this.stencilZFailBack=e.stencilZFailBack,this.stencilZPassBack=e.stencilZPassBack;var t=e.clippingPlanes,i=null;if(null!==t){var r=t.length;i=new Array(r);for(var n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this.colorMapping=e.colorMapping,this.colorMappingIntensity=e.colorMappingIntensity,e.baseQuaternion?this.baseQuaternion=e.baseQuaternion.clone():this.baseQuaternion=null,e.uvTransform?this.uvTransform=e.uvTransform:this.uvTransform=null,e.uvTransform1?this.uvTransform1=e.uvTransform1:this.uvTransform1=null,e.uvTransform2?this.uvTransform2=e.uvTransform2:this.uvTransform2=null,this.useEnvironment=e.useEnvironment,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(We.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Ge.prototype=Object.create(We.prototype),Ge.prototype.constructor=Ge,Ge.prototype.isMeshBasicMaterial=!0,Ge.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.highlightColor.copy(e.highlightColor),this.highlightIntensity=e.highlightIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var qe=new b,Xe=new s;function Je(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=35044,this.updateRange={offset:0,count:-1},this.resizeDirty=!1,this.version=0}function Ye(e,t,i){Je.call(this,new Int8Array(e),t,i)}function Ze(e,t,i){Je.call(this,new Uint8Array(e),t,i)}function Qe(e,t,i){Je.call(this,new Uint8ClampedArray(e),t,i)}function Ke(e,t,i){Je.call(this,new Int16Array(e),t,i)}function $e(e,t,i){Je.call(this,new Uint16Array(e),t,i)}function et(e,t,i){Je.call(this,new Int32Array(e),t,i)}function tt(e,t,i){Je.call(this,new Uint32Array(e),t,i)}function it(e,t,i){Je.call(this,new Float32Array(e),t,i)}function rt(e,t,i){Je.call(this,new Float64Array(e),t,i)}Object.defineProperty(Je.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Je.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new ze),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new s),t[i++]=o.x,t[i++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new b),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new d),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this},applyMatrix3:function(e){if(2===this.itemSize)for(var t=0,i=this.count;t<i;t++)Xe.fromBufferAttribute(this,t),Xe.applyMatrix3(e),this.setXY(t,Xe.x,Xe.y);else if(3===this.itemSize)for(var r=0,n=this.count;r<n;r++)qe.fromBufferAttribute(this,r),qe.applyMatrix3(e),this.setXYZ(r,qe.x,qe.y,qe.z);return this},applyMatrix4:function(e){for(var t=0,i=this.count;t<i;t++)qe.x=this.getX(t),qe.y=this.getY(t),qe.z=this.getZ(t),qe.applyMatrix4(e),this.setXYZ(t,qe.x,qe.y,qe.z);return this},applyNormalMatrix:function(e){for(var t=0,i=this.count;t<i;t++)qe.x=this.getX(t),qe.y=this.getY(t),qe.z=this.getZ(t),qe.applyNormalMatrix(e),this.setXYZ(t,qe.x,qe.y,qe.z);return this},transformDirection:function(e){for(var t=0,i=this.count;t<i;t++)qe.x=this.getX(t),qe.y=this.getY(t),qe.z=this.getZ(t),qe.transformDirection(e),this.setXYZ(t,qe.x,qe.y,qe.z);return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Ye.prototype=Object.create(Je.prototype),Ye.prototype.constructor=Ye,Ze.prototype=Object.create(Je.prototype),Ze.prototype.constructor=Ze,Qe.prototype=Object.create(Je.prototype),Qe.prototype.constructor=Qe,Ke.prototype=Object.create(Je.prototype),Ke.prototype.constructor=Ke,$e.prototype=Object.create(Je.prototype),$e.prototype.constructor=$e,et.prototype=Object.create(Je.prototype),et.prototype.constructor=et,tt.prototype=Object.create(Je.prototype),tt.prototype.constructor=tt,it.prototype=Object.create(Je.prototype),it.prototype.constructor=it,rt.prototype=Object.create(Je.prototype),rt.prototype.constructor=rt;var nt=function(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1};function ot(e){if(0===e.length)return-1/0;for(var t=e[0],i=1,r=e.length;i<r;++i)e[i]>t&&(t=e[i]);return t}nt.prototype.computeGroups=function(e){var t,i,r=[],n=void 0,o=e.faces;for(i=0;i<o.length;i++){var s=o[i];s.materialIndex!==n&&(n=s.materialIndex,void 0!==t&&(t.count=3*i-t.start,r.push(t)),t={start:3*i,materialIndex:n})}void 0!==t&&(t.count=3*i-t.start,r.push(t)),this.groups=r},nt.prototype.fromGeometry=function(e){var t,i=e.faces,r=e.vertices,n=e.faceVertexUvs,o=n[0]&&n[0].length>0,a=n[1]&&n[1].length>0,l=e.morphTargets,u=l.length;if(u>0){t=[];for(var c=0;c<u;c++)t[c]={name:l[c].name,data:[]};this.morphTargets.position=t}var h,p=e.morphNormals,d=p.length;if(d>0){h=[];for(var f=0;f<d;f++)h[f]={name:p[f].name,data:[]};this.morphTargets.normal=h}var m=e.skinIndices,g=e.skinWeights,v=m.length===r.length,y=g.length===r.length;r.length>0&&0===i.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var b=0;b<i.length;b++){var _=i[b];this.vertices.push(r[_.a],r[_.b],r[_.c]);var x=_.vertexNormals;if(3===x.length)this.normals.push(x[0],x[1],x[2]);else{var E=_.normal;this.normals.push(E,E,E)}var w=_.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var T=_.color;this.colors.push(T,T,T)}if(!0===o){var M=n[0][b];void 0!==M?this.uvs.push(M[0],M[1],M[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",b),this.uvs.push(new s,new s,new s))}if(!0===a){var C=n[1][b];void 0!==C?this.uvs2.push(C[0],C[1],C[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",b),this.uvs2.push(new s,new s,new s))}for(var S=0;S<u;S++){var j=l[S].vertices;t[S].data.push(j[_.a],j[_.b],j[_.c])}for(var P=0;P<d;P++){var R=p[P].vertexNormals[b];h[P].data.push(R.a,R.b,R.c)}v&&this.skinIndices.push(m[_.a],m[_.b],m[_.c]),y&&this.skinWeights.push(g[_.a],g[_.b],g[_.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this};var st=1,at=new X,lt=new be,ut=new b,ct=new E,ht=new E,pt=new b;function dt(){Object.defineProperty(this,"id",{value:st+=2}),this.uuid=o.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}dt.prototype=Object.assign(Object.create(t.prototype),{constructor:dt,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(ot(e)>65535?tt:$e)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var i=this.attributes.normal;if(void 0!==i){var r=(new u).getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}var n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return at.makeRotationX(e),this.applyMatrix4(at),this},rotateY:function(e){return at.makeRotationY(e),this.applyMatrix4(at),this},rotateZ:function(e){return at.makeRotationZ(e),this.applyMatrix4(at),this},translate:function(e,t,i){return at.makeTranslation(e,t,i),this.applyMatrix4(at),this},scale:function(e,t,i){return at.makeScale(e,t,i),this.applyMatrix4(at),this},lookAt:function(e){return lt.lookAt(e),lt.updateMatrix(),this.applyMatrix4(lt.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ut).negate(),this.translate(ut.x,ut.y,ut.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var i=new it(3*t.vertices.length,3),r=new it(3*t.colors.length,3);if(this.setAttribute("position",i.copyVector3sArray(t.vertices)),this.setAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new it(t.lineDistances.length,1);this.setAttribute("lineDistance",n.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new it(t,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var i=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(i=void 0,t.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(t);i.verticesNeedUpdate=t.verticesNeedUpdate,i.normalsNeedUpdate=t.normalsNeedUpdate,i.colorsNeedUpdate=t.colorsNeedUpdate,i.uvsNeedUpdate=t.uvsNeedUpdate,i.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=i}if(!0===t.verticesNeedUpdate){var r=this.attributes.position;void 0!==r&&(r.copyVector3sArray(t.vertices),r.needsUpdate=!0),t.verticesNeedUpdate=!1}if(!0===t.normalsNeedUpdate){var n=this.attributes.normal;void 0!==n&&(n.copyVector3sArray(t.normals),n.needsUpdate=!0),t.normalsNeedUpdate=!1}if(!0===t.colorsNeedUpdate){var o=this.attributes.color;void 0!==o&&(o.copyColorsArray(t.colors),o.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){var s=this.attributes.uv;void 0!==s&&(s.copyVector2sArray(t.uvs),s.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){var a=this.attributes.lineDistance;void 0!==a&&(a.copyArray(t.lineDistances),a.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new nt).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new Je(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var i=new Float32Array(3*e.normals.length);this.setAttribute("normal",new Je(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.setAttribute("color",new Je(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var n=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new Je(n,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new Je(o,2).copyVector2sArray(e.uvs2))}for(var s in this.groups=e.groups,e.morphTargets){for(var a=[],l=e.morphTargets[s],u=0,c=l.length;u<c;u++){var h=l[u],p=new it(3*h.data.length,3);p.name=h.name,a.push(p.copyVector3sArray(h.data))}this.morphAttributes[s]=a}if(e.skinIndices.length>0){var d=new it(4*e.skinIndices.length,4);this.setAttribute("skinIndex",d.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new it(4*e.skinWeights.length,4);this.setAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new E);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new b(-1/0,-1/0,-1/0),new b(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var i=0,r=t.length;i<r;i++){var n=t[i];ct.setFromBufferAttribute(n),this.morphTargetsRelative?(pt.addVectors(this.boundingBox.min,ct.min),this.boundingBox.expandByPoint(pt),pt.addVectors(this.boundingBox.max,ct.max),this.boundingBox.expandByPoint(pt)):(this.boundingBox.expandByPoint(ct.min),this.boundingBox.expandByPoint(ct.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new I);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new b,1/0);if(e){var i=this.boundingSphere.center;if(ct.setFromBufferAttribute(e),t)for(var r=0,n=t.length;r<n;r++){var o=t[r];ht.setFromBufferAttribute(o),this.morphTargetsRelative?(pt.addVectors(ct.min,ht.min),ct.expandByPoint(pt),pt.addVectors(ct.max,ht.max),ct.expandByPoint(pt)):(ct.expandByPoint(ht.min),ct.expandByPoint(ht.max))}ct.getCenter(i);for(var s=0,a=0,l=e.count;a<l;a++)pt.fromBufferAttribute(e,a),s=Math.max(s,i.distanceToSquared(pt));if(t)for(var u=0,c=t.length;u<c;u++)for(var h=t[u],p=this.morphTargetsRelative,d=0,f=h.count;d<f;d++)pt.fromBufferAttribute(h,d),p&&(ut.fromBufferAttribute(e,d),pt.add(ut)),s=Math.max(s,i.distanceToSquared(pt));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var i=this.getAttribute("normal");if(void 0===i)i=new Je(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(var r=0,n=i.count;r<n;r++)i.setXYZ(r,0,0,0);var o=new b,s=new b,a=new b,l=new b,u=new b,c=new b,h=new b,p=new b;if(e)for(var d=0,f=e.count;d<f;d+=3){var m=e.getX(d+0),g=e.getX(d+1),v=e.getX(d+2);o.fromBufferAttribute(t,m),s.fromBufferAttribute(t,g),a.fromBufferAttribute(t,v),h.subVectors(a,s),p.subVectors(o,s),h.cross(p),l.fromBufferAttribute(i,m),u.fromBufferAttribute(i,g),c.fromBufferAttribute(i,v),l.add(h),u.add(h),c.add(h),i.setXYZ(m,l.x,l.y,l.z),i.setXYZ(g,u.x,u.y,u.z),i.setXYZ(v,c.x,c.y,c.z)}else for(var y=0,_=t.count;y<_;y+=3)o.fromBufferAttribute(t,y+0),s.fromBufferAttribute(t,y+1),a.fromBufferAttribute(t,y+2),h.subVectors(a,s),p.subVectors(o,s),h.cross(p),i.setXYZ(y+0,h.x,h.y,h.z),i.setXYZ(y+1,h.x,h.y,h.z),i.setXYZ(y+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var i=this.attributes;for(var r in i)if(void 0!==e.attributes[r])for(var n=i[r].array,o=e.attributes[r],s=o.array,a=o.itemSize*t,l=Math.min(s.length,n.length-a),u=0,c=a;u<l;u++,c++)n[c]=s[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,i=e.count;t<i;t++)pt.fromBufferAttribute(e,t),pt.normalize(),e.setXYZ(t,pt.x,pt.y,pt.z)},toNonIndexed:function(){function e(e,t){for(var i=e.array,r=e.itemSize,n=e.normalized,o=new i.constructor(t.length*r),s=0,a=0,l=0,u=t.length;l<u;l++){s=t[l]*r;for(var c=0;c<r;c++)o[a++]=i[s++]}return new Je(o,r,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new dt,i=this.index.array,r=this.attributes;for(var n in r){var o=e(r[n],i);t.setAttribute(n,o)}var s=this.morphAttributes;for(var a in s){for(var l=[],u=s[a],c=0,h=u.length;c<h;c++){var p=e(u[c],i);l.push(p)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;for(var d=this.groups,f=0,m=d.length;f<m;f++){var g=d[f];t.addGroup(g.start,g.count,g.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var n=this.attributes;for(var o in n){var s=n[o],a=s.toJSON(e.data);""!==s.name&&(a.name=s.name),e.data.attributes[o]=a}var l={},u=!1;for(var c in this.morphAttributes){for(var h=this.morphAttributes[c],p=[],d=0,f=h.length;d<f;d++){var m=h[d],g=m.toJSON(e.data);""!==m.name&&(g.name=m.name),p.push(g)}p.length>0&&(l[c]=p,u=!0)}u&&(e.data.morphAttributes=l,e.data.morphTargetsRelative=this.morphTargetsRelative);var v=this.groups;v.length>0&&(e.data.groups=JSON.parse(JSON.stringify(v)));var y=this.boundingSphere;return null!==y&&(e.data.boundingSphere={center:y.center.toArray(),radius:y.radius}),e},clone:function(){return(new dt).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone(t));var r=e.attributes;for(var n in r){var o=r[n];this.setAttribute(n,o.clone(t))}var s=e.morphAttributes;for(var a in s){for(var l=[],u=s[a],c=0,h=u.length;c<h;c++)l.push(u[c].clone(t));this.morphAttributes[a]=l}this.morphTargetsRelative=e.morphTargetsRelative;for(var p=e.groups,d=0,f=p.length;d<f;d++){var m=p[d];this.addGroup(m.start,m.count,m.materialIndex)}var g=e.boundingBox;null!==g&&(this.boundingBox=g.clone());var v=e.boundingSphere;return null!==v&&(this.boundingSphere=v.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ft=new X,mt=new q,gt=new I,vt=new b,yt=new b,bt=new b,_t=new b,xt=new b,Et=new b,wt=new b,Tt=new b,Mt=new b,Ct=new s,St=new s,jt=new s,Pt=new b,Rt=new b;function Dt(e,t){be.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new dt,this.material=void 0!==t?t:new Ge,this.updateMorphTargets()}function At(e,t,i,r,n,o,s,a){if(null===(1===t.side?r.intersectTriangle(s,o,n,!0,a):r.intersectTriangle(n,o,s,2!==t.side,a)))return null;Rt.copy(a),Rt.applyMatrix4(e.matrixWorld);var l=i.ray.origin.distanceTo(Rt);return l<i.near||l>i.far?null:{distance:l,point:Rt.clone(),object:e}}function kt(e,t,i,r,n,o,a,l,u,c,h,p){vt.fromBufferAttribute(n,c),yt.fromBufferAttribute(n,h),bt.fromBufferAttribute(n,p);var d=e.morphTargetInfluences;if(t.morphTargets&&o&&d){wt.set(0,0,0),Tt.set(0,0,0),Mt.set(0,0,0);for(var f=0,m=o.length;f<m;f++){var g=d[f],v=o[f];0!==g&&(_t.fromBufferAttribute(v,c),xt.fromBufferAttribute(v,h),Et.fromBufferAttribute(v,p),a?(wt.addScaledVector(_t,g),Tt.addScaledVector(xt,g),Mt.addScaledVector(Et,g)):(wt.addScaledVector(_t.sub(vt),g),Tt.addScaledVector(xt.sub(yt),g),Mt.addScaledVector(Et.sub(bt),g)))}vt.add(wt),yt.add(Tt),bt.add(Mt)}e.isSkinnedMesh&&(e.boneTransform(c,vt),e.boneTransform(h,yt),e.boneTransform(p,bt));var y=At(e,t,i,r,vt,yt,bt,Pt);if(y){l&&(Ct.fromBufferAttribute(l,c),St.fromBufferAttribute(l,h),jt.fromBufferAttribute(l,p),y.uv=Oe.getUV(Pt,vt,yt,bt,Ct,St,jt,new s)),u&&(Ct.fromBufferAttribute(u,c),St.fromBufferAttribute(u,h),jt.fromBufferAttribute(u,p),y.uv2=Oe.getUV(Pt,vt,yt,bt,Ct,St,jt,new s));var b=new He(c,h,p);Oe.getNormal(vt,yt,bt,b.normal),y.face=b}return y}Dt.prototype=Object.assign(Object.create(be.prototype),{constructor:Dt,isMesh:!0,copy:function(e){return be.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,i=Object.keys(t);if(i.length>0){var r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var n=0,o=r.length;n<o;n++){var s=r[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=n}}}}else{var a=e.morphTargets;void 0!==a&&a.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var i,r=this.geometry,n=this.material,o=this.matrixWorld;if(void 0!==n&&(null===r.boundingSphere&&r.computeBoundingSphere(),gt.copy(r.boundingSphere),gt.applyMatrix4(o),!1!==e.ray.intersectsSphere(gt)&&(ft.getInverse(o),mt.copy(e.ray).applyMatrix4(ft),null===r.boundingBox||!1!==mt.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var a=r.index,l=r.attributes.position,u=r.morphAttributes.position,c=r.morphTargetsRelative,h=r.attributes.uv,p=r.attributes.uv2,d=r.groups,f=r.drawRange;if(null!==a)if(Array.isArray(n))for(var m=0,g=d.length;m<g;m++)for(var v=d[m],y=n[v.materialIndex],b=Math.max(v.start,f.start),_=Math.min(v.start+v.count,f.start+f.count),x=b,E=_=Math.min(_,a.count);x<E;x+=3){var w=a.getX(x),T=a.getX(x+1),M=a.getX(x+2);(i=kt(this,y,e,mt,l,u,c,h,p,w,T,M))&&(i.faceIndex=Math.floor(x/3),i.face.materialIndex=v.materialIndex,t.push(i))}else for(var C=Math.max(0,f.start),S=Math.min(a.count,f.start+f.count);C<S;C+=3){var j=a.getX(C),P=a.getX(C+1),R=a.getX(C+2);(i=kt(this,n,e,mt,l,u,c,h,p,j,P,R))&&(i.faceIndex=Math.floor(C/3),t.push(i))}else if(void 0!==l)if(Array.isArray(n))for(var D=0,A=d.length;D<A;D++)for(var k=d[D],O=n[k.materialIndex],B=Math.max(k.start,f.start),F=Math.min(k.start+k.count,f.start+f.count),L=B,I=F=Math.min(F,l.count);L<I;L+=3){(i=kt(this,O,e,mt,l,u,c,h,p,L,L+1,L+2))&&(i.faceIndex=Math.floor(L/3),i.face.materialIndex=k.materialIndex,t.push(i))}else for(var N=Math.max(0,f.start),U=Math.min(l.count,f.start+f.count);N<U;N+=3){(i=kt(this,n,e,mt,l,u,c,h,p,N,N+1,N+2))&&(i.faceIndex=Math.floor(N/3),t.push(i))}}else if(r.isGeometry){var z,H=Array.isArray(n),V=r.vertices,W=r.faces,G=r.faceVertexUvs[0];G.length>0&&(z=G);for(var q=0,X=W.length;q<X;q++){var J=W[q],Y=H?n[J.materialIndex]:n;if(void 0!==Y){var Z=V[J.a],Q=V[J.b],K=V[J.c];if(i=At(this,Y,e,mt,Z,Q,K,Pt)){if(z&&z[q]){var $=z[q];Ct.copy($[0]),St.copy($[1]),jt.copy($[2]),i.uv=Oe.getUV(Pt,Z,Q,K,Ct,St,jt,new s)}i.face=J,i.faceIndex=q,t.push(i)}}}}}});var Ot=0,Bt=new X,Ft=new be,Lt=new b;function It(){Object.defineProperty(this,"id",{value:Ot+=2}),this.uuid=o.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}It.prototype=Object.assign(Object.create(t.prototype),{constructor:It,isGeometry:!0,applyMatrix4:function(e){for(var t=(new u).getNormalMatrix(e),i=0,r=this.vertices.length;i<r;i++){this.vertices[i].applyMatrix4(e)}for(var n=0,o=this.faces.length;n<o;n++){var s=this.faces[n];s.normal.applyMatrix3(t).normalize();for(var a=0,l=s.vertexNormals.length;a<l;a++)s.vertexNormals[a].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return Bt.makeRotationX(e),this.applyMatrix4(Bt),this},rotateY:function(e){return Bt.makeRotationY(e),this.applyMatrix4(Bt),this},rotateZ:function(e){return Bt.makeRotationZ(e),this.applyMatrix4(Bt),this},translate:function(e,t,i){return Bt.makeTranslation(e,t,i),this.applyMatrix4(Bt),this},scale:function(e,t,i){return Bt.makeScale(e,t,i),this.applyMatrix4(Bt),this},lookAt:function(e){return Ft.lookAt(e),Ft.updateMatrix(),this.applyMatrix4(Ft.matrix),this},fromBufferGeometry:function(e){var t=this,i=null!==e.index?e.index:void 0,r=e.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var n=r.position,o=r.normal,a=r.color,l=r.uv,u=r.uv2;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var c=0;c<n.count;c++)t.vertices.push((new b).fromBufferAttribute(n,c)),void 0!==a&&t.colors.push((new ze).fromBufferAttribute(a,c));function h(e,i,r,n){var c=void 0===a?[]:[t.colors[e].clone(),t.colors[i].clone(),t.colors[r].clone()],h=void 0===o?[]:[(new b).fromBufferAttribute(o,e),(new b).fromBufferAttribute(o,i),(new b).fromBufferAttribute(o,r)],p=new He(e,i,r,h,c,n);t.faces.push(p),void 0!==l&&t.faceVertexUvs[0].push([(new s).fromBufferAttribute(l,e),(new s).fromBufferAttribute(l,i),(new s).fromBufferAttribute(l,r)]),void 0!==u&&t.faceVertexUvs[1].push([(new s).fromBufferAttribute(u,e),(new s).fromBufferAttribute(u,i),(new s).fromBufferAttribute(u,r)])}var p=e.groups,d=e.drawRange;if(p.length>0)for(var f=0;f<p.length;f++)for(var m=p[f],g=Math.max(m.start,d.start),v=g,y=g+Math.min(m.count,d.count);v<y;v+=3)void 0!==i?h(i.getX(v),i.getX(v+1),i.getX(v+2),m.materialIndex):h(v,v+1,v+2,m.materialIndex);else if(void 0!==i)for(var _=Math.max(0,d.start),x=Math.min(i.count-_,d.count),E=_;E<_+x;E+=3)h(i.getX(E),i.getX(E+1),i.getX(E+2));else for(var w=0;w<n.count;w+=3)h(w,w+1,w+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Lt).negate(),this.translate(Lt.x,Lt.y,Lt.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,r=new X;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){for(var e=new b,t=new b,i=0,r=this.faces.length;i<r;i++){var n=this.faces[i],o=this.vertices[n.a],s=this.vertices[n.b],a=this.vertices[n.c];e.subVectors(a,s),t.subVectors(o,s),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){void 0===e&&(e=!0);for(var t=new Array(this.vertices.length),i=0,r=this.vertices.length;i<r;i++)t[i]=new b;if(e)for(var n=new b,o=new b,s=0,a=this.faces.length;s<a;s++){var l=this.faces[s],u=this.vertices[l.a],c=this.vertices[l.b],h=this.vertices[l.c];n.subVectors(h,c),o.subVectors(u,c),n.cross(o),t[l.a].add(n),t[l.b].add(n),t[l.c].add(n)}else{this.computeFaceNormals();for(var p=0,d=this.faces.length;p<d;p++){var f=this.faces[p];t[f.a].add(f.normal),t[f.b].add(f.normal),t[f.c].add(f.normal)}}for(var m=0,g=this.vertices.length;m<g;m++)t[m].normalize();for(var v=0,y=this.faces.length;v<y;v++){var _=this.faces[v],x=_.vertexNormals;3===x.length?(x[0].copy(t[_.a]),x[1].copy(t[_.b]),x[2].copy(t[_.c])):(x[0]=t[_.a].clone(),x[1]=t[_.b].clone(),x[2]=t[_.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(var e=0,t=this.faces.length;e<t;e++){var i=this.faces[e],r=i.vertexNormals;3===r.length?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(var e=0,t=this.faces.length;e<t;e++){var i=this.faces[e];i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]);for(var r=0,n=i.vertexNormals.length;r<n;r++)i.__originalVertexNormals[r]?i.__originalVertexNormals[r].copy(i.vertexNormals[r]):i.__originalVertexNormals[r]=i.vertexNormals[r].clone()}var o=new It;o.faces=this.faces;for(var s=0,a=this.morphTargets.length;s<a;s++){if(!this.morphNormals[s]){this.morphNormals[s]={},this.morphNormals[s].faceNormals=[],this.morphNormals[s].vertexNormals=[];for(var l=this.morphNormals[s].faceNormals,u=this.morphNormals[s].vertexNormals,c=0,h=this.faces.length;c<h;c++){var p=new b,d={a:new b,b:new b,c:new b};l.push(p),u.push(d)}}var f=this.morphNormals[s];o.vertices=this.morphTargets[s].vertices,o.computeFaceNormals(),o.computeVertexNormals();for(var m=0,g=this.faces.length;m<g;m++){var v=this.faces[m],y=f.faceNormals[m],_=f.vertexNormals[m];y.copy(v.normal),_.a.copy(v.vertexNormals[0]),_.b.copy(v.vertexNormals[1]),_.c.copy(v.vertexNormals[2])}}for(var x=0,E=this.faces.length;x<E;x++){var w=this.faces[x];w.normal=w.__originalFaceNormal,w.vertexNormals=w.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new E),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new I),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e&&e.isGeometry){var r,n=this.vertices.length,o=this.vertices,s=e.vertices,a=this.faces,l=e.faces,c=this.colors,h=e.colors;void 0===i&&(i=0),void 0!==t&&(r=(new u).getNormalMatrix(t));for(var p=0,d=s.length;p<d;p++){var f=s[p].clone();void 0!==t&&f.applyMatrix4(t),o.push(f)}for(var m=0,g=h.length;m<g;m++)c.push(h[m].clone());for(var v=0,y=l.length;v<y;v++){var b=l[v],_=void 0,x=void 0,E=b.vertexNormals,w=b.vertexColors,T=new He(b.a+n,b.b+n,b.c+n);T.normal.copy(b.normal),void 0!==r&&T.normal.applyMatrix3(r).normalize();for(var M=0,C=E.length;M<C;M++)_=E[M].clone(),void 0!==r&&_.applyMatrix3(r).normalize(),T.vertexNormals.push(_);T.color.copy(b.color);for(var S=0,j=w.length;S<j;S++)x=w[S],T.vertexColors.push(x.clone());T.materialIndex=b.materialIndex+i,a.push(T)}for(var P=0,R=e.faceVertexUvs.length;P<R;P++){var D=e.faceVertexUvs[P];void 0===this.faceVertexUvs[P]&&(this.faceVertexUvs[P]=[]);for(var A=0,k=D.length;A<k;A++){for(var O=D[A],B=[],F=0,L=O.length;F<L;F++)B.push(O[F].clone());this.faceVertexUvs[P].push(B)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){for(var e={},t=[],i=[],r=Math.pow(10,4),n=0,o=this.vertices.length;n<o;n++){var s=this.vertices[n],a=Math.round(s.x*r)+"_"+Math.round(s.y*r)+"_"+Math.round(s.z*r);void 0===e[a]?(e[a]=n,t.push(this.vertices[n]),i[n]=t.length-1):i[n]=i[e[a]]}for(var l=[],u=0,c=this.faces.length;u<c;u++){var h=this.faces[u];h.a=i[h.a],h.b=i[h.b],h.c=i[h.c];for(var p=[h.a,h.b,h.c],d=0;d<3;d++)if(p[d]===p[(d+1)%3]){l.push(u);break}}for(var f=l.length-1;f>=0;f--){var m=l[f];this.faces.splice(m,1);for(var g=0,v=this.faceVertexUvs.length;g<v;g++)this.faceVertexUvs[g].splice(m,1)}var y=this.vertices.length-t.length;return this.vertices=t,y},setFromPoints:function(e){this.vertices=[];for(var t=0,i=e.length;t<i;t++){var r=e[t];this.vertices.push(new b(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,i=0;i<t;i++)e[i]._id=i;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var r,n,o=this.faceVertexUvs[0],s=this.faceVertexUvs[1];o&&o.length===t&&(r=[]),s&&s.length===t&&(n=[]);for(var a=0;a<t;a++){var l=e[a]._id;r&&r.push(o[l]),n&&n.push(s[l])}r&&(this.faceVertexUvs[0]=r),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}for(var r=[],n=0;n<this.vertices.length;n++){var o=this.vertices[n];r.push(o.x,o.y,o.z)}for(var s=[],a=[],l={},u=[],c={},h=[],p={},d=0;d<this.faces.length;d++){var f=this.faces[d],m=void 0!==this.faceVertexUvs[0][d],g=f.normal.length()>0,v=f.vertexNormals.length>0,y=1!==f.color.r||1!==f.color.g||1!==f.color.b,b=f.vertexColors.length>0,_=0;if(_=T(_,0,0),_=T(_,1,!0),_=T(_,2,!1),_=T(_,3,m),_=T(_,4,g),_=T(_,5,v),_=T(_,6,y),_=T(_,7,b),s.push(_),s.push(f.a,f.b,f.c),s.push(f.materialIndex),m){var x=this.faceVertexUvs[0][d];s.push(S(x[0]),S(x[1]),S(x[2]))}if(g&&s.push(M(f.normal)),v){var E=f.vertexNormals;s.push(M(E[0]),M(E[1]),M(E[2]))}if(y&&s.push(C(f.color)),b){var w=f.vertexColors;s.push(C(w[0]),C(w[1]),C(w[2]))}}function T(e,t,i){return i?e|1<<t:e&~(1<<t)}function M(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=a.length/3,a.push(e.x,e.y,e.z)),l[t]}function C(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]||(c[t]=u.length,u.push(e.getHex())),c[t]}function S(e){var t=e.x.toString()+e.y.toString();return void 0!==p[t]||(p[t]=h.length/2,h.push(e.x,e.y)),p[t]}return e.data={},e.data.vertices=r,e.data.normals=a,u.length>0&&(e.data.colors=u),h.length>0&&(e.data.uvs=[h]),e.data.faces=s,e},clone:function(){return(new It).copy(this)},copy:function(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;for(var t=e.vertices,i=0,r=t.length;i<r;i++)this.vertices.push(t[i].clone());for(var n=e.colors,o=0,s=n.length;o<s;o++)this.colors.push(n[o].clone());for(var a=e.faces,l=0,u=a.length;l<u;l++)this.faces.push(a[l].clone());for(var c=0,h=e.faceVertexUvs.length;c<h;c++){var p=e.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var d=0,f=p.length;d<f;d++){for(var m=p[d],g=[],v=0,y=m.length;v<y;v++){var b=m[v];g.push(b.clone())}this.faceVertexUvs[c].push(g)}}for(var _=e.morphTargets,x=0,E=_.length;x<E;x++){var w={};if(w.name=_[x].name,void 0!==_[x].vertices){w.vertices=[];for(var T=0,M=_[x].vertices.length;T<M;T++)w.vertices.push(_[x].vertices[T].clone())}if(void 0!==_[x].normals){w.normals=[];for(var C=0,S=_[x].normals.length;C<S;C++)w.normals.push(_[x].normals[C].clone())}this.morphTargets.push(w)}for(var j=e.morphNormals,P=0,R=j.length;P<R;P++){var D={};if(void 0!==j[P].vertexNormals){D.vertexNormals=[];for(var A=0,k=j[P].vertexNormals.length;A<k;A++){var O=j[P].vertexNormals[A],B={};B.a=O.a.clone(),B.b=O.b.clone(),B.c=O.c.clone(),D.vertexNormals.push(B)}}if(void 0!==j[P].faceNormals){D.faceNormals=[];for(var F=0,L=j[P].faceNormals.length;F<L;F++)D.faceNormals.push(j[P].faceNormals[F].clone())}this.morphNormals.push(D)}for(var I=e.skinWeights,N=0,U=I.length;N<U;N++)this.skinWeights.push(I[N].clone());for(var z=e.skinIndices,H=0,V=z.length;H<V;H++)this.skinIndices.push(z[H].clone());for(var W=e.lineDistances,G=0,q=W.length;G<q;G++)this.lineDistances.push(W[G]);var X=e.boundingBox;null!==X&&(this.boundingBox=X.clone());var J=e.boundingSphere;return null!==J&&(this.boundingSphere=J.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Nt=function(e){function t(t,i,r,n,o,s){e.call(this),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:r,widthSegments:n,heightSegments:o,depthSegments:s},this.fromBufferGeometry(new Ut(t,i,r,n,o,s)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Ut=function(e){function t(t,i,r,n,o,s){void 0===t&&(t=1),void 0===i&&(i=1),void 0===r&&(r=1),void 0===n&&(n=1),void 0===o&&(o=1),void 0===s&&(s=1),e.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:i,depth:r,widthSegments:n,heightSegments:o,depthSegments:s};var a=this;n=Math.floor(n),o=Math.floor(o),s=Math.floor(s);var l=[],u=[],c=[],h=[],p=0,d=0;function f(e,t,i,r,n,o,s,f,m,g,v){for(var y=o/m,_=s/g,x=o/2,E=s/2,w=f/2,T=m+1,M=g+1,C=0,S=0,j=new b,P=0;P<M;P++)for(var R=P*_-E,D=0;D<T;D++){var A=D*y-x;j[e]=A*r,j[t]=R*n,j[i]=w,u.push(j.x,j.y,j.z),j[e]=0,j[t]=0,j[i]=f>0?1:-1,c.push(j.x,j.y,j.z),h.push(D/m),h.push(1-P/g),C+=1}for(var k=0;k<g;k++)for(var O=0;O<m;O++){var B=p+O+T*k,F=p+O+T*(k+1),L=p+(O+1)+T*(k+1),I=p+(O+1)+T*k;l.push(B,F,I),l.push(F,L,I),S+=6}a.addGroup(d,S,v),d+=S,p+=C}f("z","y","x",-1,-1,r,i,t,s,o,0),f("z","y","x",1,-1,r,i,-t,s,o,1),f("x","z","y",1,1,t,r,i,n,s,2),f("x","z","y",1,-1,t,r,-i,n,s,3),f("x","y","z",1,-1,t,i,r,n,o,4),f("x","y","z",-1,-1,t,i,-r,n,o,5),this.setIndex(l),this.setAttribute("position",new it(u,3)),this.setAttribute("normal",new it(c,3)),this.setAttribute("uv",new it(h,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt);function zt(e){var t={};for(var i in e)for(var r in t[i]={},e[i]){var n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}return t}function Ht(e){for(var t={},i=0;i<e.length;i++){var r=zt(e[i]);for(var n in r)t[n]=r[n]}return t}var Vt={clone:zt,merge:Ht};function Wt(e){We.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",this.fragmentShader="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Gt(){be.call(this),this.type="Camera",this.matrixWorldInverse=new X,this.projectionMatrix=new X,this.projectionMatrixInverse=new X}function qt(e,t,i,r){Gt.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Wt.prototype=Object.create(We.prototype),Wt.prototype.constructor=Wt,Wt.prototype.isShaderMaterial=!0,Wt.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=zt(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this},Wt.prototype.toJSON=function(e){var t=We.prototype.toJSON.call(this,e);for(var i in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var r=this.uniforms[i].value;r&&r.isTexture?t.uniforms[i]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[i]={type:"m4",value:r.toArray()}:t.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var n={};for(var o in this.extensions)!0===this.extensions[o]&&(n[o]=!0);return Object.keys(n).length>0&&(t.extensions=n),t},Gt.prototype=Object.assign(Object.create(be.prototype),{constructor:Gt,isCamera:!0,copy:function(e,t){return be.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new b),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){be.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){be.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),qt.prototype=Object.assign(Object.create(Gt.prototype),{constructor:qt,isPerspectiveCamera:!0,copy:function(e,t){return Gt.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*o.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*o.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*o.RAD2DEG*Math.atan(Math.tan(.5*o.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,r,n,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*o.DEG2RAD*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,s=this.view;if(null!==this.view&&this.view.enabled){var a=s.fullWidth,l=s.fullHeight;n+=s.offsetX*r/a,t-=s.offsetY*i/l,r*=s.width/a,i*=s.height/l}var u=this.filmOffset;0!==u&&(n+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=be.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});function Xt(e,t,i){if(be.call(this),this.type="CubeCamera",!0===i.isWebGLCubeRenderTarget){this.renderTarget=i;var r=new qt(90,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new b(1,0,0)),this.add(r);var n=new qt(90,1,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new b(-1,0,0)),this.add(n);var o=new qt(90,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new b(0,1,0)),this.add(o);var s=new qt(90,1,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new b(0,-1,0)),this.add(s);var a=new qt(90,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new b(0,0,1)),this.add(a);var l=new qt(90,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new b(0,0,-1)),this.add(l),this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var u=e.xr.enabled,c=e.getRenderTarget();e.xr.enabled=!1;var h=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,s),e.setRenderTarget(i,4),e.render(t,a),i.texture.generateMipmaps=h,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(c),e.xr.enabled=u},this.clear=function(e,t,r,n){for(var o=e.getRenderTarget(),s=0;s<6;s++)e.setRenderTarget(i,s),e.clear(t,r,n);e.setRenderTarget(o)}}else console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.")}function Jt(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),m.call(this,e,e,t),this.texture.isWebGLCubeRenderTargetTexture=!0}function Yt(e,t,i,r,n,o,s,a,l,u,c,h){p.call(this,null,o,s,a,l,u,r,n,c,h),this.image={data:e||null,width:t||1,height:i||1},this.magFilter=void 0!==l?l:1003,this.minFilter=void 0!==u?u:1003,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Xt.prototype=Object.create(be.prototype),Xt.prototype.constructor=Xt,Jt.prototype=Object.create(m.prototype),Jt.prototype.constructor=Jt,Jt.prototype.isWebGLCubeRenderTarget=!0,Jt.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=1023,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var i={tEquirect:{value:null}},r="\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",n="\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t",o=new Ut(5,5,5),s=new Wt({name:"CubemapFromEquirect",uniforms:zt(i),vertexShader:r,fragmentShader:n,side:1,blending:0});s.uniforms.tEquirect.value=t;var a=new Dt(o,s),l=t.minFilter;return 1008===t.minFilter&&(t.minFilter=1006),new Xt(1,10,this).update(e,a),t.minFilter=l,a.geometry.dispose(),a.material.dispose(),this},Yt.prototype=Object.create(p.prototype),Yt.prototype.constructor=Yt,Yt.prototype.isDataTexture=!0;var Zt=new I,Qt=new b,Kt=function(e,t,i,r,n,o){this.planes=[void 0!==e?e:new we,void 0!==t?t:new we,void 0!==i?i:new we,void 0!==r?r:new we,void 0!==n?n:new we,void 0!==o?o:new we]};function $t(){var e=null,t=!1,i=null,r=null;function n(t,o){i(t,o),r=e.requestAnimationFrame(n)}return{start:function(){!0!==t&&null!==i&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function ei(e,t){var i=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var i=r.get(t);i&&(e.deleteBuffer(i.buffer),r.delete(t))},update:function(t,n){if(t.isGLBufferAttribute){var o=r.get(t);(!o||o.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var s=r.get(t);void 0===s?r.set(t,function(t,i){var r=t.array,n=t.usage,o=e.createBuffer();e.bindBuffer(i,o),e.bufferData(i,r,n),t.onUploadCallback();var s=5126;return r instanceof Float32Array?s=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?s=5123:r instanceof Int16Array?s=5122:r instanceof Uint32Array?s=5125:r instanceof Int32Array?s=5124:r instanceof Int8Array?s=5120:r instanceof Uint8Array&&(s=5121),{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,n)):s.version<t.version&&(!function(t,r,n){var o=r.array,s=r.updateRange;e.bindBuffer(n,t),r.resizeDirty?(e.bufferData(n,o,r.usage),r.resizeDirty=!1):-1===s.count?e.bufferSubData(n,0,o):(i?e.bufferSubData(n,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):e.bufferSubData(n,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1)}(s.buffer,t,n),s.version=t.version)}}}}Kt.prototype.set=function(e,t,i,r,n,o){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(r),s[4].copy(n),s[5].copy(o),this},Kt.prototype.clone=function(){return(new this.constructor).copy(this)},Kt.prototype.copy=function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},Kt.prototype.setFromProjectionMatrix=function(e){var t=this.planes,i=e.elements,r=i[0],n=i[1],o=i[2],s=i[3],a=i[4],l=i[5],u=i[6],c=i[7],h=i[8],p=i[9],d=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(s-r,c-a,f-h,y-m).normalize(),t[1].setComponents(s+r,c+a,f+h,y+m).normalize(),t[2].setComponents(s+n,c+l,f+p,y+g).normalize(),t[3].setComponents(s-n,c-l,f-p,y-g).normalize(),t[4].setComponents(s-o,c-u,f-d,y-v).normalize(),t[5].setComponents(s+o,c+u,f+d,y+v).normalize(),this},Kt.prototype.intersectsObject=function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Zt.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Zt)},Kt.prototype.intersectsSprite=function(e){return Zt.center.set(0,0,0),Zt.radius=.7071067811865476,Zt.applyMatrix4(e.matrixWorld),this.intersectsSphere(Zt)},Kt.prototype.intersectsSphere=function(e){for(var t=this.planes,i=e.center,r=-e.radius,n=0;n<6;n++){if(t[n].distanceToPoint(i)<r)return!1}return!0},Kt.prototype.intersectsBox=function(e){for(var t=this.planes,i=0;i<6;i++){var r=t[i];if(Qt.x=r.normal.x>0?e.max.x:e.min.x,Qt.y=r.normal.y>0?e.max.y:e.min.y,Qt.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Qt)<0)return!1}return!0},Kt.prototype.containsPoint=function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0};var ti=function(e){function t(t,i,r,n){e.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:i,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new ii(t,i,r,n)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),ii=function(e){function t(t,i,r,n){e.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:i,widthSegments:r,heightSegments:n};for(var o=(t=t||1)/2,s=(i=i||1)/2,a=Math.floor(r)||1,l=Math.floor(n)||1,u=a+1,c=l+1,h=t/a,p=i/l,d=[],f=[],m=[],g=[],v=0;v<c;v++)for(var y=v*p-s,b=0;b<u;b++){var _=b*h-o;f.push(_,-y,0),m.push(0,0,1),g.push(b/a),g.push(1-v/l)}for(var x=0;x<l;x++)for(var E=0;E<a;E++){var w=E+u*x,T=E+u*(x+1),M=E+1+u*(x+1),C=E+1+u*x;d.push(w,T,C),d.push(T,M,C)}this.setIndex(d),this.setAttribute("position",new it(f,3)),this.setAttribute("normal",new it(m,3)),this.setAttribute("uv",new it(g,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),ri={alphamap_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",alphamap_pars_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",alphatest_fragment:"\n#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) {\n\n\t\tdiscard;\n\n\t} else {\n\n\t\t// @THREE-Modification\n\t\t// Prevent alpha test edge gradient\n\t\tdiffuseColor.a = opacity;\n\n\t}\n\n#endif\n",aomap_fragment:"\n#ifdef USE_AOMAP\n\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n\n#endif\n",aomap_pars_fragment:"\n#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif\n",begin_vertex:"\n// @THREE-Modification Cartesian3 to webgl\n#ifdef USE_CARTESIAN3\n    vec3 transformed = czm_converPosition(position);\n#else\n    vec3 transformed = vec3( position );\n#endif\n\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n\n#ifdef USE_TANGENT\n\n\tvec3 objectTangent = vec3( tangent.xyz );\n\n#endif\n",bsdfs:'\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via \'environmentBRDF\' from "Physically Based Shading on Mobile"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n}\n\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\t// this is intended to be used on spot and point lights who are represented as luminous intensity\n\t// but who must be converted to luminous irradiance for surface lighting calculation\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n#else\n\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n#endif\n\n}\n\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\n\t// Original approximation by Christophe Schlick \'94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH \'13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n} // validated\n\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\n\t// See F_Schlick\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\n\treturn Fr * fresnel + F0;\n\n}\n\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (34)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disney’s reparameterization\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\t// geometry term (normalized) = G(l)⋅G(v) / 4(n⋅l)(n⋅v)\n\t// also see #12151\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\n\treturn 1.0 / ( gl * gv );\n\n} // validated\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\t// dotNL and dotNV are explicitly swapped. This is not a mistake.\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disney’s reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\tfloat D = D_GGX( alpha, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\n/*\n\t// alternate method of adjusting for horizon clipping (see referece)\n\t// refactoring required\n\tfloat len = length( vectorFormFactor );\n\tfloat z = vectorFormFactor.z / len;\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\t// tabulated horizon-clipped sphere, apparently...\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\tfloat scale = texture2D( ltc_2, uv ).w;\n\n\tfloat result = len * scale;\n*/\n\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\n\treturn specularColor * brdf.x + brdf.y;\n\n} // validated\n\n// Fdez-Agüera\'s "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; // 1/21\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n\t//float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\t//float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// source: http://simonstechblog.blogspot.ca/2011/12/microfacet-brdf.html\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\n\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n\n#if defined( USE_SHEEN )\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L94\nfloat D_Charlie(float roughness, float NoH) {\n\t// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L136\nfloat V_Neubelt(float NoV, float NoL) {\n\t// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\n\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n\n}\n\n#endif\n',bumpmap_pars_fragment:"\n#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n\t// http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",clipping_planes_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvec4 plane;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\tbool clipped = true;\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t\tif ( clipped ) discard;\n\n\t#endif\n\n#endif\n",clipping_planes_pars_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n\n#endif\n",clipping_planes_pars_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n#endif\n",clipping_planes_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvClipPosition = - mvPosition.xyz;\n\n#endif\n",color_fragment:"\n#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif\n\n// @THREE-Modification\n// add alpha attribute support\n\n#ifdef USE_ALPHAINDEX\n\n\tdiffuseColor.a *= vAlpha;\n\n#endif\n",color_pars_fragment:"\n#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n\n// @THREE-Modification\n// add alpha attribute support\n\n#ifdef USE_ALPHAINDEX\n\n\tvarying float vAlpha;\n\n#endif\n",color_pars_vertex:"\n#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvarying vec3 vColor;\n\n#endif\n\n// @THREE-Modification\n// add alpha attribute support\n\n#ifdef USE_ALPHAINDEX\n\n\tattribute float alphaIndex;\n\tvarying float vAlpha;\n\n#endif\n",color_vertex:"\n#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvColor = vec3( 1.0 );\n\n#endif\n\n#ifdef USE_COLOR\n\n\tvColor.xyz *= color.xyz;\n\n#endif\n\n#ifdef USE_INSTANCING_COLOR\n\n\tvColor.xyz *= instanceColor.xyz;\n\n#endif\n\n// @THREE-Modification\n// add alpha attribute support\n\n#ifdef USE_ALPHAINDEX\n\n\tvAlpha = alphaIndex;\n\n#endif\n\n// @THREE-Modification\n// INSTANCED\n\n#ifdef INSTANCED\n\n\t#ifdef USE_COLOR\n\n\t\tvColor.xyz = instanceColor.xyz;\n\n\t#endif\n\t\n#endif\n\n",common:"\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n// <tonemapping_pars_fragment> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t// dir can be either a direction vector or a normal vector\n\t// upper-left 3x3 of matrix is assumed to be orthogonal\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nmat3 transposeMat3( const in mat3 m ) {\n\n\tmat3 tmp;\n\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\n\treturn tmp;\n\n}\n\n// https://en.wikipedia.org/wiki/Relative_luminance\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\n\treturn dot( weights, color.rgb );\n\n}\n\n// @THREE-Modification Cartesian3 to webgl\nvec3 czm_converPosition( vec3 origin ) {\n   vec3 res = vec3( 0.0 );\n       res.x = -origin.x;\n       res.y = origin.z;\n       res.z = origin.y;\n       return res;\n}\n\n// @THREE-Modification vector applyQuaternion\nvec3 applyQuaternion ( vec3 v, vec4 q ) {\n        float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n\t\tfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\n\t\tfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\n\t\tfloat iw = - q.x * v.x - q.y * v.y - q.z * v.z;\n\t\treturn vec3( ix * q.w + iw * ( -q.x ) + iy * ( -q.z ) - iz * ( -q.y ),\n\t\t            iy * q.w + iw * ( -q.y ) + iz * ( -q.x ) - ix * ( -q.z ),\n\t\t            iz * q.w + iw * ( -q.z ) + ix * ( -q.y ) - iy * ( -q.x ) );\n}\n\nbool isPerspectiveMatrix( mat4 m ) {\n\n\treturn m[ 2 ][ 3 ] == - 1.0;\n\n}\n\nvec2 equirectUv( in vec3 dir ) {\n\n\t// dir is assumed to be unit length\n\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\treturn vec2( u, v );\n\n}\n",cube_uv_reflection_fragment:"\n#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\n\t// These shader functions convert between the UV coordinates of a single face of\n\t// a cubemap, the 0-5 integer index of a cube face, and the direction vector for\n\t// sampling a textureCube (not generally normalized ).\n\n\tfloat getFace( vec3 direction ) {\n\n\t\tvec3 absDirection = abs( direction );\n\n\t\tfloat face = - 1.0;\n\n\t\tif ( absDirection.x > absDirection.z ) {\n\n\t\t\tif ( absDirection.x > absDirection.y )\n\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t} else {\n\n\t\t\tif ( absDirection.z > absDirection.y )\n\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t}\n\n\t\treturn face;\n\n\t}\n\n\t// RH coordinate system; PMREM face-indexing convention\n\tvec2 getUV( vec3 direction, float face ) {\n\n\t\tvec2 uv;\n\n\t\tif ( face == 0.0 ) {\n\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x ); // pos x\n\n\t\t} else if ( face == 1.0 ) {\n\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y ); // pos y\n\n\t\t} else if ( face == 2.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z ); // pos z\n\n\t\t} else if ( face == 3.0 ) {\n\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x ); // neg x\n\n\t\t} else if ( face == 4.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y ); // neg y\n\n\t\t} else {\n\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z ); // neg z\n\n\t\t}\n\n\t\treturn 0.5 * ( uv + 1.0 );\n\n\t}\n\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\n\t\tfloat face = getFace( direction );\n\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\n\t\tfloat faceSize = exp2( mipInt );\n\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\n\t\tvec2 f = fract( uv );\n\n\t\tuv += 0.5 - f;\n\n\t\tif ( face > 2.0 ) {\n\n\t\t\tuv.y += faceSize;\n\n\t\t\tface -= 3.0;\n\n\t\t}\n\n\t\tuv.x += face * faceSize;\n\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\n\t\t}\n\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\n\t\tuv *= texelSize;\n\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.x += texelSize;\n\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.y += texelSize;\n\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.x -= texelSize;\n\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tvec3 tm = mix( tl, tr, f.x );\n\n\t\tvec3 bm = mix( bl, br, f.x );\n\n\t\treturn mix( tm, bm, f.y );\n\n\t}\n\n\t// These defines must match with PMREMGenerator\n\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\n\tfloat roughnessToMip( float roughness ) {\n\n\t\tfloat mip = 0.0;\n\n\t\tif ( roughness >= r1 ) {\n\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\n\t\t} else if ( roughness >= r4 ) {\n\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\n\t\t} else if ( roughness >= r5 ) {\n\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\n\t\t} else if ( roughness >= r6 ) {\n\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\n\t\t} else {\n\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness ); // 1.16 = 1.79^0.25\n\t\t}\n\n\t\treturn mip;\n\n\t}\n\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\n\t\tfloat mipF = fract( mip );\n\n\t\tfloat mipInt = floor( mip );\n\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\n\t\tif ( mipF == 0.0 ) {\n\n\t\t\treturn vec4( color0, 1.0 );\n\n\t\t} else {\n\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\n\t\t}\n\n\t}\n\n#endif\n",defaultnormal_vertex:"\nvec3 transformedNormal = objectNormal;\n\n#ifdef USE_INSTANCING\n\n\t// this is in lieu of a per-instance normal-matrix\n\t// shear transforms in the instance matrix are not supported\n\n\tmat3 m = mat3( instanceMatrix );\n\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\n\ttransformedNormal = m * transformedNormal;\n\n#endif\n\ntransformedNormal = normalMatrix * transformedNormal;\n\n#ifdef FLIP_SIDED\n\n\ttransformedNormal = - transformedNormal;\n\n#endif\n\n#ifdef USE_TANGENT\n\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#ifdef FLIP_SIDED\n\n\t\ttransformedTangent = - transformedTangent;\n\n\t#endif\n\n#endif\n",displacementmap_pars_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",displacementmap_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n\n#endif\n",emissivemap_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n#endif\n",emissivemap_pars_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",encodings_fragment:"\ngl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\n// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\n\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\n\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\n\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\n\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\n\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\n\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n\t// return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\n\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\n\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\t// NOTE: The implementation with min causes the shader to not compile on\n\t// a common Alcatel A502DL in Chrome 78/Android 8.1. Some research suggests \n\t// that the chipset is Mediatek MT6739 w/ IMG PowerVR GE8100 GPU.\n\t// D = min( floor( D ) / 255.0, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\n\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\n\n// M matrix, for encoding\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\n\n// Inverse M matrix, for decoding\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}\n",envmap_fragment:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvec3 cameraToFrag;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\n\t\t}\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\n\t#else\n\n\t\tvec4 envColor = vec4( 0.0 );\n\n\t#endif\n\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\n\t\tenvColor = envMapTexelToLinear( envColor );\n\n\t#endif\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",envmap_common_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif\n",envmap_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n\n#endif\n",envmap_pars_vertex:"\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\n\t#endif\n\n#endif\n",envmap_physical_pars_fragment:"\n#if defined( USE_ENVMAP )\n\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\n\tvec3 getLightProbeIndirectIrradiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in int maxMIPLevel ) {\n\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t\n\t\t// @THREE-Modification\n\t\t#ifdef  ENV_QUATERNION\n\n\t\t\tvec3 newNormal = applyQuaternion(worldNormal, envQuaternion);\n\n\t\t#endif\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\t// @THREE-Modification\n\t\t\t#ifdef  ENV_QUATERNION\n\t\t\t\n\t\t\t\tvec3 queryVec = vec3( flipEnvMap * newNormal.x, newNormal.yz );\n\t\t\t\t\n\t\t\t#else\n\t\t\t\n\t\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t\t\n            #endif\n\n\t\t\t// TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\n\t\t\t// of a specular cubemap, or just the default level of a specially created irradiance cubemap.\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#else\n\n\t\t\t\t// force the bias high to get the last LOD level as it is the most blurred.\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\n\t\t\t// @THREE-Modification\n\t\t\t#ifdef  ENV_QUATERNION\n\t\t\t\n\t\t\t\tvec3 queryVec = newNormal.xyz;\n\t\t\t\t\n\t\t\t#else\n\t\t\t\n\t\t\t\tvec3 queryVec = worldNormal.xyz;\n\t\t\t\t\n            #endif\n    \n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\n\t\t#else\n\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\n\t\t#endif\n\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t}\n\n\t// Trowbridge-Reitz distribution to Mip level, following the logic of http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\n\t\t// clamp to allowable LOD ranges.\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t}\n\n\tvec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\n\t\t\t// Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\n\t\t#endif\n\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\n\t\t// @THREE-Modification\n\t\t#ifdef  ENV_QUATERNION\n\n\t\t\treflectVec = applyQuaternion(reflectVec, envQuaternion);\n\t\t\t\t\n\t\t#endif \n\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\n\t\t#endif\n\n\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t}\n\n#endif\n",envmap_vertex:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvWorldPosition = worldPosition.xyz;\n\n\t#else\n\n\t\tvec3 cameraToVertex;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t\t}\n\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\n\n\tfogDepth = - mvPosition.z;\n\n#endif\n",fog_pars_vertex:"\n#ifdef USE_FOG\n\n\tvarying float fogDepth;\n\n#endif\n",fog_fragment:"\n#ifdef USE_FOG\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\n\t#endif\n\t// @THREE-Modification\n    fogFactor = fogFactor >= fogAlpha ? fogAlpha : fogFactor;\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",fog_pars_fragment:"\n#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t// @THREE-Modification\n\tuniform float fogAlpha;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\n\t#endif\n\n#endif\n",gradientmap_pars_fragment:"\n\n#ifdef USE_GRADIENTMAP\n\n\tuniform sampler2D gradientMap;\n\n#endif\n\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\n\t// dotNL will be from -1.0 to 1.0\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\n\t#ifdef USE_GRADIENTMAP\n\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\n\t#else\n\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\n\t#endif\n\n}\n",lightmap_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity; // factor of PI should not be present; included here to prevent breakage\n\n#endif\n",lightmap_pars_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif\n",lights_lambert_vertex:"\nvec3 diffuse = vec3( 1.0 );\n\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\n\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\n\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n\n#ifdef DOUBLE_SIDED\n\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n\n#endif\n\n#if NUM_POINT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_SPOT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n/*\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\t// TODO (abelnation): implement\n\n\t}\n\n#endif\n*/\n\n#if NUM_DIR_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_HEMI_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n",lights_pars_begin:"\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\n\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\n\t// normal is assumed to have unit length\n\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\n\t// band 0\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\n\t// band 1\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\n\t// band 2\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n\treturn result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n\treturn irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI;\n\n\t#endif\n\n\treturn irradiance;\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\n\t}\n\n#endif\n\n\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\n\t\tif ( angleCos > spotLight.coneCos ) {\n\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\n\t\t} else {\n\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\n\t\t}\n\t}\n\n#endif\n\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\n\t// BRDF approximation Texture is 64x64\n\tuniform sampler2D ltc_1; // RGBA Float\n\tuniform sampler2D ltc_2; // RGBA Float\n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n\n\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tirradiance *= PI;\n\n\t\t#endif\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n",lights_toon_fragment:"\nToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\n",lights_toon_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct ToonMaterial {\n\n\tvec3 diffuseColor;\n\n};\n\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_phong_fragment:"\nBlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct BlinnPhongMaterial {\n\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"\nPhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\n\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\n\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\nmaterial.specularFactor = specularFactor; // @THREE-Modification add specular factor for physical material\n\n#ifdef REFLECTIVITY\n\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\n#else\n\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n\n#endif\n\n#ifdef CLEARCOAT\n\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\n\t#ifdef USE_CLEARCOATMAP\n\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\n\t#endif\n\n\tmaterial.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model\n\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n\n#endif\n\n#ifdef USE_SHEEN\n\n\tmaterial.sheenColor = sheen;\n\n#endif\n",lights_physical_pars_fragment:"\nstruct PhysicalMaterial {\n\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tfloat specularFactor; // @THREE-Modification add specular factor for physical material\n\tvec3 specularColor;\n\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n\n};\n\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n// Clear coat directional hemishperical reflectance (this approximation should be improved)\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction\n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\n\t\t// LTC Fresnel Approximation by Stephen Hill\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tccIrradiance *= PI; // punctual light\n\n\t\t#endif\n\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += material.specularFactor * ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness); // @THREE-Modification add specular factor for physical material\n\t#endif\n\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\n\t// Both indirect specular and indirect diffuse light accumulate here\n\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n",lights_fragment_begin:"\n/**\n * This is a template that can be used to light a material, it uses pluggable\n * RenderEquations (RE)for specific lighting scenarios.\n *\n * Instructions for use:\n * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n *\n * TODO:\n * - Add area light support.\n * - Add sphere light support.\n * - Add diffuse light probe (irradiance cubemap) support.\n */\n\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n#ifdef CLEARCOAT\n\n\tgeometry.clearcoatNormal = clearcoatNormal;\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_fragment_maps:"\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\n\n\t\t#endif\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, maxMipLevel );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\tradiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\n\t#ifdef CLEARCOAT\n\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\n\t#endif\n\n#endif\n",lights_fragment_end:"\n#if defined( RE_IndirectDiffuse )\n\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n\n#endif\n",logdepthbuf_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\t// Doing a strict comparison with == 1.0 can cause noise artifacts\n\t// on some platforms. See issue #17623.\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n#endif\n",logdepthbuf_pars_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n\n#endif\n",logdepthbuf_pars_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tuniform float logDepthCameraNear; // @THREE-Modification modify log depth encoding\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\n\t#else\n\n\t\tuniform float logDepthBufFC;\n\t\tuniform float logDepthCameraNear; // @THREE-Modification modify log depth encoding\n\n\t#endif\n\n#endif\n",logdepthbuf_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t// @THREE-Modification modify log depth encoding\n\t\tvFragDepth = 1.0 + gl_Position.w - logDepthCameraNear;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\n\t#else\n\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\n\t\t\t// @THREE-Modification modify log depth encoding\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w - logDepthCameraNear + 1.0 ) ) * logDepthBufFC - 1.0;\n\n\t\t\tgl_Position.z *= gl_Position.w;\n\n\t\t}\n\n\t#endif\n\n#endif\n",map_fragment:"\n#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\n#endif\n",map_pars_fragment:"\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",map_particle_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_MAP\n\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n\n#endif\n",map_particle_pars_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tuniform mat3 uvTransform;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",metalnessmap_fragment:"\nfloat metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n",metalnessmap_pars_fragment:"\n#ifdef USE_METALNESSMAP\n\n\tuniform sampler2D metalnessMap;\n\n#endif\n",morphnormal_vertex:"\n#ifdef USE_MORPHNORMALS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\n#endif\n",morphtarget_pars_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\tuniform float morphTargetBaseInfluence;\n\n\t#ifndef USE_MORPHNORMALS\n\n\t\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\t\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif\n",morphtarget_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",normal_fragment_begin:"\n#ifdef FLAT_SHADED\n\n\t// Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\t#ifdef USE_TANGENT\n\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n\n// non perturbed normal for clearcoat among others\n\nvec3 geometryNormal = normal;\n\n",normal_fragment_maps:"\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n\t#ifdef FLIP_SIDED\n\n\t\tnormal = - normal;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\tnormal = normalize( normalMatrix * normal );\n\n#elif defined( TANGENTSPACE_NORMALMAP )\n\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tnormal = normalize( vTBN * mapN );\n\n\t#else\n\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\n\t#endif\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n",normalmap_pars_fragment:"\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n#endif\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tuniform mat3 normalMatrix;\n\n#endif\n\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tmat3 tsn = mat3( S, T, N );\n\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",clearcoat_normal_fragment_begin:"\n#ifdef CLEARCOAT\n\n\tvec3 clearcoatNormal = geometryNormal;\n\n#endif\n",clearcoat_normal_fragment_maps:"\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\n\t#else\n\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\n\t#endif\n\n#endif\n",clearcoat_pars_fragment:"\n\n#ifdef USE_CLEARCOATMAP\n\n\tuniform sampler2D clearcoatMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform sampler2D clearcoatRoughnessMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n\n#endif\n",packing:"\nvec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\n\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\n\n// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions\n\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"\n#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",project_vertex:"\nvec4 mvPosition = vec4( transformed, 1.0 );\n\n#ifdef USE_INSTANCING\n\n\tmvPosition = instanceMatrix * mvPosition;\n\n#endif\n\nmvPosition = modelViewMatrix * mvPosition;\n\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"\n#ifdef DITHERING\n\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n\n#endif\n",dithering_pars_fragment:"\n#ifdef DITHERING\n\n\t// based on https://www.shadertoy.com/view/MslGR8\n\tvec3 dithering( vec3 color ) {\n\t\t//Calculate grid position\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\n\t\t//modify shift acording to grid position.\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\n\t\t//shift the color by dither_shift\n\t\treturn color + dither_shift_RGB;\n\t}\n\n#endif\n",roughnessmap_fragment:"\nfloat roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n",roughnessmap_pars_fragment:"\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif\n",shadowmap_pars_fragment:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): create uniforms for area light shadows\n\n\t#endif\n\t*/\n\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n\t}\n\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n\t}\n\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n\t\tfloat occlusion = 1.0;\n\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\n\t\tfloat hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n\t\tif (hard_shadow != 1.0 ) {\n\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n\t\t}\n\t\treturn occlusion;\n\n\t}\n\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\n\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#else // no percentage-closer filtering:\n\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#endif\n\n\t\t}\n\n\t\treturn shadow;\n\n\t}\n\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\n\t// 2D texture:\n\t//\n\t// xzXZ\n\t//  y Y\n\t//\n\t// Y - Positive y direction\n\t// y - Negative y direction\n\t// X - Positive x direction\n\t// x - Negative x direction\n\t// Z - Positive z direction\n\t// z - Negative z direction\n\t//\n\t// Source and test bed:\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\t\t// Number of texels to avoid at the edge of each square\n\n\t\tvec3 absV = abs( v );\n\n\t\t// Intersect unit cube\n\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\n\t\t// Apply scale to avoid seams\n\n\t\t// two texels less per square (one texel will do for NEAREST)\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\t\t// Unwrap\n\n\t\t// space: -1 ... 1 range for each square\n\t\t//\n\t\t// #X##\t\tdim    := ( 4 , 2 )\n\t\t//  # #\t\tcenter := ( 1 , 1 )\n\n\t\tvec2 planar = v.xy;\n\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\tif ( absV.z >= almostOne ) {\n\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t}\n\n\t\t// Transform to UV space\n\n\t\t// scale := 0.5 / dim\n\t\t// translate := ( center + 0.5 ) / dim\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t}\n\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\n\t\t// the vector from the light to the world-space position of the fragment.\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\n\t\t// dp = normalized distance from light to fragment position\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n\t\tdp += shadowBias;\n\n\t\t// bd3D = base direction 3D\n\t\tvec3 bd3D = normalize( lightToPosition );\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#else // no percentage-closer filtering\n\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n\t\t#endif\n\n\t}\n\n#endif\n",shadowmap_pars_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): uniforms for area light shadows\n\n\t#endif\n\t*/\n\n#endif\n",shadowmap_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\t// Offsetting the position used for querying occlusion along the world normal can be used to reduce shadow acne.\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\n\t#endif\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update vAreaShadowCoord with area light info\n\n\t#endif\n\t*/\n\n#endif\n",shadowmask_pars_fragment:"\nfloat getShadowMask() {\n\n\tfloat shadow = 1.0;\n\n\t#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\tDirectionalLightShadow directionalLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\tSpotLightShadow spotLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\tPointLightShadow pointLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update shadow for Area light\n\n\t#endif\n\t*/\n\n\t#endif\n\n\treturn shadow;\n\n}\n",skinbase_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif\n",skinning_pars_vertex:"\n#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t// @THREE-Modification\n\tuniform mat4 localBindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",skinning_vertex:"\n#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\n\t// @THREE-Modification\n\t// transformed = ( bindMatrixInverse * skinned ).xyz;\n\ttransformed = ( localBindMatrixInverse * skinned ).xyz;\n\n#endif\n",skinnormal_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n\t#ifdef USE_TANGENT\n\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#endif\n\n#endif\n",specularmap_fragment:"\nfloat specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif\n",specularmap_pars_fragment:"\n#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif\n",tonemapping_fragment:"\n#if defined( TONE_MAPPING )\n\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",tonemapping_pars_fragment:"\n#ifndef saturate\n// <common> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n\nuniform float toneMappingExposure;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n\treturn toneMappingExposure * color;\n\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n\n// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs\nvec3 RRTAndODTFit( vec3 v ) {\n\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n\n}\n\n// this implementation of ACES is modified to accommodate a brighter viewing environment.\n// the scale factor of 1/0.6 is subjective. see discussion in #19621.\n\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\n\t// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ), // transposed from source\n\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\n\t// ODT_SAT => XYZ => D60_2_D65 => sRGB\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ), // transposed from source\n\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\n\tcolor *= toneMappingExposure / 0.6;\n\n\tcolor = ACESInputMat * color;\n\n\t// Apply RRT and ODT\n\tcolor = RRTAndODTFit( color );\n\n\tcolor = ACESOutputMat * color;\n\n\t// Clamp to [0, 1]\n\treturn saturate( color );\n\n}\n\nvec3 CustomToneMapping( vec3 color ) { return color; }\n",transmissionmap_fragment:"\n#ifdef USE_TRANSMISSIONMAP\n\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n\n#endif\n",transmissionmap_pars_fragment:"\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform sampler2D transmissionMap;\n\n#endif\n",uv_pars_fragment:"\n#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\n\tvarying vec2 vUv;\n\n#endif\n",uv_pars_vertex:"\n#ifdef USE_UV\n\n\t#ifdef UVS_VERTEX_ONLY\n\n\t\tvec2 vUv;\n\n\t#else\n\n\t\tvarying vec2 vUv;\n\n\t#endif\n\n\tuniform mat3 uvTransform;\n\n#endif\n",uv_vertex:"\n#ifdef USE_UV\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n#endif\n",uv2_pars_fragment:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif\n",uv2_pars_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n\tuniform mat3 uv2Transform;\n\n#endif\n",uv2_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n\n#endif\n",worldpos_vertex:"\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t#ifdef USE_INSTANCING\n\n\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t#endif\n\n\tworldPosition = modelMatrix * worldPosition;\n\n#endif\n",colormapping_fragment:"\n  #ifdef COLOR_MAPPING\n    float gray = clamp( dot( diffuseColor.rgb, vec3(0.333, 0.333, 0.333) ), 0.0, 1.0 );\n    diffuseColor.rgb = mix( diffuseColor.rgb, texture2D( colorMapping, vec2( gray, 0.5 ) ).rgb, colorMappingIntensity );\n  #endif\n",colormapping_pars_fragment:"\n  #ifdef COLOR_MAPPING\n    uniform sampler2D colorMapping;\n    uniform float colorMappingIntensity;\n  #endif\n",env_quaternion_pars_fragment:"\n  #ifdef ENV_QUATERNION\n    uniform vec4 envQuaternion;\n  #endif\n",background_frag:"\nuniform sampler2D t2D;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texColor = texture2D( t2D, vUv );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",background_vert:"\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\nvoid main() {\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n\n}\n",cube_frag:"\n#include <envmap_common_pars_fragment>\nuniform float opacity;\n\n// @THREE-Modification\nuniform mat4 colorMatrix;\n\nvarying vec3 vWorldDirection;\n\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\n\t// @THREE-Modification\n\tgl_FragColor = colorMatrix * envColor;\n\tgl_FragColor.a *= opacity;\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",cube_vert:"\n// @THREE-Modification\nuniform vec4 cubeQuat;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 cubeDir = transformDirection( position, modelMatrix );\n\tvWorldDirection = applyQuaternion( cubeDir, cubeQuat ); // @THREE-Modification\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",depth_frag:"\n// @THREE-Modification\n// Alpha test use opacity\n#if DEPTH_PACKING == 3200 || defined(ALPHATEST)\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\t// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\n\t#endif\n\n}\n",depth_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n// This is used for computing an equivalent of gl_FragCoord.z that is as high precision as possible.\n// Some platforms compute gl_FragCoord at a lower precision which makes the manually computed value better for\n// depth-based postprocessing effects. Reproduced on iPad with A10 processor / iPadOS 13.3.1.\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\n\t// @THREE-Modification\n\t// position instanced\n\t#ifdef INSTANCED\n\t\tmat4 instanceMat = compose(instancePosition, instanceQuaternion, instanceScale);\n\t\ttransformed.xyz = (instanceMat * vec4(transformed, 1.0)).xyz;\n\t#endif\n\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvHighPrecisionZW = gl_Position.zw;\n\n}\n",distanceRGBA_frag:"\n// @THREE-Modification\n// Alpha test use opacity\n#ifdef ALPHATEST\n\n\tuniform float opacity;\n\n#endif\n\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n",distanceRGBA_vert:"\n#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvWorldPosition = worldPosition.xyz;\n\n}\n",equirect_frag:"\nuniform sampler2D tEquirect;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 direction = normalize( vWorldDirection );\n\n\tvec2 sampleUV = equirectUv( direction );\n\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",equirect_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n}\n",linedashed_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; // simple shader\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",linedashed_vert:"\nuniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvLineDistance = scale * lineDistance;\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",meshbasic_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n// @THREE-Modification Add emissive support for basic material\nuniform vec3 emissive;\nuniform vec3 highlightColor; // @THREE-Modification highlight color\nuniform float highlightIntensity; // @THREE-Modification highlight color\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n// @THREE-Modification\n#include <colormapping_pars_fragment>\n// @THREE-Modification Add emissive support for basic material\n#include <emissivemap_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\t// @THREE-Modification\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t// @THREE-Modification Add emissive support for basic material\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\t// @THREE-Modification Add emissive support for basic material\n\t#include <emissivemap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse + totalEmissiveRadiance; // @THREE-Modification Add emissive support for basic material\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n\t// @THREE-Modification highlight color\n\tgl_FragColor.rgb = gl_FragColor.rgb * ( 1.0 - highlightIntensity ) + highlightColor * highlightIntensity;\n}\n",meshbasic_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\n\t// @THREE-Modification\n\t// normal instanced\n\t#ifdef INSTANCED\n\t\tmat4 instanceMat = compose( instancePosition, instanceQuaternion, instanceScale );\n\t#endif\n\n\t#ifdef USE_ENVMAP\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\n\t// @THREE-Modification\n\t// normal instanced\n\t#ifdef INSTANCED\n\n\t\tmat3 im = mat3( instanceMat );\n\t\tobjectNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\t\tobjectNormal = im * objectNormal;\n\n\t#endif\n\n\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\n\t// @THREE-Modification\n\t// position instanced\n\t#ifdef INSTANCED\n\t\ttransformed.xyz = ( instanceMat * vec4( transformed, 1.0 ) ).xyz;\n\t#endif\n\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshlambert_frag:"\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\nuniform vec3 highlightColor; // @THREE-Modification highlight color\nuniform float highlightIntensity; // @THREE-Modification highlight color\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n// @THREE-Modification\n#include <colormapping_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\t// @THREE-Modification\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\n\t#endif\n\n\t#include <lightmap_fragment>\n\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\n\t#else\n\n\t\treflectedLight.directDiffuse = vLightFront;\n\n\t#endif\n\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\n\t// modulation\n\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n\t// @THREE-Modification highlight color\n\tgl_FragColor.rgb = gl_FragColor.rgb * ( 1.0 - highlightIntensity ) + highlightColor * highlightIntensity;\n}\n",meshlambert_vert:"\n#define LAMBERT\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\n\t// @THREE-Modification\n\t// normal instanced\n\t#ifdef INSTANCED\n\n\t\tmat4 instanceMat = compose( instancePosition, instanceQuaternion, instanceScale );\n\t\tmat3 im = mat3( instanceMat );\n\t\tobjectNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\t\tobjectNormal = im * objectNormal;\n\n\t#endif\n\n\t#include <defaultnormal_vertex>\n\n\t#include <begin_vertex>\n\n\t// @THREE-Modification\n\t// position instanced\n\t#ifdef INSTANCED\n\t\ttransformed.xyz = ( instanceMat * vec4( transformed, 1.0 ) ).xyz;\n\t#endif\n\t\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshmatcap_frag:"\n#define MATCAP\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n\t#ifdef USE_MATCAP\n\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\n\t#else\n\n\t\tvec4 matcapColor = vec4( 1.0 );\n\n\t#endif\n\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshmatcap_vert:"\n#define MATCAP\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\t\tvNormal = normalize( transformedNormal );\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n}\n",meshtoon_frag:"\n#define TOON\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshtoon_vert:"\n#define TOON\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphong_frag:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\nuniform vec3 highlightColor; // @THREE-Modification highlight color\nuniform float highlightIntensity; // @THREE-Modification highlight color\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n// @THREE-Modification\n#include <colormapping_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\t// @THREE-Modification\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n\t// @THREE-Modification highlight color\n\tgl_FragColor.rgb = gl_FragColor.rgb * ( 1.0 - highlightIntensity ) + highlightColor * highlightIntensity;\n\n}\n",meshphong_vert:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphysical_frag:"\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float specularFactor; // @THREE-Modification add specular factor for physical material\nuniform vec3 highlightColor; // @THREE-Modification highlight color\nuniform float highlightIntensity; // @THREE-Modification highlight color\n\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n\n// @THREE-Modification\n#include <env_quaternion_pars_fragment>\n\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n// @THREE-Modification\n#include <colormapping_pars_fragment>\n\n// @THREE-Modification fresnel\n#ifdef FRESNEL\n\tuniform float fresnelPower;\n\tuniform bool fresnelInverse;\n#endif\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\t// @THREE-Modification\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t// this is a stub for the transmission model\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t// @THREE-Modification fresnel\n\t#ifdef FRESNEL\n\t\tif (fresnelInverse) {\n\t\t\tgl_FragColor.a *= pow( abs( dot( normal, vec3(0., 0., 1.) ) ), fresnelPower );\n\t\t} else {\n\t\t\tgl_FragColor.a *= pow( 1.0 - abs( dot( normal, vec3(0., 0., 1.) ) ), fresnelPower );\n\t\t}\n\t#endif\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n\t// @THREE-Modification highlight color\n\tgl_FragColor.rgb = gl_FragColor.rgb * ( 1.0 - highlightIntensity ) + highlightColor * highlightIntensity;\n\n}\n",meshphysical_vert:"\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\n\t// @THREE-Modification\n\t// normal instanced\n\t#ifdef INSTANCED\n\n\t\tmat4 instanceMat = compose( instancePosition, instanceQuaternion, instanceScale );\n\t\tmat3 im = mat3( instanceMat );\n\t\tobjectNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\t\tobjectNormal = im * objectNormal;\n\n\t#endif\n\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\n\t// @THREE-Modification\n\t// position instanced\n\t#ifdef INSTANCED\n\t\ttransformed.xyz = ( instanceMat * vec4( transformed, 1.0 ) ).xyz;\n\t#endif\n\t\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",normal_frag:"\n#define NORMAL\n\nuniform float opacity;\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\n}\n",normal_vert:"\n#define NORMAL\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvViewPosition = - mvPosition.xyz;\n\n#endif\n\n}\n",points_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",points_vert:"\nuniform float size;\nuniform float scale;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\n\tgl_PointSize = size;\n\n\t#ifdef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\n\t#endif\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n\n}\n",shadow_frag:"\nuniform vec3 color;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",shadow_vert:"\n#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n\nvoid main() {\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",sprite_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",sprite_vert:"\nuniform float rotation;\nuniform vec2 center;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n\t#ifndef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\n\t#endif\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n"},ni={common:{diffuse:{value:new ze(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new u},uvTransform1:{value:new u},uvTransform2:{value:new u},uv2Transform:{value:new u},alphaMap:{value:null},alphaMap1:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new s(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ze(16777215)},fogAlpha:{value:1}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ze(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new u}},sprite:{diffuse:{value:new ze(15658734)},opacity:{value:1},center:{value:new s(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new u}}},oi={basic:{uniforms:Ht([ni.common,ni.specularmap,ni.envmap,ni.aomap,ni.lightmap,ni.emissivemap,ni.fog,{emissive:{value:new ze(0)},highlightColor:{value:new ze(0)},highlightIntensity:{value:0}}]),vertexShader:ri.meshbasic_vert,fragmentShader:ri.meshbasic_frag},lambert:{uniforms:Ht([ni.common,ni.specularmap,ni.envmap,ni.aomap,ni.lightmap,ni.emissivemap,ni.fog,ni.lights,{emissive:{value:new ze(0)},highlightColor:{value:new ze(0)},highlightIntensity:{value:0}}]),vertexShader:ri.meshlambert_vert,fragmentShader:ri.meshlambert_frag},phong:{uniforms:Ht([ni.common,ni.specularmap,ni.envmap,ni.aomap,ni.lightmap,ni.emissivemap,ni.bumpmap,ni.normalmap,ni.displacementmap,ni.fog,ni.lights,{emissive:{value:new ze(0)},highlightColor:{value:new ze(0)},highlightIntensity:{value:0},specular:{value:new ze(1118481)},shininess:{value:30}}]),vertexShader:ri.meshphong_vert,fragmentShader:ri.meshphong_frag},standard:{uniforms:Ht([ni.common,ni.envmap,ni.aomap,ni.lightmap,ni.emissivemap,ni.bumpmap,ni.normalmap,ni.displacementmap,ni.roughnessmap,ni.metalnessmap,ni.fog,ni.lights,{emissive:{value:new ze(0)},roughness:{value:1},metalness:{value:0},specularFactor:{value:1},highlightColor:{value:new ze(0)},highlightIntensity:{value:0},envMapIntensity:{value:1}}]),vertexShader:ri.meshphysical_vert,fragmentShader:ri.meshphysical_frag},toon:{uniforms:Ht([ni.common,ni.aomap,ni.lightmap,ni.emissivemap,ni.bumpmap,ni.normalmap,ni.displacementmap,ni.gradientmap,ni.fog,ni.lights,{emissive:{value:new ze(0)}}]),vertexShader:ri.meshtoon_vert,fragmentShader:ri.meshtoon_frag},matcap:{uniforms:Ht([ni.common,ni.bumpmap,ni.normalmap,ni.displacementmap,ni.fog,{matcap:{value:null}}]),vertexShader:ri.meshmatcap_vert,fragmentShader:ri.meshmatcap_frag},points:{uniforms:Ht([ni.points,ni.fog]),vertexShader:ri.points_vert,fragmentShader:ri.points_frag},dashed:{uniforms:Ht([ni.common,ni.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ri.linedashed_vert,fragmentShader:ri.linedashed_frag},depth:{uniforms:Ht([ni.common,ni.displacementmap]),vertexShader:ri.depth_vert,fragmentShader:ri.depth_frag},normal:{uniforms:Ht([ni.common,ni.bumpmap,ni.normalmap,ni.displacementmap,{opacity:{value:1}}]),vertexShader:ri.normal_vert,fragmentShader:ri.normal_frag},sprite:{uniforms:Ht([ni.sprite,ni.fog]),vertexShader:ri.sprite_vert,fragmentShader:ri.sprite_frag},background:{uniforms:{uvTransform:{value:new u},t2D:{value:null}},vertexShader:ri.background_vert,fragmentShader:ri.background_frag},cube:{uniforms:Ht([ni.envmap,{opacity:{value:1},colorMatrix:{value:new X},cubeQuat:{value:new d}}]),vertexShader:ri.cube_vert,fragmentShader:ri.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ri.equirect_vert,fragmentShader:ri.equirect_frag},distanceRGBA:{uniforms:Ht([ni.common,ni.displacementmap,{referencePosition:{value:new b},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ri.distanceRGBA_vert,fragmentShader:ri.distanceRGBA_frag},shadow:{uniforms:Ht([ni.lights,ni.fog,{color:{value:new ze(0)},opacity:{value:1}}]),vertexShader:ri.shadow_vert,fragmentShader:ri.shadow_frag}};function si(e,t,i,r,n){var o,s,a=new ze(0),l=0,u=null,c=0,h=null;function p(e,t){i.buffers.color.setClear(e.r,e.g,e.b,t,n)}return{getClearColor:function(){return a},setClearColor:function(e,t){a.set(e),p(a,l=void 0!==t?t:1)},getClearAlpha:function(){return l},setClearAlpha:function(e){p(a,l=e)},render:function(i,n,d,f){var m,g,v=!0===n.isScene?n.background:null;v&&v.isTexture&&(m=v.colorMatrix,g=v.baseQuaternion,v=t.get(v));var y=e.xr,b=y.getSession&&y.getSession();b&&"additive"===b.environmentBlendMode&&(v=null),null===v?p(a,l):v&&v.isColor&&(p(v,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&(v.isCubeTexture||v.isWebGLCubeRenderTarget||v.isWebGLCubeRenderTargetTexture||306===v.mapping)?(void 0===s&&((s=new Dt(new Ut(1,1,1),new Wt({name:"BackgroundCubeMaterial",uniforms:zt(oi.cube.uniforms),vertexShader:oi.cube.vertexShader,fragmentShader:oi.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(s)),v.isWebGLCubeRenderTarget&&(v=v.texture),s.material.uniforms.envMap.value=v,s.material.uniforms.flipEnvMap.value=v.isCubeTexture?-1:1,m?s.material.uniforms.colorMatrix.value.copy(m):s.material.uniforms.colorMatrix.value.identity(),g?s.material.uniforms.cubeQuat.value.copy(g):s.material.uniforms.cubeQuat.value.set(0,0,0,1),i.custom1.length?s.renderLayer=1:s.renderLayer=null,u===v&&c===v.version&&h===e.toneMapping||(s.material.needsUpdate=!0,u=v,c=v.version,h=e.toneMapping),i.unshift(s,s.geometry,s.material,0,0,null)):v&&v.isTexture&&(void 0===o&&((o=new Dt(new ii(2,2),new Wt({name:"BackgroundMaterial",uniforms:zt(oi.background.uniforms),vertexShader:oi.background.vertexShader,fragmentShader:oi.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=v,!0===v.matrixAutoUpdate&&v.updateMatrix(),o.material.uniforms.uvTransform.value.copy(v.matrix),i.custom1.length?o.renderLayer=1:o.renderLayer=null,u===v&&c===v.version&&h===e.toneMapping||(o.material.needsUpdate=!0,u=v,c=v.version,h=e.toneMapping),i.unshift(o,o.geometry,o.material,0,0,null))}}}function ai(e,t,i,r){var n=e.getParameter(34921),o=r.isWebGL2?null:t.get("OES_vertex_array_object"),s=r.isWebGL2||null!==o,a={},l=p(null),u=l;function c(t){return r.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function h(t){return r.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function p(e){for(var t=[],i=[],r=[],o=0;o<n;o++)t[o]=0,i[o]=0,r[o]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:r,object:e,attributes:{},index:null}}function d(){for(var e=u.newAttributes,t=0,i=e.length;t<i;t++)e[t]=0}function f(e){m(e,0)}function m(i,n){var o=u.newAttributes,s=u.enabledAttributes,a=u.attributeDivisors;(o[i]=1,0===s[i]&&(e.enableVertexAttribArray(i),s[i]=1),a[i]!==n)&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,n),a[i]=n)}function g(){for(var t=u.newAttributes,i=u.enabledAttributes,r=0,n=i.length;r<n;r++)i[r]!==t[r]&&(e.disableVertexAttribArray(r),i[r]=0)}function v(t,i,n,o,s,a){!0!==r.isWebGL2||5124!==n&&5125!==n?e.vertexAttribPointer(t,i,n,o,s,a):e.vertexAttribIPointer(t,i,n,s,a)}function y(){b(),u!==l&&c((u=l).object)}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(n,l,h,y,b){var _=!1;if(s){var x=function(t,i,n){var s=!0===n.wireframe,l=a[t.id];void 0===l&&(l={},a[t.id]=l);var u=l[i.id];void 0===u&&(u={},l[i.id]=u);var c=u[s];void 0===c&&(c=p(function(){if(r.isWebGL2)return e.createVertexArray();return o.createVertexArrayOES()}()),u[s]=c);return c}(y,h,l);u!==x&&c((u=x).object),(_=function(e,t){var i=u.attributes,r=e.attributes;if(Object.keys(i).length!==Object.keys(r).length)return!0;for(var n in r){var o=i[n],s=r[n];if(void 0===o)return!0;if(o.attribute!==s)return!0;if(o.data!==s.data)return!0}if(u.index!==t)return!0;return!1}(y,b))&&function(e,t){var i={},r=e.attributes;for(var n in r){var o=r[n],s={};s.attribute=o,o.data&&(s.data=o.data),i[n]=s}u.attributes=i,u.index=e.index,u.index=t}(y,b)}else{var E=!0===l.wireframe;u.geometry===y.id&&u.program===h.id&&u.wireframe===E||(u.geometry=y.id,u.program=h.id,u.wireframe=E,_=!0)}!0===n.isInstancedMesh&&(_=!0),null!==b&&i.update(b,34963),_&&(!function(n,o,s,a){if(!1===r.isWebGL2&&(n.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;d();var l=a.attributes,u=s.getAttributes(),c=o.defaultAttributeValues;for(var h in u){var p=u[h];if(p>=0){var y=l[h];if(void 0!==y){var b=y.normalized,_=y.itemSize,x=i.get(y);if(void 0===x)continue;var E=x.buffer,w=x.type,T=x.bytesPerElement;if(y.isInterleavedBufferAttribute){var M=y.data,C=M.stride,S=y.offset;M&&M.isInstancedInterleavedBuffer?(m(p,M.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=M.meshPerAttribute*M.count)):f(p),e.bindBuffer(34962,E),v(p,_,w,b,C*T,S*T)}else y.isInstancedBufferAttribute?(m(p,y.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=y.meshPerAttribute*y.count)):f(p),e.bindBuffer(34962,E),v(p,_,w,b,0,0)}else if("instanceMatrix"===h){var j=i.get(n.instanceMatrix);if(void 0===j)continue;var P=j.buffer,R=j.type;m(p+0,1),m(p+1,1),m(p+2,1),m(p+3,1),e.bindBuffer(34962,P),e.vertexAttribPointer(p+0,4,R,!1,64,0),e.vertexAttribPointer(p+1,4,R,!1,64,16),e.vertexAttribPointer(p+2,4,R,!1,64,32),e.vertexAttribPointer(p+3,4,R,!1,64,48)}else if("instanceColor"===h){var D=i.get(n.instanceColor);if(void 0===D)continue;var A=D.buffer,k=D.type;m(p,1),e.bindBuffer(34962,A),e.vertexAttribPointer(p,3,k,!1,12,0)}else if(void 0!==c){var O=c[h];if(void 0!==O)switch(O.length){case 2:e.vertexAttrib2fv(p,O);break;case 3:e.vertexAttrib3fv(p,O);break;case 4:e.vertexAttrib4fv(p,O);break;default:e.vertexAttrib1fv(p,O)}}}}g()}(n,l,h,y),null!==b&&e.bindBuffer(34963,i.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){for(var e in y(),a){var t=a[e];for(var i in t){var r=t[i];for(var n in r)h(r[n].object),delete r[n];delete t[i]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0!==a[e.id]){var t=a[e.id];for(var i in t){var r=t[i];for(var n in r)h(r[n].object),delete r[n];delete t[i]}delete a[e.id]}},releaseStatesOfProgram:function(e){for(var t in a){var i=a[t];if(void 0!==i[e.id]){var r=i[e.id];for(var n in r)h(r[n].object),delete r[n];delete i[e.id]}}},initAttributes:d,enableAttribute:f,disableUnusedAttributes:g}}function li(e,t,i,r){var n,o=r.isWebGL2;this.setMode=function(e){n=e},this.render=function(t,r){e.drawArrays(n,t,r),i.update(r,n,1)},this.renderInstances=function(r,s,a){if(0!==a){var l,u;if(o)l=e,u="drawArraysInstanced";else if(u="drawArraysInstancedANGLE",null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[u](n,r,s,a),i.update(s,n,a)}}}function ui(e,t,i){var r;function n(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,s=void 0!==i.precision?i.precision:"highp",a=n(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);var l=!0===i.logarithmicDepthBuffer,u=e.getParameter(34930),c=e.getParameter(35660),h=e.getParameter(3379),p=e.getParameter(34076),d=e.getParameter(34921),f=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),v=c>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;var i=t.get("EXT_texture_filter_anisotropic");return r=null!==i?e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:s,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:p,maxAttributes:d,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?e.getParameter(36183):0}}function ci(e){var t=this,i=null,r=0,n=!1,o=!1,s=new we,a=new u,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function h(e,i,r,n){var o=null!==e?e.length:0,u=null;if(0!==o){if(u=l.value,!0!==n||null===u){var c=r+4*o,h=i.matrixWorldInverse;a.getNormalMatrix(h),(null===u||u.length<c)&&(u=new Float32Array(c));for(var p=0,d=r;p!==o;++p,d+=4)s.copy(e[p]).applyMatrix4(h,a),s.normal.toArray(u,d),u[d+3]=s.constant}l.value=u,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){var s=0!==e.length||t||0!==r||n;return n=t,i=h(e,o,0),r=e.length,s},this.beginShadows=function(){o=!0,h(null)},this.endShadows=function(){o=!1,c()},this.setState=function(t,s,a){var u=t.clippingPlanes,p=t.clipIntersection,d=t.clipShadows,f=e.get(t);if(!n||null===u||0===u.length||o&&!d)o?h(null):c();else{var m=o?0:r,g=4*m,v=f.clippingState||null;l.value=v,v=h(u,s,g,a);for(var y=0;y!==g;++y)v[y]=i[y];f.clippingState=v,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=m}}}function hi(e){var t=new WeakMap;function i(e,t){return 303===t?e.mapping=301:304===t&&(e.mapping=302),e}return{get:function(r){if(r&&r.isTexture){var n=r.mapping;if(303===n||304===n){if(t.has(r))return i(t.get(r).texture,r.mapping);var o=r.image;if(o&&o.height>0){var s=e.getRenderList(),a=e.getRenderTarget(),l=e.getRenderState(),u=new Jt(o.height/2);return u.fromEquirectangularTexture(e,r),t.set(r,u),e.setRenderTarget(a),e.setRenderList(s),e.setRenderState(l),i(u.texture,r.mapping)}return null}}return r},dispose:function(){t=new WeakMap}}}function pi(e){var t={};return{has:function(i){if(void 0!==t[i])return null!==t[i];var r;switch(i){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(i)}return t[i]=r,null!==r},get:function(e){return this.has(e)||console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t[e]}}}function di(e,t,i,r){var n=new WeakMap,o=new WeakMap;function s(e){var a=e.target,l=n.get(a);for(var u in null!==l.index&&t.remove(l.index),l.attributes)t.remove(l.attributes[u]);a.removeEventListener("dispose",s),n.delete(a);var c=o.get(l);c&&(t.remove(c),o.delete(l)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(e){var i=[],r=e.index,n=e.attributes.position,s=0;if(null!==r){var a=r.array;s=r.version;for(var l=0,u=a.length;l<u;l+=3){var c=a[l+0],h=a[l+1],p=a[l+2];i.push(c,h,h,p,p,c)}}else{var d=n.array;s=n.version;for(var f=0,m=d.length/3-1;f<m;f+=3){var g=f+0,v=f+1,y=f+2;i.push(g,v,v,y,y,g)}}var b=new(ot(i)>65535?tt:$e)(i,1);b.version=s;var _=o.get(e);_&&t.remove(_),o.set(e,b)}return{get:function(e,t){var r=n.get(t);return r||(t.addEventListener("dispose",s),t.isBufferGeometry?r=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new dt).setFromObject(e)),r=t._bufferGeometry),n.set(t,r),i.memory.geometries++,r)},update:function(e){var i=e.attributes;for(var r in i)t.update(i[r],34962);var n=e.morphAttributes;for(var o in n)for(var s=n[o],a=0,l=s.length;a<l;a++)t.update(s[a],34962)},getWireframeAttribute:function(e){var t=o.get(e);if(t){var i=e.index;null!==i&&t.version<i.version&&a(e)}else a(e);return o.get(e)}}}function fi(e,t,i,r){var n,o,s,a=r.isWebGL2;this.setMode=function(e){n=e},this.setIndex=function(e){o=e.type,s=e.bytesPerElement},this.render=function(t,r){e.drawElements(n,r,o,t*s),i.update(r,n,1)},this.renderInstances=function(r,l,u){if(0!==u){var c,h;if(a)c=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](n,l,o,r*s,u),i.update(l,n,u)}}}function mi(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,r){switch(t.calls++,i){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function gi(e,t){return e[0]-t[0]}function vi(e,t){return Math.abs(t[1])-Math.abs(e[1])}function yi(e){for(var t={},i=new Float32Array(8),r=[],n=0;n<8;n++)r[n]=[n,0];return{update:function(n,o,s,a){var l=n.morphTargetInfluences,u=void 0===l?0:l.length,c=t[o.id];if(void 0===c){c=[];for(var h=0;h<u;h++)c[h]=[h,0];t[o.id]=c}for(var p=0;p<u;p++){var d=c[p];d[0]=p,d[1]=l[p]}c.sort(vi);for(var f=0;f<8;f++)f<u&&c[f][1]?(r[f][0]=c[f][0],r[f][1]=c[f][1]):(r[f][0]=Number.MAX_SAFE_INTEGER,r[f][1]=0);r.sort(gi);for(var m=s.morphTargets&&o.morphAttributes.position,g=s.morphNormals&&o.morphAttributes.normal,v=0,y=0;y<8;y++){var b=r[y],_=b[0],x=b[1];_!==Number.MAX_SAFE_INTEGER&&x?(m&&o.getAttribute("morphTarget"+y)!==m[_]&&o.setAttribute("morphTarget"+y,m[_]),g&&o.getAttribute("morphNormal"+y)!==g[_]&&o.setAttribute("morphNormal"+y,g[_]),i[y]=x,v+=x):(m&&void 0!==o.getAttribute("morphTarget"+y)&&o.deleteAttribute("morphTarget"+y),g&&void 0!==o.getAttribute("morphNormal"+y)&&o.deleteAttribute("morphNormal"+y),i[y]=0)}var E=o.morphTargetsRelative?1:1-v;a.getUniforms().setValue(e,"morphTargetBaseInfluence",E),a.getUniforms().setValue(e,"morphTargetInfluences",i)}}}function bi(e,t,i,r){var n=new WeakMap;function o(e){var t=e.target;t.removeEventListener("dispose",o),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){var s=r.render.frame,a=e.geometry,l=t.get(e,a);return n.get(l)!==s&&(a.isGeometry&&l.updateFromObject(e),t.update(l),n.set(l,s)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),l},dispose:function(){n=new WeakMap}}}function _i(e,t,i,r,n,o,s,a,l,u){e=void 0!==e?e:[],t=void 0!==t?t:301,s=void 0!==s?s:1022,p.call(this,e,t,i,r,n,o,s,a,l,u),this.flipY=!1}function xi(e,t,i,r){p.call(this,null),this.image={data:e||null,width:t||1,height:i||1,depth:r||1},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Ei(e,t,i,r){p.call(this,null),this.image={data:e||null,width:t||1,height:i||1,depth:r||1},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}oi.physical={uniforms:Ht([oi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new s(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new ze(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:ri.meshphysical_vert,fragmentShader:ri.meshphysical_frag},_i.prototype=Object.create(p.prototype),_i.prototype.constructor=_i,_i.prototype.isCubeTexture=!0,Object.defineProperty(_i.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),xi.prototype=Object.create(p.prototype),xi.prototype.constructor=xi,xi.prototype.isDataTexture2DArray=!0,Ei.prototype=Object.create(p.prototype),Ei.prototype.constructor=Ei,Ei.prototype.isDataTexture3D=!0;var wi=new p,Ti=new xi,Mi=new Ei,Ci=new _i,Si=[],ji=[],Pi=new Float32Array(16),Ri=new Float32Array(9),Di=new Float32Array(4);function Ai(e,t,i){var r=e[0];if(r<=0||r>0)return e;var n=t*i,o=Si[n];if(void 0===o&&(o=new Float32Array(n),Si[n]=o),0!==t){r.toArray(o,0);for(var s=1,a=0;s!==t;++s)a+=i,e[s].toArray(o,a)}return o}function ki(e,t){if(e.length!==t.length)return!1;for(var i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Oi(e,t){for(var i=0,r=t.length;i<r;i++)e[i]=t[i]}function Bi(e,t){var i=ji[t];void 0===i&&(i=new Int32Array(t),ji[t]=i);for(var r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function Fi(e,t){var i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Li(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(ki(i,t))return;e.uniform2fv(this.addr,t),Oi(i,t)}}function Ii(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(ki(i,t))return;e.uniform3fv(this.addr,t),Oi(i,t)}}function Ni(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(ki(i,t))return;e.uniform4fv(this.addr,t),Oi(i,t)}}function Ui(e,t){var i=this.cache,r=t.elements;if(void 0===r){if(ki(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Oi(i,t)}else{if(ki(i,r))return;Di.set(r),e.uniformMatrix2fv(this.addr,!1,Di),Oi(i,r)}}function zi(e,t){var i=this.cache,r=t.elements;if(void 0===r){if(ki(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Oi(i,t)}else{if(ki(i,r))return;Ri.set(r),e.uniformMatrix3fv(this.addr,!1,Ri),Oi(i,r)}}function Hi(e,t){var i=this.cache,r=t.elements;if(void 0===r){if(ki(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Oi(i,t)}else{if(ki(i,r))return;Pi.set(r),e.uniformMatrix4fv(this.addr,!1,Pi),Oi(i,r)}}function Vi(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.safeSetTexture2D(t||wi,n)}function Wi(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||Ti,n)}function Gi(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||Mi,n)}function qi(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.safeSetTextureCube(t||Ci,n)}function Xi(e,t){var i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function Ji(e,t){var i=this.cache;ki(i,t)||(e.uniform2iv(this.addr,t),Oi(i,t))}function Yi(e,t){var i=this.cache;ki(i,t)||(e.uniform3iv(this.addr,t),Oi(i,t))}function Zi(e,t){var i=this.cache;ki(i,t)||(e.uniform4iv(this.addr,t),Oi(i,t))}function Qi(e,t){var i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function Ki(e,t){e.uniform1fv(this.addr,t)}function $i(e,t){e.uniform1iv(this.addr,t)}function er(e,t){e.uniform2iv(this.addr,t)}function tr(e,t){e.uniform3iv(this.addr,t)}function ir(e,t){e.uniform4iv(this.addr,t)}function rr(e,t){var i=Ai(t,this.size,2);e.uniform2fv(this.addr,i)}function nr(e,t){var i=Ai(t,this.size,3);e.uniform3fv(this.addr,i)}function or(e,t){var i=Ai(t,this.size,4);e.uniform4fv(this.addr,i)}function sr(e,t){var i=Ai(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function ar(e,t){var i=Ai(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function lr(e,t){var i=Ai(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function ur(e,t,i){var r=t.length,n=Bi(i,r);e.uniform1iv(this.addr,n);for(var o=0;o!==r;++o)i.safeSetTexture2D(t[o]||wi,n[o])}function cr(e,t,i){var r=t.length,n=Bi(i,r);e.uniform1iv(this.addr,n);for(var o=0;o!==r;++o)i.safeSetTextureCube(t[o]||Ci,n[o])}function hr(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Fi;case 35664:return Li;case 35665:return Ii;case 35666:return Ni;case 35674:return Ui;case 35675:return zi;case 35676:return Hi;case 5124:case 35670:return Xi;case 35667:case 35671:return Ji;case 35668:case 35672:return Yi;case 35669:case 35673:return Zi;case 5125:return Qi;case 35678:case 36198:case 36298:case 36306:case 35682:return Vi;case 35679:case 36299:case 36307:return Gi;case 35680:case 36300:case 36308:case 36293:return qi;case 36289:case 36303:case 36311:case 36292:return Wi}}(t.type)}function pr(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Ki;case 35664:return rr;case 35665:return nr;case 35666:return or;case 35674:return sr;case 35675:return ar;case 35676:return lr;case 5124:case 35670:return $i;case 35667:case 35671:return er;case 35668:case 35672:return tr;case 35669:case 35673:return ir;case 35678:case 36198:case 36298:case 36306:case 35682:return ur;case 35680:case 36300:case 36308:case 36293:return cr}}(t.type)}function dr(e){this.id=e,this.seq=[],this.map={}}pr.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Oi(t,e)},dr.prototype.setValue=function(e,t,i){for(var r=this.seq,n=0,o=r.length;n!==o;++n){var s=r[n];s.setValue(e,t[s.id],i)}};var fr=/([\w\d_]+)(\])?(\[|\.)?/g;function mr(e,t){e.seq.push(t),e.map[t.id]=t}function gr(e,t,i){var r=e.name,n=r.length;for(fr.lastIndex=0;;){var o=fr.exec(r),s=fr.lastIndex,a=o[1],l="]"===o[2],u=o[3];if(l&&(a|=0),void 0===u||"["===u&&s+2===n){mr(i,void 0===u?new hr(a,e,t):new pr(a,e,t));break}var c=i.map[a];void 0===c&&mr(i,c=new dr(a)),i=c}}function vr(e,t){this.seq=[],this.map={};for(var i=e.getProgramParameter(t,35718),r=0;r<i;++r){var n=e.getActiveUniform(t,r);gr(n,e.getUniformLocation(t,n.name),this)}}function yr(e,t,i){var r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}vr.prototype.setValue=function(e,t,i,r){var n=this.map[t];void 0!==n&&n.setValue(e,i,r)},vr.prototype.setOptional=function(e,t,i){var r=t[i];void 0!==r&&this.setValue(e,i,r)},vr.upload=function(e,t,i,r){for(var n=0,o=t.length;n!==o;++n){var s=t[n],a=i[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,r)}},vr.seqWithValue=function(e,t){for(var i=[],r=0,n=e.length;r!==n;++r){var o=e[r];o.id in t&&i.push(o)}return i};var br=0;function _r(e){switch(e){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function xr(e,t,i){var r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();return r&&""===n?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+n+function(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}(e.getShaderSource(t))}function Er(e,t){var i=_r(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function wr(e,t){var i;switch(t){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Tr(e){return""!==e}function Mr(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Cr(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Sr=/^[ \t]*#include +<([\w\d./]+)>/gm;function jr(e){return e.replace(Sr,Pr)}function Pr(e,t){var i=ri[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return jr(i)}var Rr=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Dr=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ar(e){return e.replace(Dr,Or).replace(Rr,kr)}function kr(e,t,i,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Or(e,t,i,r)}function Or(e,t,i,r){for(var n="",o=parseInt(t);o<parseInt(i);o++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return n}function Br(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Fr(e,t,i,r){var n,o,s,a,l,u=e.getContext(),c=i.defines,h=i.vertexShader,p=i.fragmentShader,d=function(e){var t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(i),f=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:case 307:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),m=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case 302:case 307:t="ENVMAP_MODE_REFRACTION"}return t}(i),g=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(i),v=e.gammaFactor>0?e.gammaFactor:1,y=i.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Tr).join("\n")}(i),b=function(e){var t=[];for(var i in e){var r=e[i];!1!==r&&t.push("#define "+i+" "+r)}return t.join("\n")}(c),_=u.createProgram(),x=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?((n=[b].filter(Tr).join("\n")).length>0&&(n+="\n"),(o=[y,b].filter(Tr).join("\n")).length>0&&(o+="\n")):(n=[Br(i),"#define SHADER_NAME "+i.shaderName,b,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+v,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+m:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+d:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef INSTANCED","\tattribute vec3 instancePosition;","\tattribute vec4 instanceQuaternion;","\tattribute vec3 instanceScale;","\tattribute vec3 instanceColor;","\tmat4 compose(vec3 position, vec4 quaternion, vec3 scale) {","\t\tfloat x = quaternion.x, y = quaternion.y, z = quaternion.z, w = quaternion.w;","\t\tfloat x2 = x + x,  y2 = y + y,  z2 = z + z;","\t\tfloat xx = x * x2, xy = x * y2, xz = x * z2;","\t\tfloat yy = y * y2, yz = y * z2, zz = z * z2;","\t\tfloat wx = w * x2, wy = w * y2, wz = w * z2;","\t\tfloat sx = scale.x, sy = scale.y, sz = scale.z;","\t\treturn mat4(( 1. - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.,","\t\t\t( xy - wz ) * sy, ( 1. - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.,","\t\t\t( xz + wy ) * sz, ( yz - wx ) * sz, ( 1. - ( xx + yy ) ) * sz, 0.,","\t\t\tposition.x, position.y, position.z, 1.","\t);","}","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Tr).join("\n"),o=[y,Br(i),"#define SHADER_NAME "+i.shaderName,b,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+v,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+f:"",i.envMap?"#define "+m:"",i.envMap?"#define "+g:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+d:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?ri.tonemapping_pars_fragment:"",0!==i.toneMapping?wr("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",ri.encodings_pars_fragment,i.map?Er("mapTexelToLinear",i.mapEncoding):"",i.matcap?Er("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?Er("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?Er("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMap?Er("lightMapTexelToLinear",i.lightMapEncoding):"",(s="linearToOutputTexel",a=i.outputEncoding,l=_r(a),"vec4 "+s+"( vec4 value ) { return LinearTo"+l[0]+l[1]+"; }"),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",i.useColorMapping?"#define COLOR_MAPPING":"",i.useEnvQuaternion?"#define ENV_QUATERNION":"",i.useFresnel?"#define FRESNEL":"","\n"].filter(Tr).join("\n")),h=Cr(h=Mr(h=jr(h),i),i),p=Cr(p=Mr(p=jr(p),i),i),h=Ar(h),p=Ar(p),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(x="#version 300 es\n",n=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+n,o=["#define varying in","300 es"===i.glslVersion?"":"out highp vec4 pc_fragColor;","300 es"===i.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+o);var E,w,T=x+o+p,M=yr(u,35633,x+n+h),C=yr(u,35632,T);if(u.attachShader(_,M),u.attachShader(_,C),void 0!==i.index0AttributeName?u.bindAttribLocation(_,0,i.index0AttributeName):!0===i.morphTargets&&u.bindAttribLocation(_,0,"position"),u.linkProgram(_),e.debug.checkShaderErrors){var S=u.getProgramInfoLog(_).trim(),j=u.getShaderInfoLog(M).trim(),P=u.getShaderInfoLog(C).trim(),R=!0,D=!0;if(!1===u.getProgramParameter(_,35714)){R=!1;var A=xr(u,M,"vertex"),k=xr(u,C,"fragment");console.error("THREE.WebGLProgram: shader error: ",u.getError(),"35715",u.getProgramParameter(_,35715),"gl.getProgramInfoLog",S,A,k)}else""!==S?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",S):""!==j&&""!==P||(D=!1);D&&(this.diagnostics={runnable:R,programLog:S,vertexShader:{log:j,prefix:n},fragmentShader:{log:P,prefix:o}})}return u.deleteShader(M),u.deleteShader(C),this.getUniforms=function(){return void 0===E&&(E=new vr(u,_)),E},this.getAttributes=function(){return void 0===w&&(w=function(e,t){for(var i={},r=e.getProgramParameter(t,35721),n=0;n<r;n++){var o=e.getActiveAttrib(t,n).name;i[o]=e.getAttribLocation(t,o)}return i}(u,_)),w},this.destroy=function(){r.releaseStatesOfProgram(this),u.deleteProgram(_),this.program=void 0},this.name=i.shaderName,this.id=br++,this.cacheKey=t,this.usedTimes=1,this.program=_,this.vertexShader=M,this.fragmentShader=C,this}function Lr(e,t,i,r,n,o){var s=[],a=r.isWebGL2,l=r.floatVertexTextures,u=r.maxVertexUniforms,c=r.vertexTextures,h=r.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},d=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap","useColorMapping","useEnvQuaternion","useFresnel"];function f(e,t){var i;return e?e.isTexture?i=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=e.texture.encoding):i=3e3,3e3===i&&t&&(i=3007),i}return{getParameters:function(n,s,d,m,g){var v,y,b=m.fog,_=(null!==n.useEnvironment?n.useEnvironment:n.isMeshStandardMaterial)?m.environment:null,x=m.envQuaternion,E=t.get(n.envMap||_),w=p[n.type],T=g.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(l)return 1024;var i=u,r=Math.floor((i-20)/4),n=Math.min(r,t.length);return n<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+n+"."),0):n}(g):0;if(null!==n.precision&&(h=r.getMaxPrecision(n.precision))!==n.precision&&console.warn("THREE.WebGLProgram.getParameters:",n.precision,"not supported, using",h,"instead."),w){var M=oi[w];v=M.vertexShader,y=M.fragmentShader}else v=n.vertexShader,y=n.fragmentShader;var C=e.getRenderTarget();return{isWebGL2:a,shaderID:w,shaderName:n.type,vertexShader:v,fragmentShader:y,defines:n.defines,isRawShaderMaterial:!0===n.isRawShaderMaterial,glslVersion:n.glslVersion,precision:h,instancing:!0===g.isInstancedMesh,instancingColor:!0===g.isInstancedMesh&&null!==g.instanceColor,supportsVertexTextures:c,outputEncoding:null!==C?f(C.texture,3007===e.outputEncoding):e.outputEncoding,map:!!n.map,mapEncoding:f(n.map,e.gammaInput),matcap:!!n.matcap,matcapEncoding:f(n.matcap,e.gammaInput),envMap:!!E,envMapMode:E&&E.mapping,envMapEncoding:f(E,e.gammaInput),envMapCubeUV:!!E&&(306===E.mapping||307===E.mapping),lightMap:!!n.lightMap,lightMapEncoding:f(n.lightMap),aoMap:!!n.aoMap,emissiveMap:!!n.emissiveMap,emissiveMapEncoding:f(n.emissiveMap,e.gammaInput),bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,objectSpaceNormalMap:1===n.normalMapType,tangentSpaceNormalMap:0===n.normalMapType,clearcoatMap:!!n.clearcoatMap,clearcoatRoughnessMap:!!n.clearcoatRoughnessMap,clearcoatNormalMap:!!n.clearcoatNormalMap,displacementMap:!!n.displacementMap,roughnessMap:!!n.roughnessMap,metalnessMap:!!n.metalnessMap,specularMap:!!n.specularMap,alphaMap:!!n.alphaMap,gradientMap:!!n.gradientMap,sheen:!!n.sheen,transmissionMap:!!n.transmissionMap,combine:n.combine,vertexTangents:n.normalMap&&n.vertexTangents,vertexColors:n.vertexColors,vertexUvs:!!(n.map||n.bumpMap||n.normalMap||n.specularMap||n.alphaMap||n.emissiveMap||n.roughnessMap||n.metalnessMap||n.clearcoatMap||n.clearcoatRoughnessMap||n.clearcoatNormalMap||n.displacementMap||n.transmissionMap),uvsVertexOnly:!(n.map||n.bumpMap||n.normalMap||n.specularMap||n.alphaMap||n.emissiveMap||n.roughnessMap||n.metalnessMap||n.clearcoatNormalMap||n.transmissionMap||!n.displacementMap),fog:!!b,useFog:n.fog,fogExp2:b&&b.isFogExp2,flatShading:n.flatShading,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:r.logarithmicDepthBuffer,skinning:n.skinning&&T>0,maxBones:T,useVertexTexture:l,morphTargets:n.morphTargets,morphNormals:n.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:n.dithering,shadowMapEnabled:e.shadowMap.enabled&&d.length>0,shadowMapType:e.shadowMap.type,toneMapping:n.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:n.premultipliedAlpha,alphaTest:n.alphaTest,doubleSided:2===n.side,flipSided:1===n.side,useColorMapping:!!n.colorMapping,useEnvQuaternion:!!x||!!n.baseQuaternion,useFresnel:!!n.fresnelPower,depthPacking:void 0!==n.depthPacking&&n.depthPacking,index0AttributeName:n.index0AttributeName,extensionDerivatives:n.extensions&&n.extensions.derivatives,extensionFragDepth:n.extensions&&n.extensions.fragDepth,extensionDrawBuffers:n.extensions&&n.extensions.drawBuffers,extensionShaderTextureLOD:n.extensions&&n.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||i.has("EXT_shader_texture_lod"),customProgramCacheKey:n.customProgramCacheKey()}},getProgramCacheKey:function(t){var i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)i.push(r),i.push(t.defines[r]);if(!1===t.isRawShaderMaterial){for(var n=0;n<d.length;n++)i.push(t[d[n]]);i.push(e.outputEncoding),i.push(e.gammaFactor)}return i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){var t,i=p[e.type];if(i){var r=oi[i];t=Vt.clone(r.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,i){for(var r,o=0,a=s.length;o<a;o++){var l=s[o];if(l.cacheKey===i){++(r=l).usedTimes;break}}return void 0===r&&(r=new Fr(e,i,t,n),s.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){var t=s.indexOf(e);s[t]=s[s.length-1],s.pop(),e.destroy()}},programs:s}}function Ir(){var e=new WeakMap;return{get:function(t){var i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,r){e.get(t)[i]=r},dispose:function(){e=new WeakMap}}}function Nr(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ur(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.material.id!==t.material.id?e.material.id-t.material.id:e.id-t.id}function zr(e){var t=[],i=0,r=[],n=[],o=[],s={id:-1};function a(r,n,o,a,l,u){var c=t[i],h=e.get(o);return void 0===c?(c={id:r.id,object:r,geometry:n,material:o,program:h.program||s,groupOrder:a,renderOrder:r.renderOrder,z:l,group:u},t[i]=c):(c.id=r.id,c.object=r,c.geometry=n,c.material=o,c.program=h.program||s,c.groupOrder=a,c.renderOrder=r.renderOrder,c.z=l,c.group=u),i++,c}return{custom1:r,opaque:n,transparent:o,init:function(){i=0,r.length=0,n.length=0,o.length=0},push:function(e,t,i,s,l,u){var c=a(e,t,i,s,l,u);1===e.renderLayer?r.push(c):(!0===i.transparent?o:n).push(c)},unshift:function(e,t,i,s,l,u){var c=a(e,t,i,s,l,u);1===e.renderLayer?r.unshift(c):(!0===i.transparent?o:n).unshift(c)},finish:function(){for(var e=i,r=t.length;e<r;e++){var n=t[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){r.length>1&&r.sort(e||Nr),n.length>1&&n.sort(e||Nr),o.length>1&&o.sort(t||Ur)}}}function Hr(e){var t=new WeakMap;return{get:function(i,r){var n,o=t.get(i);return void 0===o?(n=new zr(e),t.set(i,new WeakMap),t.get(i).set(r,n)):void 0===(n=o.get(r))&&(n=new zr(e),o.set(r,n)),n},dispose:function(){t=new WeakMap}}}function Vr(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var i;switch(t.type){case"DirectionalLight":i={direction:new b,color:new ze};break;case"SpotLight":i={position:new b,direction:new b,color:new ze,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new b,color:new ze,distance:0,decay:0};break;case"HemisphereLight":i={direction:new b,skyColor:new ze,groundColor:new ze};break;case"RectAreaLight":i={color:new ze,position:new b,halfWidth:new b,halfHeight:new b}}return e[t.id]=i,i}}}var Wr=0;function Gr(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function qr(){for(var e,t=new Vr,i=(e={},{get:function(t){if(void 0!==e[t.id])return e[t.id];var i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new s};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new s,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},n=0;n<9;n++)r.probe.push(new b);var o=new b,a=new X,l=new X;return{setup:function(e,n,s){for(var u=0,c=0,h=0,p=0;p<9;p++)r.probe[p].set(0,0,0);var d=0,f=0,m=0,g=0,v=0,y=0,b=0,_=0,x=s.matrixWorldInverse;e.sort(Gr);for(var E=0,w=e.length;E<w;E++){var T=e[E],M=T.color,C=T.intensity,S=T.distance,j=T.shadow&&T.shadow.map?T.shadow.map.texture:null;if(T.isAmbientLight)u+=M.r*C,c+=M.g*C,h+=M.b*C;else if(T.isLightProbe)for(var P=0;P<9;P++)r.probe[P].addScaledVector(T.sh.coefficients[P],C);else if(T.isDirectionalLight){var R=t.get(T);if(R.color.copy(T.color).multiplyScalar(T.intensity),R.direction.setFromMatrixPosition(T.matrixWorld),o.setFromMatrixPosition(T.target.matrixWorld),R.direction.sub(o),R.direction.transformDirection(x),T.castShadow){var D=T.shadow,A=i.get(T);A.shadowBias=D.bias,A.shadowNormalBias=D.normalBias,A.shadowRadius=D.radius,A.shadowMapSize=D.mapSize,r.directionalShadow[d]=A,r.directionalShadowMap[d]=j,r.directionalShadowMatrix[d]=T.shadow.matrix,y++}r.directional[d]=R,d++}else if(T.isSpotLight){var k=t.get(T);if(k.position.setFromMatrixPosition(T.matrixWorld),k.position.applyMatrix4(x),k.color.copy(M).multiplyScalar(C),k.distance=S,k.direction.setFromMatrixPosition(T.matrixWorld),o.setFromMatrixPosition(T.target.matrixWorld),k.direction.sub(o),k.direction.transformDirection(x),k.coneCos=Math.cos(T.angle),k.penumbraCos=Math.cos(T.angle*(1-T.penumbra)),k.decay=T.decay,T.castShadow){var O=T.shadow,B=i.get(T);B.shadowBias=O.bias,B.shadowNormalBias=O.normalBias,B.shadowRadius=O.radius,B.shadowMapSize=O.mapSize,r.spotShadow[m]=B,r.spotShadowMap[m]=j,r.spotShadowMatrix[m]=T.shadow.matrix,_++}r.spot[m]=k,m++}else if(T.isRectAreaLight){var F=t.get(T);F.color.copy(M).multiplyScalar(C),F.position.setFromMatrixPosition(T.matrixWorld),F.position.applyMatrix4(x),l.identity(),a.copy(T.matrixWorld),a.premultiply(x),l.extractRotation(a),F.halfWidth.set(.5*T.width,0,0),F.halfHeight.set(0,.5*T.height,0),F.halfWidth.applyMatrix4(l),F.halfHeight.applyMatrix4(l),r.rectArea[g]=F,g++}else if(T.isPointLight){var L=t.get(T);if(L.position.setFromMatrixPosition(T.matrixWorld),L.position.applyMatrix4(x),L.color.copy(T.color).multiplyScalar(T.intensity),L.distance=T.distance,L.decay=T.decay,T.castShadow){var I=T.shadow,N=i.get(T);N.shadowBias=I.bias,N.shadowNormalBias=I.normalBias,N.shadowRadius=I.radius,N.shadowMapSize=I.mapSize,N.shadowCameraNear=I.camera.near,N.shadowCameraFar=I.camera.far,r.pointShadow[f]=N,r.pointShadowMap[f]=j,r.pointShadowMatrix[f]=T.shadow.matrix,b++}r.point[f]=L,f++}else if(T.isHemisphereLight){var U=t.get(T);U.direction.setFromMatrixPosition(T.matrixWorld),U.direction.transformDirection(x),U.direction.normalize(),U.skyColor.copy(T.color).multiplyScalar(C),U.groundColor.copy(T.groundColor).multiplyScalar(C),r.hemi[v]=U,v++}}g>0&&(r.rectAreaLTC1=ni.LTC_1,r.rectAreaLTC2=ni.LTC_2),r.ambient[0]=u,r.ambient[1]=c,r.ambient[2]=h;var z=r.hash;z.directionalLength===d&&z.pointLength===f&&z.spotLength===m&&z.rectAreaLength===g&&z.hemiLength===v&&z.numDirectionalShadows===y&&z.numPointShadows===b&&z.numSpotShadows===_||(r.directional.length=d,r.spot.length=m,r.rectArea.length=g,r.point.length=f,r.hemi.length=v,r.directionalShadow.length=y,r.directionalShadowMap.length=y,r.pointShadow.length=b,r.pointShadowMap.length=b,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=y,r.pointShadowMatrix.length=b,r.spotShadowMatrix.length=_,z.directionalLength=d,z.pointLength=f,z.spotLength=m,z.rectAreaLength=g,z.hemiLength=v,z.numDirectionalShadows=y,z.numPointShadows=b,z.numSpotShadows=_,r.version=Wr++)},state:r}}function Xr(){var e=new qr,t=[],i=[];return{init:function(){t.length=0,i.length=0},state:{lightsArray:t,shadowsArray:i,lights:e},setupLights:function(r){e.setup(t,i,r)},pushLight:function(e){t.push(e)},pushShadow:function(e){i.push(e)}}}function Jr(){var e=new WeakMap;return{get:function(t,i){var r;return!1===e.has(t)?(r=new Xr,e.set(t,new WeakMap),e.get(t).set(i,r)):!1===e.get(t).has(i)?(r=new Xr,e.get(t).set(i,r)):r=e.get(t).get(i),r},dispose:function(){e=new WeakMap}}}function Yr(e){We.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function Zr(e){We.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new b,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}Yr.prototype=Object.create(We.prototype),Yr.prototype.constructor=Yr,Yr.prototype.isMeshDepthMaterial=!0,Yr.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Zr.prototype=Object.create(We.prototype),Zr.prototype.constructor=Zr,Zr.prototype.isMeshDistanceMaterial=!0,Zr.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};function Qr(e,t,i){var r=new Kt,n=new s,o=new s,a=new d,l=[],u=[],c={},h={0:1,1:0,2:2},p=new Wt({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new s},radius:{value:4}},vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:"\nuniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n\n#include <packing>\n\nvoid main() {\n\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\n\t// This seems totally useless but it's a crazy work around for a Adreno compiler bug\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\n\t\t#ifdef HORIZONAL_PASS\n\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n\t\t#else\n\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\n\t\t#endif\n\n\t}\n\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n"}),f=p.clone();f.defines.HORIZONAL_PASS=1;var g=new dt;g.setAttribute("position",new Je(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new Dt(g,p),y=this;function b(i,r){var n=t.update(v);p.uniforms.shadow_pass.value=i.map.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(r,null,n,p,v,null),f.uniforms.shadow_pass.value=i.mapPass.texture,f.uniforms.resolution.value=i.mapSize,f.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(r,null,n,f,v,null)}function _(e,t,i){var r=e<<0|t<<1|i<<2,n=l[r];return void 0===n&&(n=new Yr({depthPacking:3201,morphTargets:e,skinning:t}),l[r]=n),n}function x(e,t,i){var r=e<<0|t<<1|i<<2,n=u[r];return void 0===n&&(n=new Zr({morphTargets:e,skinning:t}),u[r]=n),n}function E(t,i,r,n,o,s,a){var l=null,u=_,p=t.customDepthMaterial;if(!0===n.isPointLight&&(u=x,p=t.customDistanceMaterial),void 0===p){var d=!1;!0===r.morphTargets&&(d=i.morphAttributes&&i.morphAttributes.position&&i.morphAttributes.position.length>0);var f=!1;!0===t.isSkinnedMesh&&(!0===r.skinning?f=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),l=u(d,f,!0===t.isInstancedMesh)}else l=p;if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var m=l.uuid,g=r.uuid,v=c[m];void 0===v&&(v={},c[m]=v);var y=v[g];void 0===y&&(y=l.clone(),v[g]=y),l=y}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=3===a?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:h[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,!0===n.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(n.matrixWorld),l.nearDistance=o,l.farDistance=s),l}function w(i,n,o,s,a){if(!1!==i.visible){if(i.layers.test(n.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===a)&&(!i.frustumCulled||r.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,i.matrixWorld);var l=t.update(i),u=i.material;if(Array.isArray(u))for(var c=l.groups,h=0,p=c.length;h<p;h++){var d=c[h],f=u[d.materialIndex];if(f&&f.visible){var m=E(i,l,f,s,o.near,o.far,a);e.renderBufferDirect(o,null,l,m,i,d)}}else if(u.visible){var g=E(i,l,u,s,o.near,o.far,a);e.renderBufferDirect(o,null,l,g,i,null)}}for(var v=i.children,y=0,b=v.length;y<b;y++)w(v[y],n,o,s,a)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,s,l){if(!1!==y.enabled&&(!1!==y.autoUpdate||!1!==y.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.state;p.setBlending(0),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(var d=0,f=t.length;d<f;d++){var g=t[d],v=g.shadow;if(!1!==v.autoUpdate||!1!==v.needsUpdate)if(void 0!==v){n.copy(v.mapSize);var _=v.getFrameExtents();if(n.multiply(_),o.copy(v.mapSize),(n.x>i||n.y>i)&&(n.x>i&&(o.x=Math.floor(i/_.x),n.x=o.x*_.x,v.mapSize.x=o.x),n.y>i&&(o.y=Math.floor(i/_.y),n.y=o.y*_.y,v.mapSize.y=o.y)),null===v.map&&!v.isPointLightShadow&&3===this.type){var x={minFilter:1006,magFilter:1006,format:1023};v.map=new m(n.x,n.y,x),v.map.texture.name=g.name+".shadowMap",v.mapPass=new m(n.x,n.y,x),v.camera.updateProjectionMatrix()}if(null===v.map){var E={minFilter:1003,magFilter:1003,format:1023};v.map=new m(n.x,n.y,E),v.map.texture.name=g.name+".shadowMap",v.camera.updateProjectionMatrix()}e.setRenderTarget(v.map),e.clear();for(var T=v.getViewportCount(),M=0;M<T;M++){var C=v.getViewport(M);a.set(o.x*C.x,o.y*C.y,o.x*C.z,o.y*C.w),p.viewport(a),v.updateMatrices(g,M),r=v.getFrustum(),w(s,l,v.camera,g,this.type)}v.isPointLightShadow||3!==this.type||b(v,l),v.needsUpdate=!1}else console.warn("THREE.WebGLShadowMap:",g,"has no shadow.")}y.needsUpdate=!1,e.setRenderTarget(u,c,h)}}}function Kr(e,t,i){var r=i.isWebGL2;var n=new function(){var t=!1,i=new d,r=null,n=new d(0,0,0,0);return{setMask:function(i){r===i||t||(e.colorMask(i,i,i,i),r=i)},setLocked:function(e){t=e},setClear:function(t,r,o,s,a){!0===a&&(t*=s,r*=s,o*=s),i.set(t,r,o,s),!1===n.equals(i)&&(e.clearColor(t,r,o,s),n.copy(i))},reset:function(){t=!1,r=null,n.set(-1,0,0,0)}}},o=new function(){var t=!1,i=null,r=null,n=null;return{setTest:function(e){e?O(2929):B(2929)},setMask:function(r){i===r||t||(e.depthMask(r),i=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,i=null,r=null,n=null}}},s=new function(){var t=!1,i=null,r=null,n=null,o=null,s=null,a=null,l=null,u=null,c=null,h=null,p=null,d=null,f=null,m=null;return{setTest:function(e){t||(e?O(2960):B(2960))},setMask:function(r){i===r||t||(e.stencilMask(r),i=r)},setFunc:function(t,i,s,a,l,u){r===t&&n===i&&o===s&&c===a&&h===l&&p===u||(null===a||null===l||null===u?e.stencilFunc(t,i,s):(e.stencilFuncSeparate(1028,t,i,s),e.stencilFuncSeparate(1029,a,l,u)),r=t,n=i,o=s,c=a,h=l,p=u)},setOp:function(t,i,r,n,o,u){s===t&&a===i&&l===r&&d===n&&f===o&&m===u||(null===n||null===o||null===u?e.stencilOp(t,i,r):(e.stencilOpSeparate(1028,t,i,r),e.stencilOpSeparate(1029,n,o,u)),s=t,a=i,l=r,d=n,f=o,m=u)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,i=null,r=null,n=null,o=null,s=null,a=null,l=null,u=null}}},a={},l=null,u=null,c=null,h=null,p=null,f=null,m=null,g=null,v=null,y=!1,b=null,_=null,x=null,E=null,w=null,T=e.getParameter(35661),M=!1,C=0,S=e.getParameter(7938);-1!==S.indexOf("WebGL")?(C=parseFloat(/^WebGL\ ([0-9])/.exec(S)[1]),M=C>=1):-1!==S.indexOf("OpenGL ES")&&(C=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(S)[1]),M=C>=2);var j=null,P={},R=new d,D=new d;function A(t,i,r){var n=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var s=0;s<r;s++)e.texImage2D(i+s,0,6408,1,1,0,6408,5121,n);return o}var k={};function O(t){!0!==a[t]&&(e.enable(t),a[t]=!0)}function B(t){!1!==a[t]&&(e.disable(t),a[t]=!1)}k[3553]=A(3553,3553,1),k[34067]=A(34067,34069,6),n.setClear(0,0,0,1),o.setClear(1),s.setClear(0),O(2929),o.setFunc(3),U(!1),z(1),O(2884),N(0);var F={100:32774,101:32778,102:32779};if(r)F[103]=32775,F[104]=32776;else{var L=t.get("EXT_blend_minmax");null!==L&&(F[103]=L.MIN_EXT,F[104]=L.MAX_EXT)}var I={};function N(t,i,r,n,o,s,a,l){if(0!==t){if(u||(O(3042),u=!0),5===t)o=o||i,s=s||r,a=a||n,i===h&&o===m||(e.blendEquationSeparate(F[i],F[o]),h=i,m=o),r===p&&n===f&&s===g&&a===v||(e.blendFuncSeparate(I[r],I[n],I[s],I[a]),p=r,f=n,g=s,v=a),c=t,y=null;else if(t!==c||l!==y){if(100===h&&100===m||(e.blendEquation(32774),h=100,m=100),l)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}p=null,f=null,g=null,v=null,c=t,y=l}}else u&&(B(3042),u=!1)}function U(t){b!==t&&(t?e.frontFace(2304):e.frontFace(2305),b=t)}function z(t){0!==t?(O(2884),t!==_&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):B(2884),_=t}function H(t,i,r){t?(O(32823),E===i&&w===r||(e.polygonOffset(i,r),E=i,w=r)):B(32823)}function V(t){void 0===t&&(t=33984+T-1),j!==t&&(e.activeTexture(t),j=t)}return I[200]=0,I[201]=1,I[202]=768,I[204]=770,I[210]=776,I[208]=774,I[206]=772,I[203]=769,I[205]=771,I[209]=775,I[207]=773,{buffers:{color:n,depth:o,stencil:s},enable:O,disable:B,useProgram:function(t){return l!==t&&(e.useProgram(t),l=t,!0)},setBlending:N,setMaterial:function(e,t){2===e.side?B(2884):O(2884);var i=1===e.side;t&&(i=!i),U(i),1===e.blending&&!1===e.transparent?N(0):N(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),n.setMask(e.colorWrite);var r=e.stencilWrite;s.setTest(r),r&&(s.setMask(e.stencilWriteMask),s.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask,e.stencilFuncBack,e.stencilRefBack,e.stencilFuncMaskBack),s.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass,e.stencilFailBack,e.stencilZFailBack,e.stencilZPassBack)),H(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:U,setCullFace:z,setLineWidth:function(t){t!==x&&(M&&e.lineWidth(t),x=t)},setPolygonOffset:H,setScissorTest:function(e){e?O(3089):B(3089)},activeTexture:V,bindTexture:function(t,i){null===j&&V();var r=P[j];void 0===r&&(r={type:void 0,texture:void 0},P[j]=r),r.type===t&&r.texture===i||(e.bindTexture(t,i||k[t]),r.type=t,r.texture=i)},unbindTexture:function(){var t=P[j];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===R.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),R.copy(t))},viewport:function(t){!1===D.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),D.copy(t))},reset:function(){a={},j=null,P={},l=null,u=null,c=null,b=null,_=null,n.reset(),o.reset(),s.reset()}}}function $r(e,t,i,r,n,s,a){var l,u=n.isWebGL2,c=n.maxTextures,h=n.maxCubemapSize,p=n.maxTextureSize,d=n.maxSamples,f=new WeakMap,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function g(e,t){return m?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(e,t,i,r){var n=1;if((e.width>r||e.height>r)&&(n=r/Math.max(e.width,e.height)),n<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var s=t?o.floorPowerOfTwo:Math.floor,a=s(n*e.width),u=s(n*e.height);void 0===l&&(l=g(a,u));var c=i?g(a,u):l;return c.width=a,c.height=u,c.getContext("2d").drawImage(e,0,0,a,u),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+u+")."),c}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function y(e){return o.isPowerOfTwo(e.width)&&o.isPowerOfTwo(e.height)}function b(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function _(t,i,n,o){e.generateMipmap(t),r.get(i).__maxMipLevel=Math.log(Math.max(n,o))*Math.LOG2E}function x(i,r,n){if(!1===u)return r;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}var o=r;return 6403===r&&(5126===n&&(o=33326),5131===n&&(o=33325),5121===n&&(o=33321)),6407===r&&(5126===n&&(o=34837),5131===n&&(o=34843),5121===n&&(o=32849)),6408===r&&(5126===n&&(o=34836),5131===n&&(o=34842),5121===n&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function E(e){return 1003===e||1004===e||1005===e?9728:9729}function w(t){var i=t.target;i.removeEventListener("dispose",w),function(t){var i=r.get(t);if(void 0===i.__webglInit)return;e.deleteTexture(i.__webglTexture),r.remove(t)}(i),i.isVideoTexture&&f.delete(i),a.memory.textures--}function T(t){var i=t.target;i.removeEventListener("dispose",T),function(t){var i=r.get(t),n=r.get(t.texture);if(!t)return;void 0!==n.__webglTexture&&e.deleteTexture(n.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var o=0;o<6;o++)e.deleteFramebuffer(i.__webglFramebuffer[o]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[o]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&!i.__shareDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&!i.__shareColorRenderbuffer&&e.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&!i.__shareDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer);r.remove(t.texture),r.remove(t)}(i),a.memory.textures--}var M=0;function C(e,t){var n=r.get(e);if(e.glTexture)return n.__webglTexture=e.glTexture,i.activeTexture(33984+t),void i.bindTexture(3553,e.glTexture);if(e.isVideoTexture&&function(e){var t=a.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(e),e.version>0&&n.__version!==e.version){var o=e.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void k(n,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+t),i.bindTexture(3553,n.__webglTexture)}function S(t,n){var o=r.get(t);if(6!==t.image.length)return i.activeTexture(33984+n),void i.bindTexture(34067,o.__webglTexture);if(t.version>0&&o.__version!==t.version){A(o,t),i.activeTexture(33984+n),i.bindTexture(34067,o.__webglTexture),e.pixelStorei(37440,t.flipY);for(var a=t&&(t.isCompressedTexture||t.image[0].isCompressedTexture),l=t.image[0]&&t.image[0].isDataTexture,c=[],p=0;p<6;p++)c[p]=a||l?l?t.image[p].image:t.image[p]:v(t.image[p],!1,!0,h);var d,f=c[0],m=y(f)||u,g=s.convert(t.format),E=s.convert(t.type),w=x(t.internalFormat,g,E);if(D(34067,t,m),a){for(var T=0;T<6;T++){d=c[T].mipmaps;for(var M=0;M<d.length;M++){var C=d[M];1023!==t.format&&1022!==t.format?null!==g?i.compressedTexImage2D(34069+T,M,w,C.width,C.height,0,C.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+T,M,w,C.width,C.height,0,g,E,C.data)}}o.__maxMipLevel=d.length-1}else{d=t.mipmaps;for(var S=0;S<6;S++)if(l){i.texImage2D(34069+S,0,w,c[S].width,c[S].height,0,g,E,c[S].data);for(var j=0;j<d.length;j++){var P=d[j].image[S].image;i.texImage2D(34069+S,j+1,w,P.width,P.height,0,g,E,P.data)}}else{i.texImage2D(34069+S,0,w,g,E,c[S]);for(var R=0;R<d.length;R++){var k=d[R];i.texImage2D(34069+S,R+1,w,g,E,k.image[S])}}o.__maxMipLevel=d.length}b(t,m)&&_(34067,t,f.width,f.height),o.__version=t.version,t.onUpdate&&t.onUpdate(t)}else i.activeTexture(33984+n),i.bindTexture(34067,o.__webglTexture)}function j(e,t){i.activeTexture(33984+t),i.bindTexture(34067,r.get(e).__webglTexture)}var P={1e3:10497,1001:33071,1002:33648},R={};function D(i,o,s){s?(e.texParameteri(i,10242,P[o.wrapS]),e.texParameteri(i,10243,P[o.wrapT]),32879!==i&&35866!==i||e.texParameteri(i,32882,P[o.wrapR]),e.texParameteri(i,10240,R[o.magFilter]),e.texParameteri(i,10241,R[o.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),32879!==i&&35866!==i||e.texParameteri(i,32882,33071),1001===o.wrapS&&1001===o.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,E(o.magFilter)),e.texParameteri(i,10241,E(o.minFilter)),1003!==o.minFilter&&1006!==o.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var a=t.get("EXT_texture_filter_anisotropic");if(a){if(1015===o.type&&null===t.get("OES_texture_float_linear"))return;if(1016===o.type&&null===(u||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(i,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,n.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function A(t,i){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",w),t.__webglTexture=e.createTexture(),a.memory.textures++)}function k(t,r,n){var o=3553;r.isDataTexture2DArray&&(o=35866),r.isDataTexture3D&&(o=32879),A(t,r),i.activeTexture(33984+n),i.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);var a,l=function(e){return!u&&(1001!==e.wrapS||1001!==e.wrapT||1003!==e.minFilter&&1006!==e.minFilter)}(r)&&!1===y(r.image),c=v(r.image,l,!1,p),h=y(c)||u,d=s.convert(r.format),f=s.convert(r.type),m=x(r.internalFormat,d,f);D(o,r,h);var g=r.mipmaps;if(r.isDepthTexture)m=6402,u?m=1015===r.type?36012:1014===r.type?33190:1020===r.type?35056:33189:1015===r.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===r.format&&6402===m&&1012!==r.type&&1014!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=1012,f=s.convert(r.type)),1027===r.format&&6402===m&&(m=34041,1020!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=1020,f=s.convert(r.type))),i.texImage2D(3553,0,m,c.width,c.height,0,d,f,null);else if(r.isDataTexture)if(g.length>0&&h){for(var E=0,w=g.length;E<w;E++)a=g[E],i.texImage2D(3553,E,m,a.width,a.height,0,d,f,a.data);r.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else i.texImage2D(3553,0,m,c.width,c.height,0,d,f,c.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(var T=0,M=g.length;T<M;T++)a=g[T],1023!==r.format&&1022!==r.format?null!==d?i.compressedTexImage2D(3553,T,m,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,T,m,a.width,a.height,0,d,f,a.data);t.__maxMipLevel=g.length-1}else if(r.isDataTexture2DArray)i.texImage3D(35866,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)i.texImage3D(32879,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(g.length>0&&h){for(var C=0,S=g.length;C<S;C++)a=g[C],i.texImage2D(3553,C,m,d,f,a);r.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else i.texImage2D(3553,0,m,d,f,c),t.__maxMipLevel=0;b(r,h)&&_(o,r,c.width,c.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function O(t,n,o,a){var l=s.convert(n.texture.format),u=s.convert(n.texture.type),c=x(n.texture.internalFormat,l,u);i.texImage2D(a,0,c,n.width,n.height,0,l,u,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,o,a,r.get(n.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function B(t,i,r){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){var n=33189;if(r){var o=i.depthTexture;o&&o.isDepthTexture&&(1015===o.type?n=36012:1014===o.type&&(n=33190));var a=L(i);e.renderbufferStorageMultisample(36161,a,n,i.width,i.height)}else e.renderbufferStorage(36161,n,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){if(r){var l=L(i);e.renderbufferStorageMultisample(36161,l,35056,i.width,i.height)}else e.renderbufferStorage(36161,34041,i.width,i.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var u=s.convert(i.texture.format),c=s.convert(i.texture.type),h=x(i.texture.internalFormat,u,c);if(r){var p=L(i);e.renderbufferStorageMultisample(36161,p,h,i.width,i.height)}else e.renderbufferStorage(36161,h,i.width,i.height)}e.bindRenderbuffer(36161,null)}function F(t){var i=r.get(t),n=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),C(i.depthTexture,0);var n=r.get(i.depthTexture).__webglTexture;if(1026===i.depthTexture.format)e.framebufferTexture2D(36160,36096,3553,n,0);else{if(1027!==i.depthTexture.format)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,n,0)}}(i.__webglFramebuffer,t)}else if(n){i.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(36160,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=e.createRenderbuffer(),B(i.__webglDepthbuffer[o],t,!1)}else e.bindFramebuffer(36160,i.__webglFramebuffer),t.webglDepthRenderbuffer&&!t.isWebGLMultisampleRenderTarget?(i.__webglDepthbuffer=t.webglDepthRenderbuffer,i.__shareDepthbuffer=!0):i.__webglDepthbuffer=e.createRenderbuffer(),B(i.__webglDepthbuffer,t,!1);e.bindFramebuffer(36160,null)}function L(e){return u&&e.isWebGLMultisampleRenderTarget?Math.min(d,e.samples):0}R[1003]=9728,R[1004]=9984,R[1005]=9986,R[1006]=9729,R[1007]=9985,R[1008]=9987;var I=!1,N=!1;this.allocateTextureUnit=function(){var e=M;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=C,this.setTexture2DArray=function(e,t){var n=r.get(e);e.version>0&&n.__version!==e.version?k(n,e,t):(i.activeTexture(33984+t),i.bindTexture(35866,n.__webglTexture))},this.setTexture3D=function(e,t){var n=r.get(e);e.version>0&&n.__version!==e.version?k(n,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,n.__webglTexture))},this.setTextureCube=S,this.setTextureCubeDynamic=j,this.setupRenderTarget=function(t){var n=r.get(t),o=r.get(t.texture);t.addEventListener("dispose",T),o.__webglTexture=e.createTexture(),a.memory.textures++;var l=!0===t.isWebGLCubeRenderTarget,c=!0===t.isWebGLMultisampleRenderTarget,h=y(t)||u;if(!u||1022!==t.texture.format||1015!==t.texture.type&&1016!==t.texture.type||(t.texture.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),l){n.__webglFramebuffer=[];for(var p=0;p<6;p++)n.__webglFramebuffer[p]=e.createFramebuffer()}else if(n.__webglFramebuffer=e.createFramebuffer(),c)if(u){n.__webglMultisampledFramebuffer=e.createFramebuffer(),t.webglColorRenderbuffer?(n.__webglColorRenderbuffer=t.webglColorRenderbuffer,n.__shareColorRenderbuffer=!0):n.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,n.__webglColorRenderbuffer);var d=s.convert(t.texture.format),f=s.convert(t.texture.type),m=x(t.texture.internalFormat,d,f),g=L(t);e.renderbufferStorageMultisample(36161,g,m,t.width,t.height),e.bindFramebuffer(36160,n.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,n.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(t.webglDepthRenderbuffer?(n.__webglDepthRenderbuffer=t.webglDepthRenderbuffer,n.__shareDepthRenderbuffer=!0):n.__webglDepthRenderbuffer=e.createRenderbuffer(),B(n.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){i.bindTexture(34067,o.__webglTexture),D(34067,t.texture,h);for(var v=0;v<6;v++)O(n.__webglFramebuffer[v],t,36064,34069+v);b(t.texture,h)&&_(34067,t.texture,t.width,t.height),i.bindTexture(34067,null)}else i.bindTexture(3553,o.__webglTexture),D(3553,t.texture,h),O(n.__webglFramebuffer,t,36064,3553),b(t.texture,h)&&_(3553,t.texture,t.width,t.height),i.bindTexture(3553,null);t.depthBuffer&&F(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(b(t,y(e)||u)){var n=e.isWebGLCubeRenderTarget?34067:3553,o=r.get(t).__webglTexture;i.bindTexture(n,o),_(n,t,e.width,e.height),i.bindTexture(n,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(u){var i=r.get(t);e.bindFramebuffer(36008,i.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,i.__webglFramebuffer);var n=t.width,o=t.height,s=16384;t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024),e.blitFramebuffer(0,0,n,o,0,0,n,o,s,9728),e.bindFramebuffer(36160,i.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===I&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),I=!0),e=e.texture),C(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===N&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),N=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?S(e,t):j(e,t)}}function en(e,t,i){var r=i.isWebGL2;return{convert:function(e){var i;if(1009===e)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(1012===e)return 5123;if(1013===e)return 5124;if(1014===e)return 5125;if(1015===e)return 5126;if(1016===e)return r?5131:null!==(i=t.get("OES_texture_half_float"))?i.HALF_FLOAT_OES:null;if(1021===e)return 6406;if(1022===e)return 6407;if(1023===e)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(1026===e)return 6402;if(1027===e)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(33776===e||33777===e||33778===e||33779===e){if(null===(i=t.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===e)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e){if(null===(i=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===e)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return null!==(i=t.get("WEBGL_compressed_texture_etc1"))?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===e||37496===e)&&null!==(i=t.get("WEBGL_compressed_texture_etc"))){if(37492===e)return i.COMPRESSED_RGB8_ETC2;if(37496===e)return i.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?null!==(i=t.get("WEBGL_compressed_texture_astc"))?e:null:36492===e?null!==(i=t.get("EXT_texture_compression_bptc"))?e:null:1020===e?r?34042:null!==(i=t.get("WEBGL_depth_texture"))?i.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function tn(e){qt.call(this),this.cameras=e||[]}function rn(){be.call(this),this.type="Group"}function nn(){this._targetRay=null,this._grip=null,this._hand=null}function on(e,t){var i=this,r=null,n=1,o=null,s="local-floor",a=null,l=[],u=new Map,c=new qt;c.layers.enable(1),c.viewport=new d;var h=new qt;h.layers.enable(2),h.viewport=new d;var p=[c,h],f=new tn;f.layers.enable(1),f.layers.enable(2);var m=null,g=null;function v(e){var t=u.get(e.inputSource);t&&t.dispatchEvent({type:e.type})}function y(){u.forEach((function(e,t){e.disconnect(t)})),u.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),C.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function _(e){o=e,C.setContext(r),C.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}function x(e){for(var t=r.inputSources,i=0;i<l.length;i++)u.set(t[i],l[i]);for(var n=0;n<e.removed.length;n++){var o=e.removed[n],s=u.get(o);s&&(s.dispatchEvent({type:"disconnected",data:o}),u.delete(o))}for(var a=0;a<e.added.length;a++){var c=e.added[a],h=u.get(c);h&&h.dispatchEvent({type:"connected",data:c})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){var t=l[e];return void 0===t&&(t=new nn,l[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){var t=l[e];return void 0===t&&(t=new nn,l[e]=t),t.getGripSpace()},this.getHand=function(e){var t=l[e];return void 0===t&&(t=new nn,l[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){n=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return r},this.setSession=function(e){if(null!==(r=e)){r.addEventListener("select",v),r.addEventListener("selectstart",v),r.addEventListener("selectend",v),r.addEventListener("squeeze",v),r.addEventListener("squeezestart",v),r.addEventListener("squeezeend",v),r.addEventListener("end",y);var i=t.getContextAttributes();!0!==i.xrCompatible&&t.makeXRCompatible();var o={antialias:i.antialias,alpha:i.alpha,depth:i.depth,stencil:i.stencil,framebufferScaleFactor:n},a=new XRWebGLLayer(r,t,o);r.updateRenderState({baseLayer:a}),r.requestReferenceSpace(s).then(_),r.addEventListener("inputsourceschange",x)}};var E=new b,w=new b;function T(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}this.getCamera=function(e){f.near=h.near=c.near=e.near,f.far=h.far=c.far=e.far,m===f.near&&g===f.far||(r.updateRenderState({depthNear:f.near,depthFar:f.far}),m=f.near,g=f.far);var t=e,i=f.cameras;T(f,t);for(var n=0;n<i.length;n++)T(i[n],t);e.matrixWorld.copy(f.matrixWorld);for(var o=e.children,s=0,a=o.length;s<a;s++)o[s].updateMatrixWorld(!0);return 2===i.length?function(e,t,i){E.setFromMatrixPosition(t.matrixWorld),w.setFromMatrixPosition(i.matrixWorld);var r=E.distanceTo(w),n=t.projectionMatrix.elements,o=i.projectionMatrix.elements,s=n[14]/(n[10]-1),a=n[14]/(n[10]+1),l=(n[9]+1)/n[5],u=(n[9]-1)/n[5],c=(n[8]-1)/n[0],h=(o[8]+1)/o[0],p=s*c,d=s*h,f=r/(-c+h),m=f*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var g=s+f,v=a+f,y=p-m,b=d+(r-m),_=l*a/v*g,x=u*a/v*g;e.projectionMatrix.makePerspective(y,b,_,x,g,v)}(f,c,h):f.projectionMatrix.copy(c.projectionMatrix),f};var M=null;var C=new $t;C.setAnimationLoop((function(t,i){if(null!==(a=i.getViewerPose(o))){var n=a.views,s=r.renderState.baseLayer;e.setFramebuffer(s.framebuffer);var u=!1;n.length!==f.cameras.length&&(f.cameras.length=0,u=!0);for(var c=0;c<n.length;c++){var h=n[c],d=s.getViewport(h),m=p[c];m.matrix.fromArray(h.transform.matrix),m.projectionMatrix.fromArray(h.projectionMatrix),m.viewport.set(d.x,d.y,d.width,d.height),0===c&&f.matrix.copy(m.matrix),!0===u&&f.cameras.push(m)}}for(var g=r.inputSources,v=0;v<l.length;v++){var y=l[v],b=g[v];y.update(b,i,o)}M&&M(t,i)})),this.setAnimationLoop=function(e){M=e},this.dispose=function(){}}function sn(e){function t(t,i){t.opacity.value=i.opacity,i.color&&t.diffuse.value.copy(i.color),i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(t.map.value=i.map),i.alphaMap&&(t.alphaMap.value=i.alphaMap),i.specularMap&&(t.specularMap.value=i.specularMap);var r,n,o=e.get(i).envMap;if(o){t.envMap.value=o,t.flipEnvMap.value=o.isCubeTexture?-1:1,t.reflectivity.value=i.reflectivity,t.refractionRatio.value=i.refractionRatio;var s=e.get(o).__maxMipLevel;void 0!==s&&(t.maxMipLevel.value=s)}i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap&&(r=i.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix),i.uvTransform&&i.uvTransform.isMatrix3&&t.uvTransform.value.copy(i.uvTransform)),i.alphaMap&&(!0===i.alphaMap.matrixAutoUpdate&&i.alphaMap.updateMatrix(),t.uvTransform1.value.copy(i.alphaMap.matrix)),i.alphaMap1&&(!0===i.alphaMap1.matrixAutoUpdate&&i.alphaMap1.updateMatrix(),t.uvTransform1.value.copy(i.alphaMap1.matrix)),(i.alphaMap||i.alphaMap1)&&i.uvTransform1&&i.uvTransform1.isMatrix3&&t.uvTransform1.value.copy(i.uvTransform1),i.emissiveMap&&(!0===i.emissiveMap.matrixAutoUpdate&&i.emissiveMap.updateMatrix(),t.uvTransform2.value.copy(i.emissiveMap.matrix),i.uvTransform2&&i.uvTransform2.isMatrix3&&t.uvTransform2.value.copy(i.uvTransform2)),i.aoMap?n=i.aoMap:i.lightMap&&(n=i.lightMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uv2Transform.value.copy(n.matrix))}function i(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,t.specularFactor.value=i.specularFactor,t.highlightColor.value.copy(i.highlightColor),t.highlightIntensity.value=i.highlightIntensity,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap),i.bumpMap&&(t.bumpMap.value=i.bumpMap,t.bumpScale.value=i.bumpScale,1===i.side&&(t.bumpScale.value*=-1)),i.normalMap&&(t.normalMap.value=i.normalMap,t.normalScale.value.copy(i.normalScale),1===i.side&&t.normalScale.value.negate()),i.displacementMap&&(t.displacementMap.value=i.displacementMap,t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias),e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),e.fogAlpha&&(e.fogAlpha.value=t.alpha?t.alpha:1),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(r,n,o,s){n.isMeshBasicMaterial?(t(r,n),n.emissiveMap&&(r.emissiveMap.value=n.emissiveMap),r.highlightColor.value.copy(n.highlightColor),r.highlightIntensity.value=n.highlightIntensity):n.isMeshLambertMaterial?(t(r,n),function(e,t){e.highlightColor.value.copy(t.highlightColor),e.highlightIntensity.value=t.highlightIntensity,t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(r,n)):n.isMeshToonMaterial?(t(r,n),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(r,n)):n.isMeshPhongMaterial?(t(r,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),e.highlightColor.value.copy(t.highlightColor),e.highlightIntensity.value=t.highlightIntensity,t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(r,n)):n.isMeshStandardMaterial?(t(r,n),n.isMeshPhysicalMaterial?function(e,t){i(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap);t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate());e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}(r,n):i(r,n)):n.isMeshMatcapMaterial?(t(r,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(r,n)):n.isMeshDepthMaterial?(t(r,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(r,n)):n.isMeshDistanceMaterial?(t(r,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(r,n)):n.isMeshNormalMaterial?(t(r,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(r,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(r,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(r,n)):n.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix),t.uvTransform&&t.uvTransform.isMatrix3&&e.uvTransform.value.copy(t.uvTransform))}(r,n,o,s):n.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix),t.uvTransform&&t.uvTransform.isMatrix3&&e.uvTransform.value.copy(t.uvTransform))}(r,n):n.isShadowMaterial?(r.color.value.copy(n.color),r.opacity.value=n.opacity):n.isShaderMaterial&&(n.useEnvironment&&(r.envMap.value=e.get(n).envMap),n.uniformsNeedUpdate=!1)}}}function an(){var e=new Map;this.$mode=0;var t=this;this.setMode=function(e){t.$mode=e},this.getMode=function(){return t.$mode},this.addStrategy=function(t,i){e.set(t,i)},this.getStrategy=function(){return e.get(t.$mode)},this.hasStrategy=function(t){return e.has(t)}}function ln(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,n=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,l=void 0!==e.antialias&&e.antialias,u=void 0===e.premultipliedAlpha||e.premultipliedAlpha,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,h=void 0!==e.powerPreference?e.powerPreference:"default",p=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,f=null,m=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.initRenderList=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var g=this,v=!1,y=null,_=0,x=0,E=null,w=null,T=-1,M=null,C=null,S=new d,j=new d,P=null,R=t.width,D=t.height,A=1,k=null,O=null,B=new d(0,0,R,D),F=new d(0,0,R,D),L=!1,I=new Kt,N=!1,U=!1,z=new X,H=new b,V={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function W(){return null===E?A:1}var G,q,J,Y,Z,Q,K,$,ee,te,ie,re,ne,oe,se,ae,le,ue,ce,he,pe,de=i;function fe(e,i){for(var r=0;r<e.length;r++){var n=e[r],o=t.getContext(n,i);if(null!==o)return o}return null}try{var me={alpha:r,depth:n,stencil:a,antialias:l,premultipliedAlpha:u,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:p};if(t.addEventListener("webglcontextlost",xe,!1),t.addEventListener("webglcontextrestored",Ee,!1),null===de){var ge=["webgl2","webgl","experimental-webgl"];if(!0===g.isWebGL1Renderer&&ge.shift(),null===(de=fe(ge,me)))throw fe(ge)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===de.getShaderPrecisionFormat&&(de.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ve(){G=new pi(de),!1===(q=new ui(de,G,e)).isWebGL2&&(G.get("WEBGL_depth_texture"),G.get("OES_texture_float"),G.get("OES_texture_half_float"),G.get("OES_texture_half_float_linear"),G.get("OES_standard_derivatives"),G.get("OES_element_index_uint"),G.get("OES_vertex_array_object"),G.get("ANGLE_instanced_arrays")),G.get("OES_texture_float_linear"),he=new en(de,G,q),(J=new Kr(de,G,q)).scissor(j.copy(F).multiplyScalar(A).floor()),J.viewport(S.copy(B).multiplyScalar(A).floor()),Y=new mi(de),Z=new Ir,Q=new $r(de,G,J,Z,q,he,Y),K=new hi(g),$=new ei(de,q),pe=new ai(de,G,$,q),ee=new di(de,$,Y,pe),te=new bi(de,ee,$,Y),le=new yi(de),se=new ci(Z),ie=new Lr(g,K,G,q,pe,se),re=new sn(Z),ne=new Hr(Z),oe=new Jr,ae=new si(g,K,J,te,u),ue=new li(de,G,Y,q),ce=new fi(de,G,Y,q),Y.programs=ie.programs,g.capabilities=q,g.extensions=G,g.properties=Z,g.renderLists=ne,g.state=J,g.info=Y,g.bindingStates=pe,g.state.enableAttribute=function(e){pe.enableAttribute(e)}}ve();var ye=new on(g,de);this.xr=ye;var be=new Qr(g,te,q.maxTextureSize);this.shadowMap=be;var _e=new an;function xe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function Ee(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1,ve()}function we(e){var t=e.target;t.removeEventListener("dispose",we),function(e){Te(e),Z.remove(e)}(t)}function Te(e){var t=Z.get(e).program;void 0!==t&&ie.releaseProgram(t)}this.materialManager=_e,this.onCustom1Finish=function(){},this.renderCustom1=!0,this.getContext=function(){return de},this.getContextAttributes=function(){return de.getContextAttributes()},this.forceContextLoss=function(){var e=G.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=G.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return A},this.setPixelRatio=function(e){void 0!==e&&(A=e,this.setSize(R,D,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new s),e.set(R,D)},this.setSize=function(e,i,r){ye.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(R=e,D=i,t.width=Math.floor(e*A),t.height=Math.floor(i*A),!1!==r&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new s),e.set(R*A,D*A).floor()},this.setDrawingBufferSize=function(e,i,r){R=e,D=i,A=r,t.width=Math.floor(e*r),t.height=Math.floor(i*r),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new d),e.copy(S)},this.getViewport=function(e){return e.copy(B)},this.setViewport=function(e,t,i,r){e.isVector4?B.set(e.x,e.y,e.z,e.w):B.set(e,t,i,r),J.viewport(S.copy(B).multiplyScalar(A).floor())},this.getScissor=function(e){return e.copy(F)},this.setScissor=function(e,t,i,r){e.isVector4?F.set(e.x,e.y,e.z,e.w):F.set(e,t,i,r),J.scissor(j.copy(F).multiplyScalar(A).floor())},this.getScissorTest=function(){return L},this.setScissorTest=function(e){J.setScissorTest(L=e)},this.setOpaqueSort=function(e){k=e},this.setTransparentSort=function(e){O=e},this.getClearColor=function(){return ae.getClearColor()},this.setClearColor=function(){ae.setClearColor.apply(ae,arguments)},this.getClearAlpha=function(){return ae.getClearAlpha()},this.setClearAlpha=function(){ae.setClearAlpha.apply(ae,arguments)},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===i||i)&&(r|=1024),de.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",xe,!1),t.removeEventListener("webglcontextrestored",Ee,!1),ne.dispose(),oe.dispose(),Z.dispose(),K.dispose(),te.dispose(),pe.dispose(),ye.dispose(),Ce.stop()},this.renderBufferImmediate=function(e,t){pe.initAttributes();var i=Z.get(e);e.hasPositions&&!i.position&&(i.position=de.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=de.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=de.createBuffer()),e.hasColors&&!i.color&&(i.color=de.createBuffer());var r=t.getAttributes();e.hasPositions&&(de.bindBuffer(34962,i.position),de.bufferData(34962,e.positionArray,35048),pe.enableAttribute(r.position),de.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(de.bindBuffer(34962,i.normal),de.bufferData(34962,e.normalArray,35048),pe.enableAttribute(r.normal),de.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(de.bindBuffer(34962,i.uv),de.bufferData(34962,e.uvArray,35048),pe.enableAttribute(r.uv),de.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(de.bindBuffer(34962,i.color),de.bufferData(34962,e.colorArray,35048),pe.enableAttribute(r.color),de.vertexAttribPointer(r.color,3,5126,!1,0,0)),pe.disableUnusedAttributes(),de.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,r,n,o){null===t&&(t=V);var s=n.isMesh&&n.matrixWorld.determinant()<0,a=De(e,t,r,n);J.setMaterial(r,s);var l=i.index,u=i.attributes.position;if(null===l){if(void 0===u||0===u.count)return}else if(0===l.count)return;var c,h=1;!0===r.wireframe&&(l=ee.getWireframeAttribute(i),h=2),(r.morphTargets||r.morphNormals)&&le.update(n,i,r,a),pe.setup(n,r,a,i,l);var p=ue;null!==l&&(c=$.get(l),(p=ce).setIndex(c));var d=null!==l?l.count:u.count,f=i.drawRange.start*h,m=i.drawRange.count*h,g=null!==o?o.start*h:0,v=null!==o?o.count*h:1/0,y=Math.max(f,g),b=Math.min(d,f+m,g+v)-1,_=Math.max(0,b-y+1);if(0!==_){if(n.isMesh)!0===r.wireframe?(J.setLineWidth(r.wireframeLinewidth*W()),p.setMode(1)):p.setMode(4);else if(n.isLine){var x=r.linewidth;void 0===x&&(x=1),J.setLineWidth(x*W()),n.isLineSegments?p.setMode(1):n.isLineLoop?p.setMode(2):p.setMode(3)}else n.isPoints?p.setMode(0):n.isSprite&&p.setMode(4);if(n.isInstancedMesh)p.renderInstances(y,_,n.count);else if(i.isInstancedBufferGeometry){var E=Math.min(i.instanceCount,i._maxInstanceCount);p.renderInstances(y,_,E)}else p.render(y,_)}},this.compile=function(e,t){(m=oe.get(e,t)).init(),e.traverse((function(e){e.isLight&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),m.setupLights(t);var i=new WeakMap;e.traverse((function(t){var r=t.material;if(r)if(Array.isArray(r))for(var n=0;n<r.length;n++){var o=r[n];!1===i.has(o)&&(Re(o,e,t),i.set(o))}else!1===i.has(r)&&(Re(r,e,t),i.set(r))}))};var Me=null;var Ce=new $t;function Se(e,t,i,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||I.intersectsSprite(e)){r&&H.setFromMatrixPosition(e.matrixWorld).applyMatrix4(z);var n=te.update(e),o=e.material;o.visible&&f.push(e,n,o,i,H.z,null)}}else if(e.isImmediateRenderObject)r&&H.setFromMatrixPosition(e.matrixWorld).applyMatrix4(z),f.push(e,null,e.material,i,H.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==Y.render.frame&&(e.skeleton.update(e),e.skeleton.frame=Y.render.frame),!e.frustumCulled||I.intersectsObject(e))){r&&H.setFromMatrixPosition(e.matrixWorld).applyMatrix4(z);var s=te.update(e),a=e.material;if(Array.isArray(a))for(var l=s.groups,u=0,c=l.length;u<c;u++){var h=l[u],p=a[h.materialIndex];p&&p.visible&&f.push(e,s,p,i,H.z,h)}else a.visible&&f.push(e,s,a,i,H.z,null)}for(var d=e.children,g=0,v=d.length;g<v;g++)Se(d[g],t,i,r)}}function je(e,t,i){for(var r=!0===t.isScene?t.overrideMaterial:null,n=0,o=e.length;n<o;n++){var s=e[n],a=s.object,l=s.geometry,u=null===r?s.material:r,c=s.group;if(i.isArrayCamera){C=i;for(var h=i.cameras,p=0,d=h.length;p<d;p++){var f=h[p];a.layers.test(f.layers)&&(J.viewport(S.copy(f.viewport)),m.setupLights(f),Pe(a,t,f,l,u,c))}}else C=null,Pe(a,t,i,l,u,c)}}function Pe(e,t,i,r,n,o){var s;s=e.onBeforeRender(g,t,i,r,n,o);var a=e.onBeforeUpdateModelViewMatrix;if(!a||null!==a.call(e,g,t,i,r,s,o)){if(0!==_e.$mode){var l=_e.getStrategy();l&&(s=l.call(e,this,t,i,r,n,o))}if(null!==s){if(s&&(n=s),m=oe.get(t,C||i),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var u=De(i,t,n,e);J.setMaterial(n),pe.reset(),function(e,t){e.render((function(e){g.renderBufferImmediate(e,t)}))}(e,u)}else g.renderBufferDirect(i,t,r,n,e,o);var c=e.onAfterUpdateModelViewMatrix;c&&null===c.call(e,g,t,i,r,s,o)||(e.onAfterRender(g,t,i,r,n,o),m=oe.get(t,C||i))}}}function Re(e,t,i){!0!==t.isScene&&(t=V);var r=Z.get(e),n=m.state.lights,o=m.state.shadowsArray,s=n.state.version,a=ie.getParameters(e,n.state,o,t,i),l=ie.getProgramCacheKey(a),u=r.program,c=!0;if(void 0===u)e.addEventListener("dispose",we);else if(u.cacheKey!==l)Te(e);else if(r.lightsStateVersion!==s)c=!1;else{if(void 0!==a.shaderID){var h=(null!==e.useEnvironment?e.useEnvironment:e.isMeshStandardMaterial)?t.environment:null;return void(r.envMap=K.get(e.envMap||h))}c=!1}c&&(a.uniforms=ie.getUniforms(e),e.onBeforeCompile(a,g),u=ie.acquireProgram(a,l),r.program=u,r.uniforms=a.uniforms,r.outputEncoding=a.outputEncoding);var p=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=se.numPlanes,r.numIntersection=se.numIntersection,p.clippingPlanes=se.uniform),r.environment=(null!==e.useEnvironment?e.useEnvironment:e.isMeshStandardMaterial)?t.environment:null,r.fog=t.fog,r.envMap=K.get(e.envMap||r.environment),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=s,r.needsLights&&(p.ambientLightColor.value=n.state.ambient,p.lightProbe.value=n.state.probe,p.directionalLights.value=n.state.directional,p.directionalLightShadows.value=n.state.directionalShadow,p.spotLights.value=n.state.spot,p.spotLightShadows.value=n.state.spotShadow,p.rectAreaLights.value=n.state.rectArea,p.ltc_1.value=n.state.rectAreaLTC1,p.ltc_2.value=n.state.rectAreaLTC2,p.pointLights.value=n.state.point,p.pointLightShadows.value=n.state.pointShadow,p.hemisphereLights.value=n.state.hemi,p.directionalShadowMap.value=n.state.directionalShadowMap,p.directionalShadowMatrix.value=n.state.directionalShadowMatrix,p.spotShadowMap.value=n.state.spotShadowMap,p.spotShadowMatrix.value=n.state.spotShadowMatrix,p.pointShadowMap.value=n.state.pointShadowMap,p.pointShadowMatrix.value=n.state.pointShadowMatrix);var d=r.program.getUniforms(),f=vr.seqWithValue(d.seq,p);r.uniformsList=f,r.logarithmicDepthBuffer=q.logarithmicDepthBuffer,r.envQuaternion=!!t.envQuaternion}function De(e,t,i,r){!0!==t.isScene&&(t=V),Q.resetTextureUnits();var n=t.fog,s=t.envQuaternion,a=(null!==i.useEnvironment?i.useEnvironment:i.isMeshStandardMaterial)?t.environment:null,l=g.outputEncoding,u=K.get(i.envMap||a),c=Z.get(i),h=m.state.lights;if(!0===N&&(!0===U||e!==M)){var p=e===M&&i.id===T;se.setState(i,e,p)}i.version===c.__version?i.fog&&c.fog!==n||c.environment!==a||c.needsLights&&c.lightsStateVersion!==h.state.version?Re(i,t,r):void 0===c.numClippingPlanes||c.numClippingPlanes===se.numPlanes&&c.numIntersection===se.numIntersection?c.logarithmicDepthBuffer!==q.logarithmicDepthBuffer?i.needsUpdate=!0:(c.outputEncoding!==l||c.envMap!==u||c.envQuaternion!==!!s)&&Re(i,t,r):Re(i,t,r):(Re(i,t,r),c.__version=i.version);var d,f,v=!1,y=!1,b=!1,_=c.program,x=_.getUniforms(),E=c.uniforms;if(J.useProgram(_.program)&&(v=!0,y=!0,b=!0),i.id!==T&&(T=i.id,y=!0),v||M!==e){if(x.setValue(de,"projectionMatrix",e.projectionMatrix),q.logarithmicDepthBuffer&&(x.setValue(de,"logDepthBufFC",2/(Math.log(e.far-e.near+1)*Math.LOG2E)),x.setValue(de,"logDepthCameraNear",e.near)),M!==e&&(M=e,y=!0,b=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){var w=x.map.cameraPosition;void 0!==w&&w.setValue(de,H.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&x.setValue(de,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||i.skinning)&&x.setValue(de,"viewMatrix",e.matrixWorldInverse)}if(i.skinning){x.setOptional(de,r,"bindMatrix"),x.setOptional(de,r,"bindMatrixInverse");var C=r.skeleton;if(C){var S=C.bones,j=r.bindMatrixInverse.clone();if(j.elements[12]=0,j.elements[13]=0,j.elements[14]=0,x.setValue(de,"localBindMatrixInverse",j),q.floatVertexTextures){if(void 0===C.boneTexture){var P=Math.sqrt(4*S.length);P=o.ceilPowerOfTwo(P),P=Math.max(P,4);var R=new Float32Array(P*P*4);R.set(C.boneMatrices);var k=new Yt(R,P,P,1023,1015);C.boneMatrices=R,C.boneTexture=k,C.boneTextureSize=P}x.setValue(de,"boneTexture",C.boneTexture,Q),x.setValue(de,"boneTextureSize",C.boneTextureSize)}else x.setOptional(de,C,"boneMatrices")}}return(y||c.receiveShadow!==r.receiveShadow)&&(c.receiveShadow=r.receiveShadow,x.setValue(de,"receiveShadow",r.receiveShadow)),y&&(x.setValue(de,"toneMappingExposure",g.toneMappingExposure),c.needsLights&&(f=b,(d=E).ambientLightColor.needsUpdate=f,d.lightProbe.needsUpdate=f,d.directionalLights.needsUpdate=f,d.directionalLightShadows.needsUpdate=f,d.pointLights.needsUpdate=f,d.pointLightShadows.needsUpdate=f,d.spotLights.needsUpdate=f,d.spotLightShadows.needsUpdate=f,d.rectAreaLights.needsUpdate=f,d.hemisphereLights.needsUpdate=f),n&&i.fog&&re.refreshFogUniforms(E,n),re.refreshMaterialUniforms(E,i,A,D),vr.upload(de,c.uniformsList,E,Q),i.colorMapping&&(x.setValue(de,"colorMapping",i.colorMapping,Q),x.setValue(de,"colorMappingIntensity",i.colorMappingIntensity)),(s||i.baseQuaternion)&&x.setValue(de,"envQuaternion",s||i.baseQuaternion),i.fresnelPower&&(x.setValue(de,"fresnelPower",i.fresnelPower),x.setValue(de,"fresnelInverse",i.fresnelInverse)),i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)),x.setValue(de,"baseId",i.baseId),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(vr.upload(de,c.uniformsList,E,Q),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&(x.setValue(de,"center",r.center),x.setValue(de,"rotation",r.spriteRotation||i.rotation)),x.setValue(de,"modelViewMatrix",r.modelViewMatrix),x.setValue(de,"normalMatrix",r.normalMatrix),x.setValue(de,"modelMatrix",r.matrixWorld),_}Ce.setAnimationLoop((function(e){ye.isPresenting||Me&&Me(e)})),"undefined"!=typeof window&&Ce.setContext(window),this.setAnimationLoop=function(e){Me=e,ye.setAnimationLoop(e),null===e?Ce.stop():Ce.start()},this.render=function(e,t){var i,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),i=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0===t||!0===t.isCamera){if(!0!==v){if(pe.resetDefaultState(),T=-1,M=null,this.initRenderList){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===ye.enabled&&!0===ye.isPresenting&&(t=ye.getCamera(t)),!0===e.isScene&&e.onBeforeRender(g,e,t,i||E),(m=oe.get(e,t)).init(),z.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),I.setFromProjectionMatrix(z),U=this.localClippingEnabled,N=se.init(this.clippingPlanes,U,t),(f=ne.get(e,t)).init(),Se(e,t,0,g.sortObjects),f.finish(),!0===g.sortObjects&&f.sort(k,O),!0===N&&se.beginShadows();var n=m.state.shadowsArray;be.render(n,e,t),m.setupLights(t),!0===N&&se.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i),ae.render(f,e,t,r)}else f=ne.get(e,t),this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i);var o=f.custom1,s=f.opaque,a=f.transparent;o.length&&this.renderCustom1&&(je(o,e,t),this.onCustom1Finish()),s.length>0&&je(s,e,t),a.length>0&&je(a,e,t),!0===e.isScene&&e.onAfterRender(g,e,t),null!==E&&(Q.updateRenderTargetMipmap(E),Q.updateMultisampleRenderTarget(E)),J.buffers.depth.setTest(!0),J.buffers.depth.setMask(!0),J.buffers.color.setMask(!0),J.setPolygonOffset(!1),f=null,m=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){y!==e&&null===E&&de.bindFramebuffer(36160,e),y=e},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return x},this.getRenderList=function(){return f},this.setRenderList=function(e){f=e},this.getRenderState=function(){return m},this.setRenderState=function(e){m=e},this.getRenderTarget=function(){return E},this.setRenderTarget=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0),E=e,_=t,x=i,e&&void 0===Z.get(e).__webglFramebuffer&&Q.setupRenderTarget(e);var r=y,n=!1;if(e){var o=Z.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=o[t],n=!0):r=e.isWebGLMultisampleRenderTarget?Z.get(e).__webglMultisampledFramebuffer:o,S.copy(e.viewport),j.copy(e.scissor),P=e.scissorTest}else S.copy(B).multiplyScalar(A).floor(),j.copy(F).multiplyScalar(A).floor(),P=L;if(w!==r&&(de.bindFramebuffer(36160,r),w=r),J.viewport(S),J.scissor(j),J.setScissorTest(P),n){var s=Z.get(e.texture);de.framebufferTexture2D(36160,36064,34069+t,s.__webglTexture,i)}},this.readRenderTargetPixels=function(e,t,i,r,n,o,s){if(e&&e.isWebGLRenderTarget){var a=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){var l=!1;a!==w&&(de.bindFramebuffer(36160,a),l=!0);try{var u=e.texture,c=u.format,h=u.type;if(1023!==c&&he.convert(c)!==de.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(1009===h||he.convert(h)===de.getParameter(35738)||1015===h&&(q.isWebGL2||G.get("OES_texture_float")||G.get("WEBGL_color_buffer_float"))||1016===h&&(q.isWebGL2?G.get("EXT_color_buffer_float"):G.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===de.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&i>=0&&i<=e.height-n&&de.readPixels(t,i,r,n,he.convert(c),he.convert(h),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&de.bindFramebuffer(36160,w)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,i){void 0===i&&(i=0);var r=Math.pow(2,-i),n=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r),s=he.convert(t.format);Q.setTexture2D(t,0),de.copyTexImage2D(3553,i,s,e.x,e.y,n,o,0),J.unbindTexture()},this.copyTextureToTexture=function(e,t,i,r){void 0===r&&(r=0);var n=t.image.width,o=t.image.height,s=he.convert(i.format),a=he.convert(i.type);Q.setTexture2D(i,0),de.pixelStorei(37440,i.flipY),de.pixelStorei(37441,i.premultiplyAlpha),de.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?de.texSubImage2D(3553,r,e.x,e.y,n,o,s,a,t.image.data):t.isCompressedTexture?de.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):de.texSubImage2D(3553,r,e.x,e.y,s,a,t.image),0===r&&i.generateMipmaps&&de.generateMipmap(3553),J.unbindTexture()},this.initTexture=function(e){Q.setTexture2D(e,0),J.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function un(e){ln.call(this,e)}tn.prototype=Object.assign(Object.create(qt.prototype),{constructor:tn,isArrayCamera:!0}),rn.prototype=Object.assign(Object.create(be.prototype),{constructor:rn,isGroup:!0}),Object.assign(nn.prototype,{constructor:nn,getHandSpace:function(){if(null===this._hand&&(this._hand=new rn,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(var e=0;e<=window.XRHand.LITTLE_PHALANX_TIP;e++){var t=new rn;t.matrixAutoUpdate=!1,t.visible=!1,this._hand.joints.push(t),this._hand.add(t)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new rn,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new rn,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(e,t,i){var r=null,n=null,o=null,s=this._targetRay,a=this._grip,l=this._hand;if(e)if(l&&e.hand){o=!0;for(var u=0;u<=window.XRHand.LITTLE_PHALANX_TIP;u++)if(e.hand[u]){var c=t.getJointPose(e.hand[u],i),h=l.joints[u];null!==c&&(h.matrix.fromArray(c.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),h.jointRadius=c.radius),h.visible=null!==c;var p=l.joints[window.XRHand.INDEX_PHALANX_TIP],d=l.joints[window.XRHand.THUMB_PHALANX_TIP],f=p.position.distanceTo(d.position);l.inputState.pinching&&f>.025?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&f<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}}else null!==s&&null!==(r=t.getPose(e.targetRaySpace,i))&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale)),null!==a&&e.gripSpace&&null!==(n=t.getPose(e.gripSpace,i))&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale));return null!==s&&(s.visible=null!==r),null!==a&&(a.visible=null!==n),null!==l&&(l.visible=null!==o),this}}),Object.assign(on.prototype,t.prototype),un.prototype=Object.assign(Object.create(ln.prototype),{constructor:un,isWebGL1Renderer:!0});var cn=function(e,t){Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new ze(e),this.density=void 0!==t?t:25e-5};cn.prototype.clone=function(){return new cn(this.color,this.density)},cn.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};var hn=function(e,t,i){Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new ze(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3};hn.prototype.clone=function(){return new hn(this.color,this.near,this.far)},hn.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};var pn=function(e){function t(){e.call(this),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.envQuaternion=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.copy=function(t,i){return e.prototype.copy.call(this,t,i),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),t.envQuaternion?this.envQuaternion=t.envQuaternion.clone():this.envQuaternion=null,null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},t.prototype.toJSON=function(t){var i=e.prototype.toJSON.call(this,t);return null!==this.background&&(i.object.background=this.background.toJSON(t)),null!==this.environment&&(i.object.environment=this.environment.toJSON(t)),null!==this.fog&&(i.object.fog=this.fog.toJSON()),i},t}(be);function dn(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=o.generateUUID()}Object.defineProperty(dn.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(dn.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=o.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new dn(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=o.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});var fn,mn=new b;function gn(e,t,i,r){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===r}function vn(e){We.call(this),this.type="SpriteMaterial",this.color=new ze(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.defineProperties(gn.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(e){this.data.needsUpdate=e}}}),Object.assign(gn.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,i=this.data.count;t<i;t++)mn.x=this.getX(t),mn.y=this.getY(t),mn.z=this.getZ(t),mn.applyMatrix4(e),this.setXYZ(t,mn.x,mn.y,mn.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this},clone:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],i=0;i<this.count;i++)for(var r=i*this.data.stride+this.offset,n=0;n<this.itemSize;n++)t.push(this.data.array[r+n]);return new Je(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new gn(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],i=0;i<this.count;i++)for(var r=i*this.data.stride+this.offset,n=0;n<this.itemSize;n++)t.push(this.data.array[r+n]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),vn.prototype=Object.create(We.prototype),vn.prototype.constructor=vn,vn.prototype.isSpriteMaterial=!0,vn.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var yn=new b,bn=new b,_n=new b,xn=new s,En=new s,wn=new X,Tn=new b,Mn=new b,Cn=new b,Sn=new s,jn=new s,Pn=new s;function Rn(e){if(be.call(this),this.type="Sprite",void 0===fn){fn=new dt;var t=new dn(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);fn.setIndex([0,1,2,0,2,3]),fn.setAttribute("position",new gn(t,3,0,!1)),fn.setAttribute("uv",new gn(t,2,3,!1))}this.geometry=fn,this.material=void 0!==e?e:new vn,this.center=new s(.5,.5),this.spriteRotation=0}function Dn(e,t,i,r,n,o){xn.subVectors(e,i).addScalar(.5).multiply(r),void 0!==n?(En.x=o*xn.x-n*xn.y,En.y=n*xn.x+o*xn.y):En.copy(xn),e.copy(t),e.x+=En.x,e.y+=En.y,e.applyMatrix4(wn)}Rn.prototype=Object.assign(Object.create(be.prototype),{constructor:Rn,isSprite:!0,raycast:function(e,t){if(null!==e.camera){bn.setFromMatrixScale(this.matrixWorld),wn.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_n.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&bn.multiplyScalar(-_n.z);var i,r,n=this.spriteRotation||this.material.rotation;0!==n&&(r=Math.cos(n),i=Math.sin(n));var o=this.center;Dn(Tn.set(-.5,-.5,0),_n,o,bn,i,r),Dn(Mn.set(.5,-.5,0),_n,o,bn,i,r),Dn(Cn.set(.5,.5,0),_n,o,bn,i,r),Sn.set(0,0),jn.set(1,0),Pn.set(1,1);var a=e.ray.intersectTriangle(Tn,Mn,Cn,!1,yn);if(null!==a||(Dn(Mn.set(-.5,.5,0),_n,o,bn,i,r),jn.set(0,1),null!==(a=e.ray.intersectTriangle(Tn,Cn,Mn,!1,yn)))){var l=e.ray.origin.distanceTo(yn);l<e.near||l>e.far||t.push({distance:l,point:yn.clone(),uv:Oe.getUV(yn,Tn,Mn,Cn,Sn,jn,Pn,new s),face:null,object:this})}}},copy:function(e){return be.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),void 0!==e.spriteRotation&&(this.spriteRotation=e.spriteRotation),this.material=e.material,this}});var An,kn,On,Bn,Fn,Ln=new b,In=new b;function Nn(){be.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function Un(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Dt.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new X,this.bindMatrixInverse=new X}Nn.prototype=Object.assign(Object.create(be.prototype),{constructor:Nn,isLOD:!0,copy:function(e){be.prototype.copy.call(this,e,!1);for(var t=e.levels,i=0,r=t.length;i<r;i++){var n=t[i];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);var i,r=this.levels;for(i=0;i<r.length&&!(t<r[i].distance);i++);return r.splice(i,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){var i,r;for(i=1,r=t.length;i<r&&!(e<t[i].distance);i++);return t[i-1].object}return null},raycast:function(e,t){if(this.levels.length>0){Ln.setFromMatrixPosition(this.matrixWorld);var i=e.ray.origin.distanceTo(Ln);this.getObjectForDistance(i).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){Ln.setFromMatrixPosition(e.matrixWorld),In.setFromMatrixPosition(this.matrixWorld);var i,r,n=Ln.distanceTo(In)/e.zoom;for(t[0].object.visible=!0,i=1,r=t.length;i<r&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}},toJSON:function(e){var t=be.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var i=this.levels,r=0,n=i.length;r<n;r++){var o=i[r];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),Un.prototype=Object.assign(Object.create(Dt.prototype),{constructor:Un,isSkinnedMesh:!0,copy:function(e){return Dt.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new d,t=this.geometry.attributes.skinWeight,i=0,r=t.count;i<r;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);var n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Dt.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:(An=new b,kn=new d,On=new d,Bn=new b,Fn=new X,function(e,t){var i=this.skeleton,r=this.geometry;kn.fromBufferAttribute(r.attributes.skinIndex,e),On.fromBufferAttribute(r.attributes.skinWeight,e),An.fromBufferAttribute(r.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var n=0;n<4;n++){var o=On.getComponent(n);if(0!==o){var s=kn.getComponent(n);Fn.multiplyMatrices(i.bones[s].matrixWorld,i.boneInverses[s]),t.addScaledVector(Bn.copy(An).applyMatrix4(Fn),o)}}return t.applyMatrix4(this.bindMatrixInverse)})});var zn=new X,Hn=new X,Vn=new b;function Wn(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new X)}}function Gn(){be.call(this),this.type="Bone"}Object.assign(Wn.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new X;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},pose:function(){for(var e=0,t=this.bones.length;e<t;e++){var i=this.bones[e];i&&i.matrixWorld.getInverse(this.boneInverses[e])}for(var r=0,n=this.bones.length;r<n;r++){var o=this.bones[r];o&&(o.parent&&o.parent.isBone?(o.matrix.getInverse(o.parent.matrixWorld),o.matrix.multiply(o.matrixWorld)):o.matrix.copy(o.matrixWorld),o.matrix.decompose(o.position,o.quaternion,o.scale))}},update:function(e){var t=this.bones,i=this.boneInverses,r=this.boneMatrices,n=this.boneTexture;e.getWorldPosition(Vn);for(var o=0,s=t.length;o<s;o++){var a=t[o]?t[o].matrixWorld:Hn;zn.multiplyMatrices(a,i[o]);var l=zn.elements;l[12]-=Vn.x,l[13]-=Vn.y,l[14]-=Vn.z,zn.toArray(r,16*o)}void 0!==n&&(n.needsUpdate=!0)},clone:function(){return new Wn(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,i=this.bones.length;t<i;t++){var r=this.bones[t];if(r.name===e)return r}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),Gn.prototype=Object.assign(Object.create(be.prototype),{constructor:Gn,isBone:!0});var qn=new X,Xn=new X,Jn=[],Yn=new Dt;function Zn(e,t,i){Dt.call(this,e,t),this.instanceMatrix=new Je(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}function Qn(e){We.call(this),this.type="LineBasicMaterial",this.color=new ze(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}Zn.prototype=Object.assign(Object.create(Dt.prototype),{constructor:Zn,isInstancedMesh:!0,copy:function(e){return Dt.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),this.count=e.count,this},setColorAt:function(e,t){null===this.instanceColor&&(this.instanceColor=new Je(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var i=this.matrixWorld,r=this.count;if(Yn.geometry=this.geometry,Yn.material=this.material,void 0!==Yn.material)for(var n=0;n<r;n++){this.getMatrixAt(n,qn),Xn.multiplyMatrices(i,qn),Yn.matrixWorld=Xn,Yn.raycast(e,Jn);for(var o=0,s=Jn.length;o<s;o++){var a=Jn[o];a.instanceId=n,a.object=this,t.push(a)}Jn.length=0}},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Qn.prototype=Object.create(We.prototype),Qn.prototype.constructor=Qn,Qn.prototype.isLineBasicMaterial=!0,Qn.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};var Kn=new b,$n=new b,eo=new X,to=new q,io=new I;function ro(e,t,i){1===i&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),be.call(this),this.type="Line",this.geometry=void 0!==e?e:new dt,this.material=void 0!==t?t:new Qn,this.updateMorphTargets()}ro.prototype=Object.assign(Object.create(be.prototype),{constructor:ro,isLine:!0,copy:function(e){return be.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,i=[0],r=1,n=t.count;r<n;r++)Kn.fromBufferAttribute(t,r-1),$n.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=Kn.distanceTo($n);e.setAttribute("lineDistance",new it(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices,s=e.lineDistances;s[0]=0;for(var a=1,l=o.length;a<l;a++)s[a]=s[a-1],s[a]+=o[a-1].distanceTo(o[a])}return this},raycast:function(e,t){var i=this.geometry,r=this.matrixWorld,n=e.params.Line.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),io.copy(i.boundingSphere),io.applyMatrix4(r),io.radius+=n,!1!==e.ray.intersectsSphere(io)){eo.getInverse(r),to.copy(e.ray).applyMatrix4(eo);var o=n/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,a=new b,l=new b,u=new b,c=new b,h=this&&this.isLineSegments?2:1;if(i.isBufferGeometry){var p=i.index,d=i.attributes.position.array;if(null!==p)for(var f=p.array,m=0,g=f.length-1;m<g;m+=h){var v=f[m],y=f[m+1];if(a.fromArray(d,3*v),l.fromArray(d,3*y),!(to.distanceSqToSegment(a,l,c,u)>s)){c.applyMatrix4(this.matrixWorld);var _=e.ray.origin.distanceTo(c);_<e.near||_>e.far||t.push({distance:_,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else for(var x=0,E=d.length/3-1;x<E;x+=h){if(a.fromArray(d,3*x),l.fromArray(d,3*x+3),!(to.distanceSqToSegment(a,l,c,u)>s)){c.applyMatrix4(this.matrixWorld);var w=e.ray.origin.distanceTo(c);w<e.near||w>e.far||t.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}else if(i.isGeometry)for(var T=i.vertices,M=T.length,C=0;C<M-1;C+=h){if(!(to.distanceSqToSegment(T[C],T[C+1],c,u)>s)){c.applyMatrix4(this.matrixWorld);var S=e.ray.origin.distanceTo(c);S<e.near||S>e.far||t.push({distance:S,point:u.clone().applyMatrix4(this.matrixWorld),index:C,face:null,faceIndex:null,object:this})}}}},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,i=Object.keys(t);if(i.length>0){var r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var n=0,o=r.length;n<o;n++){var s=r[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=n}}}}else{var a=e.morphTargets;void 0!==a&&a.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});var no=new b,oo=new b;function so(e,t){ro.call(this,e,t),this.type="LineSegments"}function ao(e,t){ro.call(this,e,t),this.type="LineLoop"}function lo(e){We.call(this),this.type="PointsMaterial",this.color=new ze(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}so.prototype=Object.assign(Object.create(ro.prototype),{constructor:so,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,i=[],r=0,n=t.count;r<n;r+=2)no.fromBufferAttribute(t,r),oo.fromBufferAttribute(t,r+1),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+no.distanceTo(oo);e.setAttribute("lineDistance",new it(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry)for(var o=e.vertices,s=e.lineDistances,a=0,l=o.length;a<l;a+=2)no.copy(o[a]),oo.copy(o[a+1]),s[a]=0===a?0:s[a-1],s[a+1]=s[a]+no.distanceTo(oo);return this}}),ao.prototype=Object.assign(Object.create(ro.prototype),{constructor:ao,isLineLoop:!0}),lo.prototype=Object.create(We.prototype),lo.prototype.constructor=lo,lo.prototype.isPointsMaterial=!0,lo.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var uo=new X,co=new q,ho=new I,po=new b;function fo(e,t){be.call(this),this.type="Points",this.geometry=void 0!==e?e:new dt,this.material=void 0!==t?t:new lo,this.updateMorphTargets()}function mo(e,t,i,r,n,o,s){var a=co.distanceSqToPoint(e);if(a<i){var l=new b;co.closestPointToPoint(e,l),l.applyMatrix4(r);var u=n.ray.origin.distanceTo(l);if(u<n.near||u>n.far)return;o.push({distance:u,distanceToRay:Math.sqrt(a),point:l,index:t,face:null,object:s})}}function go(e,t,i,r,n,o,s,a,l){p.call(this,e,t,i,r,n,o,s,a,l),this.format=void 0!==s?s:1022,this.minFilter=void 0!==o?o:1006,this.magFilter=void 0!==n?n:1006,this.generateMipmaps=!1;var u=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){u.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}function vo(e,t,i,r,n,o,s,a,l,u,c,h){p.call(this,null,o,s,a,l,u,r,n,c,h),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function yo(e,t,i,r,n,o,s,a,l){p.call(this,e,t,i,r,n,o,s,a,l),this.needsUpdate=!0}function bo(e,t,i,r,n,o,s,a,l,u){if(1026!==(u=void 0!==u?u:1026)&&1027!==u)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&1026===u&&(i=1012),void 0===i&&1027===u&&(i=1020),p.call(this,null,r,n,o,s,a,u,i,l),this.image={width:e,height:t},this.magFilter=void 0!==s?s:1003,this.minFilter=void 0!==a?a:1003,this.flipY=!1,this.generateMipmaps=!1}fo.prototype=Object.assign(Object.create(be.prototype),{constructor:fo,isPoints:!0,copy:function(e){return be.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){var i=this.geometry,r=this.matrixWorld,n=e.params.Points.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),ho.copy(i.boundingSphere),ho.applyMatrix4(r),ho.radius+=n,!1!==e.ray.intersectsSphere(ho)){uo.getInverse(r),co.copy(e.ray).applyMatrix4(uo);var o=n/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(i.isBufferGeometry){var a=i.index,l=i.attributes.position.array;if(null!==a)for(var u=a.array,c=0,h=u.length;c<h;c++){var p=u[c];po.fromArray(l,3*p),mo(po,p,s,r,e,t,this)}else for(var d=0,f=l.length/3;d<f;d++)po.fromArray(l,3*d),mo(po,d,s,r,e,t,this)}else for(var m=i.vertices,g=0,v=m.length;g<v;g++)mo(m[g],g,s,r,e,t,this)}},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,i=Object.keys(t);if(i.length>0){var r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var n=0,o=r.length;n<o;n++){var s=r[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=n}}}}else{var a=e.morphTargets;void 0!==a&&a.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),go.prototype=Object.assign(Object.create(p.prototype),{constructor:go,isVideoTexture:!0,update:function(){var e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),vo.prototype=Object.create(p.prototype),vo.prototype.constructor=vo,vo.prototype.isCompressedTexture=!0,yo.prototype=Object.create(p.prototype),yo.prototype.constructor=yo,yo.prototype.isCanvasTexture=!0,bo.prototype=Object.create(p.prototype),bo.prototype.constructor=bo,bo.prototype.isDepthTexture=!0;var _o=function(e){function t(t){e.call(this),this.type="WireframeGeometry";var i=[],r=[0,0],n={},o=["a","b","c"];if(t&&t.isGeometry){for(var s=t.faces,a=0,l=s.length;a<l;a++)for(var u=s[a],c=0;c<3;c++){var h=u[o[c]],p=u[o[(c+1)%3]];r[0]=Math.min(h,p),r[1]=Math.max(h,p);var d=r[0]+","+r[1];void 0===n[d]&&(n[d]={index1:r[0],index2:r[1]})}for(var f in n){var m=n[f],g=t.vertices[m.index1];i.push(g.x,g.y,g.z),g=t.vertices[m.index2],i.push(g.x,g.y,g.z)}}else if(t&&t.isBufferGeometry){var v=new b;if(null!==t.index){var y=t.attributes.position,_=t.index,x=t.groups;0===x.length&&(x=[{start:0,count:_.count,materialIndex:0}]);for(var E=0,w=x.length;E<w;++E)for(var T=x[E],M=T.start,C=M,S=M+T.count;C<S;C+=3)for(var j=0;j<3;j++){var P=_.getX(C+j),R=_.getX(C+(j+1)%3);r[0]=Math.min(P,R),r[1]=Math.max(P,R);var D=r[0]+","+r[1];void 0===n[D]&&(n[D]={index1:r[0],index2:r[1]})}for(var A in n){var k=n[A];v.fromBufferAttribute(y,k.index1),i.push(v.x,v.y,v.z),v.fromBufferAttribute(y,k.index2),i.push(v.x,v.y,v.z)}}else for(var O=t.attributes.position,B=0,F=O.count/3;B<F;B++)for(var L=0;L<3;L++){var I=3*B+L;v.fromBufferAttribute(O,I),i.push(v.x,v.y,v.z);var N=3*B+(L+1)%3;v.fromBufferAttribute(O,N),i.push(v.x,v.y,v.z)}}this.setAttribute("position",new it(i,3))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt);function xo(e,t,i){It.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new Eo(e,t,i)),this.mergeVertices()}function Eo(e,t,i){dt.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:i};var r=[],n=[],o=[],s=[],a=1e-5,l=new b,u=new b,c=new b,h=new b,p=new b;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");for(var d=t+1,f=0;f<=i;f++)for(var m=f/i,g=0;g<=t;g++){var v=g/t;e(v,m,u),n.push(u.x,u.y,u.z),v-a>=0?(e(v-a,m,c),h.subVectors(u,c)):(e(v+a,m,c),h.subVectors(c,u)),m-a>=0?(e(v,m-a,c),p.subVectors(u,c)):(e(v,m+a,c),p.subVectors(c,u)),l.crossVectors(h,p).normalize(),o.push(l.x,l.y,l.z),s.push(v,m)}for(var y=0;y<i;y++)for(var _=0;_<t;_++){var x=y*d+_,E=y*d+_+1,w=(y+1)*d+_+1,T=(y+1)*d+_;r.push(x,E,T),r.push(E,w,T)}this.setIndex(r),this.setAttribute("position",new it(n,3)),this.setAttribute("normal",new it(o,3)),this.setAttribute("uv",new it(s,2))}xo.prototype=Object.create(It.prototype),xo.prototype.constructor=xo,Eo.prototype=Object.create(dt.prototype),Eo.prototype.constructor=Eo;var wo=function(e){function t(t,i,r,n){e.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:i,radius:r,detail:n},this.fromBufferGeometry(new To(t,i,r,n)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),To=function(e){function t(t,i,r,n){e.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:i,radius:r,detail:n},r=r||1;var o=[],a=[];function l(e,t,i,r){for(var n=Math.pow(2,r),o=[],s=0;s<=n;s++){o[s]=[];for(var a=e.clone().lerp(i,s/n),l=t.clone().lerp(i,s/n),c=n-s,h=0;h<=c;h++)o[s][h]=0===h&&s===n?a:a.clone().lerp(l,h/c)}for(var p=0;p<n;p++)for(var d=0;d<2*(n-p)-1;d++){var f=Math.floor(d/2);d%2==0?(u(o[p][f+1]),u(o[p+1][f]),u(o[p][f])):(u(o[p][f+1]),u(o[p+1][f+1]),u(o[p+1][f]))}}function u(e){o.push(e.x,e.y,e.z)}function c(e,i){var r=3*e;i.x=t[r+0],i.y=t[r+1],i.z=t[r+2]}function h(e,t,i,r){r<0&&1===e.x&&(a[t]=e.x-1),0===i.x&&0===i.z&&(a[t]=r/2/Math.PI+.5)}function p(e){return Math.atan2(e.z,-e.x)}function d(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){for(var t=new b,r=new b,n=new b,o=0;o<i.length;o+=3)c(i[o+0],t),c(i[o+1],r),c(i[o+2],n),l(t,r,n,e)}(n=n||0),function(e){for(var t=new b,i=0;i<o.length;i+=3)t.x=o[i+0],t.y=o[i+1],t.z=o[i+2],t.normalize().multiplyScalar(e),o[i+0]=t.x,o[i+1]=t.y,o[i+2]=t.z}(r),function(){for(var e=new b,t=0;t<o.length;t+=3){e.x=o[t+0],e.y=o[t+1],e.z=o[t+2];var i=p(e)/2/Math.PI+.5,r=d(e)/Math.PI+.5;a.push(i,1-r)}(function(){for(var e=new b,t=new b,i=new b,r=new b,n=new s,l=new s,u=new s,c=0,d=0;c<o.length;c+=9,d+=6){e.set(o[c+0],o[c+1],o[c+2]),t.set(o[c+3],o[c+4],o[c+5]),i.set(o[c+6],o[c+7],o[c+8]),n.set(a[d+0],a[d+1]),l.set(a[d+2],a[d+3]),u.set(a[d+4],a[d+5]),r.copy(e).add(t).add(i).divideScalar(3);var f=p(r);h(n,d+0,e,f),h(l,d+2,t,f),h(u,d+4,i,f)}})(),function(){for(var e=0;e<a.length;e+=6){var t=a[e+0],i=a[e+2],r=a[e+4],n=Math.max(t,i,r),o=Math.min(t,i,r);n>.9&&o<.1&&(t<.2&&(a[e+0]+=1),i<.2&&(a[e+2]+=1),r<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new it(o,3)),this.setAttribute("normal",new it(o.slice(),3)),this.setAttribute("uv",new it(a,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),Mo=function(e){function t(t,i){e.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:i},this.fromBufferGeometry(new Co(t,i)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Co=function(e){function t(t,i){e.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,i),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:i}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(To),So=function(e){function t(t,i){e.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:i},this.fromBufferGeometry(new jo(t,i)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),jo=function(e){function t(t,i){e.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,i),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:i}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(To),Po=function(e){function t(t,i){e.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:i},this.fromBufferGeometry(new Ro(t,i)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Ro=function(e){function t(t,i){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];e.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,i),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:i}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(To),Do=function(e){function t(t,i){e.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:i},this.fromBufferGeometry(new Ao(t,i)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Ao=function(e){function t(t,i){var r=(1+Math.sqrt(5))/2,n=1/r,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];e.call(this,o,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,i),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:i}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(To),ko=function(e){function t(t,i,r,n,o,s){e.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:i,radius:r,radialSegments:n,closed:o},void 0!==s&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new Oo(t,i,r,n,o);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Oo=function(e){function t(t,i,r,n,o){e.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:i,radius:r,radialSegments:n,closed:o},i=i||64,r=r||1,n=n||8,o=o||!1;var a=t.computeFrenetFrames(i,o);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var l=new b,u=new b,c=new s,h=new b,p=[],d=[],f=[],m=[];function g(e){h=t.getPointAt(e/i,h);for(var o=a.normals[e],s=a.binormals[e],c=0;c<=n;c++){var f=c/n*Math.PI*2,m=Math.sin(f),g=-Math.cos(f);u.x=g*o.x+m*s.x,u.y=g*o.y+m*s.y,u.z=g*o.z+m*s.z,u.normalize(),d.push(u.x,u.y,u.z),l.x=h.x+r*u.x,l.y=h.y+r*u.y,l.z=h.z+r*u.z,p.push(l.x,l.y,l.z)}}!function(){for(var e=0;e<i;e++)g(e);g(!1===o?i:0),function(){for(var e=0;e<=i;e++)for(var t=0;t<=n;t++)c.x=e/i,c.y=t/n,f.push(c.x,c.y)}(),function(){for(var e=1;e<=i;e++)for(var t=1;t<=n;t++){var r=(n+1)*(e-1)+(t-1),o=(n+1)*e+(t-1),s=(n+1)*e+t,a=(n+1)*(e-1)+t;m.push(r,o,a),m.push(o,s,a)}}()}(),this.setIndex(m),this.setAttribute("position",new it(p,3)),this.setAttribute("normal",new it(d,3)),this.setAttribute("uv",new it(f,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},t}(dt),Bo=function(e){function t(t,i,r,n,o,s,a){e.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:i,tubularSegments:r,radialSegments:n,p:o,q:s},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Fo(t,i,r,n,o,s)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Fo=function(e){function t(t,i,r,n,o,s){e.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:i,tubularSegments:r,radialSegments:n,p:o,q:s},t=t||1,i=i||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,o=o||2,s=s||3;for(var a=[],l=[],u=[],c=[],h=new b,p=new b,d=new b,f=new b,m=new b,g=new b,v=new b,y=0;y<=r;++y){var _=y/r*o*Math.PI*2;D(_,o,s,t,d),D(_+.01,o,s,t,f),g.subVectors(f,d),v.addVectors(f,d),m.crossVectors(g,v),v.crossVectors(m,g),m.normalize(),v.normalize();for(var x=0;x<=n;++x){var E=x/n*Math.PI*2,w=-i*Math.cos(E),T=i*Math.sin(E);h.x=d.x+(w*v.x+T*m.x),h.y=d.y+(w*v.y+T*m.y),h.z=d.z+(w*v.z+T*m.z),l.push(h.x,h.y,h.z),p.subVectors(h,d).normalize(),u.push(p.x,p.y,p.z),c.push(y/r),c.push(x/n)}}for(var M=1;M<=r;M++)for(var C=1;C<=n;C++){var S=(n+1)*(M-1)+(C-1),j=(n+1)*M+(C-1),P=(n+1)*M+C,R=(n+1)*(M-1)+C;a.push(S,j,R),a.push(j,P,R)}function D(e,t,i,r,n){var o=Math.cos(e),s=Math.sin(e),a=i/t*e,l=Math.cos(a);n.x=r*(2+l)*.5*o,n.y=r*(2+l)*s*.5,n.z=r*Math.sin(a)*.5}this.setIndex(a),this.setAttribute("position",new it(l,3)),this.setAttribute("normal",new it(u,3)),this.setAttribute("uv",new it(c,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),Lo=function(e){function t(t,i,r,n,o){e.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:i,radialSegments:r,tubularSegments:n,arc:o},this.fromBufferGeometry(new Io(t,i,r,n,o)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Io=function(e){function t(t,i,r,n,o){e.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:i,radialSegments:r,tubularSegments:n,arc:o},t=t||1,i=i||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,o=o||2*Math.PI;for(var s=[],a=[],l=[],u=[],c=new b,h=new b,p=new b,d=0;d<=r;d++)for(var f=0;f<=n;f++){var m=f/n*o,g=d/r*Math.PI*2;h.x=(t+i*Math.cos(g))*Math.cos(m),h.y=(t+i*Math.cos(g))*Math.sin(m),h.z=i*Math.sin(g),a.push(h.x,h.y,h.z),c.x=t*Math.cos(m),c.y=t*Math.sin(m),p.subVectors(h,c).normalize(),l.push(p.x,p.y,p.z),u.push(f/n),u.push(d/r)}for(var v=1;v<=r;v++)for(var y=1;y<=n;y++){var _=(n+1)*v+y-1,x=(n+1)*(v-1)+y-1,E=(n+1)*(v-1)+y,w=(n+1)*v+y;s.push(_,x,w),s.push(x,E,w)}this.setIndex(s),this.setAttribute("position",new it(a,3)),this.setAttribute("normal",new it(l,3)),this.setAttribute("uv",new it(u,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),No=function(e,t,i){i=i||2;var r,n,o,s,a,l,u,c=t&&t.length,h=c?t[0]*i:e.length,p=Uo(e,0,h,i,!0),d=[];if(!p||p.next===p.prev)return d;if(c&&(p=function(e,t,i,r){var n,o,s,a=[];for(n=0,o=t.length;n<o;n++)(s=Uo(e,t[n]*r,n<o-1?t[n+1]*r:e.length,r,!1))===s.next&&(s.steiner=!0),a.push(Qo(s));for(a.sort(Xo),n=0;n<a.length;n++)Jo(a[n],i),i=zo(i,i.next);return i}(e,t,p,i)),e.length>80*i){r=o=e[0],n=s=e[1];for(var f=i;f<h;f+=i)(a=e[f])<r&&(r=a),(l=e[f+1])<n&&(n=l),a>o&&(o=a),l>s&&(s=l);u=0!==(u=Math.max(o-r,s-n))?1/u:0}return Ho(p,d,i,r,n,u),d};function Uo(e,t,i,r,n){var o,s;if(n===function(e,t,i,r){for(var n=0,o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}(e,t,i,r)>0)for(o=t;o<i;o+=r)s=as(o,e[o],e[o+1],s);else for(o=i-r;o>=t;o-=r)s=as(o,e[o],e[o+1],s);return s&&ts(s,s.next)&&(ls(s),s=s.next),s}function zo(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!ts(r,r.next)&&0!==es(r.prev,r,r.next))r=r.next;else{if(ls(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function Ho(e,t,i,r,n,o,s){if(e){!s&&o&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=Zo(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,o,s,a,l,u=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,r=i,a=0,t=0;t<u&&(a++,r=r.nextZ);t++);for(l=u;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,u*=2}while(s>1)}(n)}(e,r,n,o);for(var a,l,u=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?Wo(e,r,n,o):Vo(e))t.push(a.i/i),t.push(e.i/i),t.push(l.i/i),ls(e),e=l.next,u=l.next;else if((e=l)===u){s?1===s?Ho(e=Go(zo(e),t,i),t,i,r,n,o,2):2===s&&qo(e,t,i,r,n,o):Ho(zo(e),t,i,r,n,o,1);break}}}function Vo(e){var t=e.prev,i=e,r=e.next;if(es(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(Ko(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&es(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function Wo(e,t,i,r){var n=e.prev,o=e,s=e.next;if(es(n,o,s)>=0)return!1;for(var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,l=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,u=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,c=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,h=Zo(a,l,t,i,r),p=Zo(u,c,t,i,r),d=e.prevZ,f=e.nextZ;d&&d.z>=h&&f&&f.z<=p;){if(d!==e.prev&&d!==e.next&&Ko(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&es(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==e.prev&&f!==e.next&&Ko(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&es(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&Ko(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&es(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==e.prev&&f!==e.next&&Ko(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&es(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Go(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!ts(n,o)&&is(n,r,r.next,o)&&os(n,o)&&os(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),ls(r),ls(r.next),r=e=o),r=r.next}while(r!==e);return zo(r)}function qo(e,t,i,r,n,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&$o(s,a)){var l=ss(s,a);return s=zo(s,s.next),l=zo(l,l.next),Ho(s,t,i,r,n,o),void Ho(l,t,i,r,n,o)}a=a.next}s=s.next}while(s!==e)}function Xo(e,t){return e.x-t.x}function Jo(e,t){if(t=function(e,t){var i,r=t,n=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s){if(s=a,a===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i;var l,u=i,c=i.x,h=i.y,p=1/0;r=i;do{n>=r.x&&r.x>=c&&n!==r.x&&Ko(o<h?n:s,o,c,h,o<h?s:n,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(n-r.x),os(r,e)&&(l<p||l===p&&(r.x>i.x||r.x===i.x&&Yo(i,r)))&&(i=r,p=l)),r=r.next}while(r!==u);return i}(e,t)){var i=ss(t,e);zo(t,t.next),zo(i,i.next)}}function Yo(e,t){return es(e.prev,e,t.prev)<0&&es(t.next,e,e.next)<0}function Zo(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Qo(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function Ko(e,t,i,r,n,o,s,a){return(n-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(i-s)*(t-a)>=0&&(i-s)*(o-a)-(n-s)*(r-a)>=0}function $o(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&is(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(os(e,t)&&os(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(es(e.prev,e,t.prev)||es(e,t.prev,t))||ts(e,t)&&es(e.prev,e,e.next)>0&&es(t.prev,t,t.next)>0)}function es(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function ts(e,t){return e.x===t.x&&e.y===t.y}function is(e,t,i,r){var n=ns(es(e,t,i)),o=ns(es(e,t,r)),s=ns(es(i,r,e)),a=ns(es(i,r,t));return n!==o&&s!==a||(!(0!==n||!rs(e,i,t))||(!(0!==o||!rs(e,r,t))||(!(0!==s||!rs(i,e,r))||!(0!==a||!rs(i,t,r)))))}function rs(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function ns(e){return e>0?1:e<0?-1:0}function os(e,t){return es(e.prev,e,e.next)<0?es(e,t,e.next)>=0&&es(e,e.prev,t)>=0:es(e,t,e.prev)<0||es(e,e.next,t)<0}function ss(e,t){var i=new us(e.i,e.x,e.y),r=new us(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function as(e,t,i,r){var n=new us(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function ls(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function us(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var cs={area:function(e){for(var t=e.length,i=0,r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return.5*i},isClockWise:function(e){return cs.area(e)<0},triangulateShape:function(e,t){var i=[],r=[],n=[];hs(e),ps(i,e);var o=e.length;t.forEach(hs);for(var s=0;s<t.length;s++)r.push(o),o+=t[s].length,ps(i,t[s]);for(var a=No(i,r),l=0;l<a.length;l+=3)n.push(a.slice(l,l+3));return n}};function hs(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function ps(e,t){for(var i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var ds=function(e){function t(t,i){e.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:i},this.fromBufferGeometry(new fs(t,i)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return gs(this.parameters.shapes,this.parameters.options,t)},t}(It),fs=function(e){function t(t,i){e.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:i},t=Array.isArray(t)?t:[t];for(var r=this,n=[],o=[],a=0,l=t.length;a<l;a++){u(t[a])}function u(e){var t=[],a=void 0!==i.curveSegments?i.curveSegments:12,l=void 0!==i.steps?i.steps:1,u=void 0!==i.depth?i.depth:100,c=void 0===i.bevelEnabled||i.bevelEnabled,h=void 0!==i.bevelThickness?i.bevelThickness:6,p=void 0!==i.bevelSize?i.bevelSize:h-2,d=void 0!==i.bevelOffset?i.bevelOffset:0,f=void 0!==i.bevelSegments?i.bevelSegments:3,m=i.extrudePath,g=void 0!==i.UVGenerator?i.UVGenerator:ms;void 0!==i.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=i.amount);var v,y,_,x,E,w=!1;m&&(v=m.getSpacedPoints(l),w=!0,c=!1,y=m.computeFrenetFrames(l,!1),_=new b,x=new b,E=new b),c||(f=0,h=0,p=0,d=0);var T=e.extractPoints(a),M=T.shape,C=T.holes;if(!cs.isClockWise(M)){M=M.reverse();for(var S=0,j=C.length;S<j;S++){var P=C[S];cs.isClockWise(P)&&(C[S]=P.reverse())}}for(var R=cs.triangulateShape(M,C),D=M,A=0,k=C.length;A<k;A++){var O=C[A];M=M.concat(O)}function B(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}var F=M.length,L=R.length;function I(e,t,i){var r,n,o,a=e.x-t.x,l=e.y-t.y,u=i.x-e.x,c=i.y-e.y,h=a*a+l*l,p=a*c-l*u;if(Math.abs(p)>Number.EPSILON){var d=Math.sqrt(h),f=Math.sqrt(u*u+c*c),m=t.x-l/d,g=t.y+a/d,v=((i.x-c/f-m)*c-(i.y+u/f-g)*u)/(a*c-l*u),y=(r=m+a*v-e.x)*r+(n=g+l*v-e.y)*n;if(y<=2)return new s(r,n);o=Math.sqrt(y/2)}else{var b=!1;a>Number.EPSILON?u>Number.EPSILON&&(b=!0):a<-Number.EPSILON?u<-Number.EPSILON&&(b=!0):Math.sign(l)===Math.sign(c)&&(b=!0),b?(r=-l,n=a,o=Math.sqrt(h)):(r=a,n=l,o=Math.sqrt(h/2))}return new s(r/o,n/o)}for(var N=[],U=0,z=D.length,H=z-1,V=U+1;U<z;U++,H++,V++)H===z&&(H=0),V===z&&(V=0),N[U]=I(D[U],D[H],D[V]);for(var W,G=[],q=N.concat(),X=0,J=C.length;X<J;X++){var Y=C[X];W=[];for(var Z=0,Q=Y.length,K=Q-1,$=Z+1;Z<Q;Z++,K++,$++)K===Q&&(K=0),$===Q&&($=0),W[Z]=I(Y[Z],Y[K],Y[$]);G.push(W),q=q.concat(W)}for(var ee=0;ee<f;ee++){for(var te=ee/f,ie=h*Math.cos(te*Math.PI/2),re=p*Math.sin(te*Math.PI/2)+d,ne=0,oe=D.length;ne<oe;ne++){var se=B(D[ne],N[ne],re);ke(se.x,se.y,-ie)}for(var ae=0,le=C.length;ae<le;ae++){var ue=C[ae];W=G[ae];for(var ce=0,he=ue.length;ce<he;ce++){var pe=B(ue[ce],W[ce],re);ke(pe.x,pe.y,-ie)}}}for(var de=p+d,fe=0;fe<F;fe++){var me=c?B(M[fe],q[fe],de):M[fe];w?(x.copy(y.normals[0]).multiplyScalar(me.x),_.copy(y.binormals[0]).multiplyScalar(me.y),E.copy(v[0]).add(x).add(_),ke(E.x,E.y,E.z)):ke(me.x,me.y,0)}for(var ge=1;ge<=l;ge++)for(var ve=0;ve<F;ve++){var ye=c?B(M[ve],q[ve],de):M[ve];w?(x.copy(y.normals[ge]).multiplyScalar(ye.x),_.copy(y.binormals[ge]).multiplyScalar(ye.y),E.copy(v[ge]).add(x).add(_),ke(E.x,E.y,E.z)):ke(ye.x,ye.y,u/l*ge)}for(var be=f-1;be>=0;be--){for(var _e=be/f,xe=h*Math.cos(_e*Math.PI/2),Ee=p*Math.sin(_e*Math.PI/2)+d,we=0,Te=D.length;we<Te;we++){var Me=B(D[we],N[we],Ee);ke(Me.x,Me.y,u+xe)}for(var Ce=0,Se=C.length;Ce<Se;Ce++){var je=C[Ce];W=G[Ce];for(var Pe=0,Re=je.length;Pe<Re;Pe++){var De=B(je[Pe],W[Pe],Ee);w?ke(De.x,De.y+v[l-1].y,v[l-1].x+xe):ke(De.x,De.y,u+xe)}}}function Ae(e,t){for(var i=e.length;--i>=0;){var r=i,n=i-1;n<0&&(n=e.length-1);for(var o=0,s=l+2*f;o<s;o++){var a=F*o,u=F*(o+1);Be(t+r+a,t+n+a,t+n+u,t+r+u)}}}function ke(e,i,r){t.push(e),t.push(i),t.push(r)}function Oe(e,t,i){Fe(e),Fe(t),Fe(i);var o=n.length/3,s=g.generateTopUV(r,n,o-3,o-2,o-1);Le(s[0]),Le(s[1]),Le(s[2])}function Be(e,t,i,o){Fe(e),Fe(t),Fe(o),Fe(t),Fe(i),Fe(o);var s=n.length/3,a=g.generateSideWallUV(r,n,s-6,s-3,s-2,s-1);Le(a[0]),Le(a[1]),Le(a[3]),Le(a[1]),Le(a[2]),Le(a[3])}function Fe(e){n.push(t[3*e+0]),n.push(t[3*e+1]),n.push(t[3*e+2])}function Le(e){o.push(e.x),o.push(e.y)}!function(){var e=n.length/3;if(c){for(var t=0,i=F*t,o=0;o<L;o++){var s=R[o];Oe(s[2]+i,s[1]+i,s[0]+i)}i=F*(t=l+2*f);for(var a=0;a<L;a++){var u=R[a];Oe(u[0]+i,u[1]+i,u[2]+i)}}else{for(var h=0;h<L;h++){var p=R[h];Oe(p[2],p[1],p[0])}for(var d=0;d<L;d++){var m=R[d];Oe(m[0]+F*l,m[1]+F*l,m[2]+F*l)}}r.addGroup(e,n.length/3-e,0)}(),function(){var e=n.length/3,t=0;Ae(D,t),t+=D.length;for(var i=0,o=C.length;i<o;i++){var s=C[i];Ae(s,t),t+=s.length}r.addGroup(e,n.length/3-e,1)}()}this.setAttribute("position",new it(n,3)),this.setAttribute("uv",new it(o,2)),this.computeVertexNormals()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return gs(this.parameters.shapes,this.parameters.options,t)},t}(dt),ms={generateTopUV:function(e,t,i,r,n){var o=t[3*i],a=t[3*i+1],l=t[3*r],u=t[3*r+1],c=t[3*n],h=t[3*n+1];return[new s(o,a),new s(l,u),new s(c,h)]},generateSideWallUV:function(e,t,i,r,n,o){var a=t[3*i],l=t[3*i+1],u=t[3*i+2],c=t[3*r],h=t[3*r+1],p=t[3*r+2],d=t[3*n],f=t[3*n+1],m=t[3*n+2],g=t[3*o],v=t[3*o+1],y=t[3*o+2];return Math.abs(l-h)<.01?[new s(a,1-u),new s(c,1-p),new s(d,1-m),new s(g,1-y)]:[new s(l,1-u),new s(h,1-p),new s(f,1-m),new s(v,1-y)]}};function gs(e,t,i){if(i.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++){var o=e[r];i.shapes.push(o.uuid)}else i.shapes.push(e.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}var vs=function(e){function t(t,i){e.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:i},this.fromBufferGeometry(new ys(t,i)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),ys=function(e){function t(t,i){var r=(i=i||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new It;var n=r.generateShapes(t,i.size);i.depth=void 0!==i.height?i.height:50,void 0===i.bevelThickness&&(i.bevelThickness=10),void 0===i.bevelSize&&(i.bevelSize=8),void 0===i.bevelEnabled&&(i.bevelEnabled=!1),e.call(this,n,i),this.type="TextBufferGeometry"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(fs),bs=function(e){function t(t,i,r,n,o,s,a){e.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:r,phiStart:n,phiLength:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new _s(t,i,r,n,o,s,a)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),_s=function(e){function t(t,i,r,n,o,s,a){e.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:r,phiStart:n,phiLength:o,thetaStart:s,thetaLength:a},t=t||1,i=Math.max(3,Math.floor(i)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,o=void 0!==o?o:2*Math.PI,s=void 0!==s?s:0,a=void 0!==a?a:Math.PI;for(var l=Math.min(s+a,Math.PI),u=0,c=[],h=new b,p=new b,d=[],f=[],m=[],g=[],v=0;v<=r;v++){var y=[],_=v/r,x=0;0==v&&0==s?x=.5/i:v==r&&l==Math.PI&&(x=-.5/i);for(var E=0;E<=i;E++){var w=E/i;h.x=-t*Math.cos(n+w*o)*Math.sin(s+_*a),h.y=t*Math.cos(s+_*a),h.z=t*Math.sin(n+w*o)*Math.sin(s+_*a),f.push(h.x,h.y,h.z),p.copy(h).normalize(),m.push(p.x,p.y,p.z),g.push(w+x,1-_),y.push(u++)}c.push(y)}for(var T=0;T<r;T++)for(var M=0;M<i;M++){var C=c[T][M+1],S=c[T][M],j=c[T+1][M],P=c[T+1][M+1];(0!==T||s>0)&&d.push(C,S,P),(T!==r-1||l<Math.PI)&&d.push(S,j,P)}this.setIndex(d),this.setAttribute("position",new it(f,3)),this.setAttribute("normal",new it(m,3)),this.setAttribute("uv",new it(g,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),xs=function(e){function t(t,i,r,n,o,s){e.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:i,thetaSegments:r,phiSegments:n,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Es(t,i,r,n,o,s)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Es=function(e){function t(t,i,r,n,o,a){e.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:i,thetaSegments:r,phiSegments:n,thetaStart:o,thetaLength:a},t=t||.5,i=i||1,o=void 0!==o?o:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8;for(var l=[],u=[],c=[],h=[],p=t,d=(i-t)/(n=void 0!==n?Math.max(1,n):1),f=new b,m=new s,g=0;g<=n;g++){for(var v=0;v<=r;v++){var y=o+v/r*a;f.x=p*Math.cos(y),f.y=p*Math.sin(y),u.push(f.x,f.y,f.z),c.push(0,0,1),m.x=(f.x/i+1)/2,m.y=(f.y/i+1)/2,h.push(m.x,m.y)}p+=d}for(var _=0;_<n;_++)for(var x=_*(r+1),E=0;E<r;E++){var w=E+x,T=w,M=w+r+1,C=w+r+2,S=w+1;l.push(T,M,S),l.push(M,C,S)}this.setIndex(l),this.setAttribute("position",new it(u,3)),this.setAttribute("normal",new it(c,3)),this.setAttribute("uv",new it(h,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),ws=function(e){function t(t,i,r,n){e.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:i,phiStart:r,phiLength:n},this.fromBufferGeometry(new Ts(t,i,r,n)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Ts=function(e){function t(t,i,r,n){e.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:i,phiStart:r,phiLength:n},i=Math.floor(i)||12,r=r||0,n=n||2*Math.PI,n=o.clamp(n,0,2*Math.PI);for(var a=[],l=[],u=[],c=1/i,h=new b,p=new s,d=0;d<=i;d++)for(var f=r+d*c*n,m=Math.sin(f),g=Math.cos(f),v=0;v<=t.length-1;v++)h.x=t[v].x*m,h.y=t[v].y,h.z=t[v].x*g,l.push(h.x,h.y,h.z),p.x=d/i,p.y=v/(t.length-1),u.push(p.x,p.y);for(var y=0;y<i;y++)for(var _=0;_<t.length-1;_++){var x=_+y*t.length,E=x,w=x+t.length,T=x+t.length+1,M=x+1;a.push(E,w,M),a.push(w,T,M)}if(this.setIndex(a),this.setAttribute("position",new it(l,3)),this.setAttribute("uv",new it(u,2)),this.computeVertexNormals(),n===2*Math.PI)for(var C=this.attributes.normal.array,S=new b,j=new b,P=new b,R=i*t.length*3,D=0,A=0;D<t.length;D++,A+=3)S.x=C[A+0],S.y=C[A+1],S.z=C[A+2],j.x=C[R+A+0],j.y=C[R+A+1],j.z=C[R+A+2],P.addVectors(S,j).normalize(),C[A+0]=C[R+A+0]=P.x,C[A+1]=C[R+A+1]=P.y,C[A+2]=C[R+A+2]=P.z}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),Ms=function(e){function t(t,i){e.call(this),this.type="ShapeGeometry","object"==typeof i&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),i=i.curveSegments),this.parameters={shapes:t,curveSegments:i},this.fromBufferGeometry(new Cs(t,i)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return Ss(this.parameters.shapes,t)},t}(It),Cs=function(e){function t(t,i){e.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:i},i=i||12;var r=[],n=[],o=[],s=[],a=0,l=0;if(!1===Array.isArray(t))c(t);else for(var u=0;u<t.length;u++)c(t[u]),this.addGroup(a,l,u),a+=l,l=0;function c(e){var t=n.length/3,a=e.extractPoints(i),u=a.shape,c=a.holes;!1===cs.isClockWise(u)&&(u=u.reverse());for(var h=0,p=c.length;h<p;h++){var d=c[h];!0===cs.isClockWise(d)&&(c[h]=d.reverse())}for(var f=cs.triangulateShape(u,c),m=0,g=c.length;m<g;m++){var v=c[m];u=u.concat(v)}for(var y=0,b=u.length;y<b;y++){var _=u[y];n.push(_.x,_.y,0),o.push(0,0,1),s.push(_.x,_.y)}for(var x=0,E=f.length;x<E;x++){var w=f[x],T=w[0]+t,M=w[1]+t,C=w[2]+t;r.push(T,M,C),l+=3}}this.setIndex(r),this.setAttribute("position",new it(n,3)),this.setAttribute("normal",new it(o,3)),this.setAttribute("uv",new it(s,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return Ss(this.parameters.shapes,t)},t}(dt);function Ss(e,t){if(t.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){var n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}var js=function(e){function t(t,i){e.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:i},i=void 0!==i?i:1;var r,n,s,a,l=[],u=Math.cos(o.DEG2RAD*i),c=[0,0],h={},p=["a","b","c"];t.isBufferGeometry?(a=new It).fromBufferGeometry(t):a=t.clone(),a.mergeVertices(),a.computeFaceNormals();for(var d=a.vertices,f=a.faces,m=0,g=f.length;m<g;m++)for(var v=f[m],y=0;y<3;y++)r=v[p[y]],n=v[p[(y+1)%3]],c[0]=Math.min(r,n),c[1]=Math.max(r,n),void 0===h[s=c[0]+","+c[1]]?h[s]={index1:c[0],index2:c[1],face1:m,face2:void 0}:h[s].face2=m;for(s in h){var b=h[s];if(void 0===b.face2||f[b.face1].normal.dot(f[b.face2].normal)<=u){var _=d[b.index1];l.push(_.x,_.y,_.z),_=d[b.index2],l.push(_.x,_.y,_.z)}}this.setAttribute("position",new it(l,3))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),Ps=function(e){function t(t,i,r,n,o,s,a,l){e.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:i,height:r,radialSegments:n,heightSegments:o,openEnded:s,thetaStart:a,thetaLength:l},this.fromBufferGeometry(new Rs(t,i,r,n,o,s,a,l)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Rs=function(e){function t(t,i,r,n,o,a,l,u){e.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:i,height:r,radialSegments:n,heightSegments:o,openEnded:a,thetaStart:l,thetaLength:u};var c=this;t=void 0!==t?t:1,i=void 0!==i?i:1,r=r||1,n=Math.floor(n)||8,o=Math.floor(o)||1,a=void 0!==a&&a,l=void 0!==l?l:0,u=void 0!==u?u:2*Math.PI;var h=[],p=[],d=[],f=[],m=0,g=[],v=r/2,y=0;function _(e){for(var r=m,o=new s,a=new b,g=0,_=!0===e?t:i,x=!0===e?1:-1,E=1;E<=n;E++)p.push(0,v*x,0),d.push(0,x,0),f.push(.5,.5),m++;for(var w=m,T=0;T<=n;T++){var M=T/n*u+l,C=Math.cos(M),S=Math.sin(M);a.x=_*S,a.y=v*x,a.z=_*C,p.push(a.x,a.y,a.z),d.push(0,x,0),o.x=.5*C+.5,o.y=.5*S*x+.5,f.push(o.x,o.y),m++}for(var j=0;j<n;j++){var P=r+j,R=w+j;!0===e?h.push(R,R+1,P):h.push(R+1,R,P),g+=3}c.addGroup(y,g,!0===e?1:2),y+=g}!function(){for(var e=new b,s=new b,a=0,_=(i-t)/r,x=0;x<=o;x++){for(var E=[],w=x/o,T=w*(i-t)+t,M=0;M<=n;M++){var C=M/n,S=C*u+l,j=Math.sin(S),P=Math.cos(S);s.x=T*j,s.y=-w*r+v,s.z=T*P,p.push(s.x,s.y,s.z),e.set(j,_,P).normalize(),d.push(e.x,e.y,e.z),f.push(C,1-w),E.push(m++)}g.push(E)}for(var R=0;R<n;R++)for(var D=0;D<o;D++){var A=g[D][R],k=g[D+1][R],O=g[D+1][R+1],B=g[D][R+1];h.push(A,k,B),h.push(k,O,B),a+=6}c.addGroup(y,a,0),y+=a}(),!1===a&&(t>0&&_(!0),i>0&&_(!1)),this.setIndex(h),this.setAttribute("position",new it(p,3)),this.setAttribute("normal",new it(d,3)),this.setAttribute("uv",new it(f,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),Ds=function(e){function t(t,i,r,n,o,s,a){e.call(this,0,t,i,r,n,o,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:i,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:s,thetaLength:a}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Ps),As=function(e){function t(t,i,r,n,o,s,a){e.call(this,0,t,i,r,n,o,s,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:i,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:s,thetaLength:a}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Rs),ks=function(e){function t(t,i,r,n){e.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:i,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new Os(t,i,r,n)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Os=function(e){function t(t,i,r,n){e.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:i,thetaStart:r,thetaLength:n},t=t||1,i=void 0!==i?Math.max(3,i):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var o=[],a=[],l=[],u=[],c=new b,h=new s;a.push(0,0,0),l.push(0,0,1),u.push(.5,.5);for(var p=0,d=3;p<=i;p++,d+=3){var f=r+p/i*n;c.x=t*Math.cos(f),c.y=t*Math.sin(f),a.push(c.x,c.y,c.z),l.push(0,0,1),h.x=(a[d]/t+1)/2,h.y=(a[d+1]/t+1)/2,u.push(h.x,h.y)}for(var m=1;m<=i;m++)o.push(m,m+1,0);this.setIndex(o),this.setAttribute("position",new it(a,3)),this.setAttribute("normal",new it(l,3)),this.setAttribute("uv",new it(u,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),Bs=Object.freeze({__proto__:null,WireframeGeometry:_o,ParametricGeometry:xo,ParametricBufferGeometry:Eo,TetrahedronGeometry:Mo,TetrahedronBufferGeometry:Co,OctahedronGeometry:So,OctahedronBufferGeometry:jo,IcosahedronGeometry:Po,IcosahedronBufferGeometry:Ro,DodecahedronGeometry:Do,DodecahedronBufferGeometry:Ao,PolyhedronGeometry:wo,PolyhedronBufferGeometry:To,TubeGeometry:ko,TubeBufferGeometry:Oo,TorusKnotGeometry:Bo,TorusKnotBufferGeometry:Fo,TorusGeometry:Lo,TorusBufferGeometry:Io,TextGeometry:vs,TextBufferGeometry:ys,SphereGeometry:bs,SphereBufferGeometry:_s,RingGeometry:xs,RingBufferGeometry:Es,PlaneGeometry:ti,PlaneBufferGeometry:ii,LatheGeometry:ws,LatheBufferGeometry:Ts,ShapeGeometry:Ms,ShapeBufferGeometry:Cs,ExtrudeGeometry:ds,ExtrudeBufferGeometry:fs,EdgesGeometry:js,ConeGeometry:Ds,ConeBufferGeometry:As,CylinderGeometry:Ps,CylinderBufferGeometry:Rs,CircleGeometry:ks,CircleBufferGeometry:Os,BoxGeometry:Nt,BoxBufferGeometry:Ut});function Fs(e){We.call(this),this.type="ShadowMaterial",this.color=new ze(0),this.transparent=!0,this.setValues(e)}function Ls(e){Wt.call(this,e),this.type="RawShaderMaterial"}function Is(e){We.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ze(16777215),this.roughness=1,this.metalness=0,this.specularFactor=1,this.fresnelPower=0,this.fresnelInverse=!1,this.highlightColor=new ze(0),this.highlightIntensity=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new s(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}function Ns(e){Is.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new s(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}function Us(e){We.call(this),this.type="MeshPhongMaterial",this.color=new ze(16777215),this.specular=new ze(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.highlightColor=new ze(0),this.highlightIntensity=0,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new s(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function zs(e){We.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ze(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new s(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Hs(e){We.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new s(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Vs(e){We.call(this),this.type="MeshLambertMaterial",this.color=new ze(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.highlightColor=new ze(0),this.highlightIntensity=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ws(e){We.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ze(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new s(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Gs(e){Qn.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Fs.prototype=Object.create(We.prototype),Fs.prototype.constructor=Fs,Fs.prototype.isShadowMaterial=!0,Fs.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this},Ls.prototype=Object.create(Wt.prototype),Ls.prototype.constructor=Ls,Ls.prototype.isRawShaderMaterial=!0,Is.prototype=Object.create(We.prototype),Is.prototype.constructor=Is,Is.prototype.isMeshStandardMaterial=!0,Is.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.specularFactor=e.specularFactor,this.fresnelPower=e.fresnelPower,this.fresnelInverse=e.fresnelInverse,this.highlightColor.copy(e.highlightColor),this.highlightIntensity=e.highlightIntensity,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},Ns.prototype=Object.create(Is.prototype),Ns.prototype.constructor=Ns,Ns.prototype.isMeshPhysicalMaterial=!0,Ns.prototype.copy=function(e){return Is.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new ze).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this},Us.prototype=Object.create(We.prototype),Us.prototype.constructor=Us,Us.prototype.isMeshPhongMaterial=!0,Us.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.highlightColor.copy(e.highlightColor),this.highlightIntensity=e.highlightIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},zs.prototype=Object.create(We.prototype),zs.prototype.constructor=zs,zs.prototype.isMeshToonMaterial=!0,zs.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Hs.prototype=Object.create(We.prototype),Hs.prototype.constructor=Hs,Hs.prototype.isMeshNormalMaterial=!0,Hs.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Vs.prototype=Object.create(We.prototype),Vs.prototype.constructor=Vs,Vs.prototype.isMeshLambertMaterial=!0,Vs.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.highlightColor.copy(e.highlightColor),this.highlightIntensity=e.highlightIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ws.prototype=Object.create(We.prototype),Ws.prototype.constructor=Ws,Ws.prototype.isMeshMatcapMaterial=!0,Ws.prototype.copy=function(e){return We.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Gs.prototype=Object.create(Qn.prototype),Gs.prototype.constructor=Gs,Gs.prototype.isLineDashedMaterial=!0,Gs.prototype.copy=function(e){return Qn.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var qs=Object.freeze({__proto__:null,ShadowMaterial:Fs,SpriteMaterial:vn,RawShaderMaterial:Ls,ShaderMaterial:Wt,PointsMaterial:lo,MeshPhysicalMaterial:Ns,MeshStandardMaterial:Is,MeshPhongMaterial:Us,MeshToonMaterial:zs,MeshNormalMaterial:Hs,MeshLambertMaterial:Vs,MeshDepthMaterial:Yr,MeshDistanceMaterial:Zr,MeshBasicMaterial:Ge,MeshMatcapMaterial:Ws,LineDashedMaterial:Gs,LineBasicMaterial:Qn,Material:We}),Xs={arraySlice:function(e,t,i){return Xs.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,i=new Array(t),r=0;r!==t;++r)i[r]=r;return i.sort((function(t,i){return e[t]-e[i]})),i},sortedArray:function(e,t,i){for(var r=e.length,n=new e.constructor(r),o=0,s=0;s!==r;++o)for(var a=i[o]*t,l=0;l!==t;++l)n[s++]=e[a+l];return n},flattenJSON:function(e,t,i,r){for(var n=1,o=e[0];void 0!==o&&void 0===o[r];)o=e[n++];if(void 0!==o){var s=o[r];if(void 0!==s)if(Array.isArray(s))do{void 0!==(s=o[r])&&(t.push(o.time),i.push.apply(i,s)),o=e[n++]}while(void 0!==o);else if(void 0!==s.toArray)do{void 0!==(s=o[r])&&(t.push(o.time),s.toArray(i,i.length)),o=e[n++]}while(void 0!==o);else do{void 0!==(s=o[r])&&(t.push(o.time),i.push(s)),o=e[n++]}while(void 0!==o)}},subclip:function(e,t,i,r,n){n=n||30;var o=e.clone();o.name=t;for(var s=[],a=0;a<o.tracks.length;++a){for(var l=o.tracks[a],u=l.getValueSize(),c=[],h=[],p=0;p<l.times.length;++p){var d=l.times[p]*n;if(!(d<i||d>=r)){c.push(l.times[p]);for(var f=0;f<u;++f)h.push(l.values[p*u+f])}}0!==c.length&&(l.times=Xs.convertArray(c,l.times.constructor),l.values=Xs.convertArray(h,l.values.constructor),s.push(l))}o.tracks=s;for(var m=1/0,g=0;g<o.tracks.length;++g)m>o.tracks[g].times[0]&&(m=o.tracks[g].times[0]);for(var v=0;v<o.tracks.length;++v)o.tracks[v].shift(-1*m);return o.resetDuration(),o},makeClipAdditive:function(e,t,i,r){void 0===t&&(t=0),void 0===i&&(i=e),(void 0===r||r<=0)&&(r=30);for(var n=e.tracks.length,o=t/r,s=function(t){var r=i.tracks[t],n=r.ValueTypeName;if("bool"!==n&&"string"!==n){var s=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===n}));if(void 0!==s){var a=0,l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);var u=0,c=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=c/3);var h=r.times.length-1,p=void 0;if(o<=r.times[0]){var d=a,f=l-a;p=Xs.arraySlice(r.values,d,f)}else if(o>=r.times[h]){var m=h*l+a,g=m+l-a;p=Xs.arraySlice(r.values,m,g)}else{var y=r.createInterpolant(),b=a,_=l-a;y.evaluate(o),p=Xs.arraySlice(y.resultBuffer,b,_)}if("quaternion"===n)(new v).fromArray(p).normalize().conjugate().toArray(p);for(var x=s.times.length,E=0;E<x;++E){var w=E*c+u;if("quaternion"===n)v.multiplyQuaternionsFlat(s.values,w,p,0,s.values,w);else for(var T=c-2*u,M=0;M<T;++M)s.values[w+M]-=p[M]}}}},a=0;a<n;++a)s(a);return e.blendMode=2501,e}};function Js(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function Ys(e,t,i,r){Js.call(this,e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Zs(e,t,i,r){Js.call(this,e,t,i,r)}function Qs(e,t,i,r){Js.call(this,e,t,i,r)}function Ks(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Xs.convertArray(t,this.TimeBufferType),this.values=Xs.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function $s(e,t,i){Ks.call(this,e,t,i)}function ea(e,t,i,r){Ks.call(this,e,t,i,r)}function ta(e,t,i,r){Ks.call(this,e,t,i,r)}function ia(e,t,i,r){Js.call(this,e,t,i,r)}function ra(e,t,i,r){Ks.call(this,e,t,i,r)}function na(e,t,i,r){Ks.call(this,e,t,i,r)}function oa(e,t,i,r){Ks.call(this,e,t,i,r)}function sa(e,t,i,r){this.name=e,this.tracks=i,this.duration=void 0!==t?t:-1,this.blendMode=void 0!==r?r:2500,this.uuid=o.generateUUID(),this.duration<0&&this.resetDuration()}function aa(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ta;case"vector":case"vector2":case"vector3":case"vector4":return oa;case"color":return ea;case"quaternion":return ra;case"bool":case"boolean":return $s;case"string":return na}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var i=[],r=[];Xs.flattenJSON(e.keys,i,r,"value"),e.times=i,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(Js.prototype,{evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{var o;i:{r:if(!(e<r)){for(var s=i+2;;){if(void 0===r){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,n)}if(i===s)break;if(n=r,e<(r=t[++i]))break t}o=t.length;break i}if(e>=n)break e;var a=t[1];e<a&&(i=2,n=a);for(var l=i-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===l)break;if(r=n,e>=(n=t[--i-1]))break t}o=i,i=0}for(;i<o;){var u=i+o>>>1;e<t[u]?o=u:i=u+1}if(r=t[i],void 0===(n=t[i-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,n,e)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r,o=0;o!==r;++o)t[o]=i[n+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Js.prototype,{beforeStart_:Js.prototype.copySampleValue_,afterEnd_:Js.prototype.copySampleValue_}),Ys.prototype=Object.assign(Object.create(Js.prototype),{constructor:Ys,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(e,t,i){var r=this.parameterPositions,n=e-2,o=e+1,s=r[n],a=r[o];if(void 0===s)switch(this.getSettings_().endingStart){case 2401:n=e,s=2*t-i;break;case 2402:s=t+r[n=r.length-2]-r[n+1];break;default:n=e,s=i}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:o=e,a=2*i-t;break;case 2402:o=1,a=i+r[1]-r[0];break;default:o=e-1,a=t}var l=.5*(i-t),u=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-i),this._offsetPrev=n*u,this._offsetNext=o*u},interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(i-t)/(r-t),f=d*d,m=f*d,g=-h*m+2*h*f-h*d,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,b=p*m-p*f,_=0;_!==s;++_)n[_]=g*o[u+_]+v*o[l+_]+y*o[a+_]+b*o[c+_];return n}}),Zs.prototype=Object.assign(Object.create(Js.prototype),{constructor:Zs,interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,u=(i-t)/(r-t),c=1-u,h=0;h!==s;++h)n[h]=o[l+h]*c+o[a+h]*u;return n}}),Qs.prototype=Object.assign(Object.create(Js.prototype),{constructor:Qs,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Ks,{toJSON:function(e){var t,i=e.constructor;if(void 0!==i.toJSON)t=i.toJSON(e);else{t={name:e.name,times:Xs.convertArray(e.times,Array),values:Xs.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}),Object.assign(Ks.prototype,{constructor:Ks,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new Qs(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Zs(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Ys(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]*=e;return this},trim:function(e,t){for(var i=this.times,r=i.length,n=0,o=r-1;n!==r&&i[n]<e;)++n;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==n||o!==r){n>=o&&(n=(o=Math.max(o,1))-1);var s=this.getValueSize();this.times=Xs.arraySlice(i,n,o),this.values=Xs.arraySlice(this.values,n*s,o*s)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var i=this.times,r=this.values,n=i.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,s=0;s!==n;s++){var a=i[s];if("number"==typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,a),e=!1;break}if(null!==o&&o>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,a,o),e=!1;break}o=a}if(void 0!==r&&Xs.isTypedArray(r))for(var l=0,u=r.length;l!==u;++l){var c=r[l];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,c),e=!1;break}}return e},optimize:function(){for(var e=Xs.arraySlice(this.times),t=Xs.arraySlice(this.values),i=this.getValueSize(),r=2302===this.getInterpolation(),n=e.length-1,o=1,s=1;s<n;++s){var a=!1,l=e[s];if(l!==e[s+1]&&(1!==s||l!==l[0]))if(r)a=!0;else for(var u=s*i,c=u-i,h=u+i,p=0;p!==i;++p){var d=t[u+p];if(d!==t[c+p]||d!==t[h+p]){a=!0;break}}if(a){if(s!==o){e[o]=e[s];for(var f=s*i,m=o*i,g=0;g!==i;++g)t[m+g]=t[f+g]}++o}}if(n>0){e[o]=e[n];for(var v=n*i,y=o*i,b=0;b!==i;++b)t[y+b]=t[v+b];++o}return o!==e.length?(this.times=Xs.arraySlice(e,0,o),this.values=Xs.arraySlice(t,0,o*i)):(this.times=e,this.values=t),this},clone:function(){var e=Xs.arraySlice(this.times,0),t=Xs.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}),$s.prototype=Object.assign(Object.create(Ks.prototype),{constructor:$s,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ea.prototype=Object.assign(Object.create(Ks.prototype),{constructor:ea,ValueTypeName:"color"}),ta.prototype=Object.assign(Object.create(Ks.prototype),{constructor:ta,ValueTypeName:"number"}),ia.prototype=Object.assign(Object.create(Js.prototype),{constructor:ia,interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(i-t)/(r-t),l=e*s,u=l+s;l!==u;l+=4)v.slerpFlat(n,0,o,l-s,o,l,a);return n}}),ra.prototype=Object.assign(Object.create(Ks.prototype),{constructor:ra,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new ia(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),na.prototype=Object.assign(Object.create(Ks.prototype),{constructor:na,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),oa.prototype=Object.assign(Object.create(Ks.prototype),{constructor:oa,ValueTypeName:"vector"}),Object.assign(sa,{parse:function(e){for(var t=[],i=e.tracks,r=1/(e.fps||1),n=0,o=i.length;n!==o;++n)t.push(aa(i[n]).scale(r));return new sa(e.name,e.duration,t,e.blendMode)},toJSON:function(e){for(var t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},n=0,o=i.length;n!==o;++n)t.push(Ks.toJSON(i[n]));return r},CreateFromMorphTargetSequence:function(e,t,i,r){for(var n=t.length,o=[],s=0;s<n;s++){var a=[],l=[];a.push((s+n-1)%n,s,(s+1)%n),l.push(0,1,0);var u=Xs.getKeyframeOrder(a);a=Xs.sortedArray(a,1,u),l=Xs.sortedArray(l,1,u),r||0!==a[0]||(a.push(n),l.push(l[0])),o.push(new ta(".morphTargetInfluences["+t[s].name+"]",a,l).scale(1/i))}return new sa(e,-1,o)},findByName:function(e,t){var i=e;if(!Array.isArray(e)){var r=e;i=r.geometry&&r.geometry.animations||r.animations}for(var n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){for(var r={},n=/^([\w-]*?)([\d]+)$/,o=0,s=e.length;o<s;o++){var a=e[o],l=a.name.match(n);if(l&&l.length>1){var u=l[1],c=r[u];c||(r[u]=c=[]),c.push(a)}}var h=[];for(var p in r)h.push(sa.CreateFromMorphTargetSequence(p,r[p],t,i));return h},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var i=function(e,t,i,r,n){if(0!==i.length){var o=[],s=[];Xs.flattenJSON(i,o,s,r),0!==o.length&&n.push(new e(t,o,s))}},r=[],n=e.name||"default",o=e.fps||30,s=e.blendMode,a=e.length||-1,l=e.hierarchy||[],u=0;u<l.length;u++){var c=l[u].keys;if(c&&0!==c.length)if(c[0].morphTargets){var h={},p=void 0;for(p=0;p<c.length;p++)if(c[p].morphTargets)for(var d=0;d<c[p].morphTargets.length;d++)h[c[p].morphTargets[d]]=-1;for(var f in h){for(var m=[],g=[],v=0;v!==c[p].morphTargets.length;++v){var y=c[p];m.push(y.time),g.push(y.morphTarget===f?1:0)}r.push(new ta(".morphTargetInfluence["+f+"]",m,g))}a=h.length*(o||1)}else{var b=".bones["+t[u].name+"]";i(oa,b+".position",c,"pos",r),i(ra,b+".quaternion",c,"rot",r),i(oa,b+".scale",c,"scl",r)}}return 0===r.length?null:new sa(n,a,r,s)}}),Object.assign(sa.prototype,{resetDuration:function(){for(var e=0,t=0,i=this.tracks.length;t!==i;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new sa(this.name,this.duration,e,this.blendMode)}});var la={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function ua(e,t,i){var r=this,n=!1,o=0,s=0,a=void 0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){s++,!1===n&&void 0!==r.onStart&&r.onStart(e,o,s),n=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(n=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return a?a(e):e},this.setURLModifier=function(e){return a=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,i=l.length;t<i;t+=2){var r=l[t],n=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return n}return null}}var ca=new ua;function ha(e){this.manager=void 0!==e?e:ca,this.crossOrigin="anonymous",this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(ha.prototype,{load:function(){},loadAsync:function(e,t){var i=this;return new Promise((function(r,n){i.load(e,r,t,n)}))},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});var pa={};function da(e){ha.call(this,e)}function fa(e){ha.call(this,e)}function ma(e){ha.call(this,e)}function ga(e){ha.call(this,e)}function va(e){ha.call(this,e)}function ya(e){ha.call(this,e)}function ba(e){ha.call(this,e)}function _a(){this.type="Curve",this.arcLengthDivisions=200}function xa(e,t,i,r,n,o,s,a){_a.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=r||1,this.aStartAngle=n||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function Ea(e,t,i,r,n,o){xa.call(this,e,t,i,i,r,n,o),this.type="ArcCurve"}function wa(){var e=0,t=0,i=0,r=0;function n(n,o,s,a){e=n,t=s,i=-3*n+3*o-2*s-a,r=2*n-2*o+s+a}return{initCatmullRom:function(e,t,i,r,o){n(t,i,o*(i-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,i,r,o,s,a){var l=(t-e)/o-(i-e)/(o+s)+(i-t)/s,u=(i-t)/s-(r-t)/(s+a)+(r-i)/a;n(t,i,l*=s,u*=s)},calc:function(n){var o=n*n;return e+t*n+i*o+r*(o*n)}}}da.prototype=Object.assign(Object.create(ha.prototype),{constructor:da,load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=la.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout((function(){t&&t(o),n.manager.itemEnd(e)}),0),o;if(void 0===pa[e]){var s,a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var l=a[1],u=!!a[2],c=a[3];c=decodeURIComponent(c),u&&(c=atob(c));try{var h,p=(this.responseType||"").toLowerCase();switch(p){case"arraybuffer":case"blob":for(var d=new Uint8Array(c.length),f=0;f<c.length;f++)d[f]=c.charCodeAt(f);h="blob"===p?new Blob([d.buffer],{type:l}):d.buffer;break;case"document":var m=new DOMParser;h=m.parseFromString(c,l);break;case"json":h=JSON.parse(c);break;default:h=c}setTimeout((function(){t&&t(h),n.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)}),0)}}else{for(var g in pa[e]=[],pa[e].push({onLoad:t,onProgress:i,onError:r}),(s=new XMLHttpRequest).open("GET",e,!0),s.addEventListener("load",(function(t){var i=this.response,r=pa[e];if(delete pa[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),la.add(e,i);for(var o=0,s=r.length;o<s;o++){var a=r[o];a.onLoad&&a.onLoad(i)}n.manager.itemEnd(e)}else if(201===this.status&&"string"==typeof i)console.error("[have no right] name: "+decodeURIComponent(JSON.parse(i).message)+"\nurl: "+e),n.manager.itemEnd(e);else{for(var l=0,u=r.length;l<u;l++){var c=r[l];c.onError&&c.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)}}),!1),s.addEventListener("progress",(function(t){for(var i=pa[e],r=0,n=i.length;r<n;r++){var o=i[r];o.onProgress&&o.onProgress(t)}}),!1),s.addEventListener("error",(function(t){var i=pa[e];delete pa[e];for(var r=0,o=i.length;r<o;r++){var s=i[r];s.onError&&s.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)}),!1),s.addEventListener("abort",(function(t){var i=pa[e];delete pa[e];for(var r=0,o=i.length;r<o;r++){var s=i[r];s.onError&&s.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(s.responseType=this.responseType),void 0!==this.withCredentials&&(s.withCredentials=this.withCredentials),s.overrideMimeType&&s.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)s.setRequestHeader(g,this.requestHeader[g]);s.send(null)}return n.manager.itemStart(e),s}pa[e].push({onLoad:t,onProgress:i,onError:r})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this}}),fa.prototype=Object.assign(Object.create(ha.prototype),{constructor:fa,load:function(e,t,i,r){var n=this,o=new da(n.manager);o.setPath(n.path),o.setRequestHeader(n.requestHeader),o.load(e,(function(i){try{t(n.parse(JSON.parse(i)))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}}),i,r)},parse:function(e){for(var t=[],i=0;i<e.length;i++){var r=sa.parse(e[i]);t.push(r)}return t}}),ma.prototype=Object.assign(Object.create(ha.prototype),{constructor:ma,load:function(e,t,i,r){var n=this,o=[],s=new vo;s.image=o;var a=new da(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader);var l=0;function u(u){a.load(e[u],(function(e){var i=n.parse(e,!0);o[u]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(l+=1)&&(1===i.mipmapCount&&(s.minFilter=1006),s.format=i.format,s.needsUpdate=!0,t&&t(s))}),i,r)}if(Array.isArray(e))for(var c=0,h=e.length;c<h;++c)u(c);else a.load(e,(function(e){var i=n.parse(e,!0);if(i.isCubemap)for(var r=i.mipmaps.length/i.mipmapCount,a=0;a<r;a++){o[a]={mipmaps:[]};for(var l=0;l<i.mipmapCount;l++)o[a].mipmaps.push(i.mipmaps[a*i.mipmapCount+l]),o[a].format=i.format,o[a].width=i.width,o[a].height=i.height}else s.image.width=i.width,s.image.height=i.height,s.mipmaps=i.mipmaps;1===i.mipmapCount&&(s.minFilter=1006),s.format=i.format,s.needsUpdate=!0,t&&t(s)}),i,r);return s}}),ga.prototype=Object.assign(Object.create(ha.prototype),{constructor:ga,load:function(e,t,i,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=la.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout((function(){t&&t(o),n.manager.itemEnd(e)}),0),o;var s=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){s.removeEventListener("load",a,!1),s.removeEventListener("error",l,!1),la.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(t){s.removeEventListener("load",a,!1),s.removeEventListener("error",l,!1),r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)}return s.addEventListener("load",a,!1),s.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),n.manager.itemStart(e),s.src=e,s}}),va.prototype=Object.assign(Object.create(ha.prototype),{constructor:va,load:function(e,t,i,r){var n=new _i,o=new ga(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var s=0;function a(i){o.load(e[i],(function(e){n.images[i]=e,6===++s&&(n.needsUpdate=!0,t&&t(n))}),void 0,r)}for(var l=0;l<e.length;++l)a(l);return n}}),ya.prototype=Object.assign(Object.create(ha.prototype),{constructor:ya,load:function(e,t,i,r){var n=this,o=new Yt,s=new da(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.load(e,(function(e){var i=n.parse(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:1001,o.wrapT=void 0!==i.wrapT?i.wrapT:1001,o.magFilter=void 0!==i.magFilter?i.magFilter:1006,o.minFilter=void 0!==i.minFilter?i.minFilter:1006,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps,o.minFilter=1008),1===i.mipmapCount&&(o.minFilter=1006),o.needsUpdate=!0,t&&t(o,i))}),i,r),o}}),ba.prototype=Object.assign(Object.create(ha.prototype),{constructor:ba,load:function(e,t,i,r){var n=new p,o=new ga(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(i){n.image=i;var r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);n.format=r?1022:1023,n.needsUpdate=!0,void 0!==t&&t(n)}),i,r),n}}),Object.assign(_a.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var i=this.getUtoTmapping(e);return this.getPoint(i,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i=[],r=this.getPoint(0),n=0;i.push(0);for(var o=1;o<=e;o++)n+=(t=this.getPoint(o/e)).distanceTo(r),i.push(n),r=t;return this.cacheArcLengths=i,i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i,r=this.getLengths(),n=0,o=r.length;i=t||e*r[o-1];for(var s,a=0,l=o-1;a<=l;)if((s=r[n=Math.floor(a+(l-a)/2)]-i)<0)a=n+1;else{if(!(s>0)){l=n;break}l=n-1}if(r[n=l]===i)return n/(o-1);var u=r[n];return(n+(i-u)/(r[n+1]-u))/(o-1)},getTangent:function(e,t){var i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);var n=this.getPoint(i),o=this.getPoint(r),a=t||(n.isVector2?new s:new b);return a.copy(o).sub(n).normalize(),a},getTangentAt:function(e,t){var i=this.getUtoTmapping(e);return this.getTangent(i,t)},computeFrenetFrames:function(e,t){for(var i=new b,r=[],n=[],s=[],a=new b,l=new X,u=0;u<=e;u++){var c=u/e;r[u]=this.getTangentAt(c,new b),r[u].normalize()}n[0]=new b,s[0]=new b;var h=Number.MAX_VALUE,p=Math.abs(r[0].x),d=Math.abs(r[0].y),f=Math.abs(r[0].z);p<=h&&(h=p,i.set(1,0,0)),d<=h&&(h=d,i.set(0,1,0)),f<=h&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],a),s[0].crossVectors(r[0],n[0]);for(var m=1;m<=e;m++){if(n[m]=n[m-1].clone(),s[m]=s[m-1].clone(),a.crossVectors(r[m-1],r[m]),a.length()>Number.EPSILON){a.normalize();var g=Math.acos(o.clamp(r[m-1].dot(r[m]),-1,1));n[m].applyMatrix4(l.makeRotationAxis(a,g))}s[m].crossVectors(r[m],n[m])}if(!0===t){var v=Math.acos(o.clamp(n[0].dot(n[e]),-1,1));v/=e,r[0].dot(a.crossVectors(n[0],n[e]))>0&&(v=-v);for(var y=1;y<=e;y++)n[y].applyMatrix4(l.makeRotationAxis(r[y],v*y)),s[y].crossVectors(r[y],n[y])}return{tangents:r,normals:n,binormals:s}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),xa.prototype=Object.create(_a.prototype),xa.prototype.constructor=xa,xa.prototype.isEllipseCurve=!0,xa.prototype.getPoint=function(e,t){for(var i=t||new s,r=2*Math.PI,n=this.aEndAngle-this.aStartAngle,o=Math.abs(n)<Number.EPSILON;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(n=o?0:r),!0!==this.aClockwise||o||(n===r?n=-r:n-=r);var a=this.aStartAngle+e*n,l=this.aX+this.xRadius*Math.cos(a),u=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),p=l-this.aX,d=u-this.aY;l=p*c-d*h+this.aX,u=p*h+d*c+this.aY}return i.set(l,u)},xa.prototype.copy=function(e){return _a.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},xa.prototype.toJSON=function(){var e=_a.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},xa.prototype.fromJSON=function(e){return _a.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Ea.prototype=Object.create(xa.prototype),Ea.prototype.constructor=Ea,Ea.prototype.isArcCurve=!0;var Ta=new b,Ma=new wa,Ca=new wa,Sa=new wa;function ja(e,t,i,r){_a.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=i||"centripetal",this.tension=void 0!==r?r:.5}function Pa(e,t,i,r,n){var o=.5*(r-t),s=.5*(n-i),a=e*e;return(2*i-2*r+o+s)*(e*a)+(-3*i+3*r-2*o-s)*a+o*e+i}function Ra(e,t,i,r){return function(e,t){var i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,r)}function Da(e,t,i,r,n){return function(e,t){var i=1-e;return i*i*i*t}(e,t)+function(e,t){var i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,n)}function Aa(e,t,i,r){_a.call(this),this.type="CubicBezierCurve",this.v0=e||new s,this.v1=t||new s,this.v2=i||new s,this.v3=r||new s}function ka(e,t,i,r){_a.call(this),this.type="CubicBezierCurve3",this.v0=e||new b,this.v1=t||new b,this.v2=i||new b,this.v3=r||new b}function Oa(e,t){_a.call(this),this.type="LineCurve",this.v1=e||new s,this.v2=t||new s}function Ba(e,t){_a.call(this),this.type="LineCurve3",this.v1=e||new b,this.v2=t||new b}function Fa(e,t,i){_a.call(this),this.type="QuadraticBezierCurve",this.v0=e||new s,this.v1=t||new s,this.v2=i||new s}function La(e,t,i){_a.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new b,this.v1=t||new b,this.v2=i||new b}function Ia(e){_a.call(this),this.type="SplineCurve",this.points=e||[]}ja.prototype=Object.create(_a.prototype),ja.prototype.constructor=ja,ja.prototype.isCatmullRomCurve3=!0,ja.prototype.getPoint=function(e,t){var i,r,n=t||new b,o=this.points,s=o.length,a=(s-(this.closed?0:1))*e,l=Math.floor(a),u=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s)+1)*s:0===u&&l===s-1&&(l=s-2,u=1),this.closed||l>0?i=o[(l-1)%s]:(Ta.subVectors(o[0],o[1]).add(o[0]),i=Ta);var c=o[l%s],h=o[(l+1)%s];if(this.closed||l+2<s?r=o[(l+2)%s]:(Ta.subVectors(o[s-1],o[s-2]).add(o[s-1]),r=Ta),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,d=Math.pow(i.distanceToSquared(c),p),f=Math.pow(c.distanceToSquared(h),p),m=Math.pow(h.distanceToSquared(r),p);f<1e-4&&(f=1),d<1e-4&&(d=f),m<1e-4&&(m=f),Ma.initNonuniformCatmullRom(i.x,c.x,h.x,r.x,d,f,m),Ca.initNonuniformCatmullRom(i.y,c.y,h.y,r.y,d,f,m),Sa.initNonuniformCatmullRom(i.z,c.z,h.z,r.z,d,f,m)}else"catmullrom"===this.curveType&&(Ma.initCatmullRom(i.x,c.x,h.x,r.x,this.tension),Ca.initCatmullRom(i.y,c.y,h.y,r.y,this.tension),Sa.initCatmullRom(i.z,c.z,h.z,r.z,this.tension));return n.set(Ma.calc(u),Ca.calc(u),Sa.calc(u)),n},ja.prototype.copy=function(e){_a.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},ja.prototype.toJSON=function(){var e=_a.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},ja.prototype.fromJSON=function(e){_a.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new b).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Aa.prototype=Object.create(_a.prototype),Aa.prototype.constructor=Aa,Aa.prototype.isCubicBezierCurve=!0,Aa.prototype.getPoint=function(e,t){var i=t||new s,r=this.v0,n=this.v1,o=this.v2,a=this.v3;return i.set(Da(e,r.x,n.x,o.x,a.x),Da(e,r.y,n.y,o.y,a.y)),i},Aa.prototype.copy=function(e){return _a.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Aa.prototype.toJSON=function(){var e=_a.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Aa.prototype.fromJSON=function(e){return _a.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},ka.prototype=Object.create(_a.prototype),ka.prototype.constructor=ka,ka.prototype.isCubicBezierCurve3=!0,ka.prototype.getPoint=function(e,t){var i=t||new b,r=this.v0,n=this.v1,o=this.v2,s=this.v3;return i.set(Da(e,r.x,n.x,o.x,s.x),Da(e,r.y,n.y,o.y,s.y),Da(e,r.z,n.z,o.z,s.z)),i},ka.prototype.copy=function(e){return _a.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},ka.prototype.toJSON=function(){var e=_a.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},ka.prototype.fromJSON=function(e){return _a.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Oa.prototype=Object.create(_a.prototype),Oa.prototype.constructor=Oa,Oa.prototype.isLineCurve=!0,Oa.prototype.getPoint=function(e,t){var i=t||new s;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},Oa.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Oa.prototype.getTangent=function(e,t){var i=t||new s;return i.copy(this.v2).sub(this.v1).normalize(),i},Oa.prototype.copy=function(e){return _a.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Oa.prototype.toJSON=function(){var e=_a.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Oa.prototype.fromJSON=function(e){return _a.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ba.prototype=Object.create(_a.prototype),Ba.prototype.constructor=Ba,Ba.prototype.isLineCurve3=!0,Ba.prototype.getPoint=function(e,t){var i=t||new b;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},Ba.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Ba.prototype.copy=function(e){return _a.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ba.prototype.toJSON=function(){var e=_a.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ba.prototype.fromJSON=function(e){return _a.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Fa.prototype=Object.create(_a.prototype),Fa.prototype.constructor=Fa,Fa.prototype.isQuadraticBezierCurve=!0,Fa.prototype.getPoint=function(e,t){var i=t||new s,r=this.v0,n=this.v1,o=this.v2;return i.set(Ra(e,r.x,n.x,o.x),Ra(e,r.y,n.y,o.y)),i},Fa.prototype.copy=function(e){return _a.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Fa.prototype.toJSON=function(){var e=_a.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Fa.prototype.fromJSON=function(e){return _a.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},La.prototype=Object.create(_a.prototype),La.prototype.constructor=La,La.prototype.isQuadraticBezierCurve3=!0,La.prototype.getPoint=function(e,t){var i=t||new b,r=this.v0,n=this.v1,o=this.v2;return i.set(Ra(e,r.x,n.x,o.x),Ra(e,r.y,n.y,o.y),Ra(e,r.z,n.z,o.z)),i},La.prototype.copy=function(e){return _a.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},La.prototype.toJSON=function(){var e=_a.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},La.prototype.fromJSON=function(e){return _a.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ia.prototype=Object.create(_a.prototype),Ia.prototype.constructor=Ia,Ia.prototype.isSplineCurve=!0,Ia.prototype.getPoint=function(e,t){var i=t||new s,r=this.points,n=(r.length-1)*e,o=Math.floor(n),a=n-o,l=r[0===o?o:o-1],u=r[o],c=r[o>r.length-2?r.length-1:o+1],h=r[o>r.length-3?r.length-1:o+2];return i.set(Pa(a,l.x,u.x,c.x,h.x),Pa(a,l.y,u.y,c.y,h.y)),i},Ia.prototype.copy=function(e){_a.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this},Ia.prototype.toJSON=function(){var e=_a.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e},Ia.prototype.fromJSON=function(e){_a.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new s).fromArray(r))}return this};var Na=Object.freeze({__proto__:null,ArcCurve:Ea,CatmullRomCurve3:ja,CubicBezierCurve:Aa,CubicBezierCurve3:ka,EllipseCurve:xa,LineCurve:Oa,LineCurve3:Ba,QuadraticBezierCurve:Fa,QuadraticBezierCurve3:La,SplineCurve:Ia});function Ua(){_a.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function za(e){Ua.call(this),this.type="Path",this.currentPoint=new s,e&&this.setFromPoints(e)}function Ha(e){za.call(this,e),this.uuid=o.generateUUID(),this.type="Shape",this.holes=[]}function Va(e,t){be.call(this),this.type="Light",this.color=new ze(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function Wa(e,t,i){Va.call(this,e,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(be.DefaultUp),this.updateMatrix(),this.groundColor=new ze(t)}function Ga(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new s(512,512),this.map=null,this.mapPass=null,this.matrix=new X,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Kt,this._frameExtents=new s(1,1),this._viewportCount=1,this._viewports=[new d(0,0,1,1)]}function qa(){Ga.call(this,new qt(50,1,.5,500))}function Xa(e,t,i,r,n,o){Va.call(this,e,t),this.type="SpotLight",this.position.copy(be.DefaultUp),this.updateMatrix(),this.target=new be,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==o?o:1,this.shadow=new qa}function Ja(){Ga.call(this,new qt(90,1,.5,500)),this._frameExtents=new s(4,2),this._viewportCount=6,this._viewports=[new d(2,1,1,1),new d(0,1,1,1),new d(3,1,1,1),new d(1,1,1,1),new d(3,0,1,1),new d(1,0,1,1)],this._cubeDirections=[new b(1,0,0),new b(-1,0,0),new b(0,0,1),new b(0,0,-1),new b(0,1,0),new b(0,-1,0)],this._cubeUps=[new b(0,1,0),new b(0,1,0),new b(0,1,0),new b(0,1,0),new b(0,0,1),new b(0,0,-1)]}function Ya(e,t,i,r){Va.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==r?r:1,this.shadow=new Ja}function Za(e,t,i,r,n,o){Gt.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==i?i:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Qa(){Ga.call(this,new Za(-5,5,5,-5,.5,500))}function Ka(e,t){Va.call(this,e,t),this.type="DirectionalLight",this.position.copy(be.DefaultUp),this.updateMatrix(),this.target=new be,this.shadow=new Qa}function $a(e,t){Va.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function el(e,t,i,r){Va.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==r?r:10}Ua.prototype=Object.assign(Object.create(_a.prototype),{constructor:Ua,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Oa(t,e))},getPoint:function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=t){var n=i[r]-t,o=this.curves[r],s=o.getLength(),a=0===s?0:1-n/s;return o.getPointAt(a)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,i=[],r=0,n=this.curves;r<n.length;r++)for(var o=n[r],s=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s),l=0;l<a.length;l++){var u=a[l];t&&t.equals(u)||(i.push(u),t=u)}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},copy:function(e){_a.prototype.copy.call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=_a.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){_a.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push((new Na[r.type]).fromJSON(r))}return this}}),za.prototype=Object.assign(Object.create(Ua.prototype),{constructor:za,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var i=new Oa(this.currentPoint.clone(),new s(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,i,r){var n=new Fa(this.currentPoint.clone(),new s(e,t),new s(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this},bezierCurveTo:function(e,t,i,r,n,o){var a=new Aa(this.currentPoint.clone(),new s(e,t),new s(i,r),new s(n,o));return this.curves.push(a),this.currentPoint.set(n,o),this},splineThru:function(e){var t=new Ia([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,i,r,n,o){var s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+s,t+a,i,r,n,o),this},absarc:function(e,t,i,r,n,o){return this.absellipse(e,t,i,i,r,n,o),this},ellipse:function(e,t,i,r,n,o,s,a){var l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,i,r,n,o,s,a),this},absellipse:function(e,t,i,r,n,o,s,a){var l=new xa(e,t,i,r,n,o,s,a);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(e){return Ua.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Ua.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Ua.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Ha.prototype=Object.assign(Object.create(za.prototype),{constructor:Ha,getPointsHoles:function(e){for(var t=[],i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){za.prototype.copy.call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=za.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){za.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push((new za).fromJSON(r))}return this}}),Va.prototype=Object.assign(Object.create(be.prototype),{constructor:Va,isLight:!0,copy:function(e){return be.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=be.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Wa.prototype=Object.assign(Object.create(Va.prototype),{constructor:Wa,isHemisphereLight:!0,copy:function(e){return Va.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Ga.prototype,{_projScreenMatrix:new X,_lightPositionWorld:new b,_lookTarget:new b,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,i=this.matrix,r=this._projScreenMatrix,n=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),n.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(n),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),qa.prototype=Object.assign(Object.create(Ga.prototype),{constructor:qa,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,i=2*o.RAD2DEG*e.angle,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;i===t.fov&&r===t.aspect&&n===t.far||(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),Ga.prototype.updateMatrices.call(this,e)}}),Xa.prototype=Object.assign(Object.create(Va.prototype),{constructor:Xa,isSpotLight:!0,copy:function(e){return Va.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Ja.prototype=Object.assign(Object.create(Ga.prototype),{constructor:Ja,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);var i=this.camera,r=this.matrix,n=this._lightPositionWorld,o=this._lookTarget,s=this._projScreenMatrix;n.setFromMatrixPosition(e.matrixWorld),i.position.copy(n),o.copy(i.position),o.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(o),i.updateMatrixWorld(),r.makeTranslation(-n.x,-n.y,-n.z),s.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s)}}),Ya.prototype=Object.assign(Object.create(Va.prototype),{constructor:Ya,isPointLight:!0,copy:function(e){return Va.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Za.prototype=Object.assign(Object.create(Gt.prototype),{constructor:Za,isOrthographicCamera:!0,copy:function(e,t){return Gt.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,r,n,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,o=i+e,s=r+t,a=r-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o=(n+=l*this.view.offsetX)+l*this.view.width,a=(s-=u*this.view.offsetY)-u*this.view.height}this.projectionMatrix.makeOrthographic(n,o,s,a,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=be.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Qa.prototype=Object.assign(Object.create(Ga.prototype),{constructor:Qa,isDirectionalLightShadow:!0,updateMatrices:function(e){Ga.prototype.updateMatrices.call(this,e)}}),Ka.prototype=Object.assign(Object.create(Va.prototype),{constructor:Ka,isDirectionalLight:!0,copy:function(e){return Va.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),$a.prototype=Object.assign(Object.create(Va.prototype),{constructor:$a,isAmbientLight:!0}),el.prototype=Object.assign(Object.create(Va.prototype),{constructor:el,isRectAreaLight:!0,copy:function(e){return Va.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Va.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});var tl=function(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new b)};function il(e,t){Va.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==e?e:new tl}function rl(e){ha.call(this,e),this.textures={}}tl.prototype.set=function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},tl.prototype.zero=function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},tl.prototype.getAt=function(e,t){var i=e.x,r=e.y,n=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*n),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],i*r*1.092548),t.addScaledVector(o[5],r*n*1.092548),t.addScaledVector(o[6],.315392*(3*n*n-1)),t.addScaledVector(o[7],i*n*1.092548),t.addScaledVector(o[8],.546274*(i*i-r*r)),t},tl.prototype.getIrradianceAt=function(e,t){var i=e.x,r=e.y,n=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*r),t.addScaledVector(o[2],1.023328*n),t.addScaledVector(o[3],1.023328*i),t.addScaledVector(o[4],.858086*i*r),t.addScaledVector(o[5],.858086*r*n),t.addScaledVector(o[6],.743125*n*n-.247708),t.addScaledVector(o[7],.858086*i*n),t.addScaledVector(o[8],.429043*(i*i-r*r)),t},tl.prototype.add=function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},tl.prototype.addScaledSH=function(e,t){for(var i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this},tl.prototype.scale=function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},tl.prototype.lerp=function(e,t){for(var i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this},tl.prototype.equals=function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},tl.prototype.copy=function(e){return this.set(e.coefficients)},tl.prototype.clone=function(){return(new this.constructor).copy(this)},tl.prototype.fromArray=function(e,t){void 0===t&&(t=0);for(var i=this.coefficients,r=0;r<9;r++)i[r].fromArray(e,t+3*r);return this},tl.prototype.toArray=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var i=this.coefficients,r=0;r<9;r++)i[r].toArray(e,t+3*r);return e},tl.getBasisAt=function(e,t){var i=e.x,r=e.y,n=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*n,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*n,t[6]=.315392*(3*n*n-1),t[7]=1.092548*i*n,t[8]=.546274*(i*i-r*r)},il.prototype=Object.assign(Object.create(Va.prototype),{constructor:il,isLightProbe:!0,copy:function(e){return Va.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){var t=Va.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}}),rl.prototype=Object.assign(Object.create(ha.prototype),{constructor:rl,load:function(e,t,i,r){var n=this,o=new da(n.manager);o.setPath(n.path),o.setRequestHeader(n.requestHeader),o.load(e,(function(i){try{t(n.parse(JSON.parse(i)))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}}),i,r)},parse:function(e){var t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=new qs[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=(new ze).setHex(e.sheen)),void 0!==e.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(r.morphNormals=e.morphNormals),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.vertexTangents&&(r.vertexTangents=e.vertexTangents),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(var n in e.uniforms){var o=e.uniforms[n];switch(r.uniforms[n]={},o.type){case"t":r.uniforms[n].value=i(o.value);break;case"c":r.uniforms[n].value=(new ze).setHex(o.value);break;case"v2":r.uniforms[n].value=(new s).fromArray(o.value);break;case"v3":r.uniforms[n].value=(new b).fromArray(o.value);break;case"v4":r.uniforms[n].value=(new d).fromArray(o.value);break;case"m3":r.uniforms[n].value=(new u).fromArray(o.value);break;case"m4":r.uniforms[n].value=(new X).fromArray(o.value);break;default:r.uniforms[n].value=o.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var a in e.extensions)r.extensions[a]=e.extensions[a];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=i(e.map)),void 0!==e.matcap&&(r.matcap=i(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var l=e.normalScale;!1===Array.isArray(l)&&(l=[l,l]),r.normalScale=(new s).fromArray(l)}return void 0!==e.displacementMap&&(r.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=i(e.specularMap)),void 0!==e.envMap&&(r.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new s).fromArray(e.clearcoatNormalScale)),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.transmissionMap&&(r.transmissionMap=i(e.transmissionMap)),r},setTextures:function(e){return this.textures=e,this}});var nl={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function ol(){dt.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function sl(e,t,i,r){"number"==typeof i&&(r=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Je.call(this,e,t,i),this.meshPerAttribute=r||1}function al(e){ha.call(this,e)}ol.prototype=Object.assign(Object.create(dt.prototype),{constructor:ol,isInstancedBufferGeometry:!0,copy:function(e){return dt.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=dt.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),sl.prototype=Object.assign(Object.create(Je.prototype),{constructor:sl,isInstancedBufferAttribute:!0,copy:function(e){return Je.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=Je.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),al.prototype=Object.assign(Object.create(ha.prototype),{constructor:al,load:function(e,t,i,r){var n=this,o=new da(n.manager);o.setPath(n.path),o.setRequestHeader(n.requestHeader),o.load(e,(function(i){try{t(n.parse(JSON.parse(i)))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}}),i,r)},parse:function(e){var t={},i={};function r(e,r){if(void 0!==t[r])return t[r];var n=e.interleavedBuffers[r],o=function(e,t){if(void 0!==i[t])return i[t];var r=e.arrayBuffers[t],n=new Uint32Array(r).buffer;return i[t]=n,n}(e,n.buffer),s=new dn(new ll[n.type](o),n.stride);return s.uuid=n.uuid,t[r]=s,s}var n=e.isInstancedBufferGeometry?new ol:new dt,o=e.data.index;if(void 0!==o){var s=new ll[o.type](o.array);n.setIndex(new Je(s,1))}var a=e.data.attributes;for(var l in a){var u=a[l],c=void 0;if(u.isInterleavedBufferAttribute){c=new gn(r(e.data,u.data),u.itemSize,u.offset,u.normalized)}else{var h=new ll[u.type](u.array);c=new(u.isInstancedBufferAttribute?sl:Je)(h,u.itemSize,u.normalized)}void 0!==u.name&&(c.name=u.name),n.setAttribute(l,c)}var p=e.data.morphAttributes;if(p)for(var d in p){for(var f=p[d],m=[],g=0,v=f.length;g<v;g++){var y=f[g],_=void 0;if(y.isInterleavedBufferAttribute)_=new gn(r(e.data,y.data),y.itemSize,y.offset,y.normalized);else _=new Je(new ll[y.type](y.array),y.itemSize,y.normalized);void 0!==y.name&&(_.name=y.name),m.push(_)}n.morphAttributes[d]=m}e.data.morphTargetsRelative&&(n.morphTargetsRelative=!0);var x=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==x)for(var E=0,w=x.length;E!==w;++E){var T=x[E];n.addGroup(T.start,T.count,T.materialIndex)}var M=e.data.boundingSphere;if(void 0!==M){var C=new b;void 0!==M.center&&C.fromArray(M.center),n.boundingSphere=new I(C,M.radius)}return e.name&&(n.name=e.name),e.userData&&(n.userData=e.userData),n}});var ll={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ul(e){ha.call(this,e)}ul.prototype=Object.assign(Object.create(ha.prototype),{constructor:ul,load:function(e,t,i,r){var n=this,o=""===this.path?nl.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;var s=new da(n.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.load(e,(function(i){var o=null;try{o=JSON.parse(i)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?n.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)}),i,r)},parse:function(e,t){var i=this.parseShape(e.shapes),r=this.parseGeometries(e.geometries,i),n=this.parseImages(e.images,(function(){void 0!==t&&t(a)})),o=this.parseTextures(e.textures,n),s=this.parseMaterials(e.materials,o),a=this.parseObject(e.object,r,s);return e.animations&&(a.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(a),a},parseShape:function(e){var t={};if(void 0!==e)for(var i=0,r=e.length;i<r;i++){var n=(new Ha).fromJSON(e[i]);t[n.uuid]=n}return t},parseGeometries:function(e,t){var i,r={};if(void 0!==e)for(var n=new al,o=0,s=e.length;o<s;o++){var a=void 0,l=e[o];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Bs[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Bs[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Bs[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Bs[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Bs[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Bs[l.type](l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Bs[l.type](l.radius,l.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Bs[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Bs[l.type](l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Bs[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new Bs[l.type]((new Na[l.path.type]).fromJSON(l.path),l.tubularSegments,l.radius,l.radialSegments,l.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Bs[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Bs[l.type](l.vertices,l.indices,l.radius,l.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":i=[];for(var u=0,c=l.shapes.length;u<c;u++){var h=t[l.shapes[u]];i.push(h)}a=new Bs[l.type](i,l.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":i=[];for(var p=0,d=l.shapes.length;p<d;p++){var f=t[l.shapes[p]];i.push(f)}var m=l.options.extrudePath;void 0!==m&&(l.options.extrudePath=(new Na[m.type]).fromJSON(m)),a=new Bs[l.type](i,l.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=n.parse(l);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}a.uuid=l.uuid,void 0!==l.name&&(a.name=l.name),!0===a.isBufferGeometry&&void 0!==l.userData&&(a.userData=l.userData),r[l.uuid]=a}return r},parseMaterials:function(e,t){var i={},r={};if(void 0!==e){var n=new rl;n.setTextures(t);for(var o=0,s=e.length;o<s;o++){var a=e[o];if("MultiMaterial"===a.type){for(var l=[],u=0;u<a.materials.length;u++){var c=a.materials[u];void 0===i[c.uuid]&&(i[c.uuid]=n.parse(c)),l.push(i[c.uuid])}r[a.uuid]=l}else void 0===i[a.uuid]&&(i[a.uuid]=n.parse(a)),r[a.uuid]=i[a.uuid]}}return r},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i],n=sa.parse(r);void 0!==r.uuid&&(n.uuid=r.uuid),t.push(n)}return t},parseImages:function(e,t){var i,r=this,n={};function o(e){return r.manager.itemStart(e),i.load(e,(function(){r.manager.itemEnd(e)}),void 0,(function(){r.manager.itemError(e),r.manager.itemEnd(e)}))}if(void 0!==e&&e.length>0){var s=new ua(t);(i=new ga(s)).setCrossOrigin(this.crossOrigin);for(var a=0,l=e.length;a<l;a++){var u=e[a],c=u.url;if(Array.isArray(c)){n[u.uuid]=[];for(var h=0,p=c.length;h<p;h++){var d=c[h],f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:r.resourcePath+d;n[u.uuid].push(o(f))}}else{var m=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u.url)?u.url:r.resourcePath+u.url;n[u.uuid]=o(m)}}}return n},parseTextures:function(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var n=0,o=e.length;n<o;n++){var s=e[n];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var a=void 0;(a=Array.isArray(t[s.image])?new _i(t[s.image]):new p(t[s.image])).needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=i(s.mapping,hl)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=i(s.wrap[0],pl),a.wrapT=i(s.wrap[1],pl)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=i(s.minFilter,dl)),void 0!==s.magFilter&&(a.magFilter=i(s.magFilter,dl)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),r[s.uuid]=a}return r},parseObject:function(e,t,i){var r,n,o;function s(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function a(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,n=e.length;r<n;r++){var o=e[r];void 0===i[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(i[o])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}switch(e.type){case"Scene":r=new pn,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new ze(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new hn(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new cn(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new qt(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new Za(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new $a(e.color,e.intensity);break;case"DirectionalLight":r=new Ka(e.color,e.intensity);break;case"PointLight":r=new Ya(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new el(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new Xa(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new Wa(e.color,e.groundColor,e.intensity);break;case"LightProbe":r=(new il).fromJSON(e);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":r=new Dt(n=s(e.geometry),o=a(e.material));break;case"InstancedMesh":n=s(e.geometry),o=a(e.material);var l=e.count,u=e.instanceMatrix;(r=new Zn(n,o,l)).instanceMatrix=new Je(new Float32Array(u.array),16);break;case"LOD":r=new Nn;break;case"Line":r=new ro(s(e.geometry),a(e.material),e.mode);break;case"LineLoop":r=new ao(s(e.geometry),a(e.material));break;case"LineSegments":r=new so(s(e.geometry),a(e.material));break;case"PointCloud":case"Points":r=new fo(s(e.geometry),a(e.material));break;case"Sprite":r=new Rn(a(e.material));break;case"Group":r=new rn;break;default:r=new be}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(r.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children)for(var c=e.children,h=0;h<c.length;h++)r.add(this.parseObject(c[h],t,i));if("LOD"===e.type){void 0!==e.autoUpdate&&(r.autoUpdate=e.autoUpdate);for(var p=e.levels,d=0;d<p.length;d++){var f=p[d],m=r.getObjectByProperty("uuid",f.object);void 0!==m&&r.addLevel(m,f.distance)}}return r}});var cl,hl={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},pl={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},dl={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};function fl(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),ha.call(this,e),this.options={premultiplyAlpha:"none"}}function ml(){this.type="ShapePath",this.color=new ze,this.subPaths=[],this.currentPath=null}function gl(e){this.type="Font",this.data=e}function vl(e,t,i,r,n){var o=n.glyphs[e]||n.glyphs["?"];if(o){var s,a,l,u,c,h,p,d,f=new ml;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),g=0,v=m.length;g<v;){switch(m[g++]){case"m":s=m[g++]*t+i,a=m[g++]*t+r,f.moveTo(s,a);break;case"l":s=m[g++]*t+i,a=m[g++]*t+r,f.lineTo(s,a);break;case"q":l=m[g++]*t+i,u=m[g++]*t+r,c=m[g++]*t+i,h=m[g++]*t+r,f.quadraticCurveTo(c,h,l,u);break;case"b":l=m[g++]*t+i,u=m[g++]*t+r,c=m[g++]*t+i,h=m[g++]*t+r,p=m[g++]*t+i,d=m[g++]*t+r,f.bezierCurveTo(c,h,p,d,l,u)}}return{offsetX:o.ha*t,path:f}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+n.familyName+".")}function yl(e){ha.call(this,e)}fl.prototype=Object.assign(Object.create(ha.prototype),{constructor:fl,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=la.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout((function(){t&&t(o),n.manager.itemEnd(e)}),0),o;fetch(e).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,n.options)})).then((function(i){la.add(e,i),t&&t(i),n.manager.itemEnd(e)})).catch((function(t){r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)})),n.manager.itemStart(e)}}),Object.assign(ml.prototype,{moveTo:function(e,t){return this.currentPath=new za,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,i,r){return this.currentPath.quadraticCurveTo(e,t,i,r),this},bezierCurveTo:function(e,t,i,r,n,o){return this.currentPath.bezierCurveTo(e,t,i,r,n,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function i(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i],o=new Ha;o.curves=n.curves,t.push(o)}return t}function r(e,t){for(var i=t.length,r=!1,n=i-1,o=0;o<i;n=o++){var s=t[n],a=t[o],l=a.x-s.x,u=a.y-s.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(s=t[o],l=-l,a=t[n],u=-u),e.y<s.y||e.y>a.y)continue;if(e.y===s.y){if(e.x===s.x)return!0}else{var c=u*(e.x-s.x)-l*(e.y-s.y);if(0===c)return!0;if(c<0)continue;r=!r}}else{if(e.y!==s.y)continue;if(a.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=a.x)return!0}}return r}var n,o,s,a=cs.isClockWise,l=this.subPaths;if(0===l.length)return[];if(!0===t)return i(l);var u=[];if(1===l.length)return o=l[0],(s=new Ha).curves=o.curves,u.push(s),u;var c=!a(l[0].getPoints());c=e?!c:c;var h,p,d=[],f=[],m=[],g=0;f[g]=void 0,m[g]=[];for(var v=0,y=l.length;v<y;v++)n=a(h=(o=l[v]).getPoints()),(n=e?!n:n)?(!c&&f[g]&&g++,f[g]={s:new Ha,p:h},f[g].s.curves=o.curves,c&&g++,m[g]=[]):m[g].push({h:o,p:h[0]});if(!f[0])return i(l);if(f.length>1){for(var b=!1,_=[],x=0,E=f.length;x<E;x++)d[x]=[];for(var w=0,T=f.length;w<T;w++)for(var M=m[w],C=0;C<M.length;C++){for(var S=M[C],j=!0,P=0;P<f.length;P++)r(S.p,f[P].p)&&(w!==P&&_.push({froms:w,tos:P,hole:C}),j?(j=!1,d[P].push(S)):b=!0);j&&d[w].push(S)}_.length>0&&(b||(m=d))}for(var R=0,D=f.length;R<D;R++){s=f[R].s,u.push(s);for(var A=0,k=(p=m[R]).length;A<k;A++)s.holes.push(p[A].h)}return u}}),Object.assign(gl.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var i=[],r=function(e,t,i){for(var r=Array.from?Array.from(e):String(e).split(""),n=t/i.resolution,o=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*n,s=[],a=0,l=0,u=0;u<r.length;u++){var c=r[u];if("\n"===c)a=0,l-=o;else{var h=vl(c,n,a,l,i);a+=h.offsetX,s.push(h.path)}}return s}(e,t,this.data),n=0,o=r.length;n<o;n++)Array.prototype.push.apply(i,r[n].toShapes());return i}}),yl.prototype=Object.assign(Object.create(ha.prototype),{constructor:yl,load:function(e,t,i,r){var n=this,o=new da(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.load(e,(function(e){var i;try{i=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}var r=n.parse(i);t&&t(r)}),i,r)},parse:function(e){return new gl(e)}});var bl={getContext:function(){return void 0===cl&&(cl=new(window.AudioContext||window.webkitAudioContext)),cl},setContext:function(e){cl=e}};function _l(e){ha.call(this,e)}function xl(e,t,i){il.call(this,void 0,i);var r=(new ze).set(e),n=(new ze).set(t),o=new b(r.r,r.g,r.b),s=new b(n.r,n.g,n.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(s).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(s).multiplyScalar(l)}function El(e,t){il.call(this,void 0,t);var i=(new ze).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}_l.prototype=Object.assign(Object.create(ha.prototype),{constructor:_l,load:function(e,t,i,r){var n=this,o=new da(n.manager);o.setResponseType("arraybuffer"),o.setPath(n.path),o.setRequestHeader(n.requestHeader),o.load(e,(function(i){try{var o=i.slice(0);bl.getContext().decodeAudioData(o,(function(e){t(e)}))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}}),i,r)}}),xl.prototype=Object.assign(Object.create(il.prototype),{constructor:xl,isHemisphereLightProbe:!0,copy:function(e){return il.prototype.copy.call(this,e),this},toJSON:function(e){return il.prototype.toJSON.call(this,e)}}),El.prototype=Object.assign(Object.create(il.prototype),{constructor:El,isAmbientLightProbe:!0,copy:function(e){return il.prototype.copy.call(this,e),this},toJSON:function(e){return il.prototype.toJSON.call(this,e)}});var wl=new X,Tl=new X;function Ml(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new qt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new qt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(Ml.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var i,r,n=e.projectionMatrix.clone(),s=t.eyeSep/2,a=s*t.near/t.focus,l=t.near*Math.tan(o.DEG2RAD*t.fov*.5)/t.zoom;Tl.elements[12]=-s,wl.elements[12]=s,i=-l*t.aspect+a,r=l*t.aspect+a,n.elements[0]=2*t.near/(r-i),n.elements[8]=(r+i)/(r-i),this.cameraL.projectionMatrix.copy(n),i=-l*t.aspect-a,r=l*t.aspect-a,n.elements[0]=2*t.near/(r-i),n.elements[8]=(r+i)/(r-i),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Tl),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(wl)}});var Cl=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1};Cl.prototype.start=function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},Cl.prototype.stop=function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},Cl.prototype.getElapsedTime=function(){return this.getDelta(),this.elapsedTime},Cl.prototype.getDelta=function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e};var Sl=new b,jl=new v,Pl=new b,Rl=new b,Dl=function(e){function t(){e.call(this),this.type="AudioListener",this.context=bl.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Cl}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getInput=function(){return this.gain},t.prototype.removeFilter=function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},t.prototype.getFilter=function(){return this.filter},t.prototype.setFilter=function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},t.prototype.getMasterVolume=function(){return this.gain.gain.value},t.prototype.setMasterVolume=function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},t.prototype.updateMatrixWorld=function(t){e.prototype.updateMatrixWorld.call(this,t);var i=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Sl,jl,Pl),Rl.set(0,0,-1).applyQuaternion(jl),i.positionX){var n=this.context.currentTime+this.timeDelta;i.positionX.linearRampToValueAtTime(Sl.x,n),i.positionY.linearRampToValueAtTime(Sl.y,n),i.positionZ.linearRampToValueAtTime(Sl.z,n),i.forwardX.linearRampToValueAtTime(Rl.x,n),i.forwardY.linearRampToValueAtTime(Rl.y,n),i.forwardZ.linearRampToValueAtTime(Rl.z,n),i.upX.linearRampToValueAtTime(r.x,n),i.upY.linearRampToValueAtTime(r.y,n),i.upZ.linearRampToValueAtTime(r.z,n)}else i.setPosition(Sl.x,Sl.y,Sl.z),i.setOrientation(Rl.x,Rl.y,Rl.z,r.x,r.y,r.z)},t}(be),Al=function(e){function t(t){e.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getOutput=function(){return this.gain},t.prototype.setNodeSource=function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},t.prototype.setMediaElementSource=function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},t.prototype.setMediaStreamSource=function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},t.prototype.setBuffer=function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},t.prototype.play=function(e){if(void 0===e&&(e=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},t.prototype.pause=function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},t.prototype.stop=function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},t.prototype.connect=function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this},t.prototype.disconnect=function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this},t.prototype.getFilters=function(){return this.filters},t.prototype.setFilters=function(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},t.prototype.setDetune=function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},t.prototype.getDetune=function(){return this.detune},t.prototype.getFilter=function(){return this.getFilters()[0]},t.prototype.setFilter=function(e){return this.setFilters(e?[e]:[])},t.prototype.setPlaybackRate=function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},t.prototype.getPlaybackRate=function(){return this.playbackRate},t.prototype.onEnded=function(){this.isPlaying=!1},t.prototype.getLoop=function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},t.prototype.setLoop=function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},t.prototype.setLoopStart=function(e){return this.loopStart=e,this},t.prototype.setLoopEnd=function(e){return this.loopEnd=e,this},t.prototype.getVolume=function(){return this.gain.gain.value},t.prototype.setVolume=function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},t}(be),kl=new b,Ol=new v,Bl=new b,Fl=new b,Ll=function(e){function t(t){e.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getOutput=function(){return this.panner},t.prototype.getRefDistance=function(){return this.panner.refDistance},t.prototype.setRefDistance=function(e){return this.panner.refDistance=e,this},t.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor},t.prototype.setRolloffFactor=function(e){return this.panner.rolloffFactor=e,this},t.prototype.getDistanceModel=function(){return this.panner.distanceModel},t.prototype.setDistanceModel=function(e){return this.panner.distanceModel=e,this},t.prototype.getMaxDistance=function(){return this.panner.maxDistance},t.prototype.setMaxDistance=function(e){return this.panner.maxDistance=e,this},t.prototype.setDirectionalCone=function(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this},t.prototype.updateMatrixWorld=function(t){if(e.prototype.updateMatrixWorld.call(this,t),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(kl,Ol,Bl),Fl.set(0,0,1).applyQuaternion(Ol);var i=this.panner;if(i.positionX){var r=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(kl.x,r),i.positionY.linearRampToValueAtTime(kl.y,r),i.positionZ.linearRampToValueAtTime(kl.z,r),i.orientationX.linearRampToValueAtTime(Fl.x,r),i.orientationY.linearRampToValueAtTime(Fl.y,r),i.orientationZ.linearRampToValueAtTime(Fl.z,r)}else i.setPosition(kl.x,kl.y,kl.z),i.setOrientation(Fl.x,Fl.y,Fl.z)}},t}(Al),Il=function(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)};function Nl(e,t,i){var r,n,o;switch(this.binding=e,this.valueSize=i,t){case"quaternion":r=this._slerp,n=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:r=this._lerp,n=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Il.prototype.getFrequencyData=function(){return this.analyser.getByteFrequencyData(this.data),this.data},Il.prototype.getAverageFrequency=function(){for(var e=0,t=this.getFrequencyData(),i=0;i<t.length;i++)e+=t[i];return e/t.length},Object.assign(Nl.prototype,{accumulate:function(e,t){var i=this.buffer,r=this.valueSize,n=e*r+r,o=this.cumulativeWeight;if(0===o){for(var s=0;s!==r;++s)i[n+s]=i[s];o=t}else{var a=t/(o+=t);this._mixBufferRegion(i,n,0,a,r)}this.cumulativeWeight=o},accumulateAdditive:function(e){var t=this.buffer,i=this.valueSize,r=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e},apply:function(e){var t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){var a=t*this._origIndex;this._mixBufferRegion(i,r,a,1-n,t)}o>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(var l=t,u=t+t;l!==u;++l)if(i[l]!==i[l+t]){s.setValue(i,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(var n=i,o=r;n!==o;++n)t[n]=t[r+n%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,i=e;i<t;i++)this.buffer[i]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]},_select:function(e,t,i,r,n){if(r>=.5)for(var o=0;o!==n;++o)e[t+o]=e[i+o]},_slerp:function(e,t,i,r){v.slerpFlat(e,t,e,t,e,i,r)},_slerpAdditive:function(e,t,i,r,n){var o=this._workIndex*n;v.multiplyQuaternionsFlat(e,o,e,t,e,i),v.slerpFlat(e,t,e,t,e,o,r)},_lerp:function(e,t,i,r,n){for(var o=1-r,s=0;s!==n;++s){var a=t+s;e[a]=e[a]*o+e[i+s]*r}},_lerpAdditive:function(e,t,i,r,n){for(var o=0;o!==n;++o){var s=t+o;e[s]=e[s]+e[i+o]*r}}});var Ul=new RegExp("[\\[\\]\\.:\\/]","g"),zl="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Hl=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),Vl=/(WCOD+)?/.source.replace("WCOD",zl),Wl=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Gl=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),ql=new RegExp("^"+Hl+Vl+Wl+Gl+"$"),Xl=["material","materials","bones"];function Jl(e,t,i){var r=i||Yl.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function Yl(e,t,i){this.path=t,this.parsedPath=i||Yl.parseTrackName(t),this.node=Yl.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Zl(){this.uuid=o.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}Object.assign(Jl.prototype,{getValue:function(e,t){this.bind();var i=this._targetGroup.nCachedObjects_,r=this._bindings[i];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var i=this._bindings,r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}),Object.assign(Yl,{Composite:Jl,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new Yl.Composite(e,t,i):new Yl(e,t,i)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Ul,"")},parseTrackName:function(e){var t=ql.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var n=i.nodeName.substring(r+1);-1!==Xl.indexOf(n)&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){var r=function(e){for(var i=0;i<e.length;i++){var n=e[i];if(n.name===t||n.uuid===t)return n;var o=r(n.children);if(o)return o}return null},n=r(e.children);if(n)return n}return null}}),Object.assign(Yl.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)e[t++]=i[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(e=Yl.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(i){var o=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var s=0;s<e.length;s++)if(e[s].name===o){o=s;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var a=e[r];if(void 0!==a){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[n]&&(n=e.morphTargetDictionary[n])}u=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=n}else void 0!==a.fromArray&&void 0!==a.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(u=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}else{var c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Yl.prototype,{_getValue_unbound:Yl.prototype.getValue,_setValue_unbound:Yl.prototype.setValue}),Object.assign(Zl.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=this._indicesByUUID,i=this._paths,r=this._parsedPaths,n=this._bindings,o=n.length,s=void 0,a=e.length,l=this.nCachedObjects_,u=0,c=arguments.length;u!==c;++u){var h=arguments[u],p=h.uuid,d=t[p];if(void 0===d){d=a++,t[p]=d,e.push(h);for(var f=0,m=o;f!==m;++f)n[f].push(new Yl(h,i[f],r[f]))}else if(d<l){s=e[d];var g=--l,v=e[g];t[v.uuid]=d,e[d]=v,t[p]=g,e[g]=h;for(var y=0,b=o;y!==b;++y){var _=n[y],x=_[g],E=_[d];_[d]=x,void 0===E&&(E=new Yl(h,i[y],r[y])),_[g]=E}}else e[d]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l},remove:function(){for(var e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length,n=this.nCachedObjects_,o=0,s=arguments.length;o!==s;++o){var a=arguments[o],l=a.uuid,u=t[l];if(void 0!==u&&u>=n){var c=n++,h=e[c];t[h.uuid]=u,e[u]=h,t[l]=c,e[c]=a;for(var p=0,d=r;p!==d;++p){var f=i[p],m=f[c],g=f[u];f[u]=m,f[c]=g}}}this.nCachedObjects_=n},uncache:function(){for(var e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length,n=this.nCachedObjects_,o=e.length,s=0,a=arguments.length;s!==a;++s){var l=arguments[s],u=l.uuid,c=t[u];if(void 0!==c)if(delete t[u],c<n){var h=--n,p=e[h],d=--o,f=e[d];t[p.uuid]=c,e[c]=p,t[f.uuid]=h,e[h]=f,e.pop();for(var m=0,g=r;m!==g;++m){var v=i[m],y=v[h],b=v[d];v[c]=y,v[h]=b,v.pop()}}else{var _=--o,x=e[_];t[x.uuid]=c,e[c]=x,e.pop();for(var E=0,w=r;E!==w;++E){var T=i[E];T[c]=T[_],T.pop()}}}this.nCachedObjects_=n},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,r=i[e],n=this._bindings;if(void 0!==r)return n[r];var o=this._paths,s=this._parsedPaths,a=this._objects,l=a.length,u=this.nCachedObjects_,c=new Array(l);r=n.length,i[e]=r,o.push(e),s.push(t),n.push(c);for(var h=u,p=a.length;h!==p;++h){var d=a[h];c[h]=new Yl(d,e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){var r=this._paths,n=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];t[e[s]]=i,o[i]=a,o.pop(),n[i]=n[s],n.pop(),r[i]=r[s],r.pop()}}});var Ql=function(e,t,i,r){this._mixer=e,this._clip=t,this._localRoot=i||null,this.blendMode=r||t.blendMode;for(var n=t.tracks,o=n.length,s=new Array(o),a={endingStart:2400,endingEnd:2400},l=0;l!==o;++l){var u=n[l].createInterpolant(null);s[l]=u,u.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0};function Kl(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Ql.prototype.play=function(){return this._mixer._activateAction(this),this},Ql.prototype.stop=function(){return this._mixer._deactivateAction(this),this.reset()},Ql.prototype.reset=function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},Ql.prototype.isRunning=function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},Ql.prototype.isScheduled=function(){return this._mixer._isActiveAction(this)},Ql.prototype.startAt=function(e){return this._startTime=e,this},Ql.prototype.setLoop=function(e,t){return this.loop=e,this.repetitions=t,this},Ql.prototype.setEffectiveWeight=function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},Ql.prototype.getEffectiveWeight=function(){return this._effectiveWeight},Ql.prototype.fadeIn=function(e){return this._scheduleFading(e,0,1)},Ql.prototype.fadeOut=function(e){return this._scheduleFading(e,1,0)},Ql.prototype.crossFadeFrom=function(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){var r=this._clip.duration,n=e._clip.duration,o=n/r,s=r/n;e.warp(1,o,t),this.warp(s,1,t)}return this},Ql.prototype.crossFadeTo=function(e,t,i){return e.crossFadeFrom(this,t,i)},Ql.prototype.stopFading=function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},Ql.prototype.setEffectiveTimeScale=function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},Ql.prototype.getEffectiveTimeScale=function(){return this._effectiveTimeScale},Ql.prototype.setDuration=function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},Ql.prototype.syncWith=function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},Ql.prototype.halt=function(e){return this.warp(this._effectiveTimeScale,0,e)},Ql.prototype.warp=function(e,t,i){var r=this._mixer,n=r.time,o=this.timeScale,s=this._timeScaleInterpolant;null===s&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);var a=s.parameterPositions,l=s.sampleValues;return a[0]=n,a[1]=n+i,l[0]=e/o,l[1]=t/o,this},Ql.prototype.stopWarping=function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},Ql.prototype.getMixer=function(){return this._mixer},Ql.prototype.getClip=function(){return this._clip},Ql.prototype.getRoot=function(){return this._localRoot||this._mixer._root},Ql.prototype._update=function(e,t,i,r){if(this.enabled){var n=this._startTime;if(null!==n){var o=(e-n)*i;if(o<0||0===i)return;this._startTime=null,t=i*o}t*=this._updateTimeScale(e);var s=this._updateTime(t),a=this._updateWeight(e);if(a>0){var l=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case 2501:for(var c=0,h=l.length;c!==h;++c)l[c].evaluate(s),u[c].accumulateAdditive(a);break;case 2500:default:for(var p=0,d=l.length;p!==d;++p)l[p].evaluate(s),u[p].accumulate(r,a)}}}else this._updateWeight(e)},Ql.prototype._updateWeight=function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(null!==i){var r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t},Ql.prototype._updateTimeScale=function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i)t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t},Ql.prototype._updateTime=function(e){var t=this._clip.duration,i=this.loop,r=this.time+e,n=this._loopCount,o=2202===i;if(0===e)return-1===n?r:o&&1==(1&n)?t-r:r;if(2200===i){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=t||r<0){var s=Math.floor(r/t);r-=t*s,n+=Math.abs(s);var a=this.repetitions-n;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}else this.time=r;if(o&&1==(1&n))return t-r}return r},Ql.prototype._setEndings=function(e,t,i){var r=this._interpolantSettings;i?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,r.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)},Ql.prototype._scheduleFading=function(e,t,i){var r=this._mixer,n=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var s=o.parameterPositions,a=o.sampleValues;return s[0]=n,a[0]=t,s[1]=n+e,a[1]=i,this},Kl.prototype=Object.assign(Object.create(t.prototype),{constructor:Kl,_bindAction:function(e,t){var i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,o=e._propertyBindings,s=e._interpolants,a=i.uuid,l=this._bindingsByRootAndName,u=l[a];void 0===u&&(u={},l[a]=u);for(var c=0;c!==n;++c){var h=r[c],p=h.name,d=u[p];if(void 0!==d)o[c]=d;else{if(void 0!==(d=o[c])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,a,p));continue}var f=t&&t._propertyBindings[c].binding.parsedPath;++(d=new Nl(Yl.create(i,p,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(d,a,p),o[c]=d}s[c].resultBuffer=d.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,t)}for(var n=e._propertyBindings,o=0,s=n.length;o!==s;++o){var a=n[o];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){var r=this._actions,n=this._actionsByClip,o=n[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=o;else{var s=o.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;var n=e._clip.uuid,o=this._actionsByClip,s=o[n],a=s.knownActions,l=a[a.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,a[u]=l,a.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[n],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_addInactiveBinding:function(e,t,i){var r=this._bindingsByRootAndName,n=this._bindings,o=r[t];void 0===o&&(o={},r[t]=o),o[i]=e,e._cacheIndex=n.length,n.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,o=this._bindingsByRootAndName,s=o[r],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete s[n],0===Object.keys(s).length&&delete o[r]},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&((i=new Zs(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,i){var r=t||this._root,n=r.uuid,o="string"==typeof e?sa.findByName(r,e):e,s=null!==o?o.uuid:e,a=this._actionsByClip[s],l=null;if(void 0===i&&(i=null!==o?o.blendMode:2500),void 0!==a){var u=a.actionByRoot[n];if(void 0!==u&&u.blendMode===i)return u;l=a.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;var c=new Ql(this,o,t,i);return this._bindAction(c,l),this._addInactiveAction(c,s,n),c},existingAction:function(e,t){var i=t||this._root,r=i.uuid,n="string"==typeof e?sa.findByName(i,e):e,o=n?n.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[r]||null},stopAllAction:function(){for(var e=this._actions,t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this},update:function(e){e*=this.timeScale;for(var t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),o=this._accuIndex^=1,s=0;s!==i;++s){t[s]._update(r,e,n,o)}for(var a=this._bindings,l=this._nActiveBindings,u=0;u!==l;++u)a[u].apply(o);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(void 0!==n){for(var o=n.knownActions,s=0,a=o.length;s!==a;++s){var l=o[s];this._deactivateAction(l);var u=l._cacheIndex,c=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,t[u]=c,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}},uncacheRoot:function(e){var t=e.uuid,i=this._actionsByClip;for(var r in i){var n=i[r].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var s in o){var a=o[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}},uncacheAction:function(e,t){var i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}});var $l=function(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e};function eu(e,t,i){dn.call(this,e,t),this.meshPerAttribute=i||1}function tu(e,t,i,r,n){this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=r,this.count=n,this.version=0}function iu(e,t,i,r){this.ray=new q(e,t),this.near=i||0,this.far=r||1/0,this.camera=null,this.layers=new oe,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ru(e,t){return e.distance-t.distance}function nu(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===r)for(var n=e.children,o=0,s=n.length;o<s;o++)nu(n[o],t,i,!0)}$l.prototype.clone=function(){return new $l(void 0===this.value.clone?this.value:this.value.clone())},eu.prototype=Object.assign(Object.create(dn.prototype),{constructor:eu,isInstancedInterleavedBuffer:!0,copy:function(e){return dn.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){var t=dn.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){var t=dn.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(tu.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(tu.prototype,{isGLBufferAttribute:!0,setBuffer:function(e){return this.buffer=e,this},setType:function(e,t){return this.type=e,this.elementSize=t,this},setItemSize:function(e){return this.itemSize=e,this},setCount:function(e){return this.count=e,this}}),Object.assign(iu.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,i){var r=i||[];return nu(e,this,r,t),r.sort(ru),r},intersectObjects:function(e,t,i){var r=i||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var n=0,o=e.length;n<o;n++)nu(e[n],this,r,t);return r.sort(ru),r}});var ou=function(e,t,i){return void 0===e&&(e=1),void 0===t&&(t=0),void 0===i&&(i=0),this.radius=e,this.phi=t,this.theta=i,this};ou.prototype.set=function(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this},ou.prototype.clone=function(){return(new this.constructor).copy(this)},ou.prototype.copy=function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},ou.prototype.makeSafe=function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},ou.prototype.setFromVector3=function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},ou.prototype.setFromCartesianCoords=function(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(o.clamp(t/this.radius,-1,1))),this};var su=function(e,t,i){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==i?i:0,this};su.prototype.set=function(e,t,i){return this.radius=e,this.theta=t,this.y=i,this},su.prototype.clone=function(){return(new this.constructor).copy(this)},su.prototype.copy=function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},su.prototype.setFromVector3=function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},su.prototype.setFromCartesianCoords=function(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this};var au=new s,lu=function(e,t){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==e?e:new s(1/0,1/0),this.max=void 0!==t?t:new s(-1/0,-1/0)};lu.prototype.set=function(e,t){return this.min.copy(e),this.max.copy(t),this},lu.prototype.setFromPoints=function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},lu.prototype.setFromCenterAndSize=function(e,t){var i=au.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this},lu.prototype.clone=function(){return(new this.constructor).copy(this)},lu.prototype.copy=function(e){return this.min.copy(e.min),this.max.copy(e.max),this},lu.prototype.makeEmpty=function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},lu.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y},lu.prototype.getCenter=function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new s),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},lu.prototype.getSize=function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new s),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},lu.prototype.expandByPoint=function(e){return this.min.min(e),this.max.max(e),this},lu.prototype.expandByVector=function(e){return this.min.sub(e),this.max.add(e),this},lu.prototype.expandByScalar=function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},lu.prototype.containsPoint=function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},lu.prototype.containsBox=function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},lu.prototype.getParameter=function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new s),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},lu.prototype.intersectsBox=function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},lu.prototype.clampPoint=function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new s),t.copy(e).clamp(this.min,this.max)},lu.prototype.distanceToPoint=function(e){return au.copy(e).clamp(this.min,this.max).sub(e).length()},lu.prototype.intersect=function(e){return this.min.max(e.min),this.max.min(e.max),this},lu.prototype.union=function(e){return this.min.min(e.min),this.max.max(e.max),this},lu.prototype.translate=function(e){return this.min.add(e),this.max.add(e),this},lu.prototype.equals=function(e){return e.min.equals(this.min)&&e.max.equals(this.max)};var uu=new b,cu=new b,hu=function(e,t){this.start=void 0!==e?e:new b,this.end=void 0!==t?t:new b};function pu(e){be.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}hu.prototype.set=function(e,t){return this.start.copy(e),this.end.copy(t),this},hu.prototype.clone=function(){return(new this.constructor).copy(this)},hu.prototype.copy=function(e){return this.start.copy(e.start),this.end.copy(e.end),this},hu.prototype.getCenter=function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new b),e.addVectors(this.start,this.end).multiplyScalar(.5)},hu.prototype.delta=function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new b),e.subVectors(this.end,this.start)},hu.prototype.distanceSq=function(){return this.start.distanceToSquared(this.end)},hu.prototype.distance=function(){return this.start.distanceTo(this.end)},hu.prototype.at=function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new b),this.delta(t).multiplyScalar(e).add(this.start)},hu.prototype.closestPointToPointParameter=function(e,t){uu.subVectors(e,this.start),cu.subVectors(this.end,this.start);var i=cu.dot(cu),r=cu.dot(uu)/i;return t&&(r=o.clamp(r,0,1)),r},hu.prototype.closestPointToPoint=function(e,t,i){var r=this.closestPointToPointParameter(e,t);return void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new b),this.delta(i).multiplyScalar(r).add(this.start)},hu.prototype.applyMatrix4=function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},hu.prototype.equals=function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},pu.prototype=Object.create(be.prototype),pu.prototype.constructor=pu,pu.prototype.isImmediateRenderObject=!0;var du=new b,fu=function(e){function t(t,i){e.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;for(var r=new dt,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],o=0,s=1;o<32;o++,s++){var a=o/32*Math.PI*2,l=s/32*Math.PI*2;n.push(Math.cos(a),Math.sin(a),1,Math.cos(l),Math.sin(l),1)}r.setAttribute("position",new it(n,3));var u=new Qn({fog:!1,toneMapped:!1});this.cone=new so(r,u),this.add(this.cone),this.update()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},t.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),du.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(du),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)},t}(be),mu=new b,gu=new X,vu=new X,yu=function(e){function t(t){for(var i=function e(t){var i=[];t&&t.isBone&&i.push(t);for(var r=0;r<t.children.length;r++)i.push.apply(i,e(t.children[r]));return i}(t),r=new dt,n=[],o=[],s=new ze(0,0,1),a=new ze(0,1,0),l=0;l<i.length;l++){var u=i[l];u.parent&&u.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),o.push(s.r,s.g,s.b),o.push(a.r,a.g,a.b))}r.setAttribute("position",new it(n,3)),r.setAttribute("color",new it(o,3));var c=new Qn({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});e.call(this,r,c),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=i,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.updateMatrixWorld=function(t){var i=this.bones,r=this.geometry,n=r.getAttribute("position");vu.getInverse(this.root.matrixWorld);for(var o=0,s=0;o<i.length;o++){var a=i[o];a.parent&&a.parent.isBone&&(gu.multiplyMatrices(vu,a.matrixWorld),mu.setFromMatrixPosition(gu),n.setXYZ(s,mu.x,mu.y,mu.z),gu.multiplyMatrices(vu,a.parent.matrixWorld),mu.setFromMatrixPosition(gu),n.setXYZ(s+1,mu.x,mu.y,mu.z),s+=2)}r.getAttribute("position").needsUpdate=!0,e.prototype.updateMatrixWorld.call(this,t)},t}(so);var bu=function(e){function t(t,i,r){var n=new _s(i,4,2),o=new Ge({wireframe:!0,fog:!1,toneMapped:!1});e.call(this,n,o),this.light=t,this.light.updateMatrixWorld(),this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},t.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},t}(Dt),_u=new b,xu=new ze,Eu=new ze,wu=function(e){function t(t,i,r){e.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new jo(i);n.rotateY(.5*Math.PI),this.material=new Ge({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);var o=n.getAttribute("position"),s=new Float32Array(3*o.count);n.setAttribute("color",new Je(s,3)),this.add(new Dt(n,this.material)),this.update()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},t.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");xu.copy(this.light.color),Eu.copy(this.light.groundColor);for(var i=0,r=t.count;i<r;i++){var n=i<r/2?xu:Eu;t.setXYZ(i,n.r,n.g,n.b)}t.needsUpdate=!0}e.lookAt(_u.setFromMatrixPosition(this.light.matrixWorld).negate())},t}(be),Tu=function(e){function t(t,i,r,n){t=t||10,i=i||10,r=new ze(void 0!==r?r:4473924),n=new ze(void 0!==n?n:8947848);for(var o=i/2,s=t/i,a=t/2,l=[],u=[],c=0,h=0,p=-a;c<=i;c++,p+=s){l.push(-a,0,p,a,0,p),l.push(p,0,-a,p,0,a);var d=c===o?r:n;d.toArray(u,h),h+=3,d.toArray(u,h),h+=3,d.toArray(u,h),h+=3,d.toArray(u,h),h+=3}var f=new dt;f.setAttribute("position",new it(l,3)),f.setAttribute("color",new it(u,3));var m=new Qn({vertexColors:!0,toneMapped:!1});e.call(this,f,m),this.type="GridHelper"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(so),Mu=function(e){function t(t,i,r,n,o,s){t=t||10,i=i||16,r=r||8,n=n||64,o=new ze(void 0!==o?o:4473924),s=new ze(void 0!==s?s:8947848);for(var a=[],l=[],u=0;u<=i;u++){var c=u/i*(2*Math.PI),h=Math.sin(c)*t,p=Math.cos(c)*t;a.push(0,0,0),a.push(h,0,p);var d=1&u?o:s;l.push(d.r,d.g,d.b),l.push(d.r,d.g,d.b)}for(var f=0;f<=r;f++)for(var m=1&f?o:s,g=t-t/r*f,v=0;v<n;v++){var y=v/n*(2*Math.PI),b=Math.sin(y)*g,_=Math.cos(y)*g;a.push(b,0,_),l.push(m.r,m.g,m.b),y=(v+1)/n*(2*Math.PI),b=Math.sin(y)*g,_=Math.cos(y)*g,a.push(b,0,_),l.push(m.r,m.g,m.b)}var x=new dt;x.setAttribute("position",new it(a,3)),x.setAttribute("color",new it(l,3));var E=new Qn({vertexColors:!0,toneMapped:!1});e.call(this,x,E),this.type="PolarGridHelper"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(so),Cu=new b,Su=new b,ju=new b,Pu=function(e){function t(t,i,r){e.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===i&&(i=1);var n=new dt;n.setAttribute("position",new it([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));var o=new Qn({fog:!1,toneMapped:!1});this.lightPlane=new ro(n,o),this.add(this.lightPlane),(n=new dt).setAttribute("position",new it([0,0,0,0,0,1],3)),this.targetLine=new ro(n,o),this.add(this.targetLine),this.update()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},t.prototype.update=function(){Cu.setFromMatrixPosition(this.light.matrixWorld),Su.setFromMatrixPosition(this.light.target.matrixWorld),ju.subVectors(Su,Cu),this.lightPlane.lookAt(Su),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Su),this.targetLine.scale.z=ju.length()},t}(be),Ru=new b,Du=new Gt,Au=function(e){function t(t){var i=new dt,r=new Qn({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],o=[],s={},a=new ze(16755200),l=new ze(16711680),u=new ze(43775),c=new ze(16777215),h=new ze(3355443);function p(e,t,i){d(e,i),d(t,i)}function d(e,t){n.push(0,0,0),o.push(t.r,t.g,t.b),void 0===s[e]&&(s[e]=[]),s[e].push(n.length/3-1)}p("n1","n2",a),p("n2","n4",a),p("n4","n3",a),p("n3","n1",a),p("f1","f2",a),p("f2","f4",a),p("f4","f3",a),p("f3","f1",a),p("n1","f1",a),p("n2","f2",a),p("n3","f3",a),p("n4","f4",a),p("p","n1",l),p("p","n2",l),p("p","n3",l),p("p","n4",l),p("u1","u2",u),p("u2","u3",u),p("u3","u1",u),p("c","t",c),p("p","c",h),p("cn1","cn2",h),p("cn3","cn4",h),p("cf1","cf2",h),p("cf3","cf4",h),i.setAttribute("position",new it(n,3)),i.setAttribute("color",new it(o,3)),e.call(this,i,r),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.update=function(){var e=this.geometry,t=this.pointMap;Du.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ku("c",t,e,Du,0,0,-1),ku("t",t,e,Du,0,0,1),ku("n1",t,e,Du,-1,-1,-1),ku("n2",t,e,Du,1,-1,-1),ku("n3",t,e,Du,-1,1,-1),ku("n4",t,e,Du,1,1,-1),ku("f1",t,e,Du,-1,-1,1),ku("f2",t,e,Du,1,-1,1),ku("f3",t,e,Du,-1,1,1),ku("f4",t,e,Du,1,1,1),ku("u1",t,e,Du,.7,1.1,-1),ku("u2",t,e,Du,-.7,1.1,-1),ku("u3",t,e,Du,0,2,-1),ku("cf1",t,e,Du,-1,0,1),ku("cf2",t,e,Du,1,0,1),ku("cf3",t,e,Du,0,-1,1),ku("cf4",t,e,Du,0,1,1),ku("cn1",t,e,Du,-1,0,-1),ku("cn2",t,e,Du,1,0,-1),ku("cn3",t,e,Du,0,-1,-1),ku("cn4",t,e,Du,0,1,-1),e.getAttribute("position").needsUpdate=!0},t}(so);function ku(e,t,i,r,n,o,s){Ru.set(n,o,s).unproject(r);var a=t[e];if(void 0!==a)for(var l=i.getAttribute("position"),u=0,c=a.length;u<c;u++)l.setXYZ(a[u],Ru.x,Ru.y,Ru.z)}var Ou,Bu,Fu=new E,Lu=function(e){function t(t,i){void 0===i&&(i=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),o=new dt;o.setIndex(new Je(r,1)),o.setAttribute("position",new Je(n,3)),e.call(this,o,new Qn({color:i,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.update=function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Fu.setFromObject(this.object),!Fu.isEmpty()){var t=Fu.min,i=Fu.max,r=this.geometry.attributes.position,n=r.array;n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=t.x,n[4]=i.y,n[5]=i.z,n[6]=t.x,n[7]=t.y,n[8]=i.z,n[9]=i.x,n[10]=t.y,n[11]=i.z,n[12]=i.x,n[13]=i.y,n[14]=t.z,n[15]=t.x,n[16]=i.y,n[17]=t.z,n[18]=t.x,n[19]=t.y,n[20]=t.z,n[21]=i.x,n[22]=t.y,n[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}},t.prototype.setFromObject=function(e){return this.object=e,this.update(),this},t.prototype.copy=function(t){return e.prototype.copy.call(this,t),this.object=t.object,this},t}(so),Iu=function(e){function t(t,i){void 0===i&&(i=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new dt;n.setIndex(new Je(r,1)),n.setAttribute("position",new it([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),e.call(this,n,new Qn({color:i,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.updateMatrixWorld=function(t){var i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),e.prototype.updateMatrixWorld.call(this,t))},t}(so),Nu=function(e){function t(t,i,r){var n=void 0!==r?r:16776960,o=new dt;o.setAttribute("position",new it([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),o.computeBoundingSphere(),e.call(this,o,new Qn({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=void 0===i?1:i;var s=new dt;s.setAttribute("position",new it([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),this.add(new Dt(s,new Ge({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.updateMatrixWorld=function(t){var i=-this.plane.constant;Math.abs(i)<1e-8&&(i=1e-8),this.scale.set(.5*this.size,.5*this.size,i),this.children[0].material.side=i<0?1:0,this.lookAt(this.plane.normal),e.prototype.updateMatrixWorld.call(this,t)},t}(ro),Uu=new b,zu=function(e){function t(t,i,r,n,o,s){e.call(this),this.type="ArrowHelper",void 0===t&&(t=new b(0,0,1)),void 0===i&&(i=new b(0,0,0)),void 0===r&&(r=1),void 0===n&&(n=16776960),void 0===o&&(o=.2*r),void 0===s&&(s=.2*o),void 0===Ou&&((Ou=new dt).setAttribute("position",new it([0,0,0,0,1,0],3)),(Bu=new Rs(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(i),this.line=new ro(Ou,new Qn({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Dt(Bu,new Ge({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,o,s)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Uu.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Uu,t)}},t.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},t.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},t.prototype.copy=function(t){return e.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},t}(be),Hu=function(e){function t(t){void 0===t&&(t=1);var i=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=new dt;r.setAttribute("position",new it(i,3)),r.setAttribute("color",new it([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new Qn({vertexColors:!0,toneMapped:!1});e.call(this,r,n),this.type="AxesHelper"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(so),Vu=Math.pow(2,8),Wu=[.125,.215,.35,.446,.526,.582],Gu=5+Wu.length,qu={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},Xu=new Za,Ju=function(){for(var e=[],t=[],i=[],r=8,n=0;n<Gu;n++){var o=Math.pow(2,r);t.push(o);var s=1/o;n>4?s=Wu[n-8+4-1]:0==n&&(s=0),i.push(s);for(var a=1/(o-1),l=-a/2,u=1+a/2,c=[l,l,u,l,u,u,l,l,u,u,l,u],h=new Float32Array(108),p=new Float32Array(72),d=new Float32Array(36),f=0;f<6;f++){var m=f%3*2/3-1,g=f>2?0:-1,v=[m,g,0,m+2/3,g,0,m+2/3,g+1,0,m,g,0,m+2/3,g+1,0,m,g+1,0];h.set(v,18*f),p.set(c,12*f);var y=[f,f,f,f,f,f];d.set(y,6*f)}var b=new dt;b.setAttribute("position",new Je(h,3)),b.setAttribute("uv",new Je(p,2)),b.setAttribute("faceIndex",new Je(d,1)),e.push(b),r>4&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:i}}(),Yu=Ju._lodPlanes,Zu=Ju._sizeLods,Qu=Ju._sigmas,Ku=null,$u=(1+Math.sqrt(5))/2,ec=1/$u,tc=[new b(1,1,1),new b(-1,1,1),new b(1,1,-1),new b(-1,1,-1),new b(0,$u,ec),new b(0,$u,-ec),new b(ec,0,$u),new b(-ec,0,$u),new b($u,ec,0),new b(-$u,ec,0)],ic=function(e){var t,i,r;this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=(t=20,i=new Float32Array(t),r=new b(0,1,0),new Ls({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r},inputEncoding:{value:qu[3e3]},outputEncoding:{value:qu[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)};function rc(e){return void 0!==e&&1009===e.type&&(3e3===e.encoding||3001===e.encoding||3007===e.encoding)}function nc(e){var t=new m(3*Vu,3*Vu,e);return t.texture.mapping=306,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function oc(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function sc(){return new Ls({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new s(1,1)},inputEncoding:{value:qu[3e3]},outputEncoding:{value:qu[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function ac(){return new Ls({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:qu[3e3]},outputEncoding:{value:qu[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}ic.prototype.fromScene=function(e,t,i,r){void 0===t&&(t=0),void 0===i&&(i=.1),void 0===r&&(r=100),Ku=this._renderer.getRenderTarget();var n=this._allocateTargets();return this._sceneToCubeUV(e,i,r,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n},ic.prototype.fromEquirectangular=function(e){return this._fromTexture(e)},ic.prototype.fromCubemap=function(e){return this._fromTexture(e)},ic.prototype.compileCubemapShader=function(){null===this._cubemapShader&&(this._cubemapShader=ac(),this._compileMaterial(this._cubemapShader))},ic.prototype.compileEquirectangularShader=function(){null===this._equirectShader&&(this._equirectShader=sc(),this._compileMaterial(this._equirectShader))},ic.prototype.dispose=function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var e=0;e<Yu.length;e++)Yu[e].dispose()},ic.prototype._cleanup=function(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Ku),e.scissorTest=!1,oc(e,0,0,e.width,e.height)},ic.prototype._fromTexture=function(e){Ku=this._renderer.getRenderTarget();var t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t},ic.prototype._allocateTargets=function(e){var t={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:rc(e)?e.encoding:3002,depthBuffer:!1},i=nc(t);return i.depthBuffer=!e,this._pingPongRenderTarget=nc(t),i},ic.prototype._compileMaterial=function(e){var t=new Dt(Yu[0],e);this._renderer.compile(t,Xu)},ic.prototype._sceneToCubeUV=function(e,t,i,r){var n=new qt(90,1,t,i),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,l=a.outputEncoding,u=a.toneMapping,c=a.getClearColor(),h=a.getClearAlpha();a.toneMapping=0,a.outputEncoding=3e3;var p=e.background;if(p&&p.isColor){p.convertSRGBToLinear();var d=Math.max(p.r,p.g,p.b),f=Math.min(Math.max(Math.ceil(Math.log2(d)),-128),127);p=p.multiplyScalar(Math.pow(2,-f));var m=(f+128)/255;a.setClearColor(p,m),e.background=null}for(var g=0;g<6;g++){var v=g%3;0==v?(n.up.set(0,o[g],0),n.lookAt(s[g],0,0)):1==v?(n.up.set(0,0,o[g]),n.lookAt(0,s[g],0)):(n.up.set(0,o[g],0),n.lookAt(0,0,s[g])),oc(r,v*Vu,g>2?Vu:0,Vu,Vu),a.setRenderTarget(r),a.render(e,n)}a.toneMapping=u,a.outputEncoding=l,a.setClearColor(c,h)},ic.prototype._textureToCubeUV=function(e,t){var i=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=ac()):null==this._equirectShader&&(this._equirectShader=sc());var r=e.isCubeTexture?this._cubemapShader:this._equirectShader,n=new Dt(Yu[0],r),o=r.uniforms;o.envMap.value=e,e.isCubeTexture||o.texelSize.value.set(1/e.image.width,1/e.image.height),o.inputEncoding.value=qu[e.encoding],o.outputEncoding.value=qu[t.texture.encoding],oc(t,0,0,3*Vu,2*Vu),i.setRenderTarget(t),i.render(n,Xu)},ic.prototype._applyPMREM=function(e){var t=this._renderer,i=t.autoClear;t.autoClear=!1;for(var r=1;r<Gu;r++){var n=Math.sqrt(Qu[r]*Qu[r]-Qu[r-1]*Qu[r-1]),o=tc[(r-1)%tc.length];this._blur(e,r-1,r,n,o)}t.autoClear=i},ic.prototype._blur=function(e,t,i,r,n){var o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",n),this._halfBlur(o,e,i,i,r,"longitudinal",n)},ic.prototype._halfBlur=function(e,t,i,r,n,o,s){var a=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");var u=new Dt(Yu[r],l),c=l.uniforms,h=Zu[i]-1,p=isFinite(n)?Math.PI/(2*h):2*Math.PI/39,d=n/p,f=isFinite(n)?1+Math.floor(3*d):20;f>20&&console.warn("sigmaRadians, "+n+", is too large and will clip, as it requested "+f+" samples when the maximum is set to 20");for(var m=[],g=0,v=0;v<20;++v){var y=v/d,b=Math.exp(-y*y/2);m.push(b),0==v?g+=b:v<f&&(g+=2*b)}for(var _=0;_<m.length;_++)m[_]=m[_]/g;c.envMap.value=e.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===o,s&&(c.poleAxis.value=s),c.dTheta.value=p,c.mipInt.value=8-i,c.inputEncoding.value=qu[e.texture.encoding],c.outputEncoding.value=qu[e.texture.encoding];var x=Zu[r];oc(t,3*Math.max(0,Vu-2*x),(0===r?0:2*Vu)+2*x*(r>4?r-8+4:0),3*x,2*x),a.setRenderTarget(t),a.render(u,Xu)};function lc(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),ja.call(this,e),this.type="catmullrom",this.closed=!0}function uc(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),ja.call(this,e),this.type="catmullrom"}function cc(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),ja.call(this,e),this.type="catmullrom"}_a.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(_a.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Ua.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new It,i=0,r=e.length;i<r;i++){var n=e[i];t.vertices.push(new b(n.x,n.y,n.z||0))}return t}}),Object.assign(za.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),lc.prototype=Object.create(ja.prototype),uc.prototype=Object.create(ja.prototype),cc.prototype=Object.create(ja.prototype),Object.assign(cc.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Tu.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},yu.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(ha.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),nl.extractUrlBase(e)}}),ha.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(ul.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(lu.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(E.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(I.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Kt.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},hu.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(o,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),o.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),o.ceilPowerOfTwo(e)}}),Object.assign(u.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(X.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new b).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,i,r,n,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,i,n,o)}}),we.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},v.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(q.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Oe.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Oe,{barycoordFromPoint:function(e,t,i,r,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Oe.getBarycoord(e,t,i,r,n)},normal:function(e,t,i,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Oe.getNormal(e,t,i,r)}}),Object.assign(Ha.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ds(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ms(this,e)}}),Object.assign(s.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(b.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(d.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(It.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(be.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(be.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Dt.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Dt.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Nn.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Wn.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Un.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(_a.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),qt.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Va.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Je.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Object.assign(Je.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(dt.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Je(arguments[1],arguments[2])))},addDrawCall:function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(dt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(ol.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}}),Object.defineProperties(iu.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(dn.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),35048===this.usage},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(dn.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(fs.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(pn.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties($l.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(We.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ze}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Us.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Ns.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(e){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=e}}}),Object.defineProperties(Wt.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(ln.prototype,{clearTarget:function(e,t,i,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(ln.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?3001:3e3}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Qr.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(m.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Al.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new _l).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Il.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Xt.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var hc={merge:function(e,t,i){var r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,i)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};c.crossOrigin=void 0,c.loadTexture=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new ba;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,i,void 0,r);return t&&(o.mapping=t),o},c.loadTextureCube=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new va;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,i,void 0,r);return t&&(o.mapping=t),o},c.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},c.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var pc={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"120"}})),e.ACESFilmicToneMapping=4,e.AddEquation=100,e.AddOperation=2,e.AdditiveAnimationBlendMode=2501,e.AdditiveBlending=2,e.AlphaFormat=1021,e.AlwaysDepth=1,e.AlwaysStencilFunc=519,e.AmbientLight=$a,e.AmbientLightProbe=El,e.AnimationClip=sa,e.AnimationLoader=fa,e.AnimationMixer=Kl,e.AnimationObjectGroup=Zl,e.AnimationUtils=Xs,e.ArcCurve=Ea,e.ArrayCamera=tn,e.ArrowHelper=zu,e.Audio=Al,e.AudioAnalyser=Il,e.AudioContext=bl,e.AudioListener=Dl,e.AudioLoader=_l,e.AxesHelper=Hu,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Hu(e)},e.BackSide=1,e.BasicDepthPacking=3200,e.BasicShadowMap=0,e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new ya(e)},e.Bone=Gn,e.BooleanKeyframeTrack=$s,e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Lu(e,t)},e.Box2=lu,e.Box3=E,e.Box3Helper=Iu,e.BoxBufferGeometry=Ut,e.BoxGeometry=Nt,e.BoxHelper=Lu,e.BufferAttribute=Je,e.BufferGeometry=dt,e.BufferGeometryLoader=al,e.ByteType=1010,e.Cache=la,e.Camera=Gt,e.CameraHelper=Au,e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.CanvasTexture=yo,e.CatmullRomCurve3=ja,e.CineonToneMapping=3,e.CircleBufferGeometry=Os,e.CircleGeometry=ks,e.ClampToEdgeWrapping=1001,e.Clock=Cl,e.ClosedSplineCurve3=lc,e.Color=ze,e.ColorKeyframeTrack=ea,e.CompressedTexture=vo,e.CompressedTextureLoader=ma,e.ConeBufferGeometry=As,e.ConeGeometry=Ds,e.CubeCamera=Xt,e.CubeGeometry=Nt,e.CubeReflectionMapping=301,e.CubeRefractionMapping=302,e.CubeTexture=_i,e.CubeTextureLoader=va,e.CubeUVReflectionMapping=306,e.CubeUVRefractionMapping=307,e.CubicBezierCurve=Aa,e.CubicBezierCurve3=ka,e.CubicInterpolant=Ys,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.CullFaceNone=0,e.Curve=_a,e.CurvePath=Ua,e.CustomBlending=5,e.CustomToneMapping=5,e.CylinderBufferGeometry=Rs,e.CylinderGeometry=Ps,e.Cylindrical=su,e.DataTexture=Yt,e.DataTexture2DArray=xi,e.DataTexture3D=Ei,e.DataTextureLoader=ya,e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=ca,e.DepthFormat=1026,e.DepthStencilFormat=1027,e.DepthTexture=bo,e.DirectionalLight=Ka,e.DirectionalLightHelper=Pu,e.DiscreteInterpolant=Qs,e.DodecahedronBufferGeometry=Ao,e.DodecahedronGeometry=Do,e.DoubleSide=2,e.DstAlphaFactor=206,e.DstColorFactor=208,e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Je(e,t).setUsage(35048)},e.DynamicCopyUsage=35050,e.DynamicDrawUsage=35048,e.DynamicReadUsage=35049,e.EdgesGeometry=js,e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new so(new js(e.geometry),new Qn({color:void 0!==t?t:16777215}))},e.EllipseCurve=xa,e.EqualDepth=4,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=303,e.EquirectangularRefractionMapping=304,e.Euler=te,e.EventDispatcher=t,e.ExtrudeBufferGeometry=fs,e.ExtrudeGeometry=ds,e.Face3=He,e.Face4=function(e,t,i,r,n,o,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new He(e,t,i,n,o,s)},e.FaceColors=1,e.FileLoader=da,e.FlatShading=1,e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new it(e,t)},e.Float32BufferAttribute=it,e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new rt(e,t)},e.Float64BufferAttribute=rt,e.FloatType=1015,e.Fog=hn,e.FogExp2=cn,e.Font=gl,e.FontLoader=yl,e.FrontSide=0,e.Frustum=Kt,e.GLBufferAttribute=tu,e.GLSL1="100",e.GLSL3="300 es",e.GammaEncoding=3007,e.Geometry=It,e.GeometryUtils=hc,e.GreaterDepth=6,e.GreaterEqualDepth=5,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=Tu,e.Group=rn,e.HalfFloatType=1016,e.HemisphereLight=Wa,e.HemisphereLightHelper=wu,e.HemisphereLightProbe=xl,e.IcosahedronBufferGeometry=Ro,e.IcosahedronGeometry=Po,e.ImageBitmapLoader=fl,e.ImageLoader=ga,e.ImageUtils=c,e.ImmediateRenderObject=pu,e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=sl,e.InstancedBufferGeometry=ol,e.InstancedInterleavedBuffer=eu,e.InstancedMesh=Zn,e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Ke(e,t)},e.Int16BufferAttribute=Ke,e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new et(e,t)},e.Int32BufferAttribute=et,e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Ye(e,t)},e.Int8BufferAttribute=Ye,e.IntType=1013,e.InterleavedBuffer=dn,e.InterleavedBufferAttribute=gn,e.Interpolant=Js,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.KeepStencilOp=7680,e.KeyframeTrack=Ks,e.LOD=Nn,e.LatheBufferGeometry=Ts,e.LatheGeometry=ws,e.Layers=oe,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},e.LessDepth=2,e.LessEqualDepth=3,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=Va,e.LightProbe=il,e.LightShadow=Ga,e.Line=ro,e.Line3=hu,e.LineBasicMaterial=Qn,e.LineCurve=Oa,e.LineCurve3=Ba,e.LineDashedMaterial=Gs,e.LineLoop=ao,e.LinePieces=1,e.LineSegments=so,e.LineStrip=0,e.LinearEncoding=3e3,e.LinearFilter=1006,e.LinearInterpolant=Zs,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=1008,e.LinearMipmapNearestFilter=1007,e.LinearToneMapping=1,e.Loader=ha,e.LoaderUtils=nl,e.LoadingManager=ua,e.LogLuvEncoding=3003,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=2201,e.LuminanceAlphaFormat=1025,e.LuminanceFormat=1024,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.Material=We,e.MaterialLoader=rl,e.Math=o,e.MathUtils=o,e.Matrix3=u,e.Matrix4=X,e.MaxEquation=104,e.Mesh=Dt,e.MeshBasicMaterial=Ge,e.MeshDepthMaterial=Yr,e.MeshDistanceMaterial=Zr,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MeshLambertMaterial=Vs,e.MeshMatcapMaterial=Ws,e.MeshNormalMaterial=Hs,e.MeshPhongMaterial=Us,e.MeshPhysicalMaterial=Ns,e.MeshStandardMaterial=Is,e.MeshToonMaterial=zs,e.MinEquation=103,e.MirroredRepeatWrapping=1002,e.MixOperation=1,e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.MultiplyBlending=4,e.MultiplyOperation=0,e.NearestFilter=1003,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=1005,e.NearestMipmapNearestFilter=1004,e.NeverDepth=0,e.NeverStencilFunc=512,e.NoBlending=0,e.NoColors=0,e.NoToneMapping=0,e.NormalAnimationBlendMode=2500,e.NormalBlending=1,e.NotEqualDepth=7,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=ta,e.Object3D=be,e.ObjectLoader=ul,e.ObjectSpaceNormalMap=1,e.OctahedronBufferGeometry=jo,e.OctahedronGeometry=So,e.OneFactor=201,e.OneMinusDstAlphaFactor=207,e.OneMinusDstColorFactor=209,e.OneMinusSrcAlphaFactor=205,e.OneMinusSrcColorFactor=203,e.OrthographicCamera=Za,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.PMREMGenerator=ic,e.ParametricBufferGeometry=Eo,e.ParametricGeometry=xo,e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Rn(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new lo(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new fo(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new lo(e)},e.Path=za,e.PerspectiveCamera=qt,e.Plane=we,e.PlaneBufferGeometry=ii,e.PlaneGeometry=ti,e.PlaneHelper=Nu,e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new fo(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new lo(e)},e.PointLight=Ya,e.PointLightHelper=bu,e.Points=fo,e.PointsMaterial=lo,e.PolarGridHelper=Mu,e.PolyhedronBufferGeometry=To,e.PolyhedronGeometry=wo,e.PositionalAudio=Ll,e.PropertyBinding=Yl,e.PropertyMixer=Nl,e.QuadraticBezierCurve=Fa,e.QuadraticBezierCurve3=La,e.Quaternion=v,e.QuaternionKeyframeTrack=ra,e.QuaternionLinearInterpolant=ia,e.REVISION="120",e.RGBADepthPacking=3201,e.RGBAFormat=1023,e.RGBAIntegerFormat=1033,e.RGBA_ASTC_10x10_Format=37819,e.RGBA_ASTC_10x5_Format=37816,e.RGBA_ASTC_10x6_Format=37817,e.RGBA_ASTC_10x8_Format=37818,e.RGBA_ASTC_12x10_Format=37820,e.RGBA_ASTC_12x12_Format=37821,e.RGBA_ASTC_4x4_Format=37808,e.RGBA_ASTC_5x4_Format=37809,e.RGBA_ASTC_5x5_Format=37810,e.RGBA_ASTC_6x5_Format=37811,e.RGBA_ASTC_6x6_Format=37812,e.RGBA_ASTC_8x5_Format=37813,e.RGBA_ASTC_8x6_Format=37814,e.RGBA_ASTC_8x8_Format=37815,e.RGBA_BPTC_Format=36492,e.RGBA_ETC2_EAC_Format=37496,e.RGBA_PVRTC_2BPPV1_Format=35843,e.RGBA_PVRTC_4BPPV1_Format=35842,e.RGBA_S3TC_DXT1_Format=33777,e.RGBA_S3TC_DXT3_Format=33778,e.RGBA_S3TC_DXT5_Format=33779,e.RGBDEncoding=3006,e.RGBEEncoding=3002,e.RGBEFormat=1023,e.RGBFormat=1022,e.RGBIntegerFormat=1032,e.RGBM16Encoding=3005,e.RGBM7Encoding=3004,e.RGB_ETC1_Format=36196,e.RGB_ETC2_Format=37492,e.RGB_PVRTC_2BPPV1_Format=35841,e.RGB_PVRTC_4BPPV1_Format=35840,e.RGB_S3TC_DXT1_Format=33776,e.RGFormat=1030,e.RGIntegerFormat=1031,e.RawShaderMaterial=Ls,e.Ray=q,e.Raycaster=iu,e.RectAreaLight=el,e.RedFormat=1028,e.RedIntegerFormat=1029,e.ReinhardToneMapping=2,e.RepeatWrapping=1e3,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=102,e.RingBufferGeometry=Es,e.RingGeometry=xs,e.SRGB8_ALPHA8_ASTC_10x10_Format=37851,e.SRGB8_ALPHA8_ASTC_10x5_Format=37848,e.SRGB8_ALPHA8_ASTC_10x6_Format=37849,e.SRGB8_ALPHA8_ASTC_10x8_Format=37850,e.SRGB8_ALPHA8_ASTC_12x10_Format=37852,e.SRGB8_ALPHA8_ASTC_12x12_Format=37853,e.SRGB8_ALPHA8_ASTC_4x4_Format=37840,e.SRGB8_ALPHA8_ASTC_5x4_Format=37841,e.SRGB8_ALPHA8_ASTC_5x5_Format=37842,e.SRGB8_ALPHA8_ASTC_6x5_Format=37843,e.SRGB8_ALPHA8_ASTC_6x6_Format=37844,e.SRGB8_ALPHA8_ASTC_8x5_Format=37845,e.SRGB8_ALPHA8_ASTC_8x6_Format=37846,e.SRGB8_ALPHA8_ASTC_8x8_Format=37847,e.Scene=pn,e.SceneUtils=pc,e.ShaderChunk=ri,e.ShaderLib=oi,e.ShaderMaterial=Wt,e.ShadowMaterial=Fs,e.Shape=Ha,e.ShapeBufferGeometry=Cs,e.ShapeGeometry=Ms,e.ShapePath=ml,e.ShapeUtils=cs,e.ShortType=1011,e.Skeleton=Wn,e.SkeletonHelper=yu,e.SkinnedMesh=Un,e.SmoothShading=2,e.Sphere=I,e.SphereBufferGeometry=_s,e.SphereGeometry=bs,e.Spherical=ou,e.SphericalHarmonics3=tl,e.Spline=cc,e.SplineCurve=Ia,e.SplineCurve3=uc,e.SpotLight=Xa,e.SpotLightHelper=fu,e.Sprite=Rn,e.SpriteMaterial=vn,e.SrcAlphaFactor=204,e.SrcAlphaSaturateFactor=210,e.SrcColorFactor=202,e.StaticCopyUsage=35046,e.StaticDrawUsage=35044,e.StaticReadUsage=35045,e.StereoCamera=Ml,e.StreamCopyUsage=35042,e.StreamDrawUsage=35040,e.StreamReadUsage=35041,e.StringKeyframeTrack=na,e.SubtractEquation=101,e.SubtractiveBlending=3,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TangentSpaceNormalMap=0,e.TetrahedronBufferGeometry=Co,e.TetrahedronGeometry=Mo,e.TextBufferGeometry=ys,e.TextGeometry=vs,e.Texture=p,e.TextureLoader=ba,e.TorusBufferGeometry=Io,e.TorusGeometry=Lo,e.TorusKnotBufferGeometry=Fo,e.TorusKnotGeometry=Bo,e.Triangle=Oe,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeBufferGeometry=Oo,e.TubeGeometry=ko,e.UVMapping=300,e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new $e(e,t)},e.Uint16BufferAttribute=$e,e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new tt(e,t)},e.Uint32BufferAttribute=tt,e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Ze(e,t)},e.Uint8BufferAttribute=Ze,e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Qe(e,t)},e.Uint8ClampedBufferAttribute=Qe,e.Uniform=$l,e.UniformsLib=ni,e.UniformsUtils=Vt,e.UnsignedByteType=1009,e.UnsignedInt248Type=1020,e.UnsignedIntType=1014,e.UnsignedShort4444Type=1017,e.UnsignedShort5551Type=1018,e.UnsignedShort565Type=1019,e.UnsignedShortType=1012,e.VSMShadowMap=3,e.Vector2=s,e.Vector3=b,e.Vector4=d,e.VectorKeyframeTrack=oa,e.Vertex=function(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new b(e,t,i)},e.VertexColors=2,e.VideoTexture=go,e.WebGL1Renderer=un,e.WebGLCubeRenderTarget=Jt,e.WebGLMultisampleRenderTarget=g,e.WebGLRenderTarget=m,e.WebGLRenderTargetCube=function(e,t,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Jt(e,i)},e.WebGLRenderer=ln,e.WebGLUtils=en,e.WireframeGeometry=_o,e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new so(new _o(e.geometry),new Qn({color:void 0!==t?t:16777215}))},e.WrapAroundEnding=2402,e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new da(e)},e.ZeroCurvatureEnding=2400,e.ZeroFactor=200,e.ZeroSlopeEnding=2401,e.ZeroStencilOp=0,e.sRGBEncoding=3001,Object.defineProperty(e,"__esModule",{value:!0})})),THREE.BufferGeometryUtils={computeTangents:function(e){var t=e.index,i=e.attributes;if(null!==t&&void 0!==i.position&&void 0!==i.normal&&void 0!==i.uv){var r=t.array,n=i.position.array,o=i.normal.array,s=i.uv.array,a=n.length/3;void 0===i.tangent&&e.setAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*a),4));for(var l=i.tangent.array,u=[],c=[],h=0;h<a;h++)u[h]=new THREE.Vector3,c[h]=new THREE.Vector3;var p=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Vector2,g=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector3,b=new THREE.Vector3,_=e.groups;0===_.length&&(_=[{start:0,count:r.length}]);h=0;for(var x=_.length;h<x;++h)for(var E=A=(D=_[h]).start,w=A+D.count;E<w;E+=3)k(r[E+0],r[E+1],r[E+2]);var T,M,C,S=new THREE.Vector3,j=new THREE.Vector3,P=new THREE.Vector3,R=new THREE.Vector3;for(h=0,x=_.length;h<x;++h){var D,A;for(E=A=(D=_[h]).start,w=A+D.count;E<w;E+=3)O(r[E+0]),O(r[E+1]),O(r[E+2])}}else console.error("THREE.BufferGeometryUtils: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function k(e,t,i){p.fromArray(n,3*e),d.fromArray(n,3*t),f.fromArray(n,3*i),m.fromArray(s,2*e),g.fromArray(s,2*t),v.fromArray(s,2*i),d.sub(p),f.sub(p),g.sub(m),v.sub(m);var r=1/(g.x*v.y-v.x*g.y);isFinite(r)&&(y.copy(d).multiplyScalar(v.y).addScaledVector(f,-g.y).multiplyScalar(r),b.copy(f).multiplyScalar(g.x).addScaledVector(d,-v.x).multiplyScalar(r),u[e].add(y),u[t].add(y),u[i].add(y),c[e].add(b),c[t].add(b),c[i].add(b))}function O(e){P.fromArray(o,3*e),R.copy(P),M=u[e],S.copy(M),S.sub(P.multiplyScalar(P.dot(M))).normalize(),j.crossVectors(R,M),C=j.dot(c[e]),T=C<0?-1:1,l[4*e]=S.x,l[4*e+1]=S.y,l[4*e+2]=S.z,l[4*e+3]=T}},mergeBufferGeometries:function(e,t){for(var i=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),o={},s={},a=e[0].morphTargetsRelative,l=new THREE.BufferGeometry,u=0,c=0;c<e.length;++c){var h=e[c],p=0;if(i!==(null!==h.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(var d in h.attributes){if(!r.has(d))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+'. All geometries must have compatible attributes; make sure "'+d+'" attribute exists among all geometries, or in none of them.'),null;void 0===o[d]&&(o[d]=[]),o[d].push(h.attributes[d]),p++}if(p!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". Make sure all geometries have the same number of attributes."),null;if(a!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(var d in h.morphAttributes){if(!n.has(d))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===s[d]&&(s[d]=[]),s[d].push(h.morphAttributes[d])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(h.userData),t){var f;if(i)f=h.index.count;else{if(void 0===h.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". The geometry must have either an index or a position attribute"),null;f=h.attributes.position.count}l.addGroup(u,f,c),u+=f}}if(i){var m=0,g=[];for(c=0;c<e.length;++c){for(var v=e[c].index,y=0;y<v.count;++y)g.push(v.getX(y)+m);m+=e[c].attributes.position.count}l.setIndex(g)}for(var d in o){var b=this.mergeBufferAttributes(o[d]);if(!b)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+d+" attribute."),null;l.setAttribute(d,b)}for(var d in s){var _=s[d][0].length;if(0===_)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[d]=[];for(c=0;c<_;++c){var x=[];for(y=0;y<s[d].length;++y)x.push(s[d][y][c]);var E=this.mergeBufferAttributes(x);if(!E)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+d+" morphAttribute."),null;l.morphAttributes[d].push(E)}}return l},mergeBufferAttributes:function(e){for(var t,i,r,n=0,o=0;o<e.length;++o){var s=e[o];if(s.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=s.array.constructor),t!==s.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=s.itemSize),i!==s.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=s.normalized),r!==s.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=s.array.length}var a=new t(n),l=0;for(o=0;o<e.length;++o)a.set(e[o].array,l),l+=e[o].array.length;return new THREE.BufferAttribute(a,i,r)},interleaveAttributes:function(e){for(var t,i=0,r=0,n=0,o=e.length;n<o;++n){var s=e[n];if(void 0===t&&(t=s.array.constructor),t!==s.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;i+=s.array.length,r+=s.itemSize}var a=new THREE.InterleavedBuffer(new t(i),r),l=0,u=[],c=["getX","getY","getZ","getW"],h=["setX","setY","setZ","setW"],p=0;for(o=e.length;p<o;p++){var d=(s=e[p]).itemSize,f=s.count,m=new THREE.InterleavedBufferAttribute(a,d,l,s.normalized);u.push(m),l+=d;for(var g=0;g<f;g++)for(var v=0;v<d;v++)m[h[v]](g,s[c[v]](g))}return u},estimateBytesUsed:function(e){var t=0;for(var i in e.attributes){var r=e.getAttribute(i);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}var n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0},mergeVertices:function(e,t=1e-4){t=Math.max(t,Number.EPSILON);for(var i={},r=e.getIndex(),n=e.getAttribute("position"),o=r?r.count:n.count,s=0,a=Object.keys(e.attributes),l={},u={},c=[],h=["getX","getY","getZ","getW"],p=0,d=a.length;p<d;p++){l[b=a[p]]=[],(w=e.morphAttributes[b])&&(u[b]=new Array(w.length).fill().map(()=>[]))}var f=Math.log10(1/t),m=Math.pow(10,f);for(p=0;p<o;p++){var g=r?r.getX(p):p,v="",y=0;for(d=a.length;y<d;y++)for(var b=a[y],_=(E=e.getAttribute(b)).itemSize,x=0;x<_;x++)v+=~~(E[h[x]](g)*m)+",";if(v in i)c.push(i[v]);else{for(y=0,d=a.length;y<d;y++){b=a[y];var E=e.getAttribute(b),w=e.morphAttributes[b],T=(_=E.itemSize,l[b]),M=u[b];for(x=0;x<_;x++){var C=h[x];if(T.push(E[C](g)),w)for(var S=0,j=w.length;S<j;S++)M[S].push(w[S][C](g))}}i[v]=s,c.push(s),s++}}const P=e.clone();for(p=0,d=a.length;p<d;p++){b=a[p];var R=e.getAttribute(b),D=new R.array.constructor(l[b]);E=new THREE.BufferAttribute(D,R.itemSize,R.normalized);if(P.setAttribute(b,E),b in u)for(y=0;y<u[b].length;y++){var A=e.morphAttributes[b][y],k=(D=new A.array.constructor(u[b][y]),new THREE.BufferAttribute(D,A.itemSize,A.normalized));P.morphAttributes[b][y]=k}}return P.setIndex(c),P},toTrianglesDrawMode:function(e,t){if(t===THREE.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===THREE.TriangleFanDrawMode||t===THREE.TriangleStripDrawMode){var i=e.getIndex();if(null===i){var r=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<n.count;o++)r.push(o);e.setIndex(r),i=e.getIndex()}var s=i.count-2,a=[];if(t===THREE.TriangleFanDrawMode)for(o=1;o<=s;o++)a.push(i.getX(0)),a.push(i.getX(o)),a.push(i.getX(o+1));else for(o=0;o<s;o++)o%2==0?(a.push(i.getX(o)),a.push(i.getX(o+1)),a.push(i.getX(o+2))):(a.push(i.getX(o+2)),a.push(i.getX(o+1)),a.push(i.getX(o)));a.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(a),l.clearGroups(),l}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}},THREE.CombinedCamera=function(e,t,i,r,n,o,s){THREE.Camera.call(this),this.fov=i,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,s),this.cameraP=new THREE.PerspectiveCamera(i,e/t,r,n),this.zoom=1,this.view=null,this.matrixTween=null,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.updateProjectionMatrix(),this.projectionMatrix.copy(this.cameraP.projectionMatrix),this.projectionMatrixInverse.copy(this.cameraP.projectionMatrixInverse),this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){this.fov;var e=this.cameraP.aspect,t=(this.cameraP.near,this.cameraP.far,this.orthoSize.z),i=this.orthoSize.depth,r=i*t*e/2,n=i*t/2;n/=this.zoom,r/=this.zoom,this.cameraO.left=-r,this.cameraO.right=r,this.cameraO.top=n,this.cameraO.bottom=-n,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix.copy(this.cameraO.projectionMatrix),this.projectionMatrixInverse.copy(this.cameraO.projectionMatrixInverse),this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?(this.cameraP.fov=this.fov,this.toPerspective()):this.toOrthographic()},THREE.CombinedCamera.prototype.setViewOffset=function(e,t,i,r,n,o){this.cameraP.setViewOffset(e,t,i,r,n,o),this.cameraO.setViewOffset(e,t,i,r,n,o),this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.clearViewOffset=function(){this.cameraP.clearViewOffset(),this.cameraO.clearViewOffset(),this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t,i,r){void 0===t&&(t=24);var n=0;if(i){var o=parseInt("42EF",16);n=parseInt(r||"nahoanehc")&o}else n=2*THREE.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(n),n},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.clone=function(){var e=new THREE.CombinedCamera;return e.copy(this),e.fov=this.fov,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.cameraO=this.cameraO.clone(),e.cameraP=this.cameraP.clone(),e.zoom=this.zoom,e.view=this.view,e.matrixTween=this.matrixTween,e},THREE.CSS3DObject=function(e){THREE.Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",(function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)}))},THREE.CSS3DObject.prototype=Object.create(THREE.Object3D.prototype),THREE.CSS3DObject.prototype.constructor=THREE.CSS3DObject,THREE.CSS3DSprite=function(e){THREE.CSS3DObject.call(this,e)},THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype),THREE.CSS3DSprite.prototype.constructor=THREE.CSS3DSprite,THREE.CSS3DRenderer=function(e){var t,i,r,n,o=(e=e||{}).autoFixCamera,s=new THREE.Matrix4,a=new THREE.Matrix4,l=new THREE.Matrix4,u={camera:{fov:0,style:""},objects:{}},c=document.createElement("div");c.style.overflow="hidden",this.domElement=c;var h=document.createElement("div");h.style.WebkitTransformStyle="preserve-3d",h.style.MozTransformStyle="preserve-3d",h.style.transformStyle="preserve-3d",c.appendChild(h);var p=/Trident/i.test(navigator.userAgent);function d(e){return Math.abs(e)<1e-10?0:e}function f(e){var t=e.elements;return"matrix3d("+d(t[0])+","+d(-t[1])+","+d(t[2])+","+d(t[3])+","+d(t[4])+","+d(-t[5])+","+d(t[6])+","+d(t[7])+","+d(t[8])+","+d(-t[9])+","+d(t[10])+","+d(t[11])+","+d(t[12])+","+d(-t[13])+","+d(t[14])+","+d(t[15])+")"}function m(e,t){var i=e.elements,o="matrix3d("+d(i[0])+","+d(i[1])+","+d(i[2])+","+d(i[3])+","+d(-i[4])+","+d(-i[5])+","+d(-i[6])+","+d(-i[7])+","+d(i[8])+","+d(i[9])+","+d(i[10])+","+d(i[11])+","+d(i[12])+","+d(i[13])+","+d(i[14])+","+d(i[15])+")";return p?"translate(-50%,-50%)translate("+r+"px,"+n+"px)"+t+o:"translate(-50%,-50%)"+o}function g(e,t){a.copy(e),a.premultiply(t.matrixWorldInverse);var i=(e=a).elements,o="matrix3d("+d(i[0])+","+d(i[1])+","+d(i[2])+","+d(i[3])+","+d(-i[4])+","+d(-i[5])+","+d(-i[6])+","+d(-i[7])+","+d(i[8])+","+d(i[9])+","+d(i[10])+","+d(i[11])+","+d(i[12])+","+d(i[13])+","+d(i[14])+","+d(i[15])+")";return p?"translate(-50%,-50%)translate("+r+"px,"+n+"px)"+cameraCSSMatrix+o:"translate(-50%,-50%)"+o}this.setClearColor=function(){},this.getSize=function(){return{width:t,height:i}},this.setSize=function(e,o){r=(t=e)/2,n=(i=o)/2,c.style.width=e+"px",c.style.height=o+"px",h.style.width=e+"px",h.style.height=o+"px"};var v,y,b=(v=new THREE.Vector3,y=new THREE.Vector3,function(e,t){return v.setFromMatrixPosition(e.matrixWorld),y.setFromMatrixPosition(t.matrixWorld),v.distanceToSquared(y)});this.render=function(e,t){var a;a=t.isOrthoLerping||t.isOrthographicCamera?.5/Math.tan(THREE.Math.degToRad(.5*t.getEffectiveFOV()))*i:t.projectionMatrix.elements[5]*n,u.camera.fov!==a&&(c.style.WebkitPerspective=a+"px",c.style.MozPerspective=a+"px",c.style.perspective=a+"px",u.camera.fov=a),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld();var d="translateZ("+a+"px)";!t.isPerspectiveLerping&&t.isOrthographicCamera&&(d+="scale("+t.zoom+")");var v=(d+=f(o?l:t.matrixWorldInverse))+"translate("+r+"px,"+n+"px)";u.camera.style===v||p||(h.style.WebkitTransform=v,h.style.MozTransform=v,h.style.transform=v,u.camera.style=v),function e(t,i,r){if(t instanceof THREE.CSS3DObject){var n;t instanceof THREE.CSS3DSprite?(s.copy(i.matrixWorldInverse),s.transpose(),s.copyPosition(t.matrixWorld),s.scale(t.scale),s.elements[3]=0,s.elements[7]=0,s.elements[11]=0,s.elements[15]=1,n=o?g(s,i):m(s,r)):n=o?g(t.matrixWorld,i):m(t.matrixWorld,r);var a=t.element,l=u.objects[t.id]&&u.objects[t.id].style;if(void 0!==l&&l===n||(a.style.WebkitTransform=n,a.style.MozTransform=n,a.style.transform=n,u.objects[t.id]={style:n},p&&(u.objects[t.id].distanceToCameraSquared=b(i,t))),a.parentNode!==h){h.appendChild(a);var c=a.onAppended;c&&c({element:a})}}for(var d=0,f=t.children.length;d<f;d++)e(t.children[d],i,r)}(e,t,d),p&&function(e){var t=Object.keys(u.objects).sort((function(e,t){return u.objects[e].distanceToCameraSquared-u.objects[t].distanceToCameraSquared})),i=t.length;e.traverse((function(e){var r=t.indexOf(e.id+"");-1!==r&&(e.element.style.zIndex=i-r)}))}(e)}},THREE.DeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var i,r,n,o,s=function(e){t.deviceOrientation=e},a=function(){t.screenOrientation=window.orientation||0},l=(i=new THREE.Vector3(0,0,1),r=new THREE.Euler,n=new THREE.Quaternion,o=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,s,a,l){r.set(s,t,-a,"YXZ"),e.setFromEuler(r),e.multiply(o),e.multiply(n.setFromAxisAngle(i,-l))});this.connect=function(){a(),window.addEventListener("orientationchange",a,!1),window.addEventListener("deviceorientation",s,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",a,!1),window.removeEventListener("deviceorientation",s,!1),t.enabled=!1},this.update=function(){if(!1!==t.enabled){var e=t.deviceOrientation;if(e){var i=e.alpha?THREE.Math.degToRad(e.alpha)+t.alphaOffset:0,r=e.beta?THREE.Math.degToRad(e.beta):0,n=e.gamma?THREE.Math.degToRad(e.gamma):0,o=t.screenOrientation?THREE.Math.degToRad(t.screenOrientation):0;l(t.object.quaternion,i,r,n,o)}}},this.dispose=function(){t.disconnect()},this.connect()},THREE.EarthOrbitControls=function(e,t){var i;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.isEarth=!0,this.target=new THREE.Vector3,this.target.set=function(e,t,i){if(r.targetLimitData){let n=THING.Math.world2Lonlat([e,t,i]);if(n&&n.length>1){const o=r.targetLimitData.min,s=r.targetLimitData.max;n[0]<o[0]?n[0]=o[0]:n[0]>s[0]&&(n[0]=s[0]),n[1]<o[1]?n[1]=o[1]:n[1]>s[1]&&(n[1]=s[1]);const a=THING.Math.lonlat2World(n);e=a[0],t=a[1],i=a[2]}}return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this},this._leftInteractive=!0,this._keepTarget=!1,this.minDistance=500,this.maxDistance=11079114.2,this.minZoom=0,this.maxZoom=1/0,this.maxPitchAngle=87,this._minPolarAngle=0,this._maxPolarAngle=THING.Math.degToRad(this.maxPitchAngle),this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.88,this.dampingZoomFactor=.5,this.enableZoom=!0,this.zoomSpeed=1,this.zoomFactor=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.mousePanSpeed=1,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.standardRadius=10216133.731679259,this.targetMaxOffset=6e7,this.panStander=this.maxDistance-6378e3,this.isDispatchEvent=!0,this.enableZoomOnTarget=!0,this.options={},this._isCameraStatic=!0,this.setOptions=function(e){this.options=e,this.mouseButtons={ORBIT:this._parseToThreeMouseKey(e.moveKey),ZOOM:this._parseToThreeMouseKey(e.zoomKey),PAN:this._parseToThreeMouseKey(e.rotationKey)},this.enableZoomOnTarget=e.enableZoomOnTarget},this._parseToThreeMouseKey=function(e){var t;switch(e){case"left":t=THREE.MOUSE.LEFT;break;case"right":t=THREE.MOUSE.RIGHT;break;case"middle":t=THREE.MOUSE.MIDDLE}return t},this._parseToThingMouseKey=function(e){var t;switch(e){case THREE.MOUSE.LEFT:t="left";break;case THREE.MOUSE.RIGHT:t="right";break;case THREE.MOUSE.MIDDLE:t="middle"}return t},this.getOptions=function(e){return this.options.rotationKey=this._parseToThingMouseKey(this.mouseButtons.PAN),this.options.zoomKey=this._parseToThingMouseKey(this.mouseButtons.ZOOM),this.options.moveKey=this._parseToThingMouseKey(this.mouseButtons.ORBIT),this.options.enableZoomOnTarget=this.enableZoomOnTarget,this.options},this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getRotationSpherePhi=function(){return h.phi},this.getSphericalRadius=function(){return c.radius},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(o),r.update(),u=l.NONE},this.goHome=function(){S=!0,r.object.up.set(0,1,0),r.object.position.set(4890109.86328125,9295980.46875,13943610.3515625),c.radius,h.phi=-.01,h.theta=Math.PI/2,h.radius=c.radius-6378e3,r._isCameraStatic=!1,r.update(),r._isCameraStatic=!0},this.setState=function(e){if(r.enabled){var t=r._getIntersectPoint();r.target.copy(t);var i=r.target,n=r.object.position,o=(new THREE.Vector3).subVectors(i,n),s=(new THREE.Vector3).crossVectors(n,o),a=(new THREE.Vector3).crossVectors(o,s);a=a.normalize(),r.object.up.copy(a),r.object.lookAt(i.x,i.y,i.z)}},this.correctUp=function(e){var t=e.time||3e3,i=e.callback,n=r.target,o=r.object.position,s=new THREE.Vector3;s.copy(r.object.up),s.normalize();var a=new THREE.Vector3;a.copy(o),a.normalize();var l=null;requestAnimationFrame((function e(o){l||(l=o);var u=o-l,c=s.lerp(a,u/t);r.object.up=c,r.object.lookAt(n),u/t<1?requestAnimationFrame(e):(i&&i(),console.log("end-correct"))}))},this._getIntersectPoint=function(e){if(void 0===e&&(e=!0),this._isCameraStatic||0===this._getState()||2===this._getState()||this._keepTarget)return this.target;var t=new THREE.Vector3,i=[];if(this.object.getWorldDirection(t),t.normalize(),A._camera=this.object,A.set(this.object.position,t),D.set(this.object.position,t),e){var r=t3djs.buffer.nodeBuffer.get("tiles-root");if(r&&r.ensureVisible()&&(i=A.intersectObjects(r.children,!0)),i.length>0)return i[0].point}var n=new THREE.Vector3;return D.intersectSphere(k,n),n.equals(new THREE.Vector3(0,0,0))?this.target:n},this._getIntersectPointByMouse=function(e,t){var i=[];if(r.isEarth){var n=new THREE.Vector3;this.object.getWorldDirection(n),n.normalize(),D.set(this.object.position,n),A.setFromCamera(new THREE.Vector2(e,t),this.object);var o=t3djs.buffer.nodeBuffer.get("tiles-root");o&&o.ensureVisible()&&(i=A.intersectObjects(o.children,!0));var s=new THREE.Vector3;return D.intersectSphere(k,s),i.length>0?i[0].point:this._getIntersectPoint()}{let e=window.innerWidth*(U.x+1)/2,t=(1-U.y)*window.innerHeight/2,i=this.app.camera.screenToWorld(e,t);return new THREE.Vector3(i[0],i[1],i[2])}},this._getIntersectQuaternion=function(e,t){(new THREE.Vector3).copy(e);var i=new THREE.Vector3;i.copy(e),i.normalize();var r=new THREE.Quaternion;r.setFromUnitVectors(new THREE.Vector3(0,1,0),i);var n=new THREE.Quaternion;return n.setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2+t),r.multiply(n),r.normalize(),r},this._correctCube=function(){var e=this._getIntersectPoint();F.position.copy(e),d.setFromVector3(e),d.radius=6378e3;var t=this._getIntersectQuaternion(e,d.theta);F.rotation.set(0,0,0),F.applyQuaternion(t),F.updateMatrixWorld(!0)},this._correctSphericalRotation=function(e){var t=new THREE.Vector3;if(t.copy(e),F.worldToLocal(t),h.setFromVector3(t),0!=r.target.length()){var i=r.object.position.distanceTo(this._getIntersectPoint());h.radius=i}h.phi=-h.phi,h.theta=Math.PI+h.theta,!1},this._getAngle=function(){if(0!=r.target.length()){var e=new THREE.Vector3;e.copy(r.target),e.normalize();var t=new THREE.Vector3(0,6378e3,0);t.sub(this.object.position),t.normalize();var i=new THREE.Vector3;this.object.getWorldDirection(i),i.projectOnPlane(e),t.projectOnPlane(e);var n=t.angleTo(i);return i.cross(t),i.sub(e),i.length()<=1&&(n*=-1),n}},this.setTargetLimit=function(e){if(e){const t=e.min,i=e.max;t&&i&&t.length>1&&i.length>1&&(this.targetLimitData={min:[t[0],t[1]],max:[i[0],i[1]]})}else this.targetLimitData=void 0},this.autoFixTarget=function(e){if(!L&&r.app&&(r.app.scene.add(F),F.visible=!1,L=!0,!0),S){if(r.dispatchEvent(o),r.enableDamping||(S=!1),N.multiply(I),r.targetLimitData){const e=r.target.clone().applyQuaternion(N),t=r.targetLimitData.min,i=r.targetLimitData.max;let n=THING.Math.world2Lonlat(e.toArray());if(n[0]<t[0]||n[0]>i[0]||n[1]<t[1]||n[1]>i[1])return}if(e.applyQuaternion(N),r.object.updateMatrixWorld(!0),0!=r.target.length()){(i=new THREE.Vector3).copy(e),i.normalize(),r.object.up.copy(i),r.target.applyQuaternion(N)}else{var t=this._getIntersectPoint();t.y+=100,r.target.copy(t)}r.object.lookAt(r.target)}else if(j){r.dispatchEvent(o),j=!1;var i,n=this._getIntersectPoint();(i=new THREE.Vector3).copy(F.position),i.normalize();var s=new THREE.Vector3;s.setFromSpherical(h),s.applyMatrix4(F.matrixWorld),r.object.up.copy(i),r.object.position.copy(s),r.target.copy(n),r.object.lookAt(r.target)}else if(P||R){r.dispatchEvent(o);var a=r.object.position.distanceTo(this._getIntersectPoint());if(a>r.maxDistance&&R||a<r.minDistance&&P)h.radius=a,f=1;else{var l;l=P&&this.enableZoomOnTarget?this._getIntersectPointByMouse(U.x,U.y):this._getIntersectPointByMouse(0,0);var u=new THREE.Vector3;u.copy(r.object.position),u.sub(l),u.normalize();var p=c.radius*f-c.radius;h.radius+=p;var d=new THREE.Vector3;d.setFromSpherical(h),u.multiplyScalar(p),r.object.position.add(u),this._correctCube(),d.applyMatrix4(F.matrixWorld),r.object.position.copy(d),r.object.up.copy(r.object.position),r.target.copy(F.position),r.object.lookAt(r.target)}r.enableDamping||(P=!1,R=!1)}},this.addEventListener("start",(function(){r._isCameraStatic=!1})),this.addEventListener("end",(function(){r._isCameraStatic=!0})),this.update=(i=new THREE.Vector3,function(){var e=r.object.position;i.copy(e),c.setFromVector3(i),d.setFromVector3(r.target),d.radius=6378e3,r.enabled&&this.autoFixTarget(e),r.object.lookAt(r.target),this._correctCube(),this._correctSphericalRotation(e);var t=r.object.position.distanceTo(this._getIntersectPoint());return r.rotateSpeed=t/3e7,r.zoomSpeed=h.radius/4e6*this.zoomFactor,r.mousePanSpeed=1,!0===r.enableDamping?S?(p.x*=1-r.dampingFactor,p.y*=1-r.dampingFactor,H(p.x),V(p.y),(j||P||R||p.x>-1e-10&&p.x<1e-10||p.y>-1e-10&&p.y<1e-10)&&(S=!1,p.set(0,0))):P?(f+=(1-f)*r.dampingZoomFactor)>.99999999&&(f=1,P=!1):R&&(f-=(f-1)*r.dampingZoomFactor)<1.0000001&&(f=1,R=!1):(p.set(0,0),f=1,S=!1,j=!1),m.set(0,0,0),!1}),this.dispose=function(){r.domElement.removeEventListener("contextmenu",se,!1),r.domElement.removeEventListener("mousedown",Q,!1),r.domElement.removeEventListener("wheel",te,!1),r.domElement.removeEventListener("touchstart",re,!1),r.domElement.removeEventListener("touchend",oe,!1),r.domElement.removeEventListener("touchmove",ne,!1),document.removeEventListener("mousemove",K,!1),document.removeEventListener("mouseup",$,!1),window.removeEventListener("keydown",ie,!1)};var r=this,n={type:"wheel"},o={type:"change"},s={type:"start"},a={type:"end"},l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},u=l.NONE;r._getState=function(){return u};var c=new THREE.Spherical,h=new THREE.Spherical;h.theta=Math.PI/2,h.phi=-.01,h.radius=this.panStander;var p=new THREE.Vector2,d=(new THREE.Spherical,new THREE.Spherical);d.radius=6378e3;new THREE.Spherical,new THREE.Cylindrical,new THREE.Cylindrical;var f=1,m=new THREE.Vector3,g=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector2,b=new THREE.Vector2,_=new THREE.Vector2,x=new THREE.Vector2,E=new THREE.Vector2,w=new THREE.Vector2,T=new THREE.Vector2,M=new THREE.Vector2,C=new THREE.Vector2,S=(new THREE.Vector3,new THREE.Vector3,!1),j=!1,P=!1,R=!1,D=new THREE.Ray,A=new THREE.Raycaster,k=new THREE.Sphere(new THREE.Vector3(0,0,0),6378e3),O=new THREE.BoxGeometry(1e3,1e3,1e3),B=new THREE.MeshBasicMaterial({color:65280}),F=new THREE.Mesh(O,B),L=!1,I=new THREE.Quaternion,N=new THREE.Quaternion,U={};function z(){return Math.pow(.95,r.zoomSpeed)}function H(e){var t=new THREE.Vector3(0,6378e4,0);t.unproject(r.object),t.normalize(),p.x=e,e*=1-Math.sin(h.phi),N.setFromAxisAngle(t,-e)}function V(e){var t=new THREE.Vector3(6378e3,0,0);t.unproject(r.object),t.normalize(),p.y=e,I.setFromAxisAngle(t,-e)}var W=function(e){h.phi>-.001||(h.theta-=e,h.theta>2*Math.PI&&(h.theta=h.theta-2*Math.PI),h.theta<0&&(h.theta=2*Math.PI+h.theta))},G=function(e){j=!0,h.phi+=e,h.phi>=-.01&&(h.phi=-.01),h.phi<-r.maxPolarAngle&&(h.phi=-r.maxPolarAngle),h.phi>-r.minPolarAngle&&(h.phi=-r.minPolarAngle)},q=function(e,t){var i=r.domElement===document?r.domElement.body:r.domElement;r.object.isPerspectiveCamera?(W(2*Math.PI*e/i.clientWidth*r.mousePanSpeed),G(2*Math.PI*t/i.clientHeight*r.mousePanSpeed)):r.object.isOrthographicCamera?(W(e*(r.object.right-r.object.left)/r.object.zoom/i.clientWidth,r.object.matrix),G(t*(r.object.top-r.object.bottom)/r.object.zoom/i.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)};function X(e){R=!0,r.object.isPerspectiveCamera?f/=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function J(e){P=!0,r.object.isPerspectiveCamera?f*=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function Y(e){b.set(e.touches[0].pageX,e.touches[0].pageY)}function Z(e){_.set(e.touches[0].pageX,e.touches[0].pageY),x.subVectors(_,b),q(x.x,x.y),b.copy(_),r.update()}function Q(e){if(!1!==r.enabled){switch(e.preventDefault(),e.button){case r.mouseButtons.ORBIT:if(!1===r.enableRotate)return;!function(e){g.set(e.clientX,e.clientY)}(e),u=l.ROTATE;break;case r.mouseButtons.ZOOM:if(!1===r.enableZoom)return;!function(e){E.set(e.clientX,e.clientY)}(e),u=l.DOLLY;break;case r.mouseButtons.PAN:if(!1===r.enablePan)return;!function(e){b.set(e.clientX,e.clientY)}(e),u=l.PAN}u!==l.NONE&&(document.addEventListener("mousemove",K,!1),document.addEventListener("mouseup",$,!1),r.dispatchEvent(s))}}function K(e){if(!1!==r.enabled)switch(e.preventDefault(),u){case l.ROTATE:if(!1===r.enableRotate)return;!function(e){S=!0,v.set(e.clientX,e.clientY),y.subVectors(v,g);var t=r.domElement===document?r.domElement.body:r.domElement;H(2*Math.PI*y.x/t.clientWidth*r.rotateSpeed),V(2*Math.PI*y.y/t.clientHeight*r.rotateSpeed),g.copy(v),r.update()}(e);break;case l.DOLLY:if(!1===r.enableZoom)return;!function(e){w.set(e.clientX,e.clientY),T.subVectors(w,E),T.y>0?X(z()):T.y<0&&J(z()),E.copy(w),r.update()}(e);break;case l.PAN:if(!1===r.enablePan)return;!function(e){_.set(e.clientX,e.clientY),x.subVectors(_,b),q(x.x,x.y),b.copy(_),r.update()}(e)}}function $(e){if(!1===r.enabled)return document.removeEventListener("mousemove",K,!1),void document.removeEventListener("mouseup",$,!1);document.removeEventListener("mousemove",K,!1),document.removeEventListener("mouseup",$,!1),r.dispatchEvent(a),u=l.NONE}r.rotate=function(e,t){switch(t=(t=t||1e3)/180*Math.PI,e){case"up":this.pan(0,t);break;case"down":this.pan(0,-t);break;case"left":this.pan(t,0);break;case"right":this.pan(-t,0)}},r.move=function(e,t){e=e/180*Math.PI,e*=this.rotateSpeed,t=t/180*Math.PI,t*=this.rotateSpeed,N.set(0,0,0,1),I.set(0,0,0,1),S=!0,H(e),V(t)},r.zoom=function(e,t){switch(t=t||.95,t=Math.pow(t,r.zoomSpeed),e){case"in":J(t);break;case"out":X(t)}},r.earthRotate=function(e,t){switch(t=(t=t||10)/180*Math.PI,t*=this.rotateSpeed,N.set(0,0,0,1),I.set(0,0,0,1),S=!0,e){case"right":H(-t);break;case"left":H(t);break;case"up":V(t);break;case"down":V(-t)}};let ee=function(){let e,t=!1;return function(){t=!0,e&&t&&clearTimeout(e),e=setTimeout((function(){r.dispatchEvent(a),t=!1}),300)}}();function te(e){!1===r.enabled||!1===r.enableZoom||u!==l.NONE&&u!==l.ROTATE||(e.preventDefault(),e.stopPropagation(),r.dispatchEvent(s),function(e){U.x=e.clientX/window.innerWidth*2-1,U.y=-e.clientY/window.innerHeight*2+1,e.deltaY<0?(J(z()),r.dispatchEvent(n)):e.deltaY>0&&(X(z()),r.dispatchEvent(n)),r.update()}(e),ee())}function ie(e){!1!==r.enabled&&!1!==r.enableKeys&&!1!==r.enablePan&&function(e){switch(e.keyCode){case r.keys.UP:q(0,r.keyPanSpeed),r.update();break;case r.keys.BOTTOM:q(0,-r.keyPanSpeed),r.update();break;case r.keys.LEFT:q(r.keyPanSpeed,0),r.update();break;case r.keys.RIGHT:q(-r.keyPanSpeed,0),r.update()}}(e)}function re(e){if(!1!==r.enabled){switch(e.touches.length){case 1:if(!1===r.enableRotate)return;!function(e){g.set(e.touches[0].pageX,e.touches[0].pageY)}(e),u=l.TOUCH_ROTATE;break;case 3:if(!1===r.enableZoom)return;Y(e),u=l.TOUCH_PAN;break;case 2:if(M.set(e.touches[0].pageX,e.touches[0].pageY),C.set(e.touches[1].pageX,e.touches[1].pageY),!1===r.enablePan)return;Y(e),function(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);E.set(0,r)}(e),u=l.TOUCH_PAN;break;default:u=l.NONE}u!==l.NONE&&r.dispatchEvent(s)}}function ne(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===r.enableRotate)return;if(u!==l.TOUCH_ROTATE)return;!function(e){S=!0,v.set(e.touches[0].pageX,e.touches[0].pageY),y.subVectors(v,g);var t=r.domElement===document?r.domElement.body:r.domElement;H(2*Math.PI*y.x/t.clientWidth*r.rotateSpeed),V(2*Math.PI*y.y/t.clientHeight*r.rotateSpeed),g.copy(v),r.update()}(e);break;case 3:if(!1===r.enableZoom)return;if(u!==l.TOUCH_PAN)return;Z(e);break;case 2:var t=new THREE.Vector2(e.touches[0].pageX,e.touches[0].pageY),i=new THREE.Vector2(e.touches[1].pageX,e.touches[1].pageY),n=t.sub(M).normalize(),o=i.sub(C).normalize();if(n.dot(o)>0){if(u=l.TOUCH_PAN,!1===r.enablePan)return;Z(e)}else{if(u=l.TOUCH_DOLLY,!1===r.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);w.set(0,n),T.subVectors(w,E),T.y>0?J(z()):T.y<0&&X(z()),E.copy(w),r.update()}(e)}break;default:u=l.NONE}}function oe(e){!1!==r.enabled&&(r.dispatchEvent(a),u=l.NONE)}function se(e){!1!==r.enabled&&e.preventDefault()}r.domElement.addEventListener("contextmenu",se,!1),r.domElement.addEventListener("mousedown",Q,!1),r.domElement.addEventListener("wheel",te,!1),r.domElement.addEventListener("touchstart",re,!1),r.domElement.addEventListener("touchend",oe,!1),r.domElement.addEventListener("touchmove",ne,!1),window.addEventListener("keydown",ie,!1),r.setLeftInteractive=function(e){r.mouseButtons=e?{ORBIT:0,ZOOM:1,PAN:2}:{ORBIT:2,ZOOM:1,PAN:0},r._leftInteractive=e},this.update(),r.pan=q,r.panDelta=x},THREE.EarthOrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.EarthOrbitControls.prototype.constructor=THREE.EarthOrbitControls,Object.defineProperties(THREE.EarthOrbitControls.prototype,{leftInteractive:{get:function(){return this._leftInteractive},set:function(e){this.setLeftInteractive(e)}},center:{get:function(){return console.warn("THREE.EarthOrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.EarthOrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.EarthOrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.EarthOrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.EarthOrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.EarthOrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.EarthOrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.EarthOrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.EarthOrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.EarthOrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.EarthOrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.EarthOrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.EarthOrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}},minPolarAngle:{get:function(){return this._minPolarAngle},set:function(e){this._minPolarAngle=e}},maxPolarAngle:{get:function(){return this._maxPolarAngle},set:function(e){this._maxPolarAngle=e<this.maxPitchAngle*Math.PI/180?e:this.maxPitchAngle*Math.PI/180}}}),THREE.EarthOrbitControls.prototype.setLookAt=function(e){this.object.lookAt(new THREE.Vector3(e[0],e[1],e[2]))},THREE.FreeControls=function(e){this.object=e,this.object.rotation.setRotationOrder("YXZ"),this.movementSpeed=.25,this.rotateSpeed=.25,this.enableMovementDamping=!0,this.movementDampingFactor=.25,this.enableRotateDamping=!0,this.rotateDampingFactor=.25,this.enableFly=!0,this.enableKeyRotate=!1,this.getMoveDirection=function(e){e=e||new THREE.Vector3;var r=t.set(1,0,0).applyQuaternion(this.object.quaternion);return this.enableFly?(t.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.x),e.add(t),t.set(0,1,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.y),e.add(t),t.set(0,0,1).applyQuaternion(this.object.quaternion).multiplyScalar(c.z),e.add(t)):(i.copy(r).multiplyScalar(c.x),e.add(i),i.copy(r).cross(this.object.up).normalize().multiplyScalar(c.z),e.add(i)),e},this.update=function(e){var d=(e=e||.0166)*this.movementSpeed/.0166*(1===h.run?2:1);c.add(l),u.add(a);var f=t.set(1,0,0).applyQuaternion(this.object.quaternion).normalize();return this.enableFly?(t.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.x*d),this.object.position.add(t),t.set(0,1,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.y*d),this.object.position.add(t),t.set(0,0,1).applyQuaternion(this.object.quaternion).multiplyScalar(c.z*d),this.object.position.add(t)):(i.copy(f).multiplyScalar(c.x*d),this.object.position.add(i),i.copy(f).cross(this.object.up).normalize().multiplyScalar(c.z*d),this.object.position.add(i)),this.object.up.equals(p)?(this.object.rotation.x+=e*u.x/.0166,this.object.rotation.y+=e*u.y/.0166,this.object.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.object.rotation.x))):(r.setFromAxisAngle(this.object.up,e*u.y/.0166),this.object.quaternion.premultiply(r),f=t.set(1,0,0).applyQuaternion(this.object.quaternion).normalize(),r.setFromAxisAngle(f,e*u.x/.0166),this.object.quaternion.premultiply(r)),this.enableMovementDamping?c.multiplyScalar(1-this.movementDampingFactor):c.set(0,0,0),this.enableRotateDamping?u.multiplyScalar(1-this.rotateDampingFactor):u.set(0,0),this.enableKeyRotate||a.set(0,0),(n.distanceToSquared(this.object.position)>s||8*(1-o.dot(this.object.quaternion))>s)&&(n.copy(this.object.position),o.copy(this.object.quaternion),!0)};var t=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Quaternion,n=new THREE.Vector3,o=new THREE.Quaternion,s=1e-6,a=new THREE.Vector2,l=new THREE.Vector3,u=new THREE.Vector2,c=new THREE.Vector3,h={up:0,down:0,left:0,right:0,forward:0,back:0,run:0},p=(new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0)),d=this;this.updateMovementVector=function(){d.enableKeyRotate?a.y=-2*Math.PI*.005*(-h.left+h.right)*d.rotateSpeed:l.x=-h.left+h.right,l.y=-h.down+h.up,l.z=-h.forward+h.back},this.rotateDelta=a,this.moveDelta=l,this.moveState=h},THREE.FreeMouseControls=function(e,t){THREE.FreeControls.call(this,e),this.domElement=void 0!==t?t:document,t&&this.domElement.setAttribute("tabindex",-1);var i=new THREE.Vector2,r=new THREE.Vector2,n=this.rotateDelta,o=(this.moveDelta,0),s=this.moveState,a=this;function l(){var e=a.domElement===document?a.domElement.body:a.domElement,t=n.x,i=n.y;n.x=2*Math.PI*i/e.clientHeight,n.y=2*Math.PI*t/e.clientWidth}var u=this.updateMovementVector;function c(e){i.set(e.clientX,e.clientY),o=1}function h(e){0!=o&&(a.enableKeyRotate||(r.set(e.clientX,e.clientY),n.subVectors(r,i).multiplyScalar(-a.rotateSpeed),l(),i.copy(r)))}function p(e){o=0,n.set(0,0)}function d(e){switch(e.keyCode){case 87:s.forward=1;break;case 83:s.back=1;break;case 65:s.left=1;break;case 68:s.right=1;break;case 82:s.up=1;break;case 70:s.down=1;break;case 69:s.up=1;break;case 81:s.down=1;break;case 16:s.run=1}u()}function f(e){switch(e.keyCode){case 87:s.forward=0;break;case 83:s.back=0;break;case 65:s.left=0;break;case 68:s.right=0;break;case 82:s.up=0;break;case 70:s.down=0;break;case 69:s.up=0;break;case 81:s.down=0;break;case 16:s.run=0}u()}this.domElement.addEventListener("mousemove",h,!1),this.domElement.addEventListener("mousedown",c,!1),this.domElement.addEventListener("mouseup",p,!1),window.addEventListener("keydown",d,!1),window.addEventListener("keyup",f,!1),u(),l(),this.dispose=function(){this.object.rotation.setRotationOrder("XYZ"),this.domElement.removeEventListener("mousemove",h,!1),this.domElement.removeEventListener("mousedown",c,!1),this.domElement.removeEventListener("mouseup",p,!1),window.removeEventListener("keydown",d,!1),window.removeEventListener("keyup",f,!1)}},THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,i=/^usemtl /;function r(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},i&&i.name&&"function"==typeof i.clone){var r=i.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){var r=this.vertices,n=this.object.geometry.vertices;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){var r=this.normals,n=this.object.geometry.normals;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addColor:function(e,t,i){var r=this.colors,n=this.object.geometry.colors;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addUV:function(e,t,i){var r=this.uvs,n=this.object.geometry.uvs;n.push(r[e+0],r[e+1]),n.push(r[t+0],r[t+1]),n.push(r[i+0],r[i+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,r,n,o,s,a,l){var u=this.vertices.length,c=this.parseVertexIndex(e,u),h=this.parseVertexIndex(t,u),p=this.parseVertexIndex(i,u);if(this.addVertex(c,h,p),void 0!==r&&""!==r){var d=this.uvs.length;c=this.parseUVIndex(r,d),h=this.parseUVIndex(n,d),p=this.parseUVIndex(o,d),this.addUV(c,h,p)}if(void 0!==s&&""!==s){var f=this.normals.length;c=this.parseNormalIndex(s,f),h=s===a?c:this.parseNormalIndex(a,f),p=s===l?c:this.parseNormalIndex(l,f),this.addNormal(c,h,p)}this.colors.length>0&&this.addColor(c,h,p)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,i=0,r=e.length;i<r;i++)this.addVertexPoint(this.parseVertexIndex(e[i],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var i=this.vertices.length,r=this.uvs.length,n=0,o=e.length;n<o;n++)this.addVertexLine(this.parseVertexIndex(e[n],i));var s=0;for(o=t.length;s<o;s++)this.addUVLine(this.parseUVIndex(t[s],r))}};return e.startObject("",!1),e}function n(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null}return n.prototype={constructor:n,load:function(e,t,i,r){var n=this,o=new THREE.FileLoader(n.manager);o.setPath(this.path),o.load(e,(function(e){t(n.parse(e))}),i,r)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(n){console.time("OBJLoader");var o=new r;-1!==n.indexOf("\r\n")&&(n=n.replace(/\r\n/g,"\n")),-1!==n.indexOf("\\\n")&&(n=n.replace(/\\\n/g,""));for(var s=n.split("\n"),a="",l="",u=[],c="function"==typeof"".trimLeft,h=0,p=s.length;h<p;h++)if(a=s[h],0!==(a=c?a.trimLeft():a.trim()).length&&"#"!==(l=a.charAt(0)))if("v"===l){var d=a.split(/\s+/);switch(d[0]){case"v":o.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),8===d.length&&o.colors.push(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6]));break;case"vn":o.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":o.uvs.push(parseFloat(d[1]),parseFloat(d[2]))}}else if("f"===l){for(var f=a.substr(1).trim().split(/\s+/),m=[],g=0,v=f.length;g<v;g++){var y=f[g];if(y.length>0){var b=y.split("/");m.push(b)}}var _=m[0];for(g=1,v=m.length-1;g<v;g++){var x=m[g],E=m[g+1];o.addFace(_[0],x[0],E[0],_[1],x[1],E[1],_[2],x[2],E[2])}}else if("l"===l){var w=a.substring(1).trim().split(" "),T=[],M=[];if(-1===a.indexOf("/"))T=w;else for(var C=0,S=w.length;C<S;C++){var j=w[C].split("/");""!==j[0]&&T.push(j[0]),""!==j[1]&&M.push(j[1])}o.addLineGeometry(T,M)}else if("p"===l){var P=a.substr(1).trim().split(" ");o.addPointGeometry(P)}else if(null!==(u=e.exec(a))){var R=(" "+u[0].substr(1).trim()).substr(1);o.startObject(R)}else if(i.test(a))o.object.startMaterial(a.substring(7).trim(),o.materialLibraries);else if(t.test(a))o.materialLibraries.push(a.substring(7).trim());else{if("s"!==l){if("\0"===a)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+a+'"')}if((u=a.split(" ")).length>1){var D=u[1].trim().toLowerCase();o.object.smooth="0"!==D&&"off"!==D}else o.object.smooth=!0;(G=o.object.currentMaterial())&&(G.smooth=o.object.smooth)}o.finalize();var A=new THREE.Group;A.materialLibraries=[].concat(o.materialLibraries);for(h=0,p=o.objects.length;h<p;h++){var k=o.objects[h],O=k.geometry,B=k.materials,F="Line"===O.type,L="Points"===O.type,I=!1;if(0!==O.vertices.length){var N=new THREE.BufferGeometry;N.addAttribute("position",new THREE.Float32BufferAttribute(O.vertices,3)),O.normals.length>0?N.addAttribute("normal",new THREE.Float32BufferAttribute(O.normals,3)):N.computeVertexNormals(),O.colors.length>0&&(I=!0,N.addAttribute("color",new THREE.Float32BufferAttribute(O.colors,3))),O.uvs.length>0&&N.addAttribute("uv",new THREE.Float32BufferAttribute(O.uvs,2));for(var U,z=[],H=0,V=B.length;H<V;H++){var W=B[H],G=void 0;if(null!==this.materials)if(G=this.materials.create(W.name),!F||!G||G instanceof THREE.LineBasicMaterial){if(L&&G&&!(G instanceof THREE.PointsMaterial)){var q=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});X.copy(G),G=q}}else{var X=new THREE.LineBasicMaterial;X.copy(G),X.lights=!1,G=X}G||((G=F?new THREE.LineBasicMaterial:L?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=W.name),G.flatShading=!W.smooth,G.vertexColors=I?THREE.VertexColors:THREE.NoColors,z.push(G)}if(z.length>1){for(H=0,V=B.length;H<V;H++){W=B[H];N.addGroup(W.groupStart,W.groupCount,H)}U=F?new THREE.LineSegments(N,z):L?new THREE.Points(N,z):new THREE.Mesh(N,z)}else U=F?new THREE.LineSegments(N,z[0]):L?new THREE.Points(N,z[0]):new THREE.Mesh(N,z[0]);U.name=k.name,A.add(U)}}return console.timeEnd("OBJLoader"),A}},n}(),THREE.OrbitControls=function(e,t){var i,r,n,o,s;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoLeftRotate=!1,this.autoUpRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.LEFT,MIDDLE:THREE.MOUSE.MIDDLE,RIGHT:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._getIntersectPoint=function(){return new THREE.Vector3},this.move=function(e,t){U(e,t)},this.getPolarAngle=function(){return y.phi},this.getAzimuthalAngle=function(){return y.theta},this.saveState=function(){a.target0.copy(a.target),a.position0.copy(a.object.position),a.zoom0=a.object.zoom},this.reset=function(){a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.zoom=a.zoom0,a.object.updateProjectionMatrix(),a.dispatchEvent(c),a.update(),g=m.NONE},this.update=(i=new THREE.Vector3,r=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),n=r.clone().inverse(),o=new THREE.Vector3,s=new THREE.Quaternion,function(){var e=a.object.position;return i.copy(e).sub(a.target),i.applyQuaternion(r),y.setFromVector3(i),a.autoRotate&&g===m.NONE&&(a.autoLeftRotate?B(k()):a.autoUpRotate&&F(k())),y.theta+=b.theta,y.phi+=b.phi,y.theta=Math.max(a.minAzimuthAngle,Math.min(a.maxAzimuthAngle,y.theta)),y.phi=Math.max(a.minPolarAngle,Math.min(a.maxPolarAngle,y.phi)),y.makeSafe(),y.radius*=_,y.radius=Math.max(a.minDistance,Math.min(a.maxDistance,y.radius)),a.target.add(x),i.setFromSpherical(y),i.applyQuaternion(n),e.copy(a.target).add(i),a.object.lookAt(a.target),!0===a.enableDamping?(b.theta*=1-a.dampingFactor,b.phi*=1-a.dampingFactor,x.multiplyScalar(1-a.dampingFactor)):(b.set(0,0,0),x.set(0,0,0)),_=1,!!(E||o.distanceToSquared(a.object.position)>v||8*(1-s.dot(a.object.quaternion))>v)&&(a.dispatchEvent(c),o.copy(a.object.position),s.copy(a.object.quaternion),E=!1,!0)}),this.dispose=function(){a.domElement.removeEventListener("contextmenu",$,!1),a.domElement.removeEventListener("mousedown",W,!1),a.domElement.removeEventListener("wheel",X,!1),a.domElement.removeEventListener("touchstart",Z,!1),a.domElement.removeEventListener("touchend",K,!1),a.domElement.removeEventListener("touchmove",Q,!1),a.domElement.removeEventListener("mousemove",Y,!1),document.removeEventListener("mousemove",G,!1),document.removeEventListener("mouseup",q,!1),window.removeEventListener("keydown",J,!1)};var a=this,l={type:"mousemoveevent"},u={type:"wheel",delta:0},c={type:"change"},h={type:"start"},p={type:"end"},d={type:"mousedownpanevent"},f={type:"mouseuppanevent"},m={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},g=m.NONE,v=1e-6,y=new THREE.Spherical,b=new THREE.Spherical,_=1,x=new THREE.Vector3,E=!1,w=new THREE.Vector2,T=new THREE.Vector2,M=new THREE.Vector2,C=new THREE.Vector2,S=new THREE.Vector2,j=new THREE.Vector2,P=new THREE.Vector2,R=new THREE.Vector2,D=new THREE.Vector2,A=null;function k(){return 2*Math.PI/60/60*a.autoRotateSpeed}function O(){return Math.pow(.95,a.zoomSpeed)}function B(e){b.theta-=e}function F(e){b.phi-=e}var L,I=(L=new THREE.Vector3,function(e,t){L.setFromMatrixColumn(t,0),L.multiplyScalar(-e),x.add(L)}),N=function(){var e=new THREE.Vector3;return function(t,i){!0===a.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(a.object.up,e)),e.multiplyScalar(t),x.add(e)}}(),U=function(){var e=new THREE.Vector3;return function(t,i){var r=a.domElement===document?a.domElement.body:a.domElement;if(a.object.isPerspectiveCamera){var n=a.object.position;e.copy(n).sub(a.target);var o=e.length();o*=Math.tan(a.object.fov/2*Math.PI/180),I(2*t*o/r.clientHeight,a.object.matrix),N(2*i*o/r.clientHeight,a.object.matrix)}else a.object.isOrthographicCamera?(I(t*(a.object.right-a.object.left)/a.object.zoom/r.clientWidth,a.object.matrix),N(i*(a.object.top-a.object.bottom)/a.object.zoom/r.clientHeight,a.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),a.enablePan=!1)}}();function z(e){a.object.isPerspectiveCamera?_/=e:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom*e)),a.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function H(e){a.object.isPerspectiveCamera?_*=e:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/e)),a.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function V(e){C.set(e.clientX,e.clientY),a.dispatchEvent(d)}function W(e){if(!1!==a.enabled){switch(e.preventDefault(),e.button){case a.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey){if(!1===a.enablePan)return;V(e),g=m.PAN}else{if(!1===a.enableRotate)return;!function(e){w.set(e.clientX,e.clientY)}(e),g=m.ROTATE}break;case a.mouseButtons.MIDDLE:if(!1===a.enableZoom)return;!function(e){P.set(e.clientX,e.clientY)}(e),g=m.DOLLY;break;case a.mouseButtons.RIGHT:if(!1===a.enablePan)return;V(e),g=m.PAN}g!==m.NONE&&(document.addEventListener("mousemove",G,!1),document.addEventListener("mouseup",q,!1),a.dispatchEvent(h))}}function G(e){if(!1!==a.enabled)switch(e.preventDefault(),g){case m.ROTATE:if(!1===a.enableRotate)return;!function(e){T.set(e.clientX,e.clientY),M.subVectors(T,w).multiplyScalar(a.rotateSpeed);var t=a.domElement===document?a.domElement.body:a.domElement;B(2*Math.PI*M.x/t.clientHeight),F(2*Math.PI*M.y/t.clientHeight),w.copy(T),a.update()}(e);break;case m.DOLLY:if(!1===a.enableZoom)return;!function(e){R.set(e.clientX,e.clientY),D.subVectors(R,P),D.y>0?z(O()):D.y<0&&H(O()),P.copy(R),a.update()}(e);break;case m.PAN:if(!1===a.enablePan)return;!function(e){S.set(e.clientX,e.clientY),j.subVectors(S,C).multiplyScalar(a.panSpeed),U(j.x,j.y),C.copy(S),a.update()}(e)}}function q(e){!1!==a.enabled&&(g==m.PAN&&a.dispatchEvent(f),document.removeEventListener("mousemove",G,!1),document.removeEventListener("mouseup",q,!1),a.dispatchEvent(p),g=m.NONE)}function X(e){!1===a.enabled||!1===a.enableZoom||g!==m.NONE&&g!==m.ROTATE||(e.preventDefault(),e.stopPropagation(),function(e){e.deltaY<0?H(O()):e.deltaY>0&&z(O()),u.x=e.x,u.y=e.y,u.clientX=e.clientX,u.clientY=e.clientY,u.layerX=e.layerX,u.layerX=e.layerX,u.offsetX=e.offsetX,u.offsetY=e.offsetY,u.delta=e.deltaY,a.dispatchEvent(u),a.update()}(e))}function J(e){!1!==a.enabled&&!1!==a.enableKeys&&!1!==a.enablePan&&function(e){switch(e.keyCode){case a.keys.UP:U(0,a.keyPanSpeed),a.update();break;case a.keys.BOTTOM:U(0,-a.keyPanSpeed),a.update();break;case a.keys.LEFT:U(a.keyPanSpeed,0),a.update();break;case a.keys.RIGHT:U(-a.keyPanSpeed,0),a.update()}}(e)}function Y(e){var t=!1;if(A){var i=A.distanceTo({x:e.x,y:e.y});0!==e.buttons&&i>=2&&(t=!0)}else A=new THREE.Vector2;A.set(e.x,e.y),t&&a.dispatchEvent(l)}function Z(e){if(!1!==a.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===a.enableRotate)return;!function(e){w.set(e.touches[0].pageX,e.touches[0].pageY)}(e),g=m.TOUCH_ROTATE;break;case 2:if(!1===a.enableZoom&&!1===a.enablePan)return;!function(e){if(a.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);P.set(0,r)}if(a.enablePan){var n=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);C.set(n,o)}}(e),g=m.TOUCH_DOLLY_PAN;break;default:g=m.NONE}g!==m.NONE&&a.dispatchEvent(h)}}function Q(e){if(!1!==a.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===a.enableRotate)return;if(g!==m.TOUCH_ROTATE)return;!function(e){T.set(e.touches[0].pageX,e.touches[0].pageY),M.subVectors(T,w).multiplyScalar(a.rotateSpeed);var t=a.domElement===document?a.domElement.body:a.domElement;B(2*Math.PI*M.x/t.clientHeight),F(2*Math.PI*M.y/t.clientHeight),w.copy(T),a.update()}(e);break;case 2:if(!1===a.enableZoom&&!1===a.enablePan)return;if(g!==m.TOUCH_DOLLY_PAN)return;!function(e){if(a.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);R.set(0,r),D.set(0,Math.pow(R.y/P.y,a.zoomSpeed)),z(D.y),P.copy(R)}if(a.enablePan){var n=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);S.set(n,o),j.subVectors(S,C).multiplyScalar(a.panSpeed),U(j.x,j.y),C.copy(S)}a.update()}(e);break;default:g=m.NONE}}function K(e){!1!==a.enabled&&(a.dispatchEvent(p),g=m.NONE)}function $(e){!1!==a.enabled&&e.preventDefault()}a.domElement.addEventListener("contextmenu",$,!1),a.domElement.addEventListener("mousedown",W,!1),a.domElement.addEventListener("wheel",X,!1),a.domElement.addEventListener("touchstart",Z,!1),a.domElement.addEventListener("touchend",K,!1),a.domElement.addEventListener("touchmove",Q,!1),a.domElement.addEventListener("mousemove",Y,!1),window.addEventListener("keydown",J,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),THREE.Reflector=function(e,t){THREE.Mesh.call(this,e),this.type="Reflector";var i=this,r=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),n=t.textureWidth||512,o=t.textureHeight||512,s=t.clipBias||0,a=t.shader||THREE.Reflector.ReflectorShader,l=void 0!==t.recursion?t.recursion:0,u=new THREE.Plane,c=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Matrix4,f=new THREE.Vector3(0,0,-1),m=new THREE.Vector4,g=new THREE.Vector4,v=new THREE.Vector3,y=new THREE.Vector3,b=new THREE.Vector4,_=new THREE.Matrix4,x=new THREE.PerspectiveCamera,E={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},w=new THREE.WebGLRenderTarget(n,o,E);THREE.Math.isPowerOfTwo(n)&&THREE.Math.isPowerOfTwo(o)||(w.texture.generateMipmaps=!1);var T=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(a.uniforms),fragmentShader:a.fragmentShader,vertexShader:a.vertexShader});T.uniforms.tDiffuse.value=w.texture,T.uniforms.color.value=r,T.uniforms.textureMatrix.value=_,this.material=T,this.renderOrder=-1/0,this.addBeforeRenderFunction("THREE.Reflector",(function(e,t,r){if("recursion"in r.userData){if(r.userData.recursion===l)return;r.userData.recursion++}if(h.setFromMatrixPosition(i.matrixWorld),p.setFromMatrixPosition(r.matrixWorld),d.extractRotation(i.matrixWorld),c.set(0,0,1),c.applyMatrix4(d),v.subVectors(h,p),!(v.dot(c)>0)){v.reflect(c).negate(),v.add(h),d.extractRotation(r.matrixWorld),f.set(0,0,-1),f.applyMatrix4(d),f.add(p),y.subVectors(h,f),y.reflect(c).negate(),y.add(h),x.position.copy(v),x.up.set(0,1,0),x.up.applyMatrix4(d),x.up.reflect(c),x.lookAt(y),x.far=r.far,x.updateMatrixWorld(),x.projectionMatrix.copy(r.getProjectionMatrixAlways?r.getProjectionMatrixAlways():r.projectionMatrix),x.userData.recursion=0,_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(x.projectionMatrix),_.multiply(x.matrixWorldInverse),_.multiply(i.matrixWorld),u.setFromNormalAndCoplanarPoint(c,h),u.applyMatrix4(x.matrixWorldInverse),m.set(u.normal.x,u.normal.y,u.normal.z,u.constant);var n=x.projectionMatrix;b.x=(Math.sign(m.x)+n.elements[8])/n.elements[0],b.y=(Math.sign(m.y)+n.elements[9])/n.elements[5],b.z=-1,b.w=(1+n.elements[10])/n.elements[14],m.multiplyScalar(2/m.dot(b)),n.elements[2]=m.x,n.elements[6]=m.y,n.elements[10]=m.z+1-s,n.elements[14]=m.w,i.visible=!1;var o=e.getRenderTarget(),a=e.xr.enabled,E=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(w),e.clear(),e.render(t,x),e.xr.enabled=a,e.shadowMap.autoUpdate=E,e.setRenderTarget(o);var T=r.bounds;if(void 0!==T){var M=e.getSize(),C=e.getPixelRatio();g.x=T.x*M.width*C,g.y=T.y*M.height*C,g.z=T.z*M.width*C,g.w=T.w*M.height*C,e.state.viewport(g)}i.visible=!0}})),this.getRenderTarget=function(){return w}},THREE.Reflector.prototype=Object.create(THREE.Mesh.prototype),THREE.Reflector.prototype.constructor=THREE.Reflector,THREE.Reflector.ReflectorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},THREE.ReflectorRTT=function(e,t){THREE.Reflector.call(this,e,t),this.geometry.setDrawRange(0,0)},THREE.ReflectorRTT.prototype=Object.create(THREE.Reflector.prototype),THREE.Refractor=function(e,t){THREE.Mesh.call(this,e),this.type="Refractor";var i=this,r=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),n=t.textureWidth||512,o=t.textureHeight||512,s=t.clipBias||0,a=t.shader||THREE.Refractor.RefractorShader,l=new THREE.PerspectiveCamera;l.matrixAutoUpdate=!1,l.userData.refractor=!0;var u=new THREE.Plane,c=new THREE.Matrix4,h={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},p=new THREE.WebGLRenderTarget(n,o,h);THREE.Math.isPowerOfTwo(n)&&THREE.Math.isPowerOfTwo(o)||(p.texture.generateMipmaps=!1),this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,transparent:!0}),this.material.uniforms.color.value=r,this.material.uniforms.tDiffuse.value=p.texture,this.material.uniforms.textureMatrix.value=c;var d,f,m,g,v,y,b,_,x=(d=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Matrix4,g=new THREE.Vector3,v=new THREE.Vector3,function(e){return d.setFromMatrixPosition(i.matrixWorld),f.setFromMatrixPosition(e.matrixWorld),g.subVectors(d,f),m.extractRotation(i.matrixWorld),v.set(0,0,1),v.applyMatrix4(m),g.dot(v)<0}),E=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Quaternion,n=new THREE.Vector3;return function(){i.matrixWorld.decompose(t,r,n),e.set(0,0,1).applyQuaternion(r).normalize(),e.negate(),u.setFromNormalAndCoplanarPoint(e,t)}}(),w=(y=new THREE.Plane,b=new THREE.Vector4,_=new THREE.Vector4,function(e){l.matrixWorld.copy(e.matrixWorld),l.matrixWorldInverse.getInverse(l.matrixWorld),l.projectionMatrix.copy(e.getProjectionMatrixAlways?e.getProjectionMatrixAlways():e.projectionMatrix),l.far=e.far,y.copy(u),y.applyMatrix4(l.matrixWorldInverse),b.set(y.normal.x,y.normal.y,y.normal.z,y.constant);var t=l.projectionMatrix;_.x=(Math.sign(b.x)+t.elements[8])/t.elements[0],_.y=(Math.sign(b.y)+t.elements[9])/t.elements[5],_.z=-1,_.w=(1+t.elements[10])/t.elements[14],b.multiplyScalar(2/b.dot(_)),t.elements[2]=b.x,t.elements[6]=b.y,t.elements[10]=b.z+1-s,t.elements[14]=b.w});var T,M=(T=new THREE.Vector4,function(e,t,r){i.visible=!1;var n=e.getRenderTarget(),o=e.xr.enabled,s=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(p),e.clear(),e.render(t,l),e.xr.enabled=o,e.shadowMap.autoUpdate=s,e.setRenderTarget(n);var a=r.bounds;if(void 0!==a){var u=e.getSize(),c=e.getPixelRatio();T.x=a.x*u.width*c,T.y=a.y*u.height*c,T.z=a.z*u.width*c,T.w=a.w*u.height*c,e.state.viewport(T)}i.visible=!0});this.onBeforeRender=function(e,t,r){!0!==r.userData.refractor&&!0!=!x(r)&&(E(),function(e){c.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),c.multiply(e.projectionMatrix),c.multiply(e.matrixWorldInverse),c.multiply(i.matrixWorld)}(r),w(r),M(e,t,r))},this.getRenderTarget=function(){return p}},THREE.Refractor.prototype=Object.create(THREE.Mesh.prototype),THREE.Refractor.prototype.constructor=THREE.Refractor,THREE.Refractor.RefractorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new THREE.Group,r=0,n=t.length;r<n;r++)i.add(new THREE.Mesh(e,t[r]));return i},detach:function(e,t,i){e.applyMatrix4(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){e.applyMatrix4((new THREE.Matrix4).getInverse(i.matrixWorld)),t.remove(e),i.add(e)}},THREE.SimplifyModifier=function(){},function(){var e=new THREE.Vector3,t=new THREE.Vector3;function i(e,t){var i=e.indexOf(t);i>-1&&e.splice(i,1)}function r(e,t){var i=t.position.distanceTo(e.position),r=0,n=[],o=(e.faces,e.faces.length);for(c=0;c<o;c++)(h=e.faces[c]).hasVertex(t)&&n.push(h);for(c=0;c<o;c++){var s=1;h=e.faces[c];for(var a=0;a<n.length;a++){p=n[a];var l=h.normal.dot(p.normal);s=Math.min(s,(1.001-l)/2)}r=Math.max(r,s)}n.length<2&&(r=1),e.isBorder()&&n.length>1&&(r=1);for(var u=0,c=0;c<o;c++){var h=e.faces[c];for(a=0;a<n.length;a++){var p=n[a];if(h.uvAt(e).equals(p.uvAt(e)))break}a==n.length&&u++}return u&&(r=1),i*r+0}function n(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var t=0;t<e.neighbors.length;t++){var i=r(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=i,e.minCost=i,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=i,i<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=i)}e.collapseCost=e.totalCost/e.costCount}function o(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){i(e.neighbors.pop().neighbors,e)}i(t,e)}function s(e,t){i(t,e),e.v1&&i(e.v1.faces,e),e.v2&&i(e.v2.faces,e),e.v3&&i(e.v3.faces,e);for(var r,n,o=[this.v1,this.v2,this.v3],s=0;s<3;s++)n=o[(s+1)%3],(r=o[s])&&n&&(r.removeIfNonNeighbor(n),n.removeIfNonNeighbor(r))}function a(e,t,i,r){if(r){var a=[];for(c=0;c<i.neighbors.length;c++)a.push(i.neighbors[c]);for(var l=[],u=i.faces.length,c=0;c<u;c++){(h=i.faces[c]).hasVertex(r)&&l.push(h)}for(c=0;c<u;c++){var h;if(!(h=i.faces[c]).hasVertex(r))for(var p=0;p<l.length;p++){var d=l[p];if(h.uvAt(i).equals(d.uvAt(i))){h.setUV(i,d.uvAt(r));break}l.length}}for(c=i.faces.length-1;c>=0;c--)i.faces[c].hasVertex(r)&&s(i.faces[c],t);for(c=i.faces.length-1;c>=0;c--)i.faces[c].replaceVertex(i,r);for(o(i,e),c=0;c<a.length;c++)n(a[c])}else o(i,e)}function l(e){for(var t=e[0],i=0;i<e.length;i++)e[i].collapseCost<t.collapseCost&&(t=e[i]);return t}function u(e,t,i,r,n,o,s,a,l){this.a=r,this.b=n,this.c=o,this.v1=e,this.v2=t,this.v3=i,this.uv1=s,this.uv2=a,this.uv3=l,this.normal=new THREE.Vector3,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(i),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(i),i.faces.push(this),i.addUniqueNeighbor(e),i.addUniqueNeighbor(t)}function c(e,t){this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}u.prototype.computeNormal=function(){var i=this.v1.position,r=this.v2.position,n=this.v3.position;e.subVectors(n,r),t.subVectors(i,r),e.cross(t).normalize(),this.normal.copy(e)},u.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},u.prototype.replaceVertex=function(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),i(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},u.prototype.uvAt=function(e){var t=[this.v1,this.v2,this.v3].reduce((function(t,i,r){return!t.length&&e.position.equals(i)&&t.push(r),t}),[])[0];return[this.uv1,this.uv2,this.uv3][t]},u.prototype.setUV=function(e,t){var i=[this.v1,this.v2,this.v3].reduce((function(t,i,r){return!t.length&&e.position.equals(i)&&t.push(r),t}),[])[0];[this.uv1,this.uv2,this.uv3][i]=t},c.prototype.addUniqueNeighbor=function(e){var t,i;t=this.neighbors,i=e,-1===t.indexOf(i)&&t.push(i)},c.prototype.removeIfNonNeighbor=function(e){var t=this.neighbors,i=this.faces,r=t.indexOf(e);if(-1!==r){for(var n=0;n<i.length;n++)if(i[n].hasVertex(e))return;t.splice(r,1)}},c.prototype.isBorder=function(){for(var e=this.neighbors.length,t=0;t<e;t++){for(var i=0,r=this.faces.length,n=0;n<r;n++)this.faces[n].hasVertex(this.neighbors[t])&&i++;if(1===i)return!0}return!1},THREE.SimplifyModifier.prototype.modify=function(e,t){e instanceof THREE.BufferGeometry&&!e.vertices&&!e.faces&&(console.log("converting BufferGeometry to Geometry"),e=(new THREE.Geometry).fromBufferGeometry(e)),e.mergeVertices();var i,r,o=e.vertices,s=e.faces,h=e.faceVertexUvs[0],p=(new THREE.Geometry,new Array(o.length)),d=new Array(s.length);new Array(h.length);for(i=0,r=o.length;i<r;i++)p[i]=new c(o[i],i);for(i=0,r=s.length;i<r;i++)b=s[i],h[i],d[i]=new u(p[b.a],p[b.b],p[b.c],b.a,b.b,b.c,h[i][0],h[i][1],h[i][2]);for(i=0,r=p.length;i<r;i++)n(p[i]);new Array(p.length),new Array(p.length);for(var f,m=t;m--;){if(!(f=l(p))){console.log("no next vertex");break}a(p,d,f,f.collapseNeighbor)}var g=new THREE.Geometry;for(i=0;i<p.length;i++){var v=p[i];g.vertices.push(v.position)}for(i=0;i<d.length;i++){var y=d[i],b=new THREE.Face3(p.indexOf(y.v1),p.indexOf(y.v2),p.indexOf(y.v3),y.normal);g.faces.push(b),g.faceVertexUvs[0].push([y.uv1,y.uv2,y.uv3])}return g}}(),THREE.SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e},THREE.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-- >0;)this.smooth(e);e.computeFaceNormals(),e.computeVertexNormals()},function(){var e=["a","b","c"];function t(e,t,i){return i[Math.min(e,t)+"_"+Math.max(e,t)]}function i(e,t,i,r,n,o){var s,a=Math.min(e,t),l=Math.max(e,t),u=a+"_"+l;u in r?s=r[u]:(s={a:i[a],b:i[l],newEdge:null,faces:[]},r[u]=s);s.faces.push(n),o[e].edges.push(s),o[t].edges.push(s)}function r(e,t,i,r,n){e.push(new THREE.Face3(t,i,r,void 0,void 0,n))}function n(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function o(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}THREE.SubdivisionModifier.prototype.smooth=function(s){var a,l,u,c,h,p,d,f,m,g,v,y,b,_,x=new THREE.Vector3,E=[];a=s.vertices,l=s.faces;var w,T,M,C,S,j,P,R,D,A,k,O,B,F,L=void 0!==(u=s.faceVertexUvs[0])&&u.length>0;for(d in function(e,t,r,n){var o,s,a;for(o=0,s=e.length;o<s;o++)r[o]={edges:[]};for(o=0,s=t.length;o<s;o++)i((a=t[o]).a,a.b,e,n,a,r),i(a.b,a.c,e,n,a,r),i(a.c,a.a,e,n,a,r)}(a,l,v=new Array(a.length),y={}),b=[],y){for(T=y[d],M=new THREE.Vector3,S=3/8,j=1/8,2!=(P=T.faces.length)&&(S=.5,j=0),M.addVectors(T.a,T.b).multiplyScalar(S),x.set(0,0,0),m=0;m<P;m++){for(C=T.faces[m],g=0;g<3&&((w=a[C[e[g]]])===T.a||w===T.b);g++);x.add(w)}x.multiplyScalar(j),M.add(x),T.newEdge=b.length,b.push(M)}for(_=[],d=0,f=a.length;d<f;d++){for(B=a[d],3==(p=(O=v[d].edges).length)?R=3/16:p>3&&(R=3/(8*p)),D=1-p*R,A=R,p<=2&&2==p&&(D=3/4,A=1/8),F=B.clone().multiplyScalar(D),x.set(0,0,0),m=0;m<p;m++)w=(k=O[m]).a!==B?k.a:k.b,x.add(w);x.multiplyScalar(A),F.add(x),_.push(F)}c=_.concat(b);var I,N,U,z,H,V,W,G=_.length;h=[];var q=new THREE.Vector2,X=new THREE.Vector2,J=new THREE.Vector2;for(d=0,f=l.length;d<f;d++)r(h,I=t((C=l[d]).a,C.b,y).newEdge+G,N=t(C.b,C.c,y).newEdge+G,U=t(C.c,C.a,y).newEdge+G,C.materialIndex),r(h,C.a,I,U,C.materialIndex),r(h,C.b,N,I,C.materialIndex),r(h,C.c,U,N,C.materialIndex),L&&(H=(z=u[d])[0],V=z[1],W=z[2],q.set(n(H.x,V.x),n(H.y,V.y)),X.set(n(V.x,W.x),n(V.y,W.y)),J.set(n(H.x,W.x),n(H.y,W.y)),o(E,q,X,J),o(E,H,q,J),o(E,V,X,q),o(E,W,J,X));s.vertices=c,s.faces=h,L&&(s.faceVertexUvs[0]=E)}}();var THREEx=THREEx||{};THREEx.HtmlMixer=THREEx.HtmlMixer||{},THREEx.HtmlMixer.Context=function(e,t,i){var r=[];this.update=function(){r.forEach((function(e){e()}))};this.cssFactor=1e3;var n=new THREE.CSS3DRenderer({autoFixCamera:!0});this.rendererCss=n,this.rendererWebgl=e;var o=new THREE.PerspectiveCamera(i.fov,i.aspect,1e3*i.near,1e3*i.far);this.cssCamera=o,this.backupCSSCamera=o;var s=this;r.push((function(){a.children.length&&(s.cssCamera.quaternion.copy(i.quaternion),s.cssCamera.position.copy(i.position).multiplyScalar(1e3))}));var a=new THREE.Scene;this.cssScene=a,this.autoUpdateObjects=!0,r.push(function(){!0===this.autoUpdateObjects&&a.traverse((function(e){if(!e.isScene){var t=e.userData.mixerPlane;void 0!==t&&t.update()}}))}.bind(this)),r.push((function(e,t){a.children.length&&(s.cssCamera.isOrthographicCamera&&(s.cssCamera.zoom=THING.App.current.renderCamera.zoom),n.render(a,s.cssCamera))}))},THREEx.HtmlMixer.Plane=function(e,t,i){(i=i||{}).elementW=void 0!==i.elementW?i.elementW:768,i.planeW=void 0!==i.planeW?i.planeW:1,i.planeH=void 0!==i.planeH?i.planeH:3/4,i.object3d=void 0!==i.object3d?i.object3d:null,this.domElement=t;var r=[];this.update=function(){r.forEach((function(e){e()}))};var n=i.planeW,o=i.planeH;if(null===i.object3d)var s=new THREE.MeshBasicMaterial({opacity:0,color:new THREE.Color("black"),blending:THREE.NoBlending,side:THREE.DoubleSide}),a=new THREE.PlaneGeometry(1,1),l=new THREE.Mesh(a,s);else l=i.object3d;this.object3d=l;var u=o/n,c=i.elementW,h=c*u;function p(){t.style.width=c+"px",t.style.height=h+"px"}this.setDomElement=function(e){var i=t;i.parentNode&&i.parentNode.removeChild(i),this.domElement=t=e,d.element=t,p()},p();var d=new THREE.CSS3DObject(t);this.cssObject=d,d.scale.set(n,o,1),d.userData.mixerPlane=this,l.addEventListener("added",(function(t){e.cssScene.add(d)})),l.addEventListener("removed",(function(t){e.cssScene.remove(d)})),r.push((function(){l.updateMatrixWorld();var t=l.matrixWorld,i=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Quaternion;t.decompose(i,n,r),d.quaternion.copy(n),d.position.copy(i).multiplyScalar(e.cssFactor);var o=e.cssFactor/1e3,s=l.geometry.parameters,a=e.cssFactor/(c/(s.width*r.x)),u=e.cssFactor/(h/(s.height*r.y));d.scale.set(a*o,u*o,1)}))},THREE.TransformControls=function(e,t){THREE.Object3D.call(this),t=void 0!==t?t:document,this.visible=!1;var i=new THREE.TransformControlsGizmo;this._gizmo=i,this.add(i);var r=new THREE.TransformControlsPlane;this._plane=r,this.add(r);var n=this;F("camera",e),F("object",void 0),F("enabled",!0),F("axis",null),F("mode","translate"),F("translationSnap",null),F("rotationSnap",null),F("space","world"),F("size",1),F("dragging",!1),F("showX",!0),F("showY",!0),F("showZ",!0);var o={type:"change"},s={type:"mouseDown"},a={type:"mouseUp",mode:n.mode},l={type:"objectChange"},u=new THREE.Raycaster,c=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Quaternion,d={X:new THREE.Vector3(1,0,0),Y:new THREE.Vector3(0,1,0),Z:new THREE.Vector3(0,0,1)},f=new THREE.Quaternion,m=new THREE.Vector3,g=new THREE.Vector3,v=new THREE.Vector3,y=new THREE.Vector3,b=0,_=new THREE.Vector3,x=new THREE.Quaternion,E=new THREE.Vector3,w=new THREE.Vector3,T=new THREE.Quaternion,M=new THREE.Vector3,C=new THREE.Vector3,S=new THREE.Quaternion,j=new THREE.Vector3,P=new THREE.Vector3,R=new THREE.Quaternion,D=new THREE.Vector3,A=new THREE.Vector3,k=new THREE.Vector3,O=new THREE.Quaternion,B=new THREE.Vector3;function F(e,t){var s=t;Object.defineProperty(n,e,{get:function(){return void 0!==s?s:t},set:function(t){s!==t&&(s=t,r[e]=t,i[e]=t,n.dispatchEvent({type:e+"-changed",value:t}),n.dispatchEvent(o))}}),n[e]=t,r[e]=t,i[e]=t}function L(e){var i=e.changedTouches?e.changedTouches[0]:e,r=t.getBoundingClientRect();return{x:(i.clientX-r.left)/r.width*2-1,y:-(i.clientY-r.top)/r.height*2+1,button:e.button}}function I(e){}function N(e){n.enabled&&n.pointerHover(L(e))}function U(e){n.enabled&&(document.addEventListener("mousemove",z,!1),n.pointerHover(L(e)),n.pointerDown(L(e)))}function z(e){n.enabled&&n.pointerMove(L(e))}function H(e){n.enabled&&(document.removeEventListener("mousemove",z,!1),n.pointerUp(L(e)))}F("parentQuaternion",T),F("worldPosition",P),F("worldPositionStart",C),F("worldQuaternion",R),F("worldQuaternionStart",S),F("cameraPosition",_),F("cameraQuaternion",x),F("pointStart",g),F("pointEnd",v),F("rotationAxis",y),F("rotationAngle",b),F("eye",A),t.addEventListener("mousedown",U,!1),t.addEventListener("touchstart",U,!1),t.addEventListener("mousemove",N,!1),t.addEventListener("touchmove",N,!1),t.addEventListener("touchmove",z,!1),document.addEventListener("mouseup",H,!1),t.addEventListener("touchend",H,!1),t.addEventListener("touchcancel",H,!1),t.addEventListener("touchleave",H,!1),t.addEventListener("contextmenu",I,!1),this.dispose=function(){t.removeEventListener("mousedown",U),t.removeEventListener("touchstart",U),t.removeEventListener("mousemove",N),document.removeEventListener("mousemove",z),t.removeEventListener("touchmove",N),t.removeEventListener("touchmove",z),document.removeEventListener("mouseup",H),t.removeEventListener("touchend",H),t.removeEventListener("touchcancel",H),t.removeEventListener("touchleave",H),t.removeEventListener("contextmenu",I)},this.attach=function(e){this.object=e,this.visible=!0},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),this.object.parent.matrixWorld.decompose(w,T,M),this.object.matrixWorld.decompose(P,R,D)),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(_,x,E),this.camera.isPerspectiveCamera?A.copy(_).sub(P).normalize():this.camera.isOrthographicCamera&&A.copy(_).normalize(),THREE.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){u.setFromCamera(e,this.camera);var t=u.intersectObjects(i.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){u.setFromCamera(e,this.camera);var t=u.intersectObjects([r],!0)[0]||!1;if(t){var i=this.space;if("scale"===this.mode?i="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(i="world"),"local"===i&&"rotate"===this.mode){var n=this.rotationSnap;"X"===this.axis&&n&&(this.object.rotation.x=Math.round(this.object.rotation.x/n)*n),"Y"===this.axis&&n&&(this.object.rotation.y=Math.round(this.object.rotation.y/n)*n),"Z"===this.axis&&n&&(this.object.rotation.z=Math.round(this.object.rotation.z/n)*n)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),k.copy(this.object.position),O.copy(this.object.quaternion),B.copy(this.object.scale),this.object.matrixWorld.decompose(C,S,j),g.copy(t.point).sub(C),"local"===i&&g.applyQuaternion(S.clone().inverse())}this.dragging=!0,s.mode=this.mode,this.dispatchEvent(s)}},this.pointerMove=function(e){var t=this.axis,i=this.mode,n=this.object,s=this.space;if("scale"===i?s="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(s="world"),void 0!==n&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){u.setFromCamera(e,this.camera);var a=u.intersectObjects([r],!0)[0]||!1;if(!1!==a){if(v.copy(a.point).sub(C),"local"===s&&v.applyQuaternion(S.clone().inverse()),"translate"===i)-1===t.search("X")&&(v.x=g.x),-1===t.search("Y")&&(v.y=g.y),-1===t.search("Z")&&(v.z=g.z),"local"===s?n.position.copy(v).sub(g).applyQuaternion(O):n.position.copy(v).sub(g),n.position.add(k),this.translationSnap&&("local"===s&&(n.position.applyQuaternion(p.copy(O).inverse()),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(O)),"world"===s&&(n.parent&&n.position.add(c.setFromMatrixPosition(n.parent.matrixWorld)),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(c.setFromMatrixPosition(n.parent.matrixWorld))));else if("scale"===i){if(-1!==t.search("XYZ")){var _=v.length()/g.length();v.dot(g)<0&&(_*=-1),c.set(_,_,_)}else c.copy(v).divide(g),-1===t.search("X")&&(c.x=1),-1===t.search("Y")&&(c.y=1),-1===t.search("Z")&&(c.z=1);n.scale.copy(B).multiply(c)}else if("rotate"===i){var x=20/P.distanceTo(c.setFromMatrixPosition(this.camera.matrixWorld)),E="local"===this.space?R:f,w=d[t];"E"===t?(c.copy(v).cross(g),y.copy(A),b=v.angleTo(g)*(c.dot(A)<0?1:-1)):"XYZE"===t?(c.copy(v).sub(g).cross(A).normalize(),y.copy(c),b=v.sub(g).dot(c.cross(A))*x):"X"!==t&&"Y"!==t&&"Z"!==t||(m.copy(w).applyQuaternion(E),y.copy(w),c=w.clone(),h=v.clone().sub(g),"local"===s&&(c.applyQuaternion(E),h.applyQuaternion(S)),b=h.dot(c.cross(A).normalize())*x),this.rotationSnap&&(b=Math.round(b/this.rotationSnap)*this.rotationSnap),this.rotationAngle=b,"local"===s?(n.quaternion.copy(O),n.quaternion.multiply(p.setFromAxisAngle(y,b))):(n.quaternion.copy(p.setFromAxisAngle(y,b)),n.quaternion.multiply(O))}this.dispatchEvent(o),this.dispatchEvent(l)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(a.mode=this.mode,this.dispatchEvent(a)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return n.mode},this.setMode=function(e){n.mode=e},this.setTranslationSnap=function(e){n.translationSnap=e},this.setRotationSnap=function(e){n.rotationSnap=e},this.setSize=function(e){n.size=e},this.setSpace=function(e){n.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has been depricated.")}},THREE.TransformControls.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControls,isTransformControls:!0}),THREE.TransformControlsGizmo=function(){"use strict";THREE.Object3D.call(this),this.type="TransformControlsGizmo";var e=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:THREE.DoubleSide,fog:!1}),t=new THREE.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),i=e.clone();i.opacity=.15;var r=e.clone();r.opacity=.33;var n=e.clone();n.color.set(16711680);var o=e.clone();o.color.set(65280);var s=e.clone();s.color.set(255);var a=e.clone();a.opacity=.25;var l=a.clone();l.color.set(16776960);var u=a.clone();u.color.set(65535);var c=a.clone();c.color.set(16711935),e.clone().color.set(16776960);var h=t.clone();h.color.set(16711680);var p=t.clone();p.color.set(65280);var d=t.clone();d.color.set(255);var f=t.clone();f.color.set(65535);var m=t.clone();m.color.set(16711935);var g=t.clone();g.color.set(16776960);var v=t.clone();v.color.set(7895160);var y=g.clone();y.opacity=.25;var b=new THREE.CylinderBufferGeometry(0,.05,.2,12,1,!1),_=new THREE.BoxBufferGeometry(.125,.125,.125),x=new THREE.BufferGeometry;x.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var E,w=function(e,t){for(var i=new THREE.BufferGeometry,r=[],n=0;n<=64*t;++n)r.push(0,Math.cos(n/32*Math.PI)*e,Math.sin(n/32*Math.PI)*e);return i.addAttribute("position",new THREE.Float32BufferAttribute(r,3)),i},T={X:[[new THREE.Mesh(b,n),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new THREE.Mesh(b,n),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new THREE.Line(x,h)]],Y:[[new THREE.Mesh(b,o),[0,1,0],null,null,"fwd"],[new THREE.Mesh(b,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new THREE.Line(x,p),null,[0,0,Math.PI/2]]],Z:[[new THREE.Mesh(b,s),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new THREE.Mesh(b,s),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new THREE.Line(x,d),null,[0,-Math.PI/2,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.1,0),a),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),l),[.15,.15,0]],[new THREE.Line(x,g),[.18,.3,0],null,[.125,1,1]],[new THREE.Line(x,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),u),[0,.15,.15],[0,Math.PI/2,0]],[new THREE.Line(x,f),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(x,f),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),c),[.15,0,.15],[-Math.PI/2,0,0]],[new THREE.Line(x,m),[.18,0,.3],null,[.125,1,1]],[new THREE.Line(x,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},M={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),i),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),i),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),i),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.2,0),i)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),i),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),i),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),i),[.2,0,.2],[-Math.PI/2,0,0]]]},C={START:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),r),null,null,null,"helper"]],END:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),r),null,null,null,"helper"]],DELTA:[[new THREE.Line((E=new THREE.BufferGeometry,E.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,1,1],3)),E),r),null,null,null,"helper"]],X:[[new THREE.Line(x,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(x,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(x,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},S={X:[[new THREE.Line(w(1,.5),h)],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),n),[0,0,.99],null,[1,3,1]]],Y:[[new THREE.Line(w(1,.5),p),null,[0,0,-Math.PI/2]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new THREE.Line(w(1,.5),d),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),s),[.99,0,0],null,[1,3,1]]],E:[[new THREE.Line(w(1.25,1),y),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new THREE.Line(w(1,1),v),null,[0,Math.PI/2,0]]]},j={AXIS:[[new THREE.Line(x,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},P={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.1,2,24),i)]],XYZE:[[new THREE.Mesh(new THREE.SphereBufferGeometry(.7,10,8),i)]]},R={X:[[new THREE.Mesh(_,n),[.8,0,0],[0,0,-Math.PI/2]],[new THREE.Line(x,h),null,null,[.8,1,1]]],Y:[[new THREE.Mesh(_,o),[0,.8,0]],[new THREE.Line(x,p),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new THREE.Mesh(_,s),[0,0,.8],[Math.PI/2,0,0]],[new THREE.Line(x,d),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new THREE.Mesh(_,l),[.85,.85,0],null,[2,2,.2]],[new THREE.Line(x,g),[.855,.98,0],null,[.125,1,1]],[new THREE.Line(x,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(_,u),[0,.85,.85],null,[.2,2,2]],[new THREE.Line(x,f),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(x,f),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(_,c),[.85,0,.85],null,[2,.2,2]],[new THREE.Line(x,m),[.855,0,.98],null,[.125,1,1]],[new THREE.Line(x,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),a),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),a),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),a),[0,0,1.1]]]},D={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),i),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),i),[0,.5,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),i),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new THREE.Mesh(_,i),[.85,.85,0],null,[3,3,.2]]],YZ:[[new THREE.Mesh(_,i),[0,.85,.85],null,[.2,3,3]]],XZ:[[new THREE.Mesh(_,i),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),i),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),i),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),i),[0,0,1.1]]]},A={X:[[new THREE.Line(x,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(x,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(x,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},k=function(e){var t=new THREE.Object3D;for(var i in e)for(var r=e[i].length;r--;){var n=e[i][r][0].clone(),o=e[i][r][1],s=e[i][r][2],a=e[i][r][3],l=e[i][r][4];n.name=i,n.tag=l,o&&n.position.set(o[0],o[1],o[2]),s&&n.rotation.set(s[0],s[1],s[2]),a&&n.scale.set(a[0],a[1],a[2]),n.updateMatrix();var u=n.geometry.clone();u.applyMatrix4(n.matrix),n.geometry=u,n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),t.add(n)}return t},O=new THREE.Vector3(0,0,0),B=new THREE.Euler,F=new THREE.Vector3(0,1,0),L=new THREE.Vector3(0,0,0),I=new THREE.Matrix4,N=new THREE.Quaternion,U=new THREE.Quaternion,z=new THREE.Quaternion,H=new THREE.Vector3(1,0,0),V=new THREE.Vector3(0,1,0),W=new THREE.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=k(T)),this.add(this.gizmo.rotate=k(S)),this.add(this.gizmo.scale=k(R)),this.add(this.picker.translate=k(M)),this.add(this.picker.rotate=k(P)),this.add(this.picker.scale=k(D)),this.add(this.helper.translate=k(C)),this.add(this.helper.rotate=k(j)),this.add(this.helper.scale=k(A)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:z;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var i=[];i=(i=(i=i.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var r=0;r<i.length;r++){var n=i[r];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);var o=this.worldPosition.distanceTo(this.cameraPosition);if(this.camera.isOrthographicCamera&&(o/=this.camera.zoom),n.scale.set(1,1,1).multiplyScalar(o*this.size/7),"helper"!==n.tag){if(n.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==n.name&&"XYZX"!==n.name||Math.abs(F.copy(H).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"!==n.name&&"XYZY"!==n.name||Math.abs(F.copy(V).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"!==n.name&&"XYZZ"!==n.name||Math.abs(F.copy(W).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(F.copy(W).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(F.copy(H).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(F.copy(V).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),-1!==n.name.search("X")&&(F.copy(H).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.x*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Y")&&(F.copy(V).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.y*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Z")&&(F.copy(W).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.z*=-1:"bwd"===n.tag&&(n.visible=!1))}else"rotate"===this.mode&&(U.copy(t),F.copy(this.eye).applyQuaternion(N.copy(t).inverse()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(I.lookAt(this.eye,L,V)),"X"===n.name&&(N.setFromAxisAngle(H,Math.atan2(-F.y,F.z)),N.multiplyQuaternions(U,N),n.quaternion.copy(N)),"Y"===n.name&&(N.setFromAxisAngle(V,Math.atan2(F.x,F.z)),N.multiplyQuaternions(U,N),n.quaternion.copy(N)),"Z"===n.name&&(N.setFromAxisAngle(W,Math.atan2(F.y,F.x)),N.multiplyQuaternions(U,N),n.quaternion.copy(N)));n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material._opacity=n.material._opacity||n.material.opacity,n.material._color=n.material._color||n.material.color.clone(),n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled?this.axis&&(n.name===this.axis||this.axis.split("").some((function(e){return n.name===e}))?(n.material.opacity=1,n.material.color.lerp(new THREE.Color(1,1,1),.5)):(n.material.opacity*=.25,n.material.color.lerp(new THREE.Color(1,1,1),.5))):(n.material.opacity*=.5,n.material.color.lerp(new THREE.Color(1,1,1),.5))}else n.visible=!1,"AXIS"===n.name?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,"X"===this.axis&&(N.setFromEuler(B.set(0,0,0)),n.quaternion.copy(t).multiply(N),Math.abs(F.copy(H).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Y"===this.axis&&(N.setFromEuler(B.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(N),Math.abs(F.copy(V).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Z"===this.axis&&(N.setFromEuler(B.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(N),Math.abs(F.copy(W).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"XYZE"===this.axis&&(N.setFromEuler(B.set(0,Math.PI/2,0)),F.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(I.lookAt(L,F,V)),n.quaternion.multiply(N),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),O.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),O.applyQuaternion(this.worldQuaternionStart.clone().inverse()),n.scale.copy(O),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)))}THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsGizmo.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControlsGizmo,isTransformControlsGizmo:!0}),THREE.TransformControlsPlane=function(){"use strict";THREE.Mesh.call(this,new THREE.PlaneBufferGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var e=new THREE.Vector3(1,0,0),t=new THREE.Vector3(0,1,0),i=new THREE.Vector3(0,0,1),r=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,s=new THREE.Matrix4,a=new THREE.Quaternion;this.updateMatrixWorld=function(){var l=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(l="local"),e.set(1,0,0).applyQuaternion("local"===l?this.worldQuaternion:a),t.set(0,1,0).applyQuaternion("local"===l?this.worldQuaternion:a),i.set(0,0,1).applyQuaternion("local"===l?this.worldQuaternion:a),o.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":o.copy(this.eye).cross(e),n.copy(e).cross(o);break;case"Y":o.copy(this.eye).cross(t),n.copy(t).cross(o);break;case"Z":o.copy(this.eye).cross(i),n.copy(i).cross(o);break;case"XY":n.copy(i);break;case"YZ":n.copy(e);break;case"XZ":o.copy(i),n.copy(t);break;case"XYZ":case"E":n.set(0,0,0)}break;case"rotate":default:n.set(0,0,0)}0===n.length()?this.quaternion.copy(this.cameraQuaternion):(s.lookAt(r.set(0,0,0),n,o),this.quaternion.setFromRotationMatrix(s)),THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsPlane.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.TransformControlsPlane,isTransformControlsPlane:!0}),THREE.Water=function(e,t){THREE.Mesh.call(this,e),this.type="Water";var i=this,r=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(16777215),n=t.textureWidth||512,o=t.textureHeight||512,s=t.clipBias||0,a=t.flowDirection||new THREE.Vector2(1,0),l=t.flowSpeed||.03,u=t.reflectivity||.02,c=t.scale||1,h=t.shader||THREE.Water.WaterShader,p=new THREE.TextureLoader,d=t.flowMap||void 0,f=t.normalMap0||p.load("textures/water/Water_1_M_Normal.jpg"),m=t.normalMap1||p.load("textures/water/Water_2_M_Normal.jpg"),g=new THREE.Matrix4,v=new THREE.Clock;if(void 0!==THREE.Reflector)if(void 0!==THREE.Refractor){var y=new THREE.Reflector(e,{textureWidth:n,textureHeight:o,clipBias:s}),b=new THREE.Refractor(e,{textureWidth:n,textureHeight:o,clipBias:s});y.matrixAutoUpdate=!1,b.matrixAutoUpdate=!1,this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),void 0!==d?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:d}):this.material.uniforms.flowDirection={type:"v2",value:a},f.wrapS=f.wrapT=THREE.RepeatWrapping,m.wrapS=m.wrapT=THREE.RepeatWrapping,this.material.uniforms.tReflectionMap.value=y.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=b.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=f,this.material.uniforms.tNormalMap1.value=m,this.material.uniforms.color.value=r,this.material.uniforms.reflectivity.value=u,this.material.uniforms.textureMatrix.value=g,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=.075,this.material.uniforms.config.value.z=.075,this.material.uniforms.config.value.w=c,this.addBeforeRenderFunction("THREE.Water",(function(e,t,r){var n,o;!function(e){g.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),g.multiply(e.getProjectionMatrixAlways?e.getProjectionMatrixAlways():e.projectionMatrix),g.multiply(e.matrixWorldInverse),g.multiply(i.matrixWorld)}(r),n=v.getDelta(),(o=i.material.uniforms.config).value.x+=l*n,o.value.y=o.value.x+.075,o.value.x>=.15?(o.value.x=0,o.value.y=.075):o.value.y>=.15&&(o.value.y=o.value.y-.15),i.visible=!1,y.matrixWorld.copy(i.matrixWorld),b.matrixWorld.copy(i.matrixWorld),y.onBeforeRender(e,t,r),b.onBeforeRender(e,t,r),i.visible=!0}))}else console.error("THREE.Water: Required component THREE.Refractor not found.");else console.error("THREE.Water: Required component THREE.Reflector not found.")},THREE.Water.prototype=Object.create(THREE.Mesh.prototype),THREE.Water.prototype.constructor=THREE.Water,THREE.Water.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new THREE.Vector4}},vertexShader:["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","uniform mat4 textureMatrix;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tvUv = uv;","\tvCoord = textureMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvToEye = cameraPosition - worldPosition.xyz;","\tvec4 mvPosition =  viewMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","\t#include <logdepthbuf_vertex>","\t#include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform sampler2D tReflectionMap;","uniform sampler2D tRefractionMap;","uniform sampler2D tNormalMap0;","uniform sampler2D tNormalMap1;","#ifdef USE_FLOWMAP","\tuniform sampler2D tFlowMap;","#else","\tuniform vec2 flowDirection;","#endif","uniform vec3 color;","uniform float reflectivity;","uniform vec4 config;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\t#include <logdepthbuf_fragment>","\tfloat flowMapOffset0 = config.x;","\tfloat flowMapOffset1 = config.y;","\tfloat halfCycle = config.z;","\tfloat scale = config.w;","\tvec3 toEye = normalize( vToEye );","\tvec2 flow;","\t#ifdef USE_FLOWMAP","\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;","\t#else","\t\tflow = flowDirection;","\t#endif","\tflow.x *= - 1.0;","\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );","\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );","\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;","\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );","\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );","\tfloat theta = max( dot( toEye, normal ), 0.0 );","\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 coord = vCoord.xyz / vCoord.w;","\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;","\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );","\tvec4 refractColor = texture2D( tRefractionMap, uv );","\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","}"].join("\n")},function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EarCut=e()}}((function(){return function e(t,i,r){function n(s,a){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[s]={exports:{}};t[s][0].call(c.exports,(function(e){return n(t[s][1][e]||e)}),c,c.exports,e,t,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(e,t,i){"use strict";function r(e,t,i){i=i||2;var r,a,l,u,c,d,m,g=t&&t.length,v=g?t[0]*i:e.length,y=n(e,0,v,i,!0),b=[];if(!y||y.next===y.prev)return b;if(g&&(y=function(e,t,i,r){var s,a,l,u=[];for(s=0,a=t.length;s<a;s++)(l=n(e,t[s]*r,s<a-1?t[s+1]*r:e.length,r,!1))===l.next&&(l.steiner=!0),u.push(f(l));for(u.sort(h),s=0;s<u.length;s++)p(u[s],i),i=o(i,i.next);return i}(e,t,y,i)),e.length>80*i){r=l=e[0],a=u=e[1];for(var _=i;_<v;_+=i)(c=e[_])<r&&(r=c),(d=e[_+1])<a&&(a=d),c>l&&(l=c),d>u&&(u=d);m=0!==(m=Math.max(l-r,u-a))?1/m:0}return s(y,b,i,r,a,m),b}function n(e,t,i,r,n){var o,s;if(n===M(e,t,i,r)>0)for(o=t;o<i;o+=r)s=E(o,e[o],e[o+1],s);else for(o=i-r;o>=t;o-=r)s=E(o,e[o],e[o+1],s);return s&&y(s,s.next)&&(w(s),s=s.next),s}function o(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!y(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(w(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function s(e,t,i,r,n,h,p){if(e){!p&&h&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=d(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,o,s,a,l,u=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,r=i,a=0,t=0;t<u&&(a++,r=r.nextZ);t++);for(l=u;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,u*=2}while(s>1)}(n)}(e,r,n,h);for(var f,m,g=e;e.prev!==e.next;)if(f=e.prev,m=e.next,h?l(e,r,n,h):a(e))t.push(f.i/i),t.push(e.i/i),t.push(m.i/i),w(e),e=m.next,g=m.next;else if((e=m)===g){p?1===p?s(e=u(e,t,i),t,i,r,n,h,2):2===p&&c(e,t,i,r,n,h):s(o(e),t,i,r,n,h,1);break}}}function a(e){var t=e.prev,i=e,r=e.next;if(v(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(m(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&v(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function l(e,t,i,r){var n=e.prev,o=e,s=e.next;if(v(n,o,s)>=0)return!1;for(var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,l=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,u=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,c=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,h=d(a,l,t,i,r),p=d(u,c,t,i,r),f=e.prevZ,g=e.nextZ;f&&f.z>=h&&g&&g.z<=p;){if(f!==e.prev&&f!==e.next&&m(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,g!==e.prev&&g!==e.next&&m(n.x,n.y,o.x,o.y,s.x,s.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&m(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;g&&g.z<=p;){if(g!==e.prev&&g!==e.next&&m(n.x,n.y,o.x,o.y,s.x,s.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function u(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!y(n,o)&&b(n,r,r.next,o)&&_(n,o)&&_(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),w(r),w(r.next),r=e=o),r=r.next}while(r!==e);return r}function c(e,t,i,r,n,a){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&g(l,u)){var c=x(l,u);return l=o(l,l.next),c=o(c,c.next),s(l,t,i,r,n,a),void s(c,t,i,r,n,a)}u=u.next}l=l.next}while(l!==e)}function h(e,t){return e.x-t.x}function p(e,t){if(t=function(e,t){var i,r=t,n=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s){if(s=a,a===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i.prev;var l,u=i,c=i.x,h=i.y,p=1/0;r=i.next;for(;r!==u;)n>=r.x&&r.x>=c&&n!==r.x&&m(o<h?n:s,o,c,h,o<h?s:n,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(n-r.x))<p||l===p&&r.x>i.x)&&_(r,e)&&(i=r,p=l),r=r.next;return i}(e,t)){var i=x(t,e);o(i,i.next)}}function d(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function m(e,t,i,r,n,o,s,a){return(n-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(i-s)*(t-a)>=0&&(i-s)*(o-a)-(n-s)*(r-a)>=0}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&b(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&_(e,t)&&_(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)}function v(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,i,r){return!!(y(e,i)&&y(t,r)||y(e,r)&&y(i,t))||v(e,t,i)>0!=v(e,t,r)>0&&v(i,r,e)>0!=v(i,r,t)>0}function _(e,t){return v(e.prev,e,e.next)<0?v(e,t,e.next)>=0&&v(e,e.prev,t)>=0:v(e,t,e.prev)<0||v(e,e.next,t)<0}function x(e,t){var i=new T(e.i,e.x,e.y),r=new T(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function E(e,t,i,r){var n=new T(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function w(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(e,t,i,r){for(var n=0,o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}t.exports=r,t.exports.default=r,r.deviation=function(e,t,i,r){var n=t&&t.length,o=n?t[0]*i:e.length,s=Math.abs(M(e,0,o,i));if(n)for(var a=0,l=t.length;a<l;a++){var u=t[a]*i,c=a<l-1?t[a+1]*i:e.length;s-=Math.abs(M(e,u,c,i))}var h=0;for(a=0;a<r.length;a+=3){var p=r[a]*i,d=r[a+1]*i,f=r[a+2]*i;h+=Math.abs((e[p]-e[f])*(e[d+1]-e[p+1])-(e[p]-e[d])*(e[f+1]-e[p+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},r.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[n][o][s]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i}},{}]},{},[1])(1)}));var Graph=function(e){var t=function(e){var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i},i=function(e,t){return parseFloat(e)-parseFloat(t)},r=function(e,r,n,o){o=o||1/0;var s,a={},l={0:[r]},u={},c=function(e,t){var i=""+e;l[i]||(l[i]=[]),l[i].push(t)};for(a[r]=0;l&&(s=t(l)).length;){s.sort(i);var h=s[0],p=l[h],d=p.shift(),f=parseFloat(h),m=e[d]||{};for(var g in p.length||delete l[h],m)if(Object.prototype.hasOwnProperty.call(m,g)){var v=m[g]+f,y=a[g];(undefined===y||y>v)&&(a[g]=v,c(v,g),u[g]=d)}}return undefined===a[n]?null:u},n=function(e,t){for(var i=[],r=t;undefined!==r;)i.push(r),r=e[r];return i.reverse(),i},o=function(e,t){for(var i,o,s,a=t.shift(),l=[];t.length;){if(i=t.shift(),!(o=r(e,a,i)))return null;if(s=n(o,i),!t.length)return l.concat(s);l.push.apply(l,s.slice(0,-1)),a=i}},s=function(e,t){try{return Array.prototype.slice.call(e,t)}catch(o){for(var i=[],r=t||0,n=e.length;r<n;++r)i.push(e[r]);return i}},a=function(e){this.map=e};return a.prototype.findShortestPath=function(e,t){return"[object Array]"===Object.prototype.toString.call(e)?o(this.map,e):o(this.map,2===arguments.length?[e,t]:s(arguments))},a.findShortestPath=function(e,t,i){return"[object Array]"===Object.prototype.toString.call(t)?o(e,t):o(e,3===arguments.length?[t,i]:s(arguments,1))},a}();function SimpleIDW(e){if(!(this instanceof SimpleIDW))return new SimpleIDW(e);this._canvas=e="string"==typeof e?document.getElementById(e):e,void 0===this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=128,this._canvas.height=128),this._ctx=this._canvas.getContext("2d"),this._width=this._canvas.width,this._height=this._canvas.height,this._min=0,this._max=1,this._radius=5,this._data=[],this._transformedData=[]}SimpleIDW.getInstance=function(){var e=null;return function(){return e||(e=new SimpleIDW),e}}(),SimpleIDW.prototype={defaultCellSize:10,defaultGradient:{0:"#000066",.1:"blue",.2:"cyan",.3:"lime",.4:"yellow",.5:"orange",.6:"red",.7:"Maroon",.8:"#660066",.9:"#990099",1:"#ff66ff"},data:function(e){return this.data!==e&&(this._data=e,this._dataDirty=!0),this},add:function(e){return this._data.push(e),this._dataDirty=!0,this},clear:function(){return this._data=[],this._dataDirty=!0,this},canvas:function(){return this._canvas},setCanvasSize:function(e,t){return this._canvasWidth===e&&this._canvasHeight===t||(this._canvasWidth=this._canvas.width=e,this._canvasHeight=this._canvas.height=t,this._dataDirty=!0),this},setAreaSize:function(e,t){return this._areaWidth===e&&this._areaHeight===t||(this._areaWidth=e,this._areaHeight=t,this._dataDirty=!0),this},min:function(e){return this._min!==e&&(this._min=e),this},max:function(e){return this.max!==e&&(this._max=e),this},alpha:function(e){return this._alpha=e,this},radius:function(e){return this._radius=e,this},opacity:function(e){return this._opacity!==e&&(this._opacity=e),this},exp:function(e){return this._exp=e,this},cellSize:function(e){var t=this._cell=document.createElement("canvas"),i=t.getContext("2d");return this._r=e,t.width=t.height=e,i.beginPath(),i.rect(0,0,e,e),i.fill(),i.closePath(),this},resize:function(){this._canvasWidth=this._canvas.width,this._canvasWidth=this._canvas.height},gradient:function(e){var t=document.createElement("canvas"),i=t.getContext("2d"),r=i.createLinearGradient(0,0,0,256);for(var n in t.width=1,t.height=256,e)r.addColorStop(+n,e[n]);return i.fillStyle=r,i.fillRect(0,0,1,256),this._grad=i.getImageData(0,0,1,256).data,this},_transformData:function(){var e=this._canvasWidth/this._areaWidth,t=this._canvasHeight/this._areaHeight,i=this;this._data.forEach((function(r){var n=r[0],o=r[1];n=n*e+i._canvasWidth/2,o=o*t+i._canvasHeight/2,i._transformedData.push([n,o,r[2]])}))},_redraw:function(){var e,t,i,r,n,o,s,a=[],l=this._r,u=this._exp,c=this._max,h=this._min,p=l/2,d=Math.ceil(this._canvasWidth/l)+1,f=Math.ceil(this._canvasHeight/l)+1;if(this._dataDirty&&this._transformData(),0!==this._transformedData.length){for(e=0,t=f;e<t;e++)for(r=0,n=d;r<n;r++){var m=e*l,g=r*l,v=0,y=0;for(o=0,s=this._transformedData.length;o<s;o++){var b=[g-p,m-p],_=this._transformedData[o],x=Math.sqrt(Math.pow(_[0]-b[0],2)+Math.pow(_[1]-b[1],2)),E=_[2];if(0===x){v=E,y=1;break}x>this._radius&&(v+=0,y+=0);var w=Math.pow(x,u);v+=E/w,y+=1/w}if(i=[r*l,e*l,v/y]){let e=Math.min(i[2],c);e=Math.max(h,e),a.push([Math.round(i[0]),Math.round(i[1]),e])}}this.data(a).draw(),this._frame=null}},draw:function(){this._cell||this.cellSize(this.defaultCellSize),this._grad||this.gradient(this.defaultGradient);var e=this._ctx;e.clearRect(0,0,this._canvasWidth,this._canvasHeight);for(var t,i=0,r=this._data.length;i<r;i++)t=this._data[i],e.globalAlpha=(t[2]-this._min)/this._max,e.drawImage(this._cell,t[0]-this._r,t[1]-this._r);var n=e.getImageData(0,0,this._canvasWidth,this._canvasHeight);return this._colorize(n.data,this._grad,this._opacity),e.putImageData(n,0,0),this},_colorize:function(e,t,i){for(var r,n=0,o=e.length;n<o;n+=4)r=4*e[n+3],e[n]=t[r],e[n+1]=t[r+1],e[n+2]=t[r+2],e[n+3]=256*i}};var MSPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4,_mat4_1:new THREE.Matrix4,_vec3_1:new THREE.Vector3,_vec3_2:new THREE.Vector3,_quat_1:new THREE.Quaternion,_vec3_3:new THREE.Vector3,_vec3_4:new THREE.Vector3,_mat4_2:new THREE.Matrix4};function SimpleHeatmap(e){this._canvas="string"==typeof e?document.getElementById(e):e,void 0===this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=128,this._canvas.height=128),this._ctx=this._canvas.getContext("2d"),this._max=1,this._min=0,this._dataDirty=!0,this._data=[],this._transformedData=[],this._canvasWidth=this._areaWidth=this._canvas.width,this._canvasHeight=this._areaHeight=this._canvas.height,this._alpha=!1,this._grad={};var t=this._createCanvas();t.width=1,t.height=256,this._gradCtx=t.getContext("2d"),this._gradCache={},this._gradData=null,this._r=0,this._radius=0,this._blur=0,this._circle=this._createCanvas(),this._cirCtx=this._circle.getContext("2d")}"function"==typeof define&&define.amd?define("spe",MSPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=MSPE),MSPE.shaderChunks={defines:[].join("\n"),uniforms:["uniform sampler2D tex;"].join("\n"),attributes:["attribute vec3 mcol0;","attribute vec3 mcol1;","attribute vec3 mcol2;","attribute vec3 mcol3;","attribute vec4 color;"].join("\n"),varyings:["varying vec2 vUv;","varying vec4 varyColor;"].join("\n")},MSPE.shaders={vertex:[THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,MSPE.shaderChunks.uniforms,MSPE.shaderChunks.attributes,MSPE.shaderChunks.varyings,"void main()","{","\tmat4 matrix = mat4(","\t\tvec4( mcol0, 0 ),","\t\tvec4( mcol1, 0 ),","\t\tvec4( mcol2, 0 ),","\t\tvec4( mcol3, 1 )","\t);","\tvaryColor = color;","   vec4 mvPosition = modelViewMatrix * matrix * vec4( position, 1.0 );","   vUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,MSPE.shaderChunks.uniforms,MSPE.shaderChunks.varyings,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"    gl_FragColor = varyColor * texture2D(tex, vUv);",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},MSPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,i){"use strict";return typeof e===t?e:i},ensureArrayTypedArg:function(e,t,i){"use strict";if(Array.isArray(e)){for(var r=e.length-1;r>=0;--r)if(typeof e[r]!==t)return i;return e}return this.ensureTypedArg(e,t,i)},ensureInstanceOf:function(e,t,i){"use strict";return void 0!==t&&e instanceof t?e:i},ensureArrayInstanceOf:function(e,t,i){"use strict";if(Array.isArray(e)){for(var r=e.length-1;r>=0;--r)if(void 0!==t&&e[r]instanceof t==!1)return i;return e}return this.ensureInstanceOf(e,t,i)},ensureValueOverLifetimeCompliance:function(e,t,i){"use strict";t=t||3,i=i||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);var r=this.clamp(e._value.length,t,i),n=this.clamp(e._spread.length,t,i),o=Math.max(r,n);e._value.length!==o&&(e._value=this.interpolateArray(e._value,o)),e._spread.length!==o&&(e._spread=this.interpolateArray(e._spread,o))},interpolateArray:function(e,t){"use strict";for(var i=e.length,r=["function"==typeof e[0].clone?e[0].clone():e[0]],n=(i-1)/(t-1),o=1;o<t-1;++o){var s=o*n,a=Math.floor(s),l=Math.ceil(s),u=s-a;r[o]=this.lerpTypeAgnostic(e[a],e[l],u)}return r.push("function"==typeof e[i-1].clone?e[i-1].clone():e[i-1]),r},clamp:function(e,t,i){"use strict";return Math.max(t,Math.min(e,i))},zeroToEpsilon:function(e,t){"use strict";var i=e;return i=t?1e-5*Math.random()*10:1e-5,e<0&&e>-1e-5&&(i=-i),i},lerpTypeAgnostic:function(e,t,i){"use strict";var r,n=this.types;return typeof e==n.NUMBER&&typeof t==n.NUMBER?e+(t-e)*i:e instanceof THREE.Vector2&&t instanceof THREE.Vector2||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&null==e.z&&null==e.z&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&null==t.z&&null==t.z?(e instanceof THREE.Vector2?r=e.clone():((r={}).x=e.x,r.y=e.y),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r):e instanceof THREE.Vector3&&t instanceof THREE.Vector3||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&null==e.w&&null==e.w&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&null==t.w&&null==t.w?(e instanceof THREE.Vector3?r=e.clone():((r={}).x=e.x,r.y=e.y,r.z=e.z),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r.z=this.lerp(e.z,t.z,i),r):e instanceof THREE.Vector4&&t instanceof THREE.Vector4||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&typeof e.w==n.NUMBER&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&typeof t.w==n.NUMBER?(e instanceof THREE.Vector4?r=e.clone():((r={}).x=e.x,r.y=e.y,r.z=e.z,r.w=e.w),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r.z=this.lerp(e.z,t.z,i),r.w=this.lerp(e.w,t.w,i),r):e instanceof THREE.Color&&t instanceof THREE.Color||typeof e.r==n.NUMBER&&typeof e.g==n.NUMBER&&typeof e.b==n.NUMBER&&typeof t.r==n.NUMBER&&typeof t.g==n.NUMBER&&typeof t.b==n.NUMBER?(e instanceof THREE.Color?r=e.clone():((r={}).r=e.r,r.g=e.g,r.b=e.b),r.r=this.lerp(e.r,t.r,i),r.g=this.lerp(e.g,t.g,i),r.b=this.lerp(e.b,t.b,i),r):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,i){"use strict";return e+(t-e)*i},roundToNearestMultiple:function(e,t){"use strict";var i;return 0===t||0===(i=Math.abs(e)%t)?e:e<0?-(Math.abs(e)-i):e+t-i},arrayValuesAreEqual:function(e){"use strict";for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){"use strict";return e+t*(Math.random()-.5)},randomVector3:function(e,t,i,r,n){"use strict";var o=i.x+(Math.random()*r.x-.5*r.x),s=i.y+(Math.random()*r.y-.5*r.y),a=i.z+(Math.random()*r.z-.5*r.z);n&&(o=.5*-n.x+this.roundToNearestMultiple(o,n.x),s=.5*-n.y+this.roundToNearestMultiple(s,n.y),a=.5*-n.z+this.roundToNearestMultiple(a,n.z)),e.typedArray.setVec3Components(t,o,s,a)},getRandomVector3:function(e,t,i){"use strict";var r=e.x+(Math.random()*t.x-.5*t.x),n=e.y+(Math.random()*t.y-.5*t.y),o=e.z+(Math.random()*t.z-.5*t.z);return i&&(r=.5*-i.x+this.roundToNearestMultiple(r,i.x),n=.5*-i.y+this.roundToNearestMultiple(n,i.y),o=.5*-i.z+this.roundToNearestMultiple(o,i.z)),new THREE.Vector3(r,n,o)},randomColor:function(e,t,i,r){"use strict";var n=i.r+Math.random()*r.x,o=i.g+Math.random()*r.y,s=i.b+Math.random()*r.z;n=this.clamp(n,0,1),o=this.clamp(o,0,1),s=this.clamp(s,0,1),e.typedArray.setVec3Components(t,n,o,s)},randomColorAsHex:function(){"use strict";var e=new THREE.Color;return function(t,i,r,n){for(var o=r.length,s=[],a=0;a<o;++a){var l=n[a];e.copy(r[a]),e.r+=Math.random()*l.x-.5*l.x,e.g+=Math.random()*l.y-.5*l.y,e.b+=Math.random()*l.z-.5*l.z,e.r=this.clamp(e.r,0,1),e.g=this.clamp(e.g,0,1),e.b=this.clamp(e.b,0,1),s.push(e.getHex())}t.typedArray.setVec4Components(i,s[0],s[1],s[2],s[3])}}(),getRandomColor:function(e,t){"use strict";for(var i=e.length,r=[],n=0;n<i;++n){var o=t[n],s=new THREE.Color;s.copy(e[n]),s.r+=Math.random()*o.x-.5*o.x,s.g+=Math.random()*o.y-.5*o.y,s.b+=Math.random()*o.z-.5*o.z,s.r=this.clamp(s.r,0,1),s.g=this.clamp(s.g,0,1),s.b=this.clamp(s.b,0,1),r.push(s)}return r},randomVector3OnSphere:function(e,t,i,r,n,o,s,a){"use strict";var l=2*Math.random()-1,u=6.2832*Math.random(),c=Math.sqrt(1-l*l),h=this.randomFloat(r,n),p=0,d=0,f=0;s&&(h=Math.round(h/s)*s),p=c*Math.cos(u)*h,d=c*Math.sin(u)*h,f=l*h,p*=o.x,d*=o.y,f*=o.z,p+=i.x,d+=i.y,f+=i.z,e.typedArray.setVec3Components(t,p,d,f)},getRandomVector3OnSphere:function(e,t,i,r,n,o){"use strict";var s=2*Math.random()-1,a=6.2832*Math.random(),l=Math.sqrt(1-s*s),u=this.randomFloat(t,i),c=0,h=0,p=0;return n&&(u=Math.round(u/n)*n),c=l*Math.cos(a)*u,h=l*Math.sin(a)*u,p=s*u,c*=r.x,h*=r.y,p*=r.z,c+=e.x,h+=e.y,p+=e.z,new THREE.Vector3(c,h,p)},seededRandom:function(e){var t=1e4*Math.sin(e);return t-(0|t)},randomVector3OnDisc:function(e,t,i,r,n,o,s){"use strict";var a=6.2832*Math.random(),l=Math.abs(this.randomFloat(r,n)),u=0,c=0,h=0;s&&(l=Math.round(l/s)*s),u=Math.cos(a)*l,c=Math.sin(a)*l,u*=o.x,c*=o.y,u+=i.x,c+=i.y,h+=i.z,e.typedArray.setVec3Components(t,u,c,h)},getRandomVector3OnDisc:function(e,t,i,r,n){"use strict";var o=6.2832*Math.random(),s=Math.abs(this.randomFloat(t,i)),a=0,l=0,u=0;return n&&(s=Math.round(s/n)*n),a=Math.cos(o)*s,l=Math.sin(o)*s,a*=r.x,l*=r.y,a+=e.x,l+=e.y,u+=e.z,new THREE.Vector3(a,l,u)},randomDirectionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,i,r,n,o,s,a,l){e.copy(s),e.x-=r,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(a,l)),t.typedArray.setVec3Components(i,e.x,e.y,e.z)}}(),getRandomDirectionVector3OnSphere:function(e,t,i){"use strict";var r=new THREE.Vector3;return r.copy(e),r.x-=this.randomFloat(0,1),r.y-=this.randomFloat(0,1),r.z-=this.randomFloat(0,1),r.normalize().multiplyScalar(-this.randomFloat(t,i)),r},getDirectionVector3OnSphere:function(e,t,i,r,n,o){"use strict";var s=new THREE.Vector3;s.copy(e),s.normalize().multiplyScalar(this.randomFloat(i,r));var a=this.getRandomVector3(n,o);return s.add(a),s},randomDirectionVector3OnDisc:function(){"use strict";var e=new THREE.Vector3;return function(t,i,r,n,o,s,a,l){e.copy(s),e.x-=r,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(a,l)),t.typedArray.setVec3Components(i,e.x,e.y,0)}}(),getPackedRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Color,r=new THREE.Vector3(1,1,1);return function(n,o){return e.copy(n).normalize(),t.copy(o).normalize(),e.x+=.5*-o.x+Math.random()*o.x,e.y+=.5*-o.y+Math.random()*o.y,e.z+=.5*-o.z+Math.random()*o.z,e.normalize().add(r).multiplyScalar(.5),i.setRGB(e.x,e.y,e.z),i.getHex()}}(),getRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,i=(new THREE.Color,new THREE.Vector3(1,1,1));return function(r,n){return e.copy(r).normalize(),t.copy(n).normalize(),e.x+=.5*-n.x+Math.random()*n.x,e.y+=.5*-n.y+Math.random()*n.y,e.z+=.5*-n.z+Math.random()*n.z,e.normalize().add(i).multiplyScalar(.5),e}}(),setMatrix:function(){var e=new THREE.Quaternion;return function(t,i,r,n){e.setFromEuler(i,!1),n.compose(t,e,r)}}(),clock:function(){var e=new THREE.Clock;return function(){return e}}()},MSPE.Group=function(e){"use strict";var t=MSPE.utils,i=t.types;if((e=t.ensureTypedArg(e,i.OBJECT,{})).texture=t.ensureTypedArg(e.texture,i.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,i.NUMBER,.016),this.texture=t.ensureInstanceOf(e.texture.value,THREE.Texture,null),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,i.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,i.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,i.NUMBER,1e3),this.vec4Quaternion=t.ensureInstanceOf(e.vec4Quaternion,THREE.Vector4,new THREE.Vector4(0,0,0,1)),this.vec4Quaternion=this.vec4Quaternion.normalize(),null==e.bufferGeometry||null==e.bufferGeometry||!(e.bufferGeometry instanceof THREE.BufferGeometry))return console.error("[MSPE.js] : [MSPE.Group] : error options.bufferGeometry!"),null;this.instancedBufferGeometry=null,this.mesh=null,this.materialList=[],this.geometryList=[],this.bufferGeometry=e.bufferGeometry,this.bufferGeometry=this.bufferGeometry.toNonIndexed(),this.bufferGeometry.computeBoundingBox(),this.geometryList.push(this.bufferGeometry),this.instancedBufferGeometry=new THREE.InstancedBufferGeometry,this.geometryList.push(this.instancedBufferGeometry);var r=this.bufferGeometry.attributes.position.clone();if(this.instancedBufferGeometry.setAttribute("position",r),null!=this.bufferGeometry.attributes.uv&&null!=this.bufferGeometry.attributes.uv){var n=this.bufferGeometry.attributes.uv.clone();this.instancedBufferGeometry.setAttribute("uv",n)}this.instanceBuffer=new THREE.InstancedInterleavedBuffer(new Float32Array(16*this.maxParticleCount),16,1).setUsage(THREE.DynamicDrawUsage),this.mcol0=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,0),this.mcol1=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,3),this.mcol2=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,6),this.mcol3=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,9),this.colors=new THREE.InterleavedBufferAttribute(this.instanceBuffer,4,12);!function(){var e=new THREE.Vector3(0,0,0),t=new THREE.Euler(0,0,0),i=new THREE.Quaternion,r=new THREE.Vector3(1,1,1)}();for(var o=new THREE.Matrix4,s=o.elements,a=0,l=this.mcol0.count;a<l;a++){var u=new THREE.Vector3(0,0,0),c=new THREE.Euler(0,0,0),h=new THREE.Vector3(0,0,0);t.setMatrix(u,c,h,o),this.mcol0.setXYZ(a,s[0],s[1],s[2]),this.mcol1.setXYZ(a,s[4],s[5],s[6]),this.mcol2.setXYZ(a,s[8],s[9],s[10]),this.mcol3.setXYZ(a,s[12],s[13],s[14]),this.colors.setXYZW(a,1,1,1,1)}this.instancedBufferGeometry.setAttribute("mcol0",this.mcol0),this.instancedBufferGeometry.setAttribute("mcol1",this.mcol1),this.instancedBufferGeometry.setAttribute("mcol2",this.mcol2),this.instancedBufferGeometry.setAttribute("mcol3",this.mcol3),this.instancedBufferGeometry.setAttribute("color",this.colors),this.blending=t.ensureTypedArg(e.blending,i.NUMBER,THREE.AdditiveBlending),this.transparent=t.ensureTypedArg(e.transparent,i.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,i.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,i.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,i.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,i.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,i.NUMBER,300),this.emitters=[],this.emitterIDs=[],this.particleCount=0,this.uniforms={tex:{type:"t",value:this.texture}},this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:MSPE.shaders.vertex,fragmentShader:MSPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,fog:this.fog}),this.materialList.push(this.material),this.mesh=new THREE.Mesh(this.instancedBufferGeometry,this.material),this.bEnableTrail=t.ensureTypedArg(e.bEnableTrail,i.BOOLEAN,!1),this.bEnableTrail&&(this.textureTrail=t.ensureInstanceOf(e.textureTrail,THREE.Texture,null),null!=this.textureTrail&&null!=this.textureTrail||(console.error("[MSPE.js] : [MSPE.Group] : error options.textureTrail!"),this.textureTrail=this.texture),this.fTrailLife=parseFloat(t.ensureTypedArg(e.fTrailLife,i.NUMBER,1)),this.fTrailWidthStart=parseFloat(t.ensureTypedArg(e.fTrailWidthStart,i.NUMBER,1)),this.fTrailWidthEnd=parseFloat(t.ensureTypedArg(e.fTrailWidthEnd,i.NUMBER,1)))},MSPE.Group.constructor=MSPE.Group,MSPE.Group.prototype._updateDefines=function(){},MSPE.Group.prototype.addEmitter=function(e){"use strict";if(e instanceof MSPE.Emitter!=!1)if(this.emitterIDs.indexOf(e.uuid)>-1)console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : Emitter already exists in this group. Will not add again.");else{if(null===e.group){var t,i=this.particleCount;return t=Math.min(i+e.particleCount,this.maxParticleCount),this.particleCount=t,e.particleCount=t-i,e.activationStart=i,e.activationEnd=e.activationStart+e.particleCount,e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e.attach(this),this.emitters.push(e),this.emitterIDs.push(e.uuid),this.material.needsUpdate=!0,this.instanceBuffer.needsUpdate=!0,this}console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : Emitter already belongs to another group. Will not add to requested group.")}else console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : emitter argument must be instance of MSPE.Emitter;")},MSPE.Group.prototype.removeEmitter=function(e){"use strict";var t=this.emitterIDs.indexOf(e.uuid);e instanceof MSPE.Emitter!=!1?-1!==t?(this.emitters[t].dispose(),this.emitters.splice(t,1),this.emitterIDs.splice(t,1),this.particleCount-=e.particleCount,this.material.needsUpdate=!0,this.instanceBuffer.needsUpdate=!0,e.group=null):console.error("[MSPE.js] : [MSPE.Group] : [removeEmitter] : Emitter does not exist in this group. Will not remove."):console.error("[MSPE.js] : [MSPE.Group] : [removeEmitter] : emitter argument must be instance of MSPE.Emitter;")},MSPE.Group.prototype.tick=function(e,t){"use strict";var i=this.emitters,r=i.length,n=e||this.fixedTimeStep;if(0!==r){for(var o=0;o<r;++o)i[o].tick(n,t);this.instanceBuffer.needsUpdate=!0}},MSPE.Group.prototype.dispose=function(){"use strict";return this.materialList.forEach((function(e){e.dispose()})),this.geometryList.forEach((function(e){e.dispose()})),this.materialList=[],this.geometryList=[],this},MSPE.Emitter=function(e){"use strict";var t=MSPE.utils,i=t.types,r=MSPE.valueOverLifetimeLength;for(var n in(e=t.ensureTypedArg(e,i.OBJECT,{})).position=t.ensureTypedArg(e.position,i.OBJECT,{}),e.velocity=t.ensureTypedArg(e.velocity,i.OBJECT,{}),e.acceleration=t.ensureTypedArg(e.acceleration,i.OBJECT,{}),e.radius=t.ensureTypedArg(e.radius,i.OBJECT,{}),e.drag=t.ensureTypedArg(e.drag,i.OBJECT,{}),e.rotation=t.ensureTypedArg(e.rotation,i.OBJECT,{}),e.color=t.ensureTypedArg(e.color,i.OBJECT,{}),e.opacity=t.ensureTypedArg(e.opacity,i.OBJECT,{}),e.size=t.ensureTypedArg(e.size,i.OBJECT,{}),e.angle=t.ensureTypedArg(e.angle,i.OBJECT,{}),e.wiggle=t.ensureTypedArg(e.wiggle,i.OBJECT,{}),e.maxAge=t.ensureTypedArg(e.maxAge,i.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.type=t.ensureTypedArg(e.type,i.NUMBER,SPE.distributions.BOX),this.position={_value:t.ensureInstanceOf(e.position.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.position.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1),_radius:t.ensureTypedArg(e.position.radius,i.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.position.distributionClamp,i.NUMBER,0)},this.velocity={_value:t.ensureInstanceOf(e.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.velocity.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.velocity.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.velocity.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.velocity.randomise,i.BOOLEAN,!1),_radius:t.ensureTypedArg(e.velocity.radius,i.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.velocity.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.velocity.distributionClamp,i.NUMBER,0)},this.acceleration={_value:t.ensureInstanceOf(e.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.acceleration.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.acceleration.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.acceleration.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.acceleration.randomise,i.BOOLEAN,!1),_radius:t.ensureTypedArg(e.acceleration.radius,i.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.acceleration.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.acceleration.distributionClamp,i.NUMBER,0)},this.drag={_value:t.ensureTypedArg(e.drag.value,i.NUMBER,0),_spread:t.ensureTypedArg(e.drag.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.drag.randomise,i.BOOLEAN,!1)},this.wiggle={_value:t.ensureTypedArg(e.wiggle.value,i.NUMBER,0),_spread:t.ensureTypedArg(e.wiggle.spread,i.NUMBER,0)},this.rotation={_axis:t.ensureInstanceOf(e.rotation.axis,THREE.Vector3,new THREE.Vector3(0,1,0)),_axisSpread:t.ensureInstanceOf(e.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:t.ensureTypedArg(e.rotation.angle,i.NUMBER,0),_angleSpread:t.ensureTypedArg(e.rotation.angleSpread,i.NUMBER,0),_static:t.ensureTypedArg(e.rotation.static,i.BOOLEAN,!1),_center:t.ensureInstanceOf(e.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1)},this.maxAge={_value:t.ensureTypedArg(e.maxAge.value,i.NUMBER,2),_spread:t.ensureTypedArg(e.maxAge.spread,i.NUMBER,0)},this.color={_value:t.ensureArrayInstanceOf(e.color.value,THREE.Color,new THREE.Color),_spread:t.ensureArrayInstanceOf(e.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.opacity={_value:t.ensureArrayTypedArg(e.opacity.value,i.NUMBER,1),_spread:t.ensureArrayTypedArg(e.opacity.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.size={_value:t.ensureArrayTypedArg(e.size.value,i.NUMBER,1),_spread:t.ensureArrayTypedArg(e.size.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.angle={_value:t.ensureArrayTypedArg(e.angle.value,i.NUMBER,0),_spread:t.ensureArrayTypedArg(e.angle.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.SHOULD_DRAG_PARTICLES=!!Math.max(this.drag._value,this.drag._spread),this.SHOULD_WIGGLE_PARTICLES=!!Math.max(this.wiggle._value,this.wiggle._spread),this.SHOULD_ROTATE_PARTICLES=!!Math.max(this.rotation._angle,this.rotation._angleSpread),this.SHOULD_COLORIZE_PARTICLES=!0,this.SHOULD_SIZE_PARTICLES=!0,this.SHOULD_ANGLE_PARTICLES=!0,this.particleCount=t.ensureTypedArg(e.particleCount,i.NUMBER,100),this.objPool=new MSPE.BufferAttributeObjPool({iCount:this.particleCount}),this.duration=t.ensureTypedArg(e.duration,i.NUMBER,null),this.isStatic=t.ensureTypedArg(e.isStatic,i.BOOLEAN,!1),this.isLookAtCamera=t.ensureTypedArg(e.isLookAtCamera,i.BOOLEAN,!1),this.isLookAtCameraOnlyY=t.ensureTypedArg(e.isLookAtCameraOnlyY,i.BOOLEAN,!1),this.activeMultiplier=t.ensureTypedArg(e.activeMultiplier,i.NUMBER,1),this.direction=t.ensureTypedArg(e.direction,i.NUMBER,1),this.alive=t.ensureTypedArg(e.alive,i.BOOLEAN,!0),this.particlesPerSecond=0,this.age=0,this.activationStart=t.ensureTypedArg(e.activationStart,i.NUMBER,0),this.activationEnd=this.activationStart+this.particleCount,this._calculatePPSValue(this.maxAge._value+this.maxAge._spread),this.arrayParticles=new Array,this.group=null,this.bInitSpeed=!1,this.bInitSpeedAcc=!1,this.resetFlags={position:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)||t.ensureTypedArg(e.radius.randomise,i.BOOLEAN,!1),velocity:t.ensureTypedArg(e.velocity.randomise,i.BOOLEAN,!1),acceleration:t.ensureTypedArg(e.acceleration.randomise,i.BOOLEAN,!1)||t.ensureTypedArg(e.drag.randomise,i.BOOLEAN,!1),rotation:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),rotationCenter:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),size:t.ensureTypedArg(e.size.randomise,i.BOOLEAN,!1),color:t.ensureTypedArg(e.color.randomise,i.BOOLEAN,!1),opacity:t.ensureTypedArg(e.opacity.randomise,i.BOOLEAN,!1),angle:t.ensureTypedArg(e.angle.randomise,i.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"},this.updateMap)this.updateMap.hasOwnProperty(n)&&(this.updateCounts[this.updateMap[n]]=0,this.updateFlags[this.updateMap[n]]=!1,this._createGetterSetters(this[n],n));t.ensureValueOverLifetimeCompliance(this.color,r,r),t.ensureValueOverLifetimeCompliance(this.opacity,r,r),t.ensureValueOverLifetimeCompliance(this.size,r,r),t.ensureValueOverLifetimeCompliance(this.angle,r,r)},MSPE.Emitter.constructor=MSPE.Emitter,MSPE.Emitter.prototype._createGetterSetters=function(e,t){"use strict";var i=this;for(var r in e)if(e.hasOwnProperty(r)){var n=r.replace("_","");Object.defineProperty(e,n,{get:function(e){return function(){return this[e]}}(r),set:function(e){return function(r){var n=i.updateMap[t],o=this[e],s=MSPE.valueOverLifetimeLength;"_rotationCenter"===e?(i.updateFlags.rotationCenter=!0,i.updateCounts.rotationCenter=0):"_randomise"===e?i.resetFlags[n]=r:(i.updateFlags[n]=!0,i.updateCounts[n]=0),this[e]=r,Array.isArray(o)&&MSPE.utils.ensureValueOverLifetimeCompliance(i[t],s,s)}}(r)})}},MSPE.Emitter.prototype.attach=function(e){this.group=e},MSPE.Emitter.prototype._calculatePPSValue=function(e){"use strict";var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e},MSPE.Emitter.prototype._activateParticles=function(e,t){"use strict";this.direction;for(var i=0;i<e;++i){var r=new MSPE.Particle({emitter:this});null!=r&&null!=r&&this.arrayParticles.push(r)}},MSPE.Emitter.prototype.tick=function(e,t){"use strict";if(!this.isStatic)if(!1!==this.alive)if(null!==this.duration&&this.age>this.duration){for(var i=0,r=this.arrayParticles.length;i<r;++i)this.arrayParticles[i].tick(e,t),this.arrayParticles[i].alive||(this.arrayParticles[i].dispose(),this.arrayParticles.splice(i,1),r=this.arrayParticles.length,i--);this.arrayParticles.length<=0&&(this.alive=!1,this.age=0)}else{if(this.activationIndex=this.arrayParticles.length,this.activationIndex<this.particleCount){var n=this.activationIndex,o=this.particlesPerSecond*this.activeMultiplier*e,s=1===this.particleCount?n:0|n,a=Math.min(s+o,this.activationEnd)-s;a=Math.min(this.particleCount-this.activationIndex,a),this._activateParticles(a)}for(i=0,r=this.arrayParticles.length;i<r;++i)this.arrayParticles[i].tick(e,t),this.arrayParticles[i].alive||(this.arrayParticles[i].dispose(),this.arrayParticles.splice(i,1),r=this.arrayParticles.length,i--);this.age+=e}else this.age=0},MSPE.Emitter.prototype.dispose=function(){"use strict";for(var e=0,t=this.arrayParticles.length;e<t;++e)this.arrayParticles[e].dispose();this.particlesPerSecond=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.age=0,this.objPool.dispose()},MSPE.Particle=function(e){"use strict";var t=MSPE.utils,i=t.types;if(null!=(e=t.ensureTypedArg(e,i.OBJECT,{})).emitter&&null!=e.emitter&&e.emitter instanceof MSPE.Emitter){if(this.emitter=e.emitter,this.position={_value:e.emitter.position.value,_spread:e.emitter.position.spread,_spreadClamp:e.emitter.position.spreadClamp,_distribution:e.emitter.position.distribution,_randomise:e.emitter.position.randomise,_radius:e.emitter.position.radius,_radiusScale:e.emitter.position.radiusScale,_distributionClamp:e.emitter.position.distributionClamp},this.velocity={_value:e.emitter.velocity.value,_spread:e.emitter.velocity.spread,_spreadClamp:e.emitter.velocity.spreadClamp,_distribution:e.emitter.velocity.distribution,_randomise:e.emitter.velocity.randomise,_radius:e.emitter.velocity.radius,_radiusScale:e.emitter.velocity.radiusScale,_distributionClamp:e.emitter.velocity.distributionClamp},this.acceleration={_value:e.emitter.acceleration.value,_spread:e.emitter.acceleration.spread,_spreadClamp:e.emitter.acceleration.spreadClamp,_distribution:e.emitter.acceleration.distribution,_randomise:e.emitter.acceleration.randomise,_radius:e.emitter.acceleration.radius,_radiusScale:e.emitter.acceleration.radiusScale,_distributionClamp:e.emitter.acceleration.distributionClamp},this.drag={_value:e.emitter.drag.value,_spread:e.emitter.drag.spread,_randomise:e.emitter.position.randomise},this.wiggle={_value:e.emitter.wiggle.value,_spread:e.emitter.wiggle.spread},this.rotation={_axis:e.emitter.rotation.axis,_axisSpread:e.emitter.rotation.axisSpread,_angle:e.emitter.rotation.angle,_angleSpread:e.emitter.rotation.angleSpread,_static:e.emitter.rotation.static,_center:e.emitter.rotation.center,_randomise:e.emitter.position.randomise},this.maxAge={_value:e.emitter.maxAge.value,_spread:e.emitter.maxAge.spread},this.color={_value:e.emitter.color.value,_spread:e.emitter.color.spread,_randomise:e.emitter.position.randomise},this.opacity={_value:e.emitter.opacity.value,_spread:e.emitter.opacity.spread,_randomise:e.emitter.position.randomise},this.size={_value:e.emitter.size.value,_spread:e.emitter.size.spread,_randomise:e.emitter.position.randomise},this.angle={_value:e.emitter.angle.value,_spread:e.emitter.angle.spread,_randomise:e.emitter.position.randomise},this.alive=e.emitter.alive,this.age=0,this.vec3RealPosition=this._assignPositionValue(),this.vec3RealVelocity=this._assignVelocityValue(),this.vec3RealAcceleration=this._assignAccelerationValue(),this.arrayRealColor=this._assignColorValue(),this.arrayRealOpacity=this._assignOpacityAbsLifetimeValue(),this.arrayRealSize=this._assignSizeAbsLifetimeValue(),this.arrayRealAngle=this._assignAngleValue(),this.fRealDrag=t.clamp(t.randomFloat(this.drag._value,this.drag._spread),0,1),this.fRealWiggle=t.randomFloat(this.wiggle._value,this.wiggle._spread),this.fRealMaxAge=MSPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread),this.vec3RealRotationAxis=MSPE.utils.getRotationAxis(this.rotation._axis,this.rotation._axisSpread),this.fRealRotationAngle=MSPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.uuidTrial="",this.obj=this.emitter.objPool.takeAnObj(),null==this.obj||null==this.obj)return this.alive=!1,this.dispose(),null;for(var r in this.matrix=new THREE.Matrix4,this.matrixElements=this.matrix.elements,this.vec3Position=new THREE.Vector3(0,0,0),this.vec3Rotation=new THREE.Euler(0,0,0),this.vec3Scale=new THREE.Vector3(.1,.1,.1),this.obj.setUse(!0),this.iBufferIndex=this.obj.iIndex+this.emitter.activationStart,this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"},this.updateMap)this.updateMap.hasOwnProperty(r)&&(this.updateCounts[this.updateMap[r]]=0,this.updateFlags[this.updateMap[r]]=!1,this._createGetterSetters(this[r],r));return this.emitter.group.bEnableTrail&&(this.trailRenderHelper=new TrailRenderHelper,this.trailRenderHelper.onTriggerMeshInited=this.onTriggerMeshInited,this.trailRenderHelper.init({fTimeLong:this.emitter.group.fTrailLife,fTimeStart:MSPE.utils.clock().getElapsedTime(),iStep:0,fWidthStart:this.emitter.group.fTrailWidthStart,fWidthEnd:this.emitter.group.fTrailWidthEnd,shaderColor:new THREE.Vector4(1,1,1,1),shaderTexture:this.emitter.group.textureTrail,shaderTexMode:"Stretch",shaderBlending:this.emitter.group.blending,shaderTransparent:this.emitter.group.transparent,shaderAlphaTest:this.emitter.group.alphaTest,shaderDepthWrite:this.emitter.group.depthWrite,shaderDepthTest:this.emitter.group.depthTest},(function(){})),this.uuidTrial=this.trailRenderHelper.attach((function(e){}))),this}console.error("[MSPE.js] : [MSPE.Particle] : error options.emitter;")},MSPE.Particle.constructor=MSPE.Particle,MSPE.Particle.prototype.onTriggerMeshInited=function(e){this.meshTrial=e},MSPE.Particle.prototype._createGetterSetters=function(e,t){"use strict";var i=this;for(var r in e)if(e.hasOwnProperty(r)){var n=r.replace("_","");Object.defineProperty(e,n,{get:function(e){return function(){return this[e]}}(r),set:function(e){return function(r){var n=i.updateMap[t],o=this[e],s=MSPE.valueOverLifetimeLength;"_rotationCenter"===e?(i.updateFlags.rotationCenter=!0,i.updateCounts.rotationCenter=0):"_randomise"===e?i.resetFlags[n]=r:(i.updateFlags[n]=!0,i.updateCounts[n]=0),this[e]=r,Array.isArray(o)&&MSPE.utils.ensureValueOverLifetimeCompliance(i[t],s,s)}}(r)})}},MSPE.Particle.prototype.tick=function(e,t){"use strict";if(!this.emitter.isStatic){if(!1!==this.emitter.alive&&!1!==this.alive)return null!==this.emitter.duration&&this.age>this.emitter.duration?(this.alive=!1,void(this.age=0)):(this.age+=e,this.running(t),this.age>this.fRealMaxAge?(this.alive=!1,void(this.age=0)):void 0);this.age=0}},MSPE.Particle.prototype._assignPositionValue=function(){"use strict";var e=MSPE.distributions,t=MSPE.utils,i=this.position,r=i._value,n=i._spread,o=this.emitter.type,s=new THREE.Vector3(0,0,0);switch(o){case e.BOX:s=t.getRandomVector3(r,n,i._spreadClamp);break;case e.SPHERE:s=t.getRandomVector3OnSphere(r,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x,i._distributionClamp||this.particleCount);break;case e.DISC:s=t.getRandomVector3OnDisc(r,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}return s},MSPE.Particle.prototype._assignVelocityValue=function(){"use strict";var e=this.emitter.group.vec4Quaternion.clone();e=e.normalize();var t=MSPE.distributions,i=MSPE.utils,r=this.velocity,n=r._value,o=r._spread,s=this.emitter.type;this.emitter.bInitSpeed||(n=n.applyQuaternion(e),o=o.applyQuaternion(e),this.emitter.bInitSpeed=!0);var a=new THREE.Vector3(0,0,0);switch(s){case t.BOX:a=i.getRandomVector3(n,o);break;case t.SPHERE:a=i.getRandomDirectionVector3OnSphere(this.emitter.position.value,n.x,o.x);break;case t.DISC:a=i.getRandomVector3OnDisc(n,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x)}return a},MSPE.Particle.prototype._assignAccelerationValue=function(){"use strict";var e=this.emitter.group.vec4Quaternion.clone();e=e.normalize();var t=MSPE.distributions,i=MSPE.utils,r=this.acceleration,n=r._value,o=r._spread,s=this.emitter.type;this.emitter.bInitSpeedAcc||(n=n.applyQuaternion(e),o=o.applyQuaternion(e),this.emitter.bInitSpeedAcc=!0);var a=new THREE.Vector3(0,0,0);switch(s){case t.BOX:a=i.getRandomVector3(n,o);break;case t.SPHERE:a=i.getDirectionVector3OnSphere(this.vec3RealVelocity,this.emitter.position.value,this.emitter.velocity.value.y,this.emitter.velocity.spread.y,n,o);break;case t.DISC:a=i.getRandomVector3OnDisc(n,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x)}return a},MSPE.Particle.prototype._assignColorValue=function(){"use strict";return MSPE.utils.getRandomColor(this.color._value,this.color._spread)},MSPE.Particle.prototype._assignOpacityAbsLifetimeValue=function(){"use strict";var e,t,i=this.opacity,r=MSPE.utils;return t=new Array,r.arrayValuesAreEqual(i._value)&&r.arrayValuesAreEqual(i._spread)?(e=Math.abs(r.randomFloat(i._value[0],i._spread[0])),t.push(e),t.push(e),t.push(e),t.push(e)):(e=Math.abs(r.randomFloat(i._value[0],i._spread[0])),t.push(e),e=Math.abs(r.randomFloat(i._value[1],i._spread[1])),t.push(e),e=Math.abs(r.randomFloat(i._value[2],i._spread[2])),t.push(e),e=Math.abs(r.randomFloat(i._value[3],i._spread[3])),t.push(e)),t},MSPE.Particle.prototype._assignSizeAbsLifetimeValue=function(){"use strict";var e,t,i=this.size,r=MSPE.utils;return t=new Array,r.arrayValuesAreEqual(i._value)&&r.arrayValuesAreEqual(i._spread)?(e=Math.abs(r.randomFloat(i._value[0],i._spread[0])),t.push(e),t.push(e),t.push(e),t.push(e)):(e=Math.abs(r.randomFloat(i._value[0],i._spread[0])),t.push(e),e=Math.abs(r.randomFloat(i._value[1],i._spread[1])),t.push(e),e=Math.abs(r.randomFloat(i._value[2],i._spread[2])),t.push(e),e=Math.abs(r.randomFloat(i._value[3],i._spread[3])),t.push(e)),t},MSPE.Particle.prototype._assignAngleValue=function(){"use strict";var e,t=new Array,i=this.angle,r=MSPE.utils;return r.arrayValuesAreEqual(i._value)&&r.arrayValuesAreEqual(i._spread)?(e=r.randomFloat(i._value[0],i._spread[0]),t.push(e),t.push(e),t.push(e),t.push(e)):(e=r.randomFloat(i._value[0],i._spread[0]),t.push(e),e=r.randomFloat(i._value[1],i._spread[1]),t.push(e),e=r.randomFloat(i._value[2],i._spread[2]),t.push(e),e=r.randomFloat(i._value[3],i._spread[3]),t.push(e)),t},MSPE.Particle.prototype.when_gt=function(e,t){return Math.max(Math.sign(e-t),0)},MSPE.Particle.prototype.when_lt=function(e,t){return Math.min(Math.max(1-Math.sign(e-t),0),1)},MSPE.Particle.prototype.when_eq=function(e,t){return 1-Math.abs(Math.sign(e-t))},MSPE.Particle.prototype.when_ge=function(e,t){return 1-this.when_lt(e,t)},MSPE.Particle.prototype.when_le=function(e,t){return 1-this.when_gt(e,t)},MSPE.Particle.prototype.and=function(e,t){return e*t},MSPE.Particle.prototype.or=function(e,t){return Math.min(e+t,1)},MSPE.Particle.prototype.getFloatOverLifetime=function(e,t){var i=0,r=e*(MSPE.valueOverLifetimeLength-1),n=0;i+=t[0]*this.when_eq(r,0);for(var o=0;o<MSPE.valueOverLifetimeLength-1;++o)n=o,i+=this.and(this.when_gt(r,n),this.when_le(r,n+1))*MSPE.utils.lerp(t[o],t[o+1],r-n);return i},MSPE.Particle.prototype.getColorOverLifetime=function(e,t,i,r,n){var o=new THREE.Vector3(0,0,0),s=new Array;s.push(t.r),s.push(i.r),s.push(r.r),s.push(n.r);var a=new Array;a.push(t.g),a.push(i.g),a.push(r.g),a.push(n.g);var l=new Array;return l.push(t.b),l.push(i.b),l.push(r.b),l.push(n.b),o.x=this.getFloatOverLifetime(e,s),o.y=this.getFloatOverLifetime(e,a),o.z=this.getFloatOverLifetime(e,l),o},MSPE.Particle.prototype.getRotation=function(e,t,i){if(0==this.fRealRotationAngle)return e;var r=MSPE._vec3_3.copy(this.vec3RealRotationAxis),n=MSPE._vec3_4.copy(this.rotation._center),o=MSPE._mat4_2,s=n.sub(e),a=0;return a+=this.when_eq(this.rotation._static?0:1,0)*this.fRealRotationAngle,a+=this.when_gt(this.rotation._static?0:1,0)*MSPE.utils.lerp(0,this.fRealRotationAngle,t),r.normalize(),o.makeRotationAxis(r,a),s.applyMatrix4(o),n.sub(s),i.copy(n),i},MSPE.Particle.prototype.running=function(e){var t=this.age,i=this.age/this.fRealMaxAge,r=MSPE._vec3_1.copy(this.vec3RealAcceleration);if(this.emitter.SHOULD_DRAG_PARTICLES){var n=1-.5*i*this.fRealDrag;r=r.multiplyScalar(n)}var o=MSPE._vec3_2.copy(this.vec3RealVelocity).multiplyScalar(t),s=r.multiplyScalar(t*t*.5);if(o.add(this.vec3RealPosition).add(s),this.emitter.SHOULD_WIGGLE_PARTICLES){var a=i*this.fRealWiggle*Math.PI,l=Math.sin(a),u=Math.cos(a);o.x+=l,o.y+=u,o.z+=l}if(this.emitter.SHOULD_ROTATE_PARTICLES&&this.getRotation(o,i,o),this.vec3Position.copy(o),this.emitter.SHOULD_SIZE_PARTICLES){var c=this.getFloatOverLifetime(i,this.arrayRealSize);this.vec3Scale.set(c,c,c)}if(this.emitter.isLookAtCamera||this.emitter.isLookAtCameraOnlyY){if(this.emitter.isLookAtCamera)this.vec3Rotation.setFromQuaternion(e.quaternion);else if(this.emitter.isLookAtCameraOnlyY){var h=MSPE._mat4_1,p=MSPE._vec3_1,d=MSPE._vec3_2,f=MSPE._quat_1;h.getInverse(this.emitter.group.mesh.matrixWorld),h.multiply(e.matrixWorld),p.setFromMatrixPosition(h),d.copy(this.vec3Position).sub(p),d.y=0,f.setFromUnitVectors(p.set(0,0,-1),d.normalize()),this.vec3Rotation.setFromQuaternion(f)}}else if(this.emitter.SHOULD_ANGLE_PARTICLES){var m=this.getFloatOverLifetime(i,this.arrayRealAngle);this.vec3Rotation.set(m,m,m)}if(this.emitter.group.bEnableTrail){var g=MSPE.utils.clock().getElapsedTime();this.trailRenderHelper.tick({uuid:this.uuidTrial,timeNow:g,position:this.vec3Position,rotation:this.vec3Rotation})}if(MSPE.utils.setMatrix(this.vec3Position,this.vec3Rotation,this.vec3Scale,this.matrix),this.emitter.group.mcol0.setXYZ(this.iBufferIndex,this.matrixElements[0],this.matrixElements[1],this.matrixElements[2]),this.emitter.group.mcol1.setXYZ(this.iBufferIndex,this.matrixElements[4],this.matrixElements[5],this.matrixElements[6]),this.emitter.group.mcol2.setXYZ(this.iBufferIndex,this.matrixElements[8],this.matrixElements[9],this.matrixElements[10]),this.emitter.group.mcol3.setXYZ(this.iBufferIndex,this.matrixElements[12],this.matrixElements[13],this.matrixElements[14]),this.emitter.SHOULD_COLORIZE_PARTICLES){var v=this.getColorOverLifetime(i,this.arrayRealColor[0],this.arrayRealColor[1],this.arrayRealColor[2],this.arrayRealColor[3]),y=this.getFloatOverLifetime(i,this.arrayRealOpacity);this.emitter.group.bEnableTrail&&null!=this.trailRenderHelper&&null!=this.trailRenderHelper&&this.trailRenderHelper.updateColor({r:v.x,g:v.y,b:v.z,a:y}),this.emitter.group.colors.setXYZW(this.iBufferIndex,v.x,v.y,v.z,y)}},MSPE.Particle.prototype.dispose=function(){"use strict";this.emitter.group.bEnableTrail&&(this.trailRenderHelper.detach(this.uuidTrial),this.trailRenderHelper.dispose(),this.meshTrial&&this.meshTrial.parent&&this.meshTrial.parent.remove(this.meshTrial)),null!=this.obj&&null!=this.obj&&this.obj.setUse(!1)},MSPE.BufferAttributeObjPool=function(e){"use strict";var t=MSPE.utils,i=t.types;if(null!=(e=t.ensureTypedArg(e,i.OBJECT,{})).iCount&&null!=e.iCount&&"number"==typeof e.iCount){this.iCount=e.iCount,this.objPool=new Array;for(var r=0;r<this.iCount;r++){var n=new MSPE.BufferAttributeObj({iIndex:r});this.objPool.push(n)}}else console.error("[MSPE] : [BufferAttributeObjPool] : error options.iCount;")},MSPE.BufferAttributeObjPool.constructor=MSPE.BufferAttributeObjPool,MSPE.BufferAttributeObjPool.prototype.setUse=function(e,t){"use strict";null!=e&&null!=e&&"number"==typeof e?e+1>this.objPool.length?console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error iIndex; iIndex = "+e+"; while this.objPool.length = "+this.objPool.length):null!=t&&null!=t&&"boolean"==typeof t?this.objPool[e].setUse(t):console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error bU;"):console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error iIndex;")},MSPE.BufferAttributeObjPool.prototype.getUse=function(e){"use strict";if(null!=e&&null!=e&&"number"==typeof e){if(!(e+1>this.objPool.length))return this.objPool[e].getUse();console.error("[MSPE] : [BufferAttributeObjPool] : [getUse] : error iIndex; iIndex = "+e+"; while this.objPool.length = "+this.objPool.length)}else console.error("[MSPE] : [BufferAttributeObjPool] : [getUse] : error iIndex;")},MSPE.BufferAttributeObjPool.prototype.takeAnObj=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)if(!this.objPool[e].getUse())return this.objPool[e];return null},MSPE.BufferAttributeObjPool.prototype.reset=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)this.objPool[e].setUse(!1)},MSPE.BufferAttributeObjPool.prototype.dispose=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)this.objPool[e].dispose()},MSPE.BufferAttributeObj=function(e){"use strict";var t=MSPE.utils,i=t.types;null!=(e=t.ensureTypedArg(e,i.OBJECT,{})).iIndex&&null!=e.iIndex&&"number"==typeof e.iIndex?(this.iIndex=e.iIndex,this.bUsed=!1):console.error("[MSPE] : [BufferAttributeObj] : error options.iIndex;")},MSPE.BufferAttributeObj.constructor=MSPE.BufferAttributeObj,MSPE.BufferAttributeObj.prototype.setUse=function(e){"use strict";this.bUsed=e},MSPE.BufferAttributeObj.prototype.getUse=function(){"use strict";return this.bUsed},MSPE.BufferAttributeObj.prototype.dispose=function(){},function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).poly2tri=e()}}((function(){return function e(t,i,r){function n(s,a){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[s]={exports:{}};t[s][0].call(c.exports,(function(e){return n(t[s][1][e]||e)}),c,c.exports,e,t,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(e,t,i){t.exports={version:"1.5.0"}},{}],2:[function(e,t,i){"use strict";var r=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};r.prototype.head=function(){return this.head_},r.prototype.setHead=function(e){this.head_=e},r.prototype.tail=function(){return this.tail_},r.prototype.setTail=function(e){this.tail_=e},r.prototype.search=function(){return this.search_node_},r.prototype.setSearch=function(e){this.search_node_=e},r.prototype.findSearchNode=function(){return this.search_node_},r.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},r.prototype.locatePoint=function(e){var t=e.x,i=this.findSearchNode(t),r=i.point.x;if(t===r){if(e!==i.point)if(e===i.prev.point)i=i.prev;else{if(e!==i.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");i=i.next}}else if(t<r)for(;(i=i.prev)&&e!==i.point;);else for(;(i=i.next)&&e!==i.point;);return i&&(this.search_node_=i),i},t.exports=r,t.exports.Node=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x}},{}],3:[function(e,t,i){"use strict";t.exports=function(e,t){if(!e)throw new Error(t||"Assert Failed")}},{}],4:[function(e,t,i){"use strict";var r=e("./xy"),n=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};n.prototype.toString=function(){return r.toStringBase(this)},n.prototype.toJSON=function(){return{x:this.x,y:this.y}},n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.set_zero=function(){return this.x=0,this.y=0,this},n.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},n.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},n.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},n.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},n.prototype.mul=function(e){return this.x*=e,this.y*=e,this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},n.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},n.negate=function(e){return new n(-e.x,-e.y)},n.add=function(e,t){return new n(e.x+t.x,e.y+t.y)},n.sub=function(e,t){return new n(e.x-t.x,e.y-t.y)},n.mul=function(e,t){return new n(e*t.x,e*t.y)},n.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new n(-e*t.y,e*t.x):"number"==typeof t?new n(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},n.toString=r.toString,n.compare=r.compare,n.cmp=r.compare,n.equals=r.equals,n.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=n},{"./xy":11}],5:[function(e,t,i){"use strict";var r=e("./xy"),n=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var i=0;i<t.length;i++)this.message+=" "+r.toString(t[i])};(n.prototype=new Error).constructor=n,t.exports=n},{"./xy":11}],6:[function(e,t,i){(function(t){"use strict";var r=t.poly2tri;i.noConflict=function(){return t.poly2tri=r,i},i.VERSION=e("../dist/version.json").version,i.PointError=e("./pointerror"),i.Point=e("./point"),i.Triangle=e("./triangle"),i.SweepContext=e("./sweepcontext");var n=e("./sweep");i.triangulate=n.triangulate,i.sweep={Triangulate:n.triangulate}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,i){"use strict";function r(e,t){var i=e.locateNode(t),r=function(e,t,i){var r=new b(t,i.point,i.next.point);r.markNeighbor(i.triangle),e.addToMap(r);var n=new _(t);return n.next=i.next,n.prev=i,i.next.prev=n,i.next=n,l(e,r)||e.mapTriangleToNodes(r),n}(e,t,i);return t.x<=i.point.x+E&&a(e,i),function(e,t){for(var i=t.next;i.next&&!C(i.point,i.next.point,i.prev.point);)a(e,i),i=i.next;for(i=t.prev;i.prev&&!C(i.point,i.next.point,i.prev.point);)a(e,i),i=i.prev;t.next&&t.next.next&&function(e){var t=e.point.x-e.next.next.point.x,i=e.point.y-e.next.next.point.y;return v(i>=0,"unordered y"),t>=0||Math.abs(t)<i}(t)&&function(e,t){for(T(t.point,t.next.point,t.next.next.point)===w.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,function e(t,i){if(!function(e,t){var i;return i=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>i}(t,i)&&(a(t,i),i.prev!==t.basin.left_node||i.next!==t.basin.right_node)){if(i.prev===t.basin.left_node){if(T(i.point,i.next.point,i.next.next.point)===w.CW)return;i=i.next}else if(i.next===t.basin.right_node){if(T(i.point,i.prev.point,i.prev.prev.point)===w.CCW)return;i=i.prev}else i=i.prev.point.y<i.next.point.y?i.prev:i.next;e(t,i)}}(e,e.basin.bottom_node))}}(e,t)}(e,r),r}function n(e,t,i){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,s(i.triangle,t.p,t.q)||(function(e,t,i){e.edge_event.right?function(e,t,i){for(;i.next.point.x<t.p.x;)T(t.q,i.next.point,t.p)===w.CCW?h(e,t,i):i=i.next}(e,t,i):function(e,t,i){for(;i.prev.point.x>t.p.x;)T(t.q,i.prev.point,t.p)===w.CW?d(e,t,i):i=i.prev}(e,t,i)}(e,t,i),o(e,t.p,t.q,i.triangle,t.q))}function o(e,t,i,r,n){if(!s(r,t,i)){var a=r.pointCCW(n),l=T(i,a,t);if(l===w.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[i,a,t]);var u=r.pointCW(n),c=T(i,u,t);if(c===w.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[i,u,t]);l===c?o(e,t,i,r=l===w.CW?r.neighborCCW(n):r.neighborCW(n),n):m(e,t,i,r,n)}}function s(e,t,i){var r=e.edgeIndex(t,i);if(-1!==r){e.markConstrainedEdgeByIndex(r);var n=e.getNeighbor(r);return n&&n.markConstrainedEdgeByPoints(t,i),!0}return!1}function a(e,t){var i=new b(t.prev.point,t.point,t.next.point);i.markNeighbor(t.prev.triangle),i.markNeighbor(t.triangle),e.addToMap(i),t.prev.next=t.next,t.next.prev=t.prev,l(e,i)||e.mapTriangleToNodes(i)}function l(e,t){for(var i=0;i<3;++i)if(!t.delaunay_edge[i]){var r=t.getNeighbor(i);if(r){var n=t.getPoint(i),o=r.oppositePoint(t,n),s=r.index(o);if(r.constrained_edge[s]||r.delaunay_edge[s]){t.constrained_edge[i]=r.constrained_edge[s];continue}if(u(n,t.pointCCW(n),t.pointCW(n),o)){t.delaunay_edge[i]=!0,r.delaunay_edge[s]=!0,c(t,n,r,o);var a=!l(e,t);return a&&e.mapTriangleToNodes(t),(a=!l(e,r))&&e.mapTriangleToNodes(r),t.delaunay_edge[i]=!1,r.delaunay_edge[s]=!1,!0}}}return!1}function u(e,t,i,r){var n=e.x-r.x,o=e.y-r.y,s=t.x-r.x,a=t.y-r.y,l=n*a-s*o;if(l<=0)return!1;var u=i.x-r.x,c=i.y-r.y,h=u*o-n*c;return!(h<=0)&&(n*n+o*o)*(s*c-u*a)+(s*s+a*a)*h+(u*u+c*c)*l>0}function c(e,t,i,r){var n,o,s,a,l,u,c,h,p,d,f,m;n=e.neighborCCW(t),o=e.neighborCW(t),s=i.neighborCCW(r),a=i.neighborCW(r),l=e.getConstrainedEdgeCCW(t),u=e.getConstrainedEdgeCW(t),c=i.getConstrainedEdgeCCW(r),h=i.getConstrainedEdgeCW(r),p=e.getDelaunayEdgeCCW(t),d=e.getDelaunayEdgeCW(t),f=i.getDelaunayEdgeCCW(r),m=i.getDelaunayEdgeCW(r),e.legalize(t,r),i.legalize(r,t),i.setDelaunayEdgeCCW(t,p),e.setDelaunayEdgeCW(t,d),e.setDelaunayEdgeCCW(r,f),i.setDelaunayEdgeCW(r,m),i.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,u),e.setConstrainedEdgeCCW(r,c),i.setConstrainedEdgeCW(r,h),e.clearNeighbors(),i.clearNeighbors(),n&&i.markNeighbor(n),o&&e.markNeighbor(o),s&&e.markNeighbor(s),a&&i.markNeighbor(a),e.markNeighbor(i)}function h(e,t,i){i.point.x<t.p.x&&(T(i.point,i.next.point,i.next.next.point)===w.CCW?p(e,t,i):(function e(t,i,r){T(r.next.point,r.next.next.point,r.next.next.next.point)===w.CCW?p(t,i,r.next):T(i.q,r.next.next.point,i.p)===w.CCW&&e(t,i,r.next)}(e,t,i),h(e,t,i)))}function p(e,t,i){a(e,i.next),i.next.point!==t.p&&T(t.q,i.next.point,t.p)===w.CCW&&T(i.point,i.next.point,i.next.next.point)===w.CCW&&p(e,t,i)}function d(e,t,i){i.point.x>t.p.x&&(T(i.point,i.prev.point,i.prev.prev.point)===w.CW?f(e,t,i):(function e(t,i,r){T(r.prev.point,r.prev.prev.point,r.prev.prev.prev.point)===w.CW?f(t,i,r.prev):T(i.q,r.prev.prev.point,i.p)===w.CW&&e(t,i,r.prev)}(e,t,i),d(e,t,i)))}function f(e,t,i){a(e,i.prev),i.prev.point!==t.p&&T(t.q,i.prev.point,t.p)===w.CW&&T(i.point,i.prev.point,i.prev.prev.point)===w.CW&&f(e,t,i)}function m(e,t,i,r,n){var s=r.neighborAcross(n);v(s,"FLIP failed due to missing triangle!");var a=s.oppositePoint(r,n);if(r.getConstrainedEdgeAcross(n)){var u=r.index(n);throw new y("poly2tri Intersecting Constraints",[n,a,r.getPoint((u+1)%3),r.getPoint((u+2)%3)])}if(M(n,r.pointCCW(n),r.pointCW(n),a))if(c(r,n,s,a),e.mapTriangleToNodes(r),e.mapTriangleToNodes(s),n===i&&a===t)i===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(r.markConstrainedEdgeByPoints(t,i),s.markConstrainedEdgeByPoints(t,i),l(e,r),l(e,s));else{r=function(e,t,i,r,n,o){var s;return t===w.CCW?(s=r.edgeIndex(n,o),r.delaunay_edge[s]=!0,l(e,r),r.clearDelaunayEdges(),i):(s=i.edgeIndex(n,o),i.delaunay_edge[s]=!0,l(e,i),i.clearDelaunayEdges(),r)}(e,T(i,a,t),r,s,n,a),m(e,t,i,r,n)}else(function e(t,i,r,n,o,s){var a=o.neighborAcross(s);v(a,"FLIP failed due to missing triangle");var l=a.oppositePoint(o,s);M(r,n.pointCCW(r),n.pointCW(r),l)?m(t,r,l,a,l):e(t,i,r,n,a,g(i,r,a,l))})(e,t,i,r,s,g(t,i,s,a)),o(e,t,i,r,n)}function g(e,t,i,r){var n=T(t,r,e);if(n===w.CW)return i.pointCCW(r);if(n===w.CCW)return i.pointCW(r);throw new y("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,r,e])}var v=e("./assert"),y=e("./pointerror"),b=e("./triangle"),_=e("./advancingfront").Node,x=e("./utils"),E=x.EPSILON,w=x.Orientation,T=x.orient2d,M=x.inScanArea,C=x.isAngleObtuse;i.triangulate=function(e){e.initTriangulation(),e.createAdvancingFront(),function(e){var t,i=e.pointCount();for(t=1;t<i;++t)for(var o=e.getPoint(t),s=r(e,o),a=o._p2t_edge_list,l=0;a&&l<a.length;++l)n(e,a[l],s)}(e),function(e){for(var t=e.front().head().next.triangle,i=e.front().head().next.point;!t.getConstrainedEdgeCW(i);)t=t.neighborCCW(i);e.meshClean(t)}(e)}},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,i){"use strict";var r=e("./pointerror"),n=e("./point"),o=e("./triangle"),s=e("./sweep"),a=e("./advancingfront"),l=a.Node,u=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new r("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},c=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};c.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var h=function(){this.constrained_edge=null,this.right=!1},p=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new c,this.edge_event=new h,this.initEdges(this.points_)};p.prototype.addHole=function(e){this.initEdges(e);var t,i=e.length;for(t=0;t<i;t++)this.points_.push(e[t]);return this},p.prototype.AddHole=p.prototype.addHole,p.prototype.addHoles=function(e){var t,i=e.length;for(t=0;t<i;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},p.prototype.addPoint=function(e){return this.points_.push(e),this},p.prototype.AddPoint=p.prototype.addPoint,p.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},p.prototype.triangulate=function(){return s.triangulate(this),this},p.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},p.prototype.getTriangles=function(){return this.triangles_},p.prototype.GetTriangles=p.prototype.getTriangles,p.prototype.front=function(){return this.front_},p.prototype.pointCount=function(){return this.points_.length},p.prototype.head=function(){return this.head_},p.prototype.setHead=function(e){this.head_=e},p.prototype.tail=function(){return this.tail_},p.prototype.setTail=function(e){this.tail_=e},p.prototype.getMap=function(){return this.map_},p.prototype.initTriangulation=function(){var e,t=this.points_[0].x,i=this.points_[0].x,r=this.points_[0].y,o=this.points_[0].y,s=this.points_.length;for(e=1;e<s;e++){var a=this.points_[e];a.x>t&&(t=a.x),a.x<i&&(i=a.x),a.y>r&&(r=a.y),a.y<o&&(o=a.y)}this.pmin_=new n(i,o),this.pmax_=new n(t,r);var l=.3*(t-i),u=.3*(r-o);this.head_=new n(t+l,o-u),this.tail_=new n(i-l,o-u),this.points_.sort(n.compare)},p.prototype.initEdges=function(e){var t,i=e.length;for(t=0;t<i;++t)this.edge_list.push(new u(e[t],e[(t+1)%i]))},p.prototype.getPoint=function(e){return this.points_[e]},p.prototype.addToMap=function(e){this.map_.push(e)},p.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},p.prototype.createAdvancingFront=function(){var e,t,i,r=new o(this.points_[0],this.tail_,this.head_);this.map_.push(r),e=new l(r.getPoint(1),r),t=new l(r.getPoint(0),r),i=new l(r.getPoint(2)),this.front_=new a(e,i),e.next=t,t.next=i,t.prev=e,i.prev=t},p.prototype.removeNode=function(e){},p.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var i=this.front_.locatePoint(e.pointCW(e.getPoint(t)));i&&(i.triangle=e)}},p.prototype.removeFromMap=function(e){var t,i=this.map_,r=i.length;for(t=0;t<r;t++)if(i[t]===e){i.splice(t,1);break}},p.prototype.meshClean=function(e){for(var t,i,r=[e];t=r.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),i=0;i<3;i++)t.constrained_edge[i]||r.push(t.getNeighbor(i))},t.exports=p},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,i){"use strict";var r=function(e,t,i){this.points_=[e,t,i],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},n=e("./xy").toString;r.prototype.toString=function(){return"["+n(this.points_[0])+n(this.points_[1])+n(this.points_[2])+"]"},r.prototype.getPoint=function(e){return this.points_[e]},r.prototype.GetPoint=r.prototype.getPoint,r.prototype.getPoints=function(){return this.points_},r.prototype.getNeighbor=function(e){return this.neighbors_[e]},r.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},r.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},r.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},r.prototype.isInterior=function(){return this.interior_},r.prototype.setInterior=function(e){return this.interior_=e,this},r.prototype.markNeighborPointers=function(e,t,i){var r=this.points_;if(e===r[2]&&t===r[1]||e===r[1]&&t===r[2])this.neighbors_[0]=i;else if(e===r[0]&&t===r[2]||e===r[2]&&t===r[0])this.neighbors_[1]=i;else{if(!(e===r[0]&&t===r[1]||e===r[1]&&t===r[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=i}},r.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},r.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},r.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},r.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},r.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},r.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},r.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},r.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},r.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},r.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},r.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},r.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},r.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},r.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},r.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},r.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},r.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},r.prototype.oppositePoint=function(e,t){var i=e.pointCW(t);return this.pointCW(i)},r.prototype.legalize=function(e,t){var i=this.points_;if(e===i[0])i[1]=i[0],i[0]=i[2],i[2]=t;else if(e===i[1])i[2]=i[1],i[1]=i[0],i[0]=t;else{if(e!==i[2])throw new Error("poly2tri Invalid Triangle.legalize() call");i[0]=i[2],i[2]=i[1],i[1]=t}},r.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},r.prototype.edgeIndex=function(e,t){var i=this.points_;if(e===i[0]){if(t===i[1])return 2;if(t===i[2])return 1}else if(e===i[1]){if(t===i[2])return 0;if(t===i[0])return 2}else if(e===i[2]){if(t===i[0])return 1;if(t===i[1])return 0}return-1},r.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},r.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},r.prototype.markConstrainedEdgeByPoints=function(e,t){var i=this.points_;t===i[0]&&e===i[1]||t===i[1]&&e===i[0]?this.constrained_edge[2]=!0:t===i[0]&&e===i[2]||t===i[2]&&e===i[0]?this.constrained_edge[1]=!0:(t===i[1]&&e===i[2]||t===i[2]&&e===i[1])&&(this.constrained_edge[0]=!0)},t.exports=r},{"./xy":11}],10:[function(e,t,i){"use strict";var r=1e-12;i.EPSILON=r;var n={CW:1,CCW:-1,COLLINEAR:0};i.Orientation=n,i.orient2d=function(e,t,i){var o=(e.x-i.x)*(t.y-i.y)-(e.y-i.y)*(t.x-i.x);return o>-r&&o<r?n.COLLINEAR:o>0?n.CCW:n.CW},i.inScanArea=function(e,t,i,n){return!((e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)>=-r||(e.x-i.x)*(n.y-i.y)-(n.x-i.x)*(e.y-i.y)<=r)},i.isAngleObtuse=function(e,t,i){var r=t.x-e.x,n=t.y-e.y;return r*(i.x-e.x)+n*(i.y-e.y)<0}},{}],11:[function(e,t,i){"use strict";function r(e){return"("+e.x+";"+e.y+")"}t.exports={toString:function(e){var t=e.toString();return"[object Object]"===t?r(e):t},toStringBase:r,compare:function(e,t){return e.y===t.y?e.x-t.x:e.y-t.y},equals:function(e,t){return e.x===t.x&&e.y===t.y}}},{}]},{},[6])(6)})),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).polylabel=e()}}((function(){return function e(t,i,r){function n(s,a){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[s]={exports:{}};t[s][0].call(c.exports,(function(e){var i=t[s][1][e];return n(i||e)}),c,c.exports,e,t,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(e,t,i){"use strict";var r=e("tinyqueue");function n(e,t,i=1e-4){return Math.abs(e-t)<i}function o(e,t,i){var o,l,u,c;t=t||1;for(var h=0;h<e[0].length;h++){var p=e[0][h];(!h||p[0]<o)&&(o=p[0]),(!h||p[1]<l)&&(l=p[1]),(!h||p[0]>u)&&(u=p[0]),(!h||p[1]>c)&&(c=p[1])}var d=n(u,o,1e-4)?0:u-o,f=n(c,l,1e-4)?0:c-l,m=Math.min(d,f),g=m/2,v=new r(null,s);if(0===m)return[o,l];for(var y=o;y<u;y+=m)for(var b=l;b<c;b+=m)v.push(new a(y+g,b+g,g,e));var _=function(e){for(var t=0,i=0,r=0,n=e[0],o=0,s=n.length,l=s-1;o<s;l=o++){var u=n[o],c=n[l],h=u[0]*c[1]-c[0]*u[1];i+=(u[0]+c[0])*h,r+=(u[1]+c[1])*h,t+=3*h}return 0===t?new a(n[0][0],n[0][1],0,e):new a(i/t,r/t,0,e)}(e),x=new a(o+d/2,l+f/2,0,e);x.d>_.d&&(_=x);for(var E=v.length;v.length;){var w=v.pop();w.d>_.d&&(_=w,i&&console.log("found best %d after %d probes",Math.round(1e4*w.d)/1e4,E)),w.max-_.d<=t||(g=w.h/2,v.push(new a(w.x-g,w.y-g,g,e)),v.push(new a(w.x+g,w.y-g,g,e)),v.push(new a(w.x-g,w.y+g,g,e)),v.push(new a(w.x+g,w.y+g,g,e)),E+=4)}return i&&(console.log("num probes: "+E),console.log("best distance: "+_.d)),[_.x,_.y]}function s(e,t){return t.max-e.max}function a(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=function(e,t,i){for(var r=!1,n=1/0,o=0;o<i.length;o++)for(var s=i[o],a=0,u=s.length,c=u-1;a<u;c=a++){var h=s[a],p=s[c];h[1]>t!=p[1]>t&&e<(p[0]-h[0])*(t-h[1])/(p[1]-h[1])+h[0]&&(r=!r),n=Math.min(n,l(e,t,h,p))}return(r?1:-1)*Math.sqrt(n)}(e,t,r),this.max=this.d+this.h*Math.SQRT2}function l(e,t,i,r){var n=i[0],o=i[1],s=r[0]-n,a=r[1]-o;if(0!==s||0!==a){var l=((e-n)*s+(t-o)*a)/(s*s+a*a);l>1?(n=r[0],o=r[1]):l>0&&(n+=s*l,o+=a*l)}return(s=e-n)*s+(a=t-o)*a}t.exports=o,t.exports.default=o},{tinyqueue:2}],2:[function(e,t,i){"use strict";function r(e,t){if(!(this instanceof r))return new r(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||n,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function n(e,t){return e<t?-1:e>t?1:0}t.exports=r,t.exports.default=r,r.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,i=this.compare,r=t[e];e>0;){var n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r},_down:function(e){for(var t=this.data,i=this.compare,r=this.length>>1,n=t[e];e<r;){var o=1+(e<<1),s=o+1,a=t[o];if(s<this.length&&i(t[s],a)<0&&(o=s,a=t[s]),i(a,n)>=0)break;t[e]=a,e=o}t[e]=n}}},{}]},{},[1])(1)})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).richtextparser={})}(this,(function(e){"use strict";var t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),r=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},o=/\s*\/\s*>\s*$/m,s=function(e){throw new Error("Must implement the method "+(e||""))},a=function(){function e(i){t(this,e),(i=i||{}).scanner&&(this.scanner=i.scanner,i.scanner=null),this.options=Object.assign({},e.defaults,i)}return i(e,[{key:"parse",value:function(e){for(var t=!1,i=void 0,r=void 0,n=void 0;e.length;)"\x3c!--"===e.substring(0,4)?-1!==(i=e.indexOf("--\x3e"))?(this.scanner.comment(e.substring(4,i)),e=e.substring(i+3),t=!1):t=!0:"</"===e.substring(0,2)?(r=this.endTagRe.exec(e))?(e=RegExp.rightContext,t=!1,this.parseEndTag(RegExp.lastMatch,r[1])):t=!0:"<"===e.charAt(0)&&((r=this.startTagRe.exec(e))?(e=RegExp.rightContext,t=!1,this.parseStartTag(RegExp.lastMatch,r[1],r)):t=!0),t&&(0===(i=e.indexOf("<"))&&(i=e.substring(1).indexOf("<")),-1===i?(n=e,e=""):(n=e.substring(0,i),e=e.substring(i)),this.options.ignoreWhitespaceText&&/^\s*$/.test(n)||this.scanner.characters(n)),t=!0,r=null}},{key:"parseStartTag",value:function(e,t,i){var r=o.test(e),n=i[2];r&&(n=n.replace(/\s*\/\s*$/,""));var s=this.parseAttributes(t,n);this.scanner.startElement(t,s,r,i[0])}},{key:"parseEndTag",value:function(e,t){this.scanner.endElement(t)}},{key:"parseAttributes",value:function(e,t){var i={};return t.replace(this.attrRe,(function(e,t,r,n,o,s,a,l){i[t]=l||s||n||!0})),i}}]),e}();a.defaults={ignoreWhitespaceText:!1},a.prototype.attrRe=/([^=\s]+)(\s*=\s*(("([^"]*)")|('([^']*)')|[^>\s]+))?/gm,a.prototype.endTagRe=/^<\/([^>\s]+)[^>]*>/m,a.prototype.startTagRe=/^<([^>\s\/]+)((\s+[^=>\s]+(\s*=\s*(("[^"]*")|('[^']*')|[^>\s]+))?)*)\s*\/?\s*>/m,a.prototype.scanner={startElement:function(){s("startElement")},endElement:function(){s("endElement")},characters:function(){s("characters")},comment:function(){s("comment")}};var l=function(){function e(i){var r=i.tagName,n=i.nodeType,o=i.attrs,s=i.textContent,a=i.parentNode,l=i.childNodes;t(this,e),this.tagName=r,this.nodeType=n,this.textContent=s,this.parentNode=a,this.attrs=o,this.childNodes=l||[],1===n&&(o.id&&(this.id=o.id),o.class&&(this.className=o.class))}return i(e,[{key:"appendChild",value:function(e){e&&(e.parentNode=this,this.childNodes.push(e))}},{key:"insertAfter",value:function(e,t){var i=this;if(!t)return this.appendChild(e);this.childNodes.some((function(r,n){if(r===t)return e.parentNode=i,i.childNodes.splice(n,0,e),!0}))}},{key:"insertBefore",value:function(e,t){var i=this;if(!t)return this.appendChild(e);this.childNodes.some((function(r,n){if(r===t)return e.parentNode=i,0===n?i.childNodes.unshift(e):i.childNodes.splice(n-1,0,e),!0}))}},{key:"toJSON",value:function(){var e={tagName:this.tagName,nodeType:this.nodeType};return this.childNodes.length&&(e.childNodes=this.childNodes),this.textContent&&(e.textContent=this.textContent),this.attrs&&(e.attrs=this.attrs),this.id&&(e.id=this.id),this.className&&(e.className=this.className),e}},{key:"getElementsByTagName",value:function(e){}},{key:"getElementsByClassName",value:function(e){}}]),e}(),u=1,c=3,h=8,p=9,d=10,f=function(e){function o(e){t(this,o);var i=n(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return i.id=void 0,i.nodeType=10,i.systemId=e.systemId||"",i.publicId=e.publicId||"",i.name=e.name||"html",i}return r(o,e),i(o,[{key:"toJSON",value:function(){return{tagName:this.tagName,nodeType:this.nodeType,publicId:this.publicId,systemId:this.systemId,name:this.name}}}]),o}(l),m=function(e){function o(){return t(this,o),n(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return r(o,e),i(o,[{key:"getElementById",value:function(e){return e?function t(i){var r=void 0;return i.some((function(i){return 1===i.nodeType&&(r=i.id===e?i:t(i.childNodes))})),r}(this.childNodes):null}}]),o}(l),g=/^\s*<!doctype\s+(html)(\s+public(\s+('[^']+'|"[^"]+"))?(\s+('[^']+'|"[^"]+"))?)?\s*/i,v={doctype:function(e,t,i,r,n){var o=e.path[e.path.length-1],s=g.exec(n)||[],a=new f({tagName:"doctype",nodeType:d,parentNode:o,name:s[1],publicId:s[4]&&s[4].substring(1,s[4].length-1),systemId:s[6]&&s[6].substring(1,s[6].length-1)});o.appendChild(a)},_default:function(e,t,i,r,n){var o=e.path[e.path.length-1],s=new l({tagName:t,nodeType:u,attrs:i,parentNode:o});o.appendChild(s),r||e.path.push(s)},_selfCloseTag:function(e,t,i,r,n){v._default(e,t,i,!0,n)}};v["!doctype"]=v.doctype,["area","base","link","br","hr","col","command","embed","img","input","keygen","meta","param","source","track","wbr"].forEach((function(e){v[e]=v._selfCloseTag}));var y=function(){function e(){t(this,e),this.reset()}return i(e,[{key:"reset",value:function(){this.rootNode=new m({tagName:"document",nodeType:p}),this.path=[this.rootNode]}},{key:"getRootNode",value:function(){return this.rootNode}},{key:"startElement",value:function(e,t,i,r){return e=e.toLowerCase(),v[e]?v[e](this,e,t,i,r):v._default(this,e,t,i,r)}},{key:"endElement",value:function(e){this.path.pop()}},{key:"characters",value:function(e){if(!/^\s*$/.test(e)){var t=this.path[this.path.length-1],i=new l({tagName:"text",nodeType:c,textContent:e,parentNode:t});t.appendChild(i)}}},{key:"comment",value:function(e){var t=this.path[this.path.length-1],i=new l({tagName:"comment",nodeType:h,textContent:e,parentNode:t});t.appendChild(i)}}]),e}(),b=function(e){function o(e){return t(this,o),(e=e||{}).scanner||(e.scanner=new y),n(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e))}return r(o,e),i(o,[{key:"parse",value:function(e){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0})(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"parse",this).call(this,e);var t=this.scanner.getRootNode();return this.scanner.reset(),t}}]),o}(a),_=function(){function e(i){t(this,e),this.texts=[]}return i(e,[{key:"getWidth",value:function(e){for(var t=0,i=0;i<this.texts.length;i++){t+=this.texts[i].getWidth(e)}return t}},{key:"addText",value:function(e){this.texts.push(e)}},{key:"getAllTextsContent",value:function(){for(var e="",t=0;t<this.texts.length;t++){e+=this.texts[t].content}return e}},{key:"draw",value:function(e,t,i){for(var r=0,n=0;n<this.texts.length;n++){var o=this.texts[n];0!==n&&(r+=this.texts[n-1].getWidth(e)),o.draw(e,t+r,i)}}}]),e}(),x=function(){function e(i){t(this,e),this.node=i,this.key=null,this.value=null,this._parse(i)}return i(e,[{key:"_parse",value:function(e){if(-1!==e.tagName.indexOf("color")){this.key="color";var t=e.tagName.split("=");t.length>0&&(this.value=t[1])}else if(-1!==e.tagName.indexOf("b"))this.key="b";else if(-1!==e.tagName.indexOf("size")){this.key="size";var i=e.tagName.split("=");i.length>0&&(this.value=i[1])}else-1!==e.tagName.indexOf("i")&&(this.key="i")}},{key:"setContext",value:function(e){if("color"===this.key)e.fillStyle=this.value;else if("b"===this.key){var t=e.font;t="bolder "+t,e.font=t}else if("size"===this.key){for(var i=e.font.split(" "),r="",n=0;n<i.length;n++){-1!==i[n].indexOf("px")&&(i[n]=3*this.value+"px"),r+=" "+i[n]}e.font=r}else if("i"===this.key){var o=e.font;o="italic "+o,e.font=o}}}]),e}(),E=function(){function e(i,r){t(this,e),this.decorations=r,this.content=i}return i(e,[{key:"draw",value:function(e,t,i){e.save();for(var r=0;r<this.decorations.length;r++)this.decorations[r].setContext(e);e.fillText(this.content,t,i),e.restore()}},{key:"getWidth",value:function(e){e.save();for(var t=0;t<this.decorations.length;t++)this.decorations[t].setContext(e);var i=e.measureText(this.content).width;return e.restore(),i}}]),e}(),w=function(){function e(){t(this,e),this.content=null,this.rows=[],this.canvas=null,this.context=null,this.currentRow=null}return i(e,[{key:"parse",value:function(e){this.content=e;var t=(new b).parse(this.content);this._parserNode(t)}},{key:"getSize",value:function(e,t){for(var i=-1,r=t*this.rows.length,n=0;n<this.rows.length;n++){var o=this.rows[n].getWidth(e);o>i&&(i=o)}return{width:i,height:r}}},{key:"draw",value:function(e,t,i,r){for(var n=0;n<this.rows.length;n++){var o=this.rows[n],s=o.getWidth(e);o.draw(e,t-s/2,i+n*r)}}},{key:"_parserNode",value:function(e,t){if(this.currentRow||(this.currentRow=this._creatRow()),t||(t=[]),"text"!==e.tagName)(t=t.slice()).push(new x(e));else{for(var i=e.textContent.split(""),r="",n=0;n<i.length;n++){var o=i[n];"\n"===o?(""!==r&&this.currentRow.addText(new E(r,t)),this.currentRow=this._creatRow(),r=""):r+=o}""!==r&&this.currentRow.addText(new E(r,t))}for(var s=e.childNodes,a=0;a<s.length;a++){var l=s[a];this._parserNode(l,t)}}},{key:"_creatRow",value:function(){var e=new _;return this.rows.push(e),e}}]),e}();e.RichTextParser=w,Object.defineProperty(e,"__esModule",{value:!0})})),SimpleHeatmap.getInstance=function(){var e=null;return function(){return e||(e=new SimpleHeatmap),e}}(),SimpleHeatmap.prototype=Object.assign(Object.create({}),{constructor:SimpleHeatmap,defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},canvas:function(){return this._canvas},data:function(e){return this._data=e,this._dataDirty=!0,this},add:function(e){return this._data.push(e),this._dataDirty=!0,this},clear:function(){return this._data=[],this._dataDirty=!0,this},max:function(e){return this._max!==e&&(this._max=e,this._dataDirty=!0),this},min:function(e){return this._min!==e&&(this._min=e,this._dataDirty=!0),this},setCanvasSize:function(e,t){return this._canvasWidth===e&&this._canvasHeight===t||(this._canvasWidth=this._canvas.width=e,this._canvasHeight=this._canvas.height=t,this._dataDirty=!0),this},setAreaSize:function(e,t){return this._areaWidth===e&&this._areaHeight===t||(this._areaWidth=e,this._areaHeight=t,this._dataDirty=!0),this},alpha:function(e){return this._alpha=e,this},radius:function(e,t){if(t=void 0!==t?t:15,e===this._radius&&t===this._blur)return this;this._radius=e,this._blur=t,this._r=this._radius+this._blur;var i=this._circle,r=this._cirCtx,n=Math.ceil(2*this._r*2);return i.width=i.height=n,r.shadowOffsetX=r.shadowOffsetY=2*this._r*2,r.shadowBlur=2*t,r.shadowColor="black",r.beginPath(),r.arc(-n/2,-n/2,2*e,0,2*Math.PI,!0),r.closePath(),r.fill(),this},gradient:function(e){var t=this._getGradientCode(this._grad),i=this._getGradientCode(e);if(t===i)return this;if(this._grad=Object.assign({},e),this._gradCache[i])return this._gradData=this._gradCache[i],this;var r=this._gradCtx.createLinearGradient(0,0,0,256);for(var n in e)r.addColorStop(+n,e[n]);return this._gradCtx.fillStyle=r,this._gradCtx.fillRect(0,0,1,256),this._gradData=this._gradCtx.getImageData(0,0,1,256).data,this._gradCache[i]=this._gradData,this},draw:function(){0===this._r&&this.radius(this.defaultRadius),this._gradData||this.gradient(this.defaultGradient),this._dataDirty&&this._transformData();var e=this._ctx;e.clearRect(0,0,this._canvasWidth,this._canvasHeight);for(var t,i=0,r=this._transformedData.length;i<r;i++)t=this._transformedData[i],e.globalAlpha=t[2],e.drawImage(this._circle,t[0]-this._r,t[1]-this._r,2*this._r,2*this._r);var n=e.getImageData(0,0,this._canvasWidth,this._canvasHeight);return this._colorize(n.data,this._gradData,this._alpha),e.putImageData(n,0,0),this},_transformData:function(){this._transformedData=[];var e=this._canvasWidth/this._areaWidth,t=this._canvasHeight/this._areaHeight,i=this;this._data.map((function(r){var n=r[0],o=r[1];n=n*e+i._canvasWidth/2,o=o*t+i._canvasHeight/2;var s=Math.min(Math.max((r[2]-i._min)/(i._max-i._min),.05),1);i._transformedData.push([n,o,s])}))},_colorize:function(e,t,i){for(var r,n=0,o=e.length;n<o;n+=4)r=4*e[n+3],i&&0===r||(e[n]=t[r],e[n+1]=t[r+1],e[n+2]=t[r+2],i||(e[n+3]=255))},_getGradientCode:function(e){var t="grad:(";for(var i in e)t+=i+":"+e[i]+",";return t+=")"},_createCanvas:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}}),function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;try{t=window}catch(e){t=self}t.SparkMD5=e()}}((function(e){"use strict";var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(e,t){var i=e[0],r=e[1],n=e[2],o=e[3];r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&n|~r&o)+t[0]-680876936|0)<<7|i>>>25)+r|0)&r|~i&n)+t[1]-389564586|0)<<12|o>>>20)+i|0)&i|~o&r)+t[2]+606105819|0)<<17|n>>>15)+o|0)&o|~n&i)+t[3]-1044525330|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&n|~r&o)+t[4]-176418897|0)<<7|i>>>25)+r|0)&r|~i&n)+t[5]+1200080426|0)<<12|o>>>20)+i|0)&i|~o&r)+t[6]-1473231341|0)<<17|n>>>15)+o|0)&o|~n&i)+t[7]-45705983|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&n|~r&o)+t[8]+1770035416|0)<<7|i>>>25)+r|0)&r|~i&n)+t[9]-1958414417|0)<<12|o>>>20)+i|0)&i|~o&r)+t[10]-42063|0)<<17|n>>>15)+o|0)&o|~n&i)+t[11]-1990404162|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&n|~r&o)+t[12]+1804603682|0)<<7|i>>>25)+r|0)&r|~i&n)+t[13]-40341101|0)<<12|o>>>20)+i|0)&i|~o&r)+t[14]-1502002290|0)<<17|n>>>15)+o|0)&o|~n&i)+t[15]+1236535329|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&o|n&~o)+t[1]-165796510|0)<<5|i>>>27)+r|0)&n|r&~n)+t[6]-1069501632|0)<<9|o>>>23)+i|0)&r|i&~r)+t[11]+643717713|0)<<14|n>>>18)+o|0)&i|o&~i)+t[0]-373897302|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&o|n&~o)+t[5]-701558691|0)<<5|i>>>27)+r|0)&n|r&~n)+t[10]+38016083|0)<<9|o>>>23)+i|0)&r|i&~r)+t[15]-660478335|0)<<14|n>>>18)+o|0)&i|o&~i)+t[4]-405537848|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&o|n&~o)+t[9]+568446438|0)<<5|i>>>27)+r|0)&n|r&~n)+t[14]-1019803690|0)<<9|o>>>23)+i|0)&r|i&~r)+t[3]-187363961|0)<<14|n>>>18)+o|0)&i|o&~i)+t[8]+1163531501|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&o|n&~o)+t[13]-1444681467|0)<<5|i>>>27)+r|0)&n|r&~n)+t[2]-51403784|0)<<9|o>>>23)+i|0)&r|i&~r)+t[7]+1735328473|0)<<14|n>>>18)+o|0)&i|o&~i)+t[12]-1926607734|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r^n^o)+t[5]-378558|0)<<4|i>>>28)+r|0)^r^n)+t[8]-2022574463|0)<<11|o>>>21)+i|0)^i^r)+t[11]+1839030562|0)<<16|n>>>16)+o|0)^o^i)+t[14]-35309556|0)<<23|r>>>9)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r^n^o)+t[1]-1530992060|0)<<4|i>>>28)+r|0)^r^n)+t[4]+1272893353|0)<<11|o>>>21)+i|0)^i^r)+t[7]-155497632|0)<<16|n>>>16)+o|0)^o^i)+t[10]-1094730640|0)<<23|r>>>9)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r^n^o)+t[13]+681279174|0)<<4|i>>>28)+r|0)^r^n)+t[0]-358537222|0)<<11|o>>>21)+i|0)^i^r)+t[3]-722521979|0)<<16|n>>>16)+o|0)^o^i)+t[6]+76029189|0)<<23|r>>>9)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r^n^o)+t[9]-640364487|0)<<4|i>>>28)+r|0)^r^n)+t[12]-421815835|0)<<11|o>>>21)+i|0)^i^r)+t[15]+530742520|0)<<16|n>>>16)+o|0)^o^i)+t[2]-995338651|0)<<23|r>>>9)+n|0,r=((r+=((o=((o+=(r^((i=((i+=(n^(r|~o))+t[0]-198630844|0)<<6|i>>>26)+r|0)|~n))+t[7]+1126891415|0)<<10|o>>>22)+i|0)^((n=((n+=(i^(o|~r))+t[14]-1416354905|0)<<15|n>>>17)+o|0)|~i))+t[5]-57434055|0)<<21|r>>>11)+n|0,r=((r+=((o=((o+=(r^((i=((i+=(n^(r|~o))+t[12]+1700485571|0)<<6|i>>>26)+r|0)|~n))+t[3]-1894986606|0)<<10|o>>>22)+i|0)^((n=((n+=(i^(o|~r))+t[10]-1051523|0)<<15|n>>>17)+o|0)|~i))+t[1]-2054922799|0)<<21|r>>>11)+n|0,r=((r+=((o=((o+=(r^((i=((i+=(n^(r|~o))+t[8]+1873313359|0)<<6|i>>>26)+r|0)|~n))+t[15]-30611744|0)<<10|o>>>22)+i|0)^((n=((n+=(i^(o|~r))+t[6]-1560198380|0)<<15|n>>>17)+o|0)|~i))+t[13]+1309151649|0)<<21|r>>>11)+n|0,r=((r+=((o=((o+=(r^((i=((i+=(n^(r|~o))+t[4]-145523070|0)<<6|i>>>26)+r|0)|~n))+t[11]-1120210379|0)<<10|o>>>22)+i|0)^((n=((n+=(i^(o|~r))+t[2]+718787259|0)<<15|n>>>17)+o|0)|~i))+t[9]-343485551|0)<<21|r>>>11)+n|0,e[0]=i+e[0]|0,e[1]=r+e[1]|0,e[2]=n+e[2]|0,e[3]=o+e[3]|0}function r(e){var t,i=[];for(t=0;t<64;t+=4)i[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return i}function n(e){var t,i=[];for(t=0;t<64;t+=4)i[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return i}function o(e){var t,n,o,s,a,l,u=e.length,c=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)i(c,r(e.substring(t-64,t)));for(n=(e=e.substring(t-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(i(c,o),t=0;t<16;t+=1)o[t]=0;return s=(s=8*u).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),l=parseInt(s[1],16)||0,o[14]=a,o[15]=l,i(c,o),c}function s(e){var i,r="";for(i=0;i<4;i+=1)r+=t[e>>8*i+4&15]+t[e>>8*i&15];return r}function a(e){var t;for(t=0;t<e.length;t+=1)e[t]=s(e[t]);return e.join("")}function l(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function u(e){var t,i=[],r=e.length;for(t=0;t<r-1;t+=2)i.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,i)}function c(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==a(o("hello"))&&function(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(i,r){var n,o,s,a,l=this.byteLength,u=t(i,l),c=l;return r!==e&&(c=t(r,l)),u>c?new ArrayBuffer(0):(n=c-u,o=new ArrayBuffer(n),s=new Uint8Array(o),a=new Uint8Array(this,u,n),s.set(a),o)}}(),c.prototype.append=function(e){return this.appendBinary(l(e)),this},c.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,n=this._buff.length;for(t=64;t<=n;t+=64)i(this._hash,r(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},c.prototype.end=function(e){var t,i,r=this._buff,n=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<n;t+=1)o[t>>2]|=r.charCodeAt(t)<<(t%4<<3);return this._finish(o,n),i=a(this._hash),e&&(i=u(i)),this.reset(),i},c.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},c.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},c.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},c.prototype._finish=function(e,t){var r,n,o,s=t;if(e[s>>2]|=128<<(s%4<<3),s>55)for(i(this._hash,e),s=0;s<16;s+=1)e[s]=0;r=(r=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(r[2],16),o=parseInt(r[1],16)||0,e[14]=n,e[15]=o,i(this._hash,e)},c.hash=function(e,t){return c.hashBinary(l(e),t)},c.hashBinary=function(e,t){var i=a(o(e));return t?u(i):i},c.ArrayBuffer=function(){this.reset()},c.ArrayBuffer.prototype.append=function(e){var t,r,o,s,a,l=(r=this._buff.buffer,o=e,s=!0,(a=new Uint8Array(r.byteLength+o.byteLength)).set(new Uint8Array(r)),a.set(new Uint8Array(o),r.byteLength),s?a:a.buffer),u=l.length;for(this._length+=e.byteLength,t=64;t<=u;t+=64)i(this._hash,n(l.subarray(t-64,t)));return this._buff=t-64<u?new Uint8Array(l.buffer.slice(t-64)):new Uint8Array(0),this},c.ArrayBuffer.prototype.end=function(e){var t,i,r=this._buff,n=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<n;t+=1)o[t>>2]|=r[t]<<(t%4<<3);return this._finish(o,n),i=a(this._hash),e&&(i=u(i)),this.reset(),i},c.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.ArrayBuffer.prototype.getState=function(){var e,t=c.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},c.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var i,r=e.length,n=new ArrayBuffer(r),o=new Uint8Array(n);for(i=0;i<r;i+=1)o[i]=e.charCodeAt(i);return t?o:n}(e.buff,!0),c.prototype.setState.call(this,e)},c.ArrayBuffer.prototype.destroy=c.prototype.destroy,c.ArrayBuffer.prototype._finish=c.prototype._finish,c.ArrayBuffer.hash=function(e,t){var r=a(function(e){var t,r,o,s,a,l,u=e.length,c=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)i(c,n(e.subarray(t-64,t)));for(r=(e=t-64<u?e.subarray(t-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(i(c,o),t=0;t<16;t+=1)o[t]=0;return s=(s=8*u).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),l=parseInt(s[1],16)||0,o[14]=a,o[15]=l,i(c,o),c}(new Uint8Array(e)));return t?u(r):r},c}));var SPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};function TextEncoderLite(){}function TextDecoderLite(){}"function"==typeof define&&define.amd?define("spe",SPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=SPE),SPE.TypedArrayHelper=function(e,t,i,r){"use strict";this.componentSize=i||1,this.size=t||1,this.TypedArrayConstructor=e||Float32Array,this.array=new e(t*this.componentSize),this.indexOffset=r||0},SPE.TypedArrayHelper.constructor=SPE.TypedArrayHelper,SPE.TypedArrayHelper.prototype.setSize=function(e,t){"use strict";var i=this.array.length;return t||(e*=this.componentSize),e<i?this.shrink(e):e>i?this.grow(e):void console.info("TypedArray is already of size:",e+".","Will not resize.")},SPE.TypedArrayHelper.prototype.shrink=function(e){"use strict";return this.array=this.array.subarray(0,e),this.size=e,this},SPE.TypedArrayHelper.prototype.grow=function(e){"use strict";var t=this.array,i=new this.TypedArrayConstructor(e);return i.set(t),this.array=i,this.size=e,this},SPE.TypedArrayHelper.prototype.splice=function(e,t){"use strict";e*=this.componentSize,t*=this.componentSize;for(var i=[],r=this.array,n=r.length,o=0;o<n;++o)(o<e||o>=t)&&i.push(r[o]);return this.setFromArray(0,i),this},SPE.TypedArrayHelper.prototype.setFromArray=function(e,t){"use strict";var i=e+t.length;return i>this.array.length?this.grow(i):i<this.array.length&&this.shrink(i),this.array.set(t,this.indexOffset+e),this},SPE.TypedArrayHelper.prototype.setVec2=function(e,t){"use strict";return this.setVec2Components(e,t.x,t.y)},SPE.TypedArrayHelper.prototype.setVec2Components=function(e,t,i){"use strict";var r=this.array,n=this.indexOffset+e*this.componentSize;return r[n]=t,r[n+1]=i,this},SPE.TypedArrayHelper.prototype.setVec3=function(e,t){"use strict";return this.setVec3Components(e,t.x,t.y,t.z)},SPE.TypedArrayHelper.prototype.setVec3Components=function(e,t,i,r){"use strict";var n=this.array,o=this.indexOffset+e*this.componentSize;return n[o]=t,n[o+1]=i,n[o+2]=r,this},SPE.TypedArrayHelper.prototype.setVec4=function(e,t){"use strict";return this.setVec4Components(e,t.x,t.y,t.z,t.w)},SPE.TypedArrayHelper.prototype.setVec4Components=function(e,t,i,r,n){"use strict";var o=this.array,s=this.indexOffset+e*this.componentSize;return o[s]=t,o[s+1]=i,o[s+2]=r,o[s+3]=n,this},SPE.TypedArrayHelper.prototype.setMat3=function(e,t){"use strict";return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},SPE.TypedArrayHelper.prototype.setMat4=function(e,t){"use strict";return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},SPE.TypedArrayHelper.prototype.setColor=function(e,t){"use strict";return this.setVec3Components(e,t.r,t.g,t.b)},SPE.TypedArrayHelper.prototype.setNumber=function(e,t){"use strict";return this.array[this.indexOffset+e*this.componentSize]=t,this},SPE.TypedArrayHelper.prototype.getValueAtIndex=function(e){"use strict";return this.array[this.indexOffset+e]},SPE.TypedArrayHelper.prototype.getComponentValueAtIndex=function(e){"use strict";return this.array.subarray(this.indexOffset+e*this.componentSize)},SPE.ShaderAttribute=function(e,t,i){"use strict";var r=SPE.ShaderAttribute.typeSizeMap;this.type="string"==typeof e&&r.hasOwnProperty(e)?e:"f",this.componentSize=r[this.type],this.arrayType=i||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=!!t,this.updateMin=0,this.updateMax=0},SPE.ShaderAttribute.constructor=SPE.ShaderAttribute,SPE.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16},SPE.ShaderAttribute.prototype.setUpdateRange=function(e,t){"use strict";this.updateMin=Math.min(e*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(t*this.componentSize,this.updateMax*this.componentSize)},SPE.ShaderAttribute.prototype.flagUpdate=function(){"use strict";var e=this.bufferAttribute,t=e.updateRange;t.offset=this.updateMin,t.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length),e.needsUpdate=!0},SPE.ShaderAttribute.prototype.resetUpdateRange=function(){"use strict";this.updateMin=0,this.updateMax=0},SPE.ShaderAttribute.prototype.resetDynamic=function(){"use strict";this.bufferAttribute.setUsage(!0===this.dynamicBuffer?THREE.DynamicDrawUsage:THREE.StaticDrawUsage)},SPE.ShaderAttribute.prototype.splice=function(e,t){"use strict";this.typedArray.splice(e,t),this.forceUpdateAll()},SPE.ShaderAttribute.prototype.forceUpdateAll=function(){"use strict";this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.updateRange.offset=0,this.bufferAttribute.updateRange.count=-1,this.bufferAttribute.setUsage(THREE.StaticDrawUsage),this.bufferAttribute.needsUpdate=!0},SPE.ShaderAttribute.prototype._ensureTypedArray=function(e){"use strict";null!==this.typedArray&&this.typedArray.size===e*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==e?this.typedArray.setSize(e):null===this.typedArray&&(this.typedArray=new SPE.TypedArrayHelper(this.arrayType,e,this.componentSize)))},SPE.ShaderAttribute.prototype._createBufferAttribute=function(e){"use strict";if(this._ensureTypedArray(e),null!==this.bufferAttribute)return this.bufferAttribute.array=this.typedArray.array,parseFloat(THREE.REVISION)>=81&&(this.bufferAttribute.count=this.bufferAttribute.array.length/this.bufferAttribute.itemSize),void(this.bufferAttribute.needsUpdate=!0);this.bufferAttribute=new THREE.BufferAttribute(this.typedArray.array,this.componentSize),this.bufferAttribute.setUsage(!0===this.dynamicBuffer?THREE.DynamicDrawUsage:THREE.StaticDrawUsage)},SPE.ShaderAttribute.prototype.getLength=function(){"use strict";return null===this.typedArray?0:this.typedArray.array.length},SPE.shaderChunks={defines:["#define PACKED_COLOR_SIZE 256.0","#define PACKED_COLOR_DIVISOR 255.0"].join("\n"),uniforms:["uniform float deltaTime;","uniform float runTime;","uniform sampler2D tex;","uniform vec4 textureAnimation;","uniform float scale;"].join("\n"),attributes:["attribute vec4 acceleration;","attribute vec3 velocity;","attribute vec4 rotation;","attribute vec3 rotationCenter;","attribute vec4 params;","attribute vec4 size;","attribute vec4 angle;","attribute vec4 color;","attribute vec4 opacity;","attribute vec4 trail;"].join("\n"),varyings:["varying vec4 vColor;","//#ifdef SHOULD_ROTATE_TEXTURE","    varying float vAngle;","//#endif","#ifdef SHOULD_CALCULATE_SPRITE","    varying vec4 vSpriteSheet;","#endif","#ifdef SHOULD_TRAIL_PARTICLES","    varying float fTrailSpeed;","    varying vec4 vec4Path_0;","    varying vec4 vec4Path_1;","    varying vec4 vec4Path_2;","    varying vec4 vec4Path_3;","    varying vec4 vec4Path_4;","    varying vec4 vec4Path_5;","    varying vec4 vec4Path_6;","    varying vec4 vec4Path_7;","    varying vec4 vec4Path_8;","    varying vec4 vec4Path_9;","#endif"].join("\n"),branchAvoidanceFunctions:["float when_gt(float x, float y) {","    return max(sign(x - y), 0.0);","}","float when_lt(float x, float y) {","    return min( max(1.0 - sign(x - y), 0.0), 1.0 );","}","float when_eq( float x, float y ) {","    return 1.0 - abs( sign( x - y ) );","}","float when_ge(float x, float y) {","  return 1.0 - when_lt(x, y);","}","float when_le(float x, float y) {","  return 1.0 - when_gt(x, y);","}","float and(float a, float b) {","    return a * b;","}","float or(float a, float b) {","    return min(a + b, 1.0);","}"].join("\n"),unpackColor:["vec3 unpackColor( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   return c;","}"].join("\n"),unpackRotationAxis:["vec3 unpackRotationAxis( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   c *= vec3( 2.0 );","   c -= vec3( 1.0 );","   return c;","}"].join("\n"),floatOverLifetime:["float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {","    highp float value = 0.0;","    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );","    float fIndex = 0.0;","    float shouldApplyValue = 0.0;","    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );","","    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {","       fIndex = float( i );","       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );","       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );","    }","","    return value;","}"].join("\n"),colorOverLifetime:["vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {","    vec3 value = vec3( 0.0 );","    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );","    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );","    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );","    return value;","}"].join("\n"),paramFetchingFunctions:["float getAlive() {","   return params.x;","}","float getAge() {","   return params.y;","}","float getMaxAge() {","   return params.z;","}","float getWiggle() {","   return params.w;","}"].join("\n"),forceFetchingFunctions:["vec4 getPosition( in float age ) {","   return modelViewMatrix * vec4( position, 1.0 );","}","vec3 getVelocity( in float age ) {","   return velocity * age;","}","vec3 getAcceleration( in float age ) {","   return acceleration.xyz * age;","}"].join("\n"),rotationFunctions:["#ifdef SHOULD_ROTATE_PARTICLES","   mat4 getRotationMatrix( in vec3 axis, in float angle) {","       axis = normalize(axis);","       float s = sin(angle);","       float c = cos(angle);","       float oc = 1.0 - c;","","       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","                   0.0,                                0.0,                                0.0,                                1.0);","   }","","   vec3 getRotation( in vec3 pos, in float positionInTime ) {","      if( rotation.y == 0.0 ) {","           return pos;","      }","","      vec3 axis = unpackRotationAxis( rotation.x );","      vec3 center = rotationCenter;","      vec3 translated;","      mat4 rotationMatrix;","      float angle = 0.0;","      angle += when_eq( rotation.z, 0.0 ) * rotation.y;","      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );","      translated = rotationCenter - pos;","      rotationMatrix = getRotationMatrix( axis, angle );","      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );","   }","#endif"].join("\n"),rotateTexture:["    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );","","    #ifdef SHOULD_ROTATE_TEXTURE","       float x = gl_PointCoord.x - 0.5;","       float y = 1.0 - gl_PointCoord.y - 0.5;","       float c = cos( -vAngle );","       float s = sin( -vAngle );","       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );","    #endif","","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = vSpriteSheet.x;","        float framesY = vSpriteSheet.y;","        float columnNorm = vSpriteSheet.z;","        float rowNorm = vSpriteSheet.w;","        vUv.x = gl_PointCoord.x * framesX + columnNorm;","        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);","       if(vAngle != 0.0)","       {","           lowp float cos50 = cos(-vAngle);","           lowp float sin50 = sin(-vAngle);","           vec2 rotator50 = vUv;","           lowp float fWCeil = 1.0 / textureAnimation.x;","           lowp float fHCeil = 1.0 / textureAnimation.y;","           lowp float fHalfWCeil = fWCeil * 0.5;","           lowp float fHalfHCeil = fHCeil * 0.5;","           lowp float fXCenter = 0.0;","           lowp float fYCenter = 0.0;","           for(lowp float i = 0.0; i < 20.0; i+=1.0)","           {","               if(i >= textureAnimation.x) break;","               for(lowp float j = 0.0; j < 20.0; j+=1.0)","               {","                   if(j >= textureAnimation.y) break;","                   fXCenter = (i) * (fWCeil) + fHalfWCeil;","                   fYCenter = (j) * (fHCeil) + fHalfHCeil;","                   if(pow(((vUv.x - fXCenter)/(fHalfWCeil)), 2.0) + pow(((vUv.y - fYCenter)/(fHalfHCeil)), 2.0) <= 1.0)","                       rotator50 = (mat2( cos50 , -sin50 , sin50 , cos50 ) * (vUv - vec2( fXCenter,fYCenter ))) + vec2( fXCenter,fYCenter );","                   vUv = rotator50;","               }","           }","       }","      #else","       if(vAngle != 0.0)","       {","           lowp float cos50 = cos(-vAngle);","           lowp float sin50 = sin(-vAngle);","           vec2 rotator50 = vUv;","           lowp float fWCeil = 1.0 / textureAnimation.x;","           lowp float fHCeil = 1.0 / textureAnimation.y;","           lowp float fHalfWCeil = fWCeil * 0.5;","           lowp float fHalfHCeil = fHCeil * 0.5;","           lowp float fXCenter = 0.0;","           lowp float fYCenter = 0.0;","           for(lowp float i = 0.0; i < 20.0; i+=1.0)","           {","               if(i >= textureAnimation.x) break;","               for(lowp float j = 0.0; j < 20.0; j+=1.0)","               {","                   if(j >= textureAnimation.y) break;","                   fXCenter = (i) * (fWCeil) + fHalfWCeil;","                   fYCenter = (j) * (fHCeil) + fHalfHCeil;","                   if(pow(((vUv.x - fXCenter)/(fHalfWCeil)), 2.0) + pow(((vUv.y - fYCenter)/(fHalfHCeil)), 2.0) <= 1.0)","                       rotator50 = (mat2( cos50 , -sin50 , sin50 , cos50 ) * (vUv - vec2( fXCenter,fYCenter ))) + vec2( fXCenter,fYCenter );","                   vUv = rotator50;","               }","           }","       }","    #endif","","    vec4 rotatedTexture = texture2D( tex, vUv );","    #ifdef SHOULD_TRAIL_PARTICLES","\t    float fVelocityScale = fTrailSpeed;","\t    vec2 a_0 = (vec4Path_1.xy / vec4Path_1.w) * 0.5 + 0.5;","\t    vec2 b_0 = (vec4Path_0.xy / vec4Path_0.w) * 0.5 + 0.5;","\t    vec2 velocity_0 = fVelocityScale * (a_0 - b_0);","\t    vec2 a_1 = (vec4Path_2.xy / vec4Path_2.w) * 0.5 + 0.5;","\t    vec2 b_1 = (vec4Path_1.xy / vec4Path_1.w) * 0.5 + 0.5;","\t    vec2 velocity_1 = fVelocityScale * (a_1 - b_0);","\t    vec2 a_2 = (vec4Path_3.xy / vec4Path_3.w) * 0.5 + 0.5;","\t    vec2 b_2 = (vec4Path_2.xy / vec4Path_2.w) * 0.5 + 0.5;","\t    vec2 velocity_2 = fVelocityScale * (a_2 - b_0);","\t    vec2 a_3 = (vec4Path_4.xy / vec4Path_4.w) * 0.5 + 0.5;","\t    vec2 b_3 = (vec4Path_3.xy / vec4Path_3.w) * 0.5 + 0.5;","\t    vec2 velocity_3 = fVelocityScale * (a_3 - b_0);","\t    vec2 a_4 = (vec4Path_5.xy / vec4Path_5.w) * 0.5 + 0.5;","\t    vec2 b_4 = (vec4Path_4.xy / vec4Path_4.w) * 0.5 + 0.5;","\t    vec2 velocity_4 = fVelocityScale * (a_4 - b_0);","\t    vec2 a_5 = (vec4Path_6.xy / vec4Path_6.w) * 0.5 + 0.5;","\t    vec2 b_5 = (vec4Path_5.xy / vec4Path_5.w) * 0.5 + 0.5;","\t    vec2 velocity_5 = fVelocityScale * (a_5 - b_0);","\t    vec2 a_6 = (vec4Path_7.xy / vec4Path_7.w) * 0.5 + 0.5;","\t    vec2 b_6 = (vec4Path_6.xy / vec4Path_6.w) * 0.5 + 0.5;","\t    vec2 velocity_6 = fVelocityScale * (a_6 - b_0);","\t    vec2 a_7 = (vec4Path_8.xy / vec4Path_8.w) * 0.5 + 0.5;","\t    vec2 b_7 = (vec4Path_7.xy / vec4Path_7.w) * 0.5 + 0.5;","\t    vec2 velocity_7 = fVelocityScale * (a_7 - b_0);","\t    vec2 a_8 = (vec4Path_9.xy / vec4Path_9.w) * 0.5 + 0.5;","\t    vec2 b_8 = (vec4Path_8.xy / vec4Path_8.w) * 0.5 + 0.5;","\t    vec2 velocity_8 = fVelocityScale * (a_8 - b_0);","\t    vec4 oResult;","\t    oResult = texture2D(tex, vUv);","\t    vec2 offset_0 = velocity_0 * (float(1) / float(9) - 0.5);","\t    vec2 offset_1 = velocity_1 * (float(2) / float(9) - 0.5);","\t    vec2 offset_2 = velocity_2 * (float(3) / float(9) - 0.5);","\t    vec2 offset_3 = velocity_3 * (float(4) / float(9) - 0.5);","\t    vec2 offset_4 = velocity_4 * (float(5) / float(9) - 0.5);","\t    vec2 offset_5 = velocity_5 * (float(6) / float(9) - 0.5);","\t    vec2 offset_6 = velocity_6 * (float(7) / float(9) - 0.5);","\t    vec2 offset_7 = velocity_7 * (float(8) / float(9) - 0.5);","\t    vec2 offset_8 = velocity_8 * (float(9) / float(9) - 0.5);","\t    oResult += texture2D(tex, vUv + offset_0);","\t    oResult += texture2D(tex, vUv + offset_1);","\t    oResult += texture2D(tex, vUv + offset_2);","\t    oResult += texture2D(tex, vUv + offset_3);","\t    oResult += texture2D(tex, vUv + offset_4);","\t    oResult += texture2D(tex, vUv + offset_5);","\t    oResult += texture2D(tex, vUv + offset_6);","\t    oResult += texture2D(tex, vUv + offset_7);","\t    oResult += texture2D(tex, vUv + offset_8);","       rotatedTexture = oResult;","    #endif"].join("\n")},SPE.shaders={vertex:[SPE.shaderChunks.defines,SPE.shaderChunks.uniforms,SPE.shaderChunks.attributes,SPE.shaderChunks.varyings,THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,SPE.shaderChunks.branchAvoidanceFunctions,SPE.shaderChunks.unpackColor,SPE.shaderChunks.unpackRotationAxis,SPE.shaderChunks.floatOverLifetime,SPE.shaderChunks.colorOverLifetime,SPE.shaderChunks.paramFetchingFunctions,SPE.shaderChunks.forceFetchingFunctions,SPE.shaderChunks.rotationFunctions,"void main() {","    highp float age = getAge();","    highp float alive = getAlive();","    highp float maxAge = getMaxAge();","    highp float positionInTime = (age / maxAge);","    highp float isAlive = when_gt( alive, 0.0 );","    #ifdef SHOULD_WIGGLE_PARTICLES","        float wiggleAmount = positionInTime * getWiggle();","        float wiggleSin = isAlive * sin( wiggleAmount );","        float wiggleCos = isAlive * cos( wiggleAmount );","    #endif","    vec3 vel = getVelocity( age );","    vec3 accel = getAcceleration( age );","    vec3 force = vec3( 0.0 );","    vec3 pos = vec3( position );","    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;","    force += vel;","    force *= drag;","    force += accel * age;","    pos += force;","    #ifdef SHOULD_WIGGLE_PARTICLES","        pos.x += wiggleSin;","        pos.y += wiggleCos;","        pos.z += wiggleSin;","    #endif","    #ifdef SHOULD_ROTATE_PARTICLES","        pos = getRotation( pos, positionInTime );","    #endif","    vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );","    #ifdef SHOULD_TRAIL_PARTICLES","    float fTimeStep = trail.x * trail.z;","    fTrailSpeed = trail.y;","    for(int i = 0; i < 10; i++)","    {","       highp float age_i = age - float(i) * fTimeStep;","       highp float positionInTime_i = (age_i / maxAge);","       #ifdef SHOULD_WIGGLE_PARTICLES","           float wiggleAmount_i = positionInTime_i * getWiggle();","           float wiggleSin_i = isAlive * sin( wiggleAmount_i );","           float wiggleCos_i = isAlive * cos( wiggleAmount_i );","       #endif","       vec3 vel_i = getVelocity( age_i );","       vec3 accel_i = getAcceleration( age_i );","       vec3 force_i = vec3( 0.0 );","       vec3 pos_i = vec3( position );","       float drag_i = 1.0 - (positionInTime_i * 0.5) * acceleration.w;","       force_i += vel_i;","       force_i *= drag_i;","       force_i += accel_i * age_i;","       pos_i += force_i;","       #ifdef SHOULD_WIGGLE_PARTICLES","           pos_i.x += wiggleSin_i;","           pos_i.y += wiggleCos_i;","           pos_i.z += wiggleSin_i;","       #endif","       #ifdef SHOULD_ROTATE_PARTICLES","           pos_i = getRotation( pos_i, positionInTime_i );","       #endif","       vec4 mvPosition_i = projectionMatrix * modelViewMatrix * vec4( pos_i, 1.0 );","       if(i == 0) vec4Path_0 = mvPosition_i;","       if(i == 1) vec4Path_1 = mvPosition_i;","       if(i == 2) vec4Path_2 = mvPosition_i;","       if(i == 3) vec4Path_3 = mvPosition_i;","       if(i == 4) vec4Path_4 = mvPosition_i;","       if(i == 5) vec4Path_5 = mvPosition_i;","       if(i == 6) vec4Path_6 = mvPosition_i;","       if(i == 7) vec4Path_7 = mvPosition_i;","       if(i == 8) vec4Path_8 = mvPosition_i;","       if(i == 9) vec4Path_9 = mvPosition_i;","    }","    #endif","    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;","    #ifdef HAS_PERSPECTIVE","        float perspective = scale / length( mvPosition.xyz );","    #else","        float perspective = 1.0;","    #endif","    float pointSizePerspective = pointSize * perspective;","    #ifdef COLORIZE","       vec3 c = isAlive * getColorOverLifetime(","           positionInTime,","           unpackColor( color.x ),","           unpackColor( color.y ),","           unpackColor( color.z ),","           unpackColor( color.w )","       );","    #else","       vec3 c = vec3(1.0);","    #endif","    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );","    vColor = vec4( c, o );","    //#ifdef SHOULD_ROTATE_TEXTURE","        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );","    //#endif","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = textureAnimation.x;","        float framesY = textureAnimation.y;","        float loopCount = textureAnimation.w;","        float totalFrames = textureAnimation.z;","        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );","        float column = floor(mod( frameNumber, framesX ));","        float row = floor( (frameNumber - column) / framesX );","        float columnNorm = column / framesX;","        float rowNorm = row / framesY;","        vSpriteSheet.x = 1.0 / framesX;","        vSpriteSheet.y = 1.0 / framesY;","        vSpriteSheet.z = columnNorm;","        vSpriteSheet.w = rowNorm;","    #endif","    gl_PointSize = pointSizePerspective;","    gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[SPE.shaderChunks.uniforms,THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,SPE.shaderChunks.varyings,SPE.shaderChunks.branchAvoidanceFunctions,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if ( vColor.w < float(ALPHATEST) ) discard;","    #endif",SPE.shaderChunks.rotateTexture,THREE.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},SPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,i){"use strict";return typeof e===t?e:i},ensureArrayTypedArg:function(e,t,i){"use strict";if(Array.isArray(e)){for(var r=e.length-1;r>=0;--r)if(typeof e[r]!==t)return i;return e}return this.ensureTypedArg(e,t,i)},ensureInstanceOf:function(e,t,i){"use strict";return void 0!==t&&e instanceof t?e:i},ensureArrayInstanceOf:function(e,t,i){"use strict";if(Array.isArray(e)){for(var r=e.length-1;r>=0;--r)if(void 0!==t&&e[r]instanceof t==!1)return i;return e}return this.ensureInstanceOf(e,t,i)},ensureValueOverLifetimeCompliance:function(e,t,i){"use strict";t=t||3,i=i||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);var r=this.clamp(e._value.length,t,i),n=this.clamp(e._spread.length,t,i),o=Math.max(r,n);e._value.length!==o&&(e._value=this.interpolateArray(e._value,o)),e._spread.length!==o&&(e._spread=this.interpolateArray(e._spread,o))},interpolateArray:function(e,t){"use strict";for(var i=e.length,r=["function"==typeof e[0].clone?e[0].clone():e[0]],n=(i-1)/(t-1),o=1;o<t-1;++o){var s=o*n,a=Math.floor(s),l=Math.ceil(s),u=s-a;r[o]=this.lerpTypeAgnostic(e[a],e[l],u)}return r.push("function"==typeof e[i-1].clone?e[i-1].clone():e[i-1]),r},clamp:function(e,t,i){"use strict";return Math.max(t,Math.min(e,i))},zeroToEpsilon:function(e,t){"use strict";var i=e;return i=t?1e-5*Math.random()*10:1e-5,e<0&&e>-1e-5&&(i=-i),i},lerpTypeAgnostic:function(e,t,i){"use strict";var r,n=this.types;return typeof e==n.NUMBER&&typeof t==n.NUMBER?e+(t-e)*i:e instanceof THREE.Vector2&&t instanceof THREE.Vector2||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&null==e.z&&null==e.z&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&null==t.z&&null==t.z?(e instanceof THREE.Vector2?r=e.clone():((r={}).x=e.x,r.y=e.y),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r):e instanceof THREE.Vector3&&t instanceof THREE.Vector3||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&null==e.w&&null==e.w&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&null==t.w&&null==t.w?(e instanceof THREE.Vector3?r=e.clone():((r={}).x=e.x,r.y=e.y,r.z=e.z),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r.z=this.lerp(e.z,t.z,i),r):e instanceof THREE.Vector4&&t instanceof THREE.Vector4||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&typeof e.w==n.NUMBER&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&typeof t.w==n.NUMBER?(e instanceof THREE.Vector4?r=e.clone():((r={}).x=e.x,r.y=e.y,r.z=e.z,r.w=e.w),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r.z=this.lerp(e.z,t.z,i),r.w=this.lerp(e.w,t.w,i),r):e instanceof THREE.Color&&t instanceof THREE.Color||typeof e.r==n.NUMBER&&typeof e.g==n.NUMBER&&typeof e.b==n.NUMBER&&typeof t.r==n.NUMBER&&typeof t.g==n.NUMBER&&typeof t.b==n.NUMBER?(e instanceof THREE.Color?r=e.clone():((r={}).r=e.r,r.g=e.g,r.b=e.b),r.r=this.lerp(e.r,t.r,i),r.g=this.lerp(e.g,t.g,i),r.b=this.lerp(e.b,t.b,i),r):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,i){"use strict";return e+(t-e)*i},roundToNearestMultiple:function(e,t){"use strict";var i;return 0===t||0===(i=Math.abs(e)%t)?e:e<0?-(Math.abs(e)-i):e+t-i},arrayValuesAreEqual:function(e){"use strict";for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){"use strict";return e+t*(Math.random()-.5)},randomVector3:function(e,t,i,r,n){"use strict";var o=i.x+(Math.random()*r.x-.5*r.x),s=i.y+(Math.random()*r.y-.5*r.y),a=i.z+(Math.random()*r.z-.5*r.z);n&&(o=.5*-n.x+this.roundToNearestMultiple(o,n.x),s=.5*-n.y+this.roundToNearestMultiple(s,n.y),a=.5*-n.z+this.roundToNearestMultiple(a,n.z)),e.typedArray.setVec3Components(t,o,s,a)},getRandomVector3:function(e,t,i){"use strict";var r=e.x+(Math.random()*t.x-.5*t.x),n=e.y+(Math.random()*t.y-.5*t.y),o=e.z+(Math.random()*t.z-.5*t.z);return i&&(r=.5*-i.x+this.roundToNearestMultiple(r,i.x),n=.5*-i.y+this.roundToNearestMultiple(n,i.y),o=.5*-i.z+this.roundToNearestMultiple(o,i.z)),new THREE.Vector3(r,n,o)},randomColor:function(e,t,i,r){"use strict";var n=i.r+Math.random()*r.x,o=i.g+Math.random()*r.y,s=i.b+Math.random()*r.z;n=this.clamp(n,0,1),o=this.clamp(o,0,1),s=this.clamp(s,0,1),e.typedArray.setVec3Components(t,n,o,s)},randomColorAsHex:function(){"use strict";var e=new THREE.Color;return function(t,i,r,n){for(var o=r.length,s=[],a=0;a<o;++a){var l=n[a];e.copy(r[a]),e.r+=Math.random()*l.x-.5*l.x,e.g+=Math.random()*l.y-.5*l.y,e.b+=Math.random()*l.z-.5*l.z,e.r=this.clamp(e.r,0,1),e.g=this.clamp(e.g,0,1),e.b=this.clamp(e.b,0,1),s.push(e.getHex())}t.typedArray.setVec4Components(i,s[0],s[1],s[2],s[3])}}(),randomVector3OnSphere:function(e,t,i,r,n,o,s,a){"use strict";var l=2*Math.random()-1,u=6.2832*Math.random(),c=Math.sqrt(1-l*l),h=this.randomFloat(r,n),p=0,d=0,f=0;s&&(h=Math.round(h/s)*s),p=c*Math.cos(u)*h,d=c*Math.sin(u)*h,f=l*h,p*=o.x,d*=o.y,f*=o.z,p+=i.x,d+=i.y,f+=i.z,e.typedArray.setVec3Components(t,p,d,f)},seededRandom:function(e){var t=1e4*Math.sin(e);return t-(0|t)},randomVector3OnDisc:function(e,t,i,r,n,o,s){"use strict";var a=6.2832*Math.random(),l=Math.abs(this.randomFloat(r,n)),u=0,c=0,h=0;s&&(l=Math.round(l/s)*s),u=Math.cos(a)*l,c=Math.sin(a)*l,u*=o.x,c*=o.y,u+=i.x,c+=i.y,h+=i.z,e.typedArray.setVec3Components(t,u,c,h)},randomDirectionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,i,r,n,o,s,a,l){e.copy(s),e.x-=r,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(a,l)),t.typedArray.setVec3Components(i,e.x,e.y,e.z)}}(),directionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,i,r,n,o,s,a,l,u,c){e.copy(s),e.x-=r,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(a,l));var h=this.getRandomVector3(u,c);e.add(h),t.typedArray.setVec3Components(i,e.x,e.y,e.z)}}(),randomDirectionVector3OnDisc:function(){"use strict";var e=new THREE.Vector3;return function(t,i,r,n,o,s,a,l){e.copy(s),e.x-=r,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(a,l)),t.typedArray.setVec3Components(i,e.x,e.y,0)}}(),getPackedRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Color,r=new THREE.Vector3(1,1,1);return function(n,o){return e.copy(n).normalize(),t.copy(o).normalize(),e.x+=.5*-o.x+Math.random()*o.x,e.y+=.5*-o.y+Math.random()*o.y,e.z+=.5*-o.z+Math.random()*o.z,e.normalize().add(r).multiplyScalar(.5),i.setRGB(e.x,e.y,e.z),i.getHex()}}()},SPE.Group=function(e){"use strict";var t=SPE.utils,i=t.types;(e=t.ensureTypedArg(e,i.OBJECT,{})).texture=t.ensureTypedArg(e.texture,i.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,i.NUMBER,.016),null!=e.texture.frames&&null!=e.texture.frames&&(e.texture.frames.x=t.ensureTypedArg(e.texture.frames.x,i.NUMBER,1),e.texture.frames.y=t.ensureTypedArg(e.texture.frames.y,i.NUMBER,1)),this.texture=t.ensureInstanceOf(e.texture.value,THREE.Texture,null),this.textureFrames=t.ensureInstanceOf(new THREE.Vector2(e.texture.frames.x,e.texture.frames.y),THREE.Vector2,new THREE.Vector2(1,1)),this.textureFrameCount=t.ensureTypedArg(e.texture.frameCount,i.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=t.ensureTypedArg(e.texture.loop,i.NUMBER,1),this.textureFrames.max(new THREE.Vector2(1,1)),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,i.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,i.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,i.NUMBER,null),this.vec4Quaternion=t.ensureInstanceOf(e.vec4Quaternion,THREE.Vector4,new THREE.Vector4(0,0,0,1)),this.vec4Quaternion=this.vec4Quaternion.normalize(),this.blending=t.ensureTypedArg(e.blending,i.NUMBER,THREE.AdditiveBlending),this.transparent=t.ensureTypedArg(e.transparent,i.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,i.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,i.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,i.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,i.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,i.NUMBER,300),this.emitters=[],this.emitterIDs=[],this._pool=[],this._poolCreationSettings=null,this._createNewWhenPoolEmpty=0,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0,this.uniforms={tex:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new THREE.Vector4(this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}},this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:SPE.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_TRAIL_PARTICLES:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:this.textureFrames.x>1||this.textureFrames.y>1},this.attributes={position:new SPE.ShaderAttribute("v3",!0),acceleration:new SPE.ShaderAttribute("v4",!0),velocity:new SPE.ShaderAttribute("v3",!0),rotation:new SPE.ShaderAttribute("v4",!0),rotationCenter:new SPE.ShaderAttribute("v3",!0),params:new SPE.ShaderAttribute("v4",!0),size:new SPE.ShaderAttribute("v4",!0),angle:new SPE.ShaderAttribute("v4",!0),color:new SPE.ShaderAttribute("v4",!0),opacity:new SPE.ShaderAttribute("v4",!0),trail:new SPE.ShaderAttribute("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:SPE.shaders.vertex,fragmentShader:SPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog}),this.geometry=new THREE.BufferGeometry,this.mesh=new THREE.Points(this.geometry,this.material),null===this.maxParticleCount&&console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")},SPE.Group.constructor=SPE.Group,SPE.Group.prototype._updateDefines=function(){"use strict";for(var e,t=this.emitters,i=t.length-1,r=this.defines;i>=0;--i)e=t[i],r.SHOULD_CALCULATE_SPRITE||(r.SHOULD_ROTATE_TEXTURE=r.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,e.angle.value),Math.max.apply(null,e.angle.spread))),r.SHOULD_ROTATE_PARTICLES=r.SHOULD_ROTATE_PARTICLES||!!Math.max(e.rotation.angle,e.rotation.angleSpread),r.SHOULD_WIGGLE_PARTICLES=r.SHOULD_WIGGLE_PARTICLES||!!Math.max(e.wiggle.value,e.wiggle.spread),r.SHOULD_TRAIL_PARTICLES=r.SHOULD_TRAIL_PARTICLES||!!Math.max(e.trail.value,e.trail.spread);this.material.needsUpdate=!0},SPE.Group.prototype._applyAttributesToGeometry=function(){"use strict";var e,t,i=this.attributes,r=this.geometry,n=r.attributes;for(var o in i)i.hasOwnProperty(o)&&(e=i[o],(t=n[o])?t.array=e.typedArray.array:r.setAttribute(o,e.bufferAttribute),e.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)},SPE.Group.prototype.addEmitter=function(e){"use strict";if(e instanceof SPE.Emitter!=!1)if(this.emitterIDs.indexOf(e.uuid)>-1)console.error("Emitter already exists in this group. Will not add again.");else{if(null===e.group){var t=this.attributes,i=this.particleCount,r=i+e.particleCount;for(var n in this.particleCount=r,null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e._setBufferUpdateRanges(this.attributeKeys),e._setAttributeOffset(i),e.group=this,e.attributes=this.attributes,t)t.hasOwnProperty(n)&&t[n]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);for(var o=i;o<r;++o)e._assignPositionValue(o),e._assignForceValue(o,"velocity"),e._assignAccForceValue(o,"acceleration"),e._assignAbsLifetimeValue(o,"opacity"),e._assignAbsLifetimeValue(o,"size"),e._assignAngleValue(o),e._assignRotationValue(o),e._assignParamsValue(o),e._assignColorValue(o),e._assignTrailValue(o);return this._applyAttributesToGeometry(),this.emitters.push(e),this.emitterIDs.push(e.uuid),this._updateDefines(e),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this}console.error("Emitter already belongs to another group. Will not add to requested group.")}else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e)},SPE.Group.prototype.removeEmitter=function(e){"use strict";var t=this.emitterIDs.indexOf(e.uuid);if(e instanceof SPE.Emitter!=!1)if(-1!==t){for(var i=e.attributeOffset,r=i+e.particleCount,n=this.attributes.params.typedArray,o=i;o<r;++o)n.array[4*o]=0,n.array[4*o+1]=0;for(var s in this.emitters.splice(t,1),this.emitterIDs.splice(t,1),this.attributes)this.attributes.hasOwnProperty(s)&&this.attributes[s].splice(i,r);this.particleCount-=e.particleCount,e._onRemove(),this._attributesNeedRefresh=!0}else console.error("Emitter does not exist in this group. Will not remove.");else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e)},SPE.Group.prototype.getFromPool=function(){"use strict";var e=this._pool,t=this._createNewWhenPoolEmpty;if(e.length)return e.pop();if(t){var i=new SPE.Emitter(this._poolCreationSettings);return this.addEmitter(i),i}return null},SPE.Group.prototype.releaseIntoPool=function(e){"use strict";if(e instanceof SPE.Emitter!=!1)return e.reset(),this._pool.unshift(e),this;console.error("Argument is not instanceof SPE.Emitter:",e)},SPE.Group.prototype.getPool=function(){"use strict";return this._pool},SPE.Group.prototype.addPool=function(e,t,i){"use strict";var r;this._poolCreationSettings=t,this._createNewWhenPoolEmpty=!!i;for(var n=0;n<e;++n)r=Array.isArray(t)?new SPE.Emitter(t[n]):new SPE.Emitter(t),this.addEmitter(r),this.releaseIntoPool(r);return this},SPE.Group.prototype._triggerSingleEmitter=function(e){"use strict";var t=this.getFromPool(),i=this;if(null!==t)return e instanceof THREE.Vector3&&(t.position.value.copy(e),t.position.value=t.position.value),t.enable(),setTimeout((function(){t.disable(),i.releaseIntoPool(t)}),1e3*Math.max(t.duration,t.maxAge.value+t.maxAge.spread)),this;console.log("SPE.Group pool ran out.")},SPE.Group.prototype.triggerPoolEmitter=function(e,t){"use strict";if("number"==typeof e&&e>1)for(var i=0;i<e;++i)this._triggerSingleEmitter(t);else this._triggerSingleEmitter(t);return this},SPE.Group.prototype._updateUniforms=function(e){"use strict";this.uniforms.runTime.value+=e,this.uniforms.deltaTime.value=e},SPE.Group.prototype._resetBufferRanges=function(){"use strict";for(var e=this.attributeKeys,t=this.attributeCount-1,i=this.attributes;t>=0;--t)i[e[t]].resetUpdateRange()},SPE.Group.prototype._updateBuffers=function(e){"use strict";for(var t,i,r,n=this.attributeKeys,o=this.attributeCount-1,s=this.attributes,a=e.bufferUpdateRanges;o>=0;--o)i=a[t=n[o]],(r=s[t]).setUpdateRange(i.min,i.max),r.flagUpdate()},SPE.Group.prototype.tick=function(e){"use strict";var t=this.emitters,i=t.length,r=e||this.fixedTimeStep,n=this.attributeKeys,o=this.attributes;if(this._updateUniforms(r),this._resetBufferRanges(),0!==i||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(var s,a=0;a<i;++a)(s=t[a]).tick(r),this._updateBuffers(s);if(!0===this._attributesNeedDynamicReset){for(a=this.attributeCount-1;a>=0;--a)o[n[a]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(a=this.attributeCount-1;a>=0;--a)o[n[a]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}},SPE.Group.prototype.dispose=function(){"use strict";return this.geometry.dispose(),this.material.dispose(),this},SPE.Emitter=function(e){"use strict";var t=SPE.utils,i=t.types,r=SPE.valueOverLifetimeLength;for(var n in(e=t.ensureTypedArg(e,i.OBJECT,{})).position=t.ensureTypedArg(e.position,i.OBJECT,{}),e.velocity=t.ensureTypedArg(e.velocity,i.OBJECT,{}),e.acceleration=t.ensureTypedArg(e.acceleration,i.OBJECT,{}),e.radius=t.ensureTypedArg(e.radius,i.OBJECT,{}),e.drag=t.ensureTypedArg(e.drag,i.OBJECT,{}),e.rotation=t.ensureTypedArg(e.rotation,i.OBJECT,{}),e.color=t.ensureTypedArg(e.color,i.OBJECT,{}),e.opacity=t.ensureTypedArg(e.opacity,i.OBJECT,{}),e.size=t.ensureTypedArg(e.size,i.OBJECT,{}),e.angle=t.ensureTypedArg(e.angle,i.OBJECT,{}),e.wiggle=t.ensureTypedArg(e.wiggle,i.OBJECT,{}),e.trail=t.ensureTypedArg(e.trail,i.OBJECT,{}),e.maxAge=t.ensureTypedArg(e.maxAge,i.OBJECT,{}),e.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime."),this.uuid=THREE.Math.generateUUID(),this.type=t.ensureTypedArg(e.type,i.NUMBER,SPE.distributions.BOX),this.position={_value:t.ensureInstanceOf(e.position.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.position.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1),_radius:t.ensureTypedArg(e.position.radius,i.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.position.distributionClamp,i.NUMBER,0)},this.velocity={_value:t.ensureInstanceOf(e.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.velocity.spread,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.velocity.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.acceleration={_value:t.ensureInstanceOf(e.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.acceleration.spread,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.acceleration.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.drag={_value:t.ensureTypedArg(e.drag.value,i.NUMBER,0),_spread:t.ensureTypedArg(e.drag.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.wiggle={_value:t.ensureTypedArg(e.wiggle.value,i.NUMBER,0),_spread:t.ensureTypedArg(e.wiggle.spread,i.NUMBER,0)},this.rotation={_axis:t.ensureInstanceOf(e.rotation.axis,THREE.Vector3,new THREE.Vector3(0,1,0)),_axisSpread:t.ensureInstanceOf(e.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:t.ensureTypedArg(e.rotation.angle,i.NUMBER,0),_angleSpread:t.ensureTypedArg(e.rotation.angleSpread,i.NUMBER,0),_static:t.ensureTypedArg(e.rotation.static,i.BOOLEAN,!1),_center:t.ensureInstanceOf(e.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.maxAge={_value:t.ensureTypedArg(e.maxAge.value,i.NUMBER,2),_spread:t.ensureTypedArg(e.maxAge.spread,i.NUMBER,0)},this.color={_value:t.ensureArrayInstanceOf(e.color.value,THREE.Color,new THREE.Color),_spread:t.ensureArrayInstanceOf(e.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.opacity={_value:t.ensureArrayTypedArg(e.opacity.value,i.NUMBER,1),_spread:t.ensureArrayTypedArg(e.opacity.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.size={_value:t.ensureArrayTypedArg(e.size.value,i.NUMBER,1),_spread:t.ensureArrayTypedArg(e.size.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.angle={_value:t.ensureArrayTypedArg(e.angle.value,i.NUMBER,0),_spread:t.ensureArrayTypedArg(e.angle.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.bInitSpeed=!1,this.bInitSpeedAcc=!1,this.particleCount=t.ensureTypedArg(e.particleCount,i.NUMBER,100),this.duration=t.ensureTypedArg(e.duration,i.NUMBER,null),this.isStatic=t.ensureTypedArg(e.isStatic,i.BOOLEAN,!1),this.activeMultiplier=t.ensureTypedArg(e.activeMultiplier,i.NUMBER,1),this.direction=t.ensureTypedArg(e.direction,i.NUMBER,1),this.trail={_value:t.ensureArrayTypedArg(e.trail.value,i.NUMBER,0),_spread:t.ensureArrayTypedArg(e.trail.spread,i.NUMBER,0),_step:t.ensureArrayTypedArg(e.trail.step,i.NUMBER,0),_stepSpread:t.ensureArrayTypedArg(e.trail.stepSpread,i.NUMBER,0),_direction:t.ensureArrayTypedArg(e.trail.direction,i.NUMBER,-1*this.direction)},this.alive=t.ensureTypedArg(e.alive,i.BOOLEAN,!0),this.particlesPerSecond=0,this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.age=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.resetFlags={position:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)||t.ensureTypedArg(e.radius.randomise,i.BOOLEAN,!1),velocity:t.ensureTypedArg(e.velocity.randomise,i.BOOLEAN,!1),acceleration:t.ensureTypedArg(e.acceleration.randomise,i.BOOLEAN,!1)||t.ensureTypedArg(e.drag.randomise,i.BOOLEAN,!1),rotation:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),rotationCenter:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),size:t.ensureTypedArg(e.size.randomise,i.BOOLEAN,!1),color:t.ensureTypedArg(e.color.randomise,i.BOOLEAN,!1),opacity:t.ensureTypedArg(e.opacity.randomise,i.BOOLEAN,!1),angle:t.ensureTypedArg(e.angle.randomise,i.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle",trail:"trail"},this.updateMap)this.updateMap.hasOwnProperty(n)&&(this.updateCounts[this.updateMap[n]]=0,this.updateFlags[this.updateMap[n]]=!1,this._createGetterSetters(this[n],n));this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0,t.ensureValueOverLifetimeCompliance(this.color,r,r),t.ensureValueOverLifetimeCompliance(this.opacity,r,r),t.ensureValueOverLifetimeCompliance(this.size,r,r),t.ensureValueOverLifetimeCompliance(this.angle,r,r)},SPE.Emitter.constructor=SPE.Emitter,SPE.Emitter.prototype._createGetterSetters=function(e,t){"use strict";var i=this;for(var r in e)if(e.hasOwnProperty(r)){var n=r.replace("_","");Object.defineProperty(e,n,{get:function(e){return function(){return this[e]}}(r),set:function(e){return function(r){var n=i.updateMap[t],o=this[e],s=SPE.valueOverLifetimeLength;"_rotationCenter"===e?(i.updateFlags.rotationCenter=!0,i.updateCounts.rotationCenter=0):"_randomise"===e?i.resetFlags[n]=r:(i.updateFlags[n]=!0,i.updateCounts[n]=0),i.group._updateDefines(),this[e]=r,Array.isArray(o)&&SPE.utils.ensureValueOverLifetimeCompliance(i[t],s,s)}}(r)})}},SPE.Emitter.prototype._setBufferUpdateRanges=function(e){"use strict";this.attributeKeys=e,this.attributeCount=e.length;for(var t=this.attributeCount-1;t>=0;--t)this.bufferUpdateRanges[e[t]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}},SPE.Emitter.prototype._calculatePPSValue=function(e){"use strict";var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e},SPE.Emitter.prototype._setAttributeOffset=function(e){this.attributeOffset=e,this.activationIndex=e,this.activationEnd=e+this.particleCount},SPE.Emitter.prototype._assignValue=function(e,t){"use strict";switch(e){case"position":this._assignPositionValue(t);break;case"velocity":this._assignForceValue(t,e);break;case"acceleration":this._assignAccForceValue(t,e);break;case"size":case"opacity":this._assignAbsLifetimeValue(t,e);break;case"angle":this._assignAngleValue(t);break;case"params":this._assignParamsValue(t);break;case"rotation":this._assignRotationValue(t);break;case"color":this._assignColorValue(t);break;case"trail":this._assignTrailValue(t)}},SPE.Emitter.prototype._assignPositionValue=function(e){"use strict";var t=SPE.distributions,i=SPE.utils,r=this.position,n=this.attributes.position,o=r._value,s=r._spread;switch(r._distribution){case t.BOX:i.randomVector3(n,e,o,s,r._spreadClamp);break;case t.SPHERE:i.randomVector3OnSphere(n,e,o,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x,r._distributionClamp||this.particleCount);break;case t.DISC:i.randomVector3OnDisc(n,e,o,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x)}},SPE.Emitter.prototype._assignTrailValue=function(e){"use strict";this.attributes.trail.typedArray.setVec4Components(e,this.trail._direction,SPE.utils.randomFloat(this.trail._value,this.trail._spread),SPE.utils.randomFloat(this.trail._step,this.trail._stepSpread))},SPE.Emitter.prototype._assignForceValue=function(e,t){"use strict";var i=this.group.vec4Quaternion.clone();i=i.normalize();var r,n,o,s,a,l=SPE.distributions,u=SPE.utils,c=this[t],h=c._value,p=c._spread,d=c._distribution;switch(this.bInitSpeed||(h=h.applyQuaternion(i),p=p.applyQuaternion(i),this.bInitSpeed=!0),d){case l.BOX:u.randomVector3(this.attributes[t],e,h,p);break;case l.SPHERE:n=(r=this.attributes.position.typedArray.array)[a=3*e],o=r[a+1],s=r[a+2],u.randomDirectionVector3OnSphere(this.attributes[t],e,n,o,s,this.position._value,c._value.x,c._spread.x);break;case l.DISC:n=(r=this.attributes.position.typedArray.array)[a=3*e],o=r[a+1],s=r[a+2],u.randomDirectionVector3OnDisc(this.attributes[t],e,n,o,s,this.position._value,c._value.x,c._spread.x)}if("acceleration"===t){var f=u.clamp(u.randomFloat(this.drag._value,this.drag._spread),0,2);this.attributes.acceleration.typedArray.array[4*e+3]=f}},SPE.Emitter.prototype._assignAccForceValue=function(e,t){"use strict";var i=this.group.vec4Quaternion.clone();i=i.normalize();var r,n,o,s,a,l=SPE.distributions,u=SPE.utils,c=this[t],h=this.velocity,p=c._value,d=c._spread,f=c._distribution;switch(this.bInitSpeedAcc||(p=p.applyQuaternion(i),d=d.applyQuaternion(i),this.bInitSpeedAcc=!0),f){case l.BOX:u.randomVector3(this.attributes[t],e,p,d);break;case l.SPHERE:n=(r=this.attributes.position.typedArray.array)[a=3*e],o=r[a+1],s=r[a+2],u.directionVector3OnSphere(this.attributes[t],e,n,o,s,this.position._value,h._value.y,h._spread.y,c._value,c._spread);break;case l.DISC:n=(r=this.attributes.position.typedArray.array)[a=3*e],o=r[a+1],s=r[a+2],u.randomDirectionVector3OnDisc(this.attributes[t],e,n,o,s,this.position._value,c._value.x,c._spread.x)}if("acceleration"===t){var m=u.clamp(u.randomFloat(this.drag._value,this.drag._spread),0,2);this.attributes.acceleration.typedArray.array[4*e+3]=m}},SPE.Emitter.prototype._assignAbsLifetimeValue=function(e,t){"use strict";var i,r=this.attributes[t].typedArray,n=this[t],o=SPE.utils;o.arrayValuesAreEqual(n._value)&&o.arrayValuesAreEqual(n._spread)?(i=Math.abs(o.randomFloat(n._value[0],n._spread[0])),r.setVec4Components(e,i,i,i,i)):r.setVec4Components(e,Math.abs(o.randomFloat(n._value[0],n._spread[0])),Math.abs(o.randomFloat(n._value[1],n._spread[1])),Math.abs(o.randomFloat(n._value[2],n._spread[2])),Math.abs(o.randomFloat(n._value[3],n._spread[3])))},SPE.Emitter.prototype._assignAngleValue=function(e){"use strict";var t,i=this.attributes.angle.typedArray,r=this.angle,n=SPE.utils;n.arrayValuesAreEqual(r._value)&&n.arrayValuesAreEqual(r._spread)?(t=n.randomFloat(r._value[0],r._spread[0]),i.setVec4Components(e,t,t,t,t)):i.setVec4Components(e,n.randomFloat(r._value[0],r._spread[0]),n.randomFloat(r._value[1],r._spread[1]),n.randomFloat(r._value[2],r._spread[2]),n.randomFloat(r._value[3],r._spread[3]))},SPE.Emitter.prototype._assignParamsValue=function(e){"use strict";this.attributes.params.typedArray.setVec4Components(e,this.isStatic?1:0,0,Math.abs(SPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),SPE.utils.randomFloat(this.wiggle._value,this.wiggle._spread))},SPE.Emitter.prototype._assignRotationValue=function(e){"use strict";this.attributes.rotation.typedArray.setVec3Components(e,SPE.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),SPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1),this.attributes.rotationCenter.typedArray.setVec3(e,this.rotation._center)},SPE.Emitter.prototype._assignColorValue=function(e){"use strict";SPE.utils.randomColorAsHex(this.attributes.color,e,this.color._value,this.color._spread)},SPE.Emitter.prototype._resetParticle=function(e){"use strict";for(var t,i,r=this.resetFlags,n=this.updateFlags,o=this.updateCounts,s=this.attributeKeys,a=this.attributeCount-1;a>=0;--a)i=n[t=s[a]],!0!==r[t]&&!0!==i||(this._assignValue(t,e),this._updateAttributeUpdateRange(t,e),!0===i&&o[t]===this.particleCount?(n[t]=!1,o[t]=0):1==i&&++o[t])},SPE.Emitter.prototype._updateAttributeUpdateRange=function(e,t){"use strict";var i=this.bufferUpdateRanges[e];i.min=Math.min(t,i.min),i.max=Math.max(t,i.max)},SPE.Emitter.prototype._resetBufferRanges=function(){"use strict";for(var e,t=this.bufferUpdateRanges,i=this.bufferUpdateKeys,r=this.bufferUpdateCount-1;r>=0;--r)t[e=i[r]].min=Number.POSITIVE_INFINITY,t[e].max=Number.NEGATIVE_INFINITY},SPE.Emitter.prototype._onRemove=function(){"use strict";this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0},SPE.Emitter.prototype._decrementParticleCount=function(){"use strict";--this.activeParticleCount},SPE.Emitter.prototype._incrementParticleCount=function(){"use strict";++this.activeParticleCount},SPE.Emitter.prototype._checkParticleAges=function(e,t,i,r){"use strict";for(var n,o,s,a,l=t-1;l>=e;--l)0!==(a=i[n=4*l])&&(s=i[n+1],o=i[n+2],1===this.direction?(s+=r)>=o&&(s=0,a=0,this._decrementParticleCount()):(s-=r)<=0&&(s=o,a=0,this._decrementParticleCount()),i[n]=a,i[n+1]=s,this._updateAttributeUpdateRange("params",l))},SPE.Emitter.prototype._activateParticles=function(e,t,i,r){"use strict";for(var n,o,s=this.direction,a=e;a<t;++a)0!=i[n=4*a]&&1!==this.particleCount||(this._incrementParticleCount(),i[n]=1,this._resetParticle(a),o=r*(a-e),i[n+1]=-1===s?i[n+2]-o:o,this._updateAttributeUpdateRange("params",a))},SPE.Emitter.prototype.tick=function(e){"use strict";if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var t=this.attributeOffset,i=t+this.particleCount,r=this.paramsArray,n=this.particlesPerSecond*this.activeMultiplier*e,o=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(t,i,r,e),!1!==this.alive){if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);var s=1===this.particleCount?o:0|o,a=Math.min(s+n,this.activationEnd),l=a-this.activationIndex|0,u=l>0?e/l:0;this._activateParticles(s,a,r,u),this.activationIndex+=n,this.activationIndex>i&&(this.activationIndex=t),this.age+=e}else this.age=0}},SPE.Emitter.prototype.reset=function(e){"use strict";if(this.age=0,this.alive=!1,!0===e){for(var t,i=this.attributeOffset,r=i+this.particleCount,n=this.paramsArray,o=this.attributes.params.bufferAttribute,s=r-1;s>=i;--s)n[t=4*s]=0,n[t+1]=0;o.updateRange.offset=0,o.updateRange.count=-1,o.needsUpdate=!0}return this},SPE.Emitter.prototype.enable=function(){"use strict";return this.alive=!0,this},SPE.Emitter.prototype.disable=function(){"use strict";return this.alive=!1,this},SPE.Emitter.prototype.remove=function(){"use strict";return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Stats=t()}(this,(function(){var e=function(){function t(e){return n.appendChild(e.dom),e}function i(e){for(var t=0;t<n.children.length;t++)n.children[t].style.display=t===e?"block":"none";r=e}var r=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",(function(e){e.preventDefault(),i(++r%n.children.length)}),!1);var o=(performance||Date).now(),s=o,a=0,l=t(new e.Panel("FPS","#0ff","#002")),u=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new e.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:n,addPanel:t,showPanel:i,begin:function(){o=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(u.update(e-o,200),e>s+1e3&&(l.update(1e3*a/(e-s),100),s=e,a=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:n,setMode:i}};return e.Panel=function(e,t,i){var r=1/0,n=0,o=Math.round,s=o(window.devicePixelRatio||1),a=80*s,l=48*s,u=3*s,c=2*s,h=3*s,p=15*s,d=74*s,f=30*s,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*s+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,a,l),g.fillStyle=t,g.fillText(e,u,c),g.fillRect(h,p,d,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(h,p,d,f),{dom:m,update:function(l,v){r=Math.min(r,l),n=Math.max(n,l),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,a,p),g.fillStyle=t,g.fillText(o(l)+" "+e+" ("+o(r)+"-"+o(n)+")",u,c),g.drawImage(m,h+s,p,d-s,f,h,p,d-s,f),g.fillRect(h+d-s,p,s,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(h+d-s,p,s,o((1-l/v)*f))}}},e})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.thingjs={})}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}function o(e){THREE.Loader.call(this,e),this.dracoLoader=null,this.ddsLoader=null,this.options={}}function s(){var e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}o.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:o,load:function(e,t,i,r){var n,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=this;s.options=o,n=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),s.manager.itemStart(e);var a=function(t){var i=!1;r?i=r(t):console.error(t),i||s.manager.itemError(e),s.manager.itemEnd(e)},l=new THREE.FileLoader(s.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),"use-credentials"===s.crossOrigin&&l.setWithCredentials(!0),l.load(e,(function(i){try{s.parse(i,n,(function(i){t(i),s.manager.itemEnd(e)}),a)}catch(e){a(e)}}),i,a)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},parse:function(e,t,i,r){var n,o={};if("string"==typeof e)n=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===h){try{o[a.KHR_BINARY_GLTF]=new f(e)}catch(e){return void(r&&r(e))}n=o[a.KHR_BINARY_GLTF].content}else n=THREE.LoaderUtils.decodeText(new Uint8Array(e));var s=JSON.parseX(n,this);if(s)if(void 0===s.asset||s.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(s.extensionsUsed)for(var p=0;p<s.extensionsUsed.length;++p){var d=s.extensionsUsed[p],v=s.extensionsRequired||[];switch(d){case a.KHR_LIGHTS_PUNCTUAL:o[d]=new u(s);break;case a.KHR_MATERIALS_UNLIT:o[d]=new c;break;case a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[d]=new y;break;case a.KHR_DRACO_MESH_COMPRESSION:o[d]=new m(s,this.dracoLoader);break;case a.MSFT_TEXTURE_DDS:o[a.MSFT_TEXTURE_DDS]=new l(this.ddsLoader);break;case a.KHR_TEXTURE_TRANSFORM:o[d]=new g;break;case a.KHR_MESH_QUANTIZATION:o[d]=new b;break;default:v.indexOf(d)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}new W(s,o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,staticImage:this.options.staticImage,onLoadTexture:this.options.onLoadTexture}).parse(i,r)}else r&&r(new Error("THREE.GLTFLoader: Unsupported JSON data."))}});var a={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function l(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=a.MSFT_TEXTURE_DDS,this.ddsLoader=e}function u(e){this.name=a.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[a.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function c(e){this.name=a.KHR_MATERIALS_UNLIT}u.prototype.loadLight=function(e){var t,i=this.lightDefs[e],r=new THREE.Color(16777215);void 0!==i.color&&r.fromArray(i.color);var n=void 0!==i.range?i.range:0;switch(i.type){case"directional":(t=new THREE.DirectionalLight(r)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(r)).distance=n;break;case"spot":(t=new THREE.SpotLight(r)).distance=n,i.spot=i.spot||{},i.spot.innerConeAngle=void 0!==i.spot.innerConeAngle?i.spot.innerConeAngle:0,i.spot.outerConeAngle=void 0!==i.spot.outerConeAngle?i.spot.outerConeAngle:Math.PI/4,t.angle=i.spot.outerConeAngle,t.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+i.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==i.intensity&&(t.intensity=i.intensity),t.name=i.name||"light_"+e,Promise.resolve(t)},c.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial},c.prototype.extendParams=function(e,t,i){var r=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var o=n.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==n.baseColorTexture&&r.push(i.assignTexture(e,"map",n.baseColorTexture))}return Promise.all(r)};var h="glTF",p=1313821514,d=5130562;function f(e){this.name=a.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==h)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var i=new DataView(e,12),r=0;r<i.byteLength;){var n=i.getUint32(r,!0);r+=4;var o=i.getUint32(r,!0);if(r+=4,o===p){var s=new Uint8Array(e,12+r,n);this.content=THREE.LoaderUtils.decodeText(s)}else if(o===d){var l=12+r;this.body=e.slice(l,l+n)}r+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function m(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=a.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function g(){this.name=a.KHR_TEXTURE_TRANSFORM}function v(e){THREE.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),i=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),n=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),s={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(var a in s)e.uniforms[a]=s[a];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),e.fragmentShader=e.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_pars_fragment>",t),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_pars_fragment>",i),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>",r),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>",n),e.fragmentShader=e.fragmentShader.replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){s.specularMap.value=e}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){s.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function y(){return{name:a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return v},extendParams:function(e,t,i){var r=t.extensions[this.name];e.color=new THREE.Color(1,1,1),e.opacity=1;var n=[];if(Array.isArray(r.diffuseFactor)){var o=r.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(void 0!==r.diffuseTexture&&n.push(i.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var s=r.specularGlossinessTexture;n.push(i.assignTexture(e,"glossinessMap",s)),n.push(i.assignTexture(e,"specularMap",s))}return Promise.all(n)},createMaterial:function(e){var t=new v(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=THREE.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function b(){this.name=a.KHR_MESH_QUANTIZATION}function _(e,t,i,r){THREE.Interpolant.call(this,e,t,i,r)}m.prototype.decodePrimitive=function(e,t){var i=this.json,r=this.dracoLoader,n=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,s={},a={},l={};for(var u in o){var c=A[u]||u.toLowerCase();s[c]=o[u]}for(u in e.attributes){c=A[u]||u.toLowerCase();if(void 0!==o[u]){var h=i.accessors[e.attributes[u]],p=j[h.componentType];l[c]=p,a[c]=!0===h.normalized}}return t.getDependency("bufferView",n).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var i in e.attributes){var r=e.attributes[i],n=a[i];void 0!==n&&(r.normalized=n)}t(e)}),s,l)}))}))},g.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},v.prototype=Object.create(THREE.MeshStandardMaterial.prototype),v.prototype.constructor=v,v.prototype.copy=function(e){return THREE.MeshStandardMaterial.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},_.prototype=Object.create(THREE.Interpolant.prototype),_.prototype.constructor=_,_.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r*3+r,o=0;o!==r;o++)t[o]=i[n+o];return t},_.prototype.beforeStart_=_.prototype.copySampleValue_,_.prototype.afterEnd_=_.prototype.copySampleValue_,_.prototype.interpolate_=function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=2*s,l=3*s,u=r-t,c=(i-t)/u,h=c*c,p=h*c,d=e*l,f=d-l,m=-2*p+3*h,g=p-h,v=1-m,y=g-h+c,b=0;b!==s;b++){var _=o[f+b+s],x=o[f+b+a]*u,E=o[d+b+s],w=o[d+b]*u;n[b]=v*_+y*x+m*E+g*w}return n};var x=0,E=1,w=2,T=3,M=4,C=5,S=6,j={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},P={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},R={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},D={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},A={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",TEXCOORD_2:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},k={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},O={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},B="OPAQUE",F="MASK",L="BLEND",I={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function N(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function U(e,t,i){for(var r in i.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=i.extensions[r])}function z(e,i){void 0!==i.extras&&("object"===t(i.extras)?Object.assign(e.userData,i.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+i.extras))}function H(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var i=0,r=t.weights.length;i<r;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(i=0,r=n.length;i<r;i++)e.morphTargetDictionary[n[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function V(e){for(var t="",i=Object.keys(e).sort(),r=0,n=i.length;r<n;r++)t+=i[r]+":"+e[i[r]]+";";return t}function W(e,t,i){this.json=e||{},this.extensions=t||{},this.options=i||{},this.cache=new s,this.primitiveCache=[],this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function G(e,t,i){var r=t.attributes,n=[];function o(t,r){return i.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var s in r){var a=A[s]||s.toLowerCase();a&&(a in e.attributes||n.push(o(r[s],a)))}if(void 0!==t.indices&&!e.index){var l=i.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));n.push(l)}return z(e,t),function(e,t,i){var r=t.attributes,n=new THREE.Box3;if(void 0!==r.POSITION){var o=(h=i.json.accessors[r.POSITION]).min,s=h.max;if(void 0!==o&&void 0!==s){n.set(new THREE.Vector3(o[0],o[1],o[2]),new THREE.Vector3(s[0],s[1],s[2]));var a=t.targets;if(void 0!==a)for(var l=new THREE.Vector3,u=0,c=a.length;u<c;u++){var h,p=a[u];if(void 0!==p.POSITION)o=(h=i.json.accessors[p.POSITION]).min,s=h.max,void 0!==o&&void 0!==s?(l.setX(Math.max(Math.abs(o[0]),Math.abs(s[0]))),l.setY(Math.max(Math.abs(o[1]),Math.abs(s[1]))),l.setZ(Math.max(Math.abs(o[2]),Math.abs(s[2]))),n.expandByVector(l)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}e.boundingBox=n;var d=new THREE.Sphere;n.getCenter(d.center),d.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=d}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,i),Promise.all(n).then((function(){return void 0!==t.targets?function(e,t,i){for(var r=!1,n=!1,o=0,s=t.length;o<s&&(void 0!==(u=t[o]).POSITION&&(r=!0),void 0!==u.NORMAL&&(n=!0),!r||!n);o++);if(!r&&!n)return Promise.resolve(e);var a=[],l=[];for(o=0,s=t.length;o<s;o++){var u=t[o];if(r){var c=void 0!==u.POSITION?i.getDependency("accessor",u.POSITION):e.attributes.position;a.push(c)}n&&(c=void 0!==u.NORMAL?i.getDependency("accessor",u.NORMAL):e.attributes.normal,l.push(c))}return Promise.all([Promise.all(a),Promise.all(l)]).then((function(t){var i=t[0],o=t[1];return r&&(e.morphAttributes.position=i),n&&(e.morphAttributes.normal=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,i):e}))}function q(e,t){var i=e.getIndex();if(null===i){var r=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<n.count;o++)r.push(o);e.setIndex(r),i=e.getIndex()}var s=i.count-2,a=[];if(t===THREE.TriangleFanDrawMode)for(o=1;o<=s;o++)a.push(i.getX(0)),a.push(i.getX(o)),a.push(i.getX(o+1));else for(o=0;o<s;o++)o%2==0?(a.push(i.getX(o)),a.push(i.getX(o+1)),a.push(i.getX(o+2))):(a.push(i.getX(o+2)),a.push(i.getX(o+1)),a.push(i.getX(o)));a.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(a),l}W.prototype.parse=function(e,t){var i=this,r=this.json,n=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera"),this.getDependencies("material")]).then((function(t){var o={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],materials:t[3],asset:r.asset,parser:i,userData:{}};U(n,o,r),z(o,r),e(o)})).catch(t)},W.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[],r={},n={},o=0,s=t.length;o<s;o++)for(var a=t[o].joints,l=0,u=a.length;l<u;l++)e[a[l]].isBone=!0;for(var c=0,h=e.length;c<h;c++){var p=e[c];void 0!==p.mesh&&(void 0===r[p.mesh]&&(r[p.mesh]=n[p.mesh]=0),r[p.mesh]++,void 0!==p.skin&&(i[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=r,this.json.meshUses=n},W.prototype.getDependency=function(e,t){var i=e+":"+t,r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this.loadMesh(t);break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this.loadBufferView(t);break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this.loadMaterial(t);break;case"texture":r=this.loadTexture(t);break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;case"light":r=this.extensions[a.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,r)}return r},W.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var i=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return i.getDependency(e,r)}))),this.cache.add(e,t)}return t},W.prototype.loadBuffer=function(e){var t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[a.KHR_BINARY_GLTF].body);var r=this.options;return new Promise((function(e,n){i.load(N(t.uri,r.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},W.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var i=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+i)}))},W.prototype.loadAccessor=function(e){var t=this,i=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var n=[];return void 0!==r.bufferView?n.push(this.getDependency("bufferView",r.bufferView)):n.push(null),void 0!==r.sparse&&(n.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(n).then((function(e){var n,o,s=e[0],a=D[r.type],l=j[r.componentType],u=l.BYTES_PER_ELEMENT,c=u*a,h=r.byteOffset||0,p=void 0!==r.bufferView?i.bufferViews[r.bufferView].byteStride:void 0,d=!0===r.normalized;if(p&&p!==c){var f=Math.floor(h/p),m="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+f+":"+r.count,g=t.cache.get(m);g||(n=new l(s,f*p,r.count*p/u),g=new THREE.InterleavedBuffer(n,p/u),t.cache.add(m,g)),o=new THREE.InterleavedBufferAttribute(g,a,h%p/u,d)}else n=null===s?new l(r.count*a):new l(s,h,r.count*a),o=new THREE.BufferAttribute(n,a,d);if(void 0!==r.sparse){var v=D.SCALAR,y=j[r.sparse.indices.componentType],b=r.sparse.indices.byteOffset||0,_=r.sparse.values.byteOffset||0,x=new y(e[1],b,r.sparse.count*v),E=new l(e[2],_,r.sparse.count*a);null!==s&&(o=new THREE.BufferAttribute(o.array.slice(),o.itemSize,o.normalized));for(var w=0,T=x.length;w<T;w++){var M=x[w];if(o.setX(M,E[w*a]),a>=2&&o.setY(M,E[w*a+1]),a>=3&&o.setZ(M,E[w*a+2]),a>=4&&o.setW(M,E[w*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o}))},W.prototype.loadTexture=function(e){var t,i=this,r=this.json,n=this.options,o=this.textureLoader,s=window.URL||window.webkitURL,l=r.textures[e],u=l.extensions||{},c=(t=u[a.MSFT_TEXTURE_DDS]?r.images[u[a.MSFT_TEXTURE_DDS].source]:r.images[l.source]).uri,h=!1;return void 0!==t.bufferView&&(c=i.getDependency("bufferView",t.bufferView).then((function(e){h=!0;var i=new Blob([e],{type:t.mimeType});return c=s.createObjectURL(i)}))),Promise.resolve(c).then((function(e){var t=n.manager.getHandler(e);if(t||(t=u[a.MSFT_TEXTURE_DDS]?i.extensions[a.MSFT_TEXTURE_DDS].ddsLoader:o),n.onLoadTexture){var s=(r.samplers||{})[l.sampler]||{};return n.onLoadTexture(N(e,n.path),s,l).then((function(i){return i?(i._skipSetting=!0,Promise.resolve(i)):new Promise((function(i,r){t.load(N(e,n.path),i,void 0,r)}))}))}if(n.staticImage){var c=new THREE.Texture;return c.image=n.staticImage,c.format=THREE.RGBAFormat,c.needsUpdate=!0,Promise.resolve(c)}return new Promise((function(i,r){t.load(N(e,n.path),i,void 0,r)}))})).then((function(e){if(!0===h&&s.revokeObjectURL(c),e._skipSetting)return e;e.flipY=!1,void 0!==l.name&&(e.name=l.name),t.mimeType in I&&(e.format=I[t.mimeType]);var i=(r.samplers||{})[l.sampler]||{};return e.magFilter=P[i.magFilter]||THREE.LinearFilter,e.minFilter=P[i.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=R[i.wrapS]||THREE.RepeatWrapping,e.wrapT=R[i.wrapT]||THREE.RepeatWrapping,e}))},W.prototype.assignTexture=function(e,t,i){var r=this,n=this;if(void 0!==i.extensions&&i.extensions.textureExtensions){var o=i.extensions.textureExtensions.map((function(e){return r.getDependency("texture",e.index)}));return Promise.all(o).then((function(i){e[t]=i[0],e["_replace_"+t]=i}))}return this.getDependency("texture",i.index).then((function(r){if(r.isCompressedTexture,n.extensions[a.KHR_TEXTURE_TRANSFORM]){var o=void 0!==i.extensions?i.extensions[a.KHR_TEXTURE_TRANSFORM]:void 0;o&&(r=n.extensions[a.KHR_TEXTURE_TRANSFORM].extendTexture(r,o))}e[t]=r}))},W.prototype.assignFinalMaterial=function(e){var t=e.geometry,i=e.material,r=(this.extensions,void 0!==t.attributes.tangent),n=void 0!==t.attributes.color,o=void 0!==t.attributes.alphaIndex,s=void 0===t.attributes.normal,a=!0===e.isSkinnedMesh,l=Object.keys(t.morphAttributes).length>0,u=l&&void 0!==t.morphAttributes.normal;if(e.isPoints){var c="PointsMaterial:"+i.uuid,h=this.cache.get(c);h||(h=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(h,i),h.color.copy(i.color),h.map=i.map,h.sizeAttenuation=!1,this.cache.add(c,h)),i=h}else if(e.isLine){c="LineBasicMaterial:"+i.uuid;var p=this.cache.get(c);p||(p=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(p,i),p.color.copy(i.color),this.cache.add(c,p)),i=p}if(r||n||o||s||a||l){c="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),a&&(c+="skinning:"),r&&(c+="vertex-tangents:"),n&&(c+="vertex-colors:"),o&&(c+="vertex-alpha:"),s&&(c+="flat-shading:"),l&&(c+="morph-targets:"),u&&(c+="morph-normals:");var d=this.cache.get(c);d||(d=i.clone(),a&&(d.skinning=!0),r&&(d.vertexTangents=!0),n&&(d.vertexColors=!0),o&&(d.defines=d.defines||{},d.defines.USE_ALPHAINDEX=!0),s&&(d.flatShading=!0),l&&(d.morphTargets=!0),u&&(d.morphNormals=!0),this.cache.add(c,d)),i=d}i.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",new THREE.BufferAttribute(t.attributes.uv.array,2)),i.normalScale&&!r&&(i.normalScale.y=-i.normalScale.y),e.material=i},W.prototype.loadMaterial=function(e){var t,i=this.json,r=this.extensions,n=i.materials[e],o={},s=n.extensions||{},l=[];if(s[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=r[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(n),l.push(u.extendParams(o,n,this))}else if(s[a.KHR_MATERIALS_UNLIT]){var c=r[a.KHR_MATERIALS_UNLIT];t=c.getMaterialType(n),l.push(c.extendParams(o,n,this))}else{t=THREE.MeshStandardMaterial;var h=n.pbrMetallicRoughness||{};if(o.color=new THREE.Color(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){var p=h.baseColorFactor;o.color.fromArray(p),o.opacity=p[3]}void 0!==h.baseColorTexture&&(l.push(this.assignTexture(o,"map",h.baseColorTexture)),1==h.baseColorTexture.texCoord&&(o.__useDiffuseUV2=!0)),o.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,o.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(l.push(this.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),l.push(this.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture)))}!0===n.doubleSided&&(o.side=THREE.DoubleSide);var d=n.alphaMode||B;d===L?o.transparent=!0:(o.transparent=!1,d===F&&(o.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new THREE.Vector2(1,1),void 0!==n.normalTexture.scale&&o.normalScale.set(n.normalTexture.scale,n.normalTexture.scale)),void 0!==n.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(o.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(o.emissive=(new THREE.Color).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&t!==THREE.MeshBasicMaterial&&l.push(this.assignTexture(o,"emissiveMap",n.emissiveTexture));var f=[],m=s.blend;if(m)for(var g=0;g<m.length;g++)m[g].maskTexture&&l.push(this.assignTexture(f,g,m[g].maskTexture));return Promise.all(l).then((function(){var e,i=o.__useDiffuseUV2;i&&delete o.__useDiffuseUV2;var l=o._replace_map;l&&delete o._replace_map;var u=o._replace_emissiveMap;for(var c in u&&delete o._replace_emissiveMap,e=t===v?r[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),void 0!==n.name&&(e.name=n.name),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),z(e,n),n.extensions&&U(r,e,n),s)void 0===r[c]&&("sceneBlend"===c?(e.transparent=!0,e.blending=void 0===THREE[s[c]+"Blending"]?1:THREE[s[c]+"Blending"]):"blend"===c?e.__texture=f:"depthWrite"===c?e.depthWrite=!!s[c]:"wireframe"===c&&(e.wireframe=!!s[c]));l&&(e._replace_map=l);var h=(n.pbrMetallicRoughness||{}).baseColorTexture,p=n.emissiveTexture,d=n.normalTexture;return void 0===e.userData.gltfExtensions&&(e.userData.gltfExtensions={}),h&&h.extensions&&(e.userData.gltfExtensions.baseColorTexture=h.extensions),p&&p.extensions&&(e.userData.gltfExtensions.emissiveTexture=p.extensions),d&&d.extensions&&(e.userData.gltfExtensions.normalTexture=d.extensions),i&&(e.userData.gltfExtensions.useDiffuseUV2=!0),e}))},W.prototype.loadGeometries=function(e){var t=this,i=this.extensions,r=this.primitiveCache;function n(e){return i[a.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(i){return G(i,e,t)}))}for(var o,s,l=[],u=0,c=e.length;u<c;u++){var h,p=e[u],d=(s=void 0,(s=(o=p).extensions&&o.extensions[a.KHR_DRACO_MESH_COMPRESSION])?"draco:"+s.bufferView+":"+s.indices+":"+V(s.attributes):o.indices+":"+V(o.attributes)+":"+o.mode),f=r[d];if(f)l.push(f.promise);else h=p.extensions&&p.extensions[a.KHR_DRACO_MESH_COMPRESSION]?n(p):G(new THREE.BufferGeometry,p,t),r[d]={primitive:p,promise:h},l.push(h)}return Promise.all(l).then((function(e){return e.forEach((function(e){var t=e.attributes.color;if(t&&4===t.itemSize){for(var i=t.count,r=new Float32Array(i),n=0;n<i;n++)r.set([t.getW(n)],n);var o=new THREE.BufferAttribute(r,1);e.setAttribute("alphaIndex",o)}})),e}))},W.prototype.loadMesh=function(e){for(var t,i=this,r=this.json.meshes[e],n=r.primitives,o=[],s=0,a=n.length;s<a;s++){var l=void 0===n[s].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),t.DefaultMaterial):this.getDependency("material",n[s].material);o.push(l)}return o.push(i.loadGeometries(n)),Promise.all(o).then((function(t){for(var o=t.slice(0,t.length-1),s=t[t.length-1],a=[],l=0,u=s.length;l<u;l++){var c,h=s[l],p=n[l],d=o[l];if(p.mode===M||p.mode===C||p.mode===S||void 0===p.mode)!0!==(c=!0===r.isSkinnedMesh?new THREE.SkinnedMesh(h,d):new THREE.Mesh(h,d)).isSkinnedMesh||c.geometry.attributes.skinWeight.normalized||c.normalizeSkinWeights(),p.mode===C?c.geometry=q(c.geometry,THREE.TriangleStripDrawMode):p.mode===S&&(c.geometry=q(c.geometry,THREE.TriangleFanDrawMode));else if(p.mode===E)c=new THREE.LineSegments(h,d);else if(p.mode===T)c=new THREE.Line(h,d);else if(p.mode===w)c=new THREE.LineLoop(h,d);else{if(p.mode!==x)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);c=new THREE.Points(h,d)}Object.keys(c.geometry.morphAttributes).length>0&&H(c,r),c.name=r.name||"mesh_"+e,s.length>1&&(c._wName=0===l?c.name:"_skip_wireframes_",c.name+="_"+l),z(c,r),i.assignFinalMaterial(c),a.push(c)}if(1===a.length)return a[0];var f=new THREE.Group;for(l=0,u=a.length;l<u;l++)f.add(a[l]);return f}))},W.prototype.loadCamera=function(e){var t,i=this.json.cameras[e],r=i[i.type];if(r)return"perspective"===i.type?t=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===i.type&&(t=new THREE.OrthographicCamera(r.xmag/-2,r.xmag/2,r.ymag/2,r.ymag/-2,r.znear,r.zfar)),void 0!==i.name&&(t.name=i.name),z(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},W.prototype.loadSkin=function(e){var t=this.json.skins[e],i={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return i.inverseBindMatrices=e,i}))},W.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],i=[],r=[],n=[],o=[],s=[],a=0,l=t.channels.length;a<l;a++){var u=t.channels[a],c=t.samplers[u.sampler],h=u.target,p=void 0!==h.node?h.node:h.id,d=void 0!==t.parameters?t.parameters[c.input]:c.input,f=void 0!==t.parameters?t.parameters[c.output]:c.output;i.push(this.getDependency("node",p)),r.push(this.getDependency("accessor",d)),n.push(this.getDependency("accessor",f)),o.push(c),s.push(h)}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(n),Promise.all(o),Promise.all(s)]).then((function(i){for(var r=i[0],n=i[1],o=i[2],s=i[3],a=i[4],l=[],u=0,c=r.length;u<c;u++){var h=r[u],p=n[u],d=o[u],f=s[u],m=a[u];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,k[m.path]){case k.weights:g=THREE.NumberKeyframeTrack;break;case k.rotation:g=THREE.QuaternionKeyframeTrack;break;case k.position:case k.scale:default:g=THREE.VectorKeyframeTrack}var v=h.name?h.name:h.uuid,y=void 0!==f.interpolation?O[f.interpolation]:THREE.InterpolateLinear,b=[];k[m.path]===k.weights?h.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&b.push(e.name?e.name:e.uuid)})):b.push(v);var x=d.array;if(d.normalized){var E;if(x.constructor===Int8Array)E=1/127;else if(x.constructor===Uint8Array)E=1/255;else if(x.constructor==Int16Array)E=1/32767;else{if(x.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");E=1/65535}for(var w=new Float32Array(x.length),T=0,M=x.length;T<M;T++)w[T]=x[T]*E;x=w}for(T=0,M=b.length;T<M;T++){var C=new g(b[T]+"."+k[m.path],p.array,x,y);"CUBICSPLINE"===f.interpolation&&(C.createInterpolant=function(e){return new _(this.times,this.values,this.getValueSize()/3,e)},C.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(C)}}}var S=void 0!==t.name?t.name:"animation_"+e;return new THREE.AnimationClip(S,void 0,l)}))},W.prototype.loadNode=function(e){var t,i=this.json,r=this.extensions,n=this,o=i.meshReferences,s=i.meshUses,l=i.nodes[e];return(t=[],void 0!==l.mesh&&t.push(n.getDependency("mesh",l.mesh).then((function(e){var t;if(o[l.mesh]>1){var i=s[l.mesh]++;(t=e.clone()).name+="_instance_"+i}else t=e;return void 0!==l.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,i=l.weights.length;t<i;t++)e.morphTargetInfluences[t]=l.weights[t]})),t}))),void 0!==l.camera&&t.push(n.getDependency("camera",l.camera)),l.extensions&&l.extensions[a.KHR_LIGHTS_PUNCTUAL]&&void 0!==l.extensions[a.KHR_LIGHTS_PUNCTUAL].light&&t.push(n.getDependency("light",l.extensions[a.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(t)).then((function(e){var t;if((t=!0===l.isBone?new THREE.Bone:e.length>1?new THREE.Group:1===e.length?e[0]:new THREE.Object3D)!==e[0])for(var i=0,n=e.length;i<n;i++)t.add(e[i]);if(void 0!==l.name&&(t.userData.name=l.name,t.name=THREE.PropertyBinding.sanitizeNodeName(l.name)),z(t,l),l.extensions&&U(r,t,l),void 0!==l.matrix){var o=new THREE.Matrix4;o.fromArray(l.matrix),t.applyMatrix4(o)}else void 0!==l.translation&&t.position.fromArray(l.translation),void 0!==l.rotation&&t.quaternion.fromArray(l.rotation),void 0!==l.scale&&t.scale.fromArray(l.scale);return t}))},W.prototype.loadScene=function(){function e(t,i,r,n){var o=r.nodes[t];return n.getDependency("node",t).then((function(e){return void 0===o.skin?e:n.getDependency("skin",o.skin).then((function(e){for(var i=[],r=0,o=(t=e).joints.length;r<o;r++)i.push(n.getDependency("node",t.joints[r]));return Promise.all(i)})).then((function(i){return e.traverse((function(e){if(e.isMesh){for(var r=[],n=[],o=0,s=i.length;o<s;o++){var a=i[o];if(a){r.push(a);var l=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&l.fromArray(t.inverseBindMatrices.array,16*o),n.push(l)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}e.bind(new THREE.Skeleton(r,n),e.matrixWorld)}})),e}));var t})).then((function(t){i.add(t);var s=[];if(o.children)for(var a=o.children,l=0,u=a.length;l<u;l++){var c=a[l];s.push(e(c,t,r,n))}return Promise.all(s)}))}return function(t){var i=this.json,r=this.extensions,n=this.json.scenes[t],o=new THREE.Scene;void 0!==n.name&&(o.name=n.name),z(o,n),n.extensions&&U(r,o,n);for(var s=n.nodes||[],a=[],l=0,u=s.length;l<u;l++)a.push(e(s[l],o,i,this));return Promise.all(a).then((function(){return o}))}}();var X=Object.prototype.toString,J=function(e){return function(t){return X.call(t)=="[object "+e+"]"}};var Y=function(){var e=1,t=1,i=128/e,r=128/t,n=["rgb(255,255,255)"],o=document.createElement("canvas");o.width=128,o.height=128;for(var s=o.getContext("2d"),a=0;a<t;a++)for(var l=0;l<e;l++)s.fillStyle=n[(l+a)%2],s.fillRect(l*i,a*r,i,r);return o}(),Z={diffuseImage:Y,isType:J,isArray:J("Array"),isObject:J("Object"),isString:J("String"),isNumber:J("Number"),isFunction:J("Function"),isRegExp:J("RegExp"),isUndefined:J("Undefined"),isNull:function(e){return null==e},parseValue:function(e,t){return Z.isNull(e)?t:e},objectKeysToLowerCase:function(e,i,r){var n,o,s,a,l,u,c,h;if(u=Z.objectKeysToLowerCase,"undefined"===(c=t(i))||null===i||0===i||!1===i)i=0;else if("object"===c){if(!(i instanceof u))throw new TypeError('Expected "deep" to be a special object')}else if(!0===i)i=1/0;else{if("number"!==c)throw new TypeError('Expected "deep" to be a boolean, number or object, got "'+c+'"');if(isNaN(i)||i<0)throw new RangeError('Expected "deep" to be a positive number, got '+i)}if(null===e||"object"!==t(e))throw new TypeError('Expected "input" to be an object');if(c=t(r),null!==r&&"undefined"!==c&&"function"!==c)throw new TypeError('Expected "filter" to be a function');if(r=r||null,a=(s=Object.keys(e)).length-1,l={},i){if("number"==typeof i)i=Object.seal(Object.create(u.prototype,{input:{value:[]},output:{value:[]},level:{value:-1,writable:!0},max:{value:i,writable:!1}}));else if(~(n=i.input.indexOf(e)))return i.output[n];for(i.level+=1,i.input.push(e),i.output.push(l),n=a+1;n--;)"object"===t(h=e[o=s[a-n]])&&h&&i.level<i.max&&(r?r(h):h.constructor===Object)&&(h=u(h,i,r)),l[o.toLowerCase()]=h;i.level-=1}else for(n=a+1;n--;)l[(o=s[a-n]).toLowerCase()]=e[o];return l}},Q=new Map,K=new Map;function $(e,t,i){var r=e.get(t);return r||(r=new RegExp(t,i),e.set(t,r)),r}function ee(e,t){if(t){var i=K.get(t);return i||(i=new Map,K.set(t,i)),$(i,e,t)}return $(Q,e)}String.prototype._removeAt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e>=this.length?this:this.slice(0,e)+this.slice(e+t)},String.prototype._startsWith=function(e){return this.slice(0,e.length)===e},String.prototype._getPath=function(){var e=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");return this.substring(0,e)},String.prototype._getExtension=function(){var e=this.split(".");if(e.length>1){var t=e.pop(),i=t.indexOf("?");return-1!==i?t.substring(0,i):t}return""},String.prototype._getFileName=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");if(-1===t)return e?this:this.split(".")[0];var i=this.substring(t);return 0!==i.indexOf("\\")&&0!==i.indexOf("/")||(i=i.substring(1)),e?i:i.split(".")[0]},String.prototype._trimLeft=function(e){void 0===e&&(e="s");var t=ee("^["+e+"]+");return this.replace(t,"")},String.prototype._trimRight=function(e){void 0===e&&(e="s");var t=ee("["+e+"]+$");return this.replace(t,"")},String.prototype._trimBoth=function(e){return this._trimLeft(e)._trimRight(e)},String.prototype._appendPath=function(e){return this._trimRight("/")+"/"+e._trimLeft("/")._trimRight("/")},String.prototype._appendURL=function(e){var t=this._getFileName();return t._startsWith("?")?this._getPath()._appendPath(e)+t:this._appendPath(e)};var te=THREE.TextureLoader.prototype.load;THREE.TextureLoader.prototype.load=function(e,t,i,r){if(this.enableStaticImage){var n=new THREE.Texture;return n.image=Y,n.format=THREE.RGBAFormat,n.needsUpdate=!0,t&&t(n),n}return te.call(this,e,t,i,r)};var ie=function(){function e(t){i(this,e),this._major=0,this._minor=0,this._modified=0;var r=t.split(".");this._major=parseInt(r.length>=1?r[0]:0),this._minor=parseInt(r.length>=2?r[1]:0),this._modified=parseInt(r.length>=3?r[2]:0)}return n(e,[{key:"compare",value:function(t){return Z.isString(t)&&(t=new e(t)),this._major!=t._major?this._major>t._major?1:-1:this._minor!=t._minor?this._minor>t._minor?1:-1:this._modified!=t._modified?this._modified>t._modified?1:-1:0}},{key:"major",get:function(){return this._major}},{key:"minor",get:function(){return this._minor}},{key:"modified",get:function(){return this._modified}}]),e}(),re=function(){function e(t){i(this,e);var r=t.split(" ");this.initYear(r[0]),this.initTime(r[1])}return n(e,[{key:"initYear",value:function(e){var t=e.split("-");this._year=parseInt(t[0],10),this._month=parseInt(t[1],10),this._date=parseInt(t[2],10)}},{key:"initTime",value:function(e){var t=e.split(":");this._hours=parseInt(t[0],10),this._minutes=parseInt(t[1],10),this._seconds=parseInt(t[2],10)}},{key:"getYear",value:function(){return this._year}},{key:"getMonth",value:function(){return this._month-1}},{key:"getDate",value:function(){return this._date}},{key:"getHours",value:function(){return this._hours}},{key:"getMinutes",value:function(){return this._minutes}},{key:"getSeconds",value:function(){return this._seconds}}]),e}(),ne=function(){function e(){i(this,e)}return n(e,[{key:"GLTF_decoder_1_count",value:function(e,t,i,r){return 0==e?r-t:e%2?i%2?r+t:r:r-t}},{key:"GLTF_decoder_1_offset",value:function(e,t,i,r){return 0==e?r:e%2?r-(t*=i):r}},{key:"GLTF_decoder_1_length",value:function(e,t,i,r,n){return t*=i,0==e?n-t:e%2?r%2?n+t:n:n-t}},{key:"GLTF_decoder_2_offset",value:function(e,t,i,r){return e%2?r-(t*=i):r}},{key:"GLTF_decoder_2_length",value:function(e,t,i,r,n){return t*=i,e%2?r%2?n+t:n:n-t}},{key:"GLTF_decoder_3_offset",value:function(e,t,i,r){return e%2?r-(t*=i):r}},{key:"GLTF_decoder_3_length",value:function(e,t,i,r,n){return t*=i,e%2?r%2?n+t:n:n-t}}]),e}(),oe=function(){function e(t,r){i(this,e),this._decoder={},this._nameDecoder={},r?(r.data=Z.objectKeysToLowerCase(t),this._init(r.data)):this._init(t)}return n(e,[{key:"_initDecoder",value:function(e){var t=e.createtime;if(t){var i=new re(t),r=i.getSeconds();this._decoder.version=Math.floor(r/10);for(var n=e.size,o=1,s=0;s<n.length;s++){var a=n[s].toString();-1!==a.indexOf(".")&&(o+=Math.floor(a.substring(a.length-1)))}this._decoder.randomWeight=o,this._decoder.randomRanges=[i.getHours()+1,i.getDate()+1,i.getSeconds()%13+1,i.getMinutes()%13+1,o%5*(o%5)+1,e.verts%13+1,e.faces%13+1,e.nodes%13+1]}}},{key:"_nodecode_name",value:function(e,t){return e}},{key:"_decode21_name",value:function(e,t){var i=["F7WD3HNR2OPYV6AUS5TKM018ZBJL4EQXIGC9F","A0JQM9PSLXF18647URV3DNHOCY52TEZBWIGKA","B0IE6Q4S3C7OA28UHTPXDW9NYMGLF1K5VJRZB","EQ72MKL3DYNF5RU1PWBT64X9CIZVJHS8G0OAE"],r=e.charAt(0),n=i[1].indexOf(r);if(-1!==n){n++,n=Math.floor(n/2)+1;var o=(e=e._removeAt(n))._getExtension();e=e._getFileName(!1);for(var s="",a=0;a<e.length;a++){var l=e[a],u=i[(a+1+t)%4],c=u.indexOf(l);0===c?c=35:c--,s+=u[c]}return o?s+"."+o:s}}},{key:"_decode23_name",value:function(e,t){var i=["T64X9CIZVYNF5RU1PWBJHS8G0OAEQ72MKL3DT"],r=e.charAt(0),n=i[0].indexOf(r);if(-1!==n){n++,n=Math.floor(n/2)+1;var o=(e=e._removeAt(n))._getExtension();e=e._getFileName(!1);for(var s="",a=0;a<e.length;a++){var l=e[a],u=i[0],c=u.indexOf(l);0===c?c=35:c--,s+=u[c]}return o?s+"."+o:s}}},{key:"_initResourceDecoder",value:function(e,t){var i=t.texfiles;if(i){var r=new ie(e),n=this._nodecode_name;2==r.major&&1==r.minor?n=this._decode21_name:2==r.major&&3==r.minor&&(n=this._decode23_name);var o=Object.keys(i).length,s=t.gltffiles||t.modelfiles;if(s)for(var a=0;a<s.length;a++)s[a]=n(s[a],o);var l=t.lod;if(l){var u=Object.keys(l);for(a=0;a<u.length;a++){var c=u[a];l[n(c,o)]=l[c],delete l[c]}}this._nameDecoder.version=r,this._nameDecoder.decodeFunc=n}}},{key:"_init",value:function(e){if(e){var t=e.version;if(t)new ie(t).compare("2.0")<=0||(this._initDecoder(e),this._initResourceDecoder(t,e))}}},{key:"_decode_lt_2_2",value:function(e,t,i){var r=new ne,n=this._nameDecoder.version,o=n&&2==n.major&&2==n.minor;switch(this._decoder.version){case 0:case 3:var s=this._decoder.randomWeight;if("_accessors"==t)for(var a=0;a<i.length;a++){var l=i[a];if(!o||void 0!==l.byteType)(u=e.bufferViews[l.bufferView]).factor=Math.floor(u.byteLength/l.count),u.opFactor=l.byteType,l.count=r.GLTF_decoder_1_count(a,s,l.byteType,l.count),delete l.byteType}else if("_bufferViews"==t)for(a=0;a<i.length;a++){var u=i[a];if(!o||void 0!==u.byteType){var c=u.factor;u.byteOffset=r.GLTF_decoder_1_offset(a,s,c,Z.parseValue(u.uinOffset,u.byteOffset)),u.byteLength=r.GLTF_decoder_1_length(a,s,c,u.opFactor,u.byteLength),delete u.factor,delete u.opFactor}}break;case 1:case 4:var h=this._decoder.randomRanges;if("_accessors"==t)for(a=0;a<i.length;a++){l=i[a];if(!o||void 0!==l.byteType){(u=e.bufferViews[l.bufferView]).factor=Math.floor(u.byteLength/l.count),u.opFactor=l.byteType;s=h[Math.floor(a/2)%8]+(a+1)%7;l.count=r.GLTF_decoder_1_count(a,s,l.byteType,l.count),delete l.byteType}}else if("_bufferViews"==t)for(a=0;a<i.length;a++){u=i[a];if(!o||void 0!==u.byteType){var p=h[Math.floor(a/2)%8]+(a+1)%7;c=u.factor;u.byteOffset=r.GLTF_decoder_2_offset(a,p,c,Z.parseValue(u.uinOffset,u.byteOffset)),u.byteLength=r.GLTF_decoder_2_length(a,p,c,u.opFactor,u.byteLength),delete u.factor,delete u.opFactor}}break;case 2:case 5:this._decoder.randomRanges3=[this._decoder.randomRanges[7],7*e.materials.length%10];var d=(e.buffers[0].byteLength-999).toString();for(a=0;a<d.length;a++){var f=10-Math.floor(d[a]);this._decoder.randomRanges3.push(f)}this._decoder.randomRanges3.push(this._decoder.randomRanges[3]);h=this._decoder.randomRanges3;if("_accessors"==t)for(a=0;a<i.length;a++){l=i[a];if(!o||void 0!==l.byteType){u=e.bufferViews[l.bufferView],s=h[Math.floor(a/2)%h.length]+Math.floor(a+1)%7;u.factor=Math.floor(u.byteLength/l.count),u.opFactor=l.byteType,l.count=r.GLTF_decoder_1_count(a,s,l.byteType,l.count),delete l.byteType}}else if("_bufferViews"==t)for(a=0;a<i.length;a++){u=i[a];if(!o||void 0!==u.byteType){p=h[Math.floor(a/2)%h.length]+Math.floor(a+1)%7,c=u.factor;u.byteOffset=r.GLTF_decoder_3_offset(a,p,c,Z.parseValue(u.uinOffset,u.byteOffset)),u.byteLength=r.GLTF_decoder_3_length(a,p,c,u.opFactor,u.byteLength),delete u.factor,delete u.opFactor}}}}},{key:"_decode_2_3",value:function(e,t){if("_accessors"==e)for(var i=0;i<t.length;i++){t[i].count--}else if("_bufferViews"==e)for(i=0;i<t.length;i++){var r=t[i];r.byteOffset--,r.byteLength--}}},{key:"decode",value:function(e,t,i){var r=this._nameDecoder.version;r&&(r.major<=2&&r.minor<=2?this._decode_lt_2_2(e,t,i):2==r.major&&3==r.minor&&this._decode_2_3(t,i));var n=this._nameDecoder.decodeFunc;if(n&&("_buffers"==t||"_images"==t))for(var o=e.buffers.length+e.images.length,s=0;s<i.length;s++){var a=n(i[s].uri,o);a&&(i[s].uri=a)}}},{key:"decodeDracoFile",value:function(e,t,i){}}]),e}();var se={process:function(e,t){var i=[];e.traverse((function(e){!function(e,t){if(e.material&&e.material.userData&&e.material.userData.gltfExtensions){var i=e.material.userData.gltfExtensions.blend;if(i){var r,n,o,s=e.material.__texture,a=e.geometry.index.count,l=[{materialIndex:0,start:0,count:a}],u=[e.material],c=!1,h=!1;for(e.material.defines&&e.material.defines.USE_ALPHAINDEX&&(c=!0),e.material.skinning&&(h=!0),r=0;r<i.length;r++)(n=t[i[r].subMaterial].clone())&&(n.transparent=!0,c&&(n.defines=n.defines||{},n.defines.USE_ALPHAINDEX=!0),h&&(n.skinning=!0),i[r].maskTexture&&(1===(o=i[r].maskTexture.texCoord||0)&&(n.defines.USE_ALPHA_UV2=""),2===o&&(n.defines.USE_ALPHA_UV3=""),i[r].maskTexture.extensions&&(n.userData.gltfExtensions.alphaTexture=i[r].maskTexture.extensions),n.alphaMap=s[r],n.needsUpdate=!0),u.push(n),l.push({materialIndex:u.length-1,start:0,count:a}));e.material=u,e.geometry.groups=l}}}(e,t),function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}(e),function(e){e.material&&(Array.isArray(e.material)?e.material.forEach((function(e){e.map&&(e.userData.gltfExtensions.useDiffuseUV2&&(e.defines=e.defines||{},e.defines.USE_DIFFUSE_UV2=""),e.map.anisotropy=16,e.map.needsUpdate=!0)})):e.material.map&&(e.material.userData.gltfExtensions.useDiffuseUV2&&(e.material.defines=e.material.defines||{},e.material.defines.USE_DIFFUSE_UV2=""),e.material.map.anisotropy=16,e.material.map.needsUpdate=!0))}(e),function(e){if(e.userData&&e.userData.gltfExtensions){if(e.userData.gltfExtensions.effects&&(e.technique={},e.userData.gltfExtensions.effects.skipGlow&&(e.technique.middleGlow="skip",e.traverse((function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.middleGlow="skip",e._cachedTechnique=e._cachedTechnique||{},e._cachedTechnique.middleGlow="skip")}))),(e.userData.gltfExtensions.effects.bloom||e.userData.gltfExtensions.effects.glow)&&(e.technique.middleGlow=!0,e.traverse((function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.middleGlow=!0,e._cachedTechnique=e._cachedTechnique||{},e._cachedTechnique.middleGlow=!0)}))),e.userData.gltfExtensions.effects.skipInnerGlow&&(e.technique.innerGlow="skip",e.traverse((function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.innerGlow="skip",e._cachedTechnique=e._cachedTechnique||{},e._cachedTechnique.innerGlow="skip")}))),(e.userData.gltfExtensions.effects.glowInset||e.userData.gltfExtensions.effects.innerGlow)&&(e.technique.innerGlow=!0,e.traverse((function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.innerGlow=!0,e._cachedTechnique=e._cachedTechnique||{},e._cachedTechnique.innerGlow=!0)}))),e._cachedTechnique=JSON.parse(JSON.stringify(e.technique)),delete e.userData.effects),void 0!==e.userData.gltfExtensions.renderOrder){var t=Number(e.userData.gltfExtensions.renderOrder);e.traverse((function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.renderOrder=t)}))}void 0!==e.userData.gltfExtensions.castShadows&&(e.castShadow=!!e.userData.gltfExtensions.castShadows),void 0!==e.userData.gltfExtensions.receiveShadows&&(e.receiveShadow=!!e.userData.gltfExtensions.receiveShadows)}}(e),function(e,t){if(e.userData&&e.userData.gltfExtensions&&e.userData.gltfExtensions.wireframe){var i=e.userData.gltfExtensions;if(2==i.wireframe.type){if(i.wireframe.wireframeVerts){var r=[],n=[];i.wireframe.wireframeVerts.forEach((function(e){var t=JSON.parse(e.pos1),i=JSON.parse(e.pos2),o=JSON.parse(e.uv1),s=JSON.parse(e.uv2);r.push(t[0],t[1],t[2],i[0],i[1],i[2]),n.push(o[0],o[1],s[0],s[1])}));var o=new THREE.BufferGeometry;o.setAttribute("position",new THREE.Float32BufferAttribute(r,3)),o.setAttribute("uv",new THREE.Float32BufferAttribute(n,2));var s=e.material;if(!s&&e.children[0]&&(s=e.children[0].material),Array.isArray(s)&&(s=s[0]),s.defines.USE_ALPHAINDEX||s.vertexColors===THREE.VertexColors){var a=s.clone();a.vertexColors=0,a.defines&&delete a.defines.USE_ALPHAINDEX,a.userData=s.userData||{},s=a}var l=new THREE.LineSegments(o,s);l.userData.skipStyle=!0,l.technique=e.technique,l.material.flatShading=!0,l.renderOrder=1,t.push(e),e.parent.add(l)}}else 3==i.wireframe.type&&e.children.slice().forEach((function(r){if(r.isMesh){var n,o=new THREE.EdgesGeometry(r.geometry,i.wireframe.wireframeThreshold||.1);Array.isArray(r.material)?(n=(n=r.material.map((function(e){return new THREE.MeshBasicMaterial({color:e.color,map:e.map,alphaMap:e.alphaMap,transparent:e.transparent,depthWrite:e.depthWrite,blending:e.blending})})))[0]).userData=r.material[0].userData||{}:(n=new THREE.MeshBasicMaterial({color:r.material.color,map:r.material.map,alphaMap:r.material.alphaMap,transparent:r.material.transparent,depthWrite:r.material.depthWrite,blending:r.material.blending})).userData=r.material.userData||{};var s=new THREE.LineSegments(o,n);s.userData.skipStyle=!0,s.name=r.name,s.position.copy(r.position),s.scale.copy(r.scale),s.quaternion.copy(r.quaternion),s.technique=r.technique,s.material.flatShading=!0,s.renderOrder=1,e.add(s),t.push(r)}}));delete i.wireframe}}(e,i)})),i.forEach((function(e){e.parent&&e.parent.remove(e)}))}},ae=function(){function e(t){i(this,e),this._manager=e.defaultManager||t,this._loader=new o(this._manager)}return n(e,[{key:"_ProcessProgressCallback",value:function(e,t,i){var r=0;t.lengthComputable&&t.total>0?t.target.readyState>1&&(r=t.loaded/t.total):r=1,i&&1==(r*=(i.cur+1)/i.total)&&i.cur++,e({progress:r})}},{key:"_loadGLTFs",value:function(e,t,i,r,n,o,s,a,l,u){var c=this,h=this._loader;h.loadingIndex=r,h.setDRACOLoader(e),h.setCrossOrigin("anonymous");var p=(i.gltffiles||i.modelfiles)[r],d=t._appendURL(p),f=i.lod;this.load(d,(function(e){if(f){var t=p._getFileName(!1),i=f[t];Z.isNumber(i)||(console.error("The '"+t+"' distance is invalid, please check name is existing in index.json"),i=1e4),n.addLevel(e.scene,i)}else n.add(e.scene);o.models[r]={node:e.scene,animations:e.animations,materials:e.materials},e.animations&&e.animations.length&&(o.animations=e.animations),o.loadedNumber++,o.loadedNumber===o.totalNumber&&a&&a({url:d._getPath(),node:n,models:o.models})}),(function(e){s&&c._ProcessProgressCallback(s,e,o)}),(function(e){if(l)return l(e)}),u)}},{key:"loadGLTFs",value:function(e,t,i,r,n,o,s){var a;t&&null!=i&&i(t),a=t.lod?new THREE.LOD:new THREE.Group;var l=t.gltffiles||t.modelfiles,u={loadedNumber:0,totalNumber:l.length,cur:0,total:l.length},c={};u.models=[];for(var h=new oe(t,c),p=0;p<l.length;p++)this._loadGLTFs(h,e,c.data,p,a,u,n,r,o,s)}},{key:"loadGLTF",value:function(e,t,i,r,n,o,s){t=t||{};var a,l={},u=this._loader;u.setDRACOLoader(new oe(t,l)),u.setCrossOrigin("anonymous"),t=l.data,null!=i&&i(t);var c=t.gltffiles||t.modelfiles;a=c&&c.length?e._appendURL(c[0]):e._appendURL("scene.gltf");var h=this;this.load(a,(function(e){null!=r&&r({url:a._getPath(),node:e.scene,animations:e.animations,materials:e.materials})}),(function(e){n&&h._ProcessProgressCallback(n,e)}),(function(e){if(o)return o(e)}),s)}},{key:"downloadGLTF",value:function(e,t,i,r,n){var o=this;this.load(e,(function(i){null!=t&&t({url:e,node:i.scene,animations:i.animations,materials:i.materials})}),(function(e){i&&o._ProcessProgressCallback(i,e)}),(function(e){if(r)return r(e)}),n)}},{key:"downloadGLTFPackage",value:function(e,t,i,r,n,o){var s=e._appendURL("index.json"),a=this;new THREE.FileLoader(this._manager).load(s,(function(s){if(s)try{var l=Z.objectKeysToLowerCase(JSON.parse(s)),u=l.gltffiles||l.modelfiles;if(u&&0!==u.length){for(var c=0;c<u.length;c++)u[c]||u.splice(c--,1);1===u.length?a.loadGLTF(e,l,t,i,r,n,o):a.loadGLTFs(e,l,t,i,r,n,o)}else a.loadGLTF(e,l,t,i,r,n,o)}catch(e){console.error(e),n&&n(e)}}),(function(){}),(function(o){var s=!1;n&&(s=n(o)),s||a.loadGLTF(e,null,t,i,r,n)}))}},{key:"downloadJSON",value:function(e,t,i){(new THREE.JSONLoader).load(e,(function(i,r){for(var n in r)r[n].skinning=!0;null!=t&&t({url:e,geometry:i,materials:r})}))}},{key:"loadFromURL",value:function(e){var t=e.url,i=e.useStaticImage,r=e.onLoadTexture,n=e.jsonCallback,o=e.modelCallback,s=e.progressCallback,a=e.errorCallback,l=t._getExtension(),u={};i&&(u.staticImage=Z.diffuseImage),r&&(u.onLoadTexture=r),"js"==l?this.downloadJSON(t,o,u):"gltf"==l||"glb"==l?this.downloadGLTF(t,o,s,a,u):this.downloadGLTFPackage(t,n,o,s,a,u)}},{key:"load",value:function(e,t,i,r,n){this._loader.load(e,(function(e){se.process(e.scene,e.materials),t&&t(e)}),i,r,n);var o=this;return{then:function(s,a){return o._loader.load(e,(function(e){se.process(e.scene,e.materials),t&&t(e),s(e)}),i,(function(e){r&&r(e),a(e)}),n),this}}}},{key:"setCrossOrigin",value:function(e){return this._loader.setCrossOrigin(e),this}},{key:"setPath",value:function(e){return this._loader.setPath(e),this}},{key:"setResourcePath",value:function(e){return this._loader.setResourcePath(e),this}}]),e}(),le=function(){function e(t,r){i(this,e);var n=JSON.parse(t);this._asset=n.asset,this._scene=n.scene,this._scenes=n.scenes,this._extensionsUsed=n.extensionsUsed,this._extensions=n.extensions,this._nodes=n.nodes,this._accessors=n.accessors,this._images=n.images,this._skins=n.skins,this._meshes=n.meshes,this._textures=n.textures,this._samplers=n.samplers,this._materials=n.materials,this._cameras=n.cameras,this._animations=n.animations,this._buffers=n.buffers,this._bufferViews=n.bufferViews,this._meshReferences=n.meshReferences,this._meshUses=n.meshUses,this._init(r)}return n(e,[{key:"_init",value:function(e){var t=e.dracoLoader;if(t)for(var i=Object.keys(this),r=0;r<i.length;r++){var n=i[r],o=this[n];o&&t.decode(this,n,o)}}},{key:"asset",get:function(){return this._asset}},{key:"scene",get:function(){return this._scene}},{key:"scenes",get:function(){return this._scenes}},{key:"extensionsUsed",get:function(){return this._extensionsUsed}},{key:"extensions",get:function(){return this._extensions}},{key:"nodes",get:function(){return this._nodes}},{key:"accessors",get:function(){return this._accessors}},{key:"images",get:function(){return this._images}},{key:"skins",get:function(){return this._skins}},{key:"meshes",get:function(){return this._meshes}},{key:"textures",get:function(){return this._textures}},{key:"samplers",get:function(){return this._samplers}},{key:"materials",get:function(){return this._materials}},{key:"cameras",get:function(){return this._cameras}},{key:"animations",get:function(){return this._animations}},{key:"buffers",get:function(){return this._buffers}},{key:"bufferViews",get:function(){return this._bufferViews}},{key:"meshReferences",set:function(e){this._meshReferences=e},get:function(){return this._meshReferences}},{key:"meshUses",set:function(e){this._meshUses=e},get:function(){return this._meshUses}}]),e}();JSON.parseX=function(e,t){try{return new le(e,t)}catch(e){return console.error(e),null}},le.prototype.toJSON=function(){},THREE&&(THREE.GLTFLoader=ae),e.GLTFLoader=ae,e.JSONXLoader=le,Object.defineProperty(e,"__esModule",{value:!0})})),function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}({"./node_modules/escodegen/escodegen.js":
/*!*********************************************!*\
  !*** ./node_modules/escodegen/escodegen.js ***!
  \*********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){(function(e){!function(){"use strict";var r,n,o,s,a,l,u,c,h,p,d,f,m,g,v,y,b,_,x,E,w,T,M,C,S,j;function P(e){return X.Statement.hasOwnProperty(e.type)}a=i(/*! estraverse */"./node_modules/estraverse/estraverse.js"),l=i(/*! esutils */"./node_modules/esutils/lib/utils.js"),r=a.Syntax,o={"||":(n={Sequence:0,Yield:1,Assignment:1,Conditional:2,ArrowFunction:2,LogicalOR:3,LogicalAND:4,BitwiseOR:5,BitwiseXOR:6,BitwiseAND:7,Equality:8,Relational:9,BitwiseSHIFT:10,Additive:11,Multiplicative:12,Await:13,Unary:13,Postfix:14,Call:15,New:16,TaggedTemplate:17,Member:18,Primary:19}).LogicalOR,"&&":n.LogicalAND,"|":n.BitwiseOR,"^":n.BitwiseXOR,"&":n.BitwiseAND,"==":n.Equality,"!=":n.Equality,"===":n.Equality,"!==":n.Equality,is:n.Equality,isnt:n.Equality,"<":n.Relational,">":n.Relational,"<=":n.Relational,">=":n.Relational,in:n.Relational,instanceof:n.Relational,"<<":n.BitwiseSHIFT,">>":n.BitwiseSHIFT,">>>":n.BitwiseSHIFT,"+":n.Additive,"-":n.Additive,"*":n.Multiplicative,"%":n.Multiplicative,"/":n.Multiplicative};function R(e,t){var i="";for(t|=0;t>0;t>>>=1,e+=e)1&t&&(i+=e);return i}function D(e){var t=e.length;return t&&l.code.isLineTerminator(e.charCodeAt(t-1))}function A(e,t){var i;for(i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function k(e,t){var i,r;function n(e){return"object"==typeof e&&e instanceof Object&&!(e instanceof RegExp)}for(i in t)t.hasOwnProperty(i)&&(n(r=t[i])?n(e[i])?k(e[i],r):e[i]=k({},r):e[i]=r);return e}function O(e,t){return 8232==(-2&e)?(t?"u":"\\u")+(8232===e?"2028":"2029"):10===e||13===e?(t?"":"\\")+(10===e?"n":"r"):String.fromCharCode(e)}function B(e,t){var i;return 8===e?"\\b":12===e?"\\f":9===e?"\\t":(i=e.toString(16).toUpperCase(),h||e>255?"\\u"+"0000".slice(i.length)+i:0!==e||l.code.isDecimalDigit(t)?11===e?"\\x0B":"\\x"+"00".slice(i.length)+i:"\\0")}function F(e){if(92===e)return"\\\\";if(10===e)return"\\n";if(13===e)return"\\r";if(8232===e)return"\\u2028";if(8233===e)return"\\u2029";throw new Error("Incorrectly classified character")}function L(e,t){if(!T)return Array.isArray(e)?function e(t){var i,r,n,o="";for(i=0,r=t.length;i<r;++i)n=t[i],o+=Array.isArray(n)?e(n):n;return o}(e):e;if(null==t){if(e instanceof s)return e;t={}}return null==t.loc?new s(null,null,T,e,t.name||null):new s(t.loc.start.line,t.loc.start.column,!0===T?t.loc.source||null:T,e,t.name||null)}function I(){return v||" "}function N(e,t){var i,r,n,o;return 0===(i=L(e).toString()).length?[t]:0===(r=L(t).toString()).length?[e]:(n=i.charCodeAt(i.length-1),o=r.charCodeAt(0),(43===n||45===n)&&n===o||l.code.isIdentifierPartES5(n)&&l.code.isIdentifierPartES5(o)||47===n&&105===o?[e,I(),t]:l.code.isWhiteSpace(n)||l.code.isLineTerminator(n)||l.code.isWhiteSpace(o)||l.code.isLineTerminator(o)?[e,t]:[e,v,t])}function U(e){return[u,e]}function z(e){var t;t=u,e(u+=c),u=t}function H(e,t){if("Line"===e.type){if(D(e.value))return"//"+e.value;var i="//"+e.value;return C||(i+="\n"),i}return E.format.indent.adjustMultilineComment&&/[\n\r]/.test(e.value)?function(e,t){var i,r,n,o,s,a,c,h;for(i=e.split(/\r\n|[\r\n]/),a=Number.MAX_VALUE,r=1,n=i.length;r<n;++r){for(o=i[r],s=0;s<o.length&&l.code.isWhiteSpace(o.charCodeAt(s));)++s;a>s&&(a=s)}for(void 0!==t?(c=u,"*"===i[1][a]&&(t+=" "),u=t):(1&a&&--a,c=u),r=1,n=i.length;r<n;++r)h=L(U(i[r].slice(a))),i[r]=T?h.join(""):h;return u=c,i.join("\n")}("/*"+e.value+"*/",t):"/*"+e.value+"*/"}function V(e,t){var i,n,o,s,a,h,p,d,f,m,g,v;if(e.leadingComments&&e.leadingComments.length>0){if(s=t,C){for(t=[],d=(o=e.leadingComments[0]).extendedRange,f=o.range,(v=((g=M.substring(d[0],f[0])).match(/\n/g)||[]).length)>0?(t.push(R("\n",v)),t.push(U(H(o)))):(t.push(g),t.push(H(o))),m=f,i=1,n=e.leadingComments.length;i<n;i++)f=(o=e.leadingComments[i]).range,v=(M.substring(m[1],f[0]).match(/\n/g)||[]).length,t.push(R("\n",v)),t.push(U(H(o))),m=f;v=(M.substring(f[1],d[1]).match(/\n/g)||[]).length,t.push(R("\n",v))}else for(o=e.leadingComments[0],t=[],_&&e.type===r.Program&&0===e.body.length&&t.push("\n"),t.push(H(o)),D(L(t).toString())||t.push("\n"),i=1,n=e.leadingComments.length;i<n;++i)D(L(p=[H(o=e.leadingComments[i])]).toString())||p.push("\n"),t.push(U(p));t.push(U(s))}if(e.trailingComments)if(C)d=(o=e.trailingComments[0]).extendedRange,f=o.range,(v=((g=M.substring(d[0],f[0])).match(/\n/g)||[]).length)>0?(t.push(R("\n",v)),t.push(U(H(o)))):(t.push(g),t.push(H(o)));else for(a=!D(L(t).toString()),h=R(" ",function(e){var t;for(t=e.length-1;t>=0&&!l.code.isLineTerminator(e.charCodeAt(t));--t);return e.length-1-t}(L([u,t,c]).toString())),i=0,n=e.trailingComments.length;i<n;++i)o=e.trailingComments[i],a?(t=0===i?[t,c]:[t,h]).push(H(o,h)):t=[t,U(H(o))],i===n-1||D(L(t).toString())||(t=[t,"\n"]);return t}function W(e,t,i){var r,n=0;for(r=e;r<t;r++)"\n"===M[r]&&n++;for(r=1;r<n;r++)i.push(g)}function G(e,t,i){return t<i?["(",e,")"]:e}function q(e){var t,i,r;for(t=1,i=(r=e.split(/\r\n|\n/)).length;t<i;t++)r[t]=g+u+r[t];return r}function X(){}function J(e){return L(e.name,e)}function Y(e,t){return e.async?"async"+(t?I():v):""}function Z(e){return e.generator&&!E.moz.starlessGenerator?"*"+v:""}function Q(e){var t=e.value,i="";return t.async&&(i+=Y(t,!e.computed)),t.generator&&(i+=Z(t)?"*":""),i}function K(e){var t;if(t=new X,P(e))return t.generateStatement(e,1);if(function(e){return X.Expression.hasOwnProperty(e.type)}(e))return t.generateExpression(e,n.Sequence,7);throw new Error("Unknown node type: "+e.type)}X.prototype.maybeBlock=function(e,t){var i,n,o=this;return n=!E.comment||!e.leadingComments,e.type===r.BlockStatement&&n?[v,this.generateStatement(e,t)]:e.type===r.EmptyStatement&&n?";":(z((function(){i=[g,U(o.generateStatement(e,t))]})),i)},X.prototype.maybeBlockSuffix=function(e,t){var i=D(L(t).toString());return e.type!==r.BlockStatement||E.comment&&e.leadingComments||i?i?[t,u]:[t,g,u]:[t,v]},X.prototype.generatePattern=function(e,t,i){return e.type===r.Identifier?J(e):this.generateExpression(e,t,i)},X.prototype.generateFunctionParams=function(e){var t,i,o,s;if(s=!1,e.type!==r.ArrowFunctionExpression||e.rest||e.defaults&&0!==e.defaults.length||1!==e.params.length||e.params[0].type!==r.Identifier){for((o=e.type===r.ArrowFunctionExpression?[Y(e,!1)]:[]).push("("),e.defaults&&(s=!0),t=0,i=e.params.length;t<i;++t)s&&e.defaults[t]?o.push(this.generateAssignment(e.params[t],e.defaults[t],"=",n.Assignment,7)):o.push(this.generatePattern(e.params[t],n.Assignment,7)),t+1<i&&o.push(","+v);e.rest&&(e.params.length&&o.push(","+v),o.push("..."),o.push(J(e.rest))),o.push(")")}else o=[Y(e,!0),J(e.params[0])];return o},X.prototype.generateFunctionBody=function(e){var t,i;return t=this.generateFunctionParams(e),e.type===r.ArrowFunctionExpression&&(t.push(v),t.push("=>")),e.expression?(t.push(v),"{"===(i=this.generateExpression(e.body,n.Assignment,7)).toString().charAt(0)&&(i=["(",i,")"]),t.push(i)):t.push(this.maybeBlock(e.body,9)),t},X.prototype.generateIterationForStatement=function(e,t,i){var o=["for"+v+(t.await?"await"+v:"")+"("],s=this;return z((function(){t.left.type===r.VariableDeclaration?z((function(){o.push(t.left.kind+I()),o.push(s.generateStatement(t.left.declarations[0],0))})):o.push(s.generateExpression(t.left,n.Call,7)),o=N(o,e),o=[N(o,s.generateExpression(t.right,n.Assignment,7)),")"]})),o.push(this.maybeBlock(t.body,i)),o},X.prototype.generatePropertyKey=function(e,t){var i=[];return t&&i.push("["),i.push(this.generateExpression(e,n.Sequence,7)),t&&i.push("]"),i},X.prototype.generateAssignment=function(e,t,i,r,o){return n.Assignment<r&&(o|=1),G([this.generateExpression(e,n.Call,o),v+i+v,this.generateExpression(t,n.Assignment,o)],n.Assignment,r)},X.prototype.semicolon=function(e){return!b&&32&e?"":";"},X.Statement={BlockStatement:function(e,t){var i,r,n=["{",g],o=this;return z((function(){var s,a,l,u;for(0===e.body.length&&C&&(i=e.range)[1]-i[0]>2&&("\n"===(r=M.substring(i[0]+1,i[1]-1))[0]&&(n=["{"]),n.push(r)),u=1,8&t&&(u|=16),s=0,a=e.body.length;s<a;++s)C&&(0===s&&(e.body[0].leadingComments&&(i=e.body[0].leadingComments[0].extendedRange,"\n"===(r=M.substring(i[0],i[1]))[0]&&(n=["{"])),e.body[0].leadingComments||W(e.range[0],e.body[0].range[0],n)),s>0&&(e.body[s-1].trailingComments||e.body[s].leadingComments||W(e.body[s-1].range[1],e.body[s].range[0],n))),s===a-1&&(u|=32),l=e.body[s].leadingComments&&C?o.generateStatement(e.body[s],u):U(o.generateStatement(e.body[s],u)),n.push(l),D(L(l).toString())||C&&s<a-1&&e.body[s+1].leadingComments||n.push(g),C&&s===a-1&&(e.body[s].trailingComments||W(e.body[s].range[1],e.range[1],n))})),n.push(U("}")),n},BreakStatement:function(e,t){return e.label?"break "+e.label.name+this.semicolon(t):"break"+this.semicolon(t)},ContinueStatement:function(e,t){return e.label?"continue "+e.label.name+this.semicolon(t):"continue"+this.semicolon(t)},ClassBody:function(e,t){var i=["{",g],r=this;return z((function(t){var o,s;for(o=0,s=e.body.length;o<s;++o)i.push(t),i.push(r.generateExpression(e.body[o],n.Sequence,7)),o+1<s&&i.push(g)})),D(L(i).toString())||i.push(g),i.push(u),i.push("}"),i},ClassDeclaration:function(e,t){var i,r;return i=["class"],e.id&&(i=N(i,this.generateExpression(e.id,n.Sequence,7))),e.superClass&&(r=N("extends",this.generateExpression(e.superClass,n.Assignment,7)),i=N(i,r)),i.push(v),i.push(this.generateStatement(e.body,33)),i},DirectiveStatement:function(e,t){return E.raw&&e.raw?e.raw+this.semicolon(t):function(e){var t,i,r,n;for(n="double"===f?'"':"'",t=0,i=e.length;t<i;++t){if(39===(r=e.charCodeAt(t))){n='"';break}if(34===r){n="'";break}92===r&&++t}return n+e+n}(e.directive)+this.semicolon(t)},DoWhileStatement:function(e,t){var i=N("do",this.maybeBlock(e.body,1));return N(i=this.maybeBlockSuffix(e.body,i),["while"+v+"(",this.generateExpression(e.test,n.Sequence,7),")"+this.semicolon(t)])},CatchClause:function(e,t){var i,r=this;return z((function(){var t;i=["catch"+v+"(",r.generateExpression(e.param,n.Sequence,7),")"],e.guard&&(t=r.generateExpression(e.guard,n.Sequence,7),i.splice(2,0," if ",t))})),i.push(this.maybeBlock(e.body,1)),i},DebuggerStatement:function(e,t){return"debugger"+this.semicolon(t)},EmptyStatement:function(e,t){return";"},ExportDefaultDeclaration:function(e,t){var i,r=["export"];return i=32&t?33:1,r=N(r,"default"),P(e.declaration)?N(r,this.generateStatement(e.declaration,i)):N(r,this.generateExpression(e.declaration,n.Assignment,7)+this.semicolon(t))},ExportNamedDeclaration:function(e,t){var i,o=["export"],s=this;return i=32&t?33:1,e.declaration?N(o,this.generateStatement(e.declaration,i)):(e.specifiers&&(0===e.specifiers.length?o=N(o,"{"+v+"}"):e.specifiers[0].type===r.ExportBatchSpecifier?o=N(o,this.generateExpression(e.specifiers[0],n.Sequence,7)):(o=N(o,"{"),z((function(t){var i,r;for(o.push(g),i=0,r=e.specifiers.length;i<r;++i)o.push(t),o.push(s.generateExpression(e.specifiers[i],n.Sequence,7)),i+1<r&&o.push(","+g)})),D(L(o).toString())||o.push(g),o.push(u+"}")),e.source?o=N(o,["from"+v,this.generateExpression(e.source,n.Sequence,7),this.semicolon(t)]):o.push(this.semicolon(t))),o)},ExportAllDeclaration:function(e,t){return["export"+v,"*"+v,"from"+v,this.generateExpression(e.source,n.Sequence,7),this.semicolon(t)]},ExpressionStatement:function(e,t){var i,o;return 123===(o=L(i=[this.generateExpression(e.expression,n.Sequence,7)]).toString()).charCodeAt(0)||function(e){var t;return"class"===e.slice(0,5)&&(123===(t=e.charCodeAt(5))||l.code.isWhiteSpace(t)||l.code.isLineTerminator(t))}(o)||function(e){var t;return"function"===e.slice(0,8)&&(40===(t=e.charCodeAt(8))||l.code.isWhiteSpace(t)||42===t||l.code.isLineTerminator(t))}(o)||function(e){var t,i,r;if("async"!==e.slice(0,5))return!1;if(!l.code.isWhiteSpace(e.charCodeAt(5)))return!1;for(i=6,r=e.length;i<r&&l.code.isWhiteSpace(e.charCodeAt(i));++i);return i!==r&&"function"===e.slice(i,i+8)&&(40===(t=e.charCodeAt(i+8))||l.code.isWhiteSpace(t)||42===t||l.code.isLineTerminator(t))}(o)||x&&16&t&&e.expression.type===r.Literal&&"string"==typeof e.expression.value?i=["(",i,")"+this.semicolon(t)]:i.push(this.semicolon(t)),i},ImportDeclaration:function(e,t){var i,o,s=this;return 0===e.specifiers.length?["import",v,this.generateExpression(e.source,n.Sequence,7),this.semicolon(t)]:(i=["import"],o=0,e.specifiers[o].type===r.ImportDefaultSpecifier&&(i=N(i,[this.generateExpression(e.specifiers[o],n.Sequence,7)]),++o),e.specifiers[o]&&(0!==o&&i.push(","),e.specifiers[o].type===r.ImportNamespaceSpecifier?i=N(i,[v,this.generateExpression(e.specifiers[o],n.Sequence,7)]):(i.push(v+"{"),e.specifiers.length-o==1?(i.push(v),i.push(this.generateExpression(e.specifiers[o],n.Sequence,7)),i.push(v+"}"+v)):(z((function(t){var r,a;for(i.push(g),r=o,a=e.specifiers.length;r<a;++r)i.push(t),i.push(s.generateExpression(e.specifiers[r],n.Sequence,7)),r+1<a&&i.push(","+g)})),D(L(i).toString())||i.push(g),i.push(u+"}"+v)))),i=N(i,["from"+v,this.generateExpression(e.source,n.Sequence,7),this.semicolon(t)]))},VariableDeclarator:function(e,t){var i=1&t?7:6;return e.init?[this.generateExpression(e.id,n.Assignment,i),v,"=",v,this.generateExpression(e.init,n.Assignment,i)]:this.generatePattern(e.id,n.Assignment,i)},VariableDeclaration:function(e,t){var i,r,n,o,s,a=this;function l(){for(o=e.declarations[0],E.comment&&o.leadingComments?(i.push("\n"),i.push(U(a.generateStatement(o,s)))):(i.push(I()),i.push(a.generateStatement(o,s))),r=1,n=e.declarations.length;r<n;++r)o=e.declarations[r],E.comment&&o.leadingComments?(i.push(","+g),i.push(U(a.generateStatement(o,s)))):(i.push(","+v),i.push(a.generateStatement(o,s)))}return i=[e.kind],s=1&t?1:0,e.declarations.length>1?z(l):l(),i.push(this.semicolon(t)),i},ThrowStatement:function(e,t){return[N("throw",this.generateExpression(e.argument,n.Sequence,7)),this.semicolon(t)]},TryStatement:function(e,t){var i,r,n,o;if(i=["try",this.maybeBlock(e.block,1)],i=this.maybeBlockSuffix(e.block,i),e.handlers)for(r=0,n=e.handlers.length;r<n;++r)i=N(i,this.generateStatement(e.handlers[r],1)),(e.finalizer||r+1!==n)&&(i=this.maybeBlockSuffix(e.handlers[r].body,i));else{for(r=0,n=(o=e.guardedHandlers||[]).length;r<n;++r)i=N(i,this.generateStatement(o[r],1)),(e.finalizer||r+1!==n)&&(i=this.maybeBlockSuffix(o[r].body,i));if(e.handler)if(Array.isArray(e.handler))for(r=0,n=e.handler.length;r<n;++r)i=N(i,this.generateStatement(e.handler[r],1)),(e.finalizer||r+1!==n)&&(i=this.maybeBlockSuffix(e.handler[r].body,i));else i=N(i,this.generateStatement(e.handler,1)),e.finalizer&&(i=this.maybeBlockSuffix(e.handler.body,i))}return e.finalizer&&(i=N(i,["finally",this.maybeBlock(e.finalizer,1)])),i},SwitchStatement:function(e,t){var i,r,o,s,a,l=this;if(z((function(){i=["switch"+v+"(",l.generateExpression(e.discriminant,n.Sequence,7),")"+v+"{"+g]})),e.cases)for(a=1,o=0,s=e.cases.length;o<s;++o)o===s-1&&(a|=32),r=U(this.generateStatement(e.cases[o],a)),i.push(r),D(L(r).toString())||i.push(g);return i.push(U("}")),i},SwitchCase:function(e,t){var i,o,s,a,l,u=this;return z((function(){for(i=e.test?[N("case",u.generateExpression(e.test,n.Sequence,7)),":"]:["default:"],s=0,(a=e.consequent.length)&&e.consequent[0].type===r.BlockStatement&&(o=u.maybeBlock(e.consequent[0],1),i.push(o),s=1),s===a||D(L(i).toString())||i.push(g),l=1;s<a;++s)s===a-1&&32&t&&(l|=32),o=U(u.generateStatement(e.consequent[s],l)),i.push(o),s+1===a||D(L(o).toString())||i.push(g)})),i},IfStatement:function(e,t){var i,o,s=this;return z((function(){i=["if"+v+"(",s.generateExpression(e.test,n.Sequence,7),")"]})),o=1,32&t&&(o|=32),e.alternate?(i.push(this.maybeBlock(e.consequent,1)),i=this.maybeBlockSuffix(e.consequent,i),i=e.alternate.type===r.IfStatement?N(i,["else ",this.generateStatement(e.alternate,o)]):N(i,N("else",this.maybeBlock(e.alternate,o)))):i.push(this.maybeBlock(e.consequent,o)),i},ForStatement:function(e,t){var i,o=this;return z((function(){i=["for"+v+"("],e.init?e.init.type===r.VariableDeclaration?i.push(o.generateStatement(e.init,0)):(i.push(o.generateExpression(e.init,n.Sequence,6)),i.push(";")):i.push(";"),e.test?(i.push(v),i.push(o.generateExpression(e.test,n.Sequence,7)),i.push(";")):i.push(";"),e.update?(i.push(v),i.push(o.generateExpression(e.update,n.Sequence,7)),i.push(")")):i.push(")")})),i.push(this.maybeBlock(e.body,32&t?33:1)),i},ForInStatement:function(e,t){return this.generateIterationForStatement("in",e,32&t?33:1)},ForOfStatement:function(e,t){return this.generateIterationForStatement("of",e,32&t?33:1)},LabeledStatement:function(e,t){return[e.label.name+":",this.maybeBlock(e.body,32&t?33:1)]},Program:function(e,t){var i,r,n,o,s;for(o=e.body.length,i=[_&&o>0?"\n":""],s=17,n=0;n<o;++n)_||n!==o-1||(s|=32),C&&(0===n&&(e.body[0].leadingComments||W(e.range[0],e.body[n].range[0],i)),n>0&&(e.body[n-1].trailingComments||e.body[n].leadingComments||W(e.body[n-1].range[1],e.body[n].range[0],i))),r=U(this.generateStatement(e.body[n],s)),i.push(r),n+1<o&&!D(L(r).toString())&&(C&&e.body[n+1].leadingComments||i.push(g)),C&&n===o-1&&(e.body[n].trailingComments||W(e.body[n].range[1],e.range[1],i));return i},FunctionDeclaration:function(e,t){return[Y(e,!0),"function",Z(e)||I(),e.id?J(e.id):"",this.generateFunctionBody(e)]},ReturnStatement:function(e,t){return e.argument?[N("return",this.generateExpression(e.argument,n.Sequence,7)),this.semicolon(t)]:["return"+this.semicolon(t)]},WhileStatement:function(e,t){var i,r=this;return z((function(){i=["while"+v+"(",r.generateExpression(e.test,n.Sequence,7),")"]})),i.push(this.maybeBlock(e.body,32&t?33:1)),i},WithStatement:function(e,t){var i,r=this;return z((function(){i=["with"+v+"(",r.generateExpression(e.object,n.Sequence,7),")"]})),i.push(this.maybeBlock(e.body,32&t?33:1)),i}},A(X.prototype,X.Statement),X.Expression={SequenceExpression:function(e,t,i){var r,o,s;for(n.Sequence<t&&(i|=1),r=[],o=0,s=e.expressions.length;o<s;++o)r.push(this.generateExpression(e.expressions[o],n.Assignment,i)),o+1<s&&r.push(","+v);return G(r,n.Sequence,t)},AssignmentExpression:function(e,t,i){return this.generateAssignment(e.left,e.right,e.operator,t,i)},ArrowFunctionExpression:function(e,t,i){return G(this.generateFunctionBody(e),n.ArrowFunction,t)},ConditionalExpression:function(e,t,i){return n.Conditional<t&&(i|=1),G([this.generateExpression(e.test,n.LogicalOR,i),v+"?"+v,this.generateExpression(e.consequent,n.Assignment,i),v+":"+v,this.generateExpression(e.alternate,n.Assignment,i)],n.Conditional,t)},LogicalExpression:function(e,t,i){return this.BinaryExpression(e,t,i)},BinaryExpression:function(e,t,i){var r,n,s,a;return(n=o[e.operator])<t&&(i|=1),r=47===(a=(s=this.generateExpression(e.left,n,i)).toString()).charCodeAt(a.length-1)&&l.code.isIdentifierPartES5(e.operator.charCodeAt(0))?[s,I(),e.operator]:N(s,e.operator),s=this.generateExpression(e.right,n+1,i),"/"===e.operator&&"/"===s.toString().charAt(0)||"<"===e.operator.slice(-1)&&"!--"===s.toString().slice(0,3)?(r.push(I()),r.push(s)):r=N(r,s),"in"!==e.operator||1&i?G(r,n,t):["(",r,")"]},CallExpression:function(e,t,i){var r,o,s;for((r=[this.generateExpression(e.callee,n.Call,3)]).push("("),o=0,s=e.arguments.length;o<s;++o)r.push(this.generateExpression(e.arguments[o],n.Assignment,7)),o+1<s&&r.push(","+v);return r.push(")"),2&i?G(r,n.Call,t):["(",r,")"]},NewExpression:function(e,t,i){var r,o,s,a,l;if(o=e.arguments.length,l=4&i&&!y&&0===o?5:1,r=N("new",this.generateExpression(e.callee,n.New,l)),!(4&i)||y||o>0){for(r.push("("),s=0,a=o;s<a;++s)r.push(this.generateExpression(e.arguments[s],n.Assignment,7)),s+1<a&&r.push(","+v);r.push(")")}return G(r,n.New,t)},MemberExpression:function(e,t,i){var o,s;return o=[this.generateExpression(e.object,n.Call,2&i?3:1)],e.computed?(o.push("["),o.push(this.generateExpression(e.property,n.Sequence,2&i?7:5)),o.push("]")):(e.object.type===r.Literal&&"number"==typeof e.object.value&&(s=L(o).toString()).indexOf(".")<0&&!/[eExX]/.test(s)&&l.code.isDecimalDigit(s.charCodeAt(s.length-1))&&!(s.length>=2&&48===s.charCodeAt(0))&&o.push(" "),o.push("."),o.push(J(e.property))),G(o,n.Member,t)},MetaProperty:function(e,t,i){var r;return(r=[]).push("string"==typeof e.meta?e.meta:J(e.meta)),r.push("."),r.push("string"==typeof e.property?e.property:J(e.property)),G(r,n.Member,t)},UnaryExpression:function(e,t,i){var r,o,s,a,u;return o=this.generateExpression(e.argument,n.Unary,7),""===v?r=N(e.operator,o):(r=[e.operator],e.operator.length>2?r=N(r,o):(u=(a=L(r).toString()).charCodeAt(a.length-1),s=o.toString().charCodeAt(0),(43===u||45===u)&&u===s||l.code.isIdentifierPartES5(u)&&l.code.isIdentifierPartES5(s)?(r.push(I()),r.push(o)):r.push(o))),G(r,n.Unary,t)},YieldExpression:function(e,t,i){var r;return r=e.delegate?"yield*":"yield",e.argument&&(r=N(r,this.generateExpression(e.argument,n.Yield,7))),G(r,n.Yield,t)},AwaitExpression:function(e,t,i){return G(N(e.all?"await*":"await",this.generateExpression(e.argument,n.Await,7)),n.Await,t)},UpdateExpression:function(e,t,i){return e.prefix?G([e.operator,this.generateExpression(e.argument,n.Unary,7)],n.Unary,t):G([this.generateExpression(e.argument,n.Postfix,7),e.operator],n.Postfix,t)},FunctionExpression:function(e,t,i){var r=[Y(e,!0),"function"];return e.id?(r.push(Z(e)||I()),r.push(J(e.id))):r.push(Z(e)||v),r.push(this.generateFunctionBody(e)),r},ArrayPattern:function(e,t,i){return this.ArrayExpression(e,t,i,!0)},ArrayExpression:function(e,t,i,r){var o,s,a=this;return e.elements.length?(s=!r&&e.elements.length>1,o=["[",s?g:""],z((function(t){var i,r;for(i=0,r=e.elements.length;i<r;++i)e.elements[i]?(o.push(s?t:""),o.push(a.generateExpression(e.elements[i],n.Assignment,7))):(s&&o.push(t),i+1===r&&o.push(",")),i+1<r&&o.push(","+(s?g:v))})),s&&!D(L(o).toString())&&o.push(g),o.push(s?u:""),o.push("]"),o):"[]"},RestElement:function(e,t,i){return"..."+this.generatePattern(e.argument)},ClassExpression:function(e,t,i){var r,o;return r=["class"],e.id&&(r=N(r,this.generateExpression(e.id,n.Sequence,7))),e.superClass&&(o=N("extends",this.generateExpression(e.superClass,n.Assignment,7)),r=N(r,o)),r.push(v),r.push(this.generateStatement(e.body,33)),r},MethodDefinition:function(e,t,i){var r,n;return r=e.static?["static"+v]:[],n="get"===e.kind||"set"===e.kind?[N(e.kind,this.generatePropertyKey(e.key,e.computed)),this.generateFunctionBody(e.value)]:[Q(e),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)],N(r,n)},Property:function(e,t,i){return"get"===e.kind||"set"===e.kind?[e.kind,I(),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)]:e.shorthand?"AssignmentPattern"===e.value.type?this.AssignmentPattern(e.value,n.Sequence,7):this.generatePropertyKey(e.key,e.computed):e.method?[Q(e),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)]:[this.generatePropertyKey(e.key,e.computed),":"+v,this.generateExpression(e.value,n.Assignment,7)]},ObjectExpression:function(e,t,i){var r,o,s,a,l=this;return e.properties.length?(r=e.properties.length>1,z((function(){s=l.generateExpression(e.properties[0],n.Sequence,7)})),r||(a=L(s).toString(),/[\r\n]/g.test(a))?(z((function(t){var i,a;if(o=["{",g,t,s],r)for(o.push(","+g),i=1,a=e.properties.length;i<a;++i)o.push(t),o.push(l.generateExpression(e.properties[i],n.Sequence,7)),i+1<a&&o.push(","+g)})),D(L(o).toString())||o.push(g),o.push(u),o.push("}"),o):["{",v,s,v,"}"]):"{}"},AssignmentPattern:function(e,t,i){return this.generateAssignment(e.left,e.right,"=",t,i)},ObjectPattern:function(e,t,i){var o,s,a,l,c=this;if(!e.properties.length)return"{}";if(l=!1,1===e.properties.length)e.properties[0].value.type!==r.Identifier&&(l=!0);else for(s=0,a=e.properties.length;s<a;++s)if(!e.properties[s].shorthand){l=!0;break}return o=["{",l?g:""],z((function(t){var i,r;for(i=0,r=e.properties.length;i<r;++i)o.push(l?t:""),o.push(c.generateExpression(e.properties[i],n.Sequence,7)),i+1<r&&o.push(","+(l?g:v))})),l&&!D(L(o).toString())&&o.push(g),o.push(l?u:""),o.push("}"),o},ThisExpression:function(e,t,i){return"this"},Super:function(e,t,i){return"super"},Identifier:function(e,t,i){return J(e)},ImportDefaultSpecifier:function(e,t,i){return J(e.id||e.local)},ImportNamespaceSpecifier:function(e,t,i){var r=["*"],n=e.id||e.local;return n&&r.push(v+"as"+I()+J(n)),r},ImportSpecifier:function(e,t,i){var r=e.imported,n=[r.name],o=e.local;return o&&o.name!==r.name&&n.push(I()+"as"+I()+J(o)),n},ExportSpecifier:function(e,t,i){var r=e.local,n=[r.name],o=e.exported;return o&&o.name!==r.name&&n.push(I()+"as"+I()+J(o)),n},Literal:function(e,t,i){var n;if(e.hasOwnProperty("raw")&&w&&E.raw)try{if((n=w(e.raw).body[0].expression).type===r.Literal&&n.value===e.value)return e.raw}catch(e){}return null===e.value?"null":"string"==typeof e.value?function(e){var t,i,r,n,o,s="",a=0,u=0;for(t=0,i=e.length;t<i;++t){if(39===(r=e.charCodeAt(t)))++a;else if(34===r)++u;else if(47===r&&h)s+="\\";else{if(l.code.isLineTerminator(r)||92===r){s+=F(r);continue}if(!l.code.isIdentifierPartES5(r)&&(h&&r<32||!h&&!m&&(r<32||r>126))){s+=B(r,e.charCodeAt(t+1));continue}}s+=String.fromCharCode(r)}if(o=(n=!("double"===f||"auto"===f&&u<a))?"'":'"',!(n?a:u))return o+s+o;for(e=s,s=o,t=0,i=e.length;t<i;++t)(39===(r=e.charCodeAt(t))&&n||34===r&&!n)&&(s+="\\"),s+=String.fromCharCode(r);return s+o}(e.value):"number"==typeof e.value?function(e){var t,i,r,n,o;if(e!=e)throw new Error("Numeric literal whose value is NaN");if(e<0||0===e&&1/e<0)throw new Error("Numeric literal whose value is negative");if(e===1/0)return h?"null":p?"1e400":"1e+400";if(t=""+e,!p||t.length<3)return t;for(i=t.indexOf("."),h||48!==t.charCodeAt(0)||1!==i||(i=0,t=t.slice(1)),r=t,t=t.replace("e+","e"),n=0,(o=r.indexOf("e"))>0&&(n=+r.slice(o+1),r=r.slice(0,o)),i>=0&&(n-=r.length-i-1,r=+(r.slice(0,i)+r.slice(i+1))+""),o=0;48===r.charCodeAt(r.length+o-1);)--o;return 0!==o&&(n-=o,r=r.slice(0,o)),0!==n&&(r+="e"+n),(r.length<t.length||d&&e>1e12&&Math.floor(e)===e&&(r="0x"+e.toString(16)).length<t.length)&&+r===e&&(t=r),t}(e.value):"boolean"==typeof e.value?e.value?"true":"false":e.regex?"/"+e.regex.pattern+"/"+e.regex.flags:function(e){var t,i,r,n,o,s,a,l;if(i=e.toString(),e.source){if(!(t=i.match(/\/([^/]*)$/)))return i;for(r=t[1],i="",a=!1,l=!1,n=0,o=e.source.length;n<o;++n)s=e.source.charCodeAt(n),l?(i+=O(s,l),l=!1):(a?93===s&&(a=!1):47===s?i+="\\":91===s&&(a=!0),i+=O(s,l),l=92===s);return"/"+i+"/"+r}return i}(e.value)},GeneratorExpression:function(e,t,i){return this.ComprehensionExpression(e,t,i)},ComprehensionExpression:function(e,t,i){var o,s,a,l,u=this;return o=e.type===r.GeneratorExpression?["("]:["["],E.moz.comprehensionExpressionStartsWithAssignment&&(l=this.generateExpression(e.body,n.Assignment,7),o.push(l)),e.blocks&&z((function(){for(s=0,a=e.blocks.length;s<a;++s)l=u.generateExpression(e.blocks[s],n.Sequence,7),s>0||E.moz.comprehensionExpressionStartsWithAssignment?o=N(o,l):o.push(l)})),e.filter&&(o=N(o,"if"+v),l=this.generateExpression(e.filter,n.Sequence,7),o=N(o,["(",l,")"])),E.moz.comprehensionExpressionStartsWithAssignment||(l=this.generateExpression(e.body,n.Assignment,7),o=N(o,l)),o.push(e.type===r.GeneratorExpression?")":"]"),o},ComprehensionBlock:function(e,t,i){var o;return o=N(o=e.left.type===r.VariableDeclaration?[e.left.kind,I(),this.generateStatement(e.left.declarations[0],0)]:this.generateExpression(e.left,n.Call,7),e.of?"of":"in"),o=N(o,this.generateExpression(e.right,n.Sequence,7)),["for"+v+"(",o,")"]},SpreadElement:function(e,t,i){return["...",this.generateExpression(e.argument,n.Assignment,7)]},TaggedTemplateExpression:function(e,t,i){var r=3;return 2&i||(r=1),G([this.generateExpression(e.tag,n.Call,r),this.generateExpression(e.quasi,n.Primary,4)],n.TaggedTemplate,t)},TemplateElement:function(e,t,i){return e.value.raw},TemplateLiteral:function(e,t,i){var r,o,s;for(r=["`"],o=0,s=e.quasis.length;o<s;++o)r.push(this.generateExpression(e.quasis[o],n.Primary,7)),o+1<s&&(r.push("${"+v),r.push(this.generateExpression(e.expressions[o],n.Sequence,7)),r.push(v+"}"));return r.push("`"),r},ModuleSpecifier:function(e,t,i){return this.Literal(e,t,i)},ImportExpression:function(e,t,i){return G(["import(",this.generateExpression(e.source,n.Assignment,7),")"],n.Call,t)}},A(X.prototype,X.Expression),X.prototype.generateExpression=function(e,t,i){var o,s;return s=e.type||r.Property,E.verbatim&&e.hasOwnProperty(E.verbatim)?function(e,t){var i;return L("string"==typeof(i=e[E.verbatim])?G(q(i),n.Sequence,t):G(q(i.content),null!=i.precedence?i.precedence:n.Sequence,t),e)}(e,t):(o=this[s](e,t,i),E.comment&&(o=V(e,o)),L(o,e))},X.prototype.generateStatement=function(e,t){var i,n;return i=this[e.type](e,t),E.comment&&(i=V(e,i)),n=L(i).toString(),e.type!==r.Program||_||""!==g||"\n"!==n.charAt(n.length-1)||(i=T?L(i).replaceRight(/\s+$/,""):n.replace(/\s+$/,"")),L(i,e)},S={indent:{style:"",base:0},renumber:!0,hexadecimal:!0,quotes:"auto",escapeless:!0,compact:!0,parentheses:!1,semicolons:!1},j={indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:"\n",space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},t.version=i(/*! ./package.json */"./node_modules/escodegen/package.json").version,t.generate=function(r,n){var o,a,l={indent:null,base:null,parse:null,comment:!1,format:{indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:"\n",space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},moz:{comprehensionExpressionStartsWithAssignment:!1,starlessGenerator:!1},sourceMap:null,sourceMapRoot:null,sourceMapWithCode:!1,directive:!1,raw:!0,verbatim:null,sourceCode:null};return null!=n?("string"==typeof n.indent&&(l.format.indent.style=n.indent),"number"==typeof n.base&&(l.format.indent.base=n.base),n=k(l,n),c=n.format.indent.style,u="string"==typeof n.base?n.base:R(c,n.format.indent.base)):(c=(n=l).format.indent.style,u=R(c,n.format.indent.base)),h=n.format.json,p=n.format.renumber,d=!h&&n.format.hexadecimal,f=h?"double":n.format.quotes,m=n.format.escapeless,g=n.format.newline,v=n.format.space,n.format.compact&&(g=v=c=u=""),y=n.format.parentheses,b=n.format.semicolons,_=n.format.safeConcatenation,x=n.directive,w=h?null:n.parse,T=n.sourceMap,M=n.sourceCode,C=n.format.preserveBlankLines&&null!==M,E=n,T&&(s=t.browser?e.sourceMap.SourceNode:i(/*! source-map */"./node_modules/source-map/source-map.js").SourceNode),o=K(r),T?(a=o.toStringWithSourceMap({file:n.file,sourceRoot:n.sourceMapRoot}),n.sourceContent&&a.map.setSourceContent(n.sourceMap,n.sourceContent),n.sourceMapWithCode?a:a.map.toString()):(a={code:o.toString(),map:null},n.sourceMapWithCode?a:a.code)},t.attachComments=a.attachComments,t.Precedence=k({},n),t.browser=!1,t.FORMAT_MINIFY=S,t.FORMAT_DEFAULTS=j}()}).call(this,i(/*! ./../webpack/buildin/global.js */"./node_modules/webpack/buildin/global.js"))},"./node_modules/escodegen/package.json":
/*!*********************************************!*\
  !*** ./node_modules/escodegen/package.json ***!
  \*********************************************/
/*! exports provided: _from, _id, _inBundle, _integrity, _location, _phantomChildren, _requested, _requiredBy, _resolved, _shasum, _spec, _where, bin, bugs, bundleDependencies, dependencies, deprecated, description, devDependencies, engines, files, homepage, license, main, maintainers, name, optionalDependencies, repository, scripts, version, default */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e){e.exports=JSON.parse('{"_from":"escodegen","_id":"escodegen@1.12.0","_inBundle":false,"_integrity":"sha512-TuA+EhsanGcme5T3R0L80u4t8CpbXQjegRmf7+FPTJrtCTErXFeelblRgHQa1FofEzqYYJmJ/OqjTwREp9qgmg==","_location":"/escodegen","_phantomChildren":{},"_requested":{"type":"tag","registry":true,"raw":"escodegen","name":"escodegen","escapedName":"escodegen","rawSpec":"","saveSpec":null,"fetchSpec":"latest"},"_requiredBy":["#USER","/"],"_resolved":"https://registry.npmjs.org/escodegen/-/escodegen-1.12.0.tgz","_shasum":"f763daf840af172bb3a2b6dd7219c0e17f7ff541","_spec":"escodegen","_where":"D:\\\\SourceCodes\\\\THING.EVAL","bin":{"esgenerate":"./bin/esgenerate.js","escodegen":"./bin/escodegen.js"},"bugs":{"url":"https://github.com/estools/escodegen/issues"},"bundleDependencies":false,"dependencies":{"esprima":"^3.1.3","estraverse":"^4.2.0","esutils":"^2.0.2","optionator":"^0.8.1","source-map":"~0.6.1"},"deprecated":false,"description":"ECMAScript code generator","devDependencies":{"acorn":"^4.0.4","bluebird":"^3.4.7","bower-registry-client":"^1.0.0","chai":"^3.5.0","commonjs-everywhere":"^0.9.7","gulp":"^3.8.10","gulp-eslint":"^3.0.1","gulp-mocha":"^3.0.1","semver":"^5.1.0"},"engines":{"node":">=4.0"},"files":["LICENSE.BSD","README.md","bin","escodegen.js","package.json"],"homepage":"http://github.com/estools/escodegen","license":"BSD-2-Clause","main":"escodegen.js","maintainers":[{"name":"Yusuke Suzuki","email":"utatane.tea@gmail.com","url":"http://github.com/Constellation"}],"name":"escodegen","optionalDependencies":{"source-map":"~0.6.1"},"repository":{"type":"git","url":"git+ssh://git@github.com/estools/escodegen.git"},"scripts":{"build":"cjsify -a path: tools/entry-point.js > escodegen.browser.js","build-min":"cjsify -ma path: tools/entry-point.js > escodegen.browser.min.js","lint":"gulp lint","release":"node tools/release.js","test":"gulp travis","unit-test":"gulp test"},"version":"1.12.0"}')},"./node_modules/esprima/dist/esprima.js":
/*!**********************************************!*\
  !*** ./node_modules/esprima/dist/esprima.js ***!
  \**********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r;r=function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}return i.m=e,i.c=t,i.p="",i(0)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(1),n=i(3),o=i(8),s=i(15);function a(e,t,i){var s=null,a=function(e,t){i&&i(e,t),s&&s.visit(e,t)},l="function"==typeof i?a:null,u=!1;if(t){u="boolean"==typeof t.comment&&t.comment;var c="boolean"==typeof t.attachComment&&t.attachComment;(u||c)&&((s=new r.CommentHandler).attach=c,t.comment=!0,l=a)}var h,p=!1;t&&"string"==typeof t.sourceType&&(p="module"===t.sourceType),h=t&&"boolean"==typeof t.jsx&&t.jsx?new n.JSXParser(e,t,l):new o.Parser(e,t,l);var d=p?h.parseModule():h.parseScript();return u&&s&&(d.comments=s.comments),h.config.tokens&&(d.tokens=h.tokens),h.config.tolerant&&(d.errors=h.errorHandler.errors),d}t.parse=a,t.parseModule=function(e,t,i){var r=t||{};return r.sourceType="module",a(e,r,i)},t.parseScript=function(e,t,i){var r=t||{};return r.sourceType="script",a(e,r,i)},t.tokenize=function(e,t,i){var r,n=new s.Tokenizer(e,t);r=[];try{for(;;){var o=n.getNextToken();if(!o)break;i&&(o=i(o)),r.push(o)}}catch(e){n.errorHandler.tolerate(e)}return n.errorHandler.tolerant&&(r.errors=n.errors()),r};var l=i(2);t.Syntax=l.Syntax,t.version="4.0.1"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(2),n=function(){function e(){this.attach=!1,this.comments=[],this.stack=[],this.leading=[],this.trailing=[]}return e.prototype.insertInnerComments=function(e,t){if(e.type===r.Syntax.BlockStatement&&0===e.body.length){for(var i=[],n=this.leading.length-1;n>=0;--n){var o=this.leading[n];t.end.offset>=o.start&&(i.unshift(o.comment),this.leading.splice(n,1),this.trailing.splice(n,1))}i.length&&(e.innerComments=i)}},e.prototype.findTrailingComments=function(e){var t=[];if(this.trailing.length>0){for(var i=this.trailing.length-1;i>=0;--i){var r=this.trailing[i];r.start>=e.end.offset&&t.unshift(r.comment)}return this.trailing.length=0,t}var n=this.stack[this.stack.length-1];if(n&&n.node.trailingComments){var o=n.node.trailingComments[0];o&&o.range[0]>=e.end.offset&&(t=n.node.trailingComments,delete n.node.trailingComments)}return t},e.prototype.findLeadingComments=function(e){for(var t,i=[];this.stack.length>0&&(o=this.stack[this.stack.length-1])&&o.start>=e.start.offset;)t=o.node,this.stack.pop();if(t){for(var r=(t.leadingComments?t.leadingComments.length:0)-1;r>=0;--r){var n=t.leadingComments[r];n.range[1]<=e.start.offset&&(i.unshift(n),t.leadingComments.splice(r,1))}return t.leadingComments&&0===t.leadingComments.length&&delete t.leadingComments,i}for(r=this.leading.length-1;r>=0;--r){var o;(o=this.leading[r]).start<=e.start.offset&&(i.unshift(o.comment),this.leading.splice(r,1))}return i},e.prototype.visitNode=function(e,t){if(!(e.type===r.Syntax.Program&&e.body.length>0)){this.insertInnerComments(e,t);var i=this.findTrailingComments(t),n=this.findLeadingComments(t);n.length>0&&(e.leadingComments=n),i.length>0&&(e.trailingComments=i),this.stack.push({node:e,start:t.start.offset})}},e.prototype.visitComment=function(e,t){var i="L"===e.type[0]?"Line":"Block",r={type:i,value:e.value};if(e.range&&(r.range=e.range),e.loc&&(r.loc=e.loc),this.comments.push(r),this.attach){var n={comment:{type:i,value:e.value,range:[t.start.offset,t.end.offset]},start:t.start.offset};e.loc&&(n.comment.loc=e.loc),e.type=i,this.leading.push(n),this.trailing.push(n)}},e.prototype.visit=function(e,t){"LineComment"===e.type||"BlockComment"===e.type?this.visitComment(e,t):this.attach&&this.visitNode(e,t)},e}();t.CommentHandler=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"}},function(e,t,i){"use strict";var r,n=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(4),s=i(5),a=i(6),l=i(7),u=i(8),c=i(13),h=i(14);function p(e){var t;switch(e.type){case a.JSXSyntax.JSXIdentifier:t=e.name;break;case a.JSXSyntax.JSXNamespacedName:var i=e;t=p(i.namespace)+":"+p(i.name);break;case a.JSXSyntax.JSXMemberExpression:var r=e;t=p(r.object)+"."+p(r.property)}return t}c.TokenName[100]="JSXIdentifier",c.TokenName[101]="JSXText";var d=function(e){function t(t,i,r){return e.call(this,t,i,r)||this}return n(t,e),t.prototype.parsePrimaryExpression=function(){return this.match("<")?this.parseJSXRoot():e.prototype.parsePrimaryExpression.call(this)},t.prototype.startJSX=function(){this.scanner.index=this.startMarker.index,this.scanner.lineNumber=this.startMarker.line,this.scanner.lineStart=this.startMarker.index-this.startMarker.column},t.prototype.finishJSX=function(){this.nextToken()},t.prototype.reenterJSX=function(){this.startJSX(),this.expectJSX("}"),this.config.tokens&&this.tokens.pop()},t.prototype.createJSXNode=function(){return this.collectComments(),{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},t.prototype.createJSXChildNode=function(){return{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},t.prototype.scanXHTMLEntity=function(e){for(var t="&",i=!0,r=!1,n=!1,s=!1;!this.scanner.eof()&&i&&!r;){var a=this.scanner.source[this.scanner.index];if(a===e)break;if(r=";"===a,t+=a,++this.scanner.index,!r)switch(t.length){case 2:n="#"===a;break;case 3:n&&(i=(s="x"===a)||o.Character.isDecimalDigit(a.charCodeAt(0)),n=n&&!s);break;default:i=(i=i&&!(n&&!o.Character.isDecimalDigit(a.charCodeAt(0))))&&!(s&&!o.Character.isHexDigit(a.charCodeAt(0)))}}if(i&&r&&t.length>2){var l=t.substr(1,t.length-2);n&&l.length>1?t=String.fromCharCode(parseInt(l.substr(1),10)):s&&l.length>2?t=String.fromCharCode(parseInt("0"+l.substr(1),16)):n||s||!h.XHTMLEntities[l]||(t=h.XHTMLEntities[l])}return t},t.prototype.lexJSX=function(){var e=this.scanner.source.charCodeAt(this.scanner.index);if(60===e||62===e||47===e||58===e||61===e||123===e||125===e)return{type:7,value:a=this.scanner.source[this.scanner.index++],lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index-1,end:this.scanner.index};if(34===e||39===e){for(var t=this.scanner.index,i=this.scanner.source[this.scanner.index++],r="";!this.scanner.eof()&&(l=this.scanner.source[this.scanner.index++])!==i;)r+="&"===l?this.scanXHTMLEntity(i):l;return{type:8,value:r,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(46===e){var n=this.scanner.source.charCodeAt(this.scanner.index+1),s=this.scanner.source.charCodeAt(this.scanner.index+2),a=46===n&&46===s?"...":".";return t=this.scanner.index,this.scanner.index+=a.length,{type:7,value:a,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(96===e)return{type:10,value:"",lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index,end:this.scanner.index};if(o.Character.isIdentifierStart(e)&&92!==e){for(t=this.scanner.index,++this.scanner.index;!this.scanner.eof();){var l=this.scanner.source.charCodeAt(this.scanner.index);if(o.Character.isIdentifierPart(l)&&92!==l)++this.scanner.index;else{if(45!==l)break;++this.scanner.index}}return{type:100,value:this.scanner.source.slice(t,this.scanner.index),lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}return this.scanner.lex()},t.prototype.nextJSXToken=function(){this.collectComments(),this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;var e=this.lexJSX();return this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.config.tokens&&this.tokens.push(this.convertToken(e)),e},t.prototype.nextJSXText=function(){this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;for(var e=this.scanner.index,t="";!this.scanner.eof();){var i=this.scanner.source[this.scanner.index];if("{"===i||"<"===i)break;++this.scanner.index,t+=i,o.Character.isLineTerminator(i.charCodeAt(0))&&(++this.scanner.lineNumber,"\r"===i&&"\n"===this.scanner.source[this.scanner.index]&&++this.scanner.index,this.scanner.lineStart=this.scanner.index)}this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart;var r={type:101,value:t,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:e,end:this.scanner.index};return t.length>0&&this.config.tokens&&this.tokens.push(this.convertToken(r)),r},t.prototype.peekJSXToken=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.lexJSX();return this.scanner.restoreState(e),t},t.prototype.expectJSX=function(e){var t=this.nextJSXToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},t.prototype.matchJSX=function(e){var t=this.peekJSXToken();return 7===t.type&&t.value===e},t.prototype.parseJSXIdentifier=function(){var e=this.createJSXNode(),t=this.nextJSXToken();return 100!==t.type&&this.throwUnexpectedToken(t),this.finalize(e,new s.JSXIdentifier(t.value))},t.prototype.parseJSXElementName=function(){var e=this.createJSXNode(),t=this.parseJSXIdentifier();if(this.matchJSX(":")){var i=t;this.expectJSX(":");var r=this.parseJSXIdentifier();t=this.finalize(e,new s.JSXNamespacedName(i,r))}else if(this.matchJSX("."))for(;this.matchJSX(".");){var n=t;this.expectJSX(".");var o=this.parseJSXIdentifier();t=this.finalize(e,new s.JSXMemberExpression(n,o))}return t},t.prototype.parseJSXAttributeName=function(){var e,t=this.createJSXNode(),i=this.parseJSXIdentifier();if(this.matchJSX(":")){var r=i;this.expectJSX(":");var n=this.parseJSXIdentifier();e=this.finalize(t,new s.JSXNamespacedName(r,n))}else e=i;return e},t.prototype.parseJSXStringLiteralAttribute=function(){var e=this.createJSXNode(),t=this.nextJSXToken();8!==t.type&&this.throwUnexpectedToken(t);var i=this.getTokenRaw(t);return this.finalize(e,new l.Literal(t.value,i))},t.prototype.parseJSXExpressionAttribute=function(){var e=this.createJSXNode();this.expectJSX("{"),this.finishJSX(),this.match("}")&&this.tolerateError("JSX attributes must only be assigned a non-empty expression");var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new s.JSXExpressionContainer(t))},t.prototype.parseJSXAttributeValue=function(){return this.matchJSX("{")?this.parseJSXExpressionAttribute():this.matchJSX("<")?this.parseJSXElement():this.parseJSXStringLiteralAttribute()},t.prototype.parseJSXNameValueAttribute=function(){var e=this.createJSXNode(),t=this.parseJSXAttributeName(),i=null;return this.matchJSX("=")&&(this.expectJSX("="),i=this.parseJSXAttributeValue()),this.finalize(e,new s.JSXAttribute(t,i))},t.prototype.parseJSXSpreadAttribute=function(){var e=this.createJSXNode();this.expectJSX("{"),this.expectJSX("..."),this.finishJSX();var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new s.JSXSpreadAttribute(t))},t.prototype.parseJSXAttributes=function(){for(var e=[];!this.matchJSX("/")&&!this.matchJSX(">");){var t=this.matchJSX("{")?this.parseJSXSpreadAttribute():this.parseJSXNameValueAttribute();e.push(t)}return e},t.prototype.parseJSXOpeningElement=function(){var e=this.createJSXNode();this.expectJSX("<");var t=this.parseJSXElementName(),i=this.parseJSXAttributes(),r=this.matchJSX("/");return r&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new s.JSXOpeningElement(t,r,i))},t.prototype.parseJSXBoundaryElement=function(){var e=this.createJSXNode();if(this.expectJSX("<"),this.matchJSX("/")){this.expectJSX("/");var t=this.parseJSXElementName();return this.expectJSX(">"),this.finalize(e,new s.JSXClosingElement(t))}var i=this.parseJSXElementName(),r=this.parseJSXAttributes(),n=this.matchJSX("/");return n&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new s.JSXOpeningElement(i,n,r))},t.prototype.parseJSXEmptyExpression=function(){var e=this.createJSXChildNode();return this.collectComments(),this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.finalize(e,new s.JSXEmptyExpression)},t.prototype.parseJSXExpressionContainer=function(){var e,t=this.createJSXNode();return this.expectJSX("{"),this.matchJSX("}")?(e=this.parseJSXEmptyExpression(),this.expectJSX("}")):(this.finishJSX(),e=this.parseAssignmentExpression(),this.reenterJSX()),this.finalize(t,new s.JSXExpressionContainer(e))},t.prototype.parseJSXChildren=function(){for(var e=[];!this.scanner.eof();){var t=this.createJSXChildNode(),i=this.nextJSXText();if(i.start<i.end){var r=this.getTokenRaw(i),n=this.finalize(t,new s.JSXText(i.value,r));e.push(n)}if("{"!==this.scanner.source[this.scanner.index])break;var o=this.parseJSXExpressionContainer();e.push(o)}return e},t.prototype.parseComplexJSXElement=function(e){for(var t=[];!this.scanner.eof();){e.children=e.children.concat(this.parseJSXChildren());var i=this.createJSXChildNode(),r=this.parseJSXBoundaryElement();if(r.type===a.JSXSyntax.JSXOpeningElement){var n=r;if(n.selfClosing){var o=this.finalize(i,new s.JSXElement(n,[],null));e.children.push(o)}else t.push(e),e={node:i,opening:n,closing:null,children:[]}}if(r.type===a.JSXSyntax.JSXClosingElement){e.closing=r;var l=p(e.opening.name);if(l!==p(e.closing.name)&&this.tolerateError("Expected corresponding JSX closing tag for %0",l),!(t.length>0))break;o=this.finalize(e.node,new s.JSXElement(e.opening,e.children,e.closing)),(e=t[t.length-1]).children.push(o),t.pop()}}return e},t.prototype.parseJSXElement=function(){var e=this.createJSXNode(),t=this.parseJSXOpeningElement(),i=[],r=null;if(!t.selfClosing){var n=this.parseComplexJSXElement({node:e,opening:t,closing:r,children:i});i=n.children,r=n.closing}return this.finalize(e,new s.JSXElement(t,i,r))},t.prototype.parseJSXRoot=function(){this.config.tokens&&this.tokens.pop(),this.startJSX();var e=this.parseJSXElement();return this.finishJSX(),e},t.prototype.isStartOfExpression=function(){return e.prototype.isStartOfExpression.call(this)||this.match("<")},t}(u.Parser);t.JSXParser=d},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};t.Character={fromCodePoint:function(e){return e<65536?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10))+String.fromCharCode(56320+(e-65536&1023))},isWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},isIdentifierStart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&i.NonAsciiIdentifierStart.test(t.Character.fromCodePoint(e))},isIdentifierPart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&i.NonAsciiIdentifierPart.test(t.Character.fromCodePoint(e))},isDecimalDigit:function(e){return e>=48&&e<=57},isHexDigit:function(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102},isOctalDigit:function(e){return e>=48&&e<=55}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(6);t.JSXClosingElement=function(e){this.type=r.JSXSyntax.JSXClosingElement,this.name=e};t.JSXElement=function(e,t,i){this.type=r.JSXSyntax.JSXElement,this.openingElement=e,this.children=t,this.closingElement=i};t.JSXEmptyExpression=function(){this.type=r.JSXSyntax.JSXEmptyExpression};t.JSXExpressionContainer=function(e){this.type=r.JSXSyntax.JSXExpressionContainer,this.expression=e};t.JSXIdentifier=function(e){this.type=r.JSXSyntax.JSXIdentifier,this.name=e};t.JSXMemberExpression=function(e,t){this.type=r.JSXSyntax.JSXMemberExpression,this.object=e,this.property=t};t.JSXAttribute=function(e,t){this.type=r.JSXSyntax.JSXAttribute,this.name=e,this.value=t};t.JSXNamespacedName=function(e,t){this.type=r.JSXSyntax.JSXNamespacedName,this.namespace=e,this.name=t};t.JSXOpeningElement=function(e,t,i){this.type=r.JSXSyntax.JSXOpeningElement,this.name=e,this.selfClosing=t,this.attributes=i};t.JSXSpreadAttribute=function(e){this.type=r.JSXSyntax.JSXSpreadAttribute,this.argument=e};t.JSXText=function(e,t){this.type=r.JSXSyntax.JSXText,this.value=e,this.raw=t}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSXSyntax={JSXAttribute:"JSXAttribute",JSXClosingElement:"JSXClosingElement",JSXElement:"JSXElement",JSXEmptyExpression:"JSXEmptyExpression",JSXExpressionContainer:"JSXExpressionContainer",JSXIdentifier:"JSXIdentifier",JSXMemberExpression:"JSXMemberExpression",JSXNamespacedName:"JSXNamespacedName",JSXOpeningElement:"JSXOpeningElement",JSXSpreadAttribute:"JSXSpreadAttribute",JSXText:"JSXText"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(2);t.ArrayExpression=function(e){this.type=r.Syntax.ArrayExpression,this.elements=e};t.ArrayPattern=function(e){this.type=r.Syntax.ArrayPattern,this.elements=e};t.ArrowFunctionExpression=function(e,t,i){this.type=r.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,this.body=t,this.generator=!1,this.expression=i,this.async=!1};t.AssignmentExpression=function(e,t,i){this.type=r.Syntax.AssignmentExpression,this.operator=e,this.left=t,this.right=i};t.AssignmentPattern=function(e,t){this.type=r.Syntax.AssignmentPattern,this.left=e,this.right=t};t.AsyncArrowFunctionExpression=function(e,t,i){this.type=r.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,this.body=t,this.generator=!1,this.expression=i,this.async=!0};t.AsyncFunctionDeclaration=function(e,t,i){this.type=r.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=i,this.generator=!1,this.expression=!1,this.async=!0};t.AsyncFunctionExpression=function(e,t,i){this.type=r.Syntax.FunctionExpression,this.id=e,this.params=t,this.body=i,this.generator=!1,this.expression=!1,this.async=!0};t.AwaitExpression=function(e){this.type=r.Syntax.AwaitExpression,this.argument=e};t.BinaryExpression=function(e,t,i){var n="||"===e||"&&"===e;this.type=n?r.Syntax.LogicalExpression:r.Syntax.BinaryExpression,this.operator=e,this.left=t,this.right=i};t.BlockStatement=function(e){this.type=r.Syntax.BlockStatement,this.body=e};t.BreakStatement=function(e){this.type=r.Syntax.BreakStatement,this.label=e};t.CallExpression=function(e,t){this.type=r.Syntax.CallExpression,this.callee=e,this.arguments=t};t.CatchClause=function(e,t){this.type=r.Syntax.CatchClause,this.param=e,this.body=t};t.ClassBody=function(e){this.type=r.Syntax.ClassBody,this.body=e};t.ClassDeclaration=function(e,t,i){this.type=r.Syntax.ClassDeclaration,this.id=e,this.superClass=t,this.body=i};t.ClassExpression=function(e,t,i){this.type=r.Syntax.ClassExpression,this.id=e,this.superClass=t,this.body=i};t.ComputedMemberExpression=function(e,t){this.type=r.Syntax.MemberExpression,this.computed=!0,this.object=e,this.property=t};t.ConditionalExpression=function(e,t,i){this.type=r.Syntax.ConditionalExpression,this.test=e,this.consequent=t,this.alternate=i};t.ContinueStatement=function(e){this.type=r.Syntax.ContinueStatement,this.label=e};t.DebuggerStatement=function(){this.type=r.Syntax.DebuggerStatement};t.Directive=function(e,t){this.type=r.Syntax.ExpressionStatement,this.expression=e,this.directive=t};t.DoWhileStatement=function(e,t){this.type=r.Syntax.DoWhileStatement,this.body=e,this.test=t};t.EmptyStatement=function(){this.type=r.Syntax.EmptyStatement};t.ExportAllDeclaration=function(e){this.type=r.Syntax.ExportAllDeclaration,this.source=e};t.ExportDefaultDeclaration=function(e){this.type=r.Syntax.ExportDefaultDeclaration,this.declaration=e};t.ExportNamedDeclaration=function(e,t,i){this.type=r.Syntax.ExportNamedDeclaration,this.declaration=e,this.specifiers=t,this.source=i};t.ExportSpecifier=function(e,t){this.type=r.Syntax.ExportSpecifier,this.exported=t,this.local=e};t.ExpressionStatement=function(e){this.type=r.Syntax.ExpressionStatement,this.expression=e};t.ForInStatement=function(e,t,i){this.type=r.Syntax.ForInStatement,this.left=e,this.right=t,this.body=i,this.each=!1};t.ForOfStatement=function(e,t,i){this.type=r.Syntax.ForOfStatement,this.left=e,this.right=t,this.body=i};t.ForStatement=function(e,t,i,n){this.type=r.Syntax.ForStatement,this.init=e,this.test=t,this.update=i,this.body=n};t.FunctionDeclaration=function(e,t,i,n){this.type=r.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=i,this.generator=n,this.expression=!1,this.async=!1};t.FunctionExpression=function(e,t,i,n){this.type=r.Syntax.FunctionExpression,this.id=e,this.params=t,this.body=i,this.generator=n,this.expression=!1,this.async=!1};t.Identifier=function(e){this.type=r.Syntax.Identifier,this.name=e};t.IfStatement=function(e,t,i){this.type=r.Syntax.IfStatement,this.test=e,this.consequent=t,this.alternate=i};t.ImportDeclaration=function(e,t){this.type=r.Syntax.ImportDeclaration,this.specifiers=e,this.source=t};t.ImportDefaultSpecifier=function(e){this.type=r.Syntax.ImportDefaultSpecifier,this.local=e};t.ImportNamespaceSpecifier=function(e){this.type=r.Syntax.ImportNamespaceSpecifier,this.local=e};t.ImportSpecifier=function(e,t){this.type=r.Syntax.ImportSpecifier,this.local=e,this.imported=t};t.LabeledStatement=function(e,t){this.type=r.Syntax.LabeledStatement,this.label=e,this.body=t};t.Literal=function(e,t){this.type=r.Syntax.Literal,this.value=e,this.raw=t};t.MetaProperty=function(e,t){this.type=r.Syntax.MetaProperty,this.meta=e,this.property=t};t.MethodDefinition=function(e,t,i,n,o){this.type=r.Syntax.MethodDefinition,this.key=e,this.computed=t,this.value=i,this.kind=n,this.static=o};t.Module=function(e){this.type=r.Syntax.Program,this.body=e,this.sourceType="module"};t.NewExpression=function(e,t){this.type=r.Syntax.NewExpression,this.callee=e,this.arguments=t};t.ObjectExpression=function(e){this.type=r.Syntax.ObjectExpression,this.properties=e};t.ObjectPattern=function(e){this.type=r.Syntax.ObjectPattern,this.properties=e};t.Property=function(e,t,i,n,o,s){this.type=r.Syntax.Property,this.key=t,this.computed=i,this.value=n,this.kind=e,this.method=o,this.shorthand=s};t.RegexLiteral=function(e,t,i,n){this.type=r.Syntax.Literal,this.value=e,this.raw=t,this.regex={pattern:i,flags:n}};t.RestElement=function(e){this.type=r.Syntax.RestElement,this.argument=e};t.ReturnStatement=function(e){this.type=r.Syntax.ReturnStatement,this.argument=e};t.Script=function(e){this.type=r.Syntax.Program,this.body=e,this.sourceType="script"};t.SequenceExpression=function(e){this.type=r.Syntax.SequenceExpression,this.expressions=e};t.SpreadElement=function(e){this.type=r.Syntax.SpreadElement,this.argument=e};t.StaticMemberExpression=function(e,t){this.type=r.Syntax.MemberExpression,this.computed=!1,this.object=e,this.property=t};t.Super=function(){this.type=r.Syntax.Super};t.SwitchCase=function(e,t){this.type=r.Syntax.SwitchCase,this.test=e,this.consequent=t};t.SwitchStatement=function(e,t){this.type=r.Syntax.SwitchStatement,this.discriminant=e,this.cases=t};t.TaggedTemplateExpression=function(e,t){this.type=r.Syntax.TaggedTemplateExpression,this.tag=e,this.quasi=t};t.TemplateElement=function(e,t){this.type=r.Syntax.TemplateElement,this.value=e,this.tail=t};t.TemplateLiteral=function(e,t){this.type=r.Syntax.TemplateLiteral,this.quasis=e,this.expressions=t};t.ThisExpression=function(){this.type=r.Syntax.ThisExpression};t.ThrowStatement=function(e){this.type=r.Syntax.ThrowStatement,this.argument=e};t.TryStatement=function(e,t,i){this.type=r.Syntax.TryStatement,this.block=e,this.handler=t,this.finalizer=i};t.UnaryExpression=function(e,t){this.type=r.Syntax.UnaryExpression,this.operator=e,this.argument=t,this.prefix=!0};t.UpdateExpression=function(e,t,i){this.type=r.Syntax.UpdateExpression,this.operator=e,this.argument=t,this.prefix=i};t.VariableDeclaration=function(e,t){this.type=r.Syntax.VariableDeclaration,this.declarations=e,this.kind=t};t.VariableDeclarator=function(e,t){this.type=r.Syntax.VariableDeclarator,this.id=e,this.init=t};t.WhileStatement=function(e,t){this.type=r.Syntax.WhileStatement,this.test=e,this.body=t};t.WithStatement=function(e,t){this.type=r.Syntax.WithStatement,this.object=e,this.body=t};t.YieldExpression=function(e,t){this.type=r.Syntax.YieldExpression,this.argument=e,this.delegate=t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(9),n=i(10),o=i(11),s=i(7),a=i(12),l=i(2),u=i(13),c=function(){function e(e,t,i){void 0===t&&(t={}),this.config={range:"boolean"==typeof t.range&&t.range,loc:"boolean"==typeof t.loc&&t.loc,source:null,tokens:"boolean"==typeof t.tokens&&t.tokens,comment:"boolean"==typeof t.comment&&t.comment,tolerant:"boolean"==typeof t.tolerant&&t.tolerant},this.config.loc&&t.source&&null!==t.source&&(this.config.source=String(t.source)),this.delegate=i,this.errorHandler=new n.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new a.Scanner(e,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:2,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={isModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},strict:!1},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}return e.prototype.throwError=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=Array.prototype.slice.call(arguments,1),o=e.replace(/%(\d)/g,(function(e,t){return r.assert(t<n.length,"Message reference must be in range"),n[t]})),s=this.lastMarker.index,a=this.lastMarker.line,l=this.lastMarker.column+1;throw this.errorHandler.createError(s,a,l,o)},e.prototype.tolerateError=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=Array.prototype.slice.call(arguments,1),o=e.replace(/%(\d)/g,(function(e,t){return r.assert(t<n.length,"Message reference must be in range"),n[t]})),s=this.lastMarker.index,a=this.scanner.lineNumber,l=this.lastMarker.column+1;this.errorHandler.tolerateError(s,a,l,o)},e.prototype.unexpectedTokenError=function(e,t){var i,r=t||o.Messages.UnexpectedToken;if(e?(t||(r=2===e.type?o.Messages.UnexpectedEOS:3===e.type?o.Messages.UnexpectedIdentifier:6===e.type?o.Messages.UnexpectedNumber:8===e.type?o.Messages.UnexpectedString:10===e.type?o.Messages.UnexpectedTemplate:o.Messages.UnexpectedToken,4===e.type&&(this.scanner.isFutureReservedWord(e.value)?r=o.Messages.UnexpectedReserved:this.context.strict&&this.scanner.isStrictModeReservedWord(e.value)&&(r=o.Messages.StrictReservedWord))),i=e.value):i="ILLEGAL",r=r.replace("%0",i),e&&"number"==typeof e.lineNumber){var n=e.start,s=e.lineNumber,a=this.lastMarker.index-this.lastMarker.column,l=e.start-a+1;return this.errorHandler.createError(n,s,l,r)}return n=this.lastMarker.index,s=this.lastMarker.line,l=this.lastMarker.column+1,this.errorHandler.createError(n,s,l,r)},e.prototype.throwUnexpectedToken=function(e,t){throw this.unexpectedTokenError(e,t)},e.prototype.tolerateUnexpectedToken=function(e,t){this.errorHandler.tolerate(this.unexpectedTokenError(e,t))},e.prototype.collectComments=function(){if(this.config.comment){var e=this.scanner.scanComments();if(e.length>0&&this.delegate)for(var t=0;t<e.length;++t){var i=e[t],r=void 0;r={type:i.multiLine?"BlockComment":"LineComment",value:this.scanner.source.slice(i.slice[0],i.slice[1])},this.config.range&&(r.range=i.range),this.config.loc&&(r.loc=i.loc);var n={start:{line:i.loc.start.line,column:i.loc.start.column,offset:i.range[0]},end:{line:i.loc.end.line,column:i.loc.end.column,offset:i.range[1]}};this.delegate(r,n)}}else this.scanner.scanComments()},e.prototype.getTokenRaw=function(e){return this.scanner.source.slice(e.start,e.end)},e.prototype.convertToken=function(e){var t={type:u.TokenName[e.type],value:this.getTokenRaw(e)};if(this.config.range&&(t.range=[e.start,e.end]),this.config.loc&&(t.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),9===e.type){var i=e.pattern,r=e.flags;t.regex={pattern:i,flags:r}}return t},e.prototype.nextToken=function(){var e=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);var t=this.scanner.lex();return this.hasLineTerminator=e.lineNumber!==t.lineNumber,t&&this.context.strict&&3===t.type&&this.scanner.isStrictModeReservedWord(t.value)&&(t.type=4),this.lookahead=t,this.config.tokens&&2!==t.type&&this.tokens.push(this.convertToken(t)),e},e.prototype.nextRegexToken=function(){this.collectComments();var e=this.scanner.scanRegExp();return this.config.tokens&&(this.tokens.pop(),this.tokens.push(this.convertToken(e))),this.lookahead=e,this.nextToken(),e},e.prototype.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},e.prototype.startNode=function(e,t){void 0===t&&(t=0);var i=e.start-e.lineStart,r=e.lineNumber;return i<0&&(i+=t,r--),{index:e.start,line:r,column:i}},e.prototype.finalize=function(e,t){if(this.config.range&&(t.range=[e.index,this.lastMarker.index]),this.config.loc&&(t.loc={start:{line:e.line,column:e.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(t.loc.source=this.config.source)),this.delegate){var i={start:{line:e.line,column:e.column,offset:e.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(t,i)}return t},e.prototype.expect=function(e){var t=this.nextToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.expectCommaSeparator=function(){if(this.config.tolerant){var e=this.lookahead;7===e.type&&","===e.value?this.nextToken():7===e.type&&";"===e.value?(this.nextToken(),this.tolerateUnexpectedToken(e)):this.tolerateUnexpectedToken(e,o.Messages.UnexpectedToken)}else this.expect(",")},e.prototype.expectKeyword=function(e){var t=this.nextToken();4===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.match=function(e){return 7===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchKeyword=function(e){return 4===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchContextualKeyword=function(e){return 3===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchAssign=function(){if(7!==this.lookahead.type)return!1;var e=this.lookahead.value;return"="===e||"*="===e||"**="===e||"/="===e||"%="===e||"+="===e||"-="===e||"<<="===e||">>="===e||">>>="===e||"&="===e||"^="===e||"|="===e},e.prototype.isolateCoverGrammar=function(e){var t=this.context.isBindingElement,i=this.context.isAssignmentTarget,r=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var n=e.call(this);return null!==this.context.firstCoverInitializedNameError&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=t,this.context.isAssignmentTarget=i,this.context.firstCoverInitializedNameError=r,n},e.prototype.inheritCoverGrammar=function(e){var t=this.context.isBindingElement,i=this.context.isAssignmentTarget,r=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var n=e.call(this);return this.context.isBindingElement=this.context.isBindingElement&&t,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&i,this.context.firstCoverInitializedNameError=r||this.context.firstCoverInitializedNameError,n},e.prototype.consumeSemicolon=function(){this.match(";")?this.nextToken():this.hasLineTerminator||(2===this.lookahead.type||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)},e.prototype.parsePrimaryExpression=function(){var e,t,i,r=this.createNode();switch(this.lookahead.type){case 3:(this.context.isModule||this.context.await)&&"await"===this.lookahead.value&&this.tolerateUnexpectedToken(this.lookahead),e=this.matchAsyncFunction()?this.parseFunctionExpression():this.finalize(r,new s.Identifier(this.nextToken().value));break;case 6:case 8:this.context.strict&&this.lookahead.octal&&this.tolerateUnexpectedToken(this.lookahead,o.Messages.StrictOctalLiteral),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),i=this.getTokenRaw(t),e=this.finalize(r,new s.Literal(t.value,i));break;case 1:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),i=this.getTokenRaw(t),e=this.finalize(r,new s.Literal("true"===t.value,i));break;case 5:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),i=this.getTokenRaw(t),e=this.finalize(r,new s.Literal(null,i));break;case 10:e=this.parseTemplateLiteral();break;case 7:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,e=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":e=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":e=this.inheritCoverGrammar(this.parseObjectInitializer);break;case"/":case"/=":this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.scanner.index=this.startMarker.index,t=this.nextRegexToken(),i=this.getTokenRaw(t),e=this.finalize(r,new s.RegexLiteral(t.regex,i,t.pattern,t.flags));break;default:e=this.throwUnexpectedToken(this.nextToken())}break;case 4:!this.context.strict&&this.context.allowYield&&this.matchKeyword("yield")?e=this.parseIdentifierName():!this.context.strict&&this.matchKeyword("let")?e=this.finalize(r,new s.Identifier(this.nextToken().value)):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.matchKeyword("function")?e=this.parseFunctionExpression():this.matchKeyword("this")?(this.nextToken(),e=this.finalize(r,new s.ThisExpression)):e=this.matchKeyword("class")?this.parseClassExpression():this.throwUnexpectedToken(this.nextToken()));break;default:e=this.throwUnexpectedToken(this.nextToken())}return e},e.prototype.parseSpreadElement=function(){var e=this.createNode();this.expect("...");var t=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.finalize(e,new s.SpreadElement(t))},e.prototype.parseArrayInitializer=function(){var e=this.createNode(),t=[];for(this.expect("[");!this.match("]");)if(this.match(","))this.nextToken(),t.push(null);else if(this.match("...")){var i=this.parseSpreadElement();this.match("]")||(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.expect(",")),t.push(i)}else t.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(",");return this.expect("]"),this.finalize(e,new s.ArrayExpression(t))},e.prototype.parsePropertyMethod=function(e){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var t=this.context.strict,i=this.context.allowStrictDirective;this.context.allowStrictDirective=e.simple;var r=this.isolateCoverGrammar(this.parseFunctionSourceElements);return this.context.strict&&e.firstRestricted&&this.tolerateUnexpectedToken(e.firstRestricted,e.message),this.context.strict&&e.stricted&&this.tolerateUnexpectedToken(e.stricted,e.message),this.context.strict=t,this.context.allowStrictDirective=i,r},e.prototype.parsePropertyMethodFunction=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var i=this.parseFormalParameters(),r=this.parsePropertyMethod(i);return this.context.allowYield=t,this.finalize(e,new s.FunctionExpression(null,i.params,r,!1))},e.prototype.parsePropertyMethodAsyncFunction=function(){var e=this.createNode(),t=this.context.allowYield,i=this.context.await;this.context.allowYield=!1,this.context.await=!0;var r=this.parseFormalParameters(),n=this.parsePropertyMethod(r);return this.context.allowYield=t,this.context.await=i,this.finalize(e,new s.AsyncFunctionExpression(null,r.params,n))},e.prototype.parseObjectPropertyKey=function(){var e,t=this.createNode(),i=this.nextToken();switch(i.type){case 8:case 6:this.context.strict&&i.octal&&this.tolerateUnexpectedToken(i,o.Messages.StrictOctalLiteral);var r=this.getTokenRaw(i);e=this.finalize(t,new s.Literal(i.value,r));break;case 3:case 1:case 5:case 4:e=this.finalize(t,new s.Identifier(i.value));break;case 7:"["===i.value?(e=this.isolateCoverGrammar(this.parseAssignmentExpression),this.expect("]")):e=this.throwUnexpectedToken(i);break;default:e=this.throwUnexpectedToken(i)}return e},e.prototype.isPropertyKey=function(e,t){return e.type===l.Syntax.Identifier&&e.name===t||e.type===l.Syntax.Literal&&e.value===t},e.prototype.parseObjectProperty=function(e){var t,i=this.createNode(),r=this.lookahead,n=null,a=null,l=!1,u=!1,c=!1,h=!1;if(3===r.type){var p=r.value;this.nextToken(),l=this.match("["),n=(h=!(this.hasLineTerminator||"async"!==p||this.match(":")||this.match("(")||this.match("*")||this.match(",")))?this.parseObjectPropertyKey():this.finalize(i,new s.Identifier(p))}else this.match("*")?this.nextToken():(l=this.match("["),n=this.parseObjectPropertyKey());var d=this.qualifiedPropertyName(this.lookahead);if(3===r.type&&!h&&"get"===r.value&&d)t="get",l=this.match("["),n=this.parseObjectPropertyKey(),this.context.allowYield=!1,a=this.parseGetterMethod();else if(3===r.type&&!h&&"set"===r.value&&d)t="set",l=this.match("["),n=this.parseObjectPropertyKey(),a=this.parseSetterMethod();else if(7===r.type&&"*"===r.value&&d)t="init",l=this.match("["),n=this.parseObjectPropertyKey(),a=this.parseGeneratorMethod(),u=!0;else if(n||this.throwUnexpectedToken(this.lookahead),t="init",this.match(":")&&!h)!l&&this.isPropertyKey(n,"__proto__")&&(e.value&&this.tolerateError(o.Messages.DuplicateProtoProperty),e.value=!0),this.nextToken(),a=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(this.match("("))a=h?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),u=!0;else if(3===r.type)if(p=this.finalize(i,new s.Identifier(r.value)),this.match("=")){this.context.firstCoverInitializedNameError=this.lookahead,this.nextToken(),c=!0;var f=this.isolateCoverGrammar(this.parseAssignmentExpression);a=this.finalize(i,new s.AssignmentPattern(p,f))}else c=!0,a=p;else this.throwUnexpectedToken(this.nextToken());return this.finalize(i,new s.Property(t,n,l,a,u,c))},e.prototype.parseObjectInitializer=function(){var e=this.createNode();this.expect("{");for(var t=[],i={value:!1};!this.match("}");)t.push(this.parseObjectProperty(i)),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(e,new s.ObjectExpression(t))},e.prototype.parseTemplateHead=function(){r.assert(this.lookahead.head,"Template literal must start with a template head");var e=this.createNode(),t=this.nextToken(),i=t.value,n=t.cooked;return this.finalize(e,new s.TemplateElement({raw:i,cooked:n},t.tail))},e.prototype.parseTemplateElement=function(){10!==this.lookahead.type&&this.throwUnexpectedToken();var e=this.createNode(),t=this.nextToken(),i=t.value,r=t.cooked;return this.finalize(e,new s.TemplateElement({raw:i,cooked:r},t.tail))},e.prototype.parseTemplateLiteral=function(){var e=this.createNode(),t=[],i=[],r=this.parseTemplateHead();for(i.push(r);!r.tail;)t.push(this.parseExpression()),r=this.parseTemplateElement(),i.push(r);return this.finalize(e,new s.TemplateLiteral(i,t))},e.prototype.reinterpretExpressionAsPattern=function(e){switch(e.type){case l.Syntax.Identifier:case l.Syntax.MemberExpression:case l.Syntax.RestElement:case l.Syntax.AssignmentPattern:break;case l.Syntax.SpreadElement:e.type=l.Syntax.RestElement,this.reinterpretExpressionAsPattern(e.argument);break;case l.Syntax.ArrayExpression:e.type=l.Syntax.ArrayPattern;for(var t=0;t<e.elements.length;t++)null!==e.elements[t]&&this.reinterpretExpressionAsPattern(e.elements[t]);break;case l.Syntax.ObjectExpression:for(e.type=l.Syntax.ObjectPattern,t=0;t<e.properties.length;t++)this.reinterpretExpressionAsPattern(e.properties[t].value);break;case l.Syntax.AssignmentExpression:e.type=l.Syntax.AssignmentPattern,delete e.operator,this.reinterpretExpressionAsPattern(e.left)}},e.prototype.parseGroupExpression=function(){var e;if(this.expect("("),this.match(")"))this.nextToken(),this.match("=>")||this.expect("=>"),e={type:"ArrowParameterPlaceHolder",params:[],async:!1};else{var t=this.lookahead,i=[];if(this.match("..."))e=this.parseRestElement(i),this.expect(")"),this.match("=>")||this.expect("=>"),e={type:"ArrowParameterPlaceHolder",params:[e],async:!1};else{var r=!1;if(this.context.isBindingElement=!0,e=this.inheritCoverGrammar(this.parseAssignmentExpression),this.match(",")){var n=[];for(this.context.isAssignmentTarget=!1,n.push(e);2!==this.lookahead.type&&this.match(",");){if(this.nextToken(),this.match(")")){this.nextToken();for(var o=0;o<n.length;o++)this.reinterpretExpressionAsPattern(n[o]);r=!0,e={type:"ArrowParameterPlaceHolder",params:n,async:!1}}else if(this.match("...")){for(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),n.push(this.parseRestElement(i)),this.expect(")"),this.match("=>")||this.expect("=>"),this.context.isBindingElement=!1,o=0;o<n.length;o++)this.reinterpretExpressionAsPattern(n[o]);r=!0,e={type:"ArrowParameterPlaceHolder",params:n,async:!1}}else n.push(this.inheritCoverGrammar(this.parseAssignmentExpression));if(r)break}r||(e=this.finalize(this.startNode(t),new s.SequenceExpression(n)))}if(!r){if(this.expect(")"),this.match("=>")&&(e.type===l.Syntax.Identifier&&"yield"===e.name&&(r=!0,e={type:"ArrowParameterPlaceHolder",params:[e],async:!1}),!r)){if(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),e.type===l.Syntax.SequenceExpression)for(o=0;o<e.expressions.length;o++)this.reinterpretExpressionAsPattern(e.expressions[o]);else this.reinterpretExpressionAsPattern(e);e={type:"ArrowParameterPlaceHolder",params:e.type===l.Syntax.SequenceExpression?e.expressions:[e],async:!1}}this.context.isBindingElement=!1}}}return e},e.prototype.parseArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAssignmentExpression);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},e.prototype.isIdentifierName=function(e){return 3===e.type||4===e.type||1===e.type||5===e.type},e.prototype.parseIdentifierName=function(){var e=this.createNode(),t=this.nextToken();return this.isIdentifierName(t)||this.throwUnexpectedToken(t),this.finalize(e,new s.Identifier(t.value))},e.prototype.parseNewExpression=function(){var e,t=this.createNode(),i=this.parseIdentifierName();if(r.assert("new"===i.name,"New expression must start with `new`"),this.match("."))if(this.nextToken(),3===this.lookahead.type&&this.context.inFunctionBody&&"target"===this.lookahead.value){var n=this.parseIdentifierName();e=new s.MetaProperty(i,n)}else this.throwUnexpectedToken(this.lookahead);else{var o=this.isolateCoverGrammar(this.parseLeftHandSideExpression),a=this.match("(")?this.parseArguments():[];e=new s.NewExpression(o,a),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return this.finalize(t,e)},e.prototype.parseAsyncArgument=function(){var e=this.parseAssignmentExpression();return this.context.firstCoverInitializedNameError=null,e},e.prototype.parseAsyncArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAsyncArgument);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},e.prototype.parseLeftHandSideExpressionAllowCall=function(){var e,t=this.lookahead,i=this.matchContextualKeyword("async"),r=this.context.allowIn;for(this.context.allowIn=!0,this.matchKeyword("super")&&this.context.inFunctionBody?(e=this.createNode(),this.nextToken(),e=this.finalize(e,new s.Super),this.match("(")||this.match(".")||this.match("[")||this.throwUnexpectedToken(this.lookahead)):e=this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");var n=this.parseIdentifierName();e=this.finalize(this.startNode(t),new s.StaticMemberExpression(e,n))}else if(this.match("(")){var o=i&&t.lineNumber===this.lookahead.lineNumber;this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;var a=o?this.parseAsyncArguments():this.parseArguments();if(e=this.finalize(this.startNode(t),new s.CallExpression(e,a)),o&&this.match("=>")){for(var l=0;l<a.length;++l)this.reinterpretExpressionAsPattern(a[l]);e={type:"ArrowParameterPlaceHolder",params:a,async:!0}}}else if(this.match("["))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("["),n=this.isolateCoverGrammar(this.parseExpression),this.expect("]"),e=this.finalize(this.startNode(t),new s.ComputedMemberExpression(e,n));else{if(10!==this.lookahead.type||!this.lookahead.head)break;var u=this.parseTemplateLiteral();e=this.finalize(this.startNode(t),new s.TaggedTemplateExpression(e,u))}return this.context.allowIn=r,e},e.prototype.parseSuper=function(){var e=this.createNode();return this.expectKeyword("super"),this.match("[")||this.match(".")||this.throwUnexpectedToken(this.lookahead),this.finalize(e,new s.Super)},e.prototype.parseLeftHandSideExpression=function(){r.assert(this.context.allowIn,"callee of new expression always allow in keyword.");for(var e=this.startNode(this.lookahead),t=this.matchKeyword("super")&&this.context.inFunctionBody?this.parseSuper():this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");var i=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),t=this.finalize(e,new s.ComputedMemberExpression(t,i))}else if(this.match("."))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("."),i=this.parseIdentifierName(),t=this.finalize(e,new s.StaticMemberExpression(t,i));else{if(10!==this.lookahead.type||!this.lookahead.head)break;var n=this.parseTemplateLiteral();t=this.finalize(e,new s.TaggedTemplateExpression(t,n))}return t},e.prototype.parseUpdateExpression=function(){var e,t=this.lookahead;if(this.match("++")||this.match("--")){var i=this.startNode(t),r=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(o.Messages.StrictLHSPrefix),this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment);var n=!0;e=this.finalize(i,new s.UpdateExpression(r.value,e,n)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(e=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&7===this.lookahead.type&&(this.match("++")||this.match("--"))){this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(o.Messages.StrictLHSPostfix),this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var a=this.nextToken().value;n=!1,e=this.finalize(this.startNode(t),new s.UpdateExpression(a,e,n))}return e},e.prototype.parseAwaitExpression=function(){var e=this.createNode();this.nextToken();var t=this.parseUnaryExpression();return this.finalize(e,new s.AwaitExpression(t))},e.prototype.parseUnaryExpression=function(){var e;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")||this.matchKeyword("delete")||this.matchKeyword("void")||this.matchKeyword("typeof")){var t=this.startNode(this.lookahead),i=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),e=this.finalize(t,new s.UnaryExpression(i.value,e)),this.context.strict&&"delete"===e.operator&&e.argument.type===l.Syntax.Identifier&&this.tolerateError(o.Messages.StrictDelete),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else e=this.context.await&&this.matchContextualKeyword("await")?this.parseAwaitExpression():this.parseUpdateExpression();return e},e.prototype.parseExponentiationExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseUnaryExpression);if(t.type!==l.Syntax.UnaryExpression&&this.match("**")){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var i=t,r=this.isolateCoverGrammar(this.parseExponentiationExpression);t=this.finalize(this.startNode(e),new s.BinaryExpression("**",i,r))}return t},e.prototype.binaryPrecedence=function(e){var t=e.value;return 7===e.type?this.operatorPrecedence[t]||0:4===e.type&&("instanceof"===t||this.context.allowIn&&"in"===t)?7:0},e.prototype.parseBinaryExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseExponentiationExpression),i=this.lookahead,r=this.binaryPrecedence(i);if(r>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;for(var n=[e,this.lookahead],o=t,a=this.isolateCoverGrammar(this.parseExponentiationExpression),l=[o,i.value,a],u=[r];!((r=this.binaryPrecedence(this.lookahead))<=0);){for(;l.length>2&&r<=u[u.length-1];){a=l.pop();var c=l.pop();u.pop(),o=l.pop(),n.pop();var h=this.startNode(n[n.length-1]);l.push(this.finalize(h,new s.BinaryExpression(c,o,a)))}l.push(this.nextToken().value),u.push(r),n.push(this.lookahead),l.push(this.isolateCoverGrammar(this.parseExponentiationExpression))}var p=l.length-1;t=l[p];for(var d=n.pop();p>1;){var f=n.pop(),m=d&&d.lineStart;h=this.startNode(f,m),c=l[p-1],t=this.finalize(h,new s.BinaryExpression(c,l[p-2],t)),p-=2,d=f}}return t},e.prototype.parseConditionalExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.match("?")){this.nextToken();var i=this.context.allowIn;this.context.allowIn=!0;var r=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=i,this.expect(":");var n=this.isolateCoverGrammar(this.parseAssignmentExpression);t=this.finalize(this.startNode(e),new s.ConditionalExpression(t,r,n)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return t},e.prototype.checkPatternParam=function(e,t){switch(t.type){case l.Syntax.Identifier:this.validateParam(e,t,t.name);break;case l.Syntax.RestElement:this.checkPatternParam(e,t.argument);break;case l.Syntax.AssignmentPattern:this.checkPatternParam(e,t.left);break;case l.Syntax.ArrayPattern:for(var i=0;i<t.elements.length;i++)null!==t.elements[i]&&this.checkPatternParam(e,t.elements[i]);break;case l.Syntax.ObjectPattern:for(i=0;i<t.properties.length;i++)this.checkPatternParam(e,t.properties[i].value)}e.simple=e.simple&&t instanceof s.Identifier},e.prototype.reinterpretAsCoverFormalsList=function(e){var t,i=[e],r=!1;switch(e.type){case l.Syntax.Identifier:break;case"ArrowParameterPlaceHolder":i=e.params,r=e.async;break;default:return null}t={simple:!0,paramSet:{}};for(var n=0;n<i.length;++n)(s=i[n]).type===l.Syntax.AssignmentPattern?s.right.type===l.Syntax.YieldExpression&&(s.right.argument&&this.throwUnexpectedToken(this.lookahead),s.right.type=l.Syntax.Identifier,s.right.name="yield",delete s.right.argument,delete s.right.delegate):r&&s.type===l.Syntax.Identifier&&"await"===s.name&&this.throwUnexpectedToken(this.lookahead),this.checkPatternParam(t,s),i[n]=s;if(this.context.strict||!this.context.allowYield)for(n=0;n<i.length;++n){var s;(s=i[n]).type===l.Syntax.YieldExpression&&this.throwUnexpectedToken(this.lookahead)}if(t.message===o.Messages.StrictParamDupe){var a=this.context.strict?t.stricted:t.firstRestricted;this.throwUnexpectedToken(a,t.message)}return{simple:t.simple,params:i,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.parseAssignmentExpression=function(){var e;if(!this.context.allowYield&&this.matchKeyword("yield"))e=this.parseYieldExpression();else{var t=this.lookahead,i=t;if(e=this.parseConditionalExpression(),3===i.type&&i.lineNumber===this.lookahead.lineNumber&&"async"===i.value&&(3===this.lookahead.type||this.matchKeyword("yield"))){var r=this.parsePrimaryExpression();this.reinterpretExpressionAsPattern(r),e={type:"ArrowParameterPlaceHolder",params:[r],async:!0}}if("ArrowParameterPlaceHolder"===e.type||this.match("=>")){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var n=e.async,a=this.reinterpretAsCoverFormalsList(e);if(a){this.hasLineTerminator&&this.tolerateUnexpectedToken(this.lookahead),this.context.firstCoverInitializedNameError=null;var u=this.context.strict,c=this.context.allowStrictDirective;this.context.allowStrictDirective=a.simple;var h=this.context.allowYield,p=this.context.await;this.context.allowYield=!0,this.context.await=n;var d=this.startNode(t);this.expect("=>");var f=void 0;if(this.match("{")){var m=this.context.allowIn;this.context.allowIn=!0,f=this.parseFunctionSourceElements(),this.context.allowIn=m}else f=this.isolateCoverGrammar(this.parseAssignmentExpression);var g=f.type!==l.Syntax.BlockStatement;this.context.strict&&a.firstRestricted&&this.throwUnexpectedToken(a.firstRestricted,a.message),this.context.strict&&a.stricted&&this.tolerateUnexpectedToken(a.stricted,a.message),e=n?this.finalize(d,new s.AsyncArrowFunctionExpression(a.params,f,g)):this.finalize(d,new s.ArrowFunctionExpression(a.params,f,g)),this.context.strict=u,this.context.allowStrictDirective=c,this.context.allowYield=h,this.context.await=p}}else if(this.matchAssign()){if(this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment),this.context.strict&&e.type===l.Syntax.Identifier){var v=e;this.scanner.isRestrictedWord(v.name)&&this.tolerateUnexpectedToken(i,o.Messages.StrictLHSAssignment),this.scanner.isStrictModeReservedWord(v.name)&&this.tolerateUnexpectedToken(i,o.Messages.StrictReservedWord)}this.match("=")?this.reinterpretExpressionAsPattern(e):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1);var y=(i=this.nextToken()).value,b=this.isolateCoverGrammar(this.parseAssignmentExpression);e=this.finalize(this.startNode(t),new s.AssignmentExpression(y,e,b)),this.context.firstCoverInitializedNameError=null}}return e},e.prototype.parseExpression=function(){var e=this.lookahead,t=this.isolateCoverGrammar(this.parseAssignmentExpression);if(this.match(",")){var i=[];for(i.push(t);2!==this.lookahead.type&&this.match(",");)this.nextToken(),i.push(this.isolateCoverGrammar(this.parseAssignmentExpression));t=this.finalize(this.startNode(e),new s.SequenceExpression(i))}return t},e.prototype.parseStatementListItem=function(){var e;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,4===this.lookahead.type)switch(this.lookahead.value){case"export":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,o.Messages.IllegalExportDeclaration),e=this.parseExportDeclaration();break;case"import":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,o.Messages.IllegalImportDeclaration),e=this.parseImportDeclaration();break;case"const":e=this.parseLexicalDeclaration({inFor:!1});break;case"function":e=this.parseFunctionDeclaration();break;case"class":e=this.parseClassDeclaration();break;case"let":e=this.isLexicalDeclaration()?this.parseLexicalDeclaration({inFor:!1}):this.parseStatement();break;default:e=this.parseStatement()}else e=this.parseStatement();return e},e.prototype.parseBlock=function(){var e=this.createNode();this.expect("{");for(var t=[];!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.finalize(e,new s.BlockStatement(t))},e.prototype.parseLexicalBinding=function(e,t){var i=this.createNode(),r=this.parsePattern([],e);this.context.strict&&r.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(r.name)&&this.tolerateError(o.Messages.StrictVarName);var n=null;return"const"===e?this.matchKeyword("in")||this.matchContextualKeyword("of")||(this.match("=")?(this.nextToken(),n=this.isolateCoverGrammar(this.parseAssignmentExpression)):this.throwError(o.Messages.DeclarationMissingInitializer,"const")):(!t.inFor&&r.type!==l.Syntax.Identifier||this.match("="))&&(this.expect("="),n=this.isolateCoverGrammar(this.parseAssignmentExpression)),this.finalize(i,new s.VariableDeclarator(r,n))},e.prototype.parseBindingList=function(e,t){for(var i=[this.parseLexicalBinding(e,t)];this.match(",");)this.nextToken(),i.push(this.parseLexicalBinding(e,t));return i},e.prototype.isLexicalDeclaration=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.scanner.lex();return this.scanner.restoreState(e),3===t.type||7===t.type&&"["===t.value||7===t.type&&"{"===t.value||4===t.type&&"let"===t.value||4===t.type&&"yield"===t.value},e.prototype.parseLexicalDeclaration=function(e){var t=this.createNode(),i=this.nextToken().value;r.assert("let"===i||"const"===i,"Lexical declaration must be either let or const");var n=this.parseBindingList(i,e);return this.consumeSemicolon(),this.finalize(t,new s.VariableDeclaration(n,i))},e.prototype.parseBindingRestElement=function(e,t){var i=this.createNode();this.expect("...");var r=this.parsePattern(e,t);return this.finalize(i,new s.RestElement(r))},e.prototype.parseArrayPattern=function(e,t){var i=this.createNode();this.expect("[");for(var r=[];!this.match("]");)if(this.match(","))this.nextToken(),r.push(null);else{if(this.match("...")){r.push(this.parseBindingRestElement(e,t));break}r.push(this.parsePatternWithDefault(e,t)),this.match("]")||this.expect(",")}return this.expect("]"),this.finalize(i,new s.ArrayPattern(r))},e.prototype.parsePropertyPattern=function(e,t){var i,r,n=this.createNode(),o=!1,a=!1;if(3===this.lookahead.type){var l=this.lookahead;i=this.parseVariableIdentifier();var u=this.finalize(n,new s.Identifier(l.value));if(this.match("=")){e.push(l),a=!0,this.nextToken();var c=this.parseAssignmentExpression();r=this.finalize(this.startNode(l),new s.AssignmentPattern(u,c))}else this.match(":")?(this.expect(":"),r=this.parsePatternWithDefault(e,t)):(e.push(l),a=!0,r=u)}else o=this.match("["),i=this.parseObjectPropertyKey(),this.expect(":"),r=this.parsePatternWithDefault(e,t);return this.finalize(n,new s.Property("init",i,o,r,!1,a))},e.prototype.parseObjectPattern=function(e,t){var i=this.createNode(),r=[];for(this.expect("{");!this.match("}");)r.push(this.parsePropertyPattern(e,t)),this.match("}")||this.expect(",");return this.expect("}"),this.finalize(i,new s.ObjectPattern(r))},e.prototype.parsePattern=function(e,t){var i;return this.match("[")?i=this.parseArrayPattern(e,t):this.match("{")?i=this.parseObjectPattern(e,t):(!this.matchKeyword("let")||"const"!==t&&"let"!==t||this.tolerateUnexpectedToken(this.lookahead,o.Messages.LetInLexicalBinding),e.push(this.lookahead),i=this.parseVariableIdentifier(t)),i},e.prototype.parsePatternWithDefault=function(e,t){var i=this.lookahead,r=this.parsePattern(e,t);if(this.match("=")){this.nextToken();var n=this.context.allowYield;this.context.allowYield=!0;var o=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowYield=n,r=this.finalize(this.startNode(i),new s.AssignmentPattern(r,o))}return r},e.prototype.parseVariableIdentifier=function(e){var t=this.createNode(),i=this.nextToken();return 4===i.type&&"yield"===i.value?this.context.strict?this.tolerateUnexpectedToken(i,o.Messages.StrictReservedWord):this.context.allowYield||this.throwUnexpectedToken(i):3!==i.type?this.context.strict&&4===i.type&&this.scanner.isStrictModeReservedWord(i.value)?this.tolerateUnexpectedToken(i,o.Messages.StrictReservedWord):(this.context.strict||"let"!==i.value||"var"!==e)&&this.throwUnexpectedToken(i):(this.context.isModule||this.context.await)&&3===i.type&&"await"===i.value&&this.tolerateUnexpectedToken(i),this.finalize(t,new s.Identifier(i.value))},e.prototype.parseVariableDeclaration=function(e){var t=this.createNode(),i=this.parsePattern([],"var");this.context.strict&&i.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(i.name)&&this.tolerateError(o.Messages.StrictVarName);var r=null;return this.match("=")?(this.nextToken(),r=this.isolateCoverGrammar(this.parseAssignmentExpression)):i.type===l.Syntax.Identifier||e.inFor||this.expect("="),this.finalize(t,new s.VariableDeclarator(i,r))},e.prototype.parseVariableDeclarationList=function(e){var t={inFor:e.inFor},i=[];for(i.push(this.parseVariableDeclaration(t));this.match(",");)this.nextToken(),i.push(this.parseVariableDeclaration(t));return i},e.prototype.parseVariableStatement=function(){var e=this.createNode();this.expectKeyword("var");var t=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(e,new s.VariableDeclaration(t,"var"))},e.prototype.parseEmptyStatement=function(){var e=this.createNode();return this.expect(";"),this.finalize(e,new s.EmptyStatement)},e.prototype.parseExpressionStatement=function(){var e=this.createNode(),t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new s.ExpressionStatement(t))},e.prototype.parseIfClause=function(){return this.context.strict&&this.matchKeyword("function")&&this.tolerateError(o.Messages.StrictFunction),this.parseStatement()},e.prototype.parseIfStatement=function(){var e,t=this.createNode(),i=null;this.expectKeyword("if"),this.expect("(");var r=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new s.EmptyStatement)):(this.expect(")"),e=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),i=this.parseIfClause())),this.finalize(t,new s.IfStatement(r,e,i))},e.prototype.parseDoWhileStatement=function(){var e=this.createNode();this.expectKeyword("do");var t=this.context.inIteration;this.context.inIteration=!0;var i=this.parseStatement();this.context.inIteration=t,this.expectKeyword("while"),this.expect("(");var r=this.parseExpression();return!this.match(")")&&this.config.tolerant?this.tolerateUnexpectedToken(this.nextToken()):(this.expect(")"),this.match(";")&&this.nextToken()),this.finalize(e,new s.DoWhileStatement(i,r))},e.prototype.parseWhileStatement=function(){var e,t=this.createNode();this.expectKeyword("while"),this.expect("(");var i=this.parseExpression();if(!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new s.EmptyStatement);else{this.expect(")");var r=this.context.inIteration;this.context.inIteration=!0,e=this.parseStatement(),this.context.inIteration=r}return this.finalize(t,new s.WhileStatement(i,e))},e.prototype.parseForStatement=function(){var e,t,i,r=null,n=null,a=null,u=!0,c=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){r=this.createNode(),this.nextToken();var h=this.context.allowIn;this.context.allowIn=!1;var p=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=h,1===p.length&&this.matchKeyword("in")){var d=p[0];d.init&&(d.id.type===l.Syntax.ArrayPattern||d.id.type===l.Syntax.ObjectPattern||this.context.strict)&&this.tolerateError(o.Messages.ForInOfLoopInitializer,"for-in"),r=this.finalize(r,new s.VariableDeclaration(p,"var")),this.nextToken(),e=r,t=this.parseExpression(),r=null}else 1===p.length&&null===p[0].init&&this.matchContextualKeyword("of")?(r=this.finalize(r,new s.VariableDeclaration(p,"var")),this.nextToken(),e=r,t=this.parseAssignmentExpression(),r=null,u=!1):(r=this.finalize(r,new s.VariableDeclaration(p,"var")),this.expect(";"))}else if(this.matchKeyword("const")||this.matchKeyword("let")){r=this.createNode();var f=this.nextToken().value;this.context.strict||"in"!==this.lookahead.value?(h=this.context.allowIn,this.context.allowIn=!1,p=this.parseBindingList(f,{inFor:!0}),this.context.allowIn=h,1===p.length&&null===p[0].init&&this.matchKeyword("in")?(r=this.finalize(r,new s.VariableDeclaration(p,f)),this.nextToken(),e=r,t=this.parseExpression(),r=null):1===p.length&&null===p[0].init&&this.matchContextualKeyword("of")?(r=this.finalize(r,new s.VariableDeclaration(p,f)),this.nextToken(),e=r,t=this.parseAssignmentExpression(),r=null,u=!1):(this.consumeSemicolon(),r=this.finalize(r,new s.VariableDeclaration(p,f)))):(r=this.finalize(r,new s.Identifier(f)),this.nextToken(),e=r,t=this.parseExpression(),r=null)}else{var m=this.lookahead;if(h=this.context.allowIn,this.context.allowIn=!1,r=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=h,this.matchKeyword("in"))this.context.isAssignmentTarget&&r.type!==l.Syntax.AssignmentExpression||this.tolerateError(o.Messages.InvalidLHSInForIn),this.nextToken(),this.reinterpretExpressionAsPattern(r),e=r,t=this.parseExpression(),r=null;else if(this.matchContextualKeyword("of"))this.context.isAssignmentTarget&&r.type!==l.Syntax.AssignmentExpression||this.tolerateError(o.Messages.InvalidLHSInForLoop),this.nextToken(),this.reinterpretExpressionAsPattern(r),e=r,t=this.parseAssignmentExpression(),r=null,u=!1;else{if(this.match(",")){for(var g=[r];this.match(",");)this.nextToken(),g.push(this.isolateCoverGrammar(this.parseAssignmentExpression));r=this.finalize(this.startNode(m),new s.SequenceExpression(g))}this.expect(";")}}if(void 0===e&&(this.match(";")||(n=this.parseExpression()),this.expect(";"),this.match(")")||(a=this.parseExpression())),!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),i=this.finalize(this.createNode(),new s.EmptyStatement);else{this.expect(")");var v=this.context.inIteration;this.context.inIteration=!0,i=this.isolateCoverGrammar(this.parseStatement),this.context.inIteration=v}return void 0===e?this.finalize(c,new s.ForStatement(r,n,a,i)):u?this.finalize(c,new s.ForInStatement(e,t,i)):this.finalize(c,new s.ForOfStatement(e,t,i))},e.prototype.parseContinueStatement=function(){var e=this.createNode();this.expectKeyword("continue");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var i=this.parseVariableIdentifier();t=i;var r="$"+i.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,r)||this.throwError(o.Messages.UnknownLabel,i.name)}return this.consumeSemicolon(),null!==t||this.context.inIteration||this.throwError(o.Messages.IllegalContinue),this.finalize(e,new s.ContinueStatement(t))},e.prototype.parseBreakStatement=function(){var e=this.createNode();this.expectKeyword("break");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var i=this.parseVariableIdentifier(),r="$"+i.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,r)||this.throwError(o.Messages.UnknownLabel,i.name),t=i}return this.consumeSemicolon(),null!==t||this.context.inIteration||this.context.inSwitch||this.throwError(o.Messages.IllegalBreak),this.finalize(e,new s.BreakStatement(t))},e.prototype.parseReturnStatement=function(){this.context.inFunctionBody||this.tolerateError(o.Messages.IllegalReturn);var e=this.createNode();this.expectKeyword("return");var t=(this.match(";")||this.match("}")||this.hasLineTerminator||2===this.lookahead.type)&&8!==this.lookahead.type&&10!==this.lookahead.type?null:this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new s.ReturnStatement(t))},e.prototype.parseWithStatement=function(){this.context.strict&&this.tolerateError(o.Messages.StrictModeWith);var e,t=this.createNode();this.expectKeyword("with"),this.expect("(");var i=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new s.EmptyStatement)):(this.expect(")"),e=this.parseStatement()),this.finalize(t,new s.WithStatement(i,e))},e.prototype.parseSwitchCase=function(){var e,t=this.createNode();this.matchKeyword("default")?(this.nextToken(),e=null):(this.expectKeyword("case"),e=this.parseExpression()),this.expect(":");for(var i=[];!(this.match("}")||this.matchKeyword("default")||this.matchKeyword("case"));)i.push(this.parseStatementListItem());return this.finalize(t,new s.SwitchCase(e,i))},e.prototype.parseSwitchStatement=function(){var e=this.createNode();this.expectKeyword("switch"),this.expect("(");var t=this.parseExpression();this.expect(")");var i=this.context.inSwitch;this.context.inSwitch=!0;var r=[],n=!1;for(this.expect("{");!this.match("}");){var a=this.parseSwitchCase();null===a.test&&(n&&this.throwError(o.Messages.MultipleDefaultsInSwitch),n=!0),r.push(a)}return this.expect("}"),this.context.inSwitch=i,this.finalize(e,new s.SwitchStatement(t,r))},e.prototype.parseLabelledStatement=function(){var e,t=this.createNode(),i=this.parseExpression();if(i.type===l.Syntax.Identifier&&this.match(":")){this.nextToken();var r=i,n="$"+r.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,n)&&this.throwError(o.Messages.Redeclaration,"Label",r.name),this.context.labelSet[n]=!0;var a=void 0;if(this.matchKeyword("class"))this.tolerateUnexpectedToken(this.lookahead),a=this.parseClassDeclaration();else if(this.matchKeyword("function")){var u=this.lookahead,c=this.parseFunctionDeclaration();this.context.strict?this.tolerateUnexpectedToken(u,o.Messages.StrictFunction):c.generator&&this.tolerateUnexpectedToken(u,o.Messages.GeneratorInLegacyContext),a=c}else a=this.parseStatement();delete this.context.labelSet[n],e=new s.LabeledStatement(r,a)}else this.consumeSemicolon(),e=new s.ExpressionStatement(i);return this.finalize(t,e)},e.prototype.parseThrowStatement=function(){var e=this.createNode();this.expectKeyword("throw"),this.hasLineTerminator&&this.throwError(o.Messages.NewlineAfterThrow);var t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new s.ThrowStatement(t))},e.prototype.parseCatchClause=function(){var e=this.createNode();this.expectKeyword("catch"),this.expect("("),this.match(")")&&this.throwUnexpectedToken(this.lookahead);for(var t=[],i=this.parsePattern(t),r={},n=0;n<t.length;n++){var a="$"+t[n].value;Object.prototype.hasOwnProperty.call(r,a)&&this.tolerateError(o.Messages.DuplicateBinding,t[n].value),r[a]=!0}this.context.strict&&i.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(i.name)&&this.tolerateError(o.Messages.StrictCatchVariable),this.expect(")");var u=this.parseBlock();return this.finalize(e,new s.CatchClause(i,u))},e.prototype.parseFinallyClause=function(){return this.expectKeyword("finally"),this.parseBlock()},e.prototype.parseTryStatement=function(){var e=this.createNode();this.expectKeyword("try");var t=this.parseBlock(),i=this.matchKeyword("catch")?this.parseCatchClause():null,r=this.matchKeyword("finally")?this.parseFinallyClause():null;return i||r||this.throwError(o.Messages.NoCatchOrFinally),this.finalize(e,new s.TryStatement(t,i,r))},e.prototype.parseDebuggerStatement=function(){var e=this.createNode();return this.expectKeyword("debugger"),this.consumeSemicolon(),this.finalize(e,new s.DebuggerStatement)},e.prototype.parseStatement=function(){var e;switch(this.lookahead.type){case 1:case 5:case 6:case 8:case 10:case 9:e=this.parseExpressionStatement();break;case 7:var t=this.lookahead.value;e="{"===t?this.parseBlock():"("===t?this.parseExpressionStatement():";"===t?this.parseEmptyStatement():this.parseExpressionStatement();break;case 3:e=this.matchAsyncFunction()?this.parseFunctionDeclaration():this.parseLabelledStatement();break;case 4:switch(this.lookahead.value){case"break":e=this.parseBreakStatement();break;case"continue":e=this.parseContinueStatement();break;case"debugger":e=this.parseDebuggerStatement();break;case"do":e=this.parseDoWhileStatement();break;case"for":e=this.parseForStatement();break;case"function":e=this.parseFunctionDeclaration();break;case"if":e=this.parseIfStatement();break;case"return":e=this.parseReturnStatement();break;case"switch":e=this.parseSwitchStatement();break;case"throw":e=this.parseThrowStatement();break;case"try":e=this.parseTryStatement();break;case"var":e=this.parseVariableStatement();break;case"while":e=this.parseWhileStatement();break;case"with":e=this.parseWithStatement();break;default:e=this.parseExpressionStatement()}break;default:e=this.throwUnexpectedToken(this.lookahead)}return e},e.prototype.parseFunctionSourceElements=function(){var e=this.createNode();this.expect("{");var t=this.parseDirectivePrologues(),i=this.context.labelSet,r=this.context.inIteration,n=this.context.inSwitch,o=this.context.inFunctionBody;for(this.context.labelSet={},this.context.inIteration=!1,this.context.inSwitch=!1,this.context.inFunctionBody=!0;2!==this.lookahead.type&&!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.context.labelSet=i,this.context.inIteration=r,this.context.inSwitch=n,this.context.inFunctionBody=o,this.finalize(e,new s.BlockStatement(t))},e.prototype.validateParam=function(e,t,i){var r="$"+i;this.context.strict?(this.scanner.isRestrictedWord(i)&&(e.stricted=t,e.message=o.Messages.StrictParamName),Object.prototype.hasOwnProperty.call(e.paramSet,r)&&(e.stricted=t,e.message=o.Messages.StrictParamDupe)):e.firstRestricted||(this.scanner.isRestrictedWord(i)?(e.firstRestricted=t,e.message=o.Messages.StrictParamName):this.scanner.isStrictModeReservedWord(i)?(e.firstRestricted=t,e.message=o.Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(e.paramSet,r)&&(e.stricted=t,e.message=o.Messages.StrictParamDupe)),"function"==typeof Object.defineProperty?Object.defineProperty(e.paramSet,r,{value:!0,enumerable:!0,writable:!0,configurable:!0}):e.paramSet[r]=!0},e.prototype.parseRestElement=function(e){var t=this.createNode();this.expect("...");var i=this.parsePattern(e);return this.match("=")&&this.throwError(o.Messages.DefaultRestParameter),this.match(")")||this.throwError(o.Messages.ParameterAfterRestParameter),this.finalize(t,new s.RestElement(i))},e.prototype.parseFormalParameter=function(e){for(var t=[],i=this.match("...")?this.parseRestElement(t):this.parsePatternWithDefault(t),r=0;r<t.length;r++)this.validateParam(e,t[r],t[r].value);e.simple=e.simple&&i instanceof s.Identifier,e.params.push(i)},e.prototype.parseFormalParameters=function(e){var t;if(t={simple:!0,params:[],firstRestricted:e},this.expect("("),!this.match(")"))for(t.paramSet={};2!==this.lookahead.type&&(this.parseFormalParameter(t),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),{simple:t.simple,params:t.params,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.matchAsyncFunction=function(){var e=this.matchContextualKeyword("async");if(e){var t=this.scanner.saveState();this.scanner.scanComments();var i=this.scanner.lex();this.scanner.restoreState(t),e=t.lineNumber===i.lineNumber&&4===i.type&&"function"===i.value}return e},e.prototype.parseFunctionDeclaration=function(e){var t=this.createNode(),i=this.matchContextualKeyword("async");i&&this.nextToken(),this.expectKeyword("function");var r,n=!i&&this.match("*");n&&this.nextToken();var a=null,l=null;if(!e||!this.match("(")){var u=this.lookahead;a=this.parseVariableIdentifier(),this.context.strict?this.scanner.isRestrictedWord(u.value)&&this.tolerateUnexpectedToken(u,o.Messages.StrictFunctionName):this.scanner.isRestrictedWord(u.value)?(l=u,r=o.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(u.value)&&(l=u,r=o.Messages.StrictReservedWord)}var c=this.context.await,h=this.context.allowYield;this.context.await=i,this.context.allowYield=!n;var p=this.parseFormalParameters(l),d=p.params,f=p.stricted;l=p.firstRestricted,p.message&&(r=p.message);var m=this.context.strict,g=this.context.allowStrictDirective;this.context.allowStrictDirective=p.simple;var v=this.parseFunctionSourceElements();return this.context.strict&&l&&this.throwUnexpectedToken(l,r),this.context.strict&&f&&this.tolerateUnexpectedToken(f,r),this.context.strict=m,this.context.allowStrictDirective=g,this.context.await=c,this.context.allowYield=h,i?this.finalize(t,new s.AsyncFunctionDeclaration(a,d,v)):this.finalize(t,new s.FunctionDeclaration(a,d,v,n))},e.prototype.parseFunctionExpression=function(){var e=this.createNode(),t=this.matchContextualKeyword("async");t&&this.nextToken(),this.expectKeyword("function");var i,r=!t&&this.match("*");r&&this.nextToken();var n,a=null,l=this.context.await,u=this.context.allowYield;if(this.context.await=t,this.context.allowYield=!r,!this.match("(")){var c=this.lookahead;a=this.context.strict||r||!this.matchKeyword("yield")?this.parseVariableIdentifier():this.parseIdentifierName(),this.context.strict?this.scanner.isRestrictedWord(c.value)&&this.tolerateUnexpectedToken(c,o.Messages.StrictFunctionName):this.scanner.isRestrictedWord(c.value)?(n=c,i=o.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(c.value)&&(n=c,i=o.Messages.StrictReservedWord)}var h=this.parseFormalParameters(n),p=h.params,d=h.stricted;n=h.firstRestricted,h.message&&(i=h.message);var f=this.context.strict,m=this.context.allowStrictDirective;this.context.allowStrictDirective=h.simple;var g=this.parseFunctionSourceElements();return this.context.strict&&n&&this.throwUnexpectedToken(n,i),this.context.strict&&d&&this.tolerateUnexpectedToken(d,i),this.context.strict=f,this.context.allowStrictDirective=m,this.context.await=l,this.context.allowYield=u,t?this.finalize(e,new s.AsyncFunctionExpression(a,p,g)):this.finalize(e,new s.FunctionExpression(a,p,g,r))},e.prototype.parseDirective=function(){var e=this.lookahead,t=this.createNode(),i=this.parseExpression(),r=i.type===l.Syntax.Literal?this.getTokenRaw(e).slice(1,-1):null;return this.consumeSemicolon(),this.finalize(t,r?new s.Directive(i,r):new s.ExpressionStatement(i))},e.prototype.parseDirectivePrologues=function(){for(var e=null,t=[];;){var i=this.lookahead;if(8!==i.type)break;var r=this.parseDirective();t.push(r);var n=r.directive;if("string"!=typeof n)break;"use strict"===n?(this.context.strict=!0,e&&this.tolerateUnexpectedToken(e,o.Messages.StrictOctalLiteral),this.context.allowStrictDirective||this.tolerateUnexpectedToken(i,o.Messages.IllegalLanguageModeDirective)):!e&&i.octal&&(e=i)}return t},e.prototype.qualifiedPropertyName=function(e){switch(e.type){case 3:case 8:case 1:case 5:case 6:case 4:return!0;case 7:return"["===e.value}return!1},e.prototype.parseGetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var i=this.parseFormalParameters();i.params.length>0&&this.tolerateError(o.Messages.BadGetterArity);var r=this.parsePropertyMethod(i);return this.context.allowYield=t,this.finalize(e,new s.FunctionExpression(null,i.params,r,!1))},e.prototype.parseSetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var i=this.parseFormalParameters();1!==i.params.length?this.tolerateError(o.Messages.BadSetterArity):i.params[0]instanceof s.RestElement&&this.tolerateError(o.Messages.BadSetterRestParameter);var r=this.parsePropertyMethod(i);return this.context.allowYield=t,this.finalize(e,new s.FunctionExpression(null,i.params,r,!1))},e.prototype.parseGeneratorMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var i=this.parseFormalParameters();this.context.allowYield=!1;var r=this.parsePropertyMethod(i);return this.context.allowYield=t,this.finalize(e,new s.FunctionExpression(null,i.params,r,!0))},e.prototype.isStartOfExpression=function(){var e=!0,t=this.lookahead.value;switch(this.lookahead.type){case 7:e="["===t||"("===t||"{"===t||"+"===t||"-"===t||"!"===t||"~"===t||"++"===t||"--"===t||"/"===t||"/="===t;break;case 4:e="class"===t||"delete"===t||"function"===t||"let"===t||"new"===t||"super"===t||"this"===t||"typeof"===t||"void"===t||"yield"===t}return e},e.prototype.parseYieldExpression=function(){var e=this.createNode();this.expectKeyword("yield");var t=null,i=!1;if(!this.hasLineTerminator){var r=this.context.allowYield;this.context.allowYield=!1,(i=this.match("*"))?(this.nextToken(),t=this.parseAssignmentExpression()):this.isStartOfExpression()&&(t=this.parseAssignmentExpression()),this.context.allowYield=r}return this.finalize(e,new s.YieldExpression(t,i))},e.prototype.parseClassElement=function(e){var t=this.lookahead,i=this.createNode(),r="",n=null,a=null,l=!1,u=!1,c=!1,h=!1;if(this.match("*"))this.nextToken();else if(l=this.match("["),"static"===(n=this.parseObjectPropertyKey()).name&&(this.qualifiedPropertyName(this.lookahead)||this.match("*"))&&(t=this.lookahead,c=!0,l=this.match("["),this.match("*")?this.nextToken():n=this.parseObjectPropertyKey()),3===t.type&&!this.hasLineTerminator&&"async"===t.value){var p=this.lookahead.value;":"!==p&&"("!==p&&"*"!==p&&(h=!0,t=this.lookahead,n=this.parseObjectPropertyKey(),3===t.type&&"constructor"===t.value&&this.tolerateUnexpectedToken(t,o.Messages.ConstructorIsAsync))}var d=this.qualifiedPropertyName(this.lookahead);return 3===t.type?"get"===t.value&&d?(r="get",l=this.match("["),n=this.parseObjectPropertyKey(),this.context.allowYield=!1,a=this.parseGetterMethod()):"set"===t.value&&d&&(r="set",l=this.match("["),n=this.parseObjectPropertyKey(),a=this.parseSetterMethod()):7===t.type&&"*"===t.value&&d&&(r="init",l=this.match("["),n=this.parseObjectPropertyKey(),a=this.parseGeneratorMethod(),u=!0),!r&&n&&this.match("(")&&(r="init",a=h?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),u=!0),r||this.throwUnexpectedToken(this.lookahead),"init"===r&&(r="method"),l||(c&&this.isPropertyKey(n,"prototype")&&this.throwUnexpectedToken(t,o.Messages.StaticPrototype),!c&&this.isPropertyKey(n,"constructor")&&(("method"!==r||!u||a&&a.generator)&&this.throwUnexpectedToken(t,o.Messages.ConstructorSpecialMethod),e.value?this.throwUnexpectedToken(t,o.Messages.DuplicateConstructor):e.value=!0,r="constructor")),this.finalize(i,new s.MethodDefinition(n,l,a,r,c))},e.prototype.parseClassElementList=function(){var e=[],t={value:!1};for(this.expect("{");!this.match("}");)this.match(";")?this.nextToken():e.push(this.parseClassElement(t));return this.expect("}"),e},e.prototype.parseClassBody=function(){var e=this.createNode(),t=this.parseClassElementList();return this.finalize(e,new s.ClassBody(t))},e.prototype.parseClassDeclaration=function(e){var t=this.createNode(),i=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var r=e&&3!==this.lookahead.type?null:this.parseVariableIdentifier(),n=null;this.matchKeyword("extends")&&(this.nextToken(),n=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var o=this.parseClassBody();return this.context.strict=i,this.finalize(t,new s.ClassDeclaration(r,n,o))},e.prototype.parseClassExpression=function(){var e=this.createNode(),t=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var i=3===this.lookahead.type?this.parseVariableIdentifier():null,r=null;this.matchKeyword("extends")&&(this.nextToken(),r=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var n=this.parseClassBody();return this.context.strict=t,this.finalize(e,new s.ClassExpression(i,r,n))},e.prototype.parseModule=function(){this.context.strict=!0,this.context.isModule=!0,this.scanner.isModule=!0;for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new s.Module(t))},e.prototype.parseScript=function(){for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new s.Script(t))},e.prototype.parseModuleSpecifier=function(){var e=this.createNode();8!==this.lookahead.type&&this.throwError(o.Messages.InvalidModuleSpecifier);var t=this.nextToken(),i=this.getTokenRaw(t);return this.finalize(e,new s.Literal(t.value,i))},e.prototype.parseImportSpecifier=function(){var e,t,i=this.createNode();return 3===this.lookahead.type?(t=e=this.parseVariableIdentifier(),this.matchContextualKeyword("as")&&(this.nextToken(),t=this.parseVariableIdentifier())):(t=e=this.parseIdentifierName(),this.matchContextualKeyword("as")?(this.nextToken(),t=this.parseVariableIdentifier()):this.throwUnexpectedToken(this.nextToken())),this.finalize(i,new s.ImportSpecifier(t,e))},e.prototype.parseNamedImports=function(){this.expect("{");for(var e=[];!this.match("}");)e.push(this.parseImportSpecifier()),this.match("}")||this.expect(",");return this.expect("}"),e},e.prototype.parseImportDefaultSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName();return this.finalize(e,new s.ImportDefaultSpecifier(t))},e.prototype.parseImportNamespaceSpecifier=function(){var e=this.createNode();this.expect("*"),this.matchContextualKeyword("as")||this.throwError(o.Messages.NoAsAfterImportNamespace),this.nextToken();var t=this.parseIdentifierName();return this.finalize(e,new s.ImportNamespaceSpecifier(t))},e.prototype.parseImportDeclaration=function(){this.context.inFunctionBody&&this.throwError(o.Messages.IllegalImportDeclaration);var e,t=this.createNode();this.expectKeyword("import");var i=[];if(8===this.lookahead.type)e=this.parseModuleSpecifier();else{if(this.match("{")?i=i.concat(this.parseNamedImports()):this.match("*")?i.push(this.parseImportNamespaceSpecifier()):this.isIdentifierName(this.lookahead)&&!this.matchKeyword("default")?(i.push(this.parseImportDefaultSpecifier()),this.match(",")&&(this.nextToken(),this.match("*")?i.push(this.parseImportNamespaceSpecifier()):this.match("{")?i=i.concat(this.parseNamedImports()):this.throwUnexpectedToken(this.lookahead))):this.throwUnexpectedToken(this.nextToken()),!this.matchContextualKeyword("from")){var r=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause;this.throwError(r,this.lookahead.value)}this.nextToken(),e=this.parseModuleSpecifier()}return this.consumeSemicolon(),this.finalize(t,new s.ImportDeclaration(i,e))},e.prototype.parseExportSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName(),i=t;return this.matchContextualKeyword("as")&&(this.nextToken(),i=this.parseIdentifierName()),this.finalize(e,new s.ExportSpecifier(t,i))},e.prototype.parseExportDeclaration=function(){this.context.inFunctionBody&&this.throwError(o.Messages.IllegalExportDeclaration);var e,t=this.createNode();if(this.expectKeyword("export"),this.matchKeyword("default"))if(this.nextToken(),this.matchKeyword("function")){var i=this.parseFunctionDeclaration(!0);e=this.finalize(t,new s.ExportDefaultDeclaration(i))}else this.matchKeyword("class")?(i=this.parseClassDeclaration(!0),e=this.finalize(t,new s.ExportDefaultDeclaration(i))):this.matchContextualKeyword("async")?(i=this.matchAsyncFunction()?this.parseFunctionDeclaration(!0):this.parseAssignmentExpression(),e=this.finalize(t,new s.ExportDefaultDeclaration(i))):(this.matchContextualKeyword("from")&&this.throwError(o.Messages.UnexpectedToken,this.lookahead.value),i=this.match("{")?this.parseObjectInitializer():this.match("[")?this.parseArrayInitializer():this.parseAssignmentExpression(),this.consumeSemicolon(),e=this.finalize(t,new s.ExportDefaultDeclaration(i)));else if(this.match("*")){if(this.nextToken(),!this.matchContextualKeyword("from")){var r=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause;this.throwError(r,this.lookahead.value)}this.nextToken();var n=this.parseModuleSpecifier();this.consumeSemicolon(),e=this.finalize(t,new s.ExportAllDeclaration(n))}else if(4===this.lookahead.type){switch(i=void 0,this.lookahead.value){case"let":case"const":i=this.parseLexicalDeclaration({inFor:!1});break;case"var":case"class":case"function":i=this.parseStatementListItem();break;default:this.throwUnexpectedToken(this.lookahead)}e=this.finalize(t,new s.ExportNamedDeclaration(i,[],null))}else if(this.matchAsyncFunction())i=this.parseFunctionDeclaration(),e=this.finalize(t,new s.ExportNamedDeclaration(i,[],null));else{var a=[],l=null,u=!1;for(this.expect("{");!this.match("}");)u=u||this.matchKeyword("default"),a.push(this.parseExportSpecifier()),this.match("}")||this.expect(",");this.expect("}"),this.matchContextualKeyword("from")?(this.nextToken(),l=this.parseModuleSpecifier(),this.consumeSemicolon()):u?(r=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause,this.throwError(r,this.lookahead.value)):this.consumeSemicolon(),e=this.finalize(t,new s.ExportNamedDeclaration(null,a,l))}return e},e}();t.Parser=c},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assert=function(e,t){if(!e)throw new Error("ASSERT: "+t)}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.errors=[],this.tolerant=!1}return e.prototype.recordError=function(e){this.errors.push(e)},e.prototype.tolerate=function(e){if(!this.tolerant)throw e;this.recordError(e)},e.prototype.constructError=function(e,t){var i=new Error(e);try{throw i}catch(e){Object.create&&Object.defineProperty&&(i=Object.create(e),Object.defineProperty(i,"column",{value:t}))}return i},e.prototype.createError=function(e,t,i,r){var n="Line "+t+": "+r,o=this.constructError(n,i);return o.index=e,o.lineNumber=t,o.description=r,o},e.prototype.throwError=function(e,t,i,r){throw this.createError(e,t,i,r)},e.prototype.tolerateError=function(e,t,i,r){var n=this.createError(e,t,i,r);if(!this.tolerant)throw n;this.recordError(n)},e}();t.ErrorHandler=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Messages={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(9),n=i(4),o=i(11);function s(e){return"0123456789abcdef".indexOf(e.toLowerCase())}function a(e){return"01234567".indexOf(e)}var l=function(){function e(e,t){this.source=e,this.errorHandler=t,this.trackComment=!1,this.isModule=!1,this.length=e.length,this.index=0,this.lineNumber=e.length>0?1:0,this.lineStart=0,this.curlyStack=[]}return e.prototype.saveState=function(){return{index:this.index,lineNumber:this.lineNumber,lineStart:this.lineStart}},e.prototype.restoreState=function(e){this.index=e.index,this.lineNumber=e.lineNumber,this.lineStart=e.lineStart},e.prototype.eof=function(){return this.index>=this.length},e.prototype.throwUnexpectedToken=function(e){return void 0===e&&(e=o.Messages.UnexpectedTokenIllegal),this.errorHandler.throwError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.tolerateUnexpectedToken=function(e){void 0===e&&(e=o.Messages.UnexpectedTokenIllegal),this.errorHandler.tolerateError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.skipSingleLineComment=function(e){var t,i,r=[];for(this.trackComment&&(r=[],t=this.index-e,i={start:{line:this.lineNumber,column:this.index-this.lineStart-e},end:{}});!this.eof();){var o=this.source.charCodeAt(this.index);if(++this.index,n.Character.isLineTerminator(o)){if(this.trackComment){i.end={line:this.lineNumber,column:this.index-this.lineStart-1};var s={multiLine:!1,slice:[t+e,this.index-1],range:[t,this.index-1],loc:i};r.push(s)}return 13===o&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,r}}return this.trackComment&&(i.end={line:this.lineNumber,column:this.index-this.lineStart},s={multiLine:!1,slice:[t+e,this.index],range:[t,this.index],loc:i},r.push(s)),r},e.prototype.skipMultiLineComment=function(){var e,t,i=[];for(this.trackComment&&(i=[],e=this.index-2,t={start:{line:this.lineNumber,column:this.index-this.lineStart-2},end:{}});!this.eof();){var r=this.source.charCodeAt(this.index);if(n.Character.isLineTerminator(r))13===r&&10===this.source.charCodeAt(this.index+1)&&++this.index,++this.lineNumber,++this.index,this.lineStart=this.index;else if(42===r){if(47===this.source.charCodeAt(this.index+1)){if(this.index+=2,this.trackComment){t.end={line:this.lineNumber,column:this.index-this.lineStart};var o={multiLine:!0,slice:[e+2,this.index-2],range:[e,this.index],loc:t};i.push(o)}return i}++this.index}else++this.index}return this.trackComment&&(t.end={line:this.lineNumber,column:this.index-this.lineStart},o={multiLine:!0,slice:[e+2,this.index],range:[e,this.index],loc:t},i.push(o)),this.tolerateUnexpectedToken(),i},e.prototype.scanComments=function(){var e;this.trackComment&&(e=[]);for(var t=0===this.index;!this.eof();){var i=this.source.charCodeAt(this.index);if(n.Character.isWhiteSpace(i))++this.index;else if(n.Character.isLineTerminator(i))++this.index,13===i&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,t=!0;else if(47===i)if(47===(i=this.source.charCodeAt(this.index+1))){this.index+=2;var r=this.skipSingleLineComment(2);this.trackComment&&(e=e.concat(r)),t=!0}else{if(42!==i)break;this.index+=2,r=this.skipMultiLineComment(),this.trackComment&&(e=e.concat(r))}else if(t&&45===i){if(45!==this.source.charCodeAt(this.index+1)||62!==this.source.charCodeAt(this.index+2))break;this.index+=3,r=this.skipSingleLineComment(3),this.trackComment&&(e=e.concat(r))}else{if(60!==i||this.isModule)break;if("!--"!==this.source.slice(this.index+1,this.index+4))break;this.index+=4,r=this.skipSingleLineComment(4),this.trackComment&&(e=e.concat(r))}}return e},e.prototype.isFutureReservedWord=function(e){switch(e){case"enum":case"export":case"import":case"super":return!0;default:return!1}},e.prototype.isStrictModeReservedWord=function(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}},e.prototype.isRestrictedWord=function(e){return"eval"===e||"arguments"===e},e.prototype.isKeyword=function(e){switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}},e.prototype.codePointAt=function(e){var t=this.source.charCodeAt(e);if(t>=55296&&t<=56319){var i=this.source.charCodeAt(e+1);i>=56320&&i<=57343&&(t=1024*(t-55296)+i-56320+65536)}return t},e.prototype.scanHexEscape=function(e){for(var t="u"===e?4:2,i=0,r=0;r<t;++r){if(this.eof()||!n.Character.isHexDigit(this.source.charCodeAt(this.index)))return null;i=16*i+s(this.source[this.index++])}return String.fromCharCode(i)},e.prototype.scanUnicodeCodePointEscape=function(){var e=this.source[this.index],t=0;for("}"===e&&this.throwUnexpectedToken();!this.eof()&&(e=this.source[this.index++],n.Character.isHexDigit(e.charCodeAt(0)));)t=16*t+s(e);return(t>1114111||"}"!==e)&&this.throwUnexpectedToken(),n.Character.fromCodePoint(t)},e.prototype.getIdentifier=function(){for(var e=this.index++;!this.eof();){var t=this.source.charCodeAt(this.index);if(92===t)return this.index=e,this.getComplexIdentifier();if(t>=55296&&t<57343)return this.index=e,this.getComplexIdentifier();if(!n.Character.isIdentifierPart(t))break;++this.index}return this.source.slice(e,this.index)},e.prototype.getComplexIdentifier=function(){var e,t=this.codePointAt(this.index),i=n.Character.fromCodePoint(t);for(this.index+=i.length,92===t&&(117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this.scanUnicodeCodePointEscape()):null!==(e=this.scanHexEscape("u"))&&"\\"!==e&&n.Character.isIdentifierStart(e.charCodeAt(0))||this.throwUnexpectedToken(),i=e);!this.eof()&&(t=this.codePointAt(this.index),n.Character.isIdentifierPart(t));)i+=e=n.Character.fromCodePoint(t),this.index+=e.length,92===t&&(i=i.substr(0,i.length-1),117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this.scanUnicodeCodePointEscape()):null!==(e=this.scanHexEscape("u"))&&"\\"!==e&&n.Character.isIdentifierPart(e.charCodeAt(0))||this.throwUnexpectedToken(),i+=e);return i},e.prototype.octalToDecimal=function(e){var t="0"!==e,i=a(e);return!this.eof()&&n.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(t=!0,i=8*i+a(this.source[this.index++]),"0123".indexOf(e)>=0&&!this.eof()&&n.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(i=8*i+a(this.source[this.index++]))),{code:i,octal:t}},e.prototype.scanIdentifier=function(){var e,t=this.index,i=92===this.source.charCodeAt(t)?this.getComplexIdentifier():this.getIdentifier();if(3!=(e=1===i.length?3:this.isKeyword(i)?4:"null"===i?5:"true"===i||"false"===i?1:3)&&t+i.length!==this.index){var r=this.index;this.index=t,this.tolerateUnexpectedToken(o.Messages.InvalidEscapedReservedWord),this.index=r}return{type:e,value:i,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.scanPunctuator=function(){var e=this.index,t=this.source[this.index];switch(t){case"(":case"{":"{"===t&&this.curlyStack.push("{"),++this.index;break;case".":++this.index,"."===this.source[this.index]&&"."===this.source[this.index+1]&&(this.index+=2,t="...");break;case"}":++this.index,this.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;default:">>>="===(t=this.source.substr(this.index,4))?this.index+=4:"==="===(t=t.substr(0,3))||"!=="===t||">>>"===t||"<<="===t||">>="===t||"**="===t?this.index+=3:"&&"===(t=t.substr(0,2))||"||"===t||"=="===t||"!="===t||"+="===t||"-="===t||"*="===t||"/="===t||"++"===t||"--"===t||"<<"===t||">>"===t||"&="===t||"|="===t||"^="===t||"%="===t||"<="===t||">="===t||"=>"===t||"**"===t?this.index+=2:(t=this.source[this.index],"<>=!+-*%&|^/".indexOf(t)>=0&&++this.index)}return this.index===e&&this.throwUnexpectedToken(),{type:7,value:t,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanHexLiteral=function(e){for(var t="";!this.eof()&&n.Character.isHexDigit(this.source.charCodeAt(this.index));)t+=this.source[this.index++];return 0===t.length&&this.throwUnexpectedToken(),n.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseInt("0x"+t,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanBinaryLiteral=function(e){for(var t,i="";!this.eof()&&("0"===(t=this.source[this.index])||"1"===t);)i+=this.source[this.index++];return 0===i.length&&this.throwUnexpectedToken(),this.eof()||(t=this.source.charCodeAt(this.index),(n.Character.isIdentifierStart(t)||n.Character.isDecimalDigit(t))&&this.throwUnexpectedToken()),{type:6,value:parseInt(i,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanOctalLiteral=function(e,t){var i="",r=!1;for(n.Character.isOctalDigit(e.charCodeAt(0))?(r=!0,i="0"+this.source[this.index++]):++this.index;!this.eof()&&n.Character.isOctalDigit(this.source.charCodeAt(this.index));)i+=this.source[this.index++];return r||0!==i.length||this.throwUnexpectedToken(),(n.Character.isIdentifierStart(this.source.charCodeAt(this.index))||n.Character.isDecimalDigit(this.source.charCodeAt(this.index)))&&this.throwUnexpectedToken(),{type:6,value:parseInt(i,8),octal:r,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.isImplicitOctalLiteral=function(){for(var e=this.index+1;e<this.length;++e){var t=this.source[e];if("8"===t||"9"===t)return!1;if(!n.Character.isOctalDigit(t.charCodeAt(0)))return!0}return!0},e.prototype.scanNumericLiteral=function(){var e=this.index,t=this.source[e];r.assert(n.Character.isDecimalDigit(t.charCodeAt(0))||"."===t,"Numeric literal must start with a decimal digit or a decimal point");var i="";if("."!==t){if(i=this.source[this.index++],t=this.source[this.index],"0"===i){if("x"===t||"X"===t)return++this.index,this.scanHexLiteral(e);if("b"===t||"B"===t)return++this.index,this.scanBinaryLiteral(e);if("o"===t||"O"===t)return this.scanOctalLiteral(t,e);if(t&&n.Character.isOctalDigit(t.charCodeAt(0))&&this.isImplicitOctalLiteral())return this.scanOctalLiteral(t,e)}for(;n.Character.isDecimalDigit(this.source.charCodeAt(this.index));)i+=this.source[this.index++];t=this.source[this.index]}if("."===t){for(i+=this.source[this.index++];n.Character.isDecimalDigit(this.source.charCodeAt(this.index));)i+=this.source[this.index++];t=this.source[this.index]}if("e"===t||"E"===t)if(i+=this.source[this.index++],"+"!==(t=this.source[this.index])&&"-"!==t||(i+=this.source[this.index++]),n.Character.isDecimalDigit(this.source.charCodeAt(this.index)))for(;n.Character.isDecimalDigit(this.source.charCodeAt(this.index));)i+=this.source[this.index++];else this.throwUnexpectedToken();return n.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseFloat(i),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanStringLiteral=function(){var e=this.index,t=this.source[e];r.assert("'"===t||'"'===t,"String literal must starts with a quote"),++this.index;for(var i=!1,s="";!this.eof();){var a=this.source[this.index++];if(a===t){t="";break}if("\\"===a)if((a=this.source[this.index++])&&n.Character.isLineTerminator(a.charCodeAt(0)))++this.lineNumber,"\r"===a&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(a){case"u":if("{"===this.source[this.index])++this.index,s+=this.scanUnicodeCodePointEscape();else{var l=this.scanHexEscape(a);null===l&&this.throwUnexpectedToken(),s+=l}break;case"x":var u=this.scanHexEscape(a);null===u&&this.throwUnexpectedToken(o.Messages.InvalidHexEscapeSequence),s+=u;break;case"n":s+="\n";break;case"r":s+="\r";break;case"t":s+="\t";break;case"b":s+="\b";break;case"f":s+="\f";break;case"v":s+="\v";break;case"8":case"9":s+=a,this.tolerateUnexpectedToken();break;default:if(a&&n.Character.isOctalDigit(a.charCodeAt(0))){var c=this.octalToDecimal(a);i=c.octal||i,s+=String.fromCharCode(c.code)}else s+=a}else{if(n.Character.isLineTerminator(a.charCodeAt(0)))break;s+=a}}return""!==t&&(this.index=e,this.throwUnexpectedToken()),{type:8,value:s,octal:i,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanTemplate=function(){var e="",t=!1,i=this.index,r="`"===this.source[i],s=!1,a=2;for(++this.index;!this.eof();){var l=this.source[this.index++];if("`"===l){a=1,s=!0,t=!0;break}if("$"===l){if("{"===this.source[this.index]){this.curlyStack.push("${"),++this.index,t=!0;break}e+=l}else if("\\"===l)if(l=this.source[this.index++],n.Character.isLineTerminator(l.charCodeAt(0)))++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(l){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"u":if("{"===this.source[this.index])++this.index,e+=this.scanUnicodeCodePointEscape();else{var u=this.index,c=this.scanHexEscape(l);null!==c?e+=c:(this.index=u,e+=l)}break;case"x":var h=this.scanHexEscape(l);null===h&&this.throwUnexpectedToken(o.Messages.InvalidHexEscapeSequence),e+=h;break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:"0"===l?(n.Character.isDecimalDigit(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(o.Messages.TemplateOctalLiteral),e+="\0"):n.Character.isOctalDigit(l.charCodeAt(0))?this.throwUnexpectedToken(o.Messages.TemplateOctalLiteral):e+=l}else n.Character.isLineTerminator(l.charCodeAt(0))?(++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index,e+="\n"):e+=l}return t||this.throwUnexpectedToken(),r||this.curlyStack.pop(),{type:10,value:this.source.slice(i+1,this.index-a),cooked:e,head:r,tail:s,lineNumber:this.lineNumber,lineStart:this.lineStart,start:i,end:this.index}},e.prototype.testRegExp=function(e,t){var i=e,r=this;t.indexOf("u")>=0&&(i=i.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,(function(e,t,i){var n=parseInt(t||i,16);return n>1114111&&r.throwUnexpectedToken(o.Messages.InvalidRegExp),n<=65535?String.fromCharCode(n):"￿"})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"￿"));try{RegExp(i)}catch(e){this.throwUnexpectedToken(o.Messages.InvalidRegExp)}try{return new RegExp(e,t)}catch(e){return null}},e.prototype.scanRegExpBody=function(){var e=this.source[this.index];r.assert("/"===e,"Regular expression literal must start with a slash");for(var t=this.source[this.index++],i=!1,s=!1;!this.eof();)if(t+=e=this.source[this.index++],"\\"===e)e=this.source[this.index++],n.Character.isLineTerminator(e.charCodeAt(0))&&this.throwUnexpectedToken(o.Messages.UnterminatedRegExp),t+=e;else if(n.Character.isLineTerminator(e.charCodeAt(0)))this.throwUnexpectedToken(o.Messages.UnterminatedRegExp);else if(i)"]"===e&&(i=!1);else{if("/"===e){s=!0;break}"["===e&&(i=!0)}return s||this.throwUnexpectedToken(o.Messages.UnterminatedRegExp),t.substr(1,t.length-2)},e.prototype.scanRegExpFlags=function(){for(var e="";!this.eof();){var t=this.source[this.index];if(!n.Character.isIdentifierPart(t.charCodeAt(0)))break;if(++this.index,"\\"!==t||this.eof())e+=t;else if("u"===(t=this.source[this.index])){++this.index;var i=this.index,r=this.scanHexEscape("u");if(null!==r)for(e+=r;i<this.index;++i)this.source[i];else this.index=i,e+="u";this.tolerateUnexpectedToken()}else this.tolerateUnexpectedToken()}return e},e.prototype.scanRegExp=function(){var e=this.index,t=this.scanRegExpBody(),i=this.scanRegExpFlags();return{type:9,value:"",pattern:t,flags:i,regex:this.testRegExp(t,i),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.lex=function(){if(this.eof())return{type:2,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};var e=this.source.charCodeAt(this.index);return n.Character.isIdentifierStart(e)?this.scanIdentifier():40===e||41===e||59===e?this.scanPunctuator():39===e||34===e?this.scanStringLiteral():46===e?n.Character.isDecimalDigit(this.source.charCodeAt(this.index+1))?this.scanNumericLiteral():this.scanPunctuator():n.Character.isDecimalDigit(e)?this.scanNumericLiteral():96===e||125===e&&"${"===this.curlyStack[this.curlyStack.length-1]?this.scanTemplate():e>=55296&&e<57343&&n.Character.isIdentifierStart(this.codePointAt(this.index))?this.scanIdentifier():this.scanPunctuator()},e}();t.Scanner=l},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenName={},t.TokenName[1]="Boolean",t.TokenName[2]="<end>",t.TokenName[3]="Identifier",t.TokenName[4]="Keyword",t.TokenName[5]="Null",t.TokenName[6]="Numeric",t.TokenName[7]="Punctuator",t.TokenName[8]="String",t.TokenName[9]="RegularExpression",t.TokenName[10]="Template"},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XHTMLEntities={quot:'"',amp:"&",apos:"'",gt:">",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",times:"×",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",divide:"÷",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",frasl:"⁄",euro:"€",image:"ℑ",weierp:"℘",real:"ℜ",trade:"™",alefsym:"ℵ",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lArr:"⇐",uArr:"⇑",rArr:"⇒",dArr:"⇓",hArr:"⇔",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦",lang:"⟨",rang:"⟩"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(10),n=i(12),o=i(13),s=function(){function e(){this.values=[],this.curly=this.paren=-1}return e.prototype.beforeFunctionExpression=function(e){return["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","**","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="].indexOf(e)>=0},e.prototype.isRegexStart=function(){var e=this.values[this.values.length-1],t=null!==e;switch(e){case"this":case"]":t=!1;break;case")":var i=this.values[this.paren-1];t="if"===i||"while"===i||"for"===i||"with"===i;break;case"}":if(t=!1,"function"===this.values[this.curly-3])t=!!(r=this.values[this.curly-4])&&!this.beforeFunctionExpression(r);else if("function"===this.values[this.curly-4]){var r;t=!(r=this.values[this.curly-5])||!this.beforeFunctionExpression(r)}}return t},e.prototype.push=function(e){7===e.type||4===e.type?("{"===e.value?this.curly=this.values.length:"("===e.value&&(this.paren=this.values.length),this.values.push(e.value)):this.values.push(null)},e}(),a=function(){function e(e,t){this.errorHandler=new r.ErrorHandler,this.errorHandler.tolerant=!!t&&"boolean"==typeof t.tolerant&&t.tolerant,this.scanner=new n.Scanner(e,this.errorHandler),this.scanner.trackComment=!!t&&"boolean"==typeof t.comment&&t.comment,this.trackRange=!!t&&"boolean"==typeof t.range&&t.range,this.trackLoc=!!t&&"boolean"==typeof t.loc&&t.loc,this.buffer=[],this.reader=new s}return e.prototype.errors=function(){return this.errorHandler.errors},e.prototype.getNextToken=function(){if(0===this.buffer.length){var e=this.scanner.scanComments();if(this.scanner.trackComment)for(var t=0;t<e.length;++t){var i=e[t],r=this.scanner.source.slice(i.slice[0],i.slice[1]),n={type:i.multiLine?"BlockComment":"LineComment",value:r};this.trackRange&&(n.range=i.range),this.trackLoc&&(n.loc=i.loc),this.buffer.push(n)}if(!this.scanner.eof()){var s=void 0;this.trackLoc&&(s={start:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},end:{}});var a="/"===this.scanner.source[this.scanner.index]&&this.reader.isRegexStart()?this.scanner.scanRegExp():this.scanner.lex();this.reader.push(a);var l={type:o.TokenName[a.type],value:this.scanner.source.slice(a.start,a.end)};if(this.trackRange&&(l.range=[a.start,a.end]),this.trackLoc&&(s.end={line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},l.loc=s),9===a.type){var u=a.pattern,c=a.flags;l.regex={pattern:u,flags:c}}this.buffer.push(l)}}return this.buffer.shift()},e}();t.Tokenizer=a}])},e.exports=r()},"./node_modules/estraverse/estraverse.js":
/*!***********************************************!*\
  !*** ./node_modules/estraverse/estraverse.js ***!
  \***********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){!function e(t){"use strict";var r,n,o,s,a,l;function u(e){var t,i,r={};for(t in e)e.hasOwnProperty(t)&&(i=e[t],r[t]="object"==typeof i&&null!==i?u(i):i);return r}function c(e,t){this.parent=e,this.key=t}function h(e,t,i,r){this.node=e,this.path=t,this.wrap=i,this.ref=r}function p(){}function d(e){return null!=e&&"object"==typeof e&&"string"==typeof e.type}function f(e,t){return(e===r.ObjectExpression||e===r.ObjectPattern)&&"properties"===t}function m(e,t){return(new p).traverse(e,t)}function g(e,t){var i;return i=function(e,t){var i,r,n,o;for(r=e.length,n=0;r;)t(e[o=n+(i=r>>>1)])?r=i:(n=o+1,r-=i+1);return n}(t,(function(t){return t.range[0]>e.range[0]})),e.extendedRange=[e.range[0],e.range[1]],i!==t.length&&(e.extendedRange[1]=t[i].range[0]),(i-=1)>=0&&(e.extendedRange[0]=t[i].range[1]),e}return r={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportExpression:"ImportExpression",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"},o={AssignmentExpression:["left","right"],AssignmentPattern:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","superClass","body"],ClassExpression:["id","superClass","body"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportAllDeclaration:["source"],ExportDefaultDeclaration:["declaration"],ExportNamedDeclaration:["declaration","specifiers","source"],ExportSpecifier:["exported","local"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","body"],FunctionExpression:["id","params","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportExpression:["source"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["local"],ImportNamespaceSpecifier:["local"],ImportSpecifier:["imported","local"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MetaProperty:["meta","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],RestElement:["argument"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],Super:[],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handler","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]},n={Break:s={},Skip:a={},Remove:l={}},c.prototype.replace=function(e){this.parent[this.key]=e},c.prototype.remove=function(){return Array.isArray(this.parent)?(this.parent.splice(this.key,1),!0):(this.replace(null),!1)},p.prototype.path=function(){var e,t,i,r,n;function o(e,t){if(Array.isArray(t))for(i=0,r=t.length;i<r;++i)e.push(t[i]);else e.push(t)}if(!this.__current.path)return null;for(n=[],e=2,t=this.__leavelist.length;e<t;++e)o(n,this.__leavelist[e].path);return o(n,this.__current.path),n},p.prototype.type=function(){return this.current().type||this.__current.wrap},p.prototype.parents=function(){var e,t,i;for(i=[],e=1,t=this.__leavelist.length;e<t;++e)i.push(this.__leavelist[e].node);return i},p.prototype.current=function(){return this.__current.node},p.prototype.__execute=function(e,t){var i,r;return r=void 0,i=this.__current,this.__current=t,this.__state=null,e&&(r=e.call(this,t.node,this.__leavelist[this.__leavelist.length-1].node)),this.__current=i,r},p.prototype.notify=function(e){this.__state=e},p.prototype.skip=function(){this.notify(a)},p.prototype.break=function(){this.notify(s)},p.prototype.remove=function(){this.notify(l)},p.prototype.__initialize=function(e,t){this.visitor=t,this.root=e,this.__worklist=[],this.__leavelist=[],this.__current=null,this.__state=null,this.__fallback=null,"iteration"===t.fallback?this.__fallback=Object.keys:"function"==typeof t.fallback&&(this.__fallback=t.fallback),this.__keys=o,t.keys&&(this.__keys=Object.assign(Object.create(this.__keys),t.keys))},p.prototype.traverse=function(e,t){var i,r,n,o,l,u,c,p,m,g,v,y;for(this.__initialize(e,t),y={},i=this.__worklist,r=this.__leavelist,i.push(new h(e,null,null,null)),r.push(new h(null,null,null,null));i.length;)if((n=i.pop())!==y){if(n.node){if(u=this.__execute(t.enter,n),this.__state===s||u===s)return;if(i.push(y),r.push(n),this.__state===a||u===a)continue;if(l=(o=n.node).type||n.wrap,!(g=this.__keys[l])){if(!this.__fallback)throw new Error("Unknown node type "+l+".");g=this.__fallback(o)}for(p=g.length;(p-=1)>=0;)if(v=o[c=g[p]])if(Array.isArray(v)){for(m=v.length;(m-=1)>=0;)if(v[m]){if(f(l,g[p]))n=new h(v[m],[c,m],"Property",null);else{if(!d(v[m]))continue;n=new h(v[m],[c,m],null,null)}i.push(n)}}else d(v)&&i.push(new h(v,c,null,null))}}else if(n=r.pop(),u=this.__execute(t.leave,n),this.__state===s||u===s)return},p.prototype.replace=function(e,t){var i,r,n,o,u,p,m,g,v,y,b,_,x;function E(e){var t,r,n,o;if(e.ref.remove())for(r=e.ref.key,o=e.ref.parent,t=i.length;t--;)if((n=i[t]).ref&&n.ref.parent===o){if(n.ref.key<r)break;--n.ref.key}}for(this.__initialize(e,t),b={},i=this.__worklist,r=this.__leavelist,p=new h(e,null,null,new c(_={root:e},"root")),i.push(p),r.push(p);i.length;)if((p=i.pop())!==b){if(void 0!==(u=this.__execute(t.enter,p))&&u!==s&&u!==a&&u!==l&&(p.ref.replace(u),p.node=u),this.__state!==l&&u!==l||(E(p),p.node=null),this.__state===s||u===s)return _.root;if((n=p.node)&&(i.push(b),r.push(p),this.__state!==a&&u!==a)){if(o=n.type||p.wrap,!(v=this.__keys[o])){if(!this.__fallback)throw new Error("Unknown node type "+o+".");v=this.__fallback(n)}for(m=v.length;(m-=1)>=0;)if(y=n[x=v[m]])if(Array.isArray(y)){for(g=y.length;(g-=1)>=0;)if(y[g]){if(f(o,v[m]))p=new h(y[g],[x,g],"Property",new c(y,g));else{if(!d(y[g]))continue;p=new h(y[g],[x,g],null,new c(y,g))}i.push(p)}}else d(y)&&i.push(new h(y,x,null,new c(n,x)))}}else if(p=r.pop(),void 0!==(u=this.__execute(t.leave,p))&&u!==s&&u!==a&&u!==l&&p.ref.replace(u),this.__state!==l&&u!==l||E(p),this.__state===s||u===s)return _.root;return _.root},t.version=i(/*! ./package.json */"./node_modules/estraverse/package.json").version,t.Syntax=r,t.traverse=m,t.replace=function(e,t){return(new p).replace(e,t)},t.attachComments=function(e,t,i){var r,o,s,a,l=[];if(!e.range)throw new Error("attachComments needs range information");if(!i.length){if(t.length){for(s=0,o=t.length;s<o;s+=1)(r=u(t[s])).extendedRange=[0,e.range[0]],l.push(r);e.leadingComments=l}return e}for(s=0,o=t.length;s<o;s+=1)l.push(g(u(t[s]),i));return a=0,m(e,{enter:function(e){for(var t;a<l.length&&!((t=l[a]).extendedRange[1]>e.range[0]);)t.extendedRange[1]===e.range[0]?(e.leadingComments||(e.leadingComments=[]),e.leadingComments.push(t),l.splice(a,1)):a+=1;return a===l.length?n.Break:l[a].extendedRange[0]>e.range[1]?n.Skip:void 0}}),a=0,m(e,{leave:function(e){for(var t;a<l.length&&(t=l[a],!(e.range[1]<t.extendedRange[0]));)e.range[1]===t.extendedRange[0]?(e.trailingComments||(e.trailingComments=[]),e.trailingComments.push(t),l.splice(a,1)):a+=1;return a===l.length?n.Break:l[a].extendedRange[0]>e.range[1]?n.Skip:void 0}}),e},t.VisitorKeys=o,t.VisitorOption=n,t.Controller=p,t.cloneEnvironment=function(){return e({})},t}(t)},"./node_modules/estraverse/package.json":
/*!**********************************************!*\
  !*** ./node_modules/estraverse/package.json ***!
  \**********************************************/
/*! exports provided: _from, _id, _inBundle, _integrity, _location, _phantomChildren, _requested, _requiredBy, _resolved, _shasum, _spec, _where, bugs, bundleDependencies, deprecated, description, devDependencies, engines, homepage, license, main, maintainers, name, repository, scripts, version, default */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e){e.exports=JSON.parse('{"_from":"estraverse@^4.1.1","_id":"estraverse@4.3.0","_inBundle":false,"_integrity":"sha512-39nnKffWz8xN1BU/2c79n9nB9HDzo0niYUqx6xyqUnyoAnQyyWpOTdZEeiCch8BBu515t4wp9ZmgVfVhn9EBpw==","_location":"/estraverse","_phantomChildren":{},"_requested":{"type":"range","registry":true,"raw":"estraverse@^4.1.1","name":"estraverse","escapedName":"estraverse","rawSpec":"^4.1.1","saveSpec":null,"fetchSpec":"^4.1.1"},"_requiredBy":["/eslint-scope","/esquery","/esrecurse"],"_resolved":"https://registry.npmjs.org/estraverse/-/estraverse-4.3.0.tgz","_shasum":"398ad3f3c5a24948be7725e83d11a7de28cdbd1d","_spec":"estraverse@^4.1.1","_where":"D:\\\\SourceCodes\\\\THING.EVAL\\\\node_modules\\\\eslint-scope","bugs":{"url":"https://github.com/estools/estraverse/issues"},"bundleDependencies":false,"deprecated":false,"description":"ECMAScript JS AST traversal functions","devDependencies":{"babel-preset-env":"^1.6.1","babel-register":"^6.3.13","chai":"^2.1.1","espree":"^1.11.0","gulp":"^3.8.10","gulp-bump":"^0.2.2","gulp-filter":"^2.0.0","gulp-git":"^1.0.1","gulp-tag-version":"^1.3.0","jshint":"^2.5.6","mocha":"^2.1.0"},"engines":{"node":">=4.0"},"homepage":"https://github.com/estools/estraverse","license":"BSD-2-Clause","main":"estraverse.js","maintainers":[{"name":"Yusuke Suzuki","email":"utatane.tea@gmail.com","url":"http://github.com/Constellation"}],"name":"estraverse","repository":{"type":"git","url":"git+ssh://git@github.com/estools/estraverse.git"},"scripts":{"lint":"jshint estraverse.js","test":"npm run-script lint && npm run-script unit-test","unit-test":"mocha --compilers js:babel-register"},"version":"4.3.0"}')},"./node_modules/esutils/lib/ast.js":
/*!*****************************************!*\
  !*** ./node_modules/esutils/lib/ast.js ***!
  \*****************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){!function(){"use strict";function t(e){if(null==e)return!1;switch(e.type){case"BlockStatement":case"BreakStatement":case"ContinueStatement":case"DebuggerStatement":case"DoWhileStatement":case"EmptyStatement":case"ExpressionStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"ReturnStatement":case"SwitchStatement":case"ThrowStatement":case"TryStatement":case"VariableDeclaration":case"WhileStatement":case"WithStatement":return!0}return!1}function i(e){switch(e.type){case"IfStatement":return null!=e.alternate?e.alternate:e.consequent;case"LabeledStatement":case"ForStatement":case"ForInStatement":case"WhileStatement":case"WithStatement":return e.body}return null}e.exports={isExpression:function(e){if(null==e)return!1;switch(e.type){case"ArrayExpression":case"AssignmentExpression":case"BinaryExpression":case"CallExpression":case"ConditionalExpression":case"FunctionExpression":case"Identifier":case"Literal":case"LogicalExpression":case"MemberExpression":case"NewExpression":case"ObjectExpression":case"SequenceExpression":case"ThisExpression":case"UnaryExpression":case"UpdateExpression":return!0}return!1},isStatement:t,isIterationStatement:function(e){if(null==e)return!1;switch(e.type){case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"WhileStatement":return!0}return!1},isSourceElement:function(e){return t(e)||null!=e&&"FunctionDeclaration"===e.type},isProblematicIfStatement:function(e){var t;if("IfStatement"!==e.type)return!1;if(null==e.alternate)return!1;t=e.consequent;do{if("IfStatement"===t.type&&null==t.alternate)return!0;t=i(t)}while(t);return!1},trailingStatement:i}}()},"./node_modules/esutils/lib/code.js":
/*!******************************************!*\
  !*** ./node_modules/esutils/lib/code.js ***!
  \******************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){!function(){"use strict";var t,i,r,n,o,s;function a(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(Math.floor((e-65536)/1024)+55296)+String.fromCharCode((e-65536)%1024+56320)}for(i={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,NonAsciiIdentifierPart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/},t={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},r=[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279],n=new Array(128),s=0;s<128;++s)n[s]=s>=97&&s<=122||s>=65&&s<=90||36===s||95===s;for(o=new Array(128),s=0;s<128;++s)o[s]=s>=97&&s<=122||s>=65&&s<=90||s>=48&&s<=57||36===s||95===s;e.exports={isDecimalDigit:function(e){return 48<=e&&e<=57},isHexDigit:function(e){return 48<=e&&e<=57||97<=e&&e<=102||65<=e&&e<=70},isOctalDigit:function(e){return e>=48&&e<=55},isWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&r.indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},isIdentifierStartES5:function(e){return e<128?n[e]:i.NonAsciiIdentifierStart.test(a(e))},isIdentifierPartES5:function(e){return e<128?o[e]:i.NonAsciiIdentifierPart.test(a(e))},isIdentifierStartES6:function(e){return e<128?n[e]:t.NonAsciiIdentifierStart.test(a(e))},isIdentifierPartES6:function(e){return e<128?o[e]:t.NonAsciiIdentifierPart.test(a(e))}}}()},"./node_modules/esutils/lib/keyword.js":
/*!*********************************************!*\
  !*** ./node_modules/esutils/lib/keyword.js ***!
  \*********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){!function(){"use strict";var t=i(/*! ./code */"./node_modules/esutils/lib/code.js");function r(e,t){return!(!t&&"yield"===e)&&n(e,t)}function n(e,t){if(t&&function(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return!0;default:return!1}}(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}function o(e,t){return"null"===e||"true"===e||"false"===e||r(e,t)}function s(e,t){return"null"===e||"true"===e||"false"===e||n(e,t)}function a(e){var i,r,n;if(0===e.length)return!1;if(n=e.charCodeAt(0),!t.isIdentifierStartES5(n))return!1;for(i=1,r=e.length;i<r;++i)if(n=e.charCodeAt(i),!t.isIdentifierPartES5(n))return!1;return!0}function l(e){var i,r,n,o,s;if(0===e.length)return!1;for(s=t.isIdentifierStartES6,i=0,r=e.length;i<r;++i){if(55296<=(n=e.charCodeAt(i))&&n<=56319){if(++i>=r)return!1;if(!(56320<=(o=e.charCodeAt(i))&&o<=57343))return!1;n=1024*(n-55296)+(o-56320)+65536}if(!s(n))return!1;s=t.isIdentifierPartES6}return!0}e.exports={isKeywordES5:r,isKeywordES6:n,isReservedWordES5:o,isReservedWordES6:s,isRestrictedWord:function(e){return"eval"===e||"arguments"===e},isIdentifierNameES5:a,isIdentifierNameES6:l,isIdentifierES5:function(e,t){return a(e)&&!o(e,t)},isIdentifierES6:function(e,t){return l(e)&&!s(e,t)}}}()},"./node_modules/esutils/lib/utils.js":
/*!*******************************************!*\
  !*** ./node_modules/esutils/lib/utils.js ***!
  \*******************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){!function(){"use strict";t.ast=i(/*! ./ast */"./node_modules/esutils/lib/ast.js"),t.code=i(/*! ./code */"./node_modules/esutils/lib/code.js"),t.keyword=i(/*! ./keyword */"./node_modules/esutils/lib/keyword.js")}()},"./node_modules/source-map/lib/array-set.js":
/*!**************************************************!*\
  !*** ./node_modules/source-map/lib/array-set.js ***!
  \**************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./util */"./node_modules/source-map/lib/util.js"),n=Object.prototype.hasOwnProperty,o="undefined"!=typeof Map;function s(){this._array=[],this._set=o?new Map:Object.create(null)}s.fromArray=function(e,t){for(var i=new s,r=0,n=e.length;r<n;r++)i.add(e[r],t);return i},s.prototype.size=function(){return o?this._set.size:Object.getOwnPropertyNames(this._set).length},s.prototype.add=function(e,t){var i=o?e:r.toSetString(e),s=o?this.has(e):n.call(this._set,i),a=this._array.length;s&&!t||this._array.push(e),s||(o?this._set.set(e,a):this._set[i]=a)},s.prototype.has=function(e){if(o)return this._set.has(e);var t=r.toSetString(e);return n.call(this._set,t)},s.prototype.indexOf=function(e){if(o){var t=this._set.get(e);if(t>=0)return t}else{var i=r.toSetString(e);if(n.call(this._set,i))return this._set[i]}throw new Error('"'+e+'" is not in the set.')},s.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},s.prototype.toArray=function(){return this._array.slice()},t.ArraySet=s},"./node_modules/source-map/lib/base64-vlq.js":
/*!***************************************************!*\
  !*** ./node_modules/source-map/lib/base64-vlq.js ***!
  \***************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./base64 */"./node_modules/source-map/lib/base64.js");t.encode=function(e){var t,i="",n=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{t=31&n,(n>>>=5)>0&&(t|=32),i+=r.encode(t)}while(n>0);return i},t.decode=function(e,t,i){var n,o,s,a,l=e.length,u=0,c=0;do{if(t>=l)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(o=r.decode(e.charCodeAt(t++))))throw new Error("Invalid base64 digit: "+e.charAt(t-1));n=!!(32&o),u+=(o&=31)<<c,c+=5}while(n);i.value=(a=(s=u)>>1,1==(1&s)?-a:a),i.rest=t}},"./node_modules/source-map/lib/base64.js":
/*!***********************************************!*\
  !*** ./node_modules/source-map/lib/base64.js ***!
  \***********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");t.encode=function(e){if(0<=e&&e<i.length)return i[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){return 65<=e&&e<=90?e-65:97<=e&&e<=122?e-97+26:48<=e&&e<=57?e-48+52:43==e?62:47==e?63:-1}},"./node_modules/source-map/lib/binary-search.js":
/*!******************************************************!*\
  !*** ./node_modules/source-map/lib/binary-search.js ***!
  \******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2,t.search=function(e,i,r,n){if(0===i.length)return-1;var o=function e(i,r,n,o,s,a){var l=Math.floor((r-i)/2)+i,u=s(n,o[l],!0);return 0===u?l:u>0?r-l>1?e(l,r,n,o,s,a):a==t.LEAST_UPPER_BOUND?r<o.length?r:-1:l:l-i>1?e(i,l,n,o,s,a):a==t.LEAST_UPPER_BOUND?l:i<0?-1:i}(-1,i.length,e,i,r,n||t.GREATEST_LOWER_BOUND);if(o<0)return-1;for(;o-1>=0&&0===r(i[o],i[o-1],!0);)--o;return o}},"./node_modules/source-map/lib/mapping-list.js":
/*!*****************************************************!*\
  !*** ./node_modules/source-map/lib/mapping-list.js ***!
  \*****************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./util */"./node_modules/source-map/lib/util.js");function n(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}n.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},n.prototype.add=function(e){var t,i,n,o,s,a;i=e,n=(t=this._last).generatedLine,o=i.generatedLine,s=t.generatedColumn,a=i.generatedColumn,o>n||o==n&&a>=s||r.compareByGeneratedPositionsInflated(t,i)<=0?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))},n.prototype.toArray=function(){return this._sorted||(this._array.sort(r.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},t.MappingList=n},"./node_modules/source-map/lib/quick-sort.js":
/*!***************************************************!*\
  !*** ./node_modules/source-map/lib/quick-sort.js ***!
  \***************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){function i(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}t.quickSort=function(e,t){!function e(t,r,n,o){if(n<o){var s=n-1;i(t,(c=n,h=o,Math.round(c+Math.random()*(h-c))),o);for(var a=t[o],l=n;l<o;l++)r(t[l],a)<=0&&i(t,s+=1,l);i(t,s+1,l);var u=s+1;e(t,r,n,u-1),e(t,r,u+1,o)}var c,h}(e,t,0,e.length-1)}},"./node_modules/source-map/lib/source-map-consumer.js":
/*!************************************************************!*\
  !*** ./node_modules/source-map/lib/source-map-consumer.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./util */"./node_modules/source-map/lib/util.js"),n=i(/*! ./binary-search */"./node_modules/source-map/lib/binary-search.js"),o=i(/*! ./array-set */"./node_modules/source-map/lib/array-set.js").ArraySet,s=i(/*! ./base64-vlq */"./node_modules/source-map/lib/base64-vlq.js"),a=i(/*! ./quick-sort */"./node_modules/source-map/lib/quick-sort.js").quickSort;function l(e,t){var i=e;return"string"==typeof e&&(i=r.parseSourceMapInput(e)),null!=i.sections?new h(i,t):new u(i,t)}function u(e,t){var i=e;"string"==typeof e&&(i=r.parseSourceMapInput(e));var n=r.getArg(i,"version"),s=r.getArg(i,"sources"),a=r.getArg(i,"names",[]),l=r.getArg(i,"sourceRoot",null),u=r.getArg(i,"sourcesContent",null),c=r.getArg(i,"mappings"),h=r.getArg(i,"file",null);if(n!=this._version)throw new Error("Unsupported version: "+n);l&&(l=r.normalize(l)),s=s.map(String).map(r.normalize).map((function(e){return l&&r.isAbsolute(l)&&r.isAbsolute(e)?r.relative(l,e):e})),this._names=o.fromArray(a.map(String),!0),this._sources=o.fromArray(s,!0),this._absoluteSources=this._sources.toArray().map((function(e){return r.computeSourceURL(l,e,t)})),this.sourceRoot=l,this.sourcesContent=u,this._mappings=c,this._sourceMapURL=t,this.file=h}function c(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function h(e,t){var i=e;"string"==typeof e&&(i=r.parseSourceMapInput(e));var n=r.getArg(i,"version"),s=r.getArg(i,"sections");if(n!=this._version)throw new Error("Unsupported version: "+n);this._sources=new o,this._names=new o;var a={line:-1,column:0};this._sections=s.map((function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var i=r.getArg(e,"offset"),n=r.getArg(i,"line"),o=r.getArg(i,"column");if(n<a.line||n===a.line&&o<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=i,{generatedOffset:{generatedLine:n+1,generatedColumn:o+1},consumer:new l(r.getArg(e,"map"),t)}}))}l.fromSourceMap=function(e,t){return u.fromSourceMap(e,t)},l.prototype._version=3,l.prototype.__generatedMappings=null,Object.defineProperty(l.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),l.prototype.__originalMappings=null,Object.defineProperty(l.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),l.prototype._charIsMappingSeparator=function(e,t){var i=e.charAt(t);return";"===i||","===i},l.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},l.GENERATED_ORDER=1,l.ORIGINAL_ORDER=2,l.GREATEST_LOWER_BOUND=1,l.LEAST_UPPER_BOUND=2,l.prototype.eachMapping=function(e,t,i){var n,o=t||null;switch(i||l.GENERATED_ORDER){case l.GENERATED_ORDER:n=this._generatedMappings;break;case l.ORIGINAL_ORDER:n=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var s=this.sourceRoot;n.map((function(e){var t=null===e.source?null:this._sources.at(e.source);return{source:t=r.computeSourceURL(s,t,this._sourceMapURL),generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}}),this).forEach(e,o)},l.prototype.allGeneratedPositionsFor=function(e){var t=r.getArg(e,"line"),i={source:r.getArg(e,"source"),originalLine:t,originalColumn:r.getArg(e,"column",0)};if(i.source=this._findSourceIndex(i.source),i.source<0)return[];var o=[],s=this._findMapping(i,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,n.LEAST_UPPER_BOUND);if(s>=0){var a=this._originalMappings[s];if(void 0===e.column)for(var l=a.originalLine;a&&a.originalLine===l;)o.push({line:r.getArg(a,"generatedLine",null),column:r.getArg(a,"generatedColumn",null),lastColumn:r.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s];else for(var u=a.originalColumn;a&&a.originalLine===t&&a.originalColumn==u;)o.push({line:r.getArg(a,"generatedLine",null),column:r.getArg(a,"generatedColumn",null),lastColumn:r.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s]}return o},t.SourceMapConsumer=l,u.prototype=Object.create(l.prototype),u.prototype.consumer=l,u.prototype._findSourceIndex=function(e){var t,i=e;if(null!=this.sourceRoot&&(i=r.relative(this.sourceRoot,i)),this._sources.has(i))return this._sources.indexOf(i);for(t=0;t<this._absoluteSources.length;++t)if(this._absoluteSources[t]==e)return t;return-1},u.fromSourceMap=function(e,t){var i=Object.create(u.prototype),n=i._names=o.fromArray(e._names.toArray(),!0),s=i._sources=o.fromArray(e._sources.toArray(),!0);i.sourceRoot=e._sourceRoot,i.sourcesContent=e._generateSourcesContent(i._sources.toArray(),i.sourceRoot),i.file=e._file,i._sourceMapURL=t,i._absoluteSources=i._sources.toArray().map((function(e){return r.computeSourceURL(i.sourceRoot,e,t)}));for(var l=e._mappings.toArray().slice(),h=i.__generatedMappings=[],p=i.__originalMappings=[],d=0,f=l.length;d<f;d++){var m=l[d],g=new c;g.generatedLine=m.generatedLine,g.generatedColumn=m.generatedColumn,m.source&&(g.source=s.indexOf(m.source),g.originalLine=m.originalLine,g.originalColumn=m.originalColumn,m.name&&(g.name=n.indexOf(m.name)),p.push(g)),h.push(g)}return a(i.__originalMappings,r.compareByOriginalPositions),i},u.prototype._version=3,Object.defineProperty(u.prototype,"sources",{get:function(){return this._absoluteSources.slice()}}),u.prototype._parseMappings=function(e,t){for(var i,n,o,l,u,h=1,p=0,d=0,f=0,m=0,g=0,v=e.length,y=0,b={},_={},x=[],E=[];y<v;)if(";"===e.charAt(y))h++,y++,p=0;else if(","===e.charAt(y))y++;else{for((i=new c).generatedLine=h,l=y;l<v&&!this._charIsMappingSeparator(e,l);l++);if(o=b[n=e.slice(y,l)])y+=n.length;else{for(o=[];y<l;)s.decode(e,y,_),u=_.value,y=_.rest,o.push(u);if(2===o.length)throw new Error("Found a source, but no line and column");if(3===o.length)throw new Error("Found a source and line, but no column");b[n]=o}i.generatedColumn=p+o[0],p=i.generatedColumn,o.length>1&&(i.source=m+o[1],m+=o[1],i.originalLine=d+o[2],d=i.originalLine,i.originalLine+=1,i.originalColumn=f+o[3],f=i.originalColumn,o.length>4&&(i.name=g+o[4],g+=o[4])),E.push(i),"number"==typeof i.originalLine&&x.push(i)}a(E,r.compareByGeneratedPositionsDeflated),this.__generatedMappings=E,a(x,r.compareByOriginalPositions),this.__originalMappings=x},u.prototype._findMapping=function(e,t,i,r,o,s){if(e[i]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[i]);if(e[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[r]);return n.search(e,t,o,s)},u.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var i=this._generatedMappings[e+1];if(t.generatedLine===i.generatedLine){t.lastGeneratedColumn=i.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},u.prototype.originalPositionFor=function(e){var t={generatedLine:r.getArg(e,"line"),generatedColumn:r.getArg(e,"column")},i=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",r.compareByGeneratedPositionsDeflated,r.getArg(e,"bias",l.GREATEST_LOWER_BOUND));if(i>=0){var n=this._generatedMappings[i];if(n.generatedLine===t.generatedLine){var o=r.getArg(n,"source",null);null!==o&&(o=this._sources.at(o),o=r.computeSourceURL(this.sourceRoot,o,this._sourceMapURL));var s=r.getArg(n,"name",null);return null!==s&&(s=this._names.at(s)),{source:o,line:r.getArg(n,"originalLine",null),column:r.getArg(n,"originalColumn",null),name:s}}}return{source:null,line:null,column:null,name:null}},u.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some((function(e){return null==e}))},u.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;var i=this._findSourceIndex(e);if(i>=0)return this.sourcesContent[i];var n,o=e;if(null!=this.sourceRoot&&(o=r.relative(this.sourceRoot,o)),null!=this.sourceRoot&&(n=r.urlParse(this.sourceRoot))){var s=o.replace(/^file:\/\//,"");if("file"==n.scheme&&this._sources.has(s))return this.sourcesContent[this._sources.indexOf(s)];if((!n.path||"/"==n.path)&&this._sources.has("/"+o))return this.sourcesContent[this._sources.indexOf("/"+o)]}if(t)return null;throw new Error('"'+o+'" is not in the SourceMap.')},u.prototype.generatedPositionFor=function(e){var t=r.getArg(e,"source");if((t=this._findSourceIndex(t))<0)return{line:null,column:null,lastColumn:null};var i={source:t,originalLine:r.getArg(e,"line"),originalColumn:r.getArg(e,"column")},n=this._findMapping(i,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,r.getArg(e,"bias",l.GREATEST_LOWER_BOUND));if(n>=0){var o=this._originalMappings[n];if(o.source===i.source)return{line:r.getArg(o,"generatedLine",null),column:r.getArg(o,"generatedColumn",null),lastColumn:r.getArg(o,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},t.BasicSourceMapConsumer=u,h.prototype=Object.create(l.prototype),h.prototype.constructor=l,h.prototype._version=3,Object.defineProperty(h.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var i=0;i<this._sections[t].consumer.sources.length;i++)e.push(this._sections[t].consumer.sources[i]);return e}}),h.prototype.originalPositionFor=function(e){var t={generatedLine:r.getArg(e,"line"),generatedColumn:r.getArg(e,"column")},i=n.search(t,this._sections,(function(e,t){return e.generatedLine-t.generatedOffset.generatedLine||e.generatedColumn-t.generatedOffset.generatedColumn})),o=this._sections[i];return o?o.consumer.originalPositionFor({line:t.generatedLine-(o.generatedOffset.generatedLine-1),column:t.generatedColumn-(o.generatedOffset.generatedLine===t.generatedLine?o.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},h.prototype.hasContentsOfAllSources=function(){return this._sections.every((function(e){return e.consumer.hasContentsOfAllSources()}))},h.prototype.sourceContentFor=function(e,t){for(var i=0;i<this._sections.length;i++){var r=this._sections[i].consumer.sourceContentFor(e,!0);if(r)return r}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},h.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var i=this._sections[t];if(-1!==i.consumer._findSourceIndex(r.getArg(e,"source"))){var n=i.consumer.generatedPositionFor(e);if(n)return{line:n.line+(i.generatedOffset.generatedLine-1),column:n.column+(i.generatedOffset.generatedLine===n.line?i.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},h.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var i=0;i<this._sections.length;i++)for(var n=this._sections[i],o=n.consumer._generatedMappings,s=0;s<o.length;s++){var l=o[s],u=n.consumer._sources.at(l.source);u=r.computeSourceURL(n.consumer.sourceRoot,u,this._sourceMapURL),this._sources.add(u),u=this._sources.indexOf(u);var c=null;l.name&&(c=n.consumer._names.at(l.name),this._names.add(c),c=this._names.indexOf(c));var h={source:u,generatedLine:l.generatedLine+(n.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(n.generatedOffset.generatedLine===l.generatedLine?n.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:c};this.__generatedMappings.push(h),"number"==typeof h.originalLine&&this.__originalMappings.push(h)}a(this.__generatedMappings,r.compareByGeneratedPositionsDeflated),a(this.__originalMappings,r.compareByOriginalPositions)},t.IndexedSourceMapConsumer=h},"./node_modules/source-map/lib/source-map-generator.js":
/*!*************************************************************!*\
  !*** ./node_modules/source-map/lib/source-map-generator.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./base64-vlq */"./node_modules/source-map/lib/base64-vlq.js"),n=i(/*! ./util */"./node_modules/source-map/lib/util.js"),o=i(/*! ./array-set */"./node_modules/source-map/lib/array-set.js").ArraySet,s=i(/*! ./mapping-list */"./node_modules/source-map/lib/mapping-list.js").MappingList;function a(e){e||(e={}),this._file=n.getArg(e,"file",null),this._sourceRoot=n.getArg(e,"sourceRoot",null),this._skipValidation=n.getArg(e,"skipValidation",!1),this._sources=new o,this._names=new o,this._mappings=new s,this._sourcesContents=null}a.prototype._version=3,a.fromSourceMap=function(e){var t=e.sourceRoot,i=new a({file:e.file,sourceRoot:t});return e.eachMapping((function(e){var r={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(r.source=e.source,null!=t&&(r.source=n.relative(t,r.source)),r.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(r.name=e.name)),i.addMapping(r)})),e.sources.forEach((function(r){var o=r;null!==t&&(o=n.relative(t,r)),i._sources.has(o)||i._sources.add(o);var s=e.sourceContentFor(r);null!=s&&i.setSourceContent(r,s)})),i},a.prototype.addMapping=function(e){var t=n.getArg(e,"generated"),i=n.getArg(e,"original",null),r=n.getArg(e,"source",null),o=n.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,i,r,o),null!=r&&(r=String(r),this._sources.has(r)||this._sources.add(r)),null!=o&&(o=String(o),this._names.has(o)||this._names.add(o)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=i&&i.line,originalColumn:null!=i&&i.column,source:r,name:o})},a.prototype.setSourceContent=function(e,t){var i=e;null!=this._sourceRoot&&(i=n.relative(this._sourceRoot,i)),null!=t?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[n.toSetString(i)]=t):this._sourcesContents&&(delete this._sourcesContents[n.toSetString(i)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},a.prototype.applySourceMap=function(e,t,i){var r=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');r=e.file}var s=this._sourceRoot;null!=s&&(r=n.relative(s,r));var a=new o,l=new o;this._mappings.unsortedForEach((function(t){if(t.source===r&&null!=t.originalLine){var o=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=o.source&&(t.source=o.source,null!=i&&(t.source=n.join(i,t.source)),null!=s&&(t.source=n.relative(s,t.source)),t.originalLine=o.line,t.originalColumn=o.column,null!=o.name&&(t.name=o.name))}var u=t.source;null==u||a.has(u)||a.add(u);var c=t.name;null==c||l.has(c)||l.add(c)}),this),this._sources=a,this._names=l,e.sources.forEach((function(t){var r=e.sourceContentFor(t);null!=r&&(null!=i&&(t=n.join(i,t)),null!=s&&(t=n.relative(s,t)),this.setSourceContent(t,r))}),this)},a.prototype._validateMapping=function(e,t,i,r){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||i||r)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&i))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:i,original:t,name:r}))},a.prototype._serializeMappings=function(){for(var e,t,i,o,s=0,a=1,l=0,u=0,c=0,h=0,p="",d=this._mappings.toArray(),f=0,m=d.length;f<m;f++){if(e="",(t=d[f]).generatedLine!==a)for(s=0;t.generatedLine!==a;)e+=";",a++;else if(f>0){if(!n.compareByGeneratedPositionsInflated(t,d[f-1]))continue;e+=","}e+=r.encode(t.generatedColumn-s),s=t.generatedColumn,null!=t.source&&(o=this._sources.indexOf(t.source),e+=r.encode(o-h),h=o,e+=r.encode(t.originalLine-1-u),u=t.originalLine-1,e+=r.encode(t.originalColumn-l),l=t.originalColumn,null!=t.name&&(i=this._names.indexOf(t.name),e+=r.encode(i-c),c=i)),p+=e}return p},a.prototype._generateSourcesContent=function(e,t){return e.map((function(e){if(!this._sourcesContents)return null;null!=t&&(e=n.relative(t,e));var i=n.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null}),this)},a.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},a.prototype.toString=function(){return JSON.stringify(this.toJSON())},t.SourceMapGenerator=a},"./node_modules/source-map/lib/source-node.js":
/*!****************************************************!*\
  !*** ./node_modules/source-map/lib/source-node.js ***!
  \****************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! ./source-map-generator */"./node_modules/source-map/lib/source-map-generator.js").SourceMapGenerator,n=i(/*! ./util */"./node_modules/source-map/lib/util.js"),o=/(\r?\n)/,s="$$$isSourceNode$$$";function a(e,t,i,r,n){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==i?null:i,this.name=null==n?null:n,this[s]=!0,null!=r&&this.add(r)}a.fromStringWithSourceMap=function(e,t,i){var r=new a,s=e.split(o),l=0,u=function(){return e()+(e()||"");function e(){return l<s.length?s[l++]:void 0}},c=1,h=0,p=null;return t.eachMapping((function(e){if(null!==p){if(!(c<e.generatedLine)){var t=(i=s[l]||"").substr(0,e.generatedColumn-h);return s[l]=i.substr(e.generatedColumn-h),h=e.generatedColumn,d(p,t),void(p=e)}d(p,u()),c++,h=0}for(;c<e.generatedLine;)r.add(u()),c++;if(h<e.generatedColumn){var i=s[l]||"";r.add(i.substr(0,e.generatedColumn)),s[l]=i.substr(e.generatedColumn),h=e.generatedColumn}p=e}),this),l<s.length&&(p&&d(p,u()),r.add(s.splice(l).join(""))),t.sources.forEach((function(e){var o=t.sourceContentFor(e);null!=o&&(null!=i&&(e=n.join(i,e)),r.setSourceContent(e,o))})),r;function d(e,t){if(null===e||void 0===e.source)r.add(t);else{var o=i?n.join(i,e.source):e.source;r.add(new a(e.originalLine,e.originalColumn,o,t,e.name))}}},a.prototype.add=function(e){if(Array.isArray(e))e.forEach((function(e){this.add(e)}),this);else{if(!e[s]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},a.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[s]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},a.prototype.walk=function(e){for(var t,i=0,r=this.children.length;i<r;i++)(t=this.children[i])[s]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},a.prototype.join=function(e){var t,i,r=this.children.length;if(r>0){for(t=[],i=0;i<r-1;i++)t.push(this.children[i]),t.push(e);t.push(this.children[i]),this.children=t}return this},a.prototype.replaceRight=function(e,t){var i=this.children[this.children.length-1];return i[s]?i.replaceRight(e,t):"string"==typeof i?this.children[this.children.length-1]=i.replace(e,t):this.children.push("".replace(e,t)),this},a.prototype.setSourceContent=function(e,t){this.sourceContents[n.toSetString(e)]=t},a.prototype.walkSourceContents=function(e){for(var t=0,i=this.children.length;t<i;t++)this.children[t][s]&&this.children[t].walkSourceContents(e);var r=Object.keys(this.sourceContents);for(t=0,i=r.length;t<i;t++)e(n.fromSetString(r[t]),this.sourceContents[r[t]])},a.prototype.toString=function(){var e="";return this.walk((function(t){e+=t})),e},a.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},i=new r(e),n=!1,o=null,s=null,a=null,l=null;return this.walk((function(e,r){t.code+=e,null!==r.source&&null!==r.line&&null!==r.column?(o===r.source&&s===r.line&&a===r.column&&l===r.name||i.addMapping({source:r.source,original:{line:r.line,column:r.column},generated:{line:t.line,column:t.column},name:r.name}),o=r.source,s=r.line,a=r.column,l=r.name,n=!0):n&&(i.addMapping({generated:{line:t.line,column:t.column}}),o=null,n=!1);for(var u=0,c=e.length;u<c;u++)10===e.charCodeAt(u)?(t.line++,t.column=0,u+1===c?(o=null,n=!1):n&&i.addMapping({source:r.source,original:{line:r.line,column:r.column},generated:{line:t.line,column:t.column},name:r.name})):t.column++})),this.walkSourceContents((function(e,t){i.setSourceContent(e,t)})),{code:t.code,map:i}},t.SourceNode=a},"./node_modules/source-map/lib/util.js":
/*!*********************************************!*\
  !*** ./node_modules/source-map/lib/util.js ***!
  \*********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){t.getArg=function(e,t,i){if(t in e)return e[t];if(3===arguments.length)return i;throw new Error('"'+t+'" is a required argument.')};var i=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function n(e){var t=e.match(i);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function o(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function s(e){var i=e,r=n(e);if(r){if(!r.path)return e;i=r.path}for(var s,a=t.isAbsolute(i),l=i.split(/\/+/),u=0,c=l.length-1;c>=0;c--)"."===(s=l[c])?l.splice(c,1):".."===s?u++:u>0&&(""===s?(l.splice(c+1,u),u=0):(l.splice(c,2),u--));return""===(i=l.join("/"))&&(i=a?"/":"."),r?(r.path=i,o(r)):i}function a(e,t){""===e&&(e="."),""===t&&(t=".");var i=n(t),a=n(e);if(a&&(e=a.path||"/"),i&&!i.scheme)return a&&(i.scheme=a.scheme),o(i);if(i||t.match(r))return t;if(a&&!a.host&&!a.path)return a.host=t,o(a);var l="/"===t.charAt(0)?t:s(e.replace(/\/+$/,"")+"/"+t);return a?(a.path=l,o(a)):l}t.urlParse=n,t.urlGenerate=o,t.normalize=s,t.join=a,t.isAbsolute=function(e){return"/"===e.charAt(0)||i.test(e)},t.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var i=0;0!==t.indexOf(e+"/");){var r=e.lastIndexOf("/");if(r<0)return t;if((e=e.slice(0,r)).match(/^([^\/]+:\/)?\/*$/))return t;++i}return Array(i+1).join("../")+t.substr(e.length+1)};var l=!("__proto__"in Object.create(null));function u(e){return e}function c(e){if(!e)return!1;var t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var i=t-10;i>=0;i--)if(36!==e.charCodeAt(i))return!1;return!0}function h(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}t.toSetString=l?u:function(e){return c(e)?"$"+e:e},t.fromSetString=l?u:function(e){return c(e)?e.slice(1):e},t.compareByOriginalPositions=function(e,t,i){var r=h(e.source,t.source);return 0!==r||0!=(r=e.originalLine-t.originalLine)||0!=(r=e.originalColumn-t.originalColumn)||i||0!=(r=e.generatedColumn-t.generatedColumn)||0!=(r=e.generatedLine-t.generatedLine)?r:h(e.name,t.name)},t.compareByGeneratedPositionsDeflated=function(e,t,i){var r=e.generatedLine-t.generatedLine;return 0!==r||0!=(r=e.generatedColumn-t.generatedColumn)||i||0!==(r=h(e.source,t.source))||0!=(r=e.originalLine-t.originalLine)||0!=(r=e.originalColumn-t.originalColumn)?r:h(e.name,t.name)},t.compareByGeneratedPositionsInflated=function(e,t){var i=e.generatedLine-t.generatedLine;return 0!==i||0!=(i=e.generatedColumn-t.generatedColumn)||0!==(i=h(e.source,t.source))||0!=(i=e.originalLine-t.originalLine)||0!=(i=e.originalColumn-t.originalColumn)?i:h(e.name,t.name)},t.parseSourceMapInput=function(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))},t.computeSourceURL=function(e,t,i){if(t=t||"",e&&("/"!==e[e.length-1]&&"/"!==t[0]&&(e+="/"),t=e+t),i){var r=n(i);if(!r)throw new Error("sourceMapURL could not be parsed");if(r.path){var l=r.path.lastIndexOf("/");l>=0&&(r.path=r.path.substring(0,l+1))}t=a(o(r),t)}return s(t)}},"./node_modules/source-map/source-map.js":
/*!***********************************************!*\
  !*** ./node_modules/source-map/source-map.js ***!
  \***********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){t.SourceMapGenerator=i(/*! ./lib/source-map-generator */"./node_modules/source-map/lib/source-map-generator.js").SourceMapGenerator,t.SourceMapConsumer=i(/*! ./lib/source-map-consumer */"./node_modules/source-map/lib/source-map-consumer.js").SourceMapConsumer,t.SourceNode=i(/*! ./lib/source-node */"./node_modules/source-map/lib/source-node.js").SourceNode},"./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},"./src/eval/index.js":
/*!***************************!*\
  !*** ./src/eval/index.js ***!
  \***************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r=i(/*! escodegen */"./node_modules/escodegen/escodegen.js").generate;e.exports=function(e,t){t||(t={});var i={},n=function e(n,o){if("Literal"===n.type)return n.value;if("UnaryExpression"===n.type){var s=e(n.argument);return"+"===n.operator?+s:"-"===n.operator?-s:"~"===n.operator?~s:"!"===n.operator?!s:i}if("ArrayExpression"===n.type){for(var a=[],l=0,u=n.elements.length;l<u;l++){if((v=e(n.elements[l]))===i)return i;a.push(v)}return a}if("ObjectExpression"===n.type){var c={};for(l=0;l<n.properties.length;l++){var h=null===(y=n.properties[l]).value?y.value:e(y.value);if(h===i)return i;c[y.key.value||y.key.name]=h}return c}if("BinaryExpression"===n.type||"LogicalExpression"===n.type){if((u=e(n.left))===i)return i;var p=e(n.right);if(p===i)return i;var d=n.operator;return"=="===d?u==p:"==="===d?u===p:"!="===d?u!=p:"!=="===d?u!==p:"+"===d?u+p:"-"===d?u-p:"*"===d?u*p:"/"===d?u/p:"%"===d?u%p:"<"===d?u<p:"<="===d?u<=p:">"===d?u>p:">="===d?u>=p:"|"===d?u|p:"&"===d?u&p:"^"===d?u^p:"&&"===d?u&&p:"||"===d?u||p:i}if("Identifier"===n.type)return{}.hasOwnProperty.call(t,n.name)?t[n.name]:i;if("ThisExpression"===n.type)return{}.hasOwnProperty.call(t,"this")?t.this:i;if("CallExpression"===n.type){var f=e(n.callee);if(f===i)return i;if("function"!=typeof f)return i;var m=n.callee.object?e(n.callee.object):i;m===i&&(m=null);var g=[];for(l=0,u=n.arguments.length;l<u;l++){var v;if((v=e(n.arguments[l]))===i)return i;g.push(v)}return f.apply(m,g)}var y;if("MemberExpression"===n.type)return(c=e(n.object))===i||"function"==typeof c?i:"Identifier"===n.property.type?c[n.property.name]:(y=e(n.property))===i?i:c[y];if("ConditionalExpression"===n.type)return(s=e(n.test))===i?i:e(s?n.consequent:n.alternate);if("ExpressionStatement"===n.type)return(s=e(n.expression))===i?i:s;if("ReturnStatement"===n.type)return e(n.argument);if("FunctionExpression"===n.type){var b=n.body.body,_={};for(Object.keys(t).forEach((function(e){_[e]=t[e]})),l=0;l<n.params.length;l++){var x=n.params[l];if("Identifier"!=x.type)return i;t[x.name]=null}for(var l in b)if(e(b[l])===i)return i;t=_;var E=Object.keys(t),w=E.map((function(e){return t[e]}));return Function(E.join(", "),"return "+r(n)).apply(null,w)}if("TemplateLiteral"===n.type){var T="";for(l=0;l<n.expressions.length;l++)T+=e(n.quasis[l]),T+=e(n.expressions[l]);return T+e(n.quasis[l])}if("TaggedTemplateExpression"===n.type){var M=e(n.tag),C=n.quasi,S=C.quasis.map(e),j=C.expressions.map(e);return M.apply(null,[S].concat(j))}return"TemplateElement"===n.type?n.value.cooked:i}(e);return n===i?void 0:n}},"./src/main.js":
/*!*********************************!*\
  !*** ./src/main.js + 1 modules ***!
  \*********************************/
/*! no exports provided */
/*! all exports used */function(e,t,i){"use strict";i.r(t);var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i(/*! ./ */"./src/eval/index.js"),o=i(/*! esprima */"./node_modules/esprima/dist/esprima.js").parse,s=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.expression=o(t).body[0].expression,this}return r(e,[{key:"evaluate",value:function(e){return e=e||{},n(this.expression,e)}}]),e}();window.THING=window.THING||{},window.THING.Plugins=window.THING.Plugins||{},window.THING.Plugins.EVAL={Eval:s}},0:
/*!***************************!*\
  !*** multi ./src/main.js ***!
  \***************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){e.exports=i(/*! ./src/main.js */"./src/main.js")}}),function(){"use strict";var e="undefined"!=typeof require,t=this.THREE||e&&require("three");if(!t)throw new Error("MeshLine requires three.js");var i=i||t;function r(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new t.BufferGeometry,this.widthCallback=null}function n(e,t,i,r,n){var o;if(e=e.subarray||e.slice?e:e.buffer,i=i.subarray||i.slice?i:i.buffer,e=t?e.subarray?e.subarray(t,n&&t+n):e.slice(t,n&&t+n):e,i.set)i.set(e,r);else for(o=0;o<e.length;o++)i[o+r]=e[o];return i}function o(e){function i(e,t){return void 0===e?t:e}t.Material.call(this),e=e||{},this.lineWidth=i(e.lineWidth,1),this.map=i(e.map,null),this.useMap=i(e.useMap,0),this.alphaMap=i(e.alphaMap,null),this.useAlphaMap=i(e.useAlphaMap,0),this.color=i(e.color,new t.Color(16777215)),this.opacity=i(e.opacity,1),this.resolution=i(e.resolution,new t.Vector2(1,1)),this.sizeAttenuation=i(e.sizeAttenuation,1),this.near=i(e.near,1),this.far=i(e.far,1),this.logDepthBufFC=i(e.logDepthBufFC,1),this.dashArray=i(e.dashArray,[]),this.useDash=this.dashArray!==[]?1:0,this.visibility=i(e.visibility,1),this.alphaTest=i(e.alphaTest,0);var r=new t.ShaderMaterial({uniforms:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new t.Color(16777215)},fogAlpha:{value:1},lineWidth:{type:"f",value:this.lineWidth},map:{type:"t",value:this.map},useMap:{type:"f",value:this.useMap},alphaMap:{type:"t",value:this.alphaMap},useAlphaMap:{type:"f",value:this.useAlphaMap},color:{type:"c",value:this.color},opacity:{type:"f",value:this.opacity},resolution:{type:"v2",value:this.resolution},sizeAttenuation:{type:"f",value:this.sizeAttenuation},near:{type:"f",value:this.near},far:{type:"f",value:this.far},dashArray:{type:"v2",value:new t.Vector2(this.dashArray[0],this.dashArray[1])},useDash:{type:"f",value:this.useDash},visibility:{type:"f",value:this.visibility},alphaTest:{type:"f",value:this.alphaTest},logDepthBufFC:{type:"f",value:this.logDepthBufFC},uvTransform:{type:"m3",value:this.map?this.map.matrix:new t.Matrix3},uv2Transform:{type:"m3",value:this.alphaMap?this.alphaMap.matrix:new t.Matrix3}},vertexShader:["precision highp float;","","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","#include <logdepthbuf_pars_vertex>","#include <fog_pars_vertex>","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","uniform mat3 uvTransform;","uniform mat3 uv2Transform;","#ifdef USE_GPUPICKER","uniform float baseId;","varying vec4 worldId;","#endif","","varying vec2 vUV;","varying vec2 vUV2;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","#define EPSILON 1e-6","","void main() {","","    float aspect = resolution.x / resolution.y;","\t float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color, opacity );","    //vUV = uv;","    vUV = ( uvTransform * vec3( uv, 1 ) ).xy;","    vUV2 = ( uv2Transform * vec3( uv, 1 ) ).xy;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","\t float pixelWidth = finalPosition.w * pixelWidthRatio;","    float w = 1.8 * pixelWidth * lineWidth * width;","","    if( sizeAttenuation == 1. ) {","        w = lineWidth * width * finalPosition.w * 2. / resolution.x;","    }","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","        w = w / max(dot( miter, perp ), 0.2);","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec2 normal = vec2( -dir.y, dir.x );","    if( sizeAttenuation == 1. ) {","    \tnormal.y *= aspect;","    } else {","    \tnormal.x /= aspect;","    }","    normal *= .5 * w;","","    vec4 offset = vec4( normal * side, 0.0, 1.0 );","    finalPosition.xy += offset.xy;","","#ifdef USE_GPUPICKER","vec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);","a -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);","worldId = vec4(a,1);","#endif","","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#include <fog_vertex>","    gl_Position = finalPosition;","    #include <logdepthbuf_vertex>","","}"].join("\r\n"),fragmentShader:["precision mediump float;","","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform vec2 dashArray;","uniform float visibility;","uniform float alphaTest;","","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","","varying vec2 vUV;","varying vec2 vUV2;","varying vec4 vColor;","varying float vCounters;","#ifdef USE_GPUPICKER","varying vec4 worldId;","#endif","#include <common>","","void main() {","","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV2 ).a;","\t if( c.a < alphaTest ) discard;","\t if( useDash == 1. ){","\t \t ","\t }","    gl_FragColor = c;","#include <logdepthbuf_fragment>","\t gl_FragColor.a *= step(vCounters,visibility);","#include <fog_fragment>","\t #ifdef USE_GPUPICKER","\t \tgl_FragColor = worldId;","\t #endif","}"].join("\r\n"),defines:{USE_GPUPICKER:!1,USE_LOGDEPTHBUF:!1,USE_LOGDEPTHBUF_EXT:!1},fog:!0});return delete e.lineWidth,delete e.map,delete e.useMap,delete e.alphaMap,delete e.useAlphaMap,delete e.color,delete e.opacity,delete e.resolution,delete e.sizeAttenuation,delete e.near,delete e.far,delete e.dashArray,delete e.visibility,delete e.alphaTest,delete e.repeat,r.type="MeshLineMaterial",r.setValues(e),r}r.prototype.setGeometry=function(e,i,r){if(this.widthCallback=i,this.positions=[],this.counters=[],e instanceof t.Geometry)for(var n=0;n<e.vertices.length;n++){var o=e.vertices[n];i=n/e.vertices.length;this.positions.push(o.x,o.y,o.z),this.positions.push(o.x,o.y,o.z),this.counters.push(i),this.counters.push(i)}if(t.BufferGeometry,e instanceof Float32Array||e instanceof Array)for(n=0;n<e.length;n+=3){i=n/e.length;this.positions.push(e[n],e[n+1],e[n+2]),this.positions.push(e[n],e[n+1],e[n+2]),this.counters.push(i),this.counters.push(i)}this.process(r)},r.prototype.compareV3=function(e,t){var i=6*e,r=6*t;return this.positions[i]===this.positions[r]&&this.positions[i+1]===this.positions[r+1]&&this.positions[i+2]===this.positions[r+2]},r.prototype.copyV3=function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},r.prototype.process=function(e){var i,r,n=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(var o=0;o<n;o++)this.side.push(1),this.side.push(-1);for(o=0;o<n;o++)i=this.widthCallback?this.widthCallback(o/(n-1)):1,this.width.push(i),this.width.push(i);if(e){var s,a,l,u,c=0,h=[];for(o=0;o<n;o++)0===o?u=0:(s=this.positions[6*o]-this.positions[6*o-6],a=this.positions[6*o+1]-this.positions[6*o-6+1],l=this.positions[6*o+2]-this.positions[6*o-6+2],u=Math.sqrt(s*s+a*a+l*l)),c+=u,h.push(c);for(o=0;o<n;o++)this.uvs.push(h[o]/e,0),this.uvs.push(h[o]/e,1)}else for(o=0;o<n;o++)this.uvs.push(o/(n-1),0),this.uvs.push(o/(n-1),1);r=this.compareV3(0,n-1)?this.copyV3(n-2):this.copyV3(0),this.previous.push(r[0],r[1],r[2]),this.previous.push(r[0],r[1],r[2]);for(o=0;o<n-1;o++)r=this.copyV3(o),this.previous.push(r[0],r[1],r[2]),this.previous.push(r[0],r[1],r[2]);for(o=1;o<n;o++)r=this.copyV3(o),this.next.push(r[0],r[1],r[2]),this.next.push(r[0],r[1],r[2]);r=this.compareV3(n-1,0)?this.copyV3(1):this.copyV3(n-1),this.next.push(r[0],r[1],r[2]),this.next.push(r[0],r[1],r[2]);for(o=0;o<n-1;o++){var p=2*o;this.indices_array.push(p,p+1,p+2),this.indices_array.push(p+2,p+1,p+3)}this.attributes?(this.attributes.position.copyArray(new Float32Array(this.positions)),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(new Float32Array(this.previous)),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(new Float32Array(this.next)),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(new Float32Array(this.side)),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(new Float32Array(this.width)),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(new Float32Array(this.uvs)),this.attributes.uv.needsUpdate=!0,this.attributes.index.copyArray(new Uint16Array(this.indices_array)),this.attributes.index.needsUpdate=!0):this.attributes={position:new t.BufferAttribute(new Float32Array(this.positions),3),previous:new t.BufferAttribute(new Float32Array(this.previous),3),next:new t.BufferAttribute(new Float32Array(this.next),3),side:new t.BufferAttribute(new Float32Array(this.side),1),width:new t.BufferAttribute(new Float32Array(this.width),1),uv:new t.BufferAttribute(new Float32Array(this.uvs),2),index:new t.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new t.BufferAttribute(new Float32Array(this.counters),1)},this.geometry.addAttribute("position",this.attributes.position),this.geometry.addAttribute("previous",this.attributes.previous),this.geometry.addAttribute("next",this.attributes.next),this.geometry.addAttribute("side",this.attributes.side),this.geometry.addAttribute("width",this.attributes.width),this.geometry.addAttribute("uv",this.attributes.uv),this.geometry.addAttribute("counters",this.attributes.counters),this.geometry.setIndex(this.attributes.index)},r.prototype.advance=function(e){var t=this.attributes.position.array,i=this.attributes.previous.array,r=this.attributes.next.array,o=t.length;n(t,0,i,0,o),n(t,6,t,0,o-6),t[o-6]=e.x,t[o-5]=e.y,t[o-4]=e.z,t[o-3]=e.x,t[o-2]=e.y,t[o-1]=e.z,n(t,6,r,0,o-6),r[o-6]=e.x,r[o-5]=e.y,r[o-4]=e.z,r[o-3]=e.x,r[o-2]=e.y,r[o-1]=e.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0},o.prototype=Object.create(t.Material.prototype),o.prototype.constructor=o,o.prototype.copy=function(e){return t.Material.prototype.copy.call(this,e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.near=e.near,this.far=e.far,this.logDepthBufFC=e.logDepthBufFC,this.dashArray.copy(e.dashArray),this.useDash=e.useDash,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this},void 0!==i?("undefined"!=typeof module&&module.exports&&(i=module.exports={MeshLine:r,MeshLineMaterial:o}),i.MeshLine=r,i.MeshLineMaterial=o):(this.MeshLine=r,this.MeshLineMaterial=o)}.call(this),TrailRenderHelper=function(){var e="[TrailRenderHelper.js] : ";this.fTimeLong=0,this.fTimeStart=0,this.iStep=0,this.iCount=0,this.fWidthStart=.5,this.fWidthEnd=.5,this.fWidthOffset=0,this.arrayPosHistory=new Array,this.shaderColor=null,this.shaderTexture=null,this.shaderTexMode=null,this.blending=null,this.transparent=null,this.alphaTest=null,this.depthWrite=null,this.depthTest=null,this.arrayUuid=new Array,this.arrayCfg=new Array,this.bAllStable=!1,this.bStable=!1,this.iMaxArrayPosHistoryNo=0,this.iMaxArrayPosHistoryNo_last=0,this.iCurrentIndex=0,this.iSumArrayPosHistoryCount=0,this.instanceBuffer=null,this.bufferGeometry=null,this.attributesVertices=null,this.material=null,this.mesh=null,this.vertices=null,this.indices=null,this.uvs=null,this.onTriggerMeshInited=null;var t=this,i={vertex:["precision highp float;","uniform sampler2D texture;","uniform vec4 color;","varying vec2 vUv;","varying vec4 varyColor;","void main()","{","\tvaryColor = color;","   vUv = vec2( uv.x, uv.y );","\tvec3 positionEye = ( modelViewMatrix * vec4( position, 1.0 ) ).xyz;","\tgl_Position = projectionMatrix * vec4( positionEye, 1.0 );","}"].join("\n"),fragment:["precision highp float;","uniform sampler2D texture;","varying vec2 vUv;","varying vec4 varyColor;","void main() {","    gl_FragColor = varyColor * texture2D(texture, vUv);","}"].join("\n")};this.init=function(r,n){if(null!=n&&null!=n){if(null==r||null==r||"object"!=typeof r)return console.error(e+"[init] : options == null;"),void n();if(null==r.fTimeLong||null==r.fTimeLong||"number"!=typeof r.fTimeLong)return console.error(e+"[init] : options.fTimeLong == null;"),void n();if(null==r.fTimeStart||null==r.fTimeStart||"number"!=typeof r.fTimeStart)return console.error(e+"[init] : options.fTimeStart == null;"),void n();if(null==r.iStep||null==r.iStep||"number"!=typeof r.iStep)return console.error(e+"[init] : options.iStep == null;"),void n();if(null==r.fWidthStart||null==r.fWidthStart||"number"!=typeof r.fWidthStart)return console.error(e+"[init] : options.fWidthStart == null;"),void n();if(null==r.fWidthEnd||null==r.fWidthEnd||"number"!=typeof r.fWidthEnd)return console.error(e+"[init] : options.fWidthStart == null;"),void n();null!=r.shaderColor&&null!=r.shaderColor&&r.shaderColor instanceof THREE.Vector4?t.shaderColor=new THREE.Vector4(r.shaderColor.x,r.shaderColor.y,r.shaderColor.z,r.shaderColor.w):(console.warn(e+"[init] : options.shaderColor == null; set shader color as default;"),t.shaderColor=new THREE.Vector4(.5,.5,1,1)),null!=r.shaderTexture&&null!=r.shaderTexture&&r.shaderTexture instanceof THREE.Texture?t.shaderTexture=r.shaderTexture:(console.warn(e+"[init] : options.shaderColor == null; set shader texture as default;"),t.shaderTexture=null),null==r.shaderTexMode||null==r.shaderTexMode||"string"!=typeof r.shaderTexMode?(console.warn(e+"[init] : options.shaderTexMode == null; set shader mode as default;"),t.shaderTexMode="Stretch"):t.shaderTexMode="Stretch"==r.shaderTexMode?"Stretch":"Tile",null==r.shaderBlending||null==r.shaderBlending||"number"!=typeof r.shaderBlending?(console.warn(e+"[init] : options.shaderBlending == null; set shader blending as default;"),t.blending=THREE.AdditiveBlending):t.blending=r.shaderBlending,null==r.shaderTransparent||null==r.shaderTransparent||"boolean"!=typeof r.shaderTransparent?(console.warn(e+"[init] : options.shaderTransparent == null; set shader transparent as default;"),t.transparent=!1):t.transparent=r.shaderTransparent,null==r.shaderAlphaTest||null==r.shaderAlphaTest||"number"!=typeof r.shaderAlphaTest?(console.warn(e+"[init] : options.shaderAlphaTest == null; set shader alphaTest as default;"),t.alphaTest=0):t.alphaTest=r.shaderAlphaTest,null==r.shaderDepthWrite||null==r.shaderDepthWrite||"boolean"!=typeof r.shaderDepthWrite?(console.warn(e+"[init] : options.shaderDepthWrite == null; set shader depthWrite as default;"),t.depthWrite=!0):t.depthWrite=r.shaderDepthWrite,null==r.shaderDepthTest||null==r.shaderDepthTest||"boolean"!=typeof r.shaderDepthTest?(console.warn(e+"[init] : options.shaderDepthTest == null; set shader depthTest as default;"),t.depthTest=!0):t.depthTest=r.shaderDepthTest,t.uniforms={texture:{type:"t",value:t.shaderTexture},color:{type:"v4",value:new THREE.Vector4(0,0,0,0)}},t.material=new THREE.ShaderMaterial({uniforms:t.uniforms,vertexShader:i.vertex,fragmentShader:i.fragment,blending:t.blending,transparent:t.transparent,alphaTest:t.alphaTest,depthWrite:t.depthWrite,depthTest:t.depthTest}),t.fTimeLong=r.fTimeLong,t.fTimeStart=r.fTimeStart,t.iStep=r.iStep,t.iCount=0,t.fWidthStart=r.fWidthStart,t.fWidthEnd=r.fWidthEnd,t.fWidthOffset=-t.fWidthStart+t.fWidthEnd,n()}else console.error(e+"[init] : onFinished == null;")},this.attach=function(i){if(null==i||null==i)return console.error(e+"[attach] : onFinished == null;"),null;var r=THREE.Math.generateUUID();t.arrayPosHistory[r]=new Array;return t.arrayCfg[r]={bActived:!0,bStable:!1,iMaxArrayPosHistoryNo_last:0,iMaxArrayPosHistoryNo:0,iStartIndex:0},t.arrayUuid.push(r),i(r),r},this.detach=function(i){null!=i&&null!=i&&"string"==typeof i?(t.arrayUuid.includes(i)&&delete t.arrayUuid[i],t.arrayCfg.includes(i)&&(t.iCurrentIndex-=t.arrayCfg[i].iMaxArrayPosHistoryNo,delete t.arrayCfg[i]),t.arrayPosHistory.includes(i)&&delete t.arrayPosHistory[i]):console.error(e+"[detach] : uuid == null;")},this.dispose=function(){t.instanceBuffer&&t.instanceBuffer.dispose(),t.bufferGeometry&&t.bufferGeometry.dispose(),GlobalsVariables.scene.remove(t.mesh),t.material.dispose(),t.arrayUuid.forEach((function(e){})),t.arrayCfg.forEach((function(e){})),t.arrayPosHistory.forEach((function(e){})),t.arrayUuid=[],t.arrayCfg=[],t.arrayPosHistory=[]},this.setActive=function(i,r,n){if(null!=n&&null!=n){if(null==i||null==i||"string"!=typeof i)return console.error(e+"[setActive] : uuid == null;"),void n(!1);if(!t.arrayUuid.includes(i))return console.error(e+"[setActive] : uuid do not includes;"),void n(!1);if(null==r||null==r||"boolean"!=typeof r)return console.error(e+"[setActive] : bActived == null;"),void n(!1);t.arrayCfg[i].bActived=r,n(!0)}else console.error(e+"[setActive] : onFinished == null;")},this.tick=function(e){if(t.bAllStable)for(var i=t.arrayUuid.length,r=0;r<i;r++)t.arrayCfg[t.arrayUuid[r]].bActived&&t.updateMesh(t.arrayUuid[r]);if(t.arrayCfg[e.uuid].bActived&&(t.arrayPosHistory[e.uuid].push({time:e.timeNow,pos:new THREE.Vector3(e.position.x,e.position.y,e.position.z),rot:new THREE.Vector3(e.rotation.x,e.rotation.y,e.rotation.z)}),t.checkPosHistory(e.uuid,e.timeNow)),!t.bAllStable&&!t.arrayCfg[e.uuid].bStable){i=t.arrayPosHistory[e.uuid].length;t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo<=i&&(t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo_last=t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo,t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo=i,t.arrayCfg[e.uuid].bStable||t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo_last!=t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo||(t.arrayCfg[e.uuid].bStable=!0,t.checkAllPosHistory()))}},this.checkPosHistory=function(e,i){for(var r=t.arrayPosHistory[e].length,n=0;n<r&&i-t.arrayPosHistory[e][n].time>t.fTimeLong;n++)t.arrayPosHistory[e].splice(n,1),r=t.arrayPosHistory[e].length,n--},this.checkAllPosHistory=function(){var e=t.arrayUuid.length,i=!0;t.iSumArrayPosHistoryCount=0;for(var r=0;r<e;r++){if(!t.arrayCfg[t.arrayUuid[r]].bStable)return void(i=!1);t.iSumArrayPosHistoryCount+=t.arrayCfg[t.arrayUuid[r]].iMaxArrayPosHistoryNo}if(i){t.bAllStable=!0;for(r=0;r<e;r++)0==r?1==e?t.initMesh(t.arrayUuid[r],"start|end"):t.initMesh(t.arrayUuid[r],"start"):r+1==e?t.initMesh(t.arrayUuid[r],"end"):t.initMesh(t.arrayUuid[r],"default")}},this.initMesh=function(e,i){if(null!=t.mesh&&GlobalsVariables.scene.remove(t.mesh),null==t.bufferGeometry&&(t.bufferGeometry=new THREE.BufferGeometry),t.arrayCfg[e].iStartIndex=t.iCurrentIndex,i.indexOf("start")>=0){var r=2*t.iSumArrayPosHistoryCount;t.iSumArrayPosHistoryCount;t.vertices=new Float32Array(3*r),t.indices=new Uint32Array(2*(t.iSumArrayPosHistoryCount-t.arrayCfg.length)*2*3),t.uvs=new Float32Array(2*r)}for(var n=new THREE.Quaternion,o=t.arrayCfg[e].iStartIndex,s=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;o<s;o++){var a=t.fWidthEnd+(o-t.arrayCfg[e].iStartIndex)/t.arrayCfg[e].iMaxArrayPosHistoryNo*t.fWidthOffset,l=t.arrayPosHistory[e][o-t.arrayCfg[e].iStartIndex].pos.clone(),u=l.clone(),c=t.arrayPosHistory[e][o-t.arrayCfg[e].iStartIndex].rot.clone();c=c.normalize(),n.setFromEuler(new THREE.Euler(c.x,c.y,c.z));var h=new THREE.Vector3(a,0,0);h.applyQuaternion(n);var p=s-1-o,d=l.add(h);t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+0]=d.x,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+1]=d.y,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+2]=d.z;var f=u.sub(h);t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+3]=f.x,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+4]=f.y,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+5]=f.z}var m=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo-1;for(o=t.arrayCfg[e].iStartIndex;o<m;o++)t.indices[12*o+0]=2*o+0,t.indices[12*o+1]=2*o+1,t.indices[12*o+2]=2*o+2,t.indices[12*o+3]=2*o+2,t.indices[12*o+4]=2*o+1,t.indices[12*o+5]=2*o+3,t.indices[12*o+6]=2*o+0,t.indices[12*o+7]=2*o+2,t.indices[12*o+8]=2*o+1,t.indices[12*o+9]=2*o+2,t.indices[12*o+10]=2*o+3,t.indices[12*o+11]=2*o+1;var g=1/t.arrayCfg[e].iMaxArrayPosHistoryNo;if("Stretch"==t.shaderTexMode)for(o=t.arrayCfg[e].iStartIndex,s=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;o<s;o++)t.uvs[4*o+0]=(o-t.arrayCfg[e].iStartIndex)*g,t.uvs[4*o+1]=0,t.uvs[4*o+2]=(o-t.arrayCfg[e].iStartIndex)*g,t.uvs[4*o+3]=1;else for(o=t.arrayCfg[e].iStartIndex,s=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;o<s;o++)t.uvs[4*o+0]=(o-t.arrayCfg[e].iStartIndex)%2,t.uvs[4*o+1]=0,t.uvs[4*o+2]=(o-t.arrayCfg[e].iStartIndex)%2,t.uvs[4*o+3]=1;t.iCurrentIndex+=t.arrayCfg[e].iMaxArrayPosHistoryNo,i.indexOf("end")>=0&&(t.bufferGeometry.addAttribute("position",new THREE.BufferAttribute(t.vertices,3)),t.attributesVertices=this.bufferGeometry.attributes.position.array,t.bufferGeometry.addAttribute("uv",new THREE.BufferAttribute(t.uvs,2)),t.bufferGeometry.setIndex(new THREE.BufferAttribute(t.indices,1)),t.mesh=new THREE.Mesh(t.bufferGeometry,t.material),GlobalsVariables.scene.add(t.mesh),null!=t.onTriggerMeshInited&&null!=t.onTriggerMeshInited&&t.onTriggerMeshInited(t.mesh))},this.updateColor=function(e){null!=t.material&&null!=t.material&&(t.material.uniforms.color.value.x=e.r,t.material.uniforms.color.value.y=e.g,t.material.uniforms.color.value.z=e.b,t.material.uniforms.color.value.w=e.a,t.material.needsUpdate=!0)},this.updateMesh=function(e){for(var i=t.arrayPosHistory[e].length,r=new THREE.Quaternion,n=t.arrayCfg[e].iStartIndex,o=t.arrayCfg[e].iStartIndex+i;n<o;n++){var s=t.fWidthEnd+(n-t.arrayCfg[e].iStartIndex)/i*t.fWidthOffset,a=(h=t.arrayPosHistory[e][n-t.arrayCfg[e].iStartIndex].pos.clone()).clone();p=(p=t.arrayPosHistory[e][n-t.arrayCfg[e].iStartIndex].rot.clone()).normalize(),r.setFromEuler(new THREE.Euler(p.x,p.y,p.z)),(d=new THREE.Vector3(s,0,0)).applyQuaternion(r);var l=o-1-n;l=6*(t.arrayCfg[e].iStartIndex+l);var u=h.add(d);t.attributesVertices[l+0]=u.x,t.attributesVertices[l+1]=u.y,t.attributesVertices[l+2]=u.z;var c=a.sub(d);t.attributesVertices[l+3]=c.x,t.attributesVertices[l+4]=c.y,t.attributesVertices[l+5]=c.z}if(i<t.arrayCfg[e].iMaxArrayPosHistoryNo)for(n=t.arrayCfg[e].iStartIndex+i,o=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;n<o;n++){var h,p,d;a=(h=t.arrayPosHistory[e][i-1].pos.clone()).clone();p=(p=t.arrayPosHistory[e][i-1].rot.clone()).normalize(),r.setFromEuler(new THREE.Euler(p.x,p.y,p.z)),(d=new THREE.Vector3(0,0,0)).applyQuaternion(r);l=6*(t.arrayCfg[e].iStartIndex+n),u=h.add(d);t.attributesVertices[l+0]=u.x,t.attributesVertices[l+1]=u.y,t.attributesVertices[l+2]=u.z;c=a.sub(d);t.attributesVertices[l+3]=c.x,t.attributesVertices[l+4]=c.y,t.attributesVertices[l+5]=c.z}t.bufferGeometry.attributes.position.needsUpdate=!0}},function(){"use strict";function e(e,t){t=t||1/0;for(var i,r=e.length,n=null,o=[],s=0;s<r;s++){if(55295<(i=e.charCodeAt(s))&&57344>i){if(!n){if(56319<i){-1<(t-=3)&&o.push(239,191,189);continue}if(s+1===r){-1<(t-=3)&&o.push(239,191,189);continue}n=i;continue}if(56320>i){-1<(t-=3)&&o.push(239,191,189),n=i;continue}i=n-55296<<10|i-56320|65536,n=null}else n&&(-1<(t-=3)&&o.push(239,191,189),n=null);if(128>i){if(0>(t-=1))break;o.push(i)}else if(2048>i){if(0>(t-=2))break;o.push(192|i>>6,128|63&i)}else if(65536>i){if(0>(t-=3))break;o.push(224|i>>12,128|63&i>>6,128|63&i)}else{if(!(2097152>i))throw new Error("Invalid code point");if(0>(t-=4))break;o.push(240|i>>18,128|63&i>>12,128|63&i>>6,128|63&i)}}return o}function t(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}TextEncoderLite.prototype.encode=function(t){return"undefined"==typeof Uint8Array?e(t):new Uint8Array(e(t))},TextDecoderLite.prototype.decode=function(e){return function(e,i,r){var n="",o="";r=Math.min(e.length,r||1/0);for(var s=i=i||0;s<r;s++)127>=e[s]?(n+=t(o)+String.fromCharCode(e[s]),o=""):o+="%"+e[s].toString(16);return n+t(o)}(e,0,e.length)}}();var _Group=function(){this._tweens={},this._tweensAddedDuringUpdate={}};_Group.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var i=Object.keys(this._tweens);if(0===i.length)return!1;for(e=void 0!==e?e:TWEEN.now();i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var n=this._tweens[i[r]];n&&!1===n.update(e)&&(n._isPlaying=!1,t||delete this._tweens[i[r]])}i=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var TWEEN=new _Group;TWEEN.Group=_Group,TWEEN._nextId=0,TWEEN.nextId=function(){return TWEEN._nextId++},"undefined"==typeof window&&"undefined"!=typeof process?TWEEN.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?TWEEN.now=window.performance.now.bind(window.performance):void 0!==Date.now?TWEEN.now=Date.now:TWEEN.now=function(){return(new Date).getTime()},TWEEN.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=TWEEN.Easing.Linear.None,this._interpolationFunction=TWEEN.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||TWEEN,this._id=TWEEN.nextId()},TWEEN.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=e,void 0!==t&&(this._duration=t),this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?TWEEN.now()+parseFloat(e):e:TWEEN.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==0&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,i,r;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(e-this._startTime)/this._duration,i=0===this._duration||i>1?1:i,r=this._easingFunction(i),this._valuesEnd)if(void 0!==this._valuesStart[t]){var n=this._valuesStart[t]||0,o=this._valuesEnd[t];o instanceof Array?this._object[t]=this._interpolationFunction(o,r):("string"==typeof o&&(o="+"===o.charAt(0)||"-"===o.charAt(0)?n+parseFloat(o):parseFloat(o)),"number"==typeof o&&(this._object[t]=n+(o-n)*r))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===i){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var s=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=s}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,l=this._chainedTweens.length;a<l;a++)this._chainedTweens[a].start(this._startTime+this._duration);return!1}return!0}},TWEEN.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*TWEEN.Easing.Bounce.In(2*e):.5*TWEEN.Easing.Bounce.Out(2*e-1)+.5}}},TWEEN.Interpolation={Linear:function(e,t){var i=e.length-1,r=i*t,n=Math.floor(r),o=TWEEN.Interpolation.Utils.Linear;return t<0?o(e[0],e[1],r):t>1?o(e[i],e[i-1],i-r):o(e[n],e[n+1>i?i:n+1],r-n)},Bezier:function(e,t){for(var i=0,r=e.length-1,n=Math.pow,o=TWEEN.Interpolation.Utils.Bernstein,s=0;s<=r;s++)i+=n(1-t,r-s)*n(t,s)*e[s]*o(r,s);return i},CatmullRom:function(e,t){var i=e.length-1,r=i*t,n=Math.floor(r),o=TWEEN.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(n=Math.floor(r=i*(1+t))),o(e[(n-1+i)%i],e[n],e[(n+1)%i],e[(n+2)%i],r-n)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[i]-(o(e[i],e[i],e[i-1],e[i-1],r-i)-e[i]):o(e[n?n-1:0],e[n],e[i<n+1?i:n+1],e[i<n+2?i:n+2],r-n)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=TWEEN.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i=1;if(e[t])return e[t];for(var r=t;r>1;r--)i*=r;return e[t]=i,i}}(),CatmullRom:function(e,t,i,r,n){var o=.5*(i-e),s=.5*(r-t),a=n*n;return(2*t-2*i+o+s)*(n*a)+(-3*t+3*i-2*o-s)*a+o*n+t}}},function(e){"function"==typeof define&&define.amd?define([],(function(){return TWEEN})):"undefined"!=typeof module&&"object"==typeof exports?module.exports=TWEEN:void 0!==e&&(e.TWEEN=TWEEN)}(this),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).json2mesh={})}(this,(function(e){"use strict";var t,i,r,n,o,s,a,l,u,c,h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},d=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),f=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},m=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},g=function(){function e(){p(this,e)}return d(e,null,[{key:"compatibilityProcessWorld",value:function(e){this.compatibilityProcessPlan(e.outdoors);for(var t=e.buildings,i=0;i<t.length;i++)for(var r=t[i].floorplans,n=0;n<r.length;n++){var o=r[n];this.compatibilityProcessPlan(o)}}},{key:"compatibilityProcessPlan",value:function(e){for(var t=0;t<e.combineStraightManualWallObjects.length;t++){var i=e.combineStraightManualWallObjects[t];e.combineStraightManualWalls.push(i.delayObject)}for(var r=0;r<e.combineCeilingObjects.length;r++){var n=e.combineCeilingObjects[r];e.combineCeilings.push(n.delayObject)}for(var o=0;o<e.combineFloorObjects.length;o++){var s=e.combineFloorObjects[o];e.combineFloors.push(s.delayObject)}for(var a=0;a<e.combineRoofObjects.length;a++){var l=e.combineRoofObjects[a];e.combineRoofs.push(l.delayObject)}for(var u=0;u<e.combineModelWallObjects.length;u++){var c=e.combineModelWallObjects[u];e.combineModelWalls.push(c.delayObject)}for(var h=0;h<e.combineDoorOrWindowObjects.length;h++){var p=e.combineDoorOrWindowObjects[h];e.combineDoorOrWins.push(p.delayObject)}for(var d=0;d<e.combinePlacementObjects.length;d++){var f=e.combinePlacementObjects[d];e.combinePlacements.push(f.delayObject)}}},{key:"combineObjectBuildCallback",value:function(e){var t=null;-1!==e.constructor.name.indexOf("Ceiling")?t=e.parent.combineCeilings:-1!==e.constructor.name.indexOf("DoorOrWindow")?t=e.parent.combineDoorOrWins:-1!==e.constructor.name.indexOf("Floor")?t=e.parent.combineFloors:-1!==e.constructor.name.indexOf("ModelWall")?t=e.parent.combineModelWalls:-1!==e.constructor.name.indexOf("Placement")?t=e.parent.combinePlacements:-1!==e.constructor.name.indexOf("Roof")?t=e.parent.combineRoofs:-1!==e.constructor.name.indexOf("Straight")&&(t=e.parent.combineStraightManualWalls),t.push(e.mesh)}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":h(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}}]),e}(),v=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},y=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),b=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},_=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},x=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},E=new(function(){function e(t){v(this,e),this.config=null,this.objectManager=null}return y(e,[{key:"createObject",value:function(e){var t=new(this.config.getClass(e.creatorType))(e),i=t.create();return t.parseChildren(),i}}]),e}()),w={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:(i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),n=0,function(){for(var e=0;e<36;e++)8===e||13===e||18===e||23===e?r[e]="-":14===e?r[e]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),t=15&n,n>>=4,r[e]=i[19===e?3&t|8:t]);return r.join("")}),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*w.DEG2RAD},radToDeg:function(e){return e*w.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},T=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},M=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),C=function(){function e(t,i,r,n){T(this,e),this._x=t||0,this._y=i||0,this._z=r||0,this._w=void 0!==n?n:1}return M(e,[{key:"slerp",value:function(e,t,i,r){return i.copy(e).slerp(t,r)}},{key:"slerpFlat",value:function(e,t,i,r,n,o,s){var a=i[r+0],l=i[r+1],u=i[r+2],c=i[r+3],h=n[o+0],p=n[o+1],d=n[o+2],f=n[o+3];if(c!==f||a!==h||l!==p||u!==d){var m=1-s,g=a*h+l*p+u*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,s=Math.sin(s*_)/b}var x=s*v;if(a=a*m+h*x,l=l*m+p*x,u=u*m+d*x,c=c*m+f*x,m===1-s){var E=1/Math.sqrt(a*a+l*l+u*u+c*c);a*=E,l*=E,u*=E,c*=E}}e[t]=a,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"set",value:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,r=e._y,n=e._z,o=e.order,s=Math.cos,a=Math.sin,l=s(i/2),u=s(r/2),c=s(n/2),h=a(i/2),p=a(r/2),d=a(n/2);return"XYZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"YXZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"ZXY"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"ZYX"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"YZX"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c-h*p*d):"XZY"===o&&(this._x=h*u*c-l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c+h*p*d),!1!==t&&this.onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this.onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],s=i[1],a=i[5],l=i[9],u=i[2],c=i[6],h=i[10],p=r+a+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(s-n)*t):r>a&&r>h?(t=2*Math.sqrt(1+r-a-h),this._w=(c-l)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(o+u)/t):a>h?(t=2*Math.sqrt(1+a-r-h),this._w=(o-u)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-r-a),this._w=(s-n)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var i,r=new S;return void 0===r&&(r=new S),(i=e.dot(t)+1)<1e-6?(i=0,Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0):r.set(0,-e.z,e.y)):r.crossVectors(e,t),this._x=r.x,this._y=r.y,this._z=r.z,this._w=i,this.normalize()}},{key:"inverse",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,s=t._x,a=t._y,l=t._z,u=t._w;return this._x=i*u+o*s+r*l-n*a,this._y=r*u+o*a+n*s-i*l,this._z=n*u+o*l+i*a-r*s,this._w=o*u-i*s-r*a-n*l,this.onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,s=o*e._w+i*e._x+r*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(r+this._y),this._z=.5*(n+this._z),this;var l=Math.atan2(a,s),u=Math.sin((1-t)*l)/a,c=Math.sin(t*l)/a;return this._w=o*u+this._w*c,this._x=i*u+this._x*c,this._y=r*u+this._y*c,this._z=n*u+this._z*c,this.onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"onChange",value:function(e){return this.onChangeCallback=e,this}},{key:"onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}]),e}(),S=function(){function e(t,i,r){T(this,e),this.x=t||0,this.y=i||0,this.z=r||0,this.isVector3=!0}return M(e,[{key:"set",value:function(e,t,i){return this.x=e,this.y=t,this.z=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(){var e=new C;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}()}},{key:"applyAxisAngle",value:function(){var e=new C;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i))}()}},{key:"applyMatrix3",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}},{key:"applyQuaternion",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*i,u=a*i+s*t-n*r,c=a*r+n*i-o*t,h=-n*t-o*i-s*r;return this.x=l*a+h*-n+u*-s-c*-o,this.y=u*a+h*-o+c*-n-l*-s,this.z=c*a+h*-s+l*-o-u*-n,this}},{key:"transformDirection",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(){var t=new e,i=new e;return function(e,r){return t.set(e,e,e),i.set(r,r,r),this.clamp(t,i)}()}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-i*e.z,this.z=i*e.y-r*e.x,this}},{key:"crossVectors",value:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this}},{key:"projectOnVector",value:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)}},{key:"projectOnPlane",value:function(){var t=new e;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}},{key:"reflect",value:function(){var t=new e;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}()}},{key:"angleTo",value:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(w.clamp(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this}},{key:"setFromCylindrical",value:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}]),e}();!function(){function e(t,i){T(this,e),this.isBox3=!0,this.min=void 0!==t?t:new S(1/0,1/0,1/0),this.max=void 0!==i?i:new S(-1/0,-1/0,-1/0)}M(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,l=e.length;a<l;a+=3){var u=e[a],c=e[a+1],h=e[a+2];u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,i,r),this.max.set(n,o,s),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,l=e.count;a<l;a++){var u=e.getX(a),c=e.getY(a),h=e.getZ(a);u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,i,r),this.max.set(n,o,s),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var i=(new S).copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){var t=e||new S;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){var t=e||new S;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=new S,i=this;return e.updateMatrixWorld(!0),e.traverse((function(e){var r,n,o=e.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(r=0,n=s.length;r<n;r++)t.copy(s[r]),t.applyMatrix4(e.matrixWorld),i.expandByPoint(t)}else if(o.isBufferGeometry){var a=o.attributes.position;if(void 0!==a)for(r=0,n=a.count;r<n;r++)t.fromBufferAttribute(a,r).applyMatrix4(e.matrixWorld),i.expandByPoint(t)}})),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return(t||new S).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsPlane",value:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=e.constant&&i>=e.constant}},{key:"clampPoint",value:function(e,t){return(t||new S).copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return(new S).copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){var t=[new S,new S,new S,new S,new S,new S,new S,new S];return this.isEmpty()||(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}])}();function j(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(j.prototype,{isMatrix4:!0,set:function(e,t,i,r,n,o,s,a,l,u,c,h,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new j).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:(c=new S,function(e){var t=this.elements,i=e.elements,r=1/c.setFromMatrixColumn(e,0).length(),n=1/c.setFromMatrixColumn(e,1).length(),o=1/c.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,this}),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,o=Math.cos(i),s=Math.sin(i),a=Math.cos(r),l=Math.sin(r),u=Math.cos(n),c=Math.sin(n);if("XYZ"===e.order){var h=o*u,p=o*c,d=s*u,f=s*c;t[0]=a*u,t[4]=-a*c,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-s*a,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*a}else if("YXZ"===e.order){var m=a*u,g=a*c,v=l*u,y=l*c;t[0]=m+y*s,t[4]=v*s-g,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-s,t[2]=g*s-v,t[6]=y+m*s,t[10]=o*a}else if("ZXY"===e.order){m=a*u,g=a*c,v=l*u,y=l*c;t[0]=m-y*s,t[4]=-o*c,t[8]=v+g*s,t[1]=g+v*s,t[5]=o*u,t[9]=y-m*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){h=o*u,p=o*c,d=s*u,f=s*c;t[0]=a*u,t[4]=d*l-p,t[8]=h*l+f,t[1]=a*c,t[5]=f*l+h,t[9]=p*l-d,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){var b=o*a,_=o*l,x=s*a,E=s*l;t[0]=a*u,t[4]=E-b*c,t[8]=x*c+_,t[1]=c,t[5]=o*u,t[9]=-s*u,t[2]=-l*u,t[6]=_*c+x,t[10]=b-E*c}else if("XZY"===e.order){b=o*a,_=o*l,x=s*a,E=s*l;t[0]=a*u,t[4]=-c,t[8]=l*u,t[1]=b*c+E,t[5]=o*u,t[9]=_*c-x,t[2]=x*c-_,t[6]=s*u,t[10]=E*c+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e._x,r=e._y,n=e._z,o=e._w,s=i+i,a=r+r,l=n+n,u=i*s,c=i*a,h=i*l,p=r*a,d=r*l,f=n*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(p+f),t[4]=c-v,t[8]=h+g,t[1]=c+v,t[5]=1-(u+f),t[9]=d-m,t[2]=h-g,t[6]=d+m,t[10]=1-(u+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:(a=new S,l=new S,u=new S,function(e,t,i){var r=this.elements;return u.subVectors(e,t),0===u.lengthSq()&&(u.z=1),u.normalize(),a.crossVectors(i,u),0===a.lengthSq()&&(1===Math.abs(i.z)?u.x+=1e-4:u.z+=1e-4,u.normalize(),a.crossVectors(i,u)),a.normalize(),l.crossVectors(u,a),r[0]=a.x,r[4]=l.x,r[8]=u.x,r[1]=a.y,r[5]=l.y,r[9]=u.y,r[2]=a.z,r[6]=l.z,r[10]=u.z,this}),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],u=i[1],c=i[5],h=i[9],p=i[13],d=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],_=i[15],x=r[0],E=r[4],w=r[8],T=r[12],M=r[1],C=r[5],S=r[9],j=r[13],P=r[2],R=r[6],D=r[10],A=r[14],k=r[3],O=r[7],B=r[11],F=r[15];return n[0]=o*x+s*M+a*P+l*k,n[4]=o*E+s*C+a*R+l*O,n[8]=o*w+s*S+a*D+l*B,n[12]=o*T+s*j+a*A+l*F,n[1]=u*x+c*M+h*P+p*k,n[5]=u*E+c*C+h*R+p*O,n[9]=u*w+c*S+h*D+p*B,n[13]=u*T+c*j+h*A+p*F,n[2]=d*x+f*M+m*P+g*k,n[6]=d*E+f*C+m*R+g*O,n[10]=d*w+f*S+m*D+g*B,n[14]=d*T+f*j+m*A+g*F,n[3]=v*x+y*M+b*P+_*k,n[7]=v*E+y*C+b*R+_*O,n[11]=v*w+y*S+b*D+_*B,n[15]=v*T+y*j+b*A+_*F,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new S;return function(t){for(var i=0,r=t.count;i<r;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix4(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],s=e[5],a=e[9],l=e[13],u=e[2],c=e[6],h=e[10],p=e[14];return e[3]*(+n*a*c-r*l*c-n*s*h+i*l*h+r*s*p-i*a*p)+e[7]*(+t*a*p-t*l*h+n*o*h-r*o*p+r*l*u-n*a*u)+e[11]*(+t*l*c-t*s*p-n*o*c+i*o*p+n*s*u-i*l*u)+e[15]*(-r*s*u-t*a*c+t*s*h+r*o*c-i*o*h+i*a*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],o=r[1],s=r[2],a=r[3],l=r[4],u=r[5],c=r[6],h=r[7],p=r[8],d=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],b=r[15],_=d*y*h-v*f*h+v*c*m-u*y*m-d*c*b+u*f*b,x=g*f*h-p*y*h-g*c*m+l*y*m+p*c*b-l*f*b,E=p*v*h-g*d*h+g*u*m-l*v*m-p*u*b+l*d*b,w=g*d*c-p*v*c-g*u*f+l*v*f+p*u*y-l*d*y,T=n*_+o*x+s*E+a*w;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var C=1/T;return i[0]=_*C,i[1]=(v*f*a-d*y*a-v*s*m+o*y*m+d*s*b-o*f*b)*C,i[2]=(u*y*a-v*c*a+v*s*h-o*y*h-u*s*b+o*c*b)*C,i[3]=(d*c*a-u*f*a-d*s*h+o*f*h+u*s*m-o*c*m)*C,i[4]=x*C,i[5]=(p*y*a-g*f*a+g*s*m-n*y*m-p*s*b+n*f*b)*C,i[6]=(g*c*a-l*y*a-g*s*h+n*y*h+l*s*b-n*c*b)*C,i[7]=(l*f*a-p*c*a+p*s*h-n*f*h-l*s*m+n*c*m)*C,i[8]=E*C,i[9]=(g*d*a-p*v*a-g*o*m+n*v*m+p*o*b-n*d*b)*C,i[10]=(l*v*a-g*u*a+g*o*h-n*v*h-l*o*b+n*u*b)*C,i[11]=(p*u*a-l*d*a-p*o*h+n*d*h+l*o*m-n*u*m)*C,i[12]=w*C,i[13]=(p*v*s-g*d*s+g*o*f-n*v*f-p*o*y+n*d*y)*C,i[14]=(g*u*s-l*v*s-g*o*c+n*v*c+l*o*y-n*u*y)*C,i[15]=(l*d*s-p*u*s+p*o*c-n*d*c-l*o*f+n*u*f)*C,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,s=e.y,a=e.z,l=n*o,u=n*s;return this.set(l*o+i,l*s-r*a,l*a+r*s,0,l*s+r*a,u*s+i,u*a-r*o,0,l*a-r*s,u*a+r*o,n*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:(o=new S,s=new j,function(e,t,i){var r=this.elements,n=o.set(r[0],r[1],r[2]).length(),a=o.set(r[4],r[5],r[6]).length(),l=o.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],s.copy(this);var u=1/n,c=1/a,h=1/l;return s.elements[0]*=u,s.elements[1]*=u,s.elements[2]*=u,s.elements[4]*=c,s.elements[5]*=c,s.elements[6]*=c,s.elements[8]*=h,s.elements[9]*=h,s.elements[10]*=h,t.setFromRotationMatrix(s),i.x=n,i.y=a,i.z=l,this}),makePerspective:function(e,t,i,r,n,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,a=2*n/(t-e),l=2*n/(i-r),u=(t+e)/(t-e),c=(i+r)/(i-r),h=-(o+n)/(o-n),p=-2*o*n/(o-n);return s[0]=a,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(e,t,i,r,n,o){var s=this.elements,a=1/(t-e),l=1/(i-r),u=1/(o-n),c=(t+e)*a,h=(i+r)*l,p=(o+n)*u;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}});!function(){function e(t,i){T(this,e),this.x=t||0,this.y=i||0,this.isVector2=!0}M(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(){var t=new e,i=new e;return function(e,r){return t.set(e,e),i.set(r,r),this.clamp(t,i)}()}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}},{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}}])}();var P={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},R=function(){function e(){v(this,e)}return y(e,null,[{key:"uuid",value:function(){for(var e,t=P.chars,i=P.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"checkValueEmpty",value:function(e){return null==e}},{key:"convertToVector3",value:function(e){return e.isVector3?e:new S(e[0],e[1],e[2])}},{key:"convertToQuaternion",value:function(e){return new C(e[0],e[1],e[2],e[3])}}]),e}(),D=function(){function e(t){v(this,e),this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=t.jsonData,this.objectParent=null,t.parent&&(this.objectParent=t.parent),this.createType=null,this.resourceManager=t.resourceManager}return y(e,[{key:"create",value:function(){var e=this._getCreateParams();return this.object=E.objectManager.create(e),this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.jsonData=this.jsonData,e.parent&&(this.object.parent=e.parent),R.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.jsonData.properties&&(this.object.properties=this.jsonData.properties,this.object.lowerCaseProperties=this.convertPropertiesToLowerCase(this.jsonData.properties)),this.object}},{key:"convertPropertiesToLowerCase",value:function(e){var t={};for(var i in e)t[i.toLowerCase()]=e[i].toLowerCase();return t}},{key:"parseChildren",value:function(){}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,E.createObject(e)}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),e}(),A={scale:1,defaultFloorTextureResource:null,defaultCeilingTextureResource:null,defaultRoofTextureResource:null},k=0,O=1,B=2,F=4,L=5,I=8,N=9,U=10,z=22,H=23,V=24,W=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return _(t,e),y(t,[{key:"create",value:function(){return this.jsonData.unit&&(A.scale=.01*this.jsonData.unit),b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this)}},{key:"parseChildren",value:function(){var e=this.jsonData,t=(this._parseJsonDataChild({jsonData:e,creatorType:O}),this._parseJsonDataChild({jsonData:{},creatorType:U}));this.object.outdoors=t}}]),t}(D),G=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return _(t,e),y(t,[{key:"parseChildren",value:function(){var e=this.jsonData;this._parseJsonDataChild({jsonData:e,creatorType:B})}}]),t}(D),q=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.walls&&this._parseWalls(e.walls),e.rooms&&this._parseJsonDataChildren({jsonData:e.rooms,creatorType:N}),e.doors&&this._parseJsonDataChildren({jsonData:e.doors,creatorType:I}),this.object.calRoomsUV2()}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];0===i.type?this._parseJsonDataChild({jsonData:i,creatorType:L}):this._parseJsonDataChild({jsonData:i,creatorType:F})}}}]),t}(D),X=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="WallCorner",i}return _(t,e),y(t,[{key:"create",value:function(){b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=this.jsonData[0]*A.scale,i=this.jsonData[1]*A.scale;return this.object.position=[e,0,i],this.object}}]),t}(D),J=function(e){function t(e){return v(this,t),x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _(t,e),y(t,[{key:"_parseCorners",value:function(){var e=this.jsonData,t=(this.objectParent,e.start[0]*A.scale),i=e.start[1]*A.scale,r=null,n=null;r=this._existsCorner(t,0,i)?this._getCorner(t,0,i):this._createCorner(t,0,i,e.start),t=e.end[0]*A.scale,i=e.end[1]*A.scale,n=this._existsCorner(t,0,i)?this._getCorner(t,0,i):this._createCorner(t,0,i,e.end),this.object.startCorner=r,this.object.endCorner=n}},{key:"_existsCorner",value:function(e,t,i){var r=this.objectParent.typeToChildren.WallCorner;if(r)for(var n=0,o=r.length;n<o;n++){var s=r[n].position;if(s[0]===e&&s[1]===t&&s[2]===i)return!0}return!1}},{key:"_getCorner",value:function(e,t,i){for(var r=this.objectParent.typeToChildren.WallCorner,n=0,o=r.length;n<o;n++){var s=r[n].position;if(s[0]===e&&s[1]===t&&s[2]===i)return r[n]}return null}},{key:"_createCorner",value:function(e,t,i,r){var n=new X({jsonData:r}).create();return n.parent=this.objectParent,n.jsonData=r,n}}]),t}(D),Y=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ModelWall",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),R.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),R.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),R.checkValueEmpty(this.jsonData.height)?this.object.height=this.object.resource.modelSize.y:this.object.height=this.jsonData.height,R.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}}]),t}(J),Z=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="StraightManualWall",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),this._parseResources(),this.jsonData.uvmultiple&&(this.object.uvMultiple=this.jsonData.uvmultiple),R.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),R.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}},{key:"_parseResources",value:function(){R.checkValueEmpty(this.jsonData.lefttexture)||(this.object.leftResource=this.resourceManager.textures[this.jsonData.lefttexture]),R.checkValueEmpty(this.jsonData.righttexture)||(this.object.rightResource=this.resourceManager.textures[this.jsonData.righttexture]),R.checkValueEmpty(this.jsonData.edgetexture)||(this.object.edgeResource=this.resourceManager.textures[this.jsonData.edgetexture])}}]),t}(J),Q=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.attachWall=e.attachWall,i.createType="DoorOrWindow",i.pointInLineDeviation=.001,i}return _(t,e),y(t,[{key:"create",value:function(){b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=A.scale,i=this.jsonData,r=i.height*e,n=i.width*e,o=[i.pos[0]*e,0,i.pos[1]*e];this.attachWall=this._getPointOnWhichWall(this.objectParent,o),null===this.attachWall&&console.warn("can not find door on which wall!");var s=this.object;return i.suspendpercent&&(s.suspendPercent=i.suspendpercent),s.resource=this.resourceManager.create({id:s.id+"res",type:"EmptyModelResource"}),s.resource.size=[n,r,.15],s.position=o,this.object.attachWall=this.attachWall,this.attachWall.doorOrWindows.push(this.object),this.object}},{key:"_getPointOnWhichWall",value:function(e,t){var i=[],r=e.typeToChildren.StraightManualWall,n=e.typeToChildren.ModelWall;r&&(i=i.concat(r)),n&&(i=i.concat(n));for(var o=0;o<i.length;o++){var s=i[o];if(this._isPointOnLineAndBetweenPoints(R.convertToVector3(s.startCorner.position),R.convertToVector3(s.endCorner.position),R.convertToVector3(t)))return s}return null}},{key:"_isPointOnLine",value:function(e,t,i){var r=new S;return r.crossVectors(e.clone().sub(i),t.clone().sub(i)),r.length()<this.pointInLineDeviation}},{key:"_isPointOnLineAndBetweenPoints",value:function(e,t,i){if(!this._isPointOnLine(e,t,i))return!1;var r=t.x-e.x,n=t.z-e.z;return Math.abs(r)>=Math.abs(n)?r>0?e.x<=i.x&&i.x<=t.x:t.x<=i.x&&i.x<=e.x:n>0?e.z<=i.z&&i.z<=t.z:t.z<=i.z&&i.z<=e.z}}]),t}(D);function K(e,t){if(!(this instanceof K))return new K(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||$,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function $(e,t){return e<t?-1:e>t?1:0}function ee(e,t,i){var r,n,o,s;t=t||1;for(var a=0;a<e[0].length;a++){var l=e[0][a];(!a||l[0]<r)&&(r=l[0]),(!a||l[1]<n)&&(n=l[1]),(!a||l[0]>o)&&(o=l[0]),(!a||l[1]>s)&&(s=l[1])}var u=o-r,c=s-n,h=Math.min(u,c),p=h/2,d=new K(null,te);if(0===h)return[r,n];for(var f=r;f<o;f+=h)for(var m=n;m<s;m+=h)d.push(new ie(f+p,m+p,p,e));var g=function(e){for(var t=0,i=0,r=0,n=e[0],o=0,s=n.length,a=s-1;o<s;a=o++){var l=n[o],u=n[a],c=l[0]*u[1]-u[0]*l[1];i+=(l[0]+u[0])*c,r+=(l[1]+u[1])*c,t+=3*c}return 0===t?new ie(n[0][0],n[0][1],0,e):new ie(i/t,r/t,0,e)}(e),v=new ie(r+u/2,n+c/2,0,e);v.d>g.d&&(g=v);for(var y=d.length;d.length;){var b=d.pop();b.d>g.d&&(g=b,i&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,y)),b.max-g.d<=t||(p=b.h/2,d.push(new ie(b.x-p,b.y-p,p,e)),d.push(new ie(b.x+p,b.y-p,p,e)),d.push(new ie(b.x-p,b.y+p,p,e)),d.push(new ie(b.x+p,b.y+p,p,e)),y+=4)}return i&&(console.log("num probes: "+y),console.log("best distance: "+g.d)),[g.x,g.y]}function te(e,t){return t.max-e.max}function ie(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=function(e,t,i){for(var r=!1,n=1/0,o=0;o<i.length;o++)for(var s=i[o],a=0,l=s.length,u=l-1;a<l;u=a++){var c=s[a],h=s[u];c[1]>t!=h[1]>t&&e<(h[0]-c[0])*(t-c[1])/(h[1]-c[1])+c[0]&&(r=!r),n=Math.min(n,re(e,t,c,h))}return(r?1:-1)*Math.sqrt(n)}(e,t,r),this.max=this.d+this.h*Math.SQRT2}function re(e,t,i,r){var n=i[0],o=i[1],s=r[0]-n,a=r[1]-o;if(0!==s||0!==a){var l=((e-n)*s+(t-o)*a)/(s*s+a*a);l>1?(n=r[0],o=r[1]):l>0&&(n+=s*l,o+=a*l)}return(s=e-n)*s+(a=t-o)*a}K.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,i=this.compare,r=t[e];e>0;){var n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r},_down:function(e){for(var t=this.data,i=this.compare,r=this.length>>1,n=t[e];e<r;){var o=1+(e<<1),s=o+1,a=t[o];if(s<this.length&&i(t[s],a)<0&&(o=s,a=t[s]),i(a,n)>=0)break;t[e]=a,e=o}t[e]=n}};var ne=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return _(t,e),y(t,[{key:"create",value:function(){if(b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._createChildren(),this._parsePoints(),0!==this.object.points.length)return this._parseHolesPoints(),this._parseRoomResources(),this._parseRoomHeight(),this._parseRoomBlockSize(),this._parseRoomVisible(),this._parseRoomBlockAngle(),this.object.position=this._calRoomPosition(this.object),this._subRoomHolesPointsByPosition(this.object,this.object.position),this._subRoomPointsByPosition(this.object,this.object.position),this.object;console.error("room points is null")}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:z}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:H}),this._parseJsonDataChild({jsonData:{},creatorType:V}))}},{key:"_parsePoints",value:function(){if(this.jsonData.points){for(var e=[],t=0;t<this.jsonData.points.length;t++){var i=this.jsonData.points[t],r=[A.scale*i[0],0,A.scale*i[1]];e.push(r)}this.object.points=e}}},{key:"_parseHolesPoints",value:function(){if(this.jsonData.holes){for(var e=[],t=0;t<this.jsonData.holes.length;t++){for(var i=this.jsonData.holes[t],r=[],n=0;n<i.length;n++){var o=i[n],s=[A.scale*o[0],0,A.scale*o[1]];r.push(s)}e.push(r)}this.object.holes=e}}},{key:"_parseRoomResources",value:function(){this.object.floor.resource=A.defaultFloorTextureResource,this.object.ceiling.resource=A.defaultCeilingTextureResource,this.object.roof.resource=A.defaultRoofTextureResource,null!==this.jsonData.floortexture&&void 0!==this.jsonData.floortexture&&(this.object.floorResource=this.resourceManager.textures[this.jsonData.floortexture],this.object.floor.resource=this.object.floorResource),null!==this.jsonData.ceilingtexture&&void 0!==this.jsonData.ceilingtexture&&(this.object.ceilingResource=this.resourceManager.textures[this.jsonData.ceilingtexture],this.object.ceiling.resource=this.object.ceilingResource),null!==this.jsonData.rooftexture&&void 0!==this.jsonData.rooftexture&&(this.object.roofResource=this.resourceManager.textures[this.jsonData.rooftexture],this.object.roof.resource=this.object.roofResource)}},{key:"_parseRoomHeight",value:function(){var e=this.jsonData,t=this.object;void 0!==e.ceilingheight?t.ceiling.height=e.ceilingheight:(t.ceiling.DefaultHeight=this.objectParent.height-.1,t.ceiling.height=t.ceiling.DefaultHeight),void 0!==e.roofheight?t.roof.height=e.roofheight:(t.roof.defaultHeight=this.objectParent.height,t.roof.height=t.roof.defaultHeight),void 0!==e.floorheight&&(t.floor.height=e.floorheight)}},{key:"_parseRoomVisible",value:function(){var e=this.jsonData,t=this.object;void 0!==e.isshowfloor&&(t.floor.visible=e.isshowfloor),void 0!==e.isshowceiling&&(t.ceiling.visible=e.isshowceiling),void 0!==e.isshowroof&&(t.roof.visible=e.isshowroof)}},{key:"_parseRoomBlockSize",value:function(){var e=this.jsonData,t=this.object;if(e.floorblocksize){var i=e.floorblocksize;t.floor.blockSize=[i[0],i[1]]}if(e.ceilingblocksize){var r=e.ceilingblocksize;t.ceiling.blockSize=[r[0],r[1]]}if(e.roofblocksize){var n=e.roofblocksize;t.roof.blockSize=[n[0],n[1]]}}},{key:"_parseRoomBlockAngle",value:function(){var e=this.jsonData,t=this.object;R.checkValueEmpty(e.floorblockangle)||(t.floor.blockAngle=e.floorblockangle),R.checkValueEmpty(e.ceilingblockangle)||(t.ceiling.blockAngle=e.ceilingblockangle),R.checkValueEmpty(e.roofblockangle)||(t.roof.blockAngle=e.roofblockangle)}},{key:"_calRoomPosition",value:function(e){for(var t=e.points,i=e.holes,r=[],n=[],o=0;o<t.length;o++){var s=t[o];r.push([s[0],s[2]])}if(i.length>2&&!this._isSamePoints(i))for(o=0;o<i.length;o++){for(var a=i[o],l=[],u=0;u<a.length;u++){s=a[u];l.push([s[0],s[2]])}n.push(l)}var c=this._getLabelPosition(r,n);return c||[0,0,0]}},{key:"_isSamePoints",value:function(e){for(var t=e[0],i=1;i<e.length;i++){var r=e[i];if(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2])return!1}return!0}},{key:"_subRoomPointsByPosition",value:function(e,t){for(var i=e.points,r=0;r<i.length;r++){var n=i[r];n[0]-=t[0],n[1]-=t[1],n[2]-=t[2]}e.points=i}},{key:"_subRoomHolesPointsByPosition",value:function(e,t){for(var i=e.holes,r=0;r<i.length;r++)for(var n=i[r],o=0;o<n.length;o++){var s=n[o];s[0]-=t[0],s[1]-=t[1],s[2]-=t[2]}e.holes=i}},{key:"_getLabelPosition",value:function(e,t){if(!e||!e.length)return null;var i=[];i.push(e);var r=ee(i);return[r[0],0,r[1]]}}]),t}(D),oe=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return _(t,e),t}(q),se=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Floor",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(D),ae=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Roof",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(D),le=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Ceiling",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(D),ue=function(){function e(t){v(this,e),this._map={0:W,1:G,2:q,3:X,4:Y,5:Z,8:Q,9:ne,10:oe,22:se,23:le,24:ae}}return y(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),ce=new(function(){function e(){v(this,e),this.objects=[],this._objectTypeConfig=null}return y(e,[{key:"create",value:function(e){var t=e.type;return new(0,this.objectTypeConfig[t])}},{key:"objectTypeConfig",set:function(e){this._objectTypeConfig=e},get:function(){return this._objectTypeConfig}}]),e}()),he=function(){function e(t){v(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl}return y(e,[{key:"createResource",value:function(e){var t=this.manager.create({type:e});return t.manager=this.manager,t}},{key:"loadTextures",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];t=r.localurl?this._loadLocalCustomTextureResource(r):this._loadTextureResource(r),this.manager.textures.push(t)}}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource("LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource("TextureResource");return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];if((t=r.model?this.createResource("CustomResource"):r.localurl?this.createResource("CustomModelResource"):this.createResource("ModelResource")).baseUrl=this.baseModelUrl,r.localurl){if(t.localUrl=r.localurl,t.id=r.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,r.title&&(t.modelName=r.title),t.modelID=r.id,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.color){var n=r.color;t.color=[n[0],n[1],n[2]],4===n.length&&(t.opacity=n[3])}}else if(r.id){if(t.id=r.id,t.modelID=r.id,t.version=r.version,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.model&&(t.modelID=r.model),r.title&&(t.modelName=r.title),r.color){n=r.color;t.color=[n[0],n[1],n[2]],4===n.length&&(t.opacity=n[3])}if(r.size){var o=r.size;t.size=[o[0],o[1],o[2]]}r.hasanimation&&(t.hasAnim=r.hasanimation),r.url&&(t.url=r.url)}for(var s=0;s<this.manager.ableToSupportFootAndHeadModelWalls.length;s++){var a=this.manager.ableToSupportFootAndHeadModelWalls[s];if(t.id===a){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var i=e.color;t.color=[i[0],i[1],i[2]],4===i.length&&(t.opacity=i[3])}if(e.size){var r=e.size;t.modelSize=[r[0],r[1],r[2]]}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),pe=function(){function e(t){v(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new ue,t&&t.resourceLibraryUrl&&(this.resourceLibraryUrl=t.resourceLibraryUrl)}return y(e,[{key:"setObjectTypeConfig",value:function(e){ce.objectTypeConfig=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"setObjectManager",value:function(e){E.objectManager=e}},{key:"initDefaultResources",value:function(){this.createEmptyModelResource(),this.createEmptyTextureResource(),this.resourceLibraryUrl&&(this.resourceManager.baseTextureUrl=this.resourceLibraryUrl+"/texture/",this.resourceManager.baseModelUrl=this.resourceLibraryUrl+"/model/"),this.defaultFloorTextureResource=this.createResource("TextureResource"),this.defaultFloorTextureResource.id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",this.defaultFloorTextureResource.ext="jpg",this.defaultFloorTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultCeilingTextureResource=this.createResource("TextureResource"),this.defaultCeilingTextureResource.id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",this.defaultCeilingTextureResource.ext="jpg",this.defaultCeilingTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultRoofTextureResource=this.createResource("TextureResource"),this.defaultRoofTextureResource.id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",this.defaultRoofTextureResource.ext="jpg",this.defaultRoofTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultDoorResource=this.resourceManager.emptyModelResource,A.defaultFloorTextureResource=this.defaultFloorTextureResource,A.defaultCeilingTextureResource=this.defaultCeilingTextureResource,A.defaultRoofTextureResource=this.defaultRoofTextureResource,A.defaultDoorResource=this.defaultDoorResource}},{key:"createEmptyTextureResource",value:function(){var e=this.createResource("TextureResource");e.isBuilded=!0,e.texture=new THREE.Texture,e.isEmpty=!0,e.buildPromise=Promise.resolve(),this.resourceManager.emptyTextureResource=e}},{key:"createEmptyModelResource",value:function(){var e=this.createResource("ModelResource");e.isBuilded=!0,e.model=new THREE.Object3D,e.isEmpty=!0,e.buildPromise=Promise.resolve(),this.resourceManager.emptyModelResource=e}},{key:"loadLightMaps",value:function(e){var t=null,i="18091219l1g1hnjt",r="png";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(i=e.straightmanualwall.lightingtexture.id,r=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource("TextureResource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=i,t.ext=r,this.defaultResource.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource("TextureResource")).baseUrl=this.resourceManager.baseTextureUrl,t.id="18091216vjlgtwbh",t.ext="jpg",this.defaultResource.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=this.resourceManager.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++){i+=t[r]+"/"}return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,i){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,(function(i){e.sceneJson=JSON.parse(i),t()}),(function(){}),(function(t){i("can not load "+e.sceneURL)}))}else i("load scene json error")}))}},{key:"getResourceLoader",value:function(){return new he(this.resourceManager)}},{key:"parseSceneJson",value:function(){var e=this.getResourceLoader();this.loadLightMaps(this.sceneJson.materialsetting),this.initDefaultResources(),e.loadTextures(this.sceneJson.textures),e.loadModels(this.sceneJson.models),this.parseWorld(this.sceneJson)}},{key:"parseWorld",value:function(e){E.config=this.creatorTypeConfig,this.world=E.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:k})}}]),e}(),de=new(function(){function e(t){v(this,e),this.config=null}return y(e,[{key:"createObject",value:function(e){var t=new(this.config.getClass(e.creatorType))(e),i=t.create();return t.parseChildren(),i}}]),e}()),fe=function(){function e(t){v(this,e),this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=t.jsonData,this.objectParent=null,t.parent&&(this.objectParent=t.parent),this.createType=null,this.resourceManager=t.resourceManager}return y(e,[{key:"create",value:function(){var e=this._getCreateParams();return this.object=de.objectManager.create(e),this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.jsonData=this.jsonData,e.parent&&(this.object.parent=e.parent),R.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.object}},{key:"parseChildren",value:function(){}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,de.createObject(e)}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),e}(),me={scale:1,defaultFloorTextureResource:null,defaultCeilingTextureResource:null,defaultRoofTextureResource:null},ge=0,ve=1,ye=2,be=5,_e=8,xe=9,Ee=10,we=22,Te=23,Me=24,Ce=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return _(t,e),y(t,[{key:"create",value:function(){return this.jsonData.unit&&(me.scale=.01*this.jsonData.unit),b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this)}},{key:"parseChildren",value:function(){var e=this.jsonData,t=(this._parseJsonDataChild({jsonData:e,creatorType:ve}),this._parseJsonDataChild({jsonData:{},creatorType:Ee}));this.object.outdoors=t}}]),t}(fe),Se=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return _(t,e),y(t,[{key:"parseChildren",value:function(){var e=this.jsonData;this._parseJsonDataChild({jsonData:e,creatorType:ye})}}]),t}(fe),je=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.walls&&this._parseWalls(e.walls),e.rooms&&this._parseJsonDataChildren({jsonData:e.rooms,creatorType:xe}),e.doors&&this._parseJsonDataChildren({jsonData:e.doors,creatorType:_e}),this.object.calRoomsUV2()}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];this._parseJsonDataChild({jsonData:i,creatorType:be})}}}]),t}(fe),Pe=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="WallCorner",i}return _(t,e),y(t,[{key:"create",value:function(){b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=this.jsonData[0]*me.scale,i=this.jsonData[1]*me.scale;return this.object.position=[e,0,i],this.object}}]),t}(fe),Re=function(e){function t(e){return v(this,t),x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _(t,e),y(t,[{key:"_parseCorners",value:function(){var e=this.jsonData,t=(this.objectParent,e.start[0]*me.scale),i=e.start[1]*me.scale,r=null,n=null;r=this._existsCorner(t,0,i)?this._getCorner(t,0,i):this._createCorner(t,0,i,e.start),t=e.end[0]*me.scale,i=e.end[1]*me.scale,n=this._existsCorner(t,0,i)?this._getCorner(t,0,i):this._createCorner(t,0,i,e.end),this.object.startCorner=r,this.object.endCorner=n}},{key:"_existsCorner",value:function(e,t,i){var r=this.objectParent.typeToChildren.WallCorner;if(r)for(var n=0,o=r.length;n<o;n++){var s=r[n].position;if(s[0]===e&&s[1]===t&&s[2]===i)return!0}return!1}},{key:"_getCorner",value:function(e,t,i){for(var r=this.objectParent.typeToChildren.WallCorner,n=0,o=r.length;n<o;n++){var s=r[n].position;if(s[0]===e&&s[1]===t&&s[2]===i)return r[n]}return null}},{key:"_createCorner",value:function(e,t,i,r){var n=new Pe({jsonData:r}).create();return n.parent=this.objectParent,n.jsonData=r,n}}]),t}(fe),De=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ModelWall",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),R.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),R.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),R.checkValueEmpty(this.jsonData.height)?this.object.height=this.object.resource.modelSize.y:this.object.height=this.jsonData.height,R.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}}]),t}(Re),Ae=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="StraightManualWall",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),this._parseResources(),this.jsonData.uvmultiple&&(this.object.uvMultiple=this.jsonData.uvmultiple),R.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),R.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}},{key:"_parseResources",value:function(){this.object.leftResource=this.resourceManager.defaultWallTextureResource,this.object.rightResource=this.resourceManager.defaultWallTextureResource,this.object.edgeResource=this.resourceManager.defaultWallEdgeResource,this.object.lightMapResource=this.resourceManager.wallLightMapResource}}]),t}(Re),ke=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.attachWall=e.attachWall,i.createType="DoorOrWindow",i.pointInLineDeviation=.001,i}return _(t,e),y(t,[{key:"create",value:function(){b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=me.scale,i=this.jsonData,r=i.height*e,n=i.width*e,o=[i.pos[0]*e,0,i.pos[1]*e];this.attachWall=this._getPointOnWhichWall(this.objectParent,o),null===this.attachWall&&console.warn("can not find door on which wall!");var s=this.object;return i.suspendpercent&&(s.suspendPercent=i.suspendpercent),s.resource=this.resourceManager.create({id:s.id+"res",type:"EmptyModelResource"}),s.resource.size=[n,r,.15],s.position=o,this.object.attachWall=this.attachWall,this.attachWall.doorOrWindows.push(this.object),this.object}},{key:"_getPointOnWhichWall",value:function(e,t){var i=[],r=e.typeToChildren.StraightManualWall,n=e.typeToChildren.ModelWall;r&&(i=i.concat(r)),n&&(i=i.concat(n));for(var o=0;o<i.length;o++){var s=i[o];if(this._isPointOnLineAndBetweenPoints(R.convertToVector3(s.startCorner.position),R.convertToVector3(s.endCorner.position),R.convertToVector3(t)))return s}return null}},{key:"_isPointOnLine",value:function(e,t,i){var r=new S;return r.crossVectors(e.clone().sub(i),t.clone().sub(i)),r.length()<this.pointInLineDeviation}},{key:"_isPointOnLineAndBetweenPoints",value:function(e,t,i){if(!this._isPointOnLine(e,t,i))return!1;var r=t.x-e.x,n=t.z-e.z;return Math.abs(r)>=Math.abs(n)?r>0?e.x<=i.x&&i.x<=t.x:t.x<=i.x&&i.x<=e.x:n>0?e.z<=i.z&&i.z<=t.z:t.z<=i.z&&i.z<=e.z}}]),t}(fe),Oe=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return _(t,e),y(t,[{key:"create",value:function(){if(b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._createChildren(),this._parsePoints(),0!==this.object.points.length)return this._parseHolesPoints(),this._parseRoomResources(),this._parseRoomHeight(),this._parseRoomBlockSize(),this._parseRoomVisible(),this._parseRoomBlockAngle(),this.object;console.error("room points is null")}},{key:"_parsePoints",value:function(){if(this.jsonData.points){for(var e=[],t=0;t<this.jsonData.points.length;t++){var i=this.jsonData.points[t],r=[me.scale*i[0],0,me.scale*i[1]];e.push(r)}this.object.points=e}}},{key:"_parseHolesPoints",value:function(){if(this.jsonData.holes){for(var e=[],t=0;t<this.jsonData.holes.length;t++){for(var i=this.jsonData.holes[t],r=[],n=0;n<i.length;n++){var o=i[n],s=[me.scale*o[0],0,me.scale*o[1]];r.push(s)}e.push(r)}this.object.holes=e}}},{key:"_parseRoomResources",value:function(){this.object.floor.resource=me.defaultFloorTextureResource,this.object.ceiling.resource=me.defaultCeilingTextureResource,this.object.roof.resource=me.defaultRoofTextureResource,null!==this.jsonData.floortexture&&void 0!==this.jsonData.floortexture&&(this.object.floorResource=this.resourceManager.textures[this.jsonData.floortexture],this.object.floor.resource=this.object.floorResource),null!==this.jsonData.ceilingtexture&&void 0!==this.jsonData.ceilingtexture&&(this.object.ceilingResource=this.resourceManager.textures[this.jsonData.ceilingtexture],this.object.ceiling.resource=this.object.ceilingResource),null!==this.jsonData.rooftexture&&void 0!==this.jsonData.rooftexture&&(this.object.roofResource=this.resourceManager.textures[this.jsonData.rooftexture],this.object.roof.resource=this.object.roofResource)}},{key:"_parseRoomHeight",value:function(){var e=this.jsonData,t=this.object;void 0!==e.ceilingheight?t.ceiling.height=e.ceilingheight:(t.ceiling.DefaultHeight=this.objectParent.height-.1,t.ceiling.height=t.ceiling.DefaultHeight),void 0!==e.roofheight?t.roof.height=e.roofheight:(t.roof.defaultHeight=this.objectParent.height,t.roof.height=t.roof.defaultHeight),void 0!==e.floorheight&&(t.floor.height=e.floorheight)}},{key:"_parseRoomVisible",value:function(){var e=this.jsonData,t=this.object;void 0!==e.isshowfloor&&(t.floor.isShow=e.isshowfloor),void 0!==e.isshowceiling&&(t.ceiling.isShow=e.isshowceiling),void 0!==e.isshowroof&&(t.roof.isShow=e.isshowroof)}},{key:"_parseRoomBlockSize",value:function(){var e=this.jsonData,t=this.object;if(e.floorblocksize){var i=e.floorblocksize;t.floor.blockSize=[i[0],i[1]]}if(e.ceilingblocksize){var r=e.ceilingblocksize;t.ceiling.blockSize=[r[0],r[1]]}if(e.roofblocksize){var n=e.roofblocksize;t.roof.blockSize=[n[0],n[1]]}}},{key:"_parseRoomBlockAngle",value:function(){var e=this.jsonData,t=this.object;R.checkValueEmpty(e.floorblockangle)||(t.floor.blockAngle=e.floorblockangle),R.checkValueEmpty(e.ceilingblockangle)||(t.ceiling.blockAngle=e.ceilingblockangle),R.checkValueEmpty(e.roofblockangle)||(t.roof.blockAngle=e.roofblockangle)}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:we}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:Te}),this._parseJsonDataChild({jsonData:{},creatorType:Me}))}}]),t}(fe),Be=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return _(t,e),t}(je),Fe=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Floor",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(fe),Le=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Roof",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(fe),Ie=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Ceiling",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(fe),Ne=function(){function e(t){v(this,e),this._map={0:Ce,1:Se,2:je,3:Pe,4:De,5:Ae,8:ke,9:Oe,10:Be,22:Fe,23:Ie,24:Le}}return y(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),Ue=new(function(){function e(){v(this,e),this.objects=[],this._objectTypeConfig=null}return y(e,[{key:"create",value:function(e){var t=e.type;return new(0,this.objectTypeConfig[t])}},{key:"objectTypeConfig",set:function(e){this._objectTypeConfig=e},get:function(){return this._objectTypeConfig}}]),e}()),ze=function(){function e(t){v(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl}return y(e,[{key:"createResource",value:function(e){var t=this.manager.create({type:e});return t.manager=this.manager,t.baseUrl=this.manager.baseTextureUrl,t}},{key:"initDefaultResources",value:function(){var e=this.createResource("TextureResource");e.id="EB9ECFA1101C4A0ABB770ED3A9865441",e.ext="jpg",e.baseUrl=this.manager.baseTextureUrl,this.manager.defaultWallEdgeResource=e,this.manager.textures.push(e),(e=this.createResource("TextureResource")).id="81FDB96B43D441C5B3C650BFA2B76CD4",e.ext="jpg",e.isDefault=!0,this.manager.defaultWallTextureResource=e,this.manager.textures.push(e),(e=this.createResource("TextureResource")).id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",e.ext="jpg",this.manager.defaultFloorTextureResource=e,this.manager.textures.push(e),(e=this.createResource("TextureResource")).id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",e.ext="jpg",this.manager.defaultCeilingTextureResource=e,this.manager.textures.push(e),(e=this.createResource("TextureResource")).id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",e.ext="jpg",this.manager.defaultRoofTextureResource=e,this.manager.textures.push(e)}}]),e}(),He=function(){function e(t){v(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new Ne,t&&t.resourceLibraryUrl&&(this.resourceLibraryUrl=t.resourceLibraryUrl)}return y(e,[{key:"setObjectTypeConfig",value:function(e){Ue.objectTypeConfig=e}},{key:"setObjectManager",value:function(e){de.objectManager=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"initDefaultResources",value:function(){this.resourceLibraryUrl&&(this.resourceManager.baseTextureUrl=this.resourceLibraryUrl+"/texture/",this.resourceManager.baseModelUrl=this.resourceLibraryUrl+"/model/"),this.defaultFloorTextureResource=this.createResource("TextureResource"),this.defaultFloorTextureResource.id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",this.defaultFloorTextureResource.ext="jpg",this.defaultFloorTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultCeilingTextureResource=this.createResource("TextureResource"),this.defaultCeilingTextureResource.id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",this.defaultCeilingTextureResource.ext="jpg",this.defaultCeilingTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultRoofTextureResource=this.createResource("TextureResource"),this.defaultRoofTextureResource.id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",this.defaultRoofTextureResource.ext="jpg",this.defaultRoofTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultDoorResource=this.resourceManager.emptyModelResource,me.defaultFloorTextureResource=this.defaultFloorTextureResource,me.defaultCeilingTextureResource=this.defaultCeilingTextureResource,me.defaultRoofTextureResource=this.defaultRoofTextureResource,me.defaultDoorResource=this.defaultDoorResource}},{key:"loadLightMaps",value:function(e){var t=null,i="18091219l1g1hnjt",r="png";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(i=e.straightmanualwall.lightingtexture.id,r=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource("TextureResource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=i,t.ext=r,this.resourceManager.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource("TextureResource")).baseUrl=this.resourceManager.baseTextureUrl,t.id="18091216vjlgtwbh",t.ext="jpg",this.resourceManager.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=this.resourceManager.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++){i+=t[r]+"/"}return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,i){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,(function(i){e.sceneJson=JSON.parse(i),t()}),(function(){}),(function(t){i("can not load "+e.sceneURL)}))}else i("load scene json error")}))}},{key:"getResourceMaanagerLoader",value:function(){return new ze(this.resourceManager)}},{key:"parseSceneJson",value:function(){var e=this.getResourceMaanagerLoader();this.loadLightMaps(this.sceneJson.materialsetting),e.initDefaultResources(),this.initDefaultResources(),this.parseWorld(this.sceneJson)}},{key:"parseWorld",value:function(e){de.config=this.creatorTypeConfig,this.world=de.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:ge})}}]),e}(),Ve=new(function(){function e(t){v(this,e),this._map={0:new He,2:new pe},this._versions=[0]}return y(e,[{key:"getLoaderManager",value:function(e){return null!=e?this._map[e]:this._map[this._versions.length-1]}}]),e}()),We=function(){function e(t){v(this,e),this.resourceManager=t.resourceManager,this.defaultSetting=t.defaultSetting,this.defaultResource=t.defaultResource,this.objectManager=t.objectManager,t.version&&(this.version=t.version)}return y(e,[{key:"load",value:function(e){var t=Ve.getLoaderManager(this._getVersion(e));return t.setDefaultSetting(this.defaultSetting),t.setDefaultResource(this.defaultResource),t.setResourceManager(this.resourceManager),t.setObjectManager(this.objectManager),t.parseObjects(e)}},{key:"_getVersion",value:function(e){return null!==e.version&&void 0!==e.version?e.version:null!==e.json.version&&void 0!==e.json.version?e.json.version:void 0}}]),e}();var Ge=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){!function(t){var i=Object.prototype,r=i.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag",l=t.regeneratorRuntime;if(l)e.exports=l;else{(l=t.regeneratorRuntime=e.exports).wrap=m;var u={},c={};c[o]=function(){return this};var p=Object.getPrototypeOf,d=p&&p(p(C([])));d&&d!==i&&r.call(d,o)&&(c=d);var f=b.prototype=v.prototype=Object.create(c);y.prototype=f.constructor=b,b.constructor=y,b[a]=y.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(f),e},l.awrap=function(e){return{__await:e}},_(x.prototype),x.prototype[s]=function(){return this},l.AsyncIterator=x,l.async=function(e,t,i,r){var n=new x(m(e,t,i,r));return l.isGeneratorFunction(t)?n:n.next().then((function(e){return e.done?e.value:n.next()}))},_(f),f[a]="Generator",f[o]=function(){return this},f.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var r=t.pop();if(r in e)return i.value=r,i.done=!1,i}return i.done=!0,i}},l.values=C,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=undefined)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,r){return s.type="throw",s.arg=e,t.next=i,r&&(t.method="next",t.arg=undefined),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var a=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(a&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),T(i),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;T(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:C(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=undefined),u}}}function m(e,t,i,r){var n=t&&t.prototype instanceof v?t:v,o=Object.create(n.prototype),s=new M(r||[]);return o._invoke=function(e,t,i){var r="suspendedStart";return function(n,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw o;return S()}for(i.method=n,i.arg=o;;){var s=i.delegate;if(s){var a=E(s,i);if(a){if(a===u)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var l=g(e,t,i);if("normal"===l.type){if(r=i.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r="completed",i.method="throw",i.arg=l.arg)}}}(e,i,s),o}function g(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}function v(){}function y(){}function b(){}function _(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function x(e){var t;this._invoke=function(i,n){function o(){return new Promise((function(t,o){!function t(i,n,o,s){var a=g(e[i],e,n);if("throw"!==a.type){var l=a.arg,u=l.value;return u&&"object"===(void 0===u?"undefined":h(u))&&r.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,o,s)}),(function(e){t("throw",e,o,s)})):Promise.resolve(u).then((function(e){l.value=e,o(l)}),s)}s(a.arg)}(i,n,t,o)}))}return t=t?t.then(o,o):o()}}function E(e,t){var i=e.iterator[t.method];if(undefined===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=undefined,E(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=g(i,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var n=r.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,u):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function C(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(r.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=undefined,t.done=!0,t};return n.next=n}}return{next:S}}function S(){return{value:undefined,done:!0}}}(function(){return this}()||Function("return this")())})),qe=function(){return this}()||Function("return this")(),Xe=qe.regeneratorRuntime&&Object.getOwnPropertyNames(qe).indexOf("regeneratorRuntime")>=0,Je=Xe&&qe.regeneratorRuntime;qe.regeneratorRuntime=void 0;var Ye=Ge;if(Xe)qe.regeneratorRuntime=Je;else try{delete qe.regeneratorRuntime}catch(e){qe.regeneratorRuntime=void 0}var Ze=Ye,Qe=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var Ke=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._initParams(),this.resource=t,this.objects=[],this.isBuilded=!1,this._awaitToNextBuildTime=.01,this._maxBuildTime=1e3}return Qe(e,[{key:"_initParams",value:function(){this.resource=null,this.objects=null,this.isBuilded=null}},{key:"add",value:function(e){this.objects.push(e)}},{key:"build",value:function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t.isContainer?t.buildSelf():t.build()}this.isBuilded=!0}},{key:"containByClassType",value:function(e){for(var t=0;t<this.objects.length;t++){if(this.objects[t].type===e)return!0}return!1}},{key:"clear",value:function(){this._initParams()}}]),e}(),$e=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var et=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.manager=t,this._initParams(),this.resources=[],this.isBuilded=!1}return $e(e,[{key:"_initParams",value:function(){this.resources=null,this.isBuilded=null,this._allBuildedCallback=null}},{key:"add",value:function(e){this.resources.push(e)}},{key:"build",value:function(e){this._allBuildedCallback=e;for(var t=0;t<this.resources.length;t++){var i=this.resources[t];i.registerBuildCallbackListener(this._checkAllResourceBuilded,{unit:this}),i.build()}}},{key:"_checkAllResourceBuilded",value:function(e,t){var i=t.unit;if(!i.isBuilded){for(var r=i.resources,n=0;n<r.length;n++){if(!r[n].isBuilded)return}i.isBuilded=!0,i._allBuildedCallback&&i._allBuildedCallback()}}},{key:"clear",value:function(){this._initParams()}},{key:"isFull",get:function(){return this.resources.length>this.manager.maxResourcesUnitDownloadNumber}}]),e}(),tt=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var it=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._initParams(),this.buildUnits=[]}return tt(e,[{key:"_initParams",value:function(){this.buildUnits=null,this.currentAddingBuildUnit=null}},{key:"addResourceDownloadRequest",value:function(e){this.currentAddingBuildUnit&&!this.currentAddingBuildUnit.isFull||(this.currentAddingBuildUnit=new et,this.buildUnits.push(this.currentAddingBuildUnit)),this.currentAddingBuildUnit.add(e)}},{key:"startToDownloadRequestResources",value:function(e){var t=this;if(0!==t.requestDownloadResources.length&&(this.downloadResProgess=(this.curDonwloadResIndex-this.currentDownloadResMap.size)/t.requestDownloadResources.length,e&&e(this.downloadResProgess)),this.isStartedDonwloadResouces){if(this.curDonwloadResIndex===this.requestDownloadResources.length-1&&0===this.currentDownloadResMap.size)return this.downloadResProgess=1,void(e&&e(this.downloadResProgess))}else{t.requestDownloadResources;this.isStartedDonwloadResouces=!0,this.curDonwloadResIndex=0,this.currentDownloadResMap=new Map}if(0===this.requestDownloadResources.length)return this.downloadResProgess=1,void(e&&e(this.downloadResProgess));if(!(this.curDonwloadResIndex>this.requestDownloadResources.length-1)&&0!==this.downloadResMaxCount-this.currentDownloadResMap.size){var i=this.requestDownloadResources[this.curDonwloadResIndex];new Promise((function(e,t){i.registerBuildCallbackListener((function(){e(i)})),i.build()})).then((function(i){t.currentDownloadResMap.delete(i.id),t.startToDownloadRequestResources(e)})),this.currentDownloadResMap.set(i.id,i),this.curDonwloadResIndex++,this.startToDownloadRequestResources(e)}}},{key:"clear",value:function(){this._initParams()}}]),e}(),rt=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var nt=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="empty",this.isBuilded=!1,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[]}return rt(e,[{key:"build",value:function(e){e&&e(this),this.isBuilded=!0,this.notifyBuildCompleteListeners()}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"notifyBuildCompleteListeners",value:function(){for(var e=0;e<this.buildCompleteCallbacks.length;e++){(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}this._alreadyCallback=!0}}]),e}()),ot=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var st=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._initParams(),this.resourceBuildManager=new it,this.objectsBuildUnitMap=new Map,this.objectsBuildUnits=[],this.modelsResourcesBuildUnits=[],this.textureResourcesBuildUnits=[],this._emptyResource=nt,this.currentBuildingResourcesUnit=null,this.maxResourcesUnitDownloadNumber=200,this.awaitToNextBuildTime=12e3}var t,i;return ot(e,[{key:"_initParams",value:function(){this.resourceBuildManager=null,this.world=null,this.objectsBuildUnitMap=null,this.objectsBuildUnits=null,this.readyResourceUnits=null,this.unreadyResourceUnits=null,this._stopUpdateBuild=null,this._buildingUnits=null,this.buildingProgressCallback=null,this._awaitToNextBuildTime=0,this._resourceBuildUnitAwaitToNextBuildTime=null,this._resourceBuildUnitMaxBuildTime=null,this._emptyResource=null}},{key:"build",value:function(e){this.buildingProgressCallback=e,this.initRequestBuildUnits(),this._buildingUnits=[].concat(this.readyResourceUnits).concat(this.unreadyResourceUnits);for(var t=0;t<this._buildingUnits.length;t++){var i=this._buildingUnits[t].resource;null!==i&&this.addResourceDownloadRequest(i)}this._stopUpdateBuild=!1,this._updateBuildUnit()}},{key:"addResourceDownloadRequest",value:function(e){"TextureResource"===e.type?((0===this.textureResourcesBuildUnits.length||this.textureResourcesBuildUnits[this.textureResourcesBuildUnits.length-1].isFull)&&this.textureResourcesBuildUnits.push(new et(this)),this.textureResourcesBuildUnits[this.textureResourcesBuildUnits.length-1].add(e)):((0===this.modelsResourcesBuildUnits.length||this.modelsResourcesBuildUnits[this.modelsResourcesBuildUnits.length-1].isFull)&&this.modelsResourcesBuildUnits.push(new et(this)),this.modelsResourcesBuildUnits[this.modelsResourcesBuildUnits.length-1].add(e))}},{key:"initRequestBuildUnits",value:function(){this.sortobjectsBuildUnits(),this.readyResourceUnits=[],this.unreadyResourceUnits=[];for(var e=0;e<this.objectsBuildUnits.length;e++){var t=this.objectsBuildUnits[e],i=t.resource;i&&i.ready?this.readyResourceUnits.push(t):i&&this.unreadyResourceUnits.push(t)}}},{key:"sortobjectsBuildUnits",value:function(){for(var e=[],t=[],i=[],r=[],n=[],o=[],s=[],a=[],l=0;l<this.objectsBuildUnits.length;l++){var u=this.objectsBuildUnits[l];u.containByClassType("CombineStraightManualWall")?e.push(u):u.containByClassType("CombineRoof")?o.push(u):u.containByClassType("CombineModelWall")?i.push(u):u.containByClassType("CombinePlacementWall")?r.push(u):u.containByClassType("CombineFloor")?s.push(u):u.containByClassType("CombineCeiling")?n.push(u):u.containByClassType("CombineDoorOrWindow")?a.push(u):t.push(u)}this.objectsBuildUnits=[].concat(e).concat(o).concat(s).concat(n).concat(a).concat(i).concat(r).concat(t)}},{key:"_updateBuildUnit",value:function(){if(0!==this.textureResourcesBuildUnits.length||0!==this.modelsResourcesBuildUnits.length){var e=this;this.currentBuildingResourcesUnit||(0!==this.textureResourcesBuildUnits.length?this.currentBuildingResourcesUnit=this.textureResourcesBuildUnits.shift():0!==this.modelsResourcesBuildUnits.length&&(this.currentBuildingResourcesUnit=this.modelsResourcesBuildUnits.shift())),this.currentBuildingResourcesUnit.build((function(){e._buildResourcesUnitToObjectsUnit()}))}else this._stopUpdateBuild||this.checkBuildComplete()}},{key:"_buildResourcesUnitToObjectsUnit",value:(t=Ze.mark((function e(){var t,i,r,n;return Ze.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=(t=this).currentBuildingResourcesUnit.resources,r=new Date;case 3:if(0!==i.length){e.next=10;break}return t.currentBuildingResourcesUnit=null,t._updateBuildUnit(),e.abrupt("return");case 10:if(n=i.shift(),t.objectsBuildUnitMap.get(n).build(),!(new Date-r>this.awaitToNextBuildTime)){e.next=16;break}return e.next=16,this.awaitToNextBuild();case 16:this.checkBuildComplete();case 17:e.next=3;break;case 19:case"end":return e.stop()}}),e,this)})),i=function(){var e=t.apply(this,arguments);return new Promise((function(t,i){return function r(n,o){try{var s=e[n](o),a=s.value}catch(e){return void i(e)}if(!s.done)return Promise.resolve(a).then((function(e){r("next",e)}),(function(e){r("throw",e)}));t(a)}("next")}))},function(){return i.apply(this,arguments)})},{key:"checkBuildComplete",value:function(){for(var e=[],t=!0,i=0;i<this.objectsBuildUnits.length;i++){var r=this.objectsBuildUnits[i];r.isBuilded?e.push(r):t=!1}var n=null;0===this.objectsBuildUnits.length?(t=!0,n=1):n=e.length/this.objectsBuildUnits.length,t&&this._clearUpdateBuildUnit(),this.buildingProgressCallback&&this.buildingProgressCallback(n)}},{key:"_clearUpdateBuildUnit",value:function(){if(this.objectsBuildUnits)for(var e=0;e<this.objectsBuildUnits.length;e++){this.objectsBuildUnits[e].clear()}if(this.unreadyResourceUnits)for(var t=0;t<this.unreadyResourceUnits.length;t++){this.unreadyResourceUnits[t].clear()}if(this.readyResourceUnits)for(var i=0;i<this.readyResourceUnits.length;i++){this.readyResourceUnits[i].clear()}this.objectsBuildUnits=[],this.unreadyResourceUnits=[],this.readyResourceUnits=[],this.objectsBuildUnitMap.clear(),this._stopUpdateBuild=!0}},{key:"awaitToNextBuild",value:function(){var e=this;return new Promise((function(t){setTimeout((function(){t("resolved")}),e._awaitToNextBuildTime)}))}},{key:"requestToBuild",value:function(e){var t=this.world.findObjectByID(e);null!==t&&this.addObject(t)}},{key:"disposeObject",value:function(e){var t=this.world.findObjectByID(e);t&&t.clearBuildMesh()}},{key:"addObject",value:function(e){this.addChildren(e);var t=e.resources;if(t.length>0)for(var i=0;i<t.length;i++){var r=t[i];this.addSingleResourceObject(e,r)}else this.addSingleResourceObject(e,this._emptyResource)}},{key:"addChildren",value:function(e){for(var t=e.children,i=0;i<t.length;i++){var r=t[i];this.addObject(r)}}},{key:"addSingleResourceObject",value:function(e,t){if(t||null!=(t=e.resource)){if(!this.objectsBuildUnitMap.has(t)){var i=new Ke(t);this.objectsBuildUnits.push(i),this.objectsBuildUnitMap.set(t,i)}this.objectsBuildUnitMap.get(t).add(e)}}},{key:"clear",value:function(){this.resourceBuildManager.clear(),this._clearUpdateBuildUnit(),this._initParams()}}]),e}(),at={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),r=0;return function(){for(var n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*at.DEG2RAD},radToDeg:function(e){return e*at.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},lt=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ut=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),ct=function(){function e(t,i,r,n){lt(this,e),this._x=t||0,this._y=i||0,this._z=r||0,this._w=void 0!==n?n:1}return ut(e,[{key:"slerp",value:function(e,t,i,r){return i.copy(e).slerp(t,r)}},{key:"slerpFlat",value:function(e,t,i,r,n,o,s){var a=i[r+0],l=i[r+1],u=i[r+2],c=i[r+3],h=n[o+0],p=n[o+1],d=n[o+2],f=n[o+3];if(c!==f||a!==h||l!==p||u!==d){var m=1-s,g=a*h+l*p+u*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,s=Math.sin(s*_)/b}var x=s*v;if(a=a*m+h*x,l=l*m+p*x,u=u*m+d*x,c=c*m+f*x,m===1-s){var E=1/Math.sqrt(a*a+l*l+u*u+c*c);a*=E,l*=E,u*=E,c*=E}}e[t]=a,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"set",value:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,r=e._y,n=e._z,o=e.order,s=Math.cos,a=Math.sin,l=s(i/2),u=s(r/2),c=s(n/2),h=a(i/2),p=a(r/2),d=a(n/2);return"XYZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"YXZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"ZXY"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"ZYX"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"YZX"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c-h*p*d):"XZY"===o&&(this._x=h*u*c-l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c+h*p*d),!1!==t&&this.onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this.onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],s=i[1],a=i[5],l=i[9],u=i[2],c=i[6],h=i[10],p=r+a+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(s-n)*t):r>a&&r>h?(t=2*Math.sqrt(1+r-a-h),this._w=(c-l)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(o+u)/t):a>h?(t=2*Math.sqrt(1+a-r-h),this._w=(o-u)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-r-a),this._w=(s-n)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var i,r=new ht;return void 0===r&&(r=new ht),(i=e.dot(t)+1)<1e-6?(i=0,Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0):r.set(0,-e.z,e.y)):r.crossVectors(e,t),this._x=r.x,this._y=r.y,this._z=r.z,this._w=i,this.normalize()}},{key:"inverse",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,s=t._x,a=t._y,l=t._z,u=t._w;return this._x=i*u+o*s+r*l-n*a,this._y=r*u+o*a+n*s-i*l,this._z=n*u+o*l+i*a-r*s,this._w=o*u-i*s-r*a-n*l,this.onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,s=o*e._w+i*e._x+r*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(r+this._y),this._z=.5*(n+this._z),this;var l=Math.atan2(a,s),u=Math.sin((1-t)*l)/a,c=Math.sin(t*l)/a;return this._w=o*u+this._w*c,this._x=i*u+this._x*c,this._y=r*u+this._y*c,this._z=n*u+this._z*c,this.onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"onChange",value:function(e){return this.onChangeCallback=e,this}},{key:"onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}]),e}(),ht=function(){function e(t,i,r){lt(this,e),this.x=t||0,this.y=i||0,this.z=r||0,this.isVector3=!0}return ut(e,[{key:"set",value:function(e,t,i){return this.x=e,this.y=t,this.z=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(){var e=new ct;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}()}},{key:"applyAxisAngle",value:function(){var e=new ct;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i))}()}},{key:"applyMatrix3",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}},{key:"applyQuaternion",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*i,u=a*i+s*t-n*r,c=a*r+n*i-o*t,h=-n*t-o*i-s*r;return this.x=l*a+h*-n+u*-s-c*-o,this.y=u*a+h*-o+c*-n-l*-s,this.z=c*a+h*-s+l*-o-u*-n,this}},{key:"transformDirection",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(){var t=new e,i=new e;return function(e,r){return t.set(e,e,e),i.set(r,r,r),this.clamp(t,i)}()}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-i*e.z,this.z=i*e.y-r*e.x,this}},{key:"crossVectors",value:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this}},{key:"projectOnVector",value:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)}},{key:"projectOnPlane",value:function(){var t=new e;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}},{key:"reflect",value:function(){var t=new e;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}()}},{key:"angleTo",value:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(at.clamp(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this}},{key:"setFromCylindrical",value:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}]),e}(),pt=function(){function e(t,i){lt(this,e),this.isBox3=!0,this.min=void 0!==t?t:new ht(1/0,1/0,1/0),this.max=void 0!==i?i:new ht(-1/0,-1/0,-1/0)}return ut(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,l=e.length;a<l;a+=3){var u=e[a],c=e[a+1],h=e[a+2];u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,i,r),this.max.set(n,o,s),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,l=e.count;a<l;a++){var u=e.getX(a),c=e.getY(a),h=e.getZ(a);u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,i,r),this.max.set(n,o,s),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var i=(new ht).copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){var t=e||new ht;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){var t=e||new ht;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=new ht,i=this;return e.updateMatrixWorld(!0),e.traverse((function(e){var r,n,o=e.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(r=0,n=s.length;r<n;r++)t.copy(s[r]),t.applyMatrix4(e.matrixWorld),i.expandByPoint(t)}else if(o.isBufferGeometry){var a=o.attributes.position;if(void 0!==a)for(r=0,n=a.count;r<n;r++)t.fromBufferAttribute(a,r).applyMatrix4(e.matrixWorld),i.expandByPoint(t)}})),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return(t||new ht).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsPlane",value:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=e.constant&&i>=e.constant}},{key:"clampPoint",value:function(e,t){return(t||new ht).copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return(new ht).copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){var t=[new ht,new ht,new ht,new ht,new ht,new ht,new ht,new ht];return this.isEmpty()||(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();function dt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(dt.prototype,{isMatrix4:!0,set:function(e,t,i,r,n,o,s,a,l,u,c,h,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new dt).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(){var e=new ht;return function(t){var i=this.elements,r=t.elements,n=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),s=1/e.setFromMatrixColumn(t,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[4]=r[4]*o,i[5]=r[5]*o,i[6]=r[6]*o,i[8]=r[8]*s,i[9]=r[9]*s,i[10]=r[10]*s,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,o=Math.cos(i),s=Math.sin(i),a=Math.cos(r),l=Math.sin(r),u=Math.cos(n),c=Math.sin(n);if("XYZ"===e.order){var h=o*u,p=o*c,d=s*u,f=s*c;t[0]=a*u,t[4]=-a*c,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-s*a,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*a}else if("YXZ"===e.order){var m=a*u,g=a*c,v=l*u,y=l*c;t[0]=m+y*s,t[4]=v*s-g,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-s,t[2]=g*s-v,t[6]=y+m*s,t[10]=o*a}else if("ZXY"===e.order){m=a*u,g=a*c,v=l*u,y=l*c;t[0]=m-y*s,t[4]=-o*c,t[8]=v+g*s,t[1]=g+v*s,t[5]=o*u,t[9]=y-m*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){h=o*u,p=o*c,d=s*u,f=s*c;t[0]=a*u,t[4]=d*l-p,t[8]=h*l+f,t[1]=a*c,t[5]=f*l+h,t[9]=p*l-d,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){var b=o*a,_=o*l,x=s*a,E=s*l;t[0]=a*u,t[4]=E-b*c,t[8]=x*c+_,t[1]=c,t[5]=o*u,t[9]=-s*u,t[2]=-l*u,t[6]=_*c+x,t[10]=b-E*c}else if("XZY"===e.order){b=o*a,_=o*l,x=s*a,E=s*l;t[0]=a*u,t[4]=-c,t[8]=l*u,t[1]=b*c+E,t[5]=o*u,t[9]=_*c-x,t[2]=x*c-_,t[6]=s*u,t[10]=E*c+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e._x,r=e._y,n=e._z,o=e._w,s=i+i,a=r+r,l=n+n,u=i*s,c=i*a,h=i*l,p=r*a,d=r*l,f=n*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(p+f),t[4]=c-v,t[8]=h+g,t[1]=c+v,t[5]=1-(u+f),t[9]=d-m,t[2]=h-g,t[6]=d+m,t[10]=1-(u+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new ht,t=new ht,i=new ht;return function(r,n,o){var s=this.elements;return i.subVectors(r,n),0===i.lengthSq()&&(i.z=1),i.normalize(),e.crossVectors(o,i),0===e.lengthSq()&&(1===Math.abs(o.z)?i.x+=1e-4:i.z+=1e-4,i.normalize(),e.crossVectors(o,i)),e.normalize(),t.crossVectors(i,e),s[0]=e.x,s[4]=t.x,s[8]=i.x,s[1]=e.y,s[5]=t.y,s[9]=i.y,s[2]=e.z,s[6]=t.z,s[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],u=i[1],c=i[5],h=i[9],p=i[13],d=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],_=i[15],x=r[0],E=r[4],w=r[8],T=r[12],M=r[1],C=r[5],S=r[9],j=r[13],P=r[2],R=r[6],D=r[10],A=r[14],k=r[3],O=r[7],B=r[11],F=r[15];return n[0]=o*x+s*M+a*P+l*k,n[4]=o*E+s*C+a*R+l*O,n[8]=o*w+s*S+a*D+l*B,n[12]=o*T+s*j+a*A+l*F,n[1]=u*x+c*M+h*P+p*k,n[5]=u*E+c*C+h*R+p*O,n[9]=u*w+c*S+h*D+p*B,n[13]=u*T+c*j+h*A+p*F,n[2]=d*x+f*M+m*P+g*k,n[6]=d*E+f*C+m*R+g*O,n[10]=d*w+f*S+m*D+g*B,n[14]=d*T+f*j+m*A+g*F,n[3]=v*x+y*M+b*P+_*k,n[7]=v*E+y*C+b*R+_*O,n[11]=v*w+y*S+b*D+_*B,n[15]=v*T+y*j+b*A+_*F,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new ht;return function(t){for(var i=0,r=t.count;i<r;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix4(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],s=e[5],a=e[9],l=e[13],u=e[2],c=e[6],h=e[10],p=e[14];return e[3]*(+n*a*c-r*l*c-n*s*h+i*l*h+r*s*p-i*a*p)+e[7]*(+t*a*p-t*l*h+n*o*h-r*o*p+r*l*u-n*a*u)+e[11]*(+t*l*c-t*s*p-n*o*c+i*o*p+n*s*u-i*l*u)+e[15]*(-r*s*u-t*a*c+t*s*h+r*o*c-i*o*h+i*a*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],o=r[1],s=r[2],a=r[3],l=r[4],u=r[5],c=r[6],h=r[7],p=r[8],d=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],b=r[15],_=d*y*h-v*f*h+v*c*m-u*y*m-d*c*b+u*f*b,x=g*f*h-p*y*h-g*c*m+l*y*m+p*c*b-l*f*b,E=p*v*h-g*d*h+g*u*m-l*v*m-p*u*b+l*d*b,w=g*d*c-p*v*c-g*u*f+l*v*f+p*u*y-l*d*y,T=n*_+o*x+s*E+a*w;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var C=1/T;return i[0]=_*C,i[1]=(v*f*a-d*y*a-v*s*m+o*y*m+d*s*b-o*f*b)*C,i[2]=(u*y*a-v*c*a+v*s*h-o*y*h-u*s*b+o*c*b)*C,i[3]=(d*c*a-u*f*a-d*s*h+o*f*h+u*s*m-o*c*m)*C,i[4]=x*C,i[5]=(p*y*a-g*f*a+g*s*m-n*y*m-p*s*b+n*f*b)*C,i[6]=(g*c*a-l*y*a-g*s*h+n*y*h+l*s*b-n*c*b)*C,i[7]=(l*f*a-p*c*a+p*s*h-n*f*h-l*s*m+n*c*m)*C,i[8]=E*C,i[9]=(g*d*a-p*v*a-g*o*m+n*v*m+p*o*b-n*d*b)*C,i[10]=(l*v*a-g*u*a+g*o*h-n*v*h-l*o*b+n*u*b)*C,i[11]=(p*u*a-l*d*a-p*o*h+n*d*h+l*o*m-n*u*m)*C,i[12]=w*C,i[13]=(p*v*s-g*d*s+g*o*f-n*v*f-p*o*y+n*d*y)*C,i[14]=(g*u*s-l*v*s-g*o*c+n*v*c+l*o*y-n*u*y)*C,i[15]=(l*d*s-p*u*s+p*o*c-n*d*c-l*o*f+n*u*f)*C,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,s=e.y,a=e.z,l=n*o,u=n*s;return this.set(l*o+i,l*s-r*a,l*a+r*s,0,l*s+r*a,u*s+i,u*a-r*o,0,l*a-r*s,u*a+r*o,n*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e=new ht,t=new dt;return function(i,r,n){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),i.x=o[12],i.y=o[13],i.z=o[14],t.copy(this);var u=1/s,c=1/a,h=1/l;return t.elements[0]*=u,t.elements[1]*=u,t.elements[2]*=u,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,r.setFromRotationMatrix(t),n.x=s,n.y=a,n.z=l,this}}(),makePerspective:function(e,t,i,r,n,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,a=2*n/(t-e),l=2*n/(i-r),u=(t+e)/(t-e),c=(i+r)/(i-r),h=-(o+n)/(o-n),p=-2*o*n/(o-n);return s[0]=a,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(e,t,i,r,n,o){var s=this.elements,a=1/(t-e),l=1/(i-r),u=1/(o-n),c=(t+e)*a,h=(i+r)*l,p=(o+n)*u;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}});!function(){function e(t,i){lt(this,e),this.x=t||0,this.y=i||0,this.isVector2=!0}ut(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(){var t=new e,i=new e;return function(e,r){return t.set(e,e),i.set(r,r),this.clamp(t,i)}()}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}},{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}}])}();var ft="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},mt=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},gt=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),vt=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},yt=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},bt=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},_t={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},xt=function(){function e(){mt(this,e)}return gt(e,null,[{key:"uuid",value:function(){for(var e,t=_t.chars,i=_t.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":ft(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}},{key:"calTwoPositionLength",value:function(t,i){var r=e.subPosition(t,i);return r=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],Math.sqrt(r)}},{key:"subPosition",value:function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}},{key:"normalizeDirection",value:function(t){var i=e.calTwoPositionLength([0,0,0],t);if(1===i)return t;var r=t;return 0===i?(r[0]=0,r[1]=0,r[2]=0,r):(i=1/i,r[0]*=i,r[1]*=i,r[2]*=i,r)}}]),e}(),Et=function(){function e(){mt(this,e),this.type="BaseObject",this._initParams(),this.calculaterData={},this.objectsMap=null}return gt(e,[{key:"_initParams",value:function(){this.id=xt.uuid(),this.name=null,this.userID=null,this.properties=null,this.resource=null,this._resources=null,this.position=[0,0,0],this.rotation=[0,0,0,1],this.scale=[1,1,1],this._parent=null,this.children=[],this.typeToChildren={},this.lowerCaseProperties=null,this.visible=!0,this.mesh=null,this.calculater=null,this.meshBuilder=null,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.selfBuildCompleteCallbacks=[],this.selfBuildCompleteCallbackParams=[],this._isCalculated=!1,this._isMeshBuilded=!1,this._isChildrenBuilded=!1,this._isSelfBuilded=!1,this._isBuiled=!1,this._size=null,this._box3=null,this._selfSize=null,this._center=null,this._isBuiled=!1,this._isRequestResource=!1,this._isNotifyListeners=!1,this.objectsMap=null}},{key:"_getCalculateSizeObjects",value:function(){return this.children}},{key:"_addChild",value:function(e){this.children.push(e),this.typeToChildren[e.type]||(this.typeToChildren[e.type]=[]),this.typeToChildren[e.type].push(e),e.registerBuildCallbackListener(this._childBuildCallback,{obj:this})}},{key:"_childBuildCallback",value:function(e,t){var i=t.obj;i.children.every((function(e){return e.isBuilded}))&&(i._isChildrenBuilded=!0),i.isChildrenBuilded&&i.isSelfBuilded&&(i._isBuiled=!0),i.isBuilded&&i.notifyBuildCompleteListeners()}},{key:"_getChildrenByType",value:function(e){return this.typeToChildren[e]?this.typeToChildren[e]:[]}},{key:"_removeChild",value:function(e){var t=this.children.indexOf(e);t>-1&&this.children.splice(t,1),(t=this.typeToChildren[e.type].indexOf(e))>-1&&this.typeToChildren[e.type].splice(t,1),e.removeBuildCallbackListener(this._childBuildCallback)}},{key:"build",value:function(e){e&&this.registerBuildCallbackListener(e),this.isBuilded||(this.isResourcesBuilded?(this.buildSelf(),this.buildChildren(),this.isChildrenBuilded&&this.notifyBuildCompleteListeners()):this._initResources())}},{key:"calculate",value:function(){this.calculater&&this.calculater.build(this)}},{key:"createMesh",value:function(){if(this.meshBuilder)return this.meshBuilder.build(this)}},{key:"_initResources",value:function(){if(!this._isRequestResource){for(var e=0;e<this.resources.length;e++){var t=this.resources[e];t.isBuilded||(t.registerBuildCallbackListener(this._resourceBuildedCallback,{object:this}),t.build())}this._isRequestResource=!0}}},{key:"_resourceBuildedCallback",value:function(e,t){var i=t.object;e.isBuilded&&i.build()}},{key:"buildSelf",value:function(){this._buildSelf(),this.isSelfBuilded&&this.notifySelfBuildCompleteListeners()}},{key:"_buildSelf",value:function(){this.isSelfBuilded||(this._isCalculated||(this.calculate(),this._isCalculated=!0),this._isMeshBuilded||(this.createMesh(),this._isMeshBuilded=!0),this._isSelfBuilded=!0,this.isChildrenBuilded&&(this._isBuiled=!0),this.isBuilded&&this.notifyBuildCompleteListeners())}},{key:"buildChildren",value:function(){this._buildChildren()}},{key:"_buildChildren",value:function(){if(!this.isChildrenBuilded)for(var e=0;e<this.children.length;e++){this.children[e].build()}}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"registerSelfBuildCallbackListener",value:function(e,t){this.selfBuildCompleteCallbacks.push(e),this.selfBuildCompleteCallbackParams.push(t)}},{key:"removeBuildCallbackListener",value:function(){}},{key:"notifyBuildCompleteListeners",value:function(){if(!this._isNotifyListeners){for(var e=0;e<this.buildCompleteCallbacks.length;e++){(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}this._isNotifyListeners=!0}}},{key:"notifySelfBuildCompleteListeners",value:function(){for(var e=0;e<this.selfBuildCompleteCallbacks.length;e++){(0,this.selfBuildCompleteCallbacks[e])(this,this.selfBuildCompleteCallbackParams[e])}}},{key:"findObjectByID",value:function(e){return this.objectsMap||(this.objectsMap={},this.collectObjectsToMap(this)),null!=e&&""!==e?this.objectsMap[e]:null}},{key:"collectObjectsToMap",value:function(e){this.objectsMap[e.id]=e;for(var t=0;t<e.children.length;t++){var i=e.children[t];this.collectObjectsToMap(i)}}},{key:"findObjectByUserID",value:function(e){if(!e)return null;if(this.userID===e)return this;if(this.children)for(var t=0;t<this.children.length;t++){var i=this.children[t];if(i.userID===e)return i;var r=i.findObjectByUserID(e);if(r)return r}return null}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){this.children[e].clear()}this.clearBuildMesh(),this.calculater=null,this.meshBuilder=null,this._initParams(),this.id=null}},{key:"clearBuildMesh",value:function(){this.meshBuilder&&this.meshBuilder.clear(this.mesh),this._isMeshBuilded=!1,this._isSelfBuilded=!1,this.mesh=null,this._isBuiled=!1,this._isNotifyListeners=!1}},{key:"deepClone",value:function(e){var t=Array.isArray(e)?[]:{};if(e&&"object"===(void 0===e?"undefined":ft(e)))for(var i in e)e.hasOwnProperty(i)&&(t[i]=e&&"object"===ft(e[i])?this.deepClone(e[i]):e[i]);return t}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){return null===this._selfSize?[0,0,0]:this._selfSize}},{key:"center",get:function(){if(null===this._center){if(!this.size||!this._box3)return[0,0,0];this._center=this._box3.getCenter().toArray()}return this._center}},{key:"size",set:function(e){this._size=e,0===this.children.length&&(this.selfSize=e)},get:function(){if(null===this._size)if(this.children.length>0){if(this._box3=new pt,0!==this.selfSize[0]&&0!==this.selfSize[1]&&0!==this.selfSize[2]){var e=new ht(this.position[0],this.position[1],this.position[2]);e.y+=this.selfSize[1]/2,this._box3.setFromCenterAndSize(e,new ht(this.selfSize[0],this.selfSize[1],this.selfSize[2]))}for(var t=this._getCalculateSizeObjects(),i=0;i<t.length;i++){var r=t[i];r.size&&r._box3&&this._box3.union(r._box3)}this._size=this._box3.getSize().toArray()}else this._size=this.selfSize;return this._size}},{key:"parent",get:function(){return this._parent},set:function(e){this._parent!==e&&(null!==this._parent&&this._parent._removeChild(this),null!=e&&(this._parent=e,this._parent&&this._parent._addChild(this)))}},{key:"isContainer",get:function(){return this.children.length>0}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource)),this._resources}},{key:"isBuilded",get:function(){return this._isBuiled}},{key:"isSelfBuilded",get:function(){return this._isSelfBuilded}},{key:"isChildrenBuilded",get:function(){return!this.isContainer||(!(this.children.length>0)||this._isChildrenBuilded)}},{key:"isResourcesBuilded",get:function(){for(var e=0;e<this.resources.length;e++){if(!this.resources[e].isBuilded)return!1}return!0}}]),e}(),wt={StraightManualWall:"StraightManualWall",ModelWall:"ModelWall",WallCorner:"WallCorner",FloorPlan:"FloorPlan",Facade:"Facade",Building:"Building",Outdoors:"Outdoors",Room:"Room",CombineStraightManualWall:"CombineStraightManualWall",Floor:"Floor",Ceiling:"Ceiling",Roof:"Roof",CombineDoorOrWindow:"CombineDoorOrWindow",CombinePlacement:"CombinePlacement",CombinePlacementWall:"CombinePlacementWall",Placement:"Placement",PlacementGroup:"PlacementGroup",CombineFloor:"CombineFloor",CombineCeiling:"CombineCeiling",CombineRoof:"CombineRoof",CombineModelWall:"CombineModelWall",CombinePlacementGroup:"CombinePlacementGroup",PlacementWall:"PlacementWall",PlacementGround:"PlacementGround",VideoProbe:"VideoProbe",CurveLine:"CurveLine",LeakWaterLine:"LeakWaterLine",ArrowLine:"ArrowLine",ArrowDataLine:"ArrowDataLine",RouteLine:"RouteLine",Text3D:"Text3D"},Tt=function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.dataJson=e,i.type="Room",i}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.dataJson=null,this.holePaths=[],this._points=[],this._holes=[],this._uv2=[],this.offset=null,this.parentPosition=null,this._floor=null,this._roof=null,this._ceiling=null,this.floorResource=null,this.ceilingResource=null,this.roofResource=null,this.isOnlyFloor=!1}},{key:"clear",value:function(){this.floor&&this.floor.clear(),this.roof&&this.roof.clear(),this.ceiling&&this.ceiling.clear(),vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"floor",get:function(){return null===this._floor&&this.typeToChildren[wt.Floor]&&(this._floor=this.typeToChildren[wt.Floor][0]),this._floor}},{key:"ceiling",get:function(){return null===this._ceiling&&this.typeToChildren[wt.Ceiling]&&(this._ceiling=this.typeToChildren[wt.Ceiling][0]),this._ceiling}},{key:"roof",get:function(){return null===this._roof&&this.typeToChildren[wt.Roof]&&(this._roof=this.typeToChildren[wt.Roof][0]),this._roof}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource)),this._resources}},{key:"points",set:function(e){this._points=e},get:function(){return this._points}},{key:"holes",set:function(e){this._holes=e},get:function(){return this._holes}}]),t}(Et),Mt=function e(){mt(this,e)};Mt.StraightManualWallHeight=3,Mt.StraightManualWallThick=.15,Mt.enableDelayLoadMode=!0,Mt.enableManaulWallLightMap=!0,Mt.enableFloorLightMap=!0,Mt.wallLightMapIntensity=3.8,Mt.enableUseHighestVersionResource=!0,Mt.enableCombine=!0,Mt.ableToSupportFootAndHeadModelWalls=["C9FB3F9A29C842F79F02CECC4037FEA1"];var Ct=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Ceiling",e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.blockSize=[.6,.6],this.blockAngle=0,this.DefaultHeight=2.9,this.height=this.DefaultHeight}},{key:"size",get:function(){return null===this._size&&(this._size=[0,0,0]),this._size},set:function(e){this._size=e}}]),t}(Et),St=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Roof",e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.DefaultHeight=3,this.height=this.DefaultHeight,this.blockSize=[2,2],this.blockAngle=0}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}}]),t}(Et),jt=function e(){mt(this,e)};jt.wallTexture=null,jt.wallEdgeTexture=null,jt.floorTexture=null,jt.ceilingTexture=null,jt.roofTexture=null,jt.wallLigthMapTexture=null,jt.floorLightMapTexture=null,jt.wallMaterial=null,jt.wallEdgeMaterial=null,jt.floorMaterial=null,jt.ceilingMaterial=null,jt.roofMaterial=null;var Pt=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Floor",e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.blockSize=[.6,.6],this.blockAngle=0,this.DefaultHeight=.01,this.height=this.DefaultHeight}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}}]),t}(Et),Rt=function(e){function t(){return mt(this,t),bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._startCorner=null,this._endCorner=null,this.thick=-1,this.height=-1,this._length=null,this._direction=null,this.doorOrWindows=[],this.suspend=0,this._position=null}},{key:"getWallOtherCorner",value:function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null}},{key:"startCorner",get:function(){return this._startCorner},set:function(e){this._startCorner=e,this._startCorner&&this._startCorner.addWall(this)}},{key:"endCorner",get:function(){return this._endCorner},set:function(e){this._endCorner=e,this._endCorner&&this._endCorner.addWall(this)}},{key:"position",get:function(){if(!this._position){var e=this.startCorner.position,t=this.endCorner.position;this._position=[(t[0]+e[0])/2,(t[1]+e[1])/2,(t[2]+e[2])/2]}return this._position},set:function(e){this._position=e}},{key:"length",get:function(){return null===this._length&&(this._length=xt.calTwoPositionLength(this.startCorner.position,this.endCorner.position)),this._length}},{key:"direction",get:function(){return null===this._direction&&(this._direction=xt.subPosition(this.endCorner.position,this.startCorner.position),xt.normalizeDirection(this._direction)),this._direction}}]),t}(Et),Dt=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="ModelWall",e}return yt(t,e),t}(Rt),At=function(e){function t(e,i,r){mt(this,t);var n=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.type="WallCorner",n}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.walls=[],this.position=null}},{key:"addWall",value:function(e){for(var t=0,i=this.walls.length;t<i;t++)if(this.walls[t]===e)return void console.error("repeat wall"+e);this.walls.push(e)}},{key:"clearMesh",value:function(){for(var e=0;e<this.walls.length;e++){this.walls[e].clearMesh()}vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clearMesh",this).call(this)}}]),t}(Et),kt=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Building",e.structShow=!1,e}return yt(t,e),gt(t,[{key:"floorplans",get:function(){return this._getChildrenByType(wt.FloorPlan)}},{key:"facades",get:function(){return this._getChildrenByType(wt.Facade)}}]),t}(Et),Ot=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="CurveLine",e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.points=[],this.resource=null,this.color=null,this.width=null,this.enableMaterialAnimation=!1,this.materialAnimationSpeed=1,this.textureTiling=[1,1],this.textureOffset=[0,0]}}]),t}(Et),Bt=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="ArrowLine",e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.arrowResource=null,this.arrowWidth=null,this.arrowHeight=null,this._resources=null}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource),this.arrowResource&&this._resources.push(this.arrowResource)),this._resources}}]),t}(Ot),Ft=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="ArrowDataLine",e}return yt(t,e),t}(Bt),Lt=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Placement",e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.model=null,this.customColor=null,this.opacity=null,this.renderMode=null,this.customTextureResource=null,this.isPlayAnim=!1,this.animClip=null,this.belongRoomUserID=null}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource),this.customTextureResource&&this._resources.push(this.customTextureResource)),this._resources}},{key:"size",set:function(e){this._size=e},get:function(){if(null===this._size&&(this.modelSize=this.resource.size,this._size=[this.modelSize[0]*this.scale[0],this.modelSize[1]*this.scale[1],this.modelSize[2]*this.scale[2]]),null===this._box3){this._box3=new pt;var e=new ht(this.position[0],this.position[1],this.position[2]);e.y+=this._size[1]/2,this._box3.setFromCenterAndSize(e,new ht(this._size[0],this._size[1],this._size[2]))}return this._size}}]),t}(Et),It=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Facade",e}return yt(t,e),t}(Lt),Nt=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="DoorOrWindow",e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.suspendPercent=0,this.attachWall=null,this.isOpen=!1,this.openDirIndex=0,this.isWindow=!1}}]),t}(Lt),Ut=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="PlacementGroup",e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.groups=[],this.placements=[],this.belongRoomUserID=null,this._resourcesMap={}}},{key:"_addChild",value:function(e){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_addChild",this).call(this,e),e.type===wt.Placement?this.placements.push(e):e.type===wt.PlacementGroup&&this.groups.push(e)}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){return null===this._selfSize&&(this._selfSize=[0,0,0]),this._selfSize}},{key:"belongRoomUserID",set:function(e){this._belongRoomUserID=e;for(var t=0;t<this.placements.length;t++){this.placements[t].belongRoomUserID=e}for(var i=0;i<this.groups.length;i++){this.groups[i].belongRoomUserID=e}},get:function(){return this._belongRoomUserID}},{key:"resources",get:function(){if(null===this._resources){this._resources=[];for(var e=0;e<this.children.length;e++)for(var t=this.children[e],i=0;i<t.resources.length;i++){var r=t.resources[i];this._resourcesMap[r.id]||(this._resources.push(r),this._resourcesMap[r.id]=r)}}return this._resources}}]),t}(Et),zt=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="FacadeGroup",e}return yt(t,e),t}(Ut),Ht=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="FloorPlan",e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.height=3,this.alwaysShowInsideObjs=!1}},{key:"existsCorner",value:function(e,t,i){var r=this.typeToChildren[wt.WallCorner];if(r)for(var n=0,o=r.length;n<o;n++){var s=r[n].position;if(s.x===e&&s.y===t&&s.z===i)return!0}return!1}},{key:"addCorner",value:function(e,t,i){var r=new WallCorner(e,t,i);return r.parent=this,r}},{key:"getCorner",value:function(e,t,i){for(var r=0,n=this.corners.length;r<n;r++){var o=this.corners[r].position;if(o.x===e&&o.y===t&&o.z===i)return this.corners[r]}return null}},{key:"calRoomsUV2",value:function(){}},{key:"_fillUV2ToRooms",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=this._calFloorUV2(r,t);this._fillUV2ToFloor(r,n)}}},{key:"_calFloorUV2",value:function(e,t){var i=[],r=new THREE.Vector2;t.getSize(r);for(var n=e.floor.geometry.vertices,o=this._getFloorPosition(e),s=0;s<n.length;s++){var a=n[s].clone();a.x+=o.x,a.y+=o.z;var l=(a.x-t.min.x)/r.x,u=(a.y-t.min.y)/r.y;i.push(new THREE.Vector2(parseFloat(l.toFixed(2)),parseFloat(u.toFixed(2))))}return i}},{key:"_fillUV2ToFloor",value:function(e,t){for(var i=e.floor.geometry.faces,r=[],n=0;n<i.length;n++){var o=i[n],s=[t[o.a],t[o.b],t[o.c]];r.push(s)}e.uv2=r}},{key:"_calAllFloorBox2",value:function(e){for(var t=new THREE.Box2,i=0;i<e.rooms.length;i++){var r=e.rooms[i];null===r.floor.geometry&&r.floor.calGeometry();for(var n=this._getFloorPosition(r),o=r.floor.geometry.vertices,s=0;s<o.length;s++){var a=o[s].clone();a.x+=n.x,a.y+=n.z,t.expandByPoint(a)}}return t}},{key:"_getFloorPosition",value:function(e){var t=e.position.clone();return t.z=-t.z,t}},{key:"_getCalculateSizeObjects",value:function(){for(var e=[],t=0;t<this.children.length;t++){var i=this.children[t];-1!==i.type.indexOf("Wall")&&e.push(i)}return e}},{key:"placements",get:function(){return this._getChildrenByType(wt.Placement)}},{key:"corners",get:function(){return this._getChildrenByType(wt.WallCorner)}},{key:"walls",get:function(){return this._getChildrenByType(wt.ModelWall).concat(this._getChildrenByType(wt.StraightManualWall)).concat(this._getChildrenByType(wt.PlacementWall))}},{key:"rooms",get:function(){return this._getChildrenByType(wt.Room)}},{key:"groups",get:function(){return this._getChildrenByType(wt.PlacementGroup)}},{key:"placementGrounds",get:function(){return this._getChildrenByType(wt.PlacementGround)}},{key:"videoprobes",get:function(){return this._getChildrenByType(wt.VideoProbe)}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){return null===this._selfSize&&(this._selfSize=[0,0,0]),this._selfSize}}]),t}(Et),Vt=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Outdoors",e}return yt(t,e),t}(Ht),Wt=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="PipeLine",e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.points=[],this.resource=null,this.color=[0,0,1],this.renderMode=null,this.opacity=null,this.radius=null,this.sectionType=null,this.enableMaterialAnimation=!1,this.materialAnimationSpeed=1,this.textureTiling=[.5,.5],this.textureOffset=[0,0]}}]),t}(Et),Gt=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="LeakWaterLine",e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.radius=.2,this.color=[1,1,1],this.alarmLength=null}},{key:"clear",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this,e),this.radius=.2,this.color=null,this.alarmLength=null}}]),t}(Wt),qt=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.text=null,e.color=null,e.fontSize=null,e.opacity=null,e.mesh=null,e.type="Text3D",e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.text=null,this.color=null,this.fontSize=null,this.opacity=null,this.mesh=null}}]),t}(Et),Xt=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="VideoProbe",e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.ascept=null,this.field=null,this.probeLength=null,this.pitch=null}}]),t}(Lt),Jt=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="World",e}return yt(t,e),gt(t,[{key:"clear",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this,e),this.outdoors=null,this.buildings=[]}},{key:"buildings",get:function(){return this._getChildrenByType(wt.Building)}},{key:"ourdoors",get:function(){return this._getChildrenByType(wt.Outdoors)[0]}}]),t}(Et),Yt=new function e(){mt(this,e),this.isDebug=!1,this.isTesting=!1},Zt=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="RouteLine",e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.color=[0,0,1]}},{key:"clear",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this,e),this.color=null}}]),t}(Ot),Qt=function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="PlacementWall",i}return yt(t,e),t}(Lt),Kt=function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="PlacementGround",e}return yt(t,e),t}(Lt),$t=function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=wt.StraightManualWall,i}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.leftResource=null,this.rightResource=null,this.edgeResource=null,this.uvMultiple=[1,1],this.lightUV=null,this.topOffset=null,this.suspend=0,this.thick=.25,this.height=3}},{key:"selfSize",get:function(){if(null===this._selfSize){this._box3=new pt;for(var e=[this.startCorner,this.endCorner],t=0;t<e.length;t++){var i=e[t].position,r=new ht(i[0],i[1],i[2]);this._box3.expandByPoint(r),(r=r.clone()).y=this.parent.height,this._box3.expandByPoint(r)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.leftResource&&this._resources.push(this.leftResource),this.rightResource&&this._resources.push(this.rightResource),this.edgeResource&&this._resources.push(this.edgeResource)),this._resources}}]),t}(Rt),ei=function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.objects=[],i}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.objects=[]}},{key:"_buildSelf",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_buildSelf",this).call(this)}},{key:"clear",value:function(){for(var e=0;e<this.objects.length;e++){this.objects[e].clear()}vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(Et),ti=function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="CombineStraightManualWall",i}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.walls=[],this.leftWallResourceMap=new Map,this.rightWallResourceMap=new Map,this.corners=[],this._resourceDic={},this._resources=[]}},{key:"addObject",value:function(e){this.walls.push(e),this.leftWallResourceMap.has(e.leftResource)||this.leftWallResourceMap.set(e.leftResource,[]),this.rightWallResourceMap.has(e.rightResource)||this.rightWallResourceMap.set(e.rightResource,[]),this.leftWallResourceMap.get(e.leftResource).push(e),this.rightWallResourceMap.get(e.rightResource).push(e),this.addCorner(e.startCorner),this.addCorner(e.endCorner);for(var t=e.resources,i=0;i<t.length;i++){var r=t[i];this._resourceDic[r.id]||(this._resources.push(r),this._resourceDic[r.id]=r)}}},{key:"addCorner",value:function(e){for(var t=0;t<this.corners.length;t++){if(this.corners[t]===e)return}this.corners.push(e)}},{key:"_addResource",value:function(){}},{key:"clear",value:function(){for(var e=0;e<this.walls.length;e++){this.walls[e].clear()}for(var i=0;i<this.corners.length;i++){var r=this.corners[i];0===r.walls.length&&r.clear()}vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"selfSize",get:function(){if(null===this._selfSize){this._box3=new pt;for(var e=0;e<this.corners.length;e++){var t=this.corners[e].position,i=new ht(t[0],t[1],t[2]);this._box3.expandByPoint(i),(i=i.clone()).y=this.parent.height,this._box3.expandByPoint(i)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}}]),t}(ei),ii=function(){function e(){mt(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return gt(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),ri=function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=wt.CombinePlacement,i}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.objects=[],this.belongRoomUserID=null,this.transformations=[]}},{key:"addObject",value:function(e){this.objects.push(e);var t=new ii;t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),this.transformations.push(t)}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){if(null===this._selfSize){this._box3=new pt;for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t.size&&this._box3.union(t._box3)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}}]),t}(ei),ni={World:Jt,Building:kt,FloorPlan:Ht,Room:Tt,Floor:Pt,Ceiling:Ct,Roof:St,StraightManualWall:$t,ModelWall:Dt,WallCorner:At,Placement:Lt,PlacementGroup:Ut,DoorOrWindow:Nt,Outdoors:Vt,Facade:It,FacadeGroup:zt,VideoProbe:Xt,CurveLine:Ot,LeakWaterLine:Gt,ArrowLine:Bt,ArrowDataLine:Ft,RouteLine:Zt,PipeLine:Wt,PlacementWall:Qt,PlacementGround:Kt,CombineStraightManualWall:ti,CombineDoorOrWindow:function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="CombineDoorOrWindow",i}return yt(t,e),t}(ri),CombinePlacement:ri,CombineFloor:function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type=wt.CombineFloor,e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._height=.01,this.rotation=[-.7071067811865475,-0,-0,.7071067811865476],this.position[1]=this._height}},{key:"addObject",value:function(e){this.objects.push(e)}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}},{key:"height",set:function(e){this._height=e,this.position[1]=this._height},get:function(){return this._height}}]),t}(ei),CombineCeiling:function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type=wt.CombineCeiling,e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._height=3,this.rotation=[.7071067811865475,-0,-0,.7071067811865476],this.position[1]=this._height}},{key:"addObject",value:function(e){this.objects.push(e)}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}},{key:"height",set:function(e){this._height=e,this.position[1]=this._height},get:function(){return this._height}}]),t}(ei),CombineRoof:function(e){function t(){mt(this,t);var e=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type=wt.CombineRoof,e}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._height=3,this.rotation=[-.7071067811865475,-0,-0,.7071067811865476],this.position[1]=this._height+.005}},{key:"addObject",value:function(e){this.objects.push(e)}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}},{key:"height",set:function(e){this._height=e,this.position[1]=this._height+.005},get:function(){return this._height}}]),t}(ei),CombineModelWall:function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=wt.CombineModelWall,i}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.walls=[],this.corners=[]}},{key:"addObject",value:function(e){this.walls.push(e),this.addCorner(e.startCorner),this.addCorner(e.endCorner)}},{key:"addCorner",value:function(e){this.corners.push(e)}},{key:"clear",value:function(){for(var e=0;e<this.walls.length;e++){this.walls[e].clear()}for(var i=0;i<this.corners.length;i++){var r=this.corners[i];0===r.walls.length&&r.clear()}vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){if(null===this._selfSize){this._box3=new pt;for(var e=0;e<this.corners.length;e++){var t=this.corners[e].position,i=new ht(t[0],t[1],t[2]);this._box3.expandByPoint(i),(i=i.clone()).y=this.parent.height,this._box3.expandByPoint(i)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}}]),t}(ei),CombinePlacementGroup:function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=wt.CombinePlacementGroup,i}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.belongRoomUserID=null,this.transformations=[],this._resourcesMap={}}},{key:"addObject",value:function(e){this.objects.push(e);var t=new ii;t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),this.transformations.push(t)}},{key:"selfSize",get:function(){if(null===this._selfSize){if(!(this.objects.length>0))return[0,0,0];this._box3=new pt;for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t.size&&this._box3.union(t._box3)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}},{key:"resources",get:function(){if(null===this._resources){this._resources=[];for(var e=0;e<this.objects.length;e++)for(var t=this.objects[e],i=0;i<t.resources.length;i++){var r=t.resources[i];this._resourcesMap[r.id]||(this._resources.push(r),this._resourcesMap[r.id]=r)}}return this._resources}}]),t}(ei),CombinePlacementWall:function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=wt.CombinePlacementWall,i}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.belongRoomUserID=null,this.transformations=[]}},{key:"addObject",value:function(e){this.objects.push(e);var t=new ii;t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),this.transformations.push(t)}},{key:"selfSize",get:function(){if(null===this._selfSize){this._box3=new pt;for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t.size&&this._box3.union(t._box3)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}}]),t}(ei),Text3D:qt},oi=function(){function e(){mt(this,e),this.objects=[],this.calculaterManager=null,this.meshBuilderManager=null,this.ClassName=wt}return gt(e,[{key:"create",value:function(e){var t=e.type,i=e.parent,r=new(0,ni[t]);return r.parent=i,this.calculaterManager&&(r.calculater=this.calculaterManager.create({type:t,object:r})),this.meshBuilderManager&&(r.meshBuilder=this.meshBuilderManager.create({type:t,object:r})),r}},{key:"registerObjectClass",value:function(e,t){ni[e]=t}},{key:"unregisterObjectClass",value:function(e){ni[e]=null}},{key:"containObjectClass",value:function(e){return!!ni[e]}},{key:"clear",value:function(){this.objects=null,this.calculaterManager=null,this.meshBuilderManager=null}}]),e}(),si=(new oi,function(){function e(t){mt(this,e),this._initParams(),this.manager=t.manager,this.type="BaseResource"}return gt(e,[{key:"_initParams",value:function(){this.id=null,this.url=null,this.isBuilded=!1,this.ext=null,this.version=null,this.isDefault=!1,this.builder=null,this.manager=null,this.type=null,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.buildPromise=null,this._registerBuilders=[],this._registerBuilderMaps={},this.useStaticImage=!1,this.isResquestToBuild=!1,this._alreadyCallback=!1}},{key:"build",value:function(e){var t=this;if(this.isBuilded)e&&e(this),t.notifyBuildCompleteListeners();else{if(this.isResquestToBuild)return;this.isResquestToBuild=!0,this.builder?this.builder.build((function(){t.isBuilded=!0,e&&e(t),t.notifyBuildCompleteListeners()})):(t.isBuilded=!0,e&&e(t),t.notifyBuildCompleteListeners())}}},{key:"buildRegisterBuilder",value:function(){for(var e=0;e<this._registerBuilders.length;e++){var t=this._registerBuilders[e];t.isBuilded||t.build()}}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"notifyBuildCompleteListeners",value:function(){for(var e=0;e<this.buildCompleteCallbacks.length;e++){(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}this._alreadyCallback=!0}},{key:"containBuilder",value:function(e){return!!this._registerBuilderMaps[e]}},{key:"getBuilder",value:function(e){return this._registerBuilderMaps[e]?this._registerBuilderMaps[e]:null}},{key:"registerBuilder",value:function(e,t){this._registerBuilderMaps[e]?console.warn("exist builder "+e):(this._registerBuilderMaps[e]=t,this._registerBuilders.push(t),this.isBuilded=!1)}},{key:"unRegisterBuilder",value:function(e){if(this._registerBuilderMaps[e]){var t=this._registerBuilderMaps[e],i=this._registerBuilders.indexOf(t);this._registerBuilders.splice(i,1),delete this._registerBuilderMaps[e]}}},{key:"clear",value:function(){this.isBuilded&&this.builder&&this.builder.clear();for(var e=0;e<this._registerBuilders.length;e++){this._registerBuilders[e].clear()}this._initParams()}}]),e}()),ai=function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.baseUrl=i.manager.baseModelUrl,i.type="ModelResource",i.isModel=!0,i}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.isSupportHeadAndFootModelWall=!1,this.size=[1,1,1],this.model=null,this.animations=null,this.baseUrl=null,this.texture=null}},{key:"getModelUrl",value:function(){if(this.url)return this.url;var e=this.getDownloadResourceVersion();return this.url?this.url:this.baseUrl+this.id+"/"+e+"/gltf/"}},{key:"getDownloadResourceVersion",value:function(){var e=0;return this.manager.enableUserHighestVersionResource||(e=this.version),e}}]),t}(si),li=function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.baseUrl=i.manager.baseTextureUrl,i.type="TextureResource",i.callback=null,i}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.material=null,this.wallMaterial=null,this.roomMaterial=null,this.texture=null,this.isDefault=!1,this.baseUrl=null,this.ext=null}},{key:"build",value:function(e){this.callback&&(this.callback=null),this.callback=e,this.isDefault&&!this.manager.isGlobalResourcesBuilded?(this.manager.registerGlobalResourcesBuildCallbackListener(this._globalResourcesBuildedCallback,{object:this,callback:e}),this.manager.initGlobalResources()):vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"build",this).call(this,e)}},{key:"_globalResourcesBuildedCallback",value:function(e,t){var i=t.object,r=t.callback;i.build(r)}},{key:"getTextureUrl",value:function(){return this.url?this.url:this.baseUrl+this.id+"."+(null===this.ext?"jpg":this.ext)}},{key:"userDefaultWallLightMap",get:function(){return this.manager.userDefaultWallLightMap}}]),t}(si),ui=function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="LocalCustomTextureResource",i}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.localBaseUrl=null,this.localUrl=null,this.texture=null}},{key:"getTextureUrl",value:function(){if(this.localUrl)return this.localBaseUrl+this.localUrl;console.error("can not find url")}}]),t}(si),ci=function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="CustomResource",i}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.customTexture=null,this.color=null,this.renderMode=null,this.modelID=null}},{key:"getModelUrl",value:function(){if(this.url)return this.url;var e=this.getDownloadResourceVersion();return this.baseUrl+this.modelID+"/"+e+"/gltf/"}},{key:"clear",value:function(){this.customTexture&&this.customTexture.clear(),vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(ai),hi=function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="CustomModelResource",i}return yt(t,e),gt(t,[{key:"_initParams",value:function(){vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.localBaseUrl=null,this.localUrl=null}},{key:"getModelUrl",value:function(){if(this.url)return this.url;var e=null;return this.localUrl&&(e=this.localBaseUrl+this.localUrl),e}}]),t}(ci),pi={ModelResource:ai,TextureResource:li,LocalCustomTextureResource:ui,CustomModelResource:hi,CustomResource:ci,Max2TjsResource:function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="Max2TjsResource",i}return yt(t,e),t}(hi),EmptyModelResource:function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="EmptyModelResource",i}return yt(t,e),t}(ai),EmptyTextureResource:function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="EmptyTextureResource",i}return yt(t,e),t}(li),Max2TjsKeepRootRotationResource:function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="Max2TjsResource",i}return yt(t,e),t}(hi)},di={TextureResource:"TextureResource",ModelResource:"ModelResource",CustomModelResource:"CustomModelResource",CustomResource:"CustomResource",LocalCustomTextureResource:"LocalCustomTextureResource",Max2TjsResource:"Max2TjsResource",EmptyTextureResource:"EmptyTextureResource",EmptyModelResource:"EmptyModelResource"},fi=function(){function e(t){mt(this,e),this._initParams(),this.resource=t.resource,this.manager=t.manager}return gt(e,[{key:"_initParams",value:function(){this.resource=null,this.manager=null,this.promise=null}},{key:"build",value:function(e){this.download((function(){e&&e()}))}},{key:"download",value:function(e){}},{key:"clear",value:function(){this._initParams()}},{key:"_dispose",value:function(e){if(e.isMesh){var t=e;if(t){var i=t.material,r=t.geometry;t.isDestory=!0,i&&(this._disposeMaterial(i),t.material=null),r&&(r.isDestory=!0,r.dispose(),t.geometry=null)}}if(e)for(var n=e.children,o=0;o<n.length;o++){var s=n[o];this._dispose(s)}}},{key:"_disposeMaterial",value:function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var i=e[t];this._disposeMaterial(i)}else e.isDestory=!0,e.map&&e.map.dispose(),e.aoMap&&e.aoMap.dispose(),e.dispose()}}]),e}(),mi=function(e){function t(e){return mt(this,t),bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yt(t,e),gt(t,[{key:"getDownloadResourceVersion",value:function(){var e=0;return this.manager.enableUserHighestVersionResource||(e=this.resource.version),e}},{key:"download",value:function(e){if(Yt.isTesting){var t=new THREE.Object3D,i=new THREE.BoxBufferGeometry(1,1,1),r=new THREE.MeshBasicMaterial({color:16776960}),n=new THREE.Mesh(i,r);return t.add(n),void this._successCallback({node:t},e)}var o=this,s=new thingjs.GLTFLoader,a=this.resource.getModelUrl();s.loadFromURL({url:a,useStaticImage:this.resource.useStaticImage,jsonCallback:function(e){o.resource.indexJson=e},modelCallback:function(t){o._successCallback(t,e)},errorCallback:function(){o._errorCallback(e)}})}},{key:"_successCallback",value:function(e,t){this.resource.animations=e.animations,this.resource.downloadModelRoot=e,this.resource.model=e.node,this.ready=!0,t&&t(),this.debug&&console.log(this.id+" download complete")}},{key:"_errorCallback",value:function(e){console.error("download error "+this.resource.getModelUrl()),this.ready=!0,this.resource.model=new THREE.Object3D,this.resource.isEmpty=!0,e&&e()}},{key:"clear",value:function(){this._dispose(this.resource.model),this.resource.model=null,this.resource.animations=null,this.resource.downloadModelRoot=null,vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(fi),gi=function(e){function t(e){return mt(this,t),bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yt(t,e),gt(t,[{key:"download",value:function(e){this.initMaterial();if("bundle"===this.resource.ext)return this.ready=!0,void e();this._build(e)}},{key:"_lightMapResourceBuildCallback",value:function(e,t){t.builder._build(t.downloadCallback)}},{key:"initMaterial",value:function(){this.resource.material=new THREE.MeshStandardMaterial({metalness:.5,roughness:.5}),this.resource.wallMaterial=new THREE.MeshStandardMaterial({color:16777215,metalness:.5,roughness:.5});var e=this.resource.wallMaterial;this.resource.isDefault?this.resource.userDefaultWallLightMap&&(e.defines=e.defines||{},e.defines.WALL_AO=!0,e.metalness=.2,e.roughness=.8,e.needsUpdate=!0):(e.metalness=0,e.roughness=1);var t=new THREE.MeshLambertMaterial({color:16777215,reflectivity:.1});this.resource.roomMaterial=t,t.defines=t.defines||{},t.defines.FLOOR_AO=!0}},{key:"_downloadTexture",value:function(e,t,i){if(Yt.isTesting)t(new THREE.Texture);else{var r=new THREE.TextureLoader;r.enableStaticImage=this.resource.useStaticImage,r.setCrossOrigin("anonymous"),r.load(e,(function(e){t&&t(e)}),(function(e){}),(function(e){i&&i()}))}}},{key:"_build",value:function(e){var t=this;t._downloadTexture(t.resource.getTextureUrl(),(function(i){i.wrapS=THREE.RepeatWrapping,i.wrapT=THREE.RepeatWrapping,t.resource.texture=i,t.resource.material.map=i,t.resource.wallMaterial.map=i,t.resource.roomMaterial.map=i,t.resource.isDefault&&t.resource.manager.wallLightMapResource&&(t.resource.wallMaterial.aoMap=t.resource.manager.wallLightMapResource.texture),t.ready=!0,t.resource.material.roughness=1,t.debug&&console.log(t.id+" download complete"),e&&e()}),(function(){t.ready=!0,console.error("download error "+t.resource.getTextureUrl()),e&&e()}))}},{key:"clear",value:function(){this.resource.material&&this._disposeMaterial(this.resource.material),this.resource.wallMaterial&&this._disposeMaterial(this.resource.wallMaterial),this.resource.roomMaterial&&this._disposeMaterial(this.resource.roomMaterial),this.resource.texture&&this.resource.texture.dispose(),this.resource.texture=null,this.resource.material=null,this.resource.wallMaterial=null,this.resource.roomMaterial=null,vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(fi),vi=function(e){function t(e){mt(this,t);var i=bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.callback=null,i}return yt(t,e),gt(t,[{key:"download",value:function(e){var i=this;this.callback=e,vt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"download",this).call(this,(function(){i.resource.customTexture?(i.resource.customTexture.registerBuildCallbackListener((function(){i._afterDownload()})),i.resource.customTexture.build()):i._afterDownload()}))}},{key:"_afterDownload",value:function(){this._initCustomInfo(),this.callback&&this.callback(this)}},{key:"_initCustomInfo",value:function(){null!==this.resource.customTexture&&this._changeWithCustomTexture(this.resource.model),null!==this.resource.color&&this._changeWithCustomColor(this.resource.model),null!==this.resource.renderMode&&this._changeRenderMode(this.resource.model),this.resource.ready=!0}},{key:"_changeRenderMode",value:function(e){var t=this;e instanceof THREE.Mesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){if(null!==t.resource.renderMode)switch(t.resource.renderMode){case 1:e.transparent=!1,e.alphaTest=.5;break;case 3:case 2:e.transparent=!0;break;default:console.error("can not find renderMode "+t.renderMode)}}));for(var i=0;i<e.children.length;i++){var r=e.children[i];this._changeRenderMode(r)}}},{key:"_changeWithCustomColor",value:function(e){var t=this;e instanceof THREE.Mesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.color.r=t.resource.color[0],e.color.g=t.resource.color[1],e.color.b=t.resource.color[2],null!==t.resource.opacity&&(e.opacity=t.resource.opacity,e.transparent=!0)}));for(var i=0;i<e.children.length;i++){var r=e.children[i];this._changeWithCustomColor(r)}}},{key:"_changeWithCustomTexture",value:function(e){var t=this;e instanceof THREE.Mesh&&(t.resource.customTexture&&t.resource.customTexture.texture&&(t.resource.customTexture.texture.flipY=!1),(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.map=t.resource.customTexture.texture})));for(var i=0;i<e.children.length;i++){var r=e.children[i];this._changeWithCustomTexture(r)}}}]),t}(mi),yi=function(e){function t(e){return mt(this,t),bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yt(t,e),t}(vi),bi=function(e){function t(e){return mt(this,t),bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yt(t,e),t}(gi),_i=function(e){function t(e){return mt(this,t),bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yt(t,e),gt(t,[{key:"_successCallback",value:function(e,t){this.resource.animations=e.animations,this.resource.model=e.node.children[0],this.resource.downloadModelRoot=e,this._applyRotationToChildren(this.resource.model),this.ready=!0,t&&t(),this.debug&&console.log(this.id+" download complete")}},{key:"_applyRotationToChildren",value:function(e){for(var t=e.scale,i=0;i<e.children.length;i++){var r=e.children[i],n=r.position.clone(),o=r.scale;n.applyQuaternion(e.quaternion),r.position.copy(n),r.scale.set(t.x*o.x,t.y*o.y,t.z*o.z),r.quaternion.premultiply(e.quaternion)}if(e.children.length>0){e.quaternion.set(0,0,0,1),e.scale.set(1,1,1);for(var s=0;s<e.children.length;s++){var a=e.children[s];a.isMesh||this._applyRotationToChildren(a)}}}}]),t}(yi),xi=function(e){function t(e){return mt(this,t),bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yt(t,e),gt(t,[{key:"download",value:function(e){var t=new THREE.Object3D;this.resource.isEmpty=!0,this.resource.model=t,this._successCallback(t,e)}},{key:"_successCallback",value:function(e,t){this.ready=!0,t&&t(),this.debug&&console.log(this.id+" download complete")}}]),t}(mi),Ei=function(e){function t(e){return mt(this,t),bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yt(t,e),gt(t,[{key:"_downloadTexture",value:function(e,t,i){var r=new THREE.Texture;t&&t(r)}}]),t}(gi),wi={ModelResource:mi,TextureResource:gi,CustomResource:vi,CustomModelResource:yi,LocalCustomTextureResource:bi,Max2TjsResource:_i,Max2TjsKeepRootRotationResource:function(e){function t(e){return mt(this,t),bt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yt(t,e),gt(t,[{key:"_successCallback",value:function(e,t){this.resource.animations=e.animations,this.resource.model=e.node.children[0],this.resource.downloadModelRoot=e,this.ready=!0,t&&t(),this.debug&&console.log(this.id+" download complete")}}]),t}(_i),EmptyModelResource:xi,EmptyTextureResource:Ei},Ti=new(function(){function e(t){mt(this,e),this.enableUserHighestVersionResource=!0,this.useStaticImage=!1,this.userDefaultWallLightMap=!0,this.requestDownloadResources=[],this.resourceDownloadSuccessCallback=[]}return gt(e,[{key:"create",value:function(e){var t=e.type,i=wi[t];return e.manager=this,new i(e)}},{key:"addResourceDownloadRequest",value:function(e,t){this.requestDownloadResources.push(e),this.resourceDownloadSuccessCallback.push(t)}}]),e}()),Mi=function(){function e(){mt(this,e),this.textures=[],this.models=[],this.allResources=[],this.builderManager=Ti,this.ClassName=di,this.baseTextureUrl="https://static.3dmomoda.com/textures/",this.baseModelUrl="https://model.3dmomoda.com/models/",this.ableToSupportFootAndHeadModelWalls=["C9FB3F9A29C842F79F02CECC4037FEA1"],this.wallLightMapResource=null,this.enableUserHighestVersionResource=!0,this.globalResourcesBuildCompleteCallbacks=[],this.globalResourcesBuildCompleteCallbackParams=[],this._isGlobalResourcesBuilded=!1,this.userDefaultWallLightMap=!0,this._emptyTextureResource=this.create({type:"EmptyTextureResource",id:"emptyTexture"}),this._emptyModelResource=this.create({type:"EmptyModelResource",id:"emptyModel"})}return gt(e,[{key:"initGlobalResources",value:function(){this._isGlobalResourcesBuilded||(this._isGlobalResourcesBuilded=!0,this.wallLightMapResource?this.wallLightMapResource.isBuilded?(this._isGlobalResourcesBuilded=!0,this.notifyGlobalResourcesBuildCompleteListeners()):(this.wallLightMapResource.registerBuildCallbackListener(this._wallLightResoruceBuildCallback,{manager:this}),this.wallLightMapResource.isResquestToBuild||this.wallLightMapResource.build()):this.notifyGlobalResourcesBuildCompleteListeners())}},{key:"_wallLightResoruceBuildCallback",value:function(e,t){var i=t.manager;i._isGlobalResourcesBuilded=!0,i.notifyGlobalResourcesBuildCompleteListeners()}},{key:"registerGlobalResourcesBuildCallbackListener",value:function(e,t){this.globalResourcesBuildCompleteCallbacks.push(e),this.globalResourcesBuildCompleteCallbackParams.push(t)}},{key:"notifyGlobalResourcesBuildCompleteListeners",value:function(){for(var e=0;e<this.globalResourcesBuildCompleteCallbacks.length;e++){(0,this.globalResourcesBuildCompleteCallbacks[e])(this,this.globalResourcesBuildCompleteCallbackParams[e])}}},{key:"create",value:function(e){var t=e.type,i=new(0,pi[t])({manager:this});return i.id=e.id,this.builderManager&&(i.builder=this.builderManager.create({type:t,resource:i})),i}},{key:"getEmptyModelResource",value:function(){return this._emptyModelResource}},{key:"getEmptyTextureResource",value:function(){return this._emptyTextureResource}},{key:"disposeModels",value:function(){for(var e=0;e<this.models.length;e++){this.models[e].clear()}}},{key:"disposeTextures",value:function(){for(var e=0;e<this.textures.length;e++){this.textures[e].clear()}}},{key:"clear",value:function(){this.disposeTextures(),this.disposeModels(),this.textures=[],this.models=[]}},{key:"isGlobalResourcesBuilded",get:function(){return this._isGlobalResourcesBuilded}}]),e}(),Ci=(new Mi,{DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),r=0;return function(){for(var n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Ci.DEG2RAD},radToDeg:function(e){return e*Ci.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}}),Si="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},ji=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Pi=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Ri=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},Di=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Ai=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},ki=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},Oi=function(){function e(t,i,r,n){ji(this,e),this._x=t||0,this._y=i||0,this._z=r||0,this._w=void 0!==n?n:1}return Pi(e,[{key:"slerp",value:function(e,t,i,r){return i.copy(e).slerp(t,r)}},{key:"slerpFlat",value:function(e,t,i,r,n,o,s){var a=i[r+0],l=i[r+1],u=i[r+2],c=i[r+3],h=n[o+0],p=n[o+1],d=n[o+2],f=n[o+3];if(c!==f||a!==h||l!==p||u!==d){var m=1-s,g=a*h+l*p+u*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,s=Math.sin(s*_)/b}var x=s*v;if(a=a*m+h*x,l=l*m+p*x,u=u*m+d*x,c=c*m+f*x,m===1-s){var E=1/Math.sqrt(a*a+l*l+u*u+c*c);a*=E,l*=E,u*=E,c*=E}}e[t]=a,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"set",value:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,r=e._y,n=e._z,o=e.order,s=Math.cos,a=Math.sin,l=s(i/2),u=s(r/2),c=s(n/2),h=a(i/2),p=a(r/2),d=a(n/2);return"XYZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"YXZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"ZXY"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"ZYX"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"YZX"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c-h*p*d):"XZY"===o&&(this._x=h*u*c-l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c+h*p*d),!1!==t&&this.onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this.onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],s=i[1],a=i[5],l=i[9],u=i[2],c=i[6],h=i[10],p=r+a+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(s-n)*t):r>a&&r>h?(t=2*Math.sqrt(1+r-a-h),this._w=(c-l)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(o+u)/t):a>h?(t=2*Math.sqrt(1+a-r-h),this._w=(o-u)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-r-a),this._w=(s-n)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var i,r=new Bi;return void 0===r&&(r=new Bi),(i=e.dot(t)+1)<1e-6?(i=0,Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0):r.set(0,-e.z,e.y)):r.crossVectors(e,t),this._x=r.x,this._y=r.y,this._z=r.z,this._w=i,this.normalize()}},{key:"inverse",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,s=t._x,a=t._y,l=t._z,u=t._w;return this._x=i*u+o*s+r*l-n*a,this._y=r*u+o*a+n*s-i*l,this._z=n*u+o*l+i*a-r*s,this._w=o*u-i*s-r*a-n*l,this.onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,s=o*e._w+i*e._x+r*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(r+this._y),this._z=.5*(n+this._z),this;var l=Math.atan2(a,s),u=Math.sin((1-t)*l)/a,c=Math.sin(t*l)/a;return this._w=o*u+this._w*c,this._x=i*u+this._x*c,this._y=r*u+this._y*c,this._z=n*u+this._z*c,this.onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"onChange",value:function(e){return this.onChangeCallback=e,this}},{key:"onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}]),e}(),Bi=function(){function e(t,i,r){ji(this,e),this.x=t||0,this.y=i||0,this.z=r||0,this.isVector3=!0}return Pi(e,[{key:"set",value:function(e,t,i){return this.x=e,this.y=t,this.z=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(){var e=new Oi;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}()}},{key:"applyAxisAngle",value:function(){var e=new Oi;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i))}()}},{key:"applyMatrix3",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}},{key:"applyQuaternion",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*i,u=a*i+s*t-n*r,c=a*r+n*i-o*t,h=-n*t-o*i-s*r;return this.x=l*a+h*-n+u*-s-c*-o,this.y=u*a+h*-o+c*-n-l*-s,this.z=c*a+h*-s+l*-o-u*-n,this}},{key:"transformDirection",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(){var t=new e,i=new e;return function(e,r){return t.set(e,e,e),i.set(r,r,r),this.clamp(t,i)}()}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-i*e.z,this.z=i*e.y-r*e.x,this}},{key:"crossVectors",value:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this}},{key:"projectOnVector",value:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)}},{key:"projectOnPlane",value:function(){var t=new e;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}},{key:"reflect",value:function(){var t=new e;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}()}},{key:"angleTo",value:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Ci.clamp(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this}},{key:"setFromCylindrical",value:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}]),e}(),Fi={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},Li=function(){function e(){ji(this,e)}return Pi(e,null,[{key:"uuid",value:function(){for(var e,t=Fi.chars,i=Fi.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Si(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}},{key:"convertToVector3",value:function(e){return e.isVector3?e:new Bi(e[0],e[1],e[2])}},{key:"convertToQuaternion",value:function(e){return new Oi(e[0],e[1],e[2],e[3])}},{key:"applyQuaternionToVector3",value:function(e,t){if(0!==e[0]||0!==e[1]||0!==e[2]||1!==e[3]){var i=t[0],r=t[1],n=t[2],o=e[0],s=e[1],a=e[2],l=e[3],u=l*i+s*n-a*r,c=l*r+a*i-o*n,h=l*n+o*r-s*i,p=-o*i-s*r-a*n;t[0]=u*l+p*-o+c*-a-h*-s,t[1]=c*l+p*-s+h*-o-u*-a,t[2]=h*l+p*-a+u*-s-c*-o}}}]),e}();Li.wallTopFaceIndexes=[0,2,1,0,3,2],Li.wallStartFaceIndexes=[1,4,0,1,5,4],Li.wallEndFaceIndexes=[3,7,2,2,7,6],Li.wallStartCornerFaceIndexes=[1,8,0],Li.wallEndCornerFaceIndexes=[3,9,2],Li.wallBottomFaceIndexes=[4,5,6,4,6,7];var Ii,Ni,Ui=function(){function e(){ji(this,e),this._initParams(),this.id=Li.uuid(),this.type="BaseObject",this.calculaterData={}}return Pi(e,[{key:"_initParams",value:function(){this.id=null,this.name=null,this.userID=null,this.resource=null,this.position=null,this.rotation=null,this.scale=null,this._parent=null,this.resource=null,this._resources=null}},{key:"calculate",value:function(){this.calculater&&this.calculater.build(this)}},{key:"createMesh",value:function(){if(this.meshBuilder)return this.meshBuilder.build(this)}},{key:"clear",value:function(){this.calculater&&this.calculater.clear(),this._initParams()}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource)),this._resources}}]),e}(),zi=function(e){function t(e,i,r){ji(this,t);var n=Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.walls=[],n.type="WallCorner",n}return Di(t,e),Pi(t,[{key:"_initParams",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.walls=null}},{key:"addWall",value:function(e){for(var t=0,i=this.walls.length;t<i;t++)if(this.walls[t]===e)return void console.error("repeat wall"+e);this.walls.push(e)}}]),t}(Ui),Hi=function(){function e(t){ji(this,e),this._init(),this.subMeshes=[],this.extraData={},this.vertices=[],this.normals=[],this.uvs=[],this.uv2s=[],this.resource=null,this.triangles=[]}return Pi(e,[{key:"_init",value:function(){this.vertices=null,this.normals=null,this.uvs=null,this.uv2s=null,this.resource=null,this.triangles=null,this.subMeshes=[],this.extraData={}}},{key:"clone",value:function(){var t=new e;for(var i in t.vertices=this.vertices.slice(),t.normals=this.normals.slice(),t.uvs=this.uvs.slice(),t.uv2s=this.uv2s.slice(),t.resource=this.resource,t.triangles=this.triangles.slice(),this.extraData)t.extraData[i]=this.extraData[i].slice();for(var r=0;r<this.subMeshes.length;r++){var n=this.subMeshes[r].clone();t.subMeshes.push(n)}return t}},{key:"clear",value:function(){for(var e=0;e<this.subMeshes.length;e++){this.subMeshes[e].clear()}this._init()}}]),e}(),Vi=function(){function e(t){ji(this,e),this._initParams(),this.isBuilded=!1,this.resourceCombineManager=t.resourceCombineManager,this.objectManager=t.objectManager}return Pi(e,[{key:"setObject",value:function(e){this.clear(),this.object=e}},{key:"_initParams",value:function(){this.mesh=new Hi,this.object=null,this.isBuilded=!1,this.objectManager=null}},{key:"build",value:function(e){this.setObject(e),this._calculate(),this.object.calculaterMesh=this.mesh,this.mesh=null}},{key:"_calculate",value:function(){}},{key:"clear",value:function(){this._initParams()}}]),e}();function Wi(e,t){this.x=e||0,this.y=t||0}Object.defineProperties(Wi.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Wi.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:(Ii=new Wi,Ni=new Wi,function(e,t){return Ii.set(e,e),Ni.set(t,t),this.clamp(Ii,Ni)}),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},distanceToManhattan:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}});var Gi=function(e){function t(e){ji(this,t);var i=Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.walls=[],i}return Di(t,e),Pi(t,[{key:"_initParams",value:function(){this.walls=[],this.position=null}},{key:"_calculate",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this),this.walls=this.object.walls,this.position=Li.convertToVector3(this.object.position);var e=this.getSameHeightWalls(this.object);for(var i in e)this.calWallsVertices(e[i])}},{key:"isFirstWallShouldNotCal",value:function(e){return!("StraightManualWall"===e.type)||"SubStraightManualWall"===e}},{key:"isSecondWallShouldNotCal",value:function(e){return null!=e&&(e.resource&&e.resource.isModel||"SubStraightManualWall"===e.type)}},{key:"checkWallsSameHeight",value:function(e){for(var t=null,i=0;i<e.walls.length;i++){var r=e.walls[i];if("StraightManualWall"===r.type)if(null===t)t=r.height;else if(t!==r.height)return!1}return!0}},{key:"containModelWall",value:function(e){for(var t=0;t<e.walls.length;t++){if("ModelWall"===e.walls[t].type)return!0}return!1}},{key:"getSameHeightWalls",value:function(e){for(var t={},i=0;i<e.walls.length;i++){var r=e.walls[i];this.isStraightManualWall(r)&&(void 0===t[r.height]&&(t[r.height]=[]),t[r.height].push(r))}return t}},{key:"isStraightManualWall",value:function(e){return"StraightManualWall"===e.type}},{key:"calWallsVertices",value:function(e){var t=new Bi(0,-1,0);if(1===e.length){var i=e[0];this.isStraightManualWall(i)&&this.setDefaultCornerVertices(i)}else{this.sortWalls(e);for(var r=0;r<e.length;r++){var n=e[r];if(!this.isFirstWallShouldNotCal(n)){for(var o=null,s=r;null==o&&(s===e.length-1?s=0:s+=1,e[s]!==n);)o=e[s],this.isSecondWallShouldNotCal(o)&&(o=null);if(o){var a=Li.convertToVector3(n.getWallOtherCorner(this.object).position),l=new Bi;l.subVectors(a,this.position),a=Li.convertToVector3(o.getWallOtherCorner(this.object).position);var u=new Bi;if(u.subVectors(a,this.position),l.normalize(),u.normalize(),0!==l.length()&&0!==u.length()){var c=n.thick/2,h=new Bi;h.crossVectors(t,l),h.normalize();var p=h.clone();p.multiplyScalar(c),p.add(this.position),c=o.thick/2;var d=u.clone();d.cross(t),d.normalize();var f=d.clone();if(f.multiplyScalar(c),f.add(this.position),this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1),l.normalize(),u.normalize(),this.calAngle(l,u)>30){var m;if(Li.approximatelyNumberEqual(Math.abs(l.dot(u)),1)){var g=l.clone();g.cross(t),g.normalize(),this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!0);continue}if(0!==(m=this.getIntersectPosition(p,l,f,u)).x||0!==m.y||0!==m.z)m.clone().y=this.position.y+this.getWallHeight(this.object),this.setCornersVertices(n,m,!0),this.setCornersVertices(o,m,!1)}else this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1)}else this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!1)}else this.setDefaultCornerVertices(n)}}}}},{key:"sortWalls",value:function(e){if(e.length>1)for(var t,i,r=e[0],n=0,o=e.length-1;n<o;){for(i=n;i<o;++i)this.angleBetween(r,e[i])>this.angleBetween(r,e[i+1])&&(t=e[i],e[i]=e[i+1],e[i+1]=t);for(i=--o;i>n;--i)this.angleBetween(r,e[i])<this.angleBetween(r,e[i-1])&&(t=e[i],e[i]=e[i-1],e[i-1]=t);++n}}},{key:"angleBetween",value:function(e,t){var i=Li.convertToVector3(e.getWallOtherCorner(this.object).position).clone();i.sub(this.position);var r=Li.convertToVector3(t.getWallOtherCorner(this.object).position).clone();return r.sub(this.position),this.calAngle(i,r)}},{key:"calAngle",value:function(e,t){e.normalize(),t.normalize();var i=e.angleTo(t);i*=180/Math.PI;var r=e.clone();return r.cross(t),r.y>0&&(i=360-i),i}},{key:"getWallHeight",value:function(e){for(var t=99999,i=0;i<e.walls.length;i++){var r=e.walls[i];t>r.height&&(t=r.height)}return t}},{key:"setCornersVertices",value:function(e,t,i){var r=new Bi(0,0,0),n=Li.convertToVector3(e.position);r.x=t.x-n.x,r.y=t.y-n.y,r.z=t.z-n.z,this.object.calculaterData[e.id]||(this.object.calculaterData[e.id]=[new Bi,new Bi]);var o=this.object.calculaterData[e.id];i?(o[0].x=r.x,o[0].y=r.y,o[0].z=r.z):(o[1].x=r.x,o[1].y=r.y,o[1].z=r.z)}},{key:"setDefaultCornerVertices",value:function(e,t){var i=new Bi(0,-1,0),r=Li.convertToVector3(e.getWallOtherCorner(this.object).position).clone();r.sub(this.position),r.normalize();var n=e.thick/2,o=i.clone();o.cross(r),o.normalize(),o.multiplyScalar(n);var s=new Bi;s.addVectors(this.position,o);var a=new Bi;a.subVectors(this.position,o),void 0===t?(this.setCornersVertices(e,s,!0),this.setCornersVertices(e,a,!1)):t?this.setCornersVertices(e,s,!0):this.setCornersVertices(e,a,!1)}},{key:"getIntersectPosition",value:function(e,t,i,r){if(e.x===i.x&&e.y===i.y&&e.z===i.z)return e;var n=e.y;if(1===t.dot(r))throw"two line in same direction ,can not cal intersected position!";var o=new Bi,s=new Bi;o.addVectors(e,t),s.addVectors(i,r);var a=new Wi(e.x,e.z),l=new Wi(o.x,o.z),u=new Wi(i.x,i.z),c=new Wi(s.x,s.z),h=(l.y-a.y)*(c.x-u.x)-(a.x-l.x)*(u.y-c.y);if(0==h)return new Bi;var p=((l.x-a.x)*(c.x-u.x)*(u.y-a.y)+(l.y-a.y)*(c.x-u.x)*a.x-(c.y-u.y)*(l.x-a.x)*u.x)/h,d=-((l.y-a.y)*(c.y-u.y)*(u.x-a.x)+(l.x-a.x)*(c.y-u.y)*a.y-(c.x-u.x)*(l.y-a.y)*u.y)/h;return new Bi(p,n,d)}}]),t}(Vi),qi=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),Pi(t,[{key:"_initParams",value:function(){this.walls=[],this.position=null}},{key:"_calculate",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this),this.walls=this.object.walls,this.position=Li.convertToVector3(this.object.position);var e=this.getSameHeightWalls(this.object);for(var i in e)this.calWallsVertices(e[i])}},{key:"isFirstWallShouldNotCal",value:function(e){return!this.isStraightManualWall(e)}},{key:"isSecondWallShouldNotCal",value:function(e){return!this.isStraightManualWall(e)}},{key:"checkWallsSameHeight",value:function(e){for(var t=null,i=0;i<e.walls.length;i++){var r=e.walls[i];if(null===t)t=r.height;else if(t!==r.height)return!1}return!0}},{key:"containModelWall",value:function(e){for(var t=0;t<e.walls.length;t++){if("ModelWall"===e.walls[t].type)return!0}return!1}},{key:"getSameHeightWalls",value:function(e){for(var t={},i=0;i<e.walls.length;i++){var r=e.walls[i];this.isStraightManualWall(r)&&(void 0===t[r.height]&&(t[r.height]=[]),t[r.height].push(r))}return t}},{key:"isStraightManualWall",value:function(e){return"SubStraightManualWall"===e.type||"SubDoorOrWindowStraightManualWall"===e.type}}]),t}(Gi),Xi=function(e){function t(){ji(this,t);var e=Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="SubWallCorner",e.calculater=new qi({object:e}),e}return Di(t,e),Pi(t,[{key:"_initParams",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.calculater=null}},{key:"build",value:function(){this.calculate()}},{key:"isFirstWallShouldNotCal",value:function(e){return!("SubStraightManualWall"===e)}},{key:"isSecondWallShouldNotCal",value:function(e){return e&&!("SubStraightManualWall"===e.type)}}],[{key:"createSubWallCorner",value:function(e,i,r){var n=new t;return n.id=e,n.position=i,n.parent=r.parent,n}}]),t}(zi),Ji={SubStraightManualWall:"SubStraightManualWall",SubDoorOrWindowStraightManualWall:"SubDoorOrWindowStraightManualWall",SubWallCorner:"SubWallCorner",SubModelWall:"SubModelWall"},Yi=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),Pi(t,[{key:"setObject",value:function(e){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setObject",this).call(this,e),this.object=e,this.startCorner=this.object.startCorner,this.endCorner=this.object.endCorner,this.startCornerPosition=Li.convertToVector3(this.startCorner.position),this.endCornerPosition=Li.convertToVector3(this.endCorner.position),this.position=Li.convertToVector3(this.object.position),this.direction=Li.convertToVector3(this.object.direction),this.suspend=this.object.suspend,this.doorOrWindows=this.object.doorOrWindows,this.object.calculaterData.subWalls=[],this.object.calculaterData.subCorners=[],this.subWalls=this.object.calculaterData.subWalls,this.subCorners=this.object.calculaterData.subCorners}},{key:"_initParams",value:function(){this.startCorner=null,this.endCorner=null,this.startCornerPosition=null,this.endCornerPosition=null,this.position=null,this.direction=null,this.suspend=null,this.doorOrWindows=null,this.subWalls=[],this.subCorners=[]}},{key:"sortDoorOrWins",value:function(){var e=this.startCornerPosition,t=this.endCornerPosition,i=t.x-e.x>0?1:-1,r=t.z-e.z>0?1:-1,n=!0;Math.abs(t.x-e.x)<.001&&(n=!1);for(var o=[],s=0;s<this.doorOrWindows.length;s++){for(var a=this.doorOrWindows[s],l=0;l<o.length;l++){var u=o[l];if((n?(u.position[0]-a.position[0])*i:(u.position[2]-a.position[2])*r)>=0){o.splice(l,0,a);break}if(l===o.length-1){o.push(a);break}}0===o.length&&o.push(a)}return o}},{key:"getDoorOrWinStartAndEndPos",value:function(e){var t=Li.convertToVector3(e.size),i=this.direction,r=Li.convertToVector3(e.position);r.y=0;var n=r.clone(),o=r.clone(),s=t.x/2;return n.subVectors(n,i.clone().multiplyScalar(s)),o.addVectors(o,i.clone().multiplyScalar(s)),[n,o]}},{key:"addSubWallCorner",value:function(e){for(var t=0;t<this.subCorners.length;t++){if(this.subCorners[t]===e)return}this.subCorners.push(e)}},{key:"getWallCornerByPos",value:function(e){for(var t=null,i=-1,r=this.subCorners,n=0;n<r.length;n++){var o=e.distanceTo(r[n].position);o<.01&&(null===t?(t=r[n],i=o):o<i&&(i=o,t=r[n]))}return t}}]),t}(Vi),Zi=function(e){function t(e){ji(this,t);var i=Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.upDirection=new Bi(0,1,0),i.downDirection=new Bi(0,-1,0),i.vectorUp=new Bi(0,1,0),i}return Di(t,e),Pi(t,[{key:"setObject",value:function(e){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setObject",this).call(this,e);var i=e.calculaterData;i.pathPoints=[],i.selfPathPoints=[],i.repeatUV=[],i.startUVPercent=[0,0,0,0],i.endUVPercent=[1,1,1,1],i.basePoints=[],this.pathPoints=i.pathPoints,this.selfPathPoints=i.selfPathPoints,this.cornersVertices=[this.object.startCorner.calculaterData[this.object.id][0],this.object.startCorner.calculaterData[this.object.id][1],this.object.endCorner.calculaterData[this.object.id][0],this.object.endCorner.calculaterData[this.object.id][1]],i.cornersVertices=this.cornersVertices,this.basePoints=i.basePoints;for(var r=0;r<12;r++)this.basePoints.push(new Bi);this.repeatUV=i.repeatUV,this.startUVPercent=i.startUVPercent,this.endUVPercent=i.endUVPercent}},{key:"_initParams",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.pathPoints=null,this.cornersVertices=null,this.selfPathPoints=null,this.rightSideLength=null,this.leftSideLength=null,this.repeatUV=null,this.basePoints=null,this.startUVPercent=null,this.endUVPercent=null,this.leftMesh=null,this.rightMesh=null,this.edgeMesh=null,this.mesh=null,this.rightSideLength=null,this.leftSideLength=null,this.pathPoints=[],this.selfPathPoints=[],this.leftMesh=new Hi,this.rightMesh=new Hi,this.edgeMesh=new Hi,this.mesh=new Hi,this.repeatUV=[],this.startUVPercent=[0,0,0,0],this.endUVPercent=[1,1,1,1]}},{key:"_calculate",value:function(){if(this.object.doorOrWindows.length>0){this.baseBuild(),this.calPosInfo(),this.calEachSideLen(),this.calRepeatUV(),this.initSimpleCornersAndWalls();for(var e=0;e<this.subCorners.length;e++){this.subCorners[e].build()}for(var t=0;t<this.subWalls.length;t++){var i=this.subWalls[t];i.calculate(),this.mesh.subMeshes.push(i.calculater.mesh)}}else this.initMeshInfo();this.object.calculaterMesh=this.mesh}},{key:"initMeshInfo",value:function(){this.baseBuild(),this.calPosInfo(),this.calEachSideLen(),this.calRepeatUV(),this.calBasePoints(),this.fillMesh()}},{key:"baseBuild",value:function(){this.pathPoints.push(this.startCornerPosition),this.pathPoints.push(this.endCornerPosition)}},{key:"calEachSideLen",value:function(){var e=new Bi;e.subVectors(this.endCornerPosition,this.startCornerPosition),e.normalize();var t=this.object.thick/2,i=new Bi;i.crossVectors(this.downDirection,e),i.normalize();var r=i.clone();r.negate();var n=i.clone();n.multiplyScalar(t);var o=r.clone();o.multiplyScalar(t);var s=new Bi,a=new Bi,l=new Bi,u=new Bi;Li.equalVectorZero(this.cornersVertices[0])?s.addVectors(this.selfPathPoints[0],n):s.copy(this.cornersVertices[0]),Li.equalVectorZero(this.cornersVertices[3])?a.addVectors(this.selfPathPoints[1],n):a.copy(this.cornersVertices[3]),Li.equalVectorZero(this.cornersVertices[1])?l.addVectors(this.selfPathPoints[0],o):l.copy(this.cornersVertices[1]),Li.equalVectorZero(this.cornersVertices[2])?u.addVectors(this.selfPathPoints[1],o):u.copy(this.cornersVertices[2]),this.rightSideLength=new Bi,this.leftSideLength=new Bi,this.rightSideLength.subVectors(s,a),this.leftSideLength.subVectors(l,u),this.rightSideLength=this.rightSideLength.length(),this.leftSideLength=this.leftSideLength.length(),this.object.calculaterData.rightSideLength=this.rightSideLength,this.object.calculaterData.leftSideLength=this.leftSideLength}},{key:"calRepeatUV",value:function(){var e=this.object.uvMultiple,t=this.object.height,i=this.object.parent.height;this.repeatUV[0]=e[0]*this.rightSideLength/i,this.repeatUV[1]=e[1]*t/i,this.repeatUV[2]=e[0]*this.leftSideLength/i,this.repeatUV[3]=e[1]*t/i,this.object.calculaterData.repeatUV=this.repeatUV}},{key:"calPosInfo",value:function(){var e=new Bi;this.selfPathPoints.push(e.subVectors(this.startCornerPosition,this.position)),e=new Bi,this.selfPathPoints.push(e.subVectors(this.endCornerPosition,this.position)),this.selfPathPoints[0].y=0,this.selfPathPoints[1].y=0}},{key:"calBasePoints",value:function(){var e=this.object.thick,t=this.object.height,i=this.direction;if(null===this.basePoints){this.basePoints=[];for(var r=0;r<12;r++)this.basePoints.push(new Bi)}var n=e/2,o=new Bi;o.crossVectors(this.downDirection,i),o.normalize();var s=o.clone();s.negate();var a=o.multiplyScalar(n);Li.equalVectorZero(this.cornersVertices[0])?(this.basePoints[4].x=this.selfPathPoints[0].x+a.x,this.basePoints[4].y=0,this.basePoints[4].z=this.selfPathPoints[0].z+a.z):(this.basePoints[4].x=this.cornersVertices[0].x,this.basePoints[4].y=0,this.basePoints[4].z=this.cornersVertices[0].z),Li.equalVectorZero(this.cornersVertices[1])?(a=s.multiplyScalar(n),this.basePoints[5].x=this.selfPathPoints[0].x+a.x,this.basePoints[5].y=0,this.basePoints[5].z=this.selfPathPoints[0].z+a.z):(this.basePoints[5].x=this.cornersVertices[1].x,this.basePoints[5].y=0,this.basePoints[5].z=this.cornersVertices[1].z);var l=i.clone();o.crossVectors(this.downDirection,l.negate()),o.normalize(),(s=o.clone()).negate(),Li.equalVectorZero(this.cornersVertices[2])?((a=o.clone()).multiplyScalar(n),this.basePoints[6].x=this.selfPathPoints[1].x+a.x,this.basePoints[6].y=0,this.basePoints[6].z=this.selfPathPoints[1].z+a.z):(this.basePoints[6].x=this.cornersVertices[2].x,this.basePoints[6].y=0,this.basePoints[6].z=this.cornersVertices[2].z),Li.equalVectorZero(this.cornersVertices[3])?((a=s.clone()).multiplyScalar(n),this.basePoints[7].x=this.selfPathPoints[1].x+a.x,this.basePoints[7].y=0,this.basePoints[7].z=this.selfPathPoints[1].z+a.z):(this.basePoints[7].x=this.cornersVertices[3].x,this.basePoints[7].y=0,this.basePoints[7].z=this.cornersVertices[3].z),this.basePoints[0].x=this.basePoints[4].x,this.basePoints[0].y=this.basePoints[4].y+t,this.basePoints[0].z=this.basePoints[4].z,this.basePoints[1].x=this.basePoints[5].x,this.basePoints[1].y=this.basePoints[5].y+t,this.basePoints[1].z=this.basePoints[5].z,this.basePoints[2].x=this.basePoints[6].x,this.basePoints[2].y=this.basePoints[6].y+t,this.basePoints[2].z=this.basePoints[6].z,this.basePoints[3].x=this.basePoints[7].x,this.basePoints[3].y=this.basePoints[7].y+t,this.basePoints[3].z=this.basePoints[7].z,this.basePoints[8].x=this.selfPathPoints[0].x,this.basePoints[8].y=this.selfPathPoints[0].y+t,this.basePoints[8].z=this.selfPathPoints[0].z,this.basePoints[9].x=this.selfPathPoints[1].x,this.basePoints[9].y=this.selfPathPoints[1].y+t,this.basePoints[9].z=this.selfPathPoints[1].z}},{key:"initSimpleCornersAndWalls",value:function(){this.position;var e=this.direction,t=this.object.id;(new Bi).crossVectors(e,this.vectorUp);for(var i=this.sortDoorOrWins(),r=0;r<i.length;r++){var n=i[r],o=this.getDoorOrWinStartAndEndPos(n),s=(this.getDoorOrWinRectPoints(n),Xi.createSubWallCorner(t+"_"+r+"_1",o[0],this.object)),a=Xi.createSubWallCorner(t+"_"+r+"_2",o[1],this.object);if(this.addSubWallCorner(s),this.addSubWallCorner(a),0===r){var l=this.createSubStraightManualWall(this.object.startCorner,s,r,i,"start");this.object.startCorner.calculaterData[l.id]=[];for(var u=this.object.startCorner.calculaterData[this.object.id],c=0;c<u.length;c++){var h=u[c].clone();h.add(Li.convertToVector3(this.object.position)),h.sub(l.position),this.object.startCorner.calculaterData[l.id].push(h)}}else{var p=i[r-1],d=this.getDoorOrWinStartAndEndPos(p),f=this.getWallCornerByPos(d[1]);this.createSubStraightManualWall(f,s,r,i)}if(r===i.length-1){var m=this.createSubStraightManualWall(a,this.object.endCorner,r,i,"end");this.object.endCorner.calculaterData[m.id]=[];for(var g=this.object.endCorner.calculaterData[this.object.id],v=0;v<g.length;v++){var y=g[v].clone();y.add(Li.convertToVector3(this.object.position)),y.sub(m.position),this.object.endCorner.calculaterData[m.id].push(y)}}this.buildHeadAndFootWall(n,s,a)}}},{key:"setSubWallCornerVerrices",value:function(){}},{key:"buildHeadAndFootWall",value:function(e,t,i){this.getDoorOrWinRectPoints(e);var r=e.suspendPercent;(new Bi).crossVectors(this.direction,this.vectorUp);var n=Li.convertToVector3(e.size).y+this.object.height*r;if(0!==e.suspendPercent){var o=this.createSubDoorOrWindowStraightManualWall(t,i,e,"down"),s=new Bi;s.subVectors(i.position,t.position);s.length();o.height=this.object.height*r}if(n<this.object.height){var a=this.createSubDoorOrWindowStraightManualWall(t,i,e,"up");a.suspend=n,a.height=this.object.height-n,a.thick=this.object.thick}}},{key:"createSubStraightManualWall",value:function(e,t,i,r,n){var o=this.object,s=this.objectManager.create({type:Ji.SubStraightManualWall});return s.id=Li.uuid(),s.startCorner=e,s.endCorner=t,s.leftResource=o.leftResource,s.rightResource=o.rightResource,s.edgeResource=o.edgeResource,s.height=o.height,s.thick=o.thick,s.parentWall=o,s.calculaterData.repeatUV=this.object.calculaterData.repeatUV,s.calculaterData.index=i,s.calculaterData.doorOrWindows=r,s.calculaterData.buildType=n,this.subWalls.push(s),s}},{key:"createSubDoorOrWindowStraightManualWall",value:function(e,t,i,r){var n=this.object,o=this.objectManager.create({type:Ji.SubDoorOrWindowStraightManualWall});return o.id=Li.uuid(),o.startCorner=e,o.endCorner=t,o.leftResource=n.leftResource,o.rightResource=n.rightResource,o.edgeResource=n.edgeResource,o.height=n.height,o.thick=n.thick,o.parentWall=n,o.calculaterData.repeatUV=this.object.calculaterData.repeatUV,o.calculaterData.doorOrWindow=i,o.calculaterData.buildType=r,this.subWalls.push(o),o}},{key:"setCornerVertices",value:function(e,t){e.calculaterData.cornersVertices||(e.calculaterData.cornersVertices=[new Bi,new Bi,new Bi,new Bi]);var i,r,n=e.calculaterData.cornersVertices;t?((i=new Bi).addVectors(this.object.calculater.cornersVertices[0],this.position),i.sub(e.position),(r=new Bi).addVectors(this.object.calculater.cornersVertices[1],this.position),r.sub(e.position),n[0]=i,n[1]=r):((i=new Bi).addVectors(this.object.calculater.cornersVertices[2],this.position),i.sub(e.position),(r=new Bi).addVectors(this.object.calculater.cornersVertices[3],this.position),r.sub(e.position),n[2]=i,n[3]=r);e.calculater.cornersVertices=n}},{key:"getDoorOrWinRectPoints",value:function(e){var t=this.object.thick/2,i=new Bi;i.crossVectors(this.vectorUp,this.direction),i.normalize();var r=i.clone();r.negate(),this.vectorUp.clone().multiplyScalar(t);var n=Li.convertToVector3(e.size),o=this.direction,s=Li.convertToVector3(e.position),a=n.x/2,l=new Bi,u=new Bi;return l.subVectors(s,o.clone().multiplyScalar(a)),u.addVectors(s,o.clone().multiplyScalar(a)),[l.clone().addVectors(l,i.clone().multiplyScalar(t)),l.clone().addVectors(l,r.clone().multiplyScalar(t)),u.clone().addVectors(u,r.clone().multiplyScalar(t)),u.clone().addVectors(u,i.clone().multiplyScalar(t))]}},{key:"fillMesh",value:function(){this.leftMesh=new Hi,this.rightMesh=new Hi,this.edgeMesh=new Hi,this.mesh=new Hi,this.fillEdgeSideMeshInfo(),this.fillLeftMeshInfo(),this.fillRightMeshInfo(),this.mesh.subMeshes=[this.rightMesh,this.leftMesh,this.edgeMesh]}},{key:"fillRightMeshInfo",value:function(){this.rightMesh.resource=this.object.rightResource,this.rightMesh.vertices=new Float32Array(12),this.rightMesh.normals=new Float32Array(12),this.rightMesh.triangles=new Uint16Array(6),this.rightMesh.triangles[0]=0,this.rightMesh.triangles[1]=2,this.rightMesh.triangles[2]=3,this.rightMesh.triangles[3]=0,this.rightMesh.triangles[4]=1,this.rightMesh.triangles[5]=2,this.rightMesh.uvs=[],this.rightMesh.uv2s=[];var e,t,i,r,n=this.basePoints,o=[n[0],n[4],n[7],n[3]],s=new Bi;s.crossVectors(this.downDirection,this.direction),s.normalize(),this.object.rightResource.isDefault?(e=this.startUVPercent[0],t=this.startUVPercent[1],i=this.endUVPercent[0],r=this.endUVPercent[1]):(e=this.startUVPercent[0]*this.repeatUV[0],t=this.startUVPercent[1]*this.repeatUV[1],i=this.endUVPercent[0]*this.repeatUV[0],r=this.endUVPercent[1]*this.repeatUV[1]),this.rightMesh.uvs=new Float32Array(8),this.rightMesh.uvs[0]=e,this.rightMesh.uvs[1]=r,this.rightMesh.uvs[2]=e,this.rightMesh.uvs[3]=t,this.rightMesh.uvs[4]=i,this.rightMesh.uvs[5]=t,this.rightMesh.uvs[6]=i,this.rightMesh.uvs[7]=r,this.object.rightResource.isDefault&&(e=this.startUVPercent[0],t=this.startUVPercent[1],i=this.endUVPercent[0],r=this.endUVPercent[1],this.rightMesh.uv2s=new Float32Array(8),this.rightMesh.uv2s[0]=e,this.rightMesh.uv2s[1]=r,this.rightMesh.uv2s[2]=e,this.rightMesh.uv2s[3]=t,this.rightMesh.uv2s[4]=i,this.rightMesh.uv2s[5]=t,this.rightMesh.uv2s[6]=i,this.rightMesh.uv2s[7]=r);for(var a=0;a<o.length;a++){var l=o[a],u=3*a;this.rightMesh.vertices[u]=l.x,this.rightMesh.vertices[u+1]=l.y+this.suspend,this.rightMesh.vertices[u+2]=l.z}for(var c=0;c<o.length;c++){var h=s,p=3*c;this.rightMesh.normals[p]=h.x,this.rightMesh.normals[p+1]=h.y,this.rightMesh.normals[p+2]=h.z}}},{key:"fillLeftMeshInfo",value:function(){this.leftMesh.resource=this.object.leftResource,this.leftMesh.vertices=new Float32Array(12),this.leftMesh.normals=new Float32Array(12),this.leftMesh.uvs=[],this.leftMesh.triangles=new Uint16Array(6),this.leftMesh.triangles[0]=3,this.leftMesh.triangles[1]=1,this.leftMesh.triangles[2]=0,this.leftMesh.triangles[3]=3,this.leftMesh.triangles[4]=2,this.leftMesh.triangles[5]=1;var e,t,i,r,n=this.basePoints,o=[n[1],n[5],n[6],n[2]],s=new Bi;s.crossVectors(this.direction,this.downDirection),s.normalize(),this.object.leftResource.isDefault?(e=this.startUVPercent[2],t=this.startUVPercent[3],i=this.endUVPercent[2],r=this.endUVPercent[3]):(e=this.startUVPercent[2]*this.repeatUV[2],t=this.startUVPercent[3]*this.repeatUV[3],i=this.endUVPercent[2]*this.repeatUV[2],r=this.endUVPercent[3]*this.repeatUV[3]),this.leftMesh.uvs=new Float32Array(8),this.leftMesh.uvs[0]=i,this.leftMesh.uvs[1]=r,this.leftMesh.uvs[2]=i,this.leftMesh.uvs[3]=t,this.leftMesh.uvs[4]=e,this.leftMesh.uvs[5]=t,this.leftMesh.uvs[6]=e,this.leftMesh.uvs[7]=r,this.object.leftResource.isDefault&&(e=this.startUVPercent[0],t=this.startUVPercent[1],i=this.endUVPercent[0],r=this.endUVPercent[1],this.leftMesh.uv2s=new Float32Array(8),this.leftMesh.uv2s[0]=e,this.leftMesh.uv2s[1]=r,this.leftMesh.uv2s[2]=e,this.leftMesh.uv2s[3]=t,this.leftMesh.uv2s[4]=i,this.leftMesh.uv2s[5]=t,this.leftMesh.uv2s[6]=i,this.leftMesh.uv2s[7]=r);for(var a=0;a<o.length;a++){var l=o[a],u=3*a;this.leftMesh.vertices[u]=l.x,this.leftMesh.vertices[u+1]=l.y+this.suspend,this.leftMesh.vertices[u+2]=l.z}for(var c=0;c<o.length;c++){var h=s,p=3*c;this.leftMesh.normals[p]=h.x,this.leftMesh.normals[p+1]=h.y,this.leftMesh.normals[p+2]=h.z}}},{key:"fillEdgeSideMeshInfo",value:function(){this.edgeMesh.resource=this.object.edgeResource;var e=Li.wallTopFaceIndexes,t=Li.wallStartFaceIndexes,i=Li.wallEndFaceIndexes,r=Li.wallStartCornerFaceIndexes,n=Li.wallEndCornerFaceIndexes,o=Li.wallBottomFaceIndexes;this.edgeMesh.triangles=new Uint16Array(this.getEdgeTrianglesCount(this.object));for(var s=e.length,a=0;a<e.length;a++)this.edgeMesh.triangles[a]=e[a];if(this.shouldAddSideIndexes(this.startCorner)){for(var l=0;l<t.length;l++)this.edgeMesh.triangles[s+l]=t[l];s+=t.length}if(this.shouldAddSideIndexes(this.endCorner)){for(var u=0;u<i.length;u++)this.edgeMesh.triangles[s+u]=i[u];s+=i.length}if(this.startCorner.walls.length>2){for(var c=0;c<r.length;c++)this.edgeMesh.triangles[s+c]=r[c];s+=r.length}if(this.endCorner.walls.length>2){for(var h=0;h<n.length;h++)this.edgeMesh.triangles[s+h]=n[h];s+=n.length}if(0!==this.object.suspend)for(var p=0;p<o.length;p++)this.edgeMesh.triangles[s+p]=o[p];this.edgeMesh.vertices=new Float32Array(30),this.edgeMesh.normals=new Float32Array(30),this.edgeMesh.uvs=new Float32Array(20);for(var d=this.basePoints,f=[d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9]],m=0;m<f.length;m++){var g=f[m],v=3*m;this.edgeMesh.vertices[v]=g.x,this.edgeMesh.vertices[v+1]=g.y+this.object.suspend,this.edgeMesh.vertices[v+2]=g.z}for(var y=0;y<f.length;y++){var b=this.upDirection,_=3*y;this.edgeMesh.normals[_]=b.x,this.edgeMesh.normals[_+1]=b.y,this.edgeMesh.normals[_+2]=b.z}}},{key:"getEdgeTrianglesCount",value:function(e){var t=Li.wallTopFaceIndexes.length;return this.shouldAddSideIndexes(e.startCorner)&&(t+=Li.wallStartFaceIndexes.length),this.shouldAddSideIndexes(e.endCorner)&&(t+=Li.wallEndFaceIndexes.length),e.startCorner.walls.length>2&&(t+=Li.wallStartCornerFaceIndexes.length),e.endCorner.walls.length>2&&(t+=Li.wallEndCornerFaceIndexes.length),0!==this.object.suspend&&(t+=Li.wallBottomFaceIndexes.length),t}},{key:"shouldAddSideIndexes",value:function(e){for(var t=0,i=0;i<e.walls.length;i++){"StraightManualWall"===e.walls[i].type&&t++}return 1===t||!(e.calculater.checkWallsSameHeight(e)&&!e.calculater.containModelWall(e))}},{key:"shouldAddEdgeTriangle",value:function(e){for(var t=0,i=0;i<e.walls.length;i++){"StraightManualWall"===e.walls[i].type&&t++}return t>2}},{key:"clear",value:function(){this.leftMesh.clear(),this.rightMesh.clear(),this.edgeMesh.clear(),Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(Yi),Qi=function(e){function t(e){ji(this,t);var i=Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.meshMap=new Map,i.resources=[],i}return Di(t,e),Pi(t,[{key:"_calculate",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this)}},{key:"_initParams",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.meshMap=new Map,this.resources=[]}},{key:"classifyMeshesToDic",value:function(e){this.meshMap.clear();for(var t=0;t<e.length;t++){var i=e[t].calculater.mesh;this.addMeshToMap(i)}}},{key:"addMeshToMap",value:function(e){if(e.subMeshes.length>0)for(var t=0;t<e.subMeshes.length;t++){var i=e.subMeshes[t];this.addMeshToMap(i)}e.resource&&(this.meshMap.has(e.resource)||(this.resources.push(e.resource),this.meshMap.set(e.resource,[])),this.meshMap.get(e.resource).push(e))}},{key:"combineMeshes",value:function(){var e=!0,t=!1,i=void 0;try{for(var r,n=this.meshMap[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var o=r.value,s=ki(o,2),a=s[0],l=s[1],u=this._combineSubMeshes(l);u.resource=a,this.mesh.subMeshes.push(u)}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}}},{key:"_combineSubMeshes",value:function(e){var t,i=new Hi;t=this._initCombineMesh(e,i);for(var r=0;r<e.length;r++){var n=e[r];this._combineIndexes(n,i,t),this._combinePositionsAndNormals(n,i,t),this._combineUVs(n,i,t),this._combineExtraData(n,i,t)}return i}},{key:"_initCombineMesh",value:function(e,t,i){var r=0,n=0,o=0,s=0,a=0,l={};i={index:0,vertex:0,uv:0,uv2:0};for(var u=0;u<e.length;u++){var c=e[u];for(var h in r+=c.triangles.length,n+=c.vertices.length,o+=c.uvs.length,s+=c.uv2s.length,a+=c.normals.length,c.extraData)"groups"!==h&&(void 0===l[h]&&(l[h]=0),l[h]+=c.extraData[h].length)}for(var p in t.vertices=new Float32Array(n),t.triangles=new Uint16Array(r),t.uvs=new Float32Array(o),t.uv2s=new Float32Array(s),t.normals=new Float32Array(a),l)t.extraData[p]=new Float32Array(l[p]),i[p]=0;return i}},{key:"_combineIndexes",value:function(e,t,i){for(var r=e.triangles,n=0;n<r.length;n++){var o=r[n];t.triangles[i.index+n]=i.vertex/3+o}i.index+=r.length}},{key:"_combinePositionsAndNormals",value:function(e,t,i){for(var r=e.vertices,n=e.normals,o=0;o<r.length;o++)t.vertices[i.vertex+o]=r[o],t.normals[i.vertex+o]=n[o];i.vertex+=r.length}},{key:"_combineUVs",value:function(e,t,i){for(var r=e.uvs,n=e.uv2s,o=0;o<r.length;o++){var s=r[o];t.uvs[i.uv+o]=s}i.uv+=r.length;for(var a=0;a<n.length;a++){var l=n[a];t.uv2s[i.uv2+a]=l}i.uv2+=n.length}},{key:"_combineExtraData",value:function(e,t,i){var r=e.extraData;for(var n in r)if("groups"!==n){for(var o=r[n],s=0;s<o.length;s++){var a=o[s];t.extraData[n][i[n]+s]=a}i[n]+=o.length}}}]),t}(Vi),Ki=function(e){function t(e){ji(this,t);var i=Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.mesh=new Hi,i.sideVerticesCount=12,i.sideTrianglesCount=6,i.sideUvsCount=8,i.edgeVerticesCount=30,i.edgeUVsCount=20,i.resourceEachSideMeshMap=new Map,i.upDirection=new Bi(0,1,0),i.downDirection=new Bi(0,-1,0),i.vectorUp=new Bi(0,1,0),i}return Di(t,e),Pi(t,[{key:"_initParams",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.mesh=new Hi,this.resourceEachSideMeshMap=new Map}},{key:"_calculate",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this);for(var e=0;e<this.object.corners.length;e++){this.object.corners[e].calculate()}for(var i=0;i<this.object.walls.length;i++){var r=this.object.walls[i];if(r.calculater)if(r.calculater.setObject(r),r.doorOrWindows.length>0){r.calculater.baseBuild(),r.calculater.calPosInfo(),r.calculater.calEachSideLen(),r.calculater.calRepeatUV(),r.calculater.initSimpleCornersAndWalls();for(var n=0;n<r.calculater.subCorners.length;n++){r.calculater.subCorners[n].calculate()}for(var o=0;o<r.calculater.subWalls.length;o++){var s=r.calculater.subWalls[o];s.calculater.setObject(s),s.calculater.baseBuild(),s.calculater.calPosInfo(),s.calculater.calBasePoints(),s.calculater.calUV()}}else r.calculater.baseBuild(),r.calculater.calPosInfo(),r.calculater.calEachSideLen(),r.calculater.calRepeatUV(),r.calculater.calBasePoints()}this._initMesh();for(var a=0;a<this.object.walls.length;a++){var l=this.object.walls[a];if(l.doorOrWindows.length>0)for(var u=0;u<l.calculaterData.subWalls.length;u++){var c=l.calculaterData.subWalls[u];this._addToCombineMesh(c)}else this._addToCombineMesh(l)}}},{key:"_addToCombineMesh",value:function(e){var t=this.resourceEachSideMeshMap.get(e.rightResource).right.mesh,i=this.resourceEachSideMeshMap.get(e.rightResource).right.cursor,r=this.resourceEachSideMeshMap.get(e.leftResource).left.mesh,n=this.resourceEachSideMeshMap.get(e.leftResource).left.cursor,o=this.resourceEachSideMeshMap.get(e.edgeResource).edge.mesh,s=this.resourceEachSideMeshMap.get(e.edgeResource).edge.cursor;this.fillRightMeshInfo(t,i,e),this.fillLeftMeshInfo(r,n,e),this.fillEdgeSideMeshInfo(o,s,e)}},{key:"_initMesh",value:function(){this._initLeftMeshes(),this._initRightMeshes(),this._initEdgeMeshes()}},{key:"_initLeftMeshes",value:function(){var e=!0,t=!1,i=void 0;try{for(var r,n=this.object.leftWallResourceMap.keys()[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){for(var o=r.value,s=this.object.leftWallResourceMap.get(o),a=0,l=0,u=0,c=0;c<s.length;c++){var h=s[c],p=1;if(h.doorOrWindows.length>0){for(var d=0;d<h.doorOrWindows.length;d++){var f=h.doorOrWindows[d];p=1,f.suspendPercent>0&&(p=2),a+=this.sideVerticesCount*p,l+=this.sideTrianglesCount*p,u+=this.sideUvsCount*p}p=h.doorOrWindows.length+1,a+=this.sideVerticesCount*p,l+=this.sideTrianglesCount*p,u+=this.sideUvsCount*p}else a+=this.sideVerticesCount,l+=this.sideTrianglesCount,u+=this.sideUvsCount}var m=new Hi;m.resource=o,this.mesh.subMeshes.push(m),m.vertices=new Float32Array(a),m.normals=new Float32Array(a),m.triangles=new Uint16Array(l),m.uvs=new Float32Array(u),o.isDefault&&(m.uv2s=new Float32Array(u)),this.resourceEachSideMeshMap.has(o)||this.resourceEachSideMeshMap.set(o,{});var g=this.resourceEachSideMeshMap.get(o);g.left||(g.left={mesh:m,cursor:{index:0,vertex:0,uv:0,uv2:0}})}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}}},{key:"_initRightMeshes",value:function(){var e=!0,t=!1,i=void 0;try{for(var r,n=this.object.rightWallResourceMap.keys()[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){for(var o=r.value,s=this.object.rightWallResourceMap.get(o),a=0,l=0,u=0,c=0;c<s.length;c++){var h=s[c],p=1;if(h.doorOrWindows.length>0){for(var d=0;d<h.doorOrWindows.length;d++){var f=h.doorOrWindows[d];p=1,f.suspendPercent>0&&(p=2),a+=this.sideVerticesCount*p,l+=this.sideTrianglesCount*p,u+=this.sideUvsCount*p}p=h.doorOrWindows.length+1,a+=this.sideVerticesCount*p,l+=this.sideTrianglesCount*p,u+=this.sideUvsCount*p}else a+=this.sideVerticesCount,l+=this.sideTrianglesCount,u+=this.sideUvsCount}var m=new Hi;m.resource=o,this.mesh.subMeshes.push(m),m.vertices=new Float32Array(a),m.normals=new Float32Array(a),m.triangles=new Uint16Array(l),m.uvs=new Float32Array(u),o.isDefault&&(m.uv2s=new Float32Array(u)),this.resourceEachSideMeshMap.has(o)||this.resourceEachSideMeshMap.set(o,{});var g=this.resourceEachSideMeshMap.get(o);g.right||(g.right={mesh:m,cursor:{index:0,vertex:0,uv:0,uv2:0}})}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}}},{key:"_initEdgeMeshes",value:function(){for(var e=0,t=0,i=0,r=(Li.wallTopFaceIndexes.length,0);r<this.object.walls.length;r++){var n=this.object.walls[r];if(n.doorOrWindows.length>0)for(var o=0;o<n.calculaterData.subWalls.length;o++){var s=n.calculaterData.subWalls[o];t+=s.calculater.getEdgeTrianglesCount(s),e+=this.edgeVerticesCount,i+=this.edgeUVsCount}else t+=n.calculater.getEdgeTrianglesCount(n),e+=this.edgeVerticesCount,i+=this.edgeUVsCount}var a=new Hi,l=this.object.walls[0].edgeResource;a.resource=l,this.mesh.subMeshes.push(a),a.vertices=new Float32Array(e),a.normals=new Float32Array(e),a.triangles=new Uint16Array(t),a.uvs=new Uint16Array(i),this.resourceEachSideMeshMap.has(l)||this.resourceEachSideMeshMap.set(l,{});var u=this.resourceEachSideMeshMap.get(l);u.edge||(u.edge={mesh:a,cursor:{index:0,vertex:0,uv:0,uv2:0}})}},{key:"changeToParentCoordinate",value:function(){for(var e=0;e<this.object.walls.length;e++){var t=this.object.walls[e],i="StraightManualWall"===t.type?t.position:t.position.toArray();this.changeMeshCoordinate(t.calculater.mesh,i)}}},{key:"changeMeshCoordinate",value:function(e,t){var i="StraightManualWall"===t.type?t.position:t.position.toArray();if(e.vertices)for(var r=0;r<e.vertices.length;){var n=e.vertices;n[r]+=i[0],n[r+1]+=i[1],n[r+2]+=i[2],r+=3}for(var o=0;o<e.subMeshes.length;o++){var s=e.subMeshes[o];this.changeMeshCoordinate(s,t)}}},{key:"fillRightMeshInfo",value:function(e,t,i){var r=t.index,n=t.uv,o=t.uv2,s=t.vertex,a=s/3,l=i.calculaterData,u=Array.isArray(i.position)?i.position:i.position.toArray();e.triangles[r+0]=0+a,e.triangles[r+1]=2+a,e.triangles[r+2]=3+a,e.triangles[r+3]=0+a,e.triangles[r+4]=1+a,e.triangles[r+5]=2+a;var c,h,p,d,f=l.basePoints,m=[f[0],f[4],f[7],f[3]],g=new Bi,v=Li.convertToVector3(i.direction);g.crossVectors(this.downDirection,v),g.normalize(),i.rightResource.isDefault?(c=l.startUVPercent[0],h=l.startUVPercent[1],p=l.endUVPercent[0],d=l.endUVPercent[1]):(c=l.startUVPercent[0]*l.repeatUV[0],h=l.startUVPercent[1]*l.repeatUV[1],p=l.endUVPercent[0]*l.repeatUV[0],d=l.endUVPercent[1]*l.repeatUV[1]),e.uvs[n+0]=c,e.uvs[n+1]=d,e.uvs[n+2]=c,e.uvs[n+3]=h,e.uvs[n+4]=p,e.uvs[n+5]=h,e.uvs[n+6]=p,e.uvs[n+7]=d,i.rightResource.isDefault&&(c=l.startUVPercent[0],h=l.startUVPercent[1],p=l.endUVPercent[0],d=l.endUVPercent[1],e.uv2s[o+0]=c,e.uv2s[o+1]=d,e.uv2s[o+2]=c,e.uv2s[o+3]=h,e.uv2s[o+4]=p,e.uv2s[o+5]=h,e.uv2s[o+6]=p,e.uv2s[o+7]=d);for(var y=0;y<m.length;y++){var b=m[y],_=3*y;e.vertices[s+_]=b.x+u[0],e.vertices[s+_+1]=b.y+i.suspend+u[1],e.vertices[s+_+2]=b.z+u[2],b=g,e.normals[s+_]=b.x,e.normals[s+_+1]=b.y,e.normals[s+_+2]=b.z}t.vertex+=this.sideVerticesCount,t.index+=this.sideTrianglesCount,t.uv+=this.sideUvsCount,i.rightResource.isDefault&&(t.uv2+=this.sideUvsCount)}},{key:"fillLeftMeshInfo",value:function(e,t,i){var r=t.index,n=t.uv,o=t.uv2,s=t.vertex,a=s/3,l=Array.isArray(i.position)?i.position:i.position.toArray();e.triangles[r+0]=3+a,e.triangles[r+1]=1+a,e.triangles[r+2]=0+a,e.triangles[r+3]=3+a,e.triangles[r+4]=2+a,e.triangles[r+5]=1+a;var u,c,h,p,d=i.calculaterData,f=d.basePoints,m=[f[1],f[5],f[6],f[2]],g=new Bi,v=Li.convertToVector3(i.direction);g.crossVectors(v,this.downDirection),g.normalize(),i.leftResource.isDefault?(u=d.startUVPercent[2],c=d.startUVPercent[3],h=d.endUVPercent[2],p=d.endUVPercent[3]):(u=d.startUVPercent[2]*d.repeatUV[2],c=d.startUVPercent[3]*d.repeatUV[3],h=d.endUVPercent[2]*d.repeatUV[2],p=d.endUVPercent[3]*d.repeatUV[3]),e.uvs[n+0]=h,e.uvs[n+1]=p,e.uvs[n+2]=h,e.uvs[n+3]=c,e.uvs[n+4]=u,e.uvs[n+5]=c,e.uvs[n+6]=u,e.uvs[n+7]=p,i.leftResource.isDefault&&(u=d.startUVPercent[0],c=d.startUVPercent[1],h=d.endUVPercent[0],p=d.endUVPercent[1],e.uv2s[o+0]=u,e.uv2s[o+1]=p,e.uv2s[o+2]=u,e.uv2s[o+3]=c,e.uv2s[o+4]=h,e.uv2s[o+5]=c,e.uv2s[o+6]=h,e.uv2s[o+7]=p);for(var y=0;y<m.length;y++){var b=m[y],_=3*y;e.vertices[s+_]=b.x+l[0],e.vertices[s+_+1]=b.y+i.suspend+l[1],e.vertices[s+_+2]=b.z+l[2],b=g,e.normals[s+_]=b.x,e.normals[s+_+1]=b.y,e.normals[s+_+2]=b.z}t.vertex+=this.sideVerticesCount,t.index+=this.sideTrianglesCount,t.uv+=this.sideUvsCount,i.leftResource.isDefault&&(t.uv2+=this.sideUvsCount)}},{key:"fillEdgeSideMeshInfo",value:function(e,t,i){for(var r=t.index,n=(t.uv,t.uv2,t.vertex),o=n/3,s=Array.isArray(i.position)?i.position:i.position.toArray(),a=Li.wallTopFaceIndexes,l=Li.wallStartFaceIndexes,u=Li.wallEndFaceIndexes,c=Li.wallStartCornerFaceIndexes,h=Li.wallEndCornerFaceIndexes,p=Li.wallBottomFaceIndexes,d=i.calculaterData,f=a.length,m=0;m<a.length;m++)e.triangles[r+m]=a[m]+o;if(i.calculater.shouldAddSideIndexes(i.startCorner)){for(var g=0;g<l.length;g++)e.triangles[r+f+g]=l[g]+o;f+=l.length}if(i.calculater.shouldAddSideIndexes(i.endCorner)){for(var v=0;v<u.length;v++)e.triangles[r+f+v]=u[v]+o;f+=u.length}if(i.startCorner.walls.length>2){for(var y=0;y<c.length;y++)e.triangles[r+f+y]=c[y]+o;f+=c.length}if(i.endCorner.walls.length>2){for(var b=0;b<h.length;b++)e.triangles[r+f+b]=h[b]+o;f+=h.length}if(0!==i.suspend)for(var _=0;_<p.length;_++)e.triangles[r+f+_]=p[_]+o;for(var x=d.basePoints,E=[x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9]],w=0;w<E.length;w++){var T=E[w],M=3*w;e.vertices[n+M]=T.x+s[0],e.vertices[n+M+1]=T.y+i.suspend+s[1],e.vertices[n+M+2]=T.z+s[2]}for(var C=0;C<E.length;C++){var S=this.upDirection,j=3*C;e.normals[n+j]=S.x,e.normals[n+j+1]=S.y,e.normals[n+j+2]=S.z}t.vertex+=this.edgeVerticesCount,t.index+=f,t.uv+=this.edgeUVsCount}}]),t}(Qi),$i=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),Pi(t,[{key:"build",value:function(e){}}]),t}(Vi),er=function(e){function t(e){ji(this,t);var i=Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.upVector3=new Bi(0,1,0),i.downVector3=new Bi(0,-1,0),i.backwardVector3=new Bi(0,0,-1),i}return Di(t,e),Pi(t,[{key:"_calculate",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this);var e=this.object.attachWall,i=new Oi;if(e){var r=Li.convertToVector3(e.direction),n=new Bi;this.isSingleOpen()||this.hasAnimation||this.hasController?n.crossVectors(this.upVector3,r):n.crossVectors(this.downVector3,r),i.setFromUnitVectors(this.backwardVector3,n),this.object.rotation=[i.x,i.y,i.z,i.w],this.object.position[1]=e.height*this.object.suspendPercent}}},{key:"isSingleOpen",value:function(){var e=this.object.resource.model.getObjectByName("Controller");return!!e&&1===e.children.length}},{key:"hasAnimation",get:function(){return!!(this.object.resource&&this.object.resource.animations&&this.object.resource.animations.length>0)}},{key:"hasController",get:function(){return!!this.object.resource&&!!this.object.resource.model.getObjectByName("Controller")}}]),t}(Vi),tr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),Pi(t,[{key:"setObject",value:function(e){this.object=e,this.startCorner=this.object.startCorner,this.endCorner=this.object.endCorner,this.startCornerPosition=Li.convertToVector3(this.startCorner.position),this.endCornerPosition=Li.convertToVector3(this.endCorner.position),this.position=Li.convertToVector3(this.object.position),this.direction=Li.convertToVector3(this.object.direction),this.suspend=this.object.suspend,this.doorOrWindows=this.object.doorOrWindows,this.object.calculaterData.subWalls=[],this.object.calculaterData.subCorners=[],this.subWalls=this.object.calculaterData.subWalls,this.subCorners=this.object.calculaterData.subCorners;var t=e.calculaterData;t.pathPoints=[],t.selfPathPoints=[],t.startUVPercent=[0,0,0,0],t.endUVPercent=[1,1,1,1],t.basePoints=[],this.pathPoints=t.pathPoints,this.selfPathPoints=t.selfPathPoints,this.cornersVertices=[this.object.startCorner.calculaterData[this.object.id][0],this.object.startCorner.calculaterData[this.object.id][1],this.object.endCorner.calculaterData[this.object.id][0],this.object.endCorner.calculaterData[this.object.id][1]],t.cornersVertices=this.cornersVertices,this.basePoints=t.basePoints;for(var i=0;i<12;i++)this.basePoints.push(new Bi);this.repeatUV=t.repeatUV,this.startUVPercent=t.startUVPercent,this.endUVPercent=t.endUVPercent}},{key:"build",value:function(e){this.setObject(e),this._calculate(),this.object.calculaterMesh=this.mesh}},{key:"_calculate",value:function(){this.leftMesh=new Hi,this.rightMesh=new Hi,this.edgeMesh=new Hi,this.mesh=new Hi,this.suspend=this.object.suspend,this.initMeshInfo()}},{key:"initMeshInfo",value:function(){this.baseBuild(),this.calPosInfo(),this.calBasePoints(),this.calUV(),this.fillMesh(),this.changeToParentWallLocal(this.mesh)}},{key:"calUV",value:function(){this.calPosInfo(),this.calEachSideLen();var e=this.object.parentWall.calculaterData,t=this.object.calculaterData.buildType,i=this.object.calculaterData.doorOrWindows,r=this.object.calculaterData.index,n=this.object.length,o=Li.convertToVector3(this.object.parentWall.position);if("start"===t)this.object.calculaterData.endUVPercent[0]=this.rightSideLength/e.rightSideLength,this.object.calculaterData.startUVPercent[2]=(e.leftSideLength-this.leftSideLength)/e.leftSideLength;else if("end"===t){var s=this.getDoorOrWinRectPoints(i[r])[3].distanceTo(o.clone().addVectors(e.cornersVertices[0],o));this.object.calculaterData.startUVPercent[0]=s/e.rightSideLength,this.object.calculaterData.endUVPercent[2]=this.object.calculaterData.leftSideLength/e.leftSideLength,this.object.calculaterData.repeatUV=this.repeatUV}else{var a=i[r-1],l=this.getDoorOrWinRectPoints(a),u=(s=l[3].distanceTo(o.clone().addVectors(e.cornersVertices[0],o)),l[2].distanceTo(o.clone().addVectors(e.cornersVertices[2],o)));this.startUVPercent[0]=s/e.rightSideLength,this.startUVPercent[2]=(u-n)/e.leftSideLength,this.endUVPercent[0]=(s+n)/e.rightSideLength,this.endUVPercent[2]=u/e.leftSideLength}}},{key:"changeToParentWallLocal",value:function(e){for(var t=this.object.parentWall.position,i=0;i<e.vertices.length;)e.vertices[i]+=this.object.position.x-t[0],e.vertices[i+1]+=this.object.position.y-t[1],e.vertices[i+2]+=this.object.position.z-t[2],i+=3;for(var r=0;r<e.subMeshes.length;r++){var n=e.subMeshes[r];this.changeToParentWallLocal(n)}}},{key:"shouldAddSideIndexes",value:function(e){return"WallCorner"!==e.type||Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"shouldAddSideIndexes",this).call(this,e)}}]),t}(Zi),ir=function(){function e(t,i){ji(this,e),this._initParams(),this.resource=t,this.modelMesh=i,this.maxCount=65534}return Pi(e,[{key:"_initParams",value:function(){this.vertexCount=0,this.indexCount=0,this.resource=null,this.modelMesh=null,this.groups=null,this.transformations=null,this.maxCount=null,this.combineMesh=null}},{key:"isExceed",value:function(e){return this.vertexCount+e>this.maxCount}},{key:"clear",value:function(){this._initParams()}}]),e}(),rr=function(e){function t(e,i){ji(this,t);var r=Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.mesh=new Hi,r.mesh.resource=e,r.modelMeshVerticeLength=r.modelMesh.vertices.length/3,r.combineProgressIndexMap={},r.transformations=[],r._tempPosition=new Float32Array(3),r._tempNormal=new Float32Array(3),r.groupsCountArray=null,r}return Di(t,e),Pi(t,[{key:"_initParams",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.mesh=null,this.modelMeshVerticeLength=null,this.combineProgressIndexMap=null,this.transformations=null}},{key:"add",value:function(e){this.vertexCount+=this.modelMeshVerticeLength,this.indexCount+=this.modelMesh.triangles.length,this.transformations.push(e)}},{key:"combine",value:function(){this._initMesh();for(var e=0;e<this.transformations.length;e++){var t=this.transformations[e];this._combineVertices(t),this._combineNormals(t),this._combineUVs(),this._combineTriangles(t),this._combineExtraData(),this.combineProgressIndexMap.vertices+=this.modelMesh.vertices.length,this.combineProgressIndexMap.triangles+=this.modelMesh.triangles.length,this.combineProgressIndexMap.uv+=this.modelMesh.uvs.length}}},{key:"_initMesh",value:function(){this.minusScaleCount=0,this.mesh.vertices=new Float32Array(3*this.vertexCount),this.mesh.normals=new Float32Array(3*this.vertexCount),this.mesh.uvs=new Float32Array(2*this.vertexCount),this.modelMesh.uv2s.length>0&&(this.mesh.uv2s=new Float32Array(2*this.vertexCount)),this.mesh.triangles=new Uint16Array(this.indexCount),this.combineProgressIndexMap={vertices:0,triangles:0,uv:0};var e=this.modelMesh.extraData;for(var t in e)if("groups"===t&&this.modelMesh.extraData[t].length>0){var i=this.cloneGroups(this.modelMesh.extraData[t]);this.combineProgressIndexMap.groups=[];for(var r=0;r<i.length;r++){i[r].count*=this.transformations.length,i.start*=this.transformations.length,this.combineProgressIndexMap.groups.push({currentIndex:i[r].start})}this.mesh.extraData[t]=i}else{var n=this.modelMesh.extraData[t].length*this.transformations.length;this.mesh.extraData[t]=new Float32Array(n),this.combineProgressIndexMap[t]=0}}},{key:"_combineVertices",value:function(e){for(var t=this.combineProgressIndexMap.vertices,i=this.modelMesh.vertices,r=e.positions,n=e.scales,o=e.quaternions,s=this._tempPosition,a=0;a<i.length;a+=3){s[0]=i[a],s[1]=i[a+1],s[2]=i[a+2];for(var l=r.length-1;l>-1;l--){var u=r[l],c=n[l],h=o[l];1===c[0]&&1===c[1]&&1===c[2]||(s[0]*=c[0],s[1]*=c[1],s[2]*=c[2]),Li.applyQuaternionToVector3(h,s),0!==u[0]&&(s[0]+=u[0]),0!==u[1]&&(s[1]+=u[1]),0!==u[2]&&(s[2]+=u[2])}this.mesh.vertices[t]=s[0],this.mesh.vertices[t+1]=s[1],this.mesh.vertices[t+2]=s[2],t+=3}}},{key:"_combineNormals",value:function(e){for(var t=this.combineProgressIndexMap.vertices,i=e.scales,r=this.modelMesh.normals,n=e.quaternions,o=this._tempNormal,s=0;s<r.length;s+=3){o[0]=r[s],o[1]=r[s+1],o[2]=r[s+2];for(var a=n.length-1;a>-1;a--){var l=n[a];this._changeNormalByMinusScale(i[a],o),Li.applyQuaternionToVector3(l,o)}this.mesh.normals[t]=o[0],this.mesh.normals[t+1]=o[1],this.mesh.normals[t+2]=o[2],t+=3}}},{key:"_changeNormalByMinusScale",value:function(e,t){for(var i=0;i<e.length;i++){e[i]<0&&(t[i]=-t[i])}}},{key:"_combineUVs",value:function(){for(var e=this.modelMesh.uvs,t=this.modelMesh.uv2s,i=this.combineProgressIndexMap.uv,r=0;r<e.length;r++){var n=e[r];this.mesh.uvs[i+r]=n}for(var o=0;o<t.length;o++){var s=t[o];this.mesh.uv2s[i+o]=s}}},{key:"_combineTriangles",value:function(e){for(var t=e.scales,i=0,r=0;r<t.length;r++){var n=t[r];0===i&&(i=this._calMinusScaleCount(n))}var o=this.combineProgressIndexMap.vertices/3,s=this.combineProgressIndexMap.triangles,a=this.modelMesh.triangles;if(this.combineProgressIndexMap.groups)for(var l=this.modelMesh.extraData.groups,u=0;u<l.length;u++){var c=l[u],h=c.start,p=c.count,d=this.combineProgressIndexMap.groups[u];if(1===i||3===i)for(var f=0;f<p;)this.mesh.triangles[d.currentIndex+f+2]=o+a[h+f],this.mesh.triangles[d.currentIndex+f+1]=o+a[h+f+1],this.mesh.triangles[d.currentIndex+f]=o+a[h+f+2],f+=3;else for(var m=0;m<p;m++)this.mesh.triangles[d.currentIndex+m]=o+a[h+m];d.currentIndex+=p}else if(1===i||3===i)for(var g=0;g<a.length;)this.mesh.triangles[s+g+2]=o+a[g],this.mesh.triangles[s+g+1]=o+a[g+1],this.mesh.triangles[s+g]=o+a[g+2],g+=3;else for(var v=0;v<a.length;v++){var y=a[v];this.mesh.triangles[s+v]=o+y}}},{key:"_calMinusScaleCount",value:function(e){for(var t=0,i=0;i<e.length;i++){e[i]<0&&t++}return t}},{key:"_combineExtraData",value:function(){var e=this.modelMesh.extraData;for(var t in e)if(!("groups"===t&&e[t].length>0)){for(var i=e[t],r=this.combineProgressIndexMap[t],n=0;n<i.length;n++){var o=i[n];this.mesh.extraData[t][r+n]=o}this.combineProgressIndexMap[t]+=i.length}}},{key:"cloneGroups",value:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];t.push(Li.cloneJSObject(r))}return t}},{key:"clear",value:function(){this._initParams(),Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(ir),nr=function(){function e(t,i){ji(this,e),this._initParams(),this.mesh=new Hi,this.resource=t,this.modelMesh=i,this.subMeshProcessors=[],this.modelMeshVerticeLength=this.modelMesh.vertices.length/3,this.currentSubMeshProcessor=this._createSubMeshProcessor()}return Pi(e,[{key:"_initParams",value:function(){this.mesh=null,this.resource=null,this.modelMesh=null,this.subMeshProcessors=null,this.modelMeshVerticeLength=null,this.currentSubMeshProcessor=null}},{key:"_createSubMeshProcessor",value:function(){var e=new rr(this.resource,this.modelMesh);return this.subMeshProcessors.push(e),e}},{key:"add",value:function(e){this.currentSubMeshProcessor.isExceed(this.modelMeshVerticeLength)&&(this.currentSubMeshProcessor=this._createSubMeshProcessor()),this.currentSubMeshProcessor.add(e)}},{key:"combine",value:function(){for(var e=0;e<this.subMeshProcessors.length;e++){var t=this.subMeshProcessors[e];t.combine(),this.mesh.subMeshes.push(t.mesh)}1===this.subMeshProcessors.length&&(this.mesh=this.mesh.subMeshes[0])}},{key:"clear",value:function(){this._initParams()}}]),e}(),or=function(e){function t(e){ji(this,t);var i=Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.isResourceVertexExceed=!1,i}return Di(t,e),Pi(t,[{key:"_initParams",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.processorMap=new Map,this.processors=[],this.isResourceVertexExceed=!1}},{key:"_calculate",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this),this._initResources(),this.isResourceVertexExceed||(this._fillProcessors(),this._createMesh())}},{key:"_initResources",value:function(){for(var e=this.object.resources,t=0;t<e.length;t++){var i=e[t];if(this.resourceCombineManager.getCombineMesh(i),i.vertexIsExceed)return void(this.isResourceVertexExceed=!0)}for(var r=0;r<e.length;r++){var n=e[r];this._initProcessors(n)}}},{key:"_initProcessors",value:function(e){var t=this.resourceCombineManager.getCombineMesh(e);this._createProcessorByResourceBuilderMesh(e,t)}},{key:"_createProcessorByResourceBuilderMesh",value:function(e,t){if(this.processorMap[e.id]||(this.processorMap[e.id]=[]),t.resource){var i=new nr(t.resource,t);this.processorMap[e.id].push(i),this.processors.push(i)}for(var r=0;r<t.subMeshes.length;r++){var n=t.subMeshes[r];this._createProcessorByResourceBuilderMesh(e,n)}}},{key:"_fillProcessors",value:function(){}},{key:"_createMesh",value:function(){for(var e=0;e<this.processors.length;e++){var t=this.processors[e];t.combine(),this.mesh.subMeshes.push(t.mesh)}}},{key:"addSingleTransformationToProcessors",value:function(e){for(var t=0;t<this.processors.length;t++){this.processors[t].add(e)}}}]),t}(Qi),sr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),Pi(t,[{key:"_fillProcessors",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_fillProcessors",this).call(this),this.addTransformationToProcessor()}},{key:"addTransformationToProcessor",value:function(){for(var e=0;e<this.object.transformations.length;e++){var t=this.object.transformations[e];this.addSingleTransformationToProcessors(t)}}},{key:"clear",value:function(){for(var e=0;e<this.processors.length;e++){this.processors[e].clear()}Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(or),ar=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),t}(Vi),lr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),Pi(t,[{key:"_calculate",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this)}}]),t}(Vi),ur=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),t}(lr),cr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),t}(lr),hr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),Pi(t,[{key:"_calculate",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this)}}]),t}(Qi),pr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),t}(Qi),dr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),t}(Qi),fr=function e(t){ji(this,e)},mr=function(){function e(t){ji(this,e),this.combineBundleObjectMaps={},this.CombineBuilderClass=fr}return Pi(e,[{key:"getCombineBundleObject",value:function(e){this.combineBundleObjectMaps[e.id]}},{key:"createCombineBuilder",value:function(e){return new this.CombineBuilderClass({resource:e})}},{key:"clear",value:function(){this.combineBundleObjectMaps={},this.CombineBuilderClass=null}}]),e}(),gr=new mr,vr=function(){function e(){ji(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return Pi(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),yr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),Pi(t,[{key:"_initParams",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.modelNumber=-1,this.models=[],this.objPositions=[],this.objLocalPositions=[],this.objRotations=[],this.objScales=[],this.transformations=[],this.processorMap=new Map,this.processors=[],this.wallPosition=null}},{key:"registerCombineBuilder",value:function(e){var t=gr.createCombineBuilder(e);e.containBuilder(e.id)||e.registerBuilder(e.id,t)}},{key:"_calculate",value:function(){this.mesh=new Hi;for(var e=this.object.resources,t=0;t<e.length;t++){var i=e[t];this._initProcessors(i)}if(this.object.doorOrWindows.length>0){this.initSimpleCornersAndWalls();for(var r=0;r<this.subWalls.length;r++){var n=this.subWalls[r];n.calculate(),this.mesh.subMeshes.push(n.calculater.mesh)}}else this.calObjInfo();this.addTransformationToProcessor();for(var o=0;o<this.processors.length;o++){var s=this.processors[o];s.combine(),this.mesh.subMeshes.push(s.mesh)}}},{key:"instanceModels",value:function(){if(null!==this.object.model){this.models=[];for(var e=this.modelNumber,t=0;t<e;t++){var i=this.model.clone(),r=this.objPositions[t],n=this.objRotations[t],o=this.objScales[t];i.position.set(r.x,r.y,r.z),i.quaternion.set(n.x,n.y,n.z,n.w),i.scale.set(o.x,o.y,o.z),this.mesh.add(i),this.models.push(i)}}}},{key:"calObjInfo",value:function(){this.objPositions=[],this.objRotations=[],this.objScales=[];var e=Li.convertToVector3(this.object.startCorner.position),t=(Li.convertToVector3(this.object.endCorner.position),Li.convertToVector3(this.object.direction)),i=Li.convertToVector3(this.object.position);this.wallPosition=i,this.modelSize=this.object.resource.size,-1===this.object.height?this.object.height=this.modelSize[1]:0!==this.modelSize[1]?this.heightRatio=this.object.height/this.modelSize[1]:(console.warn("model size is zero "+this.object.resource.id),this.object.height=3);var r=new Bi(0,-1,0),n=this.modelSize[0],o=(this.modelSize[2],this.modelSize[1]),s=this.object.length/n,a=parseInt(s),l=Math.ceil(s);this.modelNumber=l;var u=l*n,c=new Bi,h=t.clone();c.addVectors(e,h.multiplyScalar(u));var p=new Bi;p.crossVectors(t,r),p.normalize();var d=new Oi;0===p.x&&0===p.y&&0===p.z||d.setFromUnitVectors(new Bi(0,0,-1),p);var f=.5*n,m=new Bi(f,this.object.suspend,0);m.applyQuaternion(d),d.multiply(new Oi(0,1,0,0));for(var g=0;g<l;g++){var v=g/l,y=new Bi;y.lerpVectors(e,c,v);var b=new Bi;b.addVectors(m,y);var _=new Bi(1,this.object.height/o,1);this.objPositions.push(b),this.objRotations.push(d),this.objScales.push(_)}var x=(s-a)*n,E=x/n;if(l>0&&x>0){this.objScales[l-1]=new Bi(E,this.object.height/o,1);var w=new Bi(f*(1-E),0,0);w.applyQuaternion(d),this.objPositions[l-1].add(w)}for(var T=0;T<this.objPositions.length;T++){var M=this.objPositions[T],C=this.objScales[T],S=this.objRotations[T],j=new vr;new Bi;j.positions.push(M.toArray()),j.quaternions.push(S.toArray()),j.scales.push(C.toArray()),this.transformations.push(j)}}},{key:"initSimpleCornersAndWalls",value:function(){for(var e=this.sortDoorOrWins(),t=0;t<e.length;t++){var i=e[t],r=this.getDoorOrWinStartAndEndPos(i),n=Xi.createSubWallCorner(this.id+"_"+t+"_1",r[0],this),o=Xi.createSubWallCorner(this.id+"_"+t+"_2",r[1],this);if(this.addSubWallCorner(n),this.addSubWallCorner(o),0===t){var s=this.objectManager.create({type:Ji.SubModelWall});s.resource=this.object.resource,this.subWalls.push(s),s.startCorner=this.object.startCorner,s.endCorner=n,s.startCorner.calculate(),s.endCorner.calculate(),s.parentWall=this.object,s.height=this.object.height}else{var a=e[t-1],l=this.getDoorOrWinStartAndEndPos(a),u=this.getWallCornerByPos(l[1]),c=this.objectManager.create({type:Ji.SubModelWall});c.resource=this.object.resource,this.subWalls.push(c),c.startCorner=u,c.endCorner=n,c.startCorner.calculate(),c.endCorner.calculate(),c.parentWall=this.object,c.height=this.object.height}if(t===e.length-1){var h=this.objectManager.create({type:Ji.SubModelWall});h.resource=this.object.resource,this.subWalls.push(h),h.startCorner=o,h.endCorner=this.object.endCorner,h.startCorner.calculate(),h.parentWall=this.object,h.height=this.object.height}this.buildHeadAndFootWall(i,n,o)}}},{key:"buildSimpleCornersAndWalls",value:function(){this.wallGroup=new THREE.Object3D;for(var e=0;e<this.subCorners.length;e++){this.subCorners[e].build()}for(e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.wallGroup.add(t.wallGroup)}}},{key:"buildHeadAndFootWall",value:function(e,t,i){if(!this.object.resource.isSupportHeadAndFootModelWall)return!1;var r=e.suspendPercent;if(0!==r){var n=this.objectManager.create({type:Ji.SubModelWall});this.subWalls.push(n),n.resource=this.object.resource,n.parentWall=this.object,n.startCorner=t,n.endCorner=i,n.height=this.object.height*r}e.size;var o=e.size[1]+this.object.height*r;if(o<this.object.height){var s=this.objectManager.create({type:Ji.SubModelWall});this.subWalls.push(s),s.resource=this.object.resource,s.parentWall=this.object,s.startCorner=t,s.endCorner=i,s.suspend=o,s.height=this.object.height-o}}},{key:"_initProcessors",value:function(e){e.buildRegisterBuilder();var t=e.getBuilder(e.id).mesh;this._createProcessorByResourceBuilderMesh(t)}},{key:"_createProcessorByResourceBuilderMesh",value:function(e){if(e.resource&&!this.processorMap.has(e.resource)){var t=new nr(e.resource,e);this.processorMap.set(e.resource,t),this.processors.push(t)}for(var i=0;i<e.subMeshes.length;i++){var r=e.subMeshes[i];this._createProcessorByResourceBuilderMesh(r)}}},{key:"addTransformationToProcessor",value:function(){for(var e=0;e<this.transformations.length;e++)for(var t=this.transformations[e],i=0;i<this.processors.length;i++){this.processors[i].add(t)}}}]),t}(Yi),br=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),t}(yr),_r=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),Pi(t,[{key:"_fillProcessors",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_fillProcessors",this).call(this);for(var e=0;e<this.object.walls.length;e++){var i=this.object.walls[e];if(i.calculater)if(i.calculater.setObject(i),i.doorOrWindows.length>0){i.calculater.initSimpleCornersAndWalls();for(var r=0;r<i.calculater.subWalls.length;r++){var n=i.calculater.subWalls[r];n.calculater.setObject(n),n.calculater.calObjInfo(),this.addTransformationToProcessor(n.calculater.transformations)}}else i.calculater.calObjInfo(),this.addTransformationToProcessor(i.calculater.transformations);else console.log("wall not have calculater")}}},{key:"changeToParentCoordinate",value:function(){for(var e=0;e<this.object.walls.length;e++){var t=this.object.walls[e];this.changeMeshCoordinate(t.calculater.mesh,t.position)}}},{key:"changeMeshCoordinate",value:function(e,t){for(var i=0;i<e.vertices.length;){var r=e.vertices;r[i]+=t[0],r[i+1]+=t[1],r[i+2]+=t[2],i+=3}for(var n=0;n<e.subMeshes.length;n++){var o=e.subMeshes[n];this.changeMeshCoordinate(o,t)}}},{key:"addTransformationToProcessor",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];this.addSingleTransformationToProcessors(i)}}}]),t}(or),xr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),t}(Vi),Er=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),Pi(t,[{key:"_initParams",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.transformationMap={}}},{key:"_fillProcessors",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_fillProcessors",this).call(this),this._initTransformationMap(),this.addTransformationToProcessor()}},{key:"_initTransformationMap",value:function(){for(var e=this.object.objects,t=0;t<e.length;t++){var i=e[t];this._calSingleObjectTransformation(i)}}},{key:"_calSingleObjectTransformation",value:function(e,t){if(t||(t=new vr),t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),"PlacementGroup"!==e.type&&0===e.children.length)this.transformationMap[e.resource.id]||(this.transformationMap[e.resource.id]=[]),this.transformationMap[e.resource.id].push(t);else for(var i=0;i<e.children.length;i++){var r=e.children[i];this._calSingleObjectTransformation(r,t.clone())}}},{key:"addTransformationToProcessor",value:function(){for(var e in this.transformationMap)for(var t=this.transformationMap[e],i=this.processorMap[e],r=0;r<t.length;r++)for(var n=t[r],o=0;o<i.length;o++){i[o].add(n)}}},{key:"clear",value:function(){for(var e=0;e<this.processors.length;e++){this.processors[e].clear()}Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(or),wr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),t}($i),Tr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),t}($i),Mr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),t}($i),Cr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),t}(sr),Sr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),Pi(t,[{key:"_fillProcessors",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_fillProcessors",this).call(this);for(var e=0;e<this.object.objects.length;e++){this.object.objects[e].calculate()}this.addTransformationToProcessor()}},{key:"_classifyChangeDirectionOrOpenObject",value:function(){for(var e=[],t=[],i=0;i<this.object.objects.length;i++){var r=this.object.objects[i];r.isOpen||0!==r.openDirIndex?e.push(r):t.push(r)}this.object.objects=t,this.object.notCombineObjects=e}},{key:"addTransformationToProcessor",value:function(){for(var e=0;e<this.object.objects.length;e++){var t=this.object.objects[e],i=new vr;i.positions.push(t.position),i.scales.push(t.scale),i.quaternions.push(t.rotation),this.addSingleTransformationToProcessors(i)}}},{key:"clear",value:function(){for(var e=0;e<this.processors.length;e++){this.processors[e].clear()}Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(or),jr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),t}(Vi),Pr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),Pi(t,[{key:"calUV",value:function(){this.calPosInfo(),this.calEachSideLen();var e=this.object.parentWall.calculaterData,t=Li.convertToVector3(this.object.parentWall.position),i=this.object.length,r=this.getDoorOrWinRectPoints(this.object.calculaterData.doorOrWindow),n=r[0].distanceTo(t.clone().addVectors(e.cornersVertices[0],t)),o=r[2].distanceTo(t.clone().addVectors(e.cornersVertices[2],t)),s=this.object.calculaterData;if("down"===s.buildType)s.startUVPercent=[n/e.rightSideLength,0,o/e.leftSideLength,0],s.endUVPercent[0]=(n+i)/e.rightSideLength,s.endUVPercent[1]=this.object.height/this.object.parentWall.height,s.endUVPercent[2]=(o+i)/e.leftSideLength,s.endUVPercent[3]=this.object.height/this.object.parentWall.height,this.startUVPercent=s.startUVPercent,this.endUVPercent=s.endUVPercent;else if("up"===s.buildType){var a=this.object.calculaterData.doorOrWindow.suspendPercent,l=Li.convertToVector3(this.object.calculaterData.doorOrWindow.size).y+this.object.parentWall.height*a;s.startUVPercent=[n/e.rightSideLength,l/this.object.parentWall.height,o/e.leftSideLength,l/this.object.parentWall.height],s.endUVPercent[0]=(n+i)/e.rightSideLength,s.endUVPercent[2]=(o+i)/e.leftSideLength,this.startUVPercent=s.startUVPercent,this.endUVPercent=s.endUVPercent}}},{key:"shouldAddSideIndexes",value:function(e){return!1}}]),t}(tr),Rr={SubWallCorner:qi,SubStraightManualWall:tr,SubDoorOrWindowStraightManualWall:Pr,DoorOrWindow:er,Placement:$i,StraightManualWall:Zi,WallCorner:Gi,CombineStraightManualWall:Ki,CombinePlacement:sr,Room:ar,Floor:lr,Ceiling:ur,Roof:cr,CombineFloor:hr,CombineCeiling:pr,CombineRoof:dr,CombineModelWall:_r,ModelWall:yr,SubModelWall:br,PlacementGroup:xr,CombinePlacementGroup:Er,FacadeGroup:wr,Facade:Tr,PlacementGround:xr,PlacementWall:Mr,CombinePlacementWall:Cr,CombineDoorOrWindow:Sr,FloorPlan:jr,Outdoors:jr},Dr=function(e){function t(){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return Di(t,e),Pi(t,[{key:"_initParams",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._startCorner=null,this._endCorner=null,this.thick=-1,this.height=-1,this._length=null,this.pathPoints=[],this._direction=null,this.doorOrWindows=[],this.subWalls=[],this.subCorners=[],this.suspend=0,this.mesh=null,this.isShow=!0,this.isContainer=!1,this._position=null}},{key:"getWallOtherCorner",value:function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null}},{key:"sortDoorOrWins",value:function(){var e=this.startCorner.position,t=this.endCorner.position,i=t.x-e.x>0?1:-1,r=t.z-e.z>0?1:-1,n=!0;Math.abs(t.x-e.x)<.001&&(n=!1);for(var o=[],s=0;s<this.doorOrWindows.length;s++){for(var a=this.doorOrWindows[s],l=0;l<o.length;l++){var u=o[l];if((n?(u.position.x-a.position.x)*i:(u.position.z-a.position.z)*r)>=0){o.splice(l,0,a);break}if(l==o.length-1){o.push(a);break}}0===o.length&&o.push(a)}return o}},{key:"getWallCornerByPos",value:function(e){for(var t=null,i=-1,r=this.subCorners,n=0;n<r.length;n++){var o=e.distanceTo(r[n].position);o<.01&&(null===t?(t=r[n],i=o):o<i&&(i=o,t=r[n]))}return t}},{key:"getDoorOrWinStartAndEndPos",value:function(e){var t=e.size,i=this.direction,r=e.position.clone();r.y=0;var n=r.clone(),o=r.clone(),s=t.x/2;return n.subVectors(n,i.clone().multiplyScalar(s)),o.addVectors(o,i.clone().multiplyScalar(s)),[n,o]}},{key:"addSubWallCorner",value:function(e){for(var t=0;t<this.subCorners.length;t++){if(this.subCorners[t]===e)return}this.subCorners.push(e)}},{key:"addToParentCollector",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.walls.push(this)}},{key:"clear",value:function(){for(var e=0;e<this.subWalls.length;e++){this.subWalls[e].clear()}for(var i=0;i<this.subCorners.length;i++){this.subCorners[i].clear()}Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"startCorner",get:function(){return this._startCorner},set:function(e){this._startCorner=e,this._startCorner&&this._startCorner.addWall(this)}},{key:"endCorner",get:function(){return this._endCorner},set:function(e){this._endCorner=e,this._endCorner&&this._endCorner.addWall(this)}},{key:"length",get:function(){if(null===this._length){var e=new Bi;e.subVectors(Li.convertToVector3(this.endCorner.position),Li.convertToVector3(this.startCorner.position)),this._length=e.length()}return this._length}},{key:"direction",get:function(){return null===this._direction&&(this._direction=new Bi,this._direction.subVectors(Li.convertToVector3(this.endCorner.position),Li.convertToVector3(this.startCorner.position)),this._direction.normalize()),this._direction}},{key:"size",get:function(){if(null===this._size){var e=new Bi,t=this.startCorner.position,i=this.endCorner.position;e.x=Math.abs(t.x-i.x),e.z=Math.abs(t.z-i.z),e.y=this.height,0===e.x&&(e.x=this.thick),0===e.z&&(e.z=this.thick),this._size=e}return this._size}},{key:"position",get:function(){if(!this._position){this.startCorner.position,this.endCorner.position;this._position=new Bi,this._position.subVectors(Li.convertToVector3(this.endCorner.position),Li.convertToVector3(this.startCorner.position)),this._position=this._position.divideScalar(2)}return this._position},set:function(e){this._position=e}}]),t}(Ui),Ar=function(e){function t(){ji(this,t);var e=Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="SubStraightManualWall",e}return Di(t,e),Pi(t,[{key:"_initParams",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.parentWall=null}},{key:"build",value:function(){this.calculate()}},{key:"parent",get:function(){return this.parentWall.parent}},{key:"position",get:function(){var e=Li.convertToVector3(this.startCorner.position),t=Li.convertToVector3(this.endCorner.position),i=new Bi;return i.addVectors(e,t),i.divideScalar(2),i},set:function(e){}}]),t}(Dr),kr=function(e){function t(){ji(this,t);var e=Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.objPositions=[],e.objLocalPositions=[],e.objRotations=[],e.objScales=[],e.heightRatio=1,e.modelNumber=-1,e.type="SubModelWall",e}return Di(t,e),Pi(t,[{key:"_initParams",value:function(){Ri(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.resource=null,this.objPositions=null,this.objLocalPositions=null,this.objRotations=null,this.objScales=null,this.heightRatio=null,this.modelNumber=null}},{key:"build",value:function(){this.calculate()}}]),t}(Dr),Or=function(e){function t(){ji(this,t);var e=Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="SubDoorOrWindowStraightManualWall",e}return Di(t,e),t}(Ar),Br={SubStraightManualWall:Ar,SubModelWall:kr,SubDoorOrWindowStraightManualWall:Or,SubWallCorner:qi},Fr=function(){function e(){ji(this,e),this.objects=[],this.calculaterManager=null,this.meshBuilderManager=null,this.ClassName=Ji}return Pi(e,[{key:"create",value:function(e){var t=e.type,i=(e.parent,new(0,Br[t]));return this.calculaterManager&&(i.calculater=this.calculaterManager.create({type:t,object:i})),i}}]),e}(),Lr=function(e){function t(e){return ji(this,t),Ai(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Di(t,e),t}(Vi),Ir="function"==typeof Symbol&&"symbol"===Si(Symbol.iterator)?function(e){return void 0===e?"undefined":Si(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":Si(e)},Nr=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ur=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),zr=function(){function e(t){Nr(this,e),this._init()}return Ur(e,[{key:"_init",value:function(){this.vertices=[],this.normals=[],this.uvs=[],this.uv2s=[],this.resource=null,this.triangles=[],this.subMeshes=[],this.extraData={}}},{key:"clone",value:function(){var t=new e;for(var i in t.vertices=this.vertices.slice(),t.normals=this.normals.slice(),t.uvs=this.uvs.slice(),t.uv2s=this.uv2s.slice(),t.resource=this.resource,t.triangles=this.triangles.slice(),this.extraData)t.extraData[i]=this.extraData[i].slice();for(var r=0;r<this.subMeshes.length;r++){var n=this.subMeshes[r].clone();t.subMeshes.push(n)}return t}},{key:"clear",value:function(){for(var e=0;e<this.subMeshes.length;e++){this.subMeshes[e].clear()}this._init()}}]),e}(),Hr=function(){function e(){Nr(this,e)}return Ur(e,null,[{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Ir(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"applyQuaternionToVector3",value:function(e,t){if(0!==e[0]||0!==e[1]||0!==e[2]||1!==e[3]){var i=t[0],r=t[1],n=t[2],o=e[0],s=e[1],a=e[2],l=e[3],u=l*i+s*n-a*r,c=l*r+a*i-o*n,h=l*n+o*r-s*i,p=-o*i-s*r-a*n;t[0]=u*l+p*-o+c*-a-h*-s,t[1]=c*l+p*-s+h*-o-u*-a,t[2]=h*l+p*-a+u*-s-c*-o}}}]),e}(),Vr=function(){function e(t){Nr(this,e),this._initParams(),this.positions=[],this.normals=[],this.uvs=[],this.uv2s=[],this.uv3s=[],this.indexes=[],this.colors=[],this.alphaIndexes=[],this.material=t,this.groupsArray=null,this.meshes=[],this.transformations=[],this.verticesCount=0,this.uvsCount=0,this.indexesCount=0,this.trianglesCount=0,this.colorsCount=0,this.alphaIndexsCount=0,this.uv2sCount=0,this.uv3sCount=0,this.groupsCountArray=null,this.combineCursor={vertex:0,index:0,uv:0,color:0,alphaIndex:0,uv2:0,uv3:0,groups:[]},this.maxCount=196602}return Ur(e,[{key:"_initParams",value:function(){this.positions=[],this.normals=[],this.uvs=[],this.uv2s=[],this.uv3s=[],this.indexes=[],this.colors=[],this.alphaIndexes=[],this.material=null,this.groups=null,this.meshes=[],this.transformations=[],this.verticesCount=0,this.uvsCount=0,this.indexesCount=0,this.trianglesCount=0,this.colorsCount=0,this.alphaIndexsCount=0,this.uv2sCount=0,this.uv3sCount=0,this.combineCursor=null,this.maxCount=null}},{key:"_initGroups",value:function(){var e=[],t=this.meshObj.geometry;if(t.groups.length>0){var i=this.cloneGroups(t.groups);i.forEach((function(e){e.start+=0})),e=e.concat(i)}}},{key:"cloneGroups",value:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];t.push(Hr.cloneJSObject(r))}return t}},{key:"getCalculaterMesh",value:function(){this._combine();var e=new zr;return e.resource=this.material,this.positions.length>0&&(e.vertices=this.positions),this.normals.length&&(e.normals=this.normals),this.uvs.length&&(e.uvs=this.uvs),this.uv2s.length&&(e.uv2s=this.uv2s),this.indexes.length>0&&(e.triangles=this.indexes),this.colors.length&&(e.extraData.color=this.colors),this.uv3s.length>0&&(e.extraData.uv3=this.uv3s),this.alphaIndexes.length>0&&(e.extraData.alphaIndex=this.alphaIndexes),this.groups&&(e.extraData.groups=this.groups),e}},{key:"_combine",value:function(){if(this.indexes=new Uint16Array(this.indexesCount),this.positions=new Float32Array(this.verticesCount),this.normals=new Float32Array(this.verticesCount),this.uvs=new Float32Array(this.uvsCount),0!==this.uv2sCount&&(this.uv2s=new Float32Array(this.uv2sCount)),0!==this.uv3sCount&&(this.uv3s=new Float32Array(this.uv3sCount)),0!==this.colorsCount&&(this.colors=new Uint16Array(this.colorsCount)),0!==this.alphaIndexsCount&&(this.alphaIndexes=new Uint16Array(this.alphaIndexsCount)),this.groupsCountArray)for(var e=0;e<this.groupsCountArray.length;e++){var t=this.groupsCountArray[e];this.combineCursor.groups.push({currentIndex:t.start})}for(var i=0;i<this.transformations.length;i++){var r=this.transformations[i];this._applyTransformation(this.meshes[i],r)}this.groups=this.groupsCountArray}},{key:"_applyTransformation",value:function(e,t,i){this._combineIndexes(e,i),this._combinePositionsAndNormals(e,t),this._combineUVs(e),this._combineColors(e),this._combineAlphaIndexes(e)}},{key:"_combineIndexes",value:function(e){var t=e.geometry.index.array,i=e.geometry.groups;if(i.length>0)for(var r=0;r<i.length;r++){for(var n=i[r],o=n.start,s=n.count,a=this.combineCursor.groups[r],l=0;l<s;l++)this.indexes[a.currentIndex+l]=this.combineCursor.vertex/3+t[o+l];this.combineCursor.groups[r].currentIndex+=s}else{for(var u=0;u<t.length;u++)this.indexes[this.combineCursor.index+u]=this.combineCursor.vertex/3+t[u];this.combineCursor.index+=t.length}}},{key:"_combinePositionsAndNormals",value:function(e,t){var i=null,r=null,n=e.geometry.getAttribute("position");i=n?n.array:[];var o=e.geometry.getAttribute("normal");r=o?o.array:[];for(var s=new Float32Array(3),a=new Float32Array(3),l=0;l<i.length;){a[0]=i[l],a[1]=i[l+1],a[2]=i[l+2],s[0]=r[l],s[1]=r[l+1],s[2]=r[l+2];for(var u=t.positions.length-1;u>-1;u--){var c=t.scales[u],h=t.quaternions[u],p=t.positions[u];1!==c.x&&(a[0]*=c.x),1!==c.y&&(a[1]*=c.y),1!==c.z&&(a[2]*=c.z),Hr.applyQuaternionToVector3(h.toArray(),a),0!==p.x&&(a[0]+=p.x),0!==p.y&&(a[1]+=p.y),0!==p.z&&(a[2]+=p.z),r&&Hr.applyQuaternionToVector3(h.toArray(),s)}this.positions[this.combineCursor.vertex+l]=a[0],this.positions[this.combineCursor.vertex+l+1]=a[1],this.positions[this.combineCursor.vertex+l+2]=a[2],this.normals[this.combineCursor.vertex+l]=s[0],this.normals[this.combineCursor.vertex+l+1]=s[1],this.normals[this.combineCursor.vertex+l+2]=s[2],l+=3}this.combineCursor.vertex+=i.length}},{key:"_combineUVs",value:function(e){var t=e.geometry.getAttribute("uv"),i=null;i=t?t.array:[];for(var r=0;r<i.length;r++)this.uvs[this.combineCursor.uv+r]=i[r];this.combineCursor.uv+=i.length;var n=e.geometry.getAttribute("uv2");if(n){for(var o=n.array,s=0;s<o.length;s++)this.uv2s[this.combineCursor.uv2+s]=o[s];this.combineCursor.uv2+=o.length}var a=e.geometry.getAttribute("uv3");if(a){for(var l=a.array,u=0;u<l.length;u++)this.uv3s[this.combineCursor.uv3+u]=l[u];this.combineCursor.uv3+=l.length}}},{key:"_combineColors",value:function(e){var t=e.geometry.getAttribute("color");if(t){for(var i=t.array,r=0;r<i.length;r++)this.colors[this.combineCursor.color+r]=i[r];this.combineCursor.color+=i.length}}},{key:"_combineAlphaIndexes",value:function(e){var t=e.geometry.getAttribute("alphaIndex");if(t){for(var i=t.array,r=0;r<i.length;r++)this.alphaIndexes[this.combineCursor.alphaIndex+r]=i[r];this.combineCursor.alphaIndex+=i.length}}},{key:"add",value:function(e,t,i){if(this.meshes.push(e),this.transformations.push(t),e.geometry.groups)if(this.groupsCountArray)for(var r=e.geometry.groups,n=0;n<r.length;n++){var o=r[n];this.groupsCountArray[n].count+=o.count,n!==r.length-1&&(this.groupsCountArray[n+1].start=this.groupsCountArray[n].start+this.groupsCountArray[n].count)}else this.groupsCountArray=this.cloneGroups(e.geometry.groups);e.geometry.index&&(this.indexesCount+=e.geometry.index.array.length),e.geometry.getAttribute("position")&&(this.verticesCount+=e.geometry.getAttribute("position").array.length),e.geometry.getAttribute("uv")&&(this.uvsCount+=e.geometry.getAttribute("uv").array.length);var s=e.geometry.getAttribute("color");s&&(this.colorsCount+=s.array.length);var a=e.geometry.getAttribute("alphaIndex");a&&(this.alphaIndexsCount+=a.array.length);var l=e.geometry.getAttribute("uv2");l&&(this.uv2sCount+=l.array.length);var u=e.geometry.getAttribute("uv3");u&&(this.uv3sCount+=u.array.length)}},{key:"isExceed",value:function(e){return this.verticesCount+e>this.maxCount}},{key:"clear",value:function(){this._initParams()}}]),e}(),Wr=function(){function e(t){Nr(this,e),this._initParams(),this.material=t,this.mesh=new zr,this.combineBundleSubMeshes=[],this.currentCombineBundleSubMesh=this._createCombineBundleSubMesh(),this.vertexCount=0}return Ur(e,[{key:"_initParams",value:function(){this.material=null,this.groups=null,this.mesh=null,this.combineBundleSubMeshes=[],this.currentCombineBundleSubMesh=null,this.vertexCount=0}},{key:"_createCombineBundleSubMesh",value:function(){var e=new Vr(this.material);return this.combineBundleSubMeshes.push(e),e}},{key:"add",value:function(e,t,i){var r=0;e.geometry.getAttribute("position")&&(r=e.geometry.getAttribute("position").array.length),this.currentCombineBundleSubMesh.isExceed(r)&&(this.currentCombineBundleSubMesh=this._createCombineBundleSubMesh()),this.currentCombineBundleSubMesh.add(e,t,i)}},{key:"getCalculaterMesh",value:function(){for(var e=0;e<this.combineBundleSubMeshes.length;e++){var t=this.combineBundleSubMeshes[e];this.mesh.subMeshes.push(t.getCalculaterMesh())}return this.mesh}},{key:"clear",value:function(){for(var e=0;e<this.combineBundleSubMeshes.length;e++){this.combineBundleSubMeshes[e].clear()}this._initParams()}}]),e}(),Gr=function(){function e(){Nr(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return Ur(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),qr=function(){function e(t){Nr(this,e),this._initParams(),this.bundeObj=t,this.materialMap=new Map}return Ur(e,[{key:"_initParams",value:function(){this.bundeObj=null,this.materialMap=null,this.combineBundleMeshs=[],this.vertexCount=0}},{key:"isExceed",value:function(){return this.vertexCount>6e4}},{key:"combine",value:function(){this._combine(this.bundeObj)}},{key:"_combine",value:function(e,t){if(void 0===t&&(t=new Gr),t.scales.push(e.scale),t.positions.push(e.position),t.quaternions.push(e.quaternion),e.isMesh){var i=0;if(e.geometry.getAttribute("position")&&(i=e.geometry.getAttribute("position").array.length),this.vertexCount+=i/3,!this.materialMap.has(e.material)){var r=new Wr(e.material);this.materialMap.set(r.material,r),this.combineBundleMeshs.push(r)}this.materialMap.get(e.material).add(e,t,e.groups)}if(0!==e.children.length)for(var n=0;n<e.children.length;n++)this._combine(e.children[n],t.clone())}},{key:"clear",value:function(){for(var e=0;e<this.combineBundleMeshs.length;e++){this.combineBundleMeshs[e].clear()}this._initParams()}}]),e}(),Xr=function(){function e(t){Nr(this,e),this.resource=t.resource,this.mesh=null,this.builderPromise=null,this.isBuilded=!1}return Ur(e,[{key:"build",value:function(){this.isBuilded||(this.combineBundleObj=new qr(this.resource.model),this.combineBundleObj.combine(),this.combineBundleObj.isExceed()?this.resource.vertexIsExceed=!0:(this.resource.vertexIsExceed=!1,this.changeToCalculaterMesh()),this.isBuilded=!0)}},{key:"changeToCalculaterMesh",value:function(){this.mesh=new zr;for(var e=this.combineBundleObj.combineBundleMeshs,t=0;t<e.length;t++){var i=e[t];this.mesh.subMeshes.push(i.getCalculaterMesh())}}},{key:"clear",value:function(){this.combineBundleObj&&this.combineBundleObj.clear(),this.combineBundleObj=null}}]),e}(),Jr=function(){function e(){Nr(this,e),this.map={}}return Ur(e,[{key:"getCombineMesh",value:function(e){if(!this.map[e.id]){var t=new Xr({resource:e});t.build(),this.map[e.id]=t.mesh}return this.map[e.id]}},{key:"clear",value:function(){this.map={}}}]),e}(),Yr=function(){function e(t){ji(this,e),this.objectManager=new Fr,this.objectManager.calculaterManager=this,this.map={},this.resourcCombineManager=new Jr}return Pi(e,[{key:"create",value:function(e){var t=e.type;if(this.map[t])return this.map[t];e.objectManager=this.objectManager,e.resourceCombineManager=this.resourcCombineManager;var i=Rr[t],r=void 0;return r=i?new i(e):new Lr(e),this.map[t]=r,r}},{key:"clear",value:function(){for(var e in this.map)this.map[e].clear();this.map=null,this.resourcCombineManager.clear(),this.resourcCombineManager=null}}]),e}(),Zr=function(){function e(t){ji(this,e),this._versionMap={0:{0:Yr}},this._smallVersionLibs=[[0]],this._bigVersions=[0]}return Pi(e,[{key:"getCalculaterManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][i.length-1]}if(null==t){var r=this._smallVersionLibs[e];return new this._versionMap[e][r.length-1]}var n=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>n[n.length-1]?new this._versionMap[e][n.length-1]:new this._versionMap[e][t];console.error("ubuilder calculater builder not support version "+e+"."+t)}}]),e}(),Qr=new Zr,Kr=function(){function e(t){ji(this,e)}return Pi(e,[{key:"create",value:function(e,t){return Qr.getCalculaterManager(e,t)}},{key:"clear",value:function(){}}]),e}(),$r=new Kr,en="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},tn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},rn=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),nn=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},on=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},sn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},an=function(){function e(t){tn(this,e),this._initParams(),this.object=t.object,this.buildPromise=null,this.manager=t.manager}return rn(e,[{key:"_initParams",value:function(){this.object=null,this.mesh=null,this.buildPromise=null,this.manager=null}},{key:"build",value:function(e){this.object=e;this.mesh=null,this._createMesh(this.object.calculaterMesh);var t=this.object.position,i=this.object.scale,r=this.object.rotation;this.mesh.position.set(t[0],t[1],t[2]),this.mesh.scale.set(i[0],i[1],i[2]),this.mesh.quaternion.set(r[0],r[1],r[2],r[3]),this.object.mesh=this.mesh,this.mesh=null}},{key:"checkResourcesIsBuilded",value:function(){for(var e=0;e<this.object.resources.length;e++){if(!this.object.resources[e].isBuilded)return!1}return!0}},{key:"resourceDownloadCallback",value:function(e,t){}},{key:"_createMesh",value:function(e){if(this.mesh||(this.mesh=new THREE.Object3D),e){if(e.vertices.length>0){var t=e.vertices,i=e.normals,r=e.triangles,n=e.uvs,o=e.uv2s,s=new THREE.BufferGeometry;s.setIndex(new THREE.BufferAttribute(r,1)),s.setAttribute("position",new THREE.BufferAttribute(t,3)),s.setAttribute("normal",new THREE.BufferAttribute(i,3)),s.setAttribute("uv",new THREE.BufferAttribute(n,2)),o.length>0&&s.setAttribute("uv2",new THREE.BufferAttribute(o,2));var a=e.extraData;a.color&&s.setAttribute("color",new THREE.BufferAttribute(a.color,4)),a.alphaIndex&&s.setAttribute("alphaIndex",new THREE.BufferAttribute(a.alphaIndex,1)),a.groups&&(s.groups=a.groups);var l=this._getMaterial(e),u=new THREE.Mesh(s,l);this.mesh.add(u)}if(e.subMeshes.length>0)for(var c=0;c<e.subMeshes.length;c++){var h=e.subMeshes[c];this._createMesh(h)}}}},{key:"_getMaterial",value:function(e){return e.resource.material}},{key:"_dispose",value:function(e){if(e instanceof THREE.Mesh){var t=e;if(t){var i=t.material,r=t.geometry;t.isDestory=!0,i&&(this._disposeMaterial(i),t.material=null),r&&(r.isDestory=!0,r.dispose(),t.geometry=null)}}if(e)for(var n=e.children,o=0;o<n.length;o++){var s=n[o];this._dispose(s)}}},{key:"_disposeMaterial",value:function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var i=e[t];this._disposeMaterial(i)}else e.isDestory=!0,e.dispose()}},{key:"clear",value:function(e){e&&(e.parent&&e.parent.remove(e),this._dispose(e)),this._initParams()}}]),e}(),ln=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource.wallMaterial}}]),t}(an),un=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource.wallMaterial}}]),t}(an),cn={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},hn=function(){function e(){tn(this,e)}return rn(e,null,[{key:"uuid",value:function(){for(var e,t=cn.chars,i=cn.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":en(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}},{key:"calTwoPositionLength",value:function(t,i){var r=e.subPosition(t,i);return r=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],Math.sqrt(r)}},{key:"subPosition",value:function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}},{key:"normalizeDirection",value:function(t){var i=e.calTwoPositionLength([0,0,0],t);if(1===i)return t;var r=t;return 0===i?(r[0]=0,r[1]=0,r[2]=0,r):(i=1/i,r[0]*=i,r[1]*=i,r[2]*=i,r)}},{key:"getFloorUV2s",value:function(e,t,i){e.parent.parent.allRoomsBox2||e.parent.parent.meshBuilder.calAllRoomsBox2(e.parent.parent);var r=e.parent.parent.allRoomsBox2,n=e.parent.position,o=new THREE.Vector2;r.getSize(o);for(var s=t.vertices,a=[],l=0;l<s.length;l++){var u,c,h=s[l];i?(u=(h.x+n[0]-r.min.x)/o.x,c=(-h.y+n[2]-r.min.y)/o.y):(u=(h.x-r.min.x)/o.x,c=(-h.y-r.min.y)/o.y),a.push(new THREE.Vector2(parseFloat(u.toFixed(2)),1-parseFloat(c.toFixed(2))))}return a}},{key:"getShapePath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.parent,n=[0,0,0];t&&(n=r.position);for(var o=r.points,s=[],a=0;a<o.length;a++){var l=o[a];i?s.push(new THREE.Vector2(l[0]+n[0],-(l[2]+n[2]))):s.push(new THREE.Vector2(l[0]+n[0],l[2]+n[2]))}return s}},{key:"getHolesPath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.parent,n=r.holes,o=[0,0,0];t&&(o=r.position);for(var s=[],a=0;a<n.length;a++){for(var l=n[a],u=l.length,c=[],h=0;h<u;h++){var p=l[h];i?c.push(new THREE.Vector2(p[0]+o[0],-(p[2]+o[2]))):c.push(new THREE.Vector2(p[0]+o[0],p[2]+o[2]))}s.push(c)}return s}}]),e}(),pn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_createMesh",value:function(){this.instanceModel(),this.object.mesh=this.mesh}},{key:"instanceModel",value:function(){this.mesh=hn.clone(this.object.resource.model),this.hasSkin=this.mesh.hasSkin,this.mesh.name="placement",this.mesh.visible=this.object.visible,this.mesh.name="plc"+this.object.id,null!==this.object.renderMode&&this.changeRenderMode(this.mesh),this.object.customTextureResource&&this.changeWithCustomTexture(this.mesh),this.object.customColor&&this.changeWithCustomColor(this.mesh)}},{key:"changeRenderMode",value:function(e){if(e instanceof THREE.Mesh&&(e.material.color=this.object.customColor,null!==this.object.renderMode))switch(this.object.renderMode){case 1:e.material.transparent=!1,e.material.alphaTest=.5;break;case 3:case 2:e.material.transparent=!0;break;default:console.error("can not find renderMode "+this.object.renderMode)}for(var t=0;t<e.children.length;t++){var i=e.children[t];this.changeRenderMode(i)}}},{key:"changeWithCustomColor",value:function(e){e instanceof THREE.Mesh&&(e.material.color=this.object.customColor,null!==this.object.opacity&&(e.material.opacity=this.object.opacity,e.material.transparent=!0));for(var t=0;t<e.children.length;t++){var i=e.children[t];this.changeWithCustomColor(i)}}},{key:"changeWithCustomTexture",value:function(e){e instanceof THREE.Mesh&&(e.material.map=this.object.customTextureResource.texture);for(var t=0;t<e.children.length;t++){var i=e.children[t];this.changeWithCustomTexture(i)}}}]),t}(an),dn=0,fn=1,mn=2,gn=3,vn=0,yn=1,bn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_createMesh",value:function(e){this.instanceModel(),this.changeOpenDirection()}},{key:"getOpenController",value:function(){return this.mesh?this.mesh.getObjectByName("Controller"):null}},{key:"isSingleOpen",value:function(){var e=this.getOpenController();return!!e&&1===e.children.length}},{key:"changeOpenDirection",value:function(){(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI);var e=this.getOpenController(),t=this.mesh.getObjectByName("RootNode");if(t)if(this.isSingleOpen()&&e)switch(this.object.openDirIndex){case dn:break;case fn:e.scale.set(-1,1,1);break;case mn:t.rotateY(Math.PI),e.scale.set(-1,1,1);break;case gn:t.rotateY(Math.PI)}else if(this.hasAnimation||e)switch(this.object.openDirIndex){case vn:break;case yn:t.rotateY(Math.PI)}else switch(this.object.openDirIndex){case vn:break;case yn:t.rotateY(Math.PI)}}},{key:"initModelSize",value:function(){this.object.modelSize=this.object.resource.modelSize,this.object.resource.model&&(this.object.size=[this.modelSize.x*this.scale.x,this.modelSize.y*this.scale.y,this.modelSize.z*this.scale.z])}},{key:"hasAnimation",get:function(){return!!(this.object.resource.animations&&this.object.resource.animations.length>0)}}]),t}(pn),_n=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource}},{key:"_createMesh",value:function(e){if(this.object.resource.vertexIsExceed){this.mesh=new THREE.Object3D;for(var i=this.object.objects,r=0;r<i.length;r++){var n=i[r];n.meshBuilder.build(n),this.mesh.add(n.mesh)}}else nn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this,e)}}]),t}(an),xn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_createMesh",value:function(e){var t=this.object.objects,i=this.object.resource.roomMaterial.clone();i.side=THREE.DoubleSide;for(var r=new THREE.Geometry,n=0;n<t.length;n++){var o=t[n],s=this._calGeometry(o);this.setUV2s(o,s),r.merge(s)}var a=new THREE.Mesh(r,i);a.name="combine",this.combineMesh=a,this.combineMesh.name="floor",this.mesh=this.combineMesh}},{key:"_calGeometry",value:function(e){e.parent;for(var t,i=this._getPointsPath(e),r=this._getHolesPath(e),n=new THREE.Vector3,o=0;o<i.length;o++){var s=i[o];n.x+=s.x,n.z+=s.y}if(n.x/=i.length,n.z/=i.length,t=0===i.length?new THREE.Shape:new THREE.Shape(i),r)for(o=0;o<r.length;o++){var a=r[o];t.holes.push(new THREE.Path(a))}var l=new THREE.ShapeGeometry(t);for(o=0;o<l.faceVertexUvs.length;o++)for(var u=l.faceVertexUvs[o],c=0;c<u.length;c++)for(var h=u[c],p=0;p<h.length;p++){var d=h[p],f=void 0,m=void 0;f=d.x-n.x,m=d.y-n.z,e.blockSize&&(f/=e.blockSize[0],m/=e.blockSize[1]),d.set(f,m)}return l.uvsNeedUpdate=!0,this.rotateUV(e,l),l}},{key:"rotateUV",value:function(e,t){for(var i=e.blockAngle*Math.PI/180,r=new THREE.Vector2(.5,.5),n=t.faceVertexUvs[0],o=0;o<n.length;o++)for(var s=n[o],a=0;a<s.length;a++){var l=s[a];l.sub(r),(l=new THREE.Vector2(l.x*Math.cos(i)-l.y*Math.sin(i),l.x*Math.sin(i)+l.y*Math.cos(i))).add(r),s[a]=l}}},{key:"_getPointsPath",value:function(e){return hn.getShapePath(e,!0)}},{key:"_getHolesPath",value:function(e){return hn.getHolesPath(e,!0)}},{key:"setUV2s",value:function(e,t){for(var i=hn.getFloorUV2s(e,t,!1),r=t.faces,n=[],o=0;o<r.length;o++){var s=r[o],a=[i[s.a],i[s.b],i[s.c]];n.push(a)}t.faceVertexUvs[1]=n}}]),t}(an),En=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_createMesh",value:function(e){for(var t=this.object.objects,i=this.object.resource.roomMaterial,r=new THREE.Geometry,n=0;n<t.length;n++){var o=t[n],s=this._calGeometry(o);r.merge(s)}var a=new THREE.Mesh(r,i);a.name="combine",this.combineMesh=a,this.combineMesh.name="floor",this.mesh=this.combineMesh}},{key:"_getPointsPath",value:function(e){return hn.getShapePath(e,!0,!1)}},{key:"_getHolesPath",value:function(e){return hn.getHolesPath(e,!0,!1)}}]),t}(xn),wn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_createMesh",value:function(e){for(var t=this.object.objects,i=this.object.resource.roomMaterial,r=new THREE.Geometry,n=0;n<t.length;n++){var o=t[n],s=this._calGeometry(o);r.merge(s)}var a=new THREE.Mesh(r,i);a.name="combine",this.combineMesh=a,this.combineMesh.name="floor",this.mesh=this.combineMesh}}]),t}(xn),Tn=function(e){function t(e){tn(this,t);var i=sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.shapePath=[],i.reverseZShapPath=[],i.holePaths=[],i.reverseZHolePaths=[],i}return on(t,e),rn(t,[{key:"_initParams",value:function(){nn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.shapePath=null,this.reverseZShapPath=null,this.holePaths=null,this.reverseZHolePaths=null}},{key:"_getMaterial",value:function(e){return e.resource.roomMaterial}},{key:"_createMesh",value:function(e){var t=this.object.parent;this._calGeometry();var i=this.geometry,r=null;null===this.object.height&&(this.object.height=this.object.DefaultHeight),(r=this.object.resource.roomMaterial).side=THREE.DoubleSide,r.defines=r.defines||{},r.defines.FLOOR_AO=!0,this.mesh=new THREE.Mesh(i,r),this.mesh.name="floor",this.mesh.position.y=this.object.height,this.mesh.rotateX(-Math.PI/2),this.mesh.visible=this.object.visible,this.mesh.roomID=t.id,this.object.rotation=this.mesh.quaternion.toArray(),this.object.position=this.mesh.position.toArray(),this.object.scale=this.mesh.scale.toArray()}},{key:"_calGeometry",value:function(){this.object.parent;for(var e,t=this._getPointsPath(this.object),i=this._getHolesPath(this.object),r=new THREE.Vector3,n=0;n<t.length;n++){var o=t[n];r.x+=o.x,r.z+=o.y}if(r.x/=t.length,r.z/=t.length,e=0===t.length?new THREE.Shape:new THREE.Shape(t),i.length>0)for(n=0;n<i.length;n++){var s=i[n];e.holes.push(new THREE.Path(s))}var a=new THREE.ShapeGeometry(e);for(n=0;n<a.faceVertexUvs.length;n++)for(var l=a.faceVertexUvs[n],u=0;u<l.length;u++)for(var c=l[u],h=0;h<c.length;h++){var p=c[h],d=void 0,f=void 0;d=p.x-r.x,f=p.y-r.z,this.object.blockSize&&(d/=this.object.blockSize[0],f/=this.object.blockSize[1]),p.set(d,f)}a.uvsNeedUpdate=!0,this.rotateUV(a),this.geometry=a,this.object.parent.parent&&this.setUV2s(a)}},{key:"setUV2s",value:function(e){for(var t=hn.getFloorUV2s(this.object,e,!0),i=e.faces,r=[],n=0;n<i.length;n++){var o=i[n],s=[t[o.a],t[o.b],t[o.c]];r.push(s)}e.faceVertexUvs[1]=r}},{key:"rotateUV",value:function(e){for(var t=this.object.blockAngle*Math.PI/180,i=new THREE.Vector2(.5,.5),r=e.faceVertexUvs[0],n=0;n<r.length;n++)for(var o=r[n],s=0;s<o.length;s++){var a=o[s];a.sub(i),(a=new THREE.Vector2(a.x*Math.cos(t)-a.y*Math.sin(t),a.x*Math.sin(t)+a.y*Math.cos(t))).add(i),o[s]=a}}},{key:"_getPointsPath",value:function(e){return hn.getShapePath(e,!1)}},{key:"_getHolesPath",value:function(e){return hn.getHolesPath(e,!1)}}]),t}(an),Mn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource.roomMaterial}},{key:"_createMesh",value:function(e){var t=this.object.parent;this._calGeometry();var i=this.object.resource.roomMaterial;if(this.mesh=new THREE.Mesh(this.geometry,i),this.mesh.name="ceiling",this.mesh.rotateX(Math.PI/2),null===this.object.height){var r=2.9;t.parent&&(r=t.parent.height),this.object.height=r}this.mesh.position.y=this.object.height,this.mesh.visible=this.object.visible,this.object.rotation=this.mesh.quaternion.toArray(),this.object.position=this.mesh.position.toArray(),this.object.scale=this.mesh.scale.toArray()}},{key:"_getPointsPath",value:function(e){return hn.getShapePath(e,!1,!1)}},{key:"_getHolesPath",value:function(e){return hn.getHolesPath(e,!1,!1)}}]),t}(Tn),Cn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource.roomMaterial}},{key:"_createMesh",value:function(e){var t=this.object.parent;this._calGeometry();var i;if(i=this.object.resource.roomMaterial,this.mesh=new THREE.Mesh(this.geometry,i),null===this.object.height){var r=3;t.parent&&(r=t.parent.height),this.object.height=r}this.mesh.position.y=this.object.height+.001,this.mesh.name="roof",this.mesh.rotateX(-Math.PI/2),this.mesh.visible=this.object.visible,this.mesh.name="roof"+t.id,this.object.rotation=this.mesh.quaternion.toArray(),this.object.position=this.mesh.position.toArray(),this.object.scale=this.mesh.scale.toArray()}}]),t}(Tn),Sn=function(e){function t(e){tn(this,t);var i=sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.shapePath=[],i.reverseZShapPath=[],i.holePaths=[],i.reverseZHolePaths=[],i.isCalculaterPoints=!1,i}return on(t,e),rn(t,[{key:"_initParams",value:function(){nn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.shapePath=null,this.reverseZShapPath=null,this.holePaths=null,this.reverseZHolePaths=null,this.isCalculaterPoints=null}},{key:"calculaterPoints",value:function(){this._initShapePathPoints(),this._initShapeHolePoints(),this.isCalculaterPoints=!0}},{key:"_initShapePathPoints",value:function(){var e=this.object.points;this.shapePath.length=0,this.reverseZShapPath.length=0;for(var t=0;t<e.length;t++){var i=e[t];this.shapePath.push(new THREE.Vector2(i[0],i[2])),this.reverseZShapPath.push(new THREE.Vector2(i[0],-i[2]))}this.object.floor.meshBuilder.shapePath=this.reverseZShapPath,this.object.ceiling&&(this.object.ceiling.meshBuilder.shapePath=this.shapePath),this.object.roof&&(this.object.roof.meshBuilder.shapePath=this.reverseZShapPath)}},{key:"_initShapeHolePoints",value:function(){var e=this.object.holes;this.holePaths.length=0,this.reverseZHolePaths.length=0;for(var t=0;t<e.length;t++){for(var i=e[t],r=i.length,n=[],o=[],s=0;s<r;s++){var a=i[s];n.push(new THREE.Vector2(a[0],a[2])),o.push(new THREE.Vector2(a[0],-a[2]))}this.holePaths.push(n),this.reverseZHolePaths.push(o)}this.object.floor.meshBuilder.holePaths=this.reverseZHolePaths,this.object.ceiling&&(this.object.ceiling.meshBuilder.holePaths=this.holePaths),this.object.roof&&(this.object.roof.meshBuilder.holePaths=this.reverseZHolePaths)}}]),t}(an),jn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),t}(an),Pn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource}}]),t}(an),Rn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),t}(an),Dn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource}},{key:"_createMesh",value:function(e){if(this._isVertexExceed()){this.mesh=new THREE.Object3D;for(var i=this.object.objects,r=0;r<i.length;r++){var n=i[r];n.build(),this.mesh.add(this._getObjMesh(n))}}else nn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this,e)}},{key:"_getObjMesh",value:function(e){for(var t=e.children,i=0;i<t.length;i++){var r=t[i];e.mesh.add(this._getObjMesh(r))}return e.mesh}},{key:"_isVertexExceed",value:function(){for(var e=0;e<this.object.resources.length;e++){if(this.object.resources[e].vertexIsExceed)return!0}return!1}}]),t}(an),An=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),t}(pn),kn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),t}(Rn),On=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),t}(pn),Bn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),t}(pn),Fn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource}}]),t}(an),Ln=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource}}]),t}(an),In=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_initParams",value:function(){nn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._allRoomsBox2=null}},{key:"calAllRoomsBox2",value:function(e){e.allRoomsBox2||(e.allRoomsBox2=this._calAllRoomsBox2(e))}},{key:"_calAllRoomsBox2",value:function(e){var t=new THREE.Box2,i=e.typeToChildren.Room;if(i)for(var r=0;r<i.length;r++){var n=i[r];this._addRoomToCalAllRoomsBox2(t,n)}var o=e.typeToChildren.CombineFloor;if(o)for(var s=0;s<o.length;s++)for(var a=o[s],l=0;l<a.objects.length;l++){var u=a.objects[l];this._addRoomToCalAllRoomsBox2(t,u.parent)}return t}},{key:"_addRoomToCalAllRoomsBox2",value:function(e,t){for(var i=this._getFloorPosition(t),r=t.points,n=0;n<r.length;n++){var o=new THREE.Vector2(r[n][0],r[n][2]);o.x+=i[0],o.y+=i[2],e.expandByPoint(o)}}},{key:"_getFloorPosition",value:function(e){return e.position.slice()}}]),t}(an),Nn={DoorOrWindow:bn,Placement:pn,StraightManualWall:ln,CombineStraightManualWall:un,CombinePlacement:_n,CombineCeiling:En,CombineRoof:wn,CombineFloor:xn,CombineModelWall:Pn,FloorPlan:In,Outdoors:In,Ceiling:Mn,Floor:Tn,Roof:Cn,Room:Sn,ModelWall:jn,PlacementGroup:Rn,CombinePlacementGroup:Dn,Facade:An,FacadeGroup:kn,PlacementWall:On,PlacementGround:Bn,CombinePlacementWall:Fn,CombineDoorOrWindow:Ln,VideoProbe:pn},Un=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_createMesh",value:function(e){this.mesh=new THREE.Object3D;var t=this.object.position,i=this.object.scale,r=this.object.rotation;this.mesh.position.set(t[0],t[1],t[2]),this.mesh.scale.set(i[0],i[1],i[2]),this.mesh.quaternion.set(r[0],r[1],r[2],r[3]),this.object.mesh=this.mesh}}]),t}(an),zn=function(){function e(t){tn(this,e),this.meshBuilderMap={}}return rn(e,[{key:"create",value:function(e){var t=e.type;if(this.meshBuilderMap[t])return this.meshBuilderMap[t];var i=Nn[t];e.manager=this;var r=void 0;return r=i?new i(e):new Un(e),this.meshBuilderMap[t]=r,r}},{key:"clear",value:function(){for(var e in this.meshBuilderMap)this.meshBuilderMap[e].clear();this.meshBuilderMap=null}}]),e}(),Hn=new(function(){function e(t){tn(this,e),this._versionMap={0:{0:zn}},this._smallVersionLibs=[[0]],this._bigVersions=[0]}return rn(e,[{key:"getManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][i.length-1]}if(null==t){var r=this._smallVersionLibs[e];return new this._versionMap[e][r.length-1]}var n=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>n[n.length-1]?new this._versionMap[e][n.length-1]:new this._versionMap[e][t];console.error("ubuilder meshBuilder  not support version "+e+"."+t)}}]),e}()),Vn=new(function(){function e(t){tn(this,e)}return rn(e,[{key:"create",value:function(e,t){return Hn.getManager(e,t)}},{key:"clear",value:function(){}}]),e}()),Wn="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},Gn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},qn=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Xn=function(){function e(t){Gn(this,e),this._init()}return qn(e,[{key:"_init",value:function(){this.vertices=[],this.normals=[],this.uvs=[],this.uv2s=[],this.resource=null,this.triangles=[],this.subMeshes=[],this.extraData={}}},{key:"clone",value:function(){var t=new e;for(var i in t.vertices=this.vertices.slice(),t.normals=this.normals.slice(),t.uvs=this.uvs.slice(),t.uv2s=this.uv2s.slice(),t.resource=this.resource,t.triangles=this.triangles.slice(),this.extraData)t.extraData[i]=this.extraData[i].slice();for(var r=0;r<this.subMeshes.length;r++){var n=this.subMeshes[r].clone();t.subMeshes.push(n)}return t}},{key:"clear",value:function(){for(var e=0;e<this.subMeshes.length;e++){this.subMeshes[e].clear()}this._init()}}]),e}(),Jn=function(){function e(){Gn(this,e)}return qn(e,null,[{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Wn(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"applyQuaternionToVector3",value:function(e,t){if(0!==e[0]||0!==e[1]||0!==e[2]||1!==e[3]){var i=t[0],r=t[1],n=t[2],o=e[0],s=e[1],a=e[2],l=e[3],u=l*i+s*n-a*r,c=l*r+a*i-o*n,h=l*n+o*r-s*i,p=-o*i-s*r-a*n;t[0]=u*l+p*-o+c*-a-h*-s,t[1]=c*l+p*-s+h*-o-u*-a,t[2]=h*l+p*-a+u*-s-c*-o}}}]),e}(),Yn=function(){function e(t){Gn(this,e),this._initParams(),this.positions=[],this.normals=[],this.uvs=[],this.uv2s=[],this.uv3s=[],this.indexes=[],this.colors=[],this.alphaIndexes=[],this.material=t,this.groupsArray=null,this.meshes=[],this.transformations=[],this.verticesCount=0,this.uvsCount=0,this.indexesCount=0,this.trianglesCount=0,this.colorsCount=0,this.alphaIndexsCount=0,this.uv2sCount=0,this.uv3sCount=0,this.groupsCountArray=null,this.combineCursor={vertex:0,index:0,uv:0,color:0,alphaIndex:0,uv2:0,uv3:0,groups:[]},this.maxCount=196602}return qn(e,[{key:"_initParams",value:function(){this.positions=[],this.normals=[],this.uvs=[],this.uv2s=[],this.uv3s=[],this.indexes=[],this.colors=[],this.alphaIndexes=[],this.material=null,this.groups=null,this.meshes=[],this.transformations=[],this.verticesCount=0,this.uvsCount=0,this.indexesCount=0,this.trianglesCount=0,this.colorsCount=0,this.alphaIndexsCount=0,this.uv2sCount=0,this.uv3sCount=0,this.combineCursor=null,this.maxCount=null}},{key:"_initGroups",value:function(){var e=[],t=this.meshObj.geometry;if(t.groups.length>0){var i=this.cloneGroups(t.groups);i.forEach((function(e){e.start+=0})),e=e.concat(i)}}},{key:"cloneGroups",value:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];t.push(Jn.cloneJSObject(r))}return t}},{key:"getCalculaterMesh",value:function(){this._combine();var e=new Xn;return e.resource=this.material,this.positions.length>0&&(e.vertices=this.positions),this.normals.length&&(e.normals=this.normals),this.uvs.length&&(e.uvs=this.uvs),this.uv2s.length&&(e.uv2s=this.uv2s),this.indexes.length>0&&(e.triangles=this.indexes),this.colors.length&&(e.extraData.color=this.colors),this.uv3s.length>0&&(e.extraData.uv3=this.uv3s),this.alphaIndexes.length>0&&(e.extraData.alphaIndex=this.alphaIndexes),this.groups&&(e.extraData.groups=this.groups),e}},{key:"_combine",value:function(){if(this.indexes=new Uint16Array(this.indexesCount),this.positions=new Float32Array(this.verticesCount),this.normals=new Float32Array(this.verticesCount),this.uvs=new Float32Array(this.uvsCount),0!==this.uv2sCount&&(this.uv2s=new Float32Array(this.uv2sCount)),0!==this.uv3sCount&&(this.uv3s=new Float32Array(this.uv3sCount)),0!==this.colorsCount&&(this.colors=new Uint16Array(this.colorsCount)),0!==this.alphaIndexsCount&&(this.alphaIndexes=new Uint16Array(this.alphaIndexsCount)),this.groupsCountArray)for(var e=0;e<this.groupsCountArray.length;e++){var t=this.groupsCountArray[e];this.combineCursor.groups.push({currentIndex:t.start})}for(var i=0;i<this.transformations.length;i++){var r=this.transformations[i];this._applyTransformation(this.meshes[i],r)}this.groups=this.groupsCountArray}},{key:"_applyTransformation",value:function(e,t,i){this._combineIndexes(e,i),this._combinePositionsAndNormals(e,t),this._combineUVs(e),this._combineColors(e),this._combineAlphaIndexes(e)}},{key:"_combineIndexes",value:function(e){var t=e.geometry.index.array,i=e.geometry.groups;if(i.length>0)for(var r=0;r<i.length;r++){for(var n=i[r],o=n.start,s=n.count,a=this.combineCursor.groups[r],l=0;l<s;l++)this.indexes[a.currentIndex+l]=this.combineCursor.vertex/3+t[o+l];this.combineCursor.groups[r].currentIndex+=s}else{for(var u=0;u<t.length;u++)this.indexes[this.combineCursor.index+u]=this.combineCursor.vertex/3+t[u];this.combineCursor.index+=t.length}}},{key:"_combinePositionsAndNormals",value:function(e,t){var i=null,r=null,n=e.geometry.getAttribute("position");i=n?n.array:[];var o=e.geometry.getAttribute("normal");r=o?o.array:[];for(var s=new Float32Array(3),a=new Float32Array(3),l=0;l<i.length;){a[0]=i[l],a[1]=i[l+1],a[2]=i[l+2],s[0]=r[l],s[1]=r[l+1],s[2]=r[l+2];for(var u=t.positions.length-1;u>-1;u--){var c=t.scales[u],h=t.quaternions[u],p=t.positions[u];1!==c.x&&(a[0]*=c.x),1!==c.y&&(a[1]*=c.y),1!==c.z&&(a[2]*=c.z),Jn.applyQuaternionToVector3(h.toArray(),a),0!==p.x&&(a[0]+=p.x),0!==p.y&&(a[1]+=p.y),0!==p.z&&(a[2]+=p.z),r&&Jn.applyQuaternionToVector3(h.toArray(),s)}this.positions[this.combineCursor.vertex+l]=a[0],this.positions[this.combineCursor.vertex+l+1]=a[1],this.positions[this.combineCursor.vertex+l+2]=a[2],this.normals[this.combineCursor.vertex+l]=s[0],this.normals[this.combineCursor.vertex+l+1]=s[1],this.normals[this.combineCursor.vertex+l+2]=s[2],l+=3}this.combineCursor.vertex+=i.length}},{key:"_combineUVs",value:function(e){var t=e.geometry.getAttribute("uv"),i=null;i=t?t.array:[];for(var r=0;r<i.length;r++)this.uvs[this.combineCursor.uv+r]=i[r];this.combineCursor.uv+=i.length;var n=e.geometry.getAttribute("uv2");if(n){for(var o=n.array,s=0;s<o.length;s++)this.uv2s[this.combineCursor.uv2+s]=o[s];this.combineCursor.uv2+=o.length}var a=e.geometry.getAttribute("uv3");if(a){for(var l=a.array,u=0;u<l.length;u++)this.uv3s[this.combineCursor.uv3+u]=l[u];this.combineCursor.uv3+=l.length}}},{key:"_combineColors",value:function(e){var t=e.geometry.getAttribute("color");if(t){for(var i=t.array,r=0;r<i.length;r++)this.colors[this.combineCursor.color+r]=i[r];this.combineCursor.color+=i.length}}},{key:"_combineAlphaIndexes",value:function(e){var t=e.geometry.getAttribute("alphaIndex");if(t){for(var i=t.array,r=0;r<i.length;r++)this.alphaIndexes[this.combineCursor.alphaIndex+r]=i[r];this.combineCursor.alphaIndex+=i.length}}},{key:"add",value:function(e,t,i){if(this.meshes.push(e),this.transformations.push(t),e.geometry.groups)if(this.groupsCountArray)for(var r=e.geometry.groups,n=0;n<r.length;n++){var o=r[n];this.groupsCountArray[n].count+=o.count,n!==r.length-1&&(this.groupsCountArray[n+1].start=this.groupsCountArray[n].start+this.groupsCountArray[n].count)}else this.groupsCountArray=this.cloneGroups(e.geometry.groups);e.geometry.index&&(this.indexesCount+=e.geometry.index.array.length),e.geometry.getAttribute("position")&&(this.verticesCount+=e.geometry.getAttribute("position").array.length),e.geometry.getAttribute("uv")&&(this.uvsCount+=e.geometry.getAttribute("uv").array.length);var s=e.geometry.getAttribute("color");s&&(this.colorsCount+=s.array.length);var a=e.geometry.getAttribute("alphaIndex");a&&(this.alphaIndexsCount+=a.array.length);var l=e.geometry.getAttribute("uv2");l&&(this.uv2sCount+=l.array.length);var u=e.geometry.getAttribute("uv3");u&&(this.uv3sCount+=u.array.length)}},{key:"isExceed",value:function(e){return this.verticesCount+e>this.maxCount}},{key:"clear",value:function(){this._initParams()}}]),e}(),Zn=function(){function e(t){Gn(this,e),this._initParams(),this.material=t,this.mesh=new Xn,this.combineBundleSubMeshes=[],this.currentCombineBundleSubMesh=this._createCombineBundleSubMesh(),this.vertexCount=0}return qn(e,[{key:"_initParams",value:function(){this.material=null,this.groups=null,this.mesh=null,this.combineBundleSubMeshes=[],this.currentCombineBundleSubMesh=null,this.vertexCount=0}},{key:"_createCombineBundleSubMesh",value:function(){var e=new Yn(this.material);return this.combineBundleSubMeshes.push(e),e}},{key:"add",value:function(e,t,i){var r=0;e.geometry.getAttribute("position")&&(r=e.geometry.getAttribute("position").array.length),this.currentCombineBundleSubMesh.isExceed(r)&&(this.currentCombineBundleSubMesh=this._createCombineBundleSubMesh()),this.currentCombineBundleSubMesh.add(e,t,i)}},{key:"getCalculaterMesh",value:function(){for(var e=0;e<this.combineBundleSubMeshes.length;e++){var t=this.combineBundleSubMeshes[e];this.mesh.subMeshes.push(t.getCalculaterMesh())}return this.mesh}},{key:"clear",value:function(){for(var e=0;e<this.combineBundleSubMeshes.length;e++){this.combineBundleSubMeshes[e].clear()}this._initParams()}}]),e}(),Qn=function(){function e(){Gn(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return qn(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),Kn=function(){function e(t){Gn(this,e),this._initParams(),this.bundeObj=t,this.materialMap=new Map}return qn(e,[{key:"_initParams",value:function(){this.bundeObj=null,this.materialMap=null,this.combineBundleMeshs=[],this.vertexCount=0}},{key:"isExceed",value:function(){return this.vertexCount>6e4}},{key:"combine",value:function(){this._combine(this.bundeObj)}},{key:"_combine",value:function(e,t){if(void 0===t&&(t=new Qn),t.scales.push(e.scale),t.positions.push(e.position),t.quaternions.push(e.quaternion),e.isMesh){var i=0;if(e.geometry.getAttribute("position")&&(i=e.geometry.getAttribute("position").array.length),this.vertexCount+=i/3,!this.materialMap.has(e.material)){var r=new Zn(e.material);this.materialMap.set(r.material,r),this.combineBundleMeshs.push(r)}this.materialMap.get(e.material).add(e,t,e.groups)}if(0!==e.children.length)for(var n=0;n<e.children.length;n++)this._combine(e.children[n],t.clone())}},{key:"clear",value:function(){for(var e=0;e<this.combineBundleMeshs.length;e++){this.combineBundleMeshs[e].clear()}this._initParams()}}]),e}(),$n=function(){function e(t){Gn(this,e),this.resource=t.resource,this.mesh=null,this.builderPromise=null,this.isBuilded=!1}return qn(e,[{key:"build",value:function(){this.isBuilded||(this.combineBundleObj=new Kn(this.resource.model),this.combineBundleObj.combine(),this.combineBundleObj.isExceed()?this.resource.vertexIsExceed=!0:(this.resource.vertexIsExceed=!1,this.changeToCalculaterMesh()),this.isBuilded=!0)}},{key:"changeToCalculaterMesh",value:function(){this.mesh=new Xn;for(var e=this.combineBundleObj.combineBundleMeshs,t=0;t<e.length;t++){var i=e[t];this.mesh.subMeshes.push(i.getCalculaterMesh())}}},{key:"clear",value:function(){this.combineBundleObj&&this.combineBundleObj.clear(),this.combineBundleObj=null}}]),e}(),eo=(function(){function e(){Gn(this,e),this.map={}}qn(e,[{key:"getCombineMesh",value:function(e){if(!this.map[e.id]){var t=new $n({resource:e});t.build(),this.map[e.id]=t.mesh}return this.map[e.id]}},{key:"clear",value:function(){this.map={}}}])}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),to=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),io=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},ro=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},no=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},oo=function(){function e(t){eo(this,e),this._initParams(),this.object=t.object,this.manager=t.manager}return to(e,[{key:"_initParams",value:function(){this.object=null,this.manager=null}},{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var i=e[t],r=this.manager.parserConfig[i.type];if(r)new r({object:i,manager:this.manager}).parse()}}},{key:"clear",value:function(){this._initParams()}}]),e}(),so=function(e){function t(e){return eo(this,t),no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ro(t,e),t}(oo),ao=function(e){function t(e){return eo(this,t),no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ro(t,e),t}(oo),lo=function(){function e(t){eo(this,e),this._initParams(),this.manager=t.manager,this.parent=null}return to(e,[{key:"_initParams",value:function(){this.parent=null,this.manager=null}},{key:"parse",value:function(){}},{key:"isObjectShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.properties)&&(!!this.isNullOrUndefined(e.userID)&&(!!this.isNullOrUndefined(e.name)&&!!e.visible))}},{key:"isNullOrUndefined",value:function(e){return null==e}}]),e}(),uo=function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineWall=null,i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineWall=null}},{key:"parse",value:function(e){"StraightManualWall"===e.type&&(e.visible&&(null===this.combineWall&&(this.combineWall=this.crerateCombineStraightManualWall()),this.combineWall.addObject(e)),e.parent=null)}},{key:"crerateCombineStraightManualWall",value:function(){var e=this.manager.objectManager.create({type:"CombineStraightManualWall"});return e.parent=this.parent,e}},{key:"initWallCorners",value:function(){for(var e=this.parent.typeToChildren.WallCorner,t=0;t<e.length;t++){var i=e[t];this.combineWall.addCorner(i)}}}]),t}(lo),co=function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i._combineObjectClass=i.manager.objectManager.ClassName.CombinePlacement,i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){e.type===this.manager.objectManager.ClassName.Placement&&this.isObjectShouldCombine(e)&&(this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null)}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}}]),t}(lo),ho={StraightManualWall:uo,WallCorner:lo,DoorOrWindow:function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._combineObjectClass=i.manager.objectManager.ClassName.CombineDoorOrWindow,i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._combineObjectClass=null}},{key:"parse",value:function(e){"DoorOrWindow"===e.type&&this.isObjectShouldCombine(e)&&(this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null)}}]),t}(co),Placement:co,Room:function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineFloorMaps={},i.combineCeilingMaps={},i.combineRoofMaps={},i.combineObjectMaps={Floor:i.combineFloorMaps,Ceiling:i.combineCeilingMaps,Roof:i.combineRoofMaps},i.typeToCombineObjectType={Floor:"CombineFloor",Ceiling:"CombineCeiling",Roof:"CombineRoof"},i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineFloorMaps=null,this.combineCeilingMaps=null,this.combineRoofMaps=null,this.combineObjectMaps=null,this.typeToCombineObjectType=null}},{key:"createCombineObject",value:function(e,t,i){var r=this.manager.objectManager.create({type:this.typeToCombineObjectType[e]});return r.parent=this.parent,r.resource=t,r.height=i,r}},{key:"parse",value:function(e){this.isObjectShouldCombine(e)&&(e.ceiling&&e.ceiling.visible&&this._addCombineObject(e.ceiling),e.roof&&e.roof.visible&&this._addCombineObject(e.roof),e.floor.visible&&this._addCombineObject(e.floor),e.parent=null)}},{key:"_addCombineObject",value:function(e){var t=e.type,i=e.height,r=e.resource,n=this.combineObjectMaps[t];n[r.id]?n[r.id].has(i)||n[r.id].set(i,this.createCombineObject(t,r,i)):(n[r.id]=new Map,n[r.id].set(i,this.createCombineObject(t,r,i))),n[r.id].get(i).addObject(e)}}]),t}(lo),ModelWall:function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i._CombineObjectClass=i.manager.objectManager.ClassName.CombineModelWall,i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){e.visible&&(this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e)),e.parent=null}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._CombineObjectClass});return t.resource=e,t.parent=this.parent,t}}]),t}(lo),PlacementGroup:function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._combineObjectClass=i.manager.objectManager.ClassName.CombinePlacementGroup,i.combinePlacementGroup=null,i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){e.type===this.manager.objectManager.ClassName.PlacementGroup&&this.isObjectShouldCombine(e)&&(null===this.combinePlacementGroup&&(this.combinePlacementGroup=this.createCombineObject()),this.combinePlacementGroup.addObject(e),e.parent=null)}},{key:"createCombineObject",value:function(){var e=this.manager.objectManager.create({type:this._combineObjectClass});return e.parent=this.parent,e}}]),t}(lo),PlacementWall:function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i._combineObjectClass=i.manager.objectManager.ClassName.CombinePlacementWall,i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}}]),t}(lo)},po=function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combiners={},i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combiners=null}},{key:"parse",value:function(){for(var e=this.object.children.slice(),t=0;t<e.length;t++){var i=e[t];this.initCombiner(i)}this.removeCorners()}},{key:"initCombiner",value:function(e){if(!this.combiners[e.type]){var t=ho[e.type];if(t){var i=new t({manager:this.manager});i.parent=this.object,this.combiners[e.type]=i}}this.combiners[e.type]&&this.combiners[e.type].parse(e)}},{key:"removeCorners",value:function(){var e=this.object.typeToChildren.WallCorner;if(e){e=e.slice();for(var t=0;t<e.length;t++){e[t].parent=null}}}},{key:"clear",value:function(){for(var e in this.combiners)this.combiners[e].clear();io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(oo),fo={World:so,Building:ao,FloorPlan:po,Outdoors:function(e){function t(e){return eo(this,t),no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ro(t,e),t}(po)},mo=function(){function e(){eo(this,e),this.objectManager=null,this.parserConfig=fo,this.rootParser=null}return to(e,[{key:"parse",value:function(e){new(0,this.parserConfig[e.type])({object:e,manager:this}).parse()}},{key:"clear",value:function(){this.rootParser&&this.rootParser.clear(),this.rootParser=null,this.objectManager=null,this.parserConfig=null}}]),e}(),go=function(){function e(t){eo(this,e),this._initParams(),this.object=t.object,this.manager=t.manager}return to(e,[{key:"_initParams",value:function(){this.object=null,this.manager=null}},{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var i=e[t],r=this.manager.parserConfig[i.type];if(r)new r({object:i,manager:this.manager}).parse()}}},{key:"clear",value:function(){this._initParams()}}]),e}(),vo=function(e){function t(e){return eo(this,t),no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ro(t,e),t}(go),yo=function(e){function t(e){return eo(this,t),no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ro(t,e),t}(go),bo=function(){function e(t){eo(this,e),this._initParams(),this.manager=t.manager,this.parent=null,this.styleTagKey="_styleTag_"}return to(e,[{key:"_initParams",value:function(){this.parent=null,this.manager=null}},{key:"parse",value:function(){}},{key:"isObjectOnlyContainStyleTagProp",value:function(e){return!this.isNullOrUndefined(e.properties)&&(this.isNullOrUndefined(e.properties[this.styleTagKey])||1!==Object.keys(e.properties).length?void 0:!!this.isNullOrUndefined(e.userID)&&!!this.isNullOrUndefined(e.name))}},{key:"isObjectShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.properties)&&(!!this.isNullOrUndefined(e.userID)&&(!!this.isNullOrUndefined(e.name)&&!!e.visible))}},{key:"isNullOrUndefined",value:function(e){return null==e}}]),e}(),_o=function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineWall=null,i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineWall=null}},{key:"parse",value:function(e){"StraightManualWall"===e.type&&(e.visible&&(null===this.combineWall&&(this.combineWall=this.crerateCombineStraightManualWall()),this.combineWall.addObject(e)),e.parent=null)}},{key:"crerateCombineStraightManualWall",value:function(){var e=this.manager.objectManager.create({type:"CombineStraightManualWall"});return e.parent=this.parent,e}},{key:"initWallCorners",value:function(){for(var e=this.parent.typeToChildren.WallCorner,t=0;t<e.length;t++){var i=e[t];this.combineWall.addCorner(i)}}}]),t}(bo),xo=function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i.onlyContainStyleTagCombineObjectMap={},i._combineObjectClass=i.manager.objectManager.ClassName.CombinePlacement,i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){if(e.type===this.manager.objectManager.ClassName.Placement)if(this.isObjectShouldCombine(e))this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null;else if(this.isObjectOnlyContainStyleTagProp(e)){if(this.onlyContainStyleTagCombineObjectMap[e.resource.id]||(this.onlyContainStyleTagCombineObjectMap[e.resource.id]={}),!this.onlyContainStyleTagCombineObjectMap[e.resource.id][e.properties[this.styleTagKey]]){var t=this.createCombineObject(e.resource);t.properties={},t.properties[this.styleTagKey]=e.properties[this.styleTagKey],this.onlyContainStyleTagCombineObjectMap[e.resource.id][e.properties[this.styleTagKey]]=t}this.onlyContainStyleTagCombineObjectMap[e.resource.id][e.properties[this.styleTagKey]].addObject(e),e.parent=null}}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}}]),t}(bo),Eo={StraightManualWall:_o,WallCorner:bo,DoorOrWindow:function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._combineObjectClass=i.manager.objectManager.ClassName.CombineDoorOrWindow,i.onlyContainStyleTagCombineObjectMap={},i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._combineObjectClass=null}},{key:"parse",value:function(e){if("DoorOrWindow"===e.type)if(this.isObjectShouldCombine(e))this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null;else if(this.isObjectOnlyContainStyleTagProp(e)){if(this.onlyContainStyleTagCombineObjectMap[e.resource.id]||(this.onlyContainStyleTagCombineObjectMap[e.resource.id]={}),!this.onlyContainStyleTagCombineObjectMap[e.resource.id][e.properties[this.styleTagKey]]){var t=this.createCombineObject(e.resource);t.properties={},t.properties[this.styleTagKey]=e.properties[this.styleTagKey],this.onlyContainStyleTagCombineObjectMap[e.resource.id][e.properties[this.styleTagKey]]=t}this.onlyContainStyleTagCombineObjectMap[e.resource.id][e.properties[this.styleTagKey]].addObject(e),e.parent=null}}}]),t}(xo),Placement:xo,Room:function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineFloorMaps={},i.combineCeilingMaps={},i.combineRoofMaps={},i.combineObjectMaps={Floor:i.combineFloorMaps,Ceiling:i.combineCeilingMaps,Roof:i.combineRoofMaps},i.typeToCombineObjectType={Floor:"CombineFloor",Ceiling:"CombineCeiling",Roof:"CombineRoof"},i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineFloorMaps=null,this.combineCeilingMaps=null,this.combineRoofMaps=null,this.combineObjectMaps=null,this.typeToCombineObjectType=null}},{key:"createCombineObject",value:function(e,t,i){var r=this.manager.objectManager.create({type:this.typeToCombineObjectType[e]});return r.parent=this.parent,r.resource=t,r.height=i,r}},{key:"parse",value:function(e){this.isObjectShouldCombine(e)&&(e.ceiling&&e.ceiling.visible&&this._addCombineObject(e.ceiling),e.roof&&e.roof.visible&&this._addCombineObject(e.roof),e.floor.visible&&this._addCombineObject(e.floor),e.parent=null)}},{key:"_addCombineObject",value:function(e){var t=e.type,i=e.height,r=e.resource,n=this.combineObjectMaps[t];n[r.id]?n[r.id].has(i)||n[r.id].set(i,this.createCombineObject(t,r,i)):(n[r.id]=new Map,n[r.id].set(i,this.createCombineObject(t,r,i))),n[r.id].get(i).addObject(e)}}]),t}(bo),ModelWall:function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i._CombineObjectClass=i.manager.objectManager.ClassName.CombineModelWall,i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){e.visible&&(this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e)),e.parent=null}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._CombineObjectClass});return t.resource=e,t.parent=this.parent,t}}]),t}(bo),PlacementGroup:function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._combineObjectClass=i.manager.objectManager.ClassName.CombinePlacementGroup,i.combinePlacementGroup=null,i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){e.type===this.manager.objectManager.ClassName.PlacementGroup&&this.isObjectShouldCombine(e)&&(null===this.combinePlacementGroup&&(this.combinePlacementGroup=this.createCombineObject()),this.combinePlacementGroup.addObject(e),e.parent=null)}},{key:"createCombineObject",value:function(){var e=this.manager.objectManager.create({type:this._combineObjectClass});return e.parent=this.parent,e}}]),t}(bo),PlacementWall:function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i._combineObjectClass=i.manager.objectManager.ClassName.CombinePlacementWall,i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}}]),t}(bo)},wo=function(e){function t(e){eo(this,t);var i=no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combiners={},i}return ro(t,e),to(t,[{key:"_initParams",value:function(){io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combiners=null}},{key:"parse",value:function(){for(var e=this.object.children.slice(),t=0;t<e.length;t++){var i=e[t];this.initCombiner(i)}this.removeCorners()}},{key:"initCombiner",value:function(e){if(!this.combiners[e.type]){var t=Eo[e.type];if(t){var i=new t({manager:this.manager});i.parent=this.object,this.combiners[e.type]=i}}this.combiners[e.type]&&this.combiners[e.type].parse(e)}},{key:"removeCorners",value:function(){var e=this.object.typeToChildren.WallCorner;if(e){e=e.slice();for(var t=0;t<e.length;t++){e[t].parent=null}}}},{key:"clear",value:function(){for(var e in this.combiners)this.combiners[e].clear();io(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(go),To={World:vo,Building:yo,FloorPlan:wo,Outdoors:function(e){function t(e){return eo(this,t),no(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ro(t,e),t}(wo)},Mo=function(){function e(){eo(this,e),this.objectManager=null,this.parserConfig=To,this.rootParser=null}return to(e,[{key:"parse",value:function(e){new(0,this.parserConfig[e.type])({object:e,manager:this}).parse()}},{key:"clear",value:function(){this.rootParser&&this.rootParser.clear(),this.rootParser=null,this.objectManager=null,this.parserConfig=null}}]),e}(),Co=new(function(){function e(t){eo(this,e),this._versionMap={0:{0:mo,3:Mo}},this._smallVersionLibs=[[0,3]],this._bigVersions=[0]}return to(e,[{key:"getCombinerManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1],r=i[i.length-1];return new this._versionMap[this._bigVersions.length-1][r]}if(null==t){var n=this._smallVersionLibs[e],o=n[n.length-1];return new this._versionMap[e][o]}var s=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1])){var a=s[s.length-1];return t>a||!this._versionMap[e][t]?new this._versionMap[e][a]:new this._versionMap[e][t]}console.error("ubuildercombiner not support version "+e+"."+t)}}]),e}()),So=function(){function e(t){eo(this,e),this.objectManager=t.objectManager}return to(e,[{key:"parse",value:function(e){var t=Co.getCombinerManager(e.bigVersion,e.smallVersion);return t.objectManager=this.objectManager,t.parse(e)}},{key:"getCombineManager",value:function(e,t){var i=Co.getCombinerManager(e,t);return i.objectManager=this.objectManager,i}},{key:"clear",value:function(){}}]),e}(),jo=function(){function e(t){p(this,e),this.sceneJson=null,this.world=null;var i=new oi,r=new Mi;i.meshBuilderManager=Vn.create(),i.calculaterManager=$r.create(),r.modelCombineBuilder=$n,this.loader=new We({objectManager:i,resourceManager:r,defaultSetting:Mt,defaultResource:jt}),this.dynamicBuildManager=new st(this),this.combineManager=new So({objectManager:i}),this.resourceManager=r,this.enableRequestWorld=!0}return d(e,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"delayLoad",value:function(e){var t=this;return new Promise((function(i,r){t.loadSceneJson(e).then((function(){t.world=t.loader.load({json:t.sceneJson,version:0}),t.combineParser.parseWorld(t.world),g.compatibilityProcessWorld(t.world),t.dynamicBuildManager.world=t.world,t.dynamicBuildManager.requestToBuild(t.world.id),t.dynamicBuildManager.build((function(e){1===e&&i(t.world)}))}))}))}},{key:"loadResources",value:function(){var e=this;return new Promise((function(t,i){e.resourceManager.downloadResourcesWithQueue((function(){t(e.world)}))}))}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"load",value:function(e){var t=this;return new Promise((function(i,r){t.loadSceneJson(e).then((function(){t.world=t.loader.load({json:t.sceneJson,version:2}),t.combineManager.parse(t.world),t.dynamicBuildManager.world=t.world,t.enableRequestWorld&&t.requestToBuild(t.world.id),i(t.world)}))}))}},{key:"loadSceneJson",value:function(e){var t=this;return new Promise((function(i,r){if(e.jsonData)t.sceneJson=e.jsonData,i(t.sceneJson);else if(e.url){(new THREE.FileLoader).load(e.url,(function(e){t.sceneJson=JSON.parse(e),i()}),(function(){}),(function(e){r("can not load "+t.sceneURL)}))}else r("load scene json error")}))}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),Po=function(){function e(t){p(this,e),this.sceneJson=null,this.world=null;var i=new oi,r=new Mi;i.meshBuilderManager=Vn.create(),i.calculaterManager=$r.create(),r.modelCombineBuilder=$n,this.dynamicBuildManager=new st(this),this.loader=new We({objectManager:i,resourceManager:r,defaultSetting:Mt,defaultResource:jt}),this.combineManager=new So({objectManager:i}),this.resourceManager=r,this.enableRequestWorld=!0}return d(e,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"loadSceneJson",value:function(e){var t=this;return new Promise((function(i,r){if(e.json)t.sceneJson=e.json,i(t.sceneJson);else if(e.url){(new THREE.FileLoader).load(e.url,(function(e){t.sceneJson=JSON.parse(e),i()}),(function(){}),(function(e){r("can not load "+t.sceneURL)}))}else r("load scene json error")}))}},{key:"loadResources",value:function(){var e=this;return new Promise((function(t,i){e.dynamicBuildManager.build((function(i){1===i&&t(e.world)}))}))}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"load",value:function(e){var t=this;return new Promise((function(i,r){t.loadSceneJson(e).then((function(){t.world=t.loader.load({json:t.sceneJson,version:2}),t.combineManager.parse(t.world),t.dynamicBuildManager.world=t.world,t.enableRequestWorld&&t.requestToBuild(t.world.id),i(t.world)}))}))}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),Ro=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Do=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Ao=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},ko=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Oo=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},Bo=function(){function e(t){Ro(this,e),this.object=t.object,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.mesh=null,this._boxMesh=null}return Do(e,[{key:"build",value:function(){this._createMesh()}},{key:"_createMesh",value:function(){if(this.object.resource){var e=this.object.resource;e.isTestModel?this.object.mesh=e.model.clone():this.object.nodeName?this.createMeshByNode():this.createMeshByModelClone()}else null===this.object.mesh&&(this.object.mesh=new THREE.Object3D)}},{key:"createMeshByNode",value:function(){var e=this.object.resource.model.getObjectByName(this.object.nodeName);if(e){if(e=e.clone(),this._setTransformation(this.object,e),this.object.children.length>0)for(var t=e.children.length-1;t>-1;t--){var i=e.children[t];e.remove(i)}this.object.mesh=e}else console.warn("can not find node "+this.object.nodeName),this.object.mesh=new THREE.Object3D}},{key:"_setTransformation",value:function(e,t){var i=t.position.toArray(),r=t.scale.toArray(),n=t.quaternion.toArray();if(!this._isArrayEqual(e.position,i))if(0===e.position[0]&&0===e.position[1]&&0===e.position[2])this.object.position=i;else{var o=this.object.position;t.position.set(o[0],o[1],o[2])}if(!this._isArrayEqual(e.scale,r))if(1===e.scale[0]&&1===e.scale[1]&&1===e.scale[2])this.object.scale=r;else{var s=this.object.scale;t.scale.set(s[0],s[1],s[2])}this._isArrayEqual(e.rotation,n)||(0===e.rotation[0]&&0===e.rotation[1]&&0===e.rotation[2]&&1===e.rotation[3]?this.object.rotation=n:t.quaternion.set(n[0],n[1],n[2],n[3]))}},{key:"_isArrayEqual",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=t[i];if(void 0===n)return!1;if(r!==n)return!1}return!0}},{key:"createMeshByModelClone",value:function(){var e=this.object.resource.model.clone(),t=this.object.position,i=this.object.scale,r=this.object.rotation;e.position.set(t[0],t[1],t[2]),e.quaternion.set(r[0],r[1],r[2],r[3]),e.scale.set(i[0],i[1],i[2]),this.object.mesh=e,this.object.mesh.name=this.object.type+this.object.id}},{key:"createBoxMesh",value:function(){if(null===this._boxMesh){var e=new THREE.BoxBufferGeometry(1,1,1),t=new THREE.MeshBasicMaterial,i=new THREE.Mesh(e,t),r=this.object.size;i.scale.set(this.object.size[0],this.object.size[1],this.object.size[2]),i.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]),i.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),i.position.y=(this.object.position[1]+r[1])/2,this._boxMesh=i}return this._boxMesh}},{key:"notifyBuildCompleteListeners",value:function(){for(var e=0;e<this.buildCompleteCallbacks.length;e++){(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}}},{key:"checkResourceReady",value:function(){if(this.object.resources){for(var e=0;e<this.object.resources.length;e++){if(!this.object.resources[e].ready)return!1}return!0}return!this.object.resource||!!this.object.resource.ready}},{key:"initResource",value:function(){if(this.object.resources)for(var e=0;e<this.object.resources.length;e++){var t=this.object.resources[e];this.requestResource(t)}else this.requestResource(this.object.resource)}},{key:"requestResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"resourceCallback",value:function(e){this.build()}},{key:"_dispose",value:function(e){if(e instanceof THREE.Mesh){var t=e;if(t){var i=t.material,r=t.geometry;t.isDestory=!0,i&&(this._disposeMaterial(i),t.material=null),r&&(r.isDestory=!0,r.dispose(),t.geometry=null)}}if(e)for(var n=e.children,o=0;o<n.length;o++){var s=n[o];this._dispose(s)}}},{key:"_disposeMaterial",value:function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var i=e[t];this._disposeMaterial(i)}else e.isDestory=!0,e.dispose()}},{key:"clear",value:function(e){e&&(e.parent&&e.parent.remove(e),this._dispose(e)),this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.mesh=null,this._boxMesh=null}}]),e}(),Fo=function(e){function t(e){Ro(this,t);var i=Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.isRegisterObjectBuildCallback=!1,i}return ko(t,e),Do(t,[{key:"_createMesh",value:function(){Ao(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this)}},{key:"buildCallback",value:function(e,t){var i=t.builder;i.applyRotationToChildren(),i.object.mesh.quaternion.set(0,0,0,1);for(var r=0;r<e.children.length;r++){e.children[r].meshBuilder.applyRotationToChildren()}}}]),t}(Bo),Lo=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),t}(Bo),Io=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),t}(Bo),No=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),t}(Bo),Uo=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),Do(t,[{key:"createMeshByNode",value:function(){var e=this.object.resource.model.getObjectByName(this.object.nodeName);e?(e=e.clone(),this.object.position=e.position.toArray(),this.object.scale=e.scale.toArray(),this.object.rotation=e.quaternion.toArray(),this.object.mesh=e):(console.warn("can not find node "+this.object.nodeName),this.object.mesh=new THREE.Object3D)}},{key:"_createMesh",value:function(){Ao(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this);var e=new THREE.Object3D;e.name="floorMax",e.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),e.scale.set(this.object.scale[0],this.object.scale[1],this.object.scale[2]),e.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]);var i=this.object.mesh;i.position.set(0,0,0),i.scale.set(1,1,1),i.quaternion.set(0,0,0,1),e.add(i);var r=i.position.clone();r.applyQuaternion(e.quaternion),i.position.copy(r),i.quaternion.premultiply(e.quaternion),this.object.rotation=[0,0,0,1],e.quaternion.set(0,0,0,1),this.object.mesh=e,this.object.floor&&(this.object.floor.mesh=i),this.object.roof&&(this.object.roof.mesh=new THREE.Object3D),this.object.ceiling&&(this.object.ceiling.mesh=new THREE.Object3D)}}]),t}(Bo),zo=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),t}(Bo),Ho=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),t}(Bo),Vo=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),t}(Bo),Wo=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),t}(Bo),Go=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),t}(Bo),qo=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),t}(Bo),Xo=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),Do(t,[{key:"_createMesh",value:function(){this.object.mesh=new THREE.Object3D}}]),t}(Bo),Jo=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),Do(t,[{key:"_createMesh",value:function(){this.object.mesh=new THREE.Object3D}}]),t}(Bo),Yo=function(){function e(t){Ro(this,e),this._map={Empty:Jo,Building:Fo,World:Lo,FloorPlan:qo,Outdoors:No,Room:Uo,Floor:Io,Placement:zo,Facade:Wo,DoorOrWindow:Go,CombinePlacement:Ho,CombinePlacementByBatch:Xo,CombineModelWall:Vo}}return Do(e,[{key:"getClass",value:function(e){return this._map[e]}},{key:"setClass",value:function(e,t){this._map[e]=t}}]),e}(),Zo=function(){function e(t){Ro(this,e),this.builderTypeConfig=new Yo}return Do(e,[{key:"create",value:function(e){var t=e.type,i=this.builderTypeConfig.getClass(t);return i?new i(e):null}},{key:"registerMeshBuilder",value:function(e,t){this.builderTypeConfig.setClass(e,t)}},{key:"containMeshBuilderClass",value:function(e){return!!this.builderTypeConfig[e]}},{key:"getMeshBuilderClass",value:function(e){return this.builderTypeConfig.getClass(e)}},{key:"getEmptyMeshBuilderClass",value:function(){return this.builderTypeConfig.getClass("Empty")}}]),e}(),Qo=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),Do(t,[{key:"createMeshByNode",value:function(){var e=this.object.resource.model.getObjectByName(this.object.nodeName);e?(e=e.clone(),this.object.position=e.position.toArray(),this.object.scale=e.scale.toArray(),this.object.rotation=e.quaternion.toArray(),this.object.mesh=e):(console.warn("can not find node "+this.object.nodeName),this.object.mesh=new THREE.Object3D)}},{key:"_createMesh",value:function(){Ao(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this);var e=new THREE.Object3D;e.name="floorMax",e.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),e.scale.set(this.object.scale[0],this.object.scale[1],this.object.scale[2]),e.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]);var i=this.object.mesh;i.position.set(0,0,0),i.scale.set(1,1,1),i.quaternion.set(0,0,0,1),e.add(i);var r=i.position.clone();if(r.applyQuaternion(e.quaternion),i.position.copy(r),i.quaternion.premultiply(e.quaternion),this.object.rotation=[0,0,0,1],e.quaternion.set(0,0,0,1),this.object.mesh=e,this.object.floor.mesh=i,this.object.nodeName){var n=this.object.parent;if("Outdoors"!==n.type){var o=n.height;this.object.roof.mesh=i.clone(),this.object.ceiling.mesh=i.clone(),this.object.roof.mesh.position.set(0,o,0),this.object.ceiling.mesh.position.set(0,o-.01,0),this._changeMaterialSide(this.object.roof.mesh,0),this._changeMaterialSide(this.object.ceiling.mesh,1)}}else this.object.roof.mesh=new THREE.Object3D,this.object.ceiling.mesh=new THREE.Object3D}},{key:"_changeMaterialSide",value:function(e,t){if(e.isMesh)if(e.material instanceof Array){var i=e.material.map((function(e){return e.clone()}));i.forEach((function(e){return e.side=t})),e.material=i}else e.material=e.material.clone(),e.material.side=t;for(var r=e.children,n=0;n<r.length;n++){var o=r[n];this._changeMaterialSide(o,t)}}},{key:"_setRoomPoints",value:function(e){if(e.isMesh){for(var t=[],i=e.geometry.attributes.position.array,r=0;r<i.length;r+=3)t.push(new THREE.Vector3(i[r],i[r+1],i[r+2]));this.object.points=t}for(var n=0;n<e.children.length;n++){var o=e.children[n];this._setRoomPoints(o)}}}]),t}(Bo),Ko=function(e){function t(e){Ro(this,t);var i=Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map.Room=Qo,i}return ko(t,e),Do(t,[{key:"getClass",value:function(e){return this._map[e]}}]),t}(Yo),$o=function(e){function t(e){Ro(this,t);var i=Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.builderTypeConfig=new Ko,i}return ko(t,e),t}(Zo),es=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),Do(t,[{key:"_createMesh",value:function(){if(this.object.resource){var e=this.object.resource;e.isTestModel?this.object.mesh=e.model.clone():this.object.nodeName&&this.createMeshByNode()}else null===this.object.mesh&&(this.object.mesh=new THREE.Object3D)}}]),t}(Bo),ts=function(e){function t(e){Ro(this,t);var i=Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map.CombinePlacement=es,i}return ko(t,e),t}(Ko),is=function(e){function t(e){Ro(this,t);var i=Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.builderTypeConfig=new ts,i}return ko(t,e),t}($o),rs=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),Do(t,[{key:"_createMesh",value:function(){if(this.object.resource){var e=this.object.resource;e.isTestModel?this.object.mesh=e.model.clone():this.object.nodeName&&this.createMeshByNode()}else null===this.object.mesh&&(this.object.mesh=new THREE.Object3D)}}]),t}(Bo),ns=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),t}(rs),os=function(e){function t(e){return Ro(this,t),Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ko(t,e),t}(rs),ss=function(e){function t(e){Ro(this,t);var i=Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map.CombineFloor=rs,i._map.CombineRoof=os,i._map.CombineCeiling=ns,i}return ko(t,e),t}(ts),as=function(e){function t(e){Ro(this,t);var i=Oo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.builderTypeConfig=new ss,i}return ko(t,e),t}(is),ls=new(function(){function e(t){Ro(this,e),this._versionMap={0:{0:Zo,1:$o,2:is,3:as}},this._smallVersionLibs=[[0,1,2,3]],this._bigVersions=[0]}return Do(e,[{key:"getManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][i.length-1]}if(null==t){var r=this._smallVersionLibs[e];return new this._versionMap[e][r.length-1]}var n=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>n[n.length-1]?new this._versionMap[e][n.length-1]:new this._versionMap[e][t];console.error("maxmeshbuilder not support version "+e+"."+t)}}]),e}()),us=new(function(){function e(t){Ro(this,e)}return Do(e,[{key:"createManager",value:function(e,t){return ls.getManager(e,t)}}]),e}()),cs="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},hs=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ps=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),ds=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},fs=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},ms=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},gs={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},vs=function(){function e(){hs(this,e)}return ps(e,null,[{key:"uuid",value:function(){for(var e,t=gs.chars,i=gs.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":cs(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}}]),e}(),ys=function(){function e(t){hs(this,e),this.creatorManager=t.creatorManager,this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=t.jsonData,this.objectParent=null,t.parent&&(this.objectParent=t.parent),this.createType=null,this.resourceManager=t.resourceManager,this.objectManager=t.objectManager}return ps(e,[{key:"create",value:function(){var e=this._getCreateParams();if(this.object=this.creatorManager.objectManager.create(e),this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.loadMode=0,this.jsonData.node?(this.object.nodeName=this.jsonData.node,this.object.loadMode=2):void 0!==this.jsonData.model&&null!==this.jsonData.model&&(this.object.loadMode=1),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object.resource||(this.object.resource=this.resourceManager.emptyModelResource),this.object.jsonData=this.jsonData,e.parent&&(this.object.parent=e.parent),this.jsonData.position){var t=this.jsonData.position;this.object.position=t}if(this.jsonData.scale){var i=this.jsonData.scale;0===i[0]&&(i[0]=.01),0===i[1]&&(i[1]=.01),0===i[2]&&(i[2]=.01),this.object.scale=i}if(this.jsonData.rotation){var r=this.jsonData.rotation;this.object.rotation=r}if(this.jsonData.properties&&(this.object.properties=this.jsonData.properties,this.object.lowerCaseProperties=this.convertPropertiesToLowerCase(this.jsonData.properties)),vs.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.jsonData.caminfo){var n=this.jsonData.caminfo.eye,o=this.jsonData.caminfo.target;n[2]=-n[2],o[2]=-o[2],this.object.camInfo={eye:n,target:o}}if(this.jsonData.size){var s=this.jsonData.size;this.object.size=s}else this.object.size=[1,1,1];return this.object}},{key:"convertPropertiesToLowerCase",value:function(e){var t={};for(var i in e)t[i.toLowerCase()]=e[i].toLowerCase();return t}},{key:"parseChildren",value:function(){}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,this.creatorManager.createObject(e)}}]),e}(),bs=0,_s=1,xs=2,Es=3,ws=6,Ts=7,Ms=8,Cs=9,Ss=10,js=11,Ps=12,Rs=13,Ds=14,As=15,ks=16,Os=17,Bs=18,Fs=19,Ls=21,Is=22,Ns=23,Us=24,zs=25,Hs=26,Vs=27,Ws=28,Gs=29,qs=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return fs(t,e),ps(t,[{key:"parseChildren",value:function(){var e=this.jsonData;if(e.buildings&&this._parseJsonDataChildren({jsonData:e.buildings,creatorType:_s}),e.outdoors){var t=this._parseJsonDataChild({jsonData:e.outdoors,creatorType:Ss});this.object.outdoors=t}}}]),t}(ys),Xs=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),vs.checkValueEmpty(this.jsonData.structshow)||(this.object.structShow=this.jsonData.structshow),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.facades&&this._parseJsonDataChildren({jsonData:e.facades,creatorType:js}),e.facadegroups&&this._parseJsonDataChildren({jsonData:e.facadegroups,creatorType:Ps}),e.plans&&this._parseJsonDataChildren({jsonData:e.plans,creatorType:xs})}}]),t}(ys),Js=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),vs.checkValueEmpty(this.jsonData.alwaysshowinsideobjs)||(this.object.alwaysShowInsideObjs=this.jsonData.alwaysshowinsideobjs),vs.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.corners&&this._parseCorners(e.corners),e.walls&&this._parseWalls(e.walls),e.placements&&this._parseJsonDataChildren({jsonData:e.placements,creatorType:ws}),e.combineplacements&&this._parseJsonDataChildren({jsonData:e.combineplacements,creatorType:Is}),e.rooms&&this._parseJsonDataChildren({jsonData:e.rooms,creatorType:Cs}),e.groups&&this._parseJsonDataChildren({jsonData:e.groups,creatorType:Ts}),e.curvelines&&this._parseJsonDataChildren({jsonData:e.curvelines,creatorType:Rs}),e.routelines&&this._parseJsonDataChildren({jsonData:e.routelines,creatorType:Bs}),e.leakwaterlines&&this._parseJsonDataChildren({jsonData:e.leakwaterlines,creatorType:Ds}),e.arrowlines&&this._parseJsonDataChildren({jsonData:e.arrowlines,creatorType:As}),e.arrowdatalines&&this._parseJsonDataChildren({jsonData:e.arrowdatalines,creatorType:ks}),e.pipelines&&this._parseJsonDataChildren({jsonData:e.pipelines,creatorType:Os}),e.videoprobes&&this._parseJsonDataChildren({jsonData:e.videoprobes,creatorType:Fs}),e.grounds&&this._parseJsonDataChildren({jsonData:e.grounds,creatorType:Ls}),e.doororwindows&&this._parseDoorOrWindows(e.doororwindows)}},{key:"_parseCorners",value:function(e){for(var t=0;t<e.length;t++){var i=e[t],r=i[0],n=i[1],o=-i[2];this.object.existsCorner(r,n,o)?console.error("repeat corner"):this._parseJsonDataChild({jsonData:i,creatorType:Es})}}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];this._parseJsonDataChild({jsonData:i,creatorType:Ns})}}},{key:"_parseDoorOrWindows",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i];this._parseJsonDataChild({jsonData:r,attachWall:t,creatorType:Ms})}}}]),t}(ys),Ys=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ModelWall",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),vs.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),this.object}}]),t}(ys),Zs=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="StraightManualWall",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}}]),t}(ys),Qs=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Placement",i}return fs(t,e),ps(t,[{key:"create",value:function(){if(ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],vs.checkValueEmpty(this.jsonData.texture)||(this.object.customTextureResource=this.resourceManager.textures[this.jsonData.texture]),this.jsonData.color){var e=this.jsonData.color;this.object.customColor=e,4===e.length&&(this.object.opacity=e[3])}return vs.checkValueEmpty(this.jsonData.rendermode)||(this.object.renderMode=this.jsonData.rendermode),this.jsonData.animinfo&&(this.object.isPlayAnim=this.jsonData.animinfo.isplay,this.object.animClip=this.jsonData.animinfo.clip),vs.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(ys),Ks=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementGroup",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.placements&&this._parseJsonDataChildren({jsonData:this.jsonData.placements,creatorType:ws}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:Ts}),this.jsonData.videoprobes&&this._parseJsonDataChildren({jsonData:this.jsonData.videoprobes,creatorType:Fs}),vs.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(ys),$s=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="DoorOrWindow",i}return fs(t,e),ps(t,[{key:"create",value:function(){if(ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],vs.checkValueEmpty(this.jsonData.suspendpercent)||(this.object.suspendPercent=this.jsonData.suspendpercent),vs.checkValueEmpty(this.jsonData.isopen)||(this.object.isOpen=this.jsonData.isopen),vs.checkValueEmpty(this.jsonData.diridx)||(this.object.openDirIndex=this.jsonData.diridx),!vs.checkValueEmpty(this.jsonData.iswindow)){var e=this.jsonData.iswindow;"string"==typeof e&&(e="false"!==e.toLocaleString()),this.object.isWindow=e}return this.object}}]),t}(ys),ea=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._createChildren(),this.object}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:Us}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:zs}),this._parseJsonDataChild({jsonData:{},creatorType:Hs}))}}]),t}(ys),ta=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return fs(t,e),t}(Js),ia=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Facade",i}return fs(t,e),t}(Qs),ra=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FacadeGroup",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.facades&&this._parseJsonDataChildren({jsonData:this.jsonData.facades,creatorType:js}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:Ps}),this.object}}]),t}(ys),na=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombinePlacement",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(ys),oa=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineModelWall",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(ys),sa=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Floor",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(ys),aa=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Ceiling",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(ys),la=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Roof",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(ys),ua=function(){function e(t){hs(this,e),this._map={0:qs,1:Xs,2:Js,4:Ys,5:Zs,6:Qs,7:Ks,8:$s,9:ea,10:ta,11:ia,12:ra,22:na,23:oa,24:sa,25:aa,26:la}}return ps(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),ca=function(){function e(t){hs(this,e),this.config=new ua,this.objectManager=null}return ps(e,[{key:"createObject",value:function(e){var t=this.config.getClass(e.creatorType);e.objectManager=this.objectManager,e.creatorManager=this;var i=new t(e),r=i.create(),n=!0;return void 0!==e.enableCreateChildren&&null!==e.enableCreateChildren&&(n=e.enableCreateChildren),n&&i.parseChildren(),r}}]),e}(),ha=function(){function e(t){hs(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl}return ps(e,[{key:"createResource",value:function(e){var t=this.manager.create({type:e});return t.manager=this.manager,t}},{key:"loadTextures",value:function(e){}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource("LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource("Resource");return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];if((t=this.createResource("Max2TjsResource")).baseUrl=this.baseModelUrl,r.localurl){if(t.localUrl=r.localurl,t.id=r.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,r.title&&(t.modelName=r.title),t.modelID=r.id,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.color){var n=r.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}}else if(r.id){if(t.id=r.id,t.modelID=r.id,t.version=r.version,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.model&&(t.modelID=r.model),r.title&&(t.modelName=r.title),r.color){n=r.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}if(r.size){var o=r.size;t.modelSize=new THREE.Vector3(o[0],o[1],o[2])}r.hasanimation&&(t.hasAnim=r.hasanimation),r.url&&(t.url=r.url)}for(var s=0;s<this.manager.ableToSupportFootAndHeadModelWalls.length;s++){var a=this.manager.ableToSupportFootAndHeadModelWalls[s];if(t.id===a){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var i=e.color;t.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(t.opacity=i[3])}if(e.size){var r=e.size;t.modelSize=new THREE.Vector3(r[0],r[1],r[2])}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),pa=function(){function e(){hs(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorManager=new ca}return ps(e,[{key:"setObjectTypeConfig",value:function(e){objectManager.objectTypeConfig=e}},{key:"setObjectManager",value:function(e){this.creatorManager.objectManager=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++){i+=t[r]+"/"}return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,i){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,(function(i){e.sceneJson=JSON.parse(i),t()}),(function(){}),(function(t){i("can not load "+e.sceneURL)}))}else i("load scene json error")}))}},{key:"getResourceLoader",value:function(){var e=new ha(this.resourceManager);return e.resourceManager=this.resourceManager,e}},{key:"parseSceneJson",value:function(){this.parseResources(this.sceneJson,this.resourceManager),this.parseWorld(this.sceneJson)}},{key:"parseResources",value:function(e,t){var i=new ha(t);i.loadTextures(e.textures),i.loadModels(e.models)}},{key:"parseWorld",value:function(e){this.world=this.creatorManager.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:bs})}},{key:"getCreatorManager",value:function(){return this.creatorManager}}]),e}(),da=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),vs.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),this.object}}]),t}(Js),fa=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map[xs]=da,i}return fs(t,e),t}(ua),ma=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.config=new fa,i}return fs(t,e),t}(ca),ga=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.creatorManager=new ma,i.creatorTypeConfig=new fa,i}return fs(t,e),t}(pa),va=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineFloor",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object.position=[0,0,0],this.object.rotation=[0,0,0,1],this.object}}]),t}(ys),ya=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineCeiling",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object.position=[0,0,0],this.object.rotation=[0,0,0,1],this.object}}]),t}(ys),ba=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineRoof",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object.position=[0,0,0],this.object.rotation=[0,0,0,1],this.object}}]),t}(ys),_a=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return fs(t,e),ps(t,[{key:"create",value:function(){return ds(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.combinefloors&&this._parseJsonDataChildren({jsonData:this.jsonData.combinefloors,creatorType:Vs}),this.jsonData.combineroofs&&this._parseJsonDataChildren({jsonData:this.jsonData.combineroofs,creatorType:Gs}),this.jsonData.combineceilings&&this._parseJsonDataChildren({jsonData:this.jsonData.combineceilings,creatorType:Ws}),this.object}}]),t}(da),xa=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return fs(t,e),t}(_a),Ea=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map[Vs]=va,i._map[Ws]=ya,i._map[Gs]=ba,i._map[xs]=_a,i._map[Ss]=xa,i}return fs(t,e),t}(fa),wa=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.config=new Ea,i}return fs(t,e),t}(ma),Ta=function(e){function t(e){return hs(this,t),ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return fs(t,e),ps(t,[{key:"loadModels",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];if((t=r.keeprootrotation?this.createResource("Max2TjsKeepRootRotationResource"):this.createResource("Max2TjsResource")).baseUrl=this.baseModelUrl,r.localurl){if(t.localUrl=r.localurl,t.id=r.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,r.title&&(t.modelName=r.title),t.modelID=r.id,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.color){var n=r.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}}else if(r.id){if(t.id=r.id,t.modelID=r.id,t.version=r.version,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.model&&(t.modelID=r.model),r.title&&(t.modelName=r.title),r.color){n=r.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}if(r.size){var o=r.size;t.modelSize=new THREE.Vector3(o[0],o[1],o[2])}r.hasanimation&&(t.hasAnim=r.hasanimation),r.url&&(t.url=r.url)}for(var s=0;s<this.manager.ableToSupportFootAndHeadModelWalls.length;s++){var a=this.manager.ableToSupportFootAndHeadModelWalls[s];if(t.id===a){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}}]),t}(ha),Ma=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.creatorManager=new wa,i.creatorTypeConfig=new Ea,i}return fs(t,e),ps(t,[{key:"parseResources",value:function(e,t){var i=new Ta(t);i.loadTextures(e.textures),i.loadModels(e.models)}}]),t}(ga),Ca=function(e){function t(e){return hs(this,t),ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return fs(t,e),ps(t,[{key:"parseChildren",value:function(){var e=this.jsonData;e.placements&&this._parseJsonDataChildren({jsonData:e.placements,creatorType:ws}),e.combineplacements&&this._parseJsonDataChildren({jsonData:e.combineplacements,creatorType:Is}),e.groups&&this._parseJsonDataChildren({jsonData:e.groups,creatorType:Ts}),e.videoprobes&&this._parseJsonDataChildren({jsonData:e.videoprobes,creatorType:Fs})}}]),t}(ea),Sa=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map[Cs]=Ca,i}return fs(t,e),t}(Ea),ja=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.config=new Sa,i}return fs(t,e),t}(wa),Pa=function(e){function t(e){hs(this,t);var i=ms(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.creatorManager=new ja,i.creatorTypeConfig=new Sa,i}return fs(t,e),t}(Ma),Ra=new(function(){function e(t){hs(this,e),this._versionMap={0:{0:pa,1:ga,2:ga,3:Ma,4:Pa}},this._smallVersionLibs=[[0,1,3,4]],this._bigVersions=[0]}return ps(e,[{key:"getLoaderManager",value:function(e,t){if(null==e){e=this._bigVersions[this._bigVersions.length-1];var i=this._smallVersionLibs[e];return t=i[i.length-1],new this._versionMap[e][t]}if(null==t){var r=this._smallVersionLibs[e];return t=r[r.length-1],new this._versionMap[e][t]}var n=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>n[n.length-1]?new this._versionMap[e][n.length-1]:new this._versionMap[e][t];console.error("maxLoader not support version "+e+"."+t)}}]),e}()),Da=function(){function e(t){hs(this,e),this.resourceManager=t.resourceManager,this.defaultSetting=t.defaultSetting,this.defaultResource=t.defaultResource,this.objectManager=t.objectManager}return ps(e,[{key:"load",value:function(e){return this.getLoaderManager(e.bigVersion,e.smallVersion).parseObjects(e)}},{key:"getLoaderManager",value:function(e,t){var i=Ra.getLoaderManager(e,t);return i.setDefaultSetting(this.defaultSetting),i.setDefaultResource(this.defaultResource),i.setResourceManager(this.resourceManager),i.setObjectManager(this.objectManager),i}}]),e}();Mt.enableCombinePlacementsByRoom=!1,Mt.enableCombinePlacementToBuildMesh=!0;var Aa="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},ka=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Oa=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Ba=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},Fa=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},La=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},Ia=function(){function e(t){ka(this,e),this._initParams(),this.object=t.object,this.manager=t.manager}return Oa(e,[{key:"_initParams",value:function(){this.object=null,this.manager=null}},{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var i=e[t],r=this.manager.parserConfig[i.type];if(r)new r({object:i,manager:this.manager}).parse()}}},{key:"clear",value:function(){this._initParams()}}]),e}(),Na=function(e){function t(e){return ka(this,t),La(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Fa(t,e),t}(Ia),Ua=function(e){function t(e){return ka(this,t),La(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Fa(t,e),t}(Ia),za=function(){function e(t){ka(this,e),this._initParams(),this.manager=t.manager,this.parent=null}return Oa(e,[{key:"_initParams",value:function(){this.parent=null,this.manager=null}},{key:"parse",value:function(){}},{key:"isNullOrUndefined",value:function(e){return null==e}}]),e}(),Ha=function(e){function t(e){ka(this,t);var i=La(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i._combineObjectClass="BatchCombinePlacement",i}return Fa(t,e),Oa(t,[{key:"_initParams",value:function(){Ba(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){if(e.type===this.manager.objectManager.ClassName.CombinePlacement&&this.isObjectShouldCombine(e)){this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource));var t=this.combineObjectMaps[e.resource.id];this._addPropertiesToCombinePlacement(e.properties,t),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null}}},{key:"_addPropertiesToCombinePlacement",value:function(e,t){for(var i in t.properties||(t.properties={}),e)t.properties[i]=e[i]}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}},{key:"isObjectShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.nodeName)}}]),t}(za),Va={WallCorner:za,CombinePlacement:Ha,Placement:function(e){function t(e){ka(this,t);var i=La(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i._combineObjectClass="BatchPlacement",i}return Fa(t,e),Oa(t,[{key:"_initParams",value:function(){Ba(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){if(e.type===this.manager.objectManager.ClassName.Placement&&this.isObjectShouldCombine(e)){this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource));var t=this.combineObjectMaps[e.resource.id];this._addPropertiesToCombinePlacement(e.properties,t),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null}}},{key:"_addPropertiesToCombinePlacement",value:function(e,t){for(var i in t.properties||(t.properties={}),e)t.properties[i]=e[i]}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}},{key:"isObjectShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.nodeName)}}]),t}(za)},Wa={WallCorner:za,CombinePlacement:Ha},Ga=new(function(){function e(t){ka(this,e),this.enableBatchPlacement=!0}return Oa(e,[{key:"getCombiner",value:function(e){return this.enableBatchPlacement?Va[e]:Wa[e]}}]),e}()),qa=function(e){function t(e){ka(this,t);var i=La(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combiners={},i}return Fa(t,e),Oa(t,[{key:"_initParams",value:function(){Ba(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combiners=null}},{key:"parse",value:function(){for(var e=this.object.children.slice(),t=0;t<e.length;t++){var i=e[t];this.initCombiner(i)}this.removeCorners()}},{key:"initCombiner",value:function(e){if(!this.combiners[e.type]){var t=Ga.getCombiner(e.type);if(t){var i=new t({manager:this.manager});i.parent=this.object,this.combiners[e.type]=i}}this.combiners[e.type]&&this.combiners[e.type].parse(e)}},{key:"removeCorners",value:function(){var e=this.object.typeToChildren.WallCorner;if(e){e=e.slice();for(var t=0;t<e.length;t++){e[t].parent=null}}}},{key:"clear",value:function(){for(var e in this.combiners)this.combiners[e].clear();Ba(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(Ia),Xa={World:Na,Building:Ua,FloorPlan:qa,Outdoors:function(e){function t(e){return ka(this,t),La(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Fa(t,e),t}(qa)},Ja={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),r=0;return function(){for(var n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Ja.DEG2RAD},radToDeg:function(e){return e*Ja.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},Ya=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Za=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Qa=function(){function e(t,i,r,n){Ya(this,e),this._x=t||0,this._y=i||0,this._z=r||0,this._w=void 0!==n?n:1}return Za(e,[{key:"slerp",value:function(e,t,i,r){return i.copy(e).slerp(t,r)}},{key:"slerpFlat",value:function(e,t,i,r,n,o,s){var a=i[r+0],l=i[r+1],u=i[r+2],c=i[r+3],h=n[o+0],p=n[o+1],d=n[o+2],f=n[o+3];if(c!==f||a!==h||l!==p||u!==d){var m=1-s,g=a*h+l*p+u*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,s=Math.sin(s*_)/b}var x=s*v;if(a=a*m+h*x,l=l*m+p*x,u=u*m+d*x,c=c*m+f*x,m===1-s){var E=1/Math.sqrt(a*a+l*l+u*u+c*c);a*=E,l*=E,u*=E,c*=E}}e[t]=a,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"set",value:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,r=e._y,n=e._z,o=e.order,s=Math.cos,a=Math.sin,l=s(i/2),u=s(r/2),c=s(n/2),h=a(i/2),p=a(r/2),d=a(n/2);return"XYZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"YXZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"ZXY"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"ZYX"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"YZX"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c-h*p*d):"XZY"===o&&(this._x=h*u*c-l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c+h*p*d),!1!==t&&this.onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this.onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],s=i[1],a=i[5],l=i[9],u=i[2],c=i[6],h=i[10],p=r+a+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(s-n)*t):r>a&&r>h?(t=2*Math.sqrt(1+r-a-h),this._w=(c-l)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(o+u)/t):a>h?(t=2*Math.sqrt(1+a-r-h),this._w=(o-u)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-r-a),this._w=(s-n)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var i,r=new Ka;return void 0===r&&(r=new Ka),(i=e.dot(t)+1)<1e-6?(i=0,Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0):r.set(0,-e.z,e.y)):r.crossVectors(e,t),this._x=r.x,this._y=r.y,this._z=r.z,this._w=i,this.normalize()}},{key:"inverse",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,s=t._x,a=t._y,l=t._z,u=t._w;return this._x=i*u+o*s+r*l-n*a,this._y=r*u+o*a+n*s-i*l,this._z=n*u+o*l+i*a-r*s,this._w=o*u-i*s-r*a-n*l,this.onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,s=o*e._w+i*e._x+r*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(r+this._y),this._z=.5*(n+this._z),this;var l=Math.atan2(a,s),u=Math.sin((1-t)*l)/a,c=Math.sin(t*l)/a;return this._w=o*u+this._w*c,this._x=i*u+this._x*c,this._y=r*u+this._y*c,this._z=n*u+this._z*c,this.onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"onChange",value:function(e){return this.onChangeCallback=e,this}},{key:"onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}]),e}(),Ka=function(){function e(t,i,r){Ya(this,e),this.x=t||0,this.y=i||0,this.z=r||0,this.isVector3=!0}return Za(e,[{key:"set",value:function(e,t,i){return this.x=e,this.y=t,this.z=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(){var e=new Qa;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}()}},{key:"applyAxisAngle",value:function(){var e=new Qa;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i))}()}},{key:"applyMatrix3",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}},{key:"applyQuaternion",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*i,u=a*i+s*t-n*r,c=a*r+n*i-o*t,h=-n*t-o*i-s*r;return this.x=l*a+h*-n+u*-s-c*-o,this.y=u*a+h*-o+c*-n-l*-s,this.z=c*a+h*-s+l*-o-u*-n,this}},{key:"transformDirection",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(){var t=new e,i=new e;return function(e,r){return t.set(e,e,e),i.set(r,r,r),this.clamp(t,i)}()}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-i*e.z,this.z=i*e.y-r*e.x,this}},{key:"crossVectors",value:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this}},{key:"projectOnVector",value:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)}},{key:"projectOnPlane",value:function(){var t=new e;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}},{key:"reflect",value:function(){var t=new e;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}()}},{key:"angleTo",value:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Ja.clamp(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this}},{key:"setFromCylindrical",value:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}]),e}(),$a=function(){function e(t,i){Ya(this,e),this.isBox3=!0,this.min=void 0!==t?t:new Ka(1/0,1/0,1/0),this.max=void 0!==i?i:new Ka(-1/0,-1/0,-1/0)}return Za(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,l=e.length;a<l;a+=3){var u=e[a],c=e[a+1],h=e[a+2];u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,i,r),this.max.set(n,o,s),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,l=e.count;a<l;a++){var u=e.getX(a),c=e.getY(a),h=e.getZ(a);u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,i,r),this.max.set(n,o,s),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var i=(new Ka).copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){var t=e||new Ka;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){var t=e||new Ka;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=new Ka,i=this;return e.updateMatrixWorld(!0),e.traverse((function(e){var r,n,o=e.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(r=0,n=s.length;r<n;r++)t.copy(s[r]),t.applyMatrix4(e.matrixWorld),i.expandByPoint(t)}else if(o.isBufferGeometry){var a=o.attributes.position;if(void 0!==a)for(r=0,n=a.count;r<n;r++)t.fromBufferAttribute(a,r).applyMatrix4(e.matrixWorld),i.expandByPoint(t)}})),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return(t||new Ka).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsPlane",value:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=e.constant&&i>=e.constant}},{key:"clampPoint",value:function(e,t){return(t||new Ka).copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return(new Ka).copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){var t=[new Ka,new Ka,new Ka,new Ka,new Ka,new Ka,new Ka,new Ka];return this.isEmpty()||(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();function el(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(el.prototype,{isMatrix4:!0,set:function(e,t,i,r,n,o,s,a,l,u,c,h,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new el).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(){var e=new Ka;return function(t){var i=this.elements,r=t.elements,n=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),s=1/e.setFromMatrixColumn(t,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[4]=r[4]*o,i[5]=r[5]*o,i[6]=r[6]*o,i[8]=r[8]*s,i[9]=r[9]*s,i[10]=r[10]*s,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,o=Math.cos(i),s=Math.sin(i),a=Math.cos(r),l=Math.sin(r),u=Math.cos(n),c=Math.sin(n);if("XYZ"===e.order){var h=o*u,p=o*c,d=s*u,f=s*c;t[0]=a*u,t[4]=-a*c,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-s*a,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*a}else if("YXZ"===e.order){var m=a*u,g=a*c,v=l*u,y=l*c;t[0]=m+y*s,t[4]=v*s-g,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-s,t[2]=g*s-v,t[6]=y+m*s,t[10]=o*a}else if("ZXY"===e.order){m=a*u,g=a*c,v=l*u,y=l*c;t[0]=m-y*s,t[4]=-o*c,t[8]=v+g*s,t[1]=g+v*s,t[5]=o*u,t[9]=y-m*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){h=o*u,p=o*c,d=s*u,f=s*c;t[0]=a*u,t[4]=d*l-p,t[8]=h*l+f,t[1]=a*c,t[5]=f*l+h,t[9]=p*l-d,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){var b=o*a,_=o*l,x=s*a,E=s*l;t[0]=a*u,t[4]=E-b*c,t[8]=x*c+_,t[1]=c,t[5]=o*u,t[9]=-s*u,t[2]=-l*u,t[6]=_*c+x,t[10]=b-E*c}else if("XZY"===e.order){b=o*a,_=o*l,x=s*a,E=s*l;t[0]=a*u,t[4]=-c,t[8]=l*u,t[1]=b*c+E,t[5]=o*u,t[9]=_*c-x,t[2]=x*c-_,t[6]=s*u,t[10]=E*c+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e._x,r=e._y,n=e._z,o=e._w,s=i+i,a=r+r,l=n+n,u=i*s,c=i*a,h=i*l,p=r*a,d=r*l,f=n*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(p+f),t[4]=c-v,t[8]=h+g,t[1]=c+v,t[5]=1-(u+f),t[9]=d-m,t[2]=h-g,t[6]=d+m,t[10]=1-(u+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new Ka,t=new Ka,i=new Ka;return function(r,n,o){var s=this.elements;return i.subVectors(r,n),0===i.lengthSq()&&(i.z=1),i.normalize(),e.crossVectors(o,i),0===e.lengthSq()&&(1===Math.abs(o.z)?i.x+=1e-4:i.z+=1e-4,i.normalize(),e.crossVectors(o,i)),e.normalize(),t.crossVectors(i,e),s[0]=e.x,s[4]=t.x,s[8]=i.x,s[1]=e.y,s[5]=t.y,s[9]=i.y,s[2]=e.z,s[6]=t.z,s[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],u=i[1],c=i[5],h=i[9],p=i[13],d=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],_=i[15],x=r[0],E=r[4],w=r[8],T=r[12],M=r[1],C=r[5],S=r[9],j=r[13],P=r[2],R=r[6],D=r[10],A=r[14],k=r[3],O=r[7],B=r[11],F=r[15];return n[0]=o*x+s*M+a*P+l*k,n[4]=o*E+s*C+a*R+l*O,n[8]=o*w+s*S+a*D+l*B,n[12]=o*T+s*j+a*A+l*F,n[1]=u*x+c*M+h*P+p*k,n[5]=u*E+c*C+h*R+p*O,n[9]=u*w+c*S+h*D+p*B,n[13]=u*T+c*j+h*A+p*F,n[2]=d*x+f*M+m*P+g*k,n[6]=d*E+f*C+m*R+g*O,n[10]=d*w+f*S+m*D+g*B,n[14]=d*T+f*j+m*A+g*F,n[3]=v*x+y*M+b*P+_*k,n[7]=v*E+y*C+b*R+_*O,n[11]=v*w+y*S+b*D+_*B,n[15]=v*T+y*j+b*A+_*F,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new Ka;return function(t){for(var i=0,r=t.count;i<r;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix4(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],s=e[5],a=e[9],l=e[13],u=e[2],c=e[6],h=e[10],p=e[14];return e[3]*(+n*a*c-r*l*c-n*s*h+i*l*h+r*s*p-i*a*p)+e[7]*(+t*a*p-t*l*h+n*o*h-r*o*p+r*l*u-n*a*u)+e[11]*(+t*l*c-t*s*p-n*o*c+i*o*p+n*s*u-i*l*u)+e[15]*(-r*s*u-t*a*c+t*s*h+r*o*c-i*o*h+i*a*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],o=r[1],s=r[2],a=r[3],l=r[4],u=r[5],c=r[6],h=r[7],p=r[8],d=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],b=r[15],_=d*y*h-v*f*h+v*c*m-u*y*m-d*c*b+u*f*b,x=g*f*h-p*y*h-g*c*m+l*y*m+p*c*b-l*f*b,E=p*v*h-g*d*h+g*u*m-l*v*m-p*u*b+l*d*b,w=g*d*c-p*v*c-g*u*f+l*v*f+p*u*y-l*d*y,T=n*_+o*x+s*E+a*w;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var C=1/T;return i[0]=_*C,i[1]=(v*f*a-d*y*a-v*s*m+o*y*m+d*s*b-o*f*b)*C,i[2]=(u*y*a-v*c*a+v*s*h-o*y*h-u*s*b+o*c*b)*C,i[3]=(d*c*a-u*f*a-d*s*h+o*f*h+u*s*m-o*c*m)*C,i[4]=x*C,i[5]=(p*y*a-g*f*a+g*s*m-n*y*m-p*s*b+n*f*b)*C,i[6]=(g*c*a-l*y*a-g*s*h+n*y*h+l*s*b-n*c*b)*C,i[7]=(l*f*a-p*c*a+p*s*h-n*f*h-l*s*m+n*c*m)*C,i[8]=E*C,i[9]=(g*d*a-p*v*a-g*o*m+n*v*m+p*o*b-n*d*b)*C,i[10]=(l*v*a-g*u*a+g*o*h-n*v*h-l*o*b+n*u*b)*C,i[11]=(p*u*a-l*d*a-p*o*h+n*d*h+l*o*m-n*u*m)*C,i[12]=w*C,i[13]=(p*v*s-g*d*s+g*o*f-n*v*f-p*o*y+n*d*y)*C,i[14]=(g*u*s-l*v*s-g*o*c+n*v*c+l*o*y-n*u*y)*C,i[15]=(l*d*s-p*u*s+p*o*c-n*d*c-l*o*f+n*u*f)*C,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,s=e.y,a=e.z,l=n*o,u=n*s;return this.set(l*o+i,l*s-r*a,l*a+r*s,0,l*s+r*a,u*s+i,u*a-r*o,0,l*a-r*s,u*a+r*o,n*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e=new Ka,t=new el;return function(i,r,n){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),i.x=o[12],i.y=o[13],i.z=o[14],t.copy(this);var u=1/s,c=1/a,h=1/l;return t.elements[0]*=u,t.elements[1]*=u,t.elements[2]*=u,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,r.setFromRotationMatrix(t),n.x=s,n.y=a,n.z=l,this}}(),makePerspective:function(e,t,i,r,n,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,a=2*n/(t-e),l=2*n/(i-r),u=(t+e)/(t-e),c=(i+r)/(i-r),h=-(o+n)/(o-n),p=-2*o*n/(o-n);return s[0]=a,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(e,t,i,r,n,o){var s=this.elements,a=1/(t-e),l=1/(i-r),u=1/(o-n),c=(t+e)*a,h=(i+r)*l,p=(o+n)*u;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}});!function(){function e(t,i){Ya(this,e),this.x=t||0,this.y=i||0,this.isVector2=!0}Za(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(){var t=new e,i=new e;return function(e,r){return t.set(e,e),i.set(r,r),this.clamp(t,i)}()}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}},{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}}])}();var tl={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},il=function(){function e(){ka(this,e)}return Oa(e,null,[{key:"uuid",value:function(){for(var e,t=tl.chars,i=tl.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Aa(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}},{key:"calTwoPositionLength",value:function(t,i){var r=e.subPosition(t,i);return r=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],Math.sqrt(r)}},{key:"subPosition",value:function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}},{key:"normalizeDirection",value:function(t){var i=e.calTwoPositionLength([0,0,0],t);if(1===i)return t;var r=t;return 0===i?(r[0]=0,r[1]=0,r[2]=0,r):(i=1/i,r[0]*=i,r[1]*=i,r[2]*=i,r)}}]),e}(),rl=function(e){function t(e){ka(this,t);var i=La(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.objects=[],i}return Fa(t,e),Oa(t,[{key:"_initParams",value:function(){Ba(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.objects=[]}},{key:"_buildSelf",value:function(){Ba(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_buildSelf",this).call(this)}},{key:"clear",value:function(){for(var e=0;e<this.objects.length;e++){this.objects[e].clear()}Ba(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(function(){function e(){ka(this,e),this.type="BaseObject",this._initParams(),this.calculaterData={},this.objectsMap=null}return Oa(e,[{key:"_initParams",value:function(){this.id=il.uuid(),this.name=null,this.userID=null,this.properties=null,this.resource=null,this._resources=null,this.position=[0,0,0],this.rotation=[0,0,0,1],this.scale=[1,1,1],this._parent=null,this.children=[],this.typeToChildren={},this.lowerCaseProperties=null,this.visible=!0,this.mesh=null,this.calculater=null,this.meshBuilder=null,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.selfBuildCompleteCallbacks=[],this.selfBuildCompleteCallbackParams=[],this._isCalculated=!1,this._isMeshBuilded=!1,this._isChildrenBuilded=!1,this._isSelfBuilded=!1,this._isBuiled=!1,this._size=null,this._box3=null,this._selfSize=null,this._center=null,this._isBuiled=!1,this._isRequestResource=!1,this._isNotifyListeners=!1,this.objectsMap=null}},{key:"_getCalculateSizeObjects",value:function(){return this.children}},{key:"_addChild",value:function(e){this.children.push(e),this.typeToChildren[e.type]||(this.typeToChildren[e.type]=[]),this.typeToChildren[e.type].push(e),e.registerBuildCallbackListener(this._childBuildCallback,{obj:this})}},{key:"_childBuildCallback",value:function(e,t){var i=t.obj;i.children.every((function(e){return e.isBuilded}))&&(i._isChildrenBuilded=!0),i.isChildrenBuilded&&i.isSelfBuilded&&(i._isBuiled=!0),i.isBuilded&&i.notifyBuildCompleteListeners()}},{key:"_getChildrenByType",value:function(e){return this.typeToChildren[e]?this.typeToChildren[e]:[]}},{key:"_removeChild",value:function(e){var t=this.children.indexOf(e);t>-1&&this.children.splice(t,1),(t=this.typeToChildren[e.type].indexOf(e))>-1&&this.typeToChildren[e.type].splice(t,1),e.removeBuildCallbackListener(this._childBuildCallback)}},{key:"build",value:function(e){e&&this.registerBuildCallbackListener(e),this.isBuilded||(this.isResourcesBuilded?(this.buildSelf(),this.buildChildren(),this.isChildrenBuilded&&this.notifyBuildCompleteListeners()):this._initResources())}},{key:"calculate",value:function(){this.calculater&&this.calculater.build(this)}},{key:"createMesh",value:function(){if(this.meshBuilder)return this.meshBuilder.build(this)}},{key:"_initResources",value:function(){if(!this._isRequestResource){for(var e=0;e<this.resources.length;e++){var t=this.resources[e];t.isBuilded||(t.registerBuildCallbackListener(this._resourceBuildedCallback,{object:this}),t.build())}this._isRequestResource=!0}}},{key:"_resourceBuildedCallback",value:function(e,t){var i=t.object;e.isBuilded&&i.build()}},{key:"buildSelf",value:function(){this._buildSelf(),this.isSelfBuilded&&this.notifySelfBuildCompleteListeners()}},{key:"_buildSelf",value:function(){this.isSelfBuilded||(this._isCalculated||(this.calculate(),this._isCalculated=!0),this._isMeshBuilded||(this.createMesh(),this._isMeshBuilded=!0),this._isSelfBuilded=!0,this.isChildrenBuilded&&(this._isBuiled=!0),this.isBuilded&&this.notifyBuildCompleteListeners())}},{key:"buildChildren",value:function(){this._buildChildren()}},{key:"_buildChildren",value:function(){if(!this.isChildrenBuilded)for(var e=0;e<this.children.length;e++){this.children[e].build()}}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"registerSelfBuildCallbackListener",value:function(e,t){this.selfBuildCompleteCallbacks.push(e),this.selfBuildCompleteCallbackParams.push(t)}},{key:"removeBuildCallbackListener",value:function(){}},{key:"notifyBuildCompleteListeners",value:function(){if(!this._isNotifyListeners){for(var e=0;e<this.buildCompleteCallbacks.length;e++){(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}this._isNotifyListeners=!0}}},{key:"notifySelfBuildCompleteListeners",value:function(){for(var e=0;e<this.selfBuildCompleteCallbacks.length;e++){(0,this.selfBuildCompleteCallbacks[e])(this,this.selfBuildCompleteCallbackParams[e])}}},{key:"findObjectByID",value:function(e){return this.objectsMap||(this.objectsMap={},this.collectObjectsToMap(this)),null!=e&&""!==e?this.objectsMap[e]:null}},{key:"collectObjectsToMap",value:function(e){this.objectsMap[e.id]=e;for(var t=0;t<e.children.length;t++){var i=e.children[t];this.collectObjectsToMap(i)}}},{key:"findObjectByUserID",value:function(e){if(!e)return null;if(this.userID===e)return this;if(this.children)for(var t=0;t<this.children.length;t++){var i=this.children[t];if(i.userID===e)return i;var r=i.findObjectByUserID(e);if(r)return r}return null}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){this.children[e].clear()}this.clearBuildMesh(),this.calculater=null,this.meshBuilder=null,this._initParams(),this.id=null}},{key:"clearBuildMesh",value:function(){this.meshBuilder&&this.meshBuilder.clear(this.mesh),this._isMeshBuilded=!1,this._isSelfBuilded=!1,this.mesh=null,this._isBuiled=!1,this._isNotifyListeners=!1}},{key:"deepClone",value:function(e){var t=Array.isArray(e)?[]:{};if(e&&"object"===(void 0===e?"undefined":Aa(e)))for(var i in e)e.hasOwnProperty(i)&&(t[i]=e&&"object"===Aa(e[i])?this.deepClone(e[i]):e[i]);return t}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){return null===this._selfSize?[0,0,0]:this._selfSize}},{key:"center",get:function(){if(null===this._center){if(!this.size||!this._box3)return[0,0,0];this._center=this._box3.getCenter().toArray()}return this._center}},{key:"size",set:function(e){this._size=e,0===this.children.length&&(this.selfSize=e)},get:function(){if(null===this._size)if(this.children.length>0){if(this._box3=new $a,0!==this.selfSize[0]&&0!==this.selfSize[1]&&0!==this.selfSize[2]){var e=new Ka(this.position[0],this.position[1],this.position[2]);e.y+=this.selfSize[1]/2,this._box3.setFromCenterAndSize(e,new Ka(this.selfSize[0],this.selfSize[1],this.selfSize[2]))}for(var t=this._getCalculateSizeObjects(),i=0;i<t.length;i++){var r=t[i];r.size&&r._box3&&this._box3.union(r._box3)}this._size=this._box3.getSize().toArray()}else this._size=this.selfSize;return this._size}},{key:"parent",get:function(){return this._parent},set:function(e){this._parent!==e&&(null!==this._parent&&this._parent._removeChild(this),null!=e&&(this._parent=e,this._parent&&this._parent._addChild(this)))}},{key:"isContainer",get:function(){return this.children.length>0}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource)),this._resources}},{key:"isBuilded",get:function(){return this._isBuiled}},{key:"isSelfBuilded",get:function(){return this._isSelfBuilded}},{key:"isChildrenBuilded",get:function(){return!this.isContainer||(!(this.children.length>0)||this._isChildrenBuilded)}},{key:"isResourcesBuilded",get:function(){for(var e=0;e<this.resources.length;e++){if(!this.resources[e].isBuilded)return!1}return!0}}]),e}()),nl=function(){function e(){ka(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return Oa(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),ol=function(e){function t(e){ka(this,t);var i=La(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="BatchCombinePlacement",i}return Fa(t,e),Oa(t,[{key:"_initParams",value:function(){Ba(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.objects=[],this.belongRoomUserID=null,this.transformations=[]}},{key:"addObject",value:function(e){this.objects.push(e);var t=new nl;t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),this.transformations.push(t)}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){if(null===this._selfSize){this._box3=new $a;for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t.size&&this._box3.union(t._box3)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}}]),t}(rl),sl=function(){function e(t){ka(this,e),this.object=t.object,this.mesh=null}return Oa(e,[{key:"build",value:function(){this.object.mesh=new THREE.Object3D}},{key:"clear",value:function(){}}]),e}(),al=function(e){function t(e){ka(this,t);var i=La(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="BatchPlacement",i}return Fa(t,e),t}(ol),ll=function(){function e(){ka(this,e),this.objectManager=null,this.parserConfig=Xa,this.rootParser=null,this.enableBatchPlacement=!0}return Oa(e,[{key:"parse",value:function(e){this.registerObjects(),this.registerMeshBuilder(),new(0,this.parserConfig[e.type])({object:e,manager:this}).parse()}},{key:"registerObjects",value:function(){this.objectManager.containObjectClass("BatchCombinePlacement")||this.objectManager.registerObjectClass("BatchCombinePlacement",ol),this.objectManager.containObjectClass("BatchPlacement")||this.objectManager.registerObjectClass("BatchPlacement",al)}},{key:"registerMeshBuilder",value:function(){if(this.objectManager.meshBuilderManager){var e=this.objectManager.meshBuilderManager;e.containMeshBuilderClass("BatchCombinePlacement")||e.registerMeshBuilder("BatchCombinePlacement",sl),e.containMeshBuilderClass("BatchPlacement")||e.registerMeshBuilder("BatchPlacement",sl)}}},{key:"clear",value:function(){this.rootParser&&this.rootParser.clear(),this.rootParser=null,this.objectManager=null,this.parserConfig=null}}]),e}(),ul=new(function(){function e(t){ka(this,e),this._versionMap={0:{0:ll,1:ll,2:ll}},this._smallVersionLibs=[[0,1,2]],this._bigVersions=[0]}return Oa(e,[{key:"getCombinerManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][i.length-1]}if(null==t){var r=this._smallVersionLibs[e];return new this._versionMap[e][r.length-1]}var n=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>n[n.length-1]?new this._versionMap[e][n.length-1]:new this._versionMap[e][t];console.error("max combiner not support version "+e+"."+t)}}]),e}()),cl=function(){function e(t){ka(this,e),this.objectManager=t.objectManager,this.enableBatchPlacement=!0,void 0!==t.enableBatchPlacement&&(this.enableBatchPlacement=t.enableBatchPlacement)}return Oa(e,[{key:"parse",value:function(e,t,i){var r=ul.getCombinerManager(t,i);return r.enableBatchPlacement=this.enableBatchPlacement,Ga.enableBatchPlacement=this.enableBatchPlacement,r?(r.objectManager=this.objectManager,r.parse(e)):null}},{key:"getCombineManager",value:function(e,t){var i=ul.getCombinerManager(e,t);return i.objectManager=this.objectManager,i}},{key:"clear",value:function(){}}]),e}(),hl=function e(t){p(this,e),this.objectsMap={}},pl=function(e){function t(e){p(this,t);var i=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.sceneJson=null,i.world=null,i.resourceManager=new Mi,i.debugManager=Yt,i.objectManager=new oi,i.loader=new Da({objectManager:i.objectManager,resourceManager:i.resourceManager}),i.loadVersion=null,i.enableRequestWorld=!0,i.dynamicBuildManager=new st(i),i.enableBatchPlacement=!0,i}return f(t,e),d(t,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"clearAllResources",value:function(){this.resourceManager.disposeModels(),this.resourceManager.disposeTextures()}},{key:"clearAllObjects",value:function(){this.world.clear()}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"disposeObject",value:function(e){this.dynamicBuildManager.disposeObject(e)}},{key:"findObjectByID",value:function(e){return this.world.findObjectByID(e)}},{key:"load",value:function(e){var t=e.bigVersion,i=e.smallVersion;return 0===t&&i>1&&(Mt.enableBatchObject=!0,void 0!==this.enableBatchPlacement&&(this.enableBatchPlacement=e.enableBatchPlacement)),this.objectManager.meshBuilderManager=us.createManager(t,i),Mt.enableBatchObject&&(this.combineManager=new cl({objectManager:this.objectManager,enableBatchPlacement:this.enableBatchPlacement})),this.world=this.loader.load(e),this.combineManager&&this.combineManager.parse(this.world,t,i),this.dynamicBuildManager.world=this.world,this.enableRequestWorld&&this.requestToBuild(this.world.id),this.world}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),t}(hl),dl=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},fl=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),ml=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},gl=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},vl=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},yl=function(){function e(t){dl(this,e),this.object=t.object,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.mesh=null,this._boxMesh=null}return fl(e,[{key:"build",value:function(){this._createMesh()}},{key:"_createMesh",value:function(){if(this.object.resource){var e=this.object.resource;e.isTestModel?this.object.mesh=e.model.clone():this.object.nodeName?this.createMeshByNode():this.createMeshByModelClone()}else null===this.object.mesh&&(this.object.mesh=new THREE.Object3D)}},{key:"createMeshByNode",value:function(){var e=this.object.resource.model.getObjectByName(this.object.nodeName);if(e){if(e=e.clone(),this.object.position=e.position.toArray(),this.object.scale=e.scale.toArray(),this.object.rotation=e.quaternion.toArray(),this.object.children.length>0)for(var t=e.children.length-1;t>-1;t--){var i=e.children[t];e.remove(i)}this.object.mesh=e}else console.warn("can not find node "+this.object.nodeName),this.object.mesh=new THREE.Object3D}},{key:"_setTransformation",value:function(e,t){e.position.equals(t.position)||(0===e.position.x&&0===e.position.y&&0===e.position.z?this.object.position=t.position.clone():t.position.copy(this.object.position)),e.scale.equals(t.scale)||(1===e.scale.x&&1===e.scale.y&&1===e.scale.z?this.object.scale=t.scale.clone():t.scale.copy(t.scale)),e.rotation.equals(t.quaternion)||(0===e.rotation.x&&0===e.rotation.y&&0===e.rotation.z&&1===e.rotation.w?this.object.rotation=t.quaternion.clone():t.quaternion.copy(this.object.rotation))}},{key:"createMeshByModelClone",value:function(){var e=this.object.resource.model.clone(),t=this.object.position,i=this.object.scale,r=this.object.rotation;e.position.set(t[0],t[1],t[2]),e.quaternion.set(r[0],r[1],r[2],r[3]),e.scale.set(i[0],i[1],i[2]),this.object.mesh=e,this.object.mesh.name=this.object.type+this.object.id}},{key:"createBoxMesh",value:function(){if(null===this._boxMesh){var e=new THREE.BoxBufferGeometry(1,1,1),t=new THREE.MeshBasicMaterial,i=new THREE.Mesh(e,t),r=this.object.size;i.scale.set(this.object.size[0],this.object.size[1],this.object.size[2]),i.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]),i.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),i.position.y=(this.object.position[1]+r[1])/2,this._boxMesh=i}return this._boxMesh}},{key:"notifyBuildCompleteListeners",value:function(){for(var e=0;e<this.buildCompleteCallbacks.length;e++){(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}}},{key:"checkResourceReady",value:function(){if(this.object.resources){for(var e=0;e<this.object.resources.length;e++){if(!this.object.resources[e].ready)return!1}return!0}return!this.object.resource||!!this.object.resource.ready}},{key:"initResource",value:function(){if(this.object.resources)for(var e=0;e<this.object.resources.length;e++){var t=this.object.resources[e];this.requestResource(t)}else this.requestResource(this.object.resource)}},{key:"requestResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"resourceCallback",value:function(e){this.build()}},{key:"_dispose",value:function(e){if(e instanceof THREE.Mesh){var t=e;if(t){var i=t.material,r=t.geometry;t.isDestory=!0,i&&(this._disposeMaterial(i),t.material=null),r&&(r.isDestory=!0,r.dispose(),t.geometry=null)}}if(e)for(var n=e.children,o=0;o<n.length;o++){var s=n[o];this._dispose(s)}}},{key:"_disposeMaterial",value:function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var i=e[t];this._disposeMaterial(i)}else e.isDestory=!0,e.dispose()}},{key:"clear",value:function(e){e&&(e.parent&&e.parent.remove(e),this._dispose(e)),this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.mesh=null,this._boxMesh=null}}]),e}(),bl=function(e){function t(e){dl(this,t);var i=vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.isRegisterObjectBuildCallback=!1,i}return gl(t,e),fl(t,[{key:"_createMesh",value:function(){ml(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this)}},{key:"buildCallback",value:function(e,t){var i=t.builder;i.applyRotationToChildren(),i.object.mesh.quaternion.set(0,0,0,1);for(var r=0;r<e.children.length;r++){e.children[r].meshBuilder.applyRotationToChildren()}}}]),t}(yl),_l=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),t}(yl),xl=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),t}(yl),El=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),t}(yl),wl=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),fl(t,[{key:"_createMesh",value:function(){ml(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this);var e=new THREE.Object3D;e.name="floorMax",e.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),e.scale.set(this.object.scale[0],this.object.scale[1],this.object.scale[2]),e.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]);var i=this.object.mesh;i.position.set(0,0,0),i.scale.set(1,1,1),i.quaternion.set(0,0,0,1),e.add(i);var r=i.position.clone();r.applyQuaternion(e.quaternion),i.position.copy(r),i.quaternion.premultiply(e.quaternion),this.object.rotation=[0,0,0,1],e.quaternion.set(0,0,0,1),this.object.mesh=e,this.object.floor&&(this.object.floor.mesh=i),this.object.roof&&(this.object.roof.mesh=new THREE.Object3D),this.object.ceiling&&(this.object.ceiling.mesh=new THREE.Object3D)}}]),t}(yl),Tl=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),t}(yl),Ml=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),t}(yl),Cl=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),t}(yl),Sl=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),t}(yl),jl=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),t}(yl),Pl=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),t}(yl),Rl=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),fl(t,[{key:"_createMesh",value:function(){this.object.mesh=new THREE.Object3D}}]),t}(yl),Dl=function(){function e(t){dl(this,e),this._map={Building:bl,World:_l,FloorPlan:Pl,Outdoors:El,Room:wl,Floor:xl,Placement:Tl,Facade:Sl,DoorOrWindow:jl,CombinePlacement:Ml,CombinePlacementByBatch:Rl,CombineModelWall:Cl}}return fl(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),Al=function(){function e(t){dl(this,e),this.builderTypeConfig=new Dl}return fl(e,[{key:"create",value:function(e){var t=e.type,i=this.builderTypeConfig.getClass(t);return i?new i(e):null}}]),e}(),kl=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),t}(yl),Ol=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),t}(yl),Bl=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),fl(t,[{key:"_createMesh",value:function(){ml(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this);var e=new THREE.Object3D;e.name="floorMax",e.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),e.scale.set(this.object.scale[0],this.object.scale[1],this.object.scale[2]),e.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]);var i=this.object.mesh;i.position.set(0,0,0),i.scale.set(1,1,1),i.quaternion.set(0,0,0,1),e.add(i);var r=i.position.clone();r.applyQuaternion(e.quaternion),i.position.copy(r),i.quaternion.premultiply(e.quaternion),this.object.rotation=[0,0,0,1],e.quaternion.set(0,0,0,1),this.object.mesh=e,this.object.floor&&null===this.object.floor.mesh&&(this.object.floor.mesh=i),this.object.roof&&null===this.object.roof.mesh&&(this.object.roof.mesh=new THREE.Object3D),this.object.ceiling&&null===this.object.ceiling.mesh&&(this.object.ceiling.mesh=new THREE.Object3D)}}]),t}(yl),Fl=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),fl(t,[{key:"_createMesh",value:function(){if(this.object.resource){var e=this.object.resource;e.isTestModel?this.object.mesh=e.model.clone():this.object.nodeName?this.createMeshByNode():this.createMeshByModelClone()}else null===this.object.mesh&&(this.object.mesh=new THREE.Object3D)}}]),t}(yl),Ll=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),t}(Fl),Il=function(e){function t(e){return dl(this,t),vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return gl(t,e),t}(Fl),Nl=function(e){function t(e){dl(this,t);var i=vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map.Roof=kl,i._map.Ceiling=Ol,i._map.Room=Bl,i._map.CombineFloor=Fl,i._map.CombineRoof=Ll,i._map.CombineCeiling=Il,i}return gl(t,e),t}(Dl),Ul=function(e){function t(e){dl(this,t);var i=vl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.builderTypeConfig=new Nl,i}return gl(t,e),t}(Al),zl=new(function(){function e(t){dl(this,e),this._versionMap={0:{0:Al,1:Ul}},this._smallVersionLibs=[[0,1]],this._bigVersions=[0]}return fl(e,[{key:"getManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][i.length-1]}if(null==t){var r=this._smallVersionLibs[e];return new this._versionMap[e][r.length-1]}var n=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>n[n.length-1]?new this._versionMap[e][n.length-1]:new this._versionMap[e][t];console.error("maxmeshbuilder not support version "+e+"."+t)}}]),e}()),Hl=new(function(){function e(t){dl(this,e)}return fl(e,[{key:"createManager",value:function(e){return zl.getManager(e.bigVersion,e.smallVersion)}}]),e}()),Vl="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},Wl=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Gl=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),ql=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},Xl=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Jl=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},Yl=new(function(){function e(t){Wl(this,e),this.config=null,this.objectManager=null}return Gl(e,[{key:"createObject",value:function(e){var t=this.config.getClass(e.creatorType);e.objectManager=this.objectManager;var i=new t(e),r=i.create();return i.parseChildren(),r}}]),e}()),Zl={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},Ql=function(){function e(){Wl(this,e)}return Gl(e,null,[{key:"uuid",value:function(){for(var e,t=Zl.chars,i=Zl.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Vl(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}}]),e}(),Kl=function(){function e(t){Wl(this,e),this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=t.jsonData,this.objectParent=null,t.parent&&(this.objectParent=t.parent),this.createType=null,this.resourceManager=t.resourceManager,this.objectManager=t.objectManager}return Gl(e,[{key:"create",value:function(){var e=this._getCreateParams();if(this.object=Yl.objectManager.create(e),this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.loadMode=0,this.jsonData.node?(this.object.nodeName=this.jsonData.node,this.object.loadMode=2):void 0!==this.jsonData.model&&null!==this.jsonData.model&&(this.object.loadMode=1),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object.resource||(this.object.resource=this.resourceManager.emptyModelResource),this.object.jsonData=this.jsonData,e.parent&&(this.object.parent=e.parent),this.jsonData.position){var t=this.jsonData.position;this.object.position=t}if(this.jsonData.scale){var i=this.jsonData.scale;0===i[0]&&(i[0]=.01),0===i[1]&&(i[1]=.01),0===i[2]&&(i[2]=.01),this.object.scale=i}if(this.jsonData.rotation){var r=this.jsonData.rotation;this.object.rotation=r}if(this.jsonData.properties&&(this.object.properties=this.jsonData.properties,this.object.lowerCaseProperties=this.convertPropertiesToLowerCase(this.jsonData.properties)),Ql.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.jsonData.caminfo){var n=this.jsonData.caminfo.eye,o=this.jsonData.caminfo.target;n[2]=-n[2],o[2]=-o[2],this.object.camInfo={eye:n,target:o}}if(this.jsonData.size){var s=this.jsonData.size;this.object.size=s}else this.object.size=[1,1,1];return this.object}},{key:"convertPropertiesToLowerCase",value:function(e){var t={};for(var i in e)t[i.toLowerCase()]=e[i].toLowerCase();return t}},{key:"parseChildren",value:function(){}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,Yl.createObject(e)}}]),e}(),$l=0,eu=1,tu=2,iu=3,ru=6,nu=7,ou=8,su=9,au=10,lu=11,uu=12,cu=13,hu=14,pu=15,du=16,fu=17,mu=18,gu=19,vu=21,yu=22,bu=23,_u=24,xu=25,Eu=26,wu=27,Tu=28,Mu=29,Cu=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return Xl(t,e),Gl(t,[{key:"parseChildren",value:function(){var e=this.jsonData;if(e.buildings&&this._parseJsonDataChildren({jsonData:e.buildings,creatorType:eu}),e.outdoors){var t=this._parseJsonDataChild({jsonData:e.outdoors,creatorType:au});this.object.outdoors=t}}}]),t}(Kl),Su=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),Ql.checkValueEmpty(this.jsonData.structshow)||(this.object.structShow=this.jsonData.structshow),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.facades&&this._parseJsonDataChildren({jsonData:e.facades,creatorType:lu}),e.facadegroups&&this._parseJsonDataChildren({jsonData:e.facadegroups,creatorType:uu}),e.plans&&this._parseJsonDataChildren({jsonData:e.plans,creatorType:tu})}}]),t}(Kl),ju=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),Ql.checkValueEmpty(this.jsonData.alwaysshowinsideobjs)||(this.object.alwaysShowInsideObjs=this.jsonData.alwaysshowinsideobjs),Ql.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.corners&&this._parseCorners(e.corners),e.walls&&this._parseWalls(e.walls),e.placements&&this._parseJsonDataChildren({jsonData:e.placements,creatorType:ru}),e.combineplacements&&this._parseJsonDataChildren({jsonData:e.combineplacements,creatorType:yu}),e.rooms&&this._parseJsonDataChildren({jsonData:e.rooms,creatorType:su}),e.groups&&this._parseJsonDataChildren({jsonData:e.groups,creatorType:nu}),e.curvelines&&this._parseJsonDataChildren({jsonData:e.curvelines,creatorType:cu}),e.routelines&&this._parseJsonDataChildren({jsonData:e.routelines,creatorType:mu}),e.leakwaterlines&&this._parseJsonDataChildren({jsonData:e.leakwaterlines,creatorType:hu}),e.arrowlines&&this._parseJsonDataChildren({jsonData:e.arrowlines,creatorType:pu}),e.arrowdatalines&&this._parseJsonDataChildren({jsonData:e.arrowdatalines,creatorType:du}),e.pipelines&&this._parseJsonDataChildren({jsonData:e.pipelines,creatorType:fu}),e.videoprobes&&this._parseJsonDataChildren({jsonData:e.videoprobes,creatorType:gu}),e.grounds&&this._parseJsonDataChildren({jsonData:e.grounds,creatorType:vu}),e.doororwindows&&this._parseDoorOrWindows(e.doororwindows)}},{key:"_parseCorners",value:function(e){for(var t=0;t<e.length;t++){var i=e[t],r=i[0],n=i[1],o=-i[2];this.object.existsCorner(r,n,o)?console.error("repeat corner"):this._parseJsonDataChild({jsonData:i,creatorType:iu})}}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];this._parseJsonDataChild({jsonData:i,creatorType:bu})}}},{key:"_parseDoorOrWindows",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i];this._parseJsonDataChild({jsonData:r,attachWall:t,creatorType:ou})}}}]),t}(Kl),Pu=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ModelWall",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),Ql.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),this.object}}]),t}(Kl),Ru=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="StraightManualWall",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}}]),t}(Kl),Du=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Placement",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){if(ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],Ql.checkValueEmpty(this.jsonData.texture)||(this.object.customTextureResource=this.resourceManager.textures[this.jsonData.texture]),this.jsonData.color){var e=this.jsonData.color;this.object.customColor=e,4===e.length&&(this.object.opacity=e[3])}return Ql.checkValueEmpty(this.jsonData.rendermode)||(this.object.renderMode=this.jsonData.rendermode),this.jsonData.animinfo&&(this.object.isPlayAnim=this.jsonData.animinfo.isplay,this.object.animClip=this.jsonData.animinfo.clip),Ql.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(Kl),Au=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementGroup",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.placements&&this._parseJsonDataChildren({jsonData:this.jsonData.placements,creatorType:ru}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:nu}),this.jsonData.videoprobes&&this._parseJsonDataChildren({jsonData:this.jsonData.videoprobes,creatorType:gu}),Ql.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(Kl),ku=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="DoorOrWindow",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){if(ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],Ql.checkValueEmpty(this.jsonData.suspendpercent)||(this.object.suspendPercent=this.jsonData.suspendpercent),Ql.checkValueEmpty(this.jsonData.isopen)||(this.object.isOpen=this.jsonData.isopen),Ql.checkValueEmpty(this.jsonData.diridx)||(this.object.openDirIndex=this.jsonData.diridx),!Ql.checkValueEmpty(this.jsonData.iswindow)){var e=this.jsonData.iswindow;"string"==typeof e&&(e="false"!==e.toLocaleString()),this.object.isWindow=e}return this.object}}]),t}(Kl),Ou=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._createChildren(),this.object}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:_u}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:xu}),this._parseJsonDataChild({jsonData:{},creatorType:Eu}))}}]),t}(Kl),Bu=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return Xl(t,e),t}(ju),Fu=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Facade",i}return Xl(t,e),t}(Du),Lu=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FacadeGroup",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.facades&&this._parseJsonDataChildren({jsonData:this.jsonData.facades,creatorType:lu}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:uu}),this.object}}]),t}(Kl),Iu=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombinePlacement",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(Kl),Nu=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineModelWall",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(Kl),Uu=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Floor",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(Kl),zu=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Ceiling",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(Kl),Hu=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Roof",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(Kl),Vu=function(){function e(t){Wl(this,e),this._map={0:Cu,1:Su,2:ju,4:Pu,5:Ru,6:Du,7:Au,8:ku,9:Ou,10:Bu,11:Fu,12:Lu,22:Iu,23:Nu,24:Uu,25:zu,26:Hu}}return Gl(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),Wu=function(){function e(t){Wl(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl}return Gl(e,[{key:"createResource",value:function(e){var t=this.manager.create({type:e});return t.manager=this.manager,t}},{key:"loadTextures",value:function(e){}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource("LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource("Resource");return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];if((t=this.createResource("Max2TjsResource")).baseUrl=this.baseModelUrl,r.localurl){if(t.localUrl=r.localurl,t.id=r.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,r.title&&(t.modelName=r.title),t.modelID=r.id,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.color){var n=r.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}}else if(r.id){if(t.id=r.id,t.modelID=r.id,t.version=r.version,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.model&&(t.modelID=r.model),r.title&&(t.modelName=r.title),r.color){n=r.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}if(r.size){var o=r.size;t.modelSize=new THREE.Vector3(o[0],o[1],o[2])}r.hasanimation&&(t.hasAnim=r.hasanimation),r.url&&(t.url=r.url)}for(var s=0;s<this.manager.ableToSupportFootAndHeadModelWalls.length;s++){var a=this.manager.ableToSupportFootAndHeadModelWalls[s];if(t.id===a){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var i=e.color;t.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(t.opacity=i[3])}if(e.size){var r=e.size;t.modelSize=new THREE.Vector3(r[0],r[1],r[2])}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),Gu=function(){function e(){Wl(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new Vu}return Gl(e,[{key:"setObjectTypeConfig",value:function(e){objectManager.objectTypeConfig=e}},{key:"setObjectManager",value:function(e){Yl.objectManager=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"loadLightMaps",value:function(e){var t=null,i="18091219l1g1hnjt",r="png";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(i=e.straightmanualwall.lightingtexture.id,r=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource("Resource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=i,t.ext=r,this.defaultResource.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource("Resource")).baseUrl=this.resourceManager.baseTextureUrl,t.id="18091216vjlgtwbh",t.ext="jpg",this.defaultResource.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=objectManager.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++){i+=t[r]+"/"}return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,i){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,(function(i){e.sceneJson=JSON.parse(i),t()}),(function(){}),(function(t){i("can not load "+e.sceneURL)}))}else i("load scene json error")}))}},{key:"getResourceLoader",value:function(){var e=new Wu(this.resourceManager);return e.resourceManager=this.resourceManager,e}},{key:"parseSceneJson",value:function(){var e=this.getResourceLoader();e.loadTextures(this.sceneJson.textures),e.loadModels(this.sceneJson.models),this.parseWorld(this.sceneJson)}},{key:"parseWorld",value:function(e){Yl.config=this.creatorTypeConfig,this.world=Yl.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:$l})}}]),e}(),qu=(new Gu,function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.floor&&this._parseJsonDataChild({jsonData:e.floor,creatorType:_u}),"FloorPlan"===this.object.parent.type&&(e.ceiling&&this._parseJsonDataChild({jsonData:e.ceiling,creatorType:xu}),e.roof&&this._parseJsonDataChild({jsonData:e.roof,creatorType:Eu}))}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:_u}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:xu}),this._parseJsonDataChild({jsonData:{},creatorType:Eu}))}}]),t}(Kl)),Xu=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineFloor",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(Kl),Ju=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineRoof",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(Kl),Yu=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineCeiling",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(Kl),Zu=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return Xl(t,e),Gl(t,[{key:"create",value:function(){return ql(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.combinefloors&&this._parseJsonDataChildren({jsonData:this.jsonData.combinefloors,creatorType:wu}),this.jsonData.combineroofs&&this._parseJsonDataChildren({jsonData:this.jsonData.combineroofs,creatorType:Mu}),this.jsonData.combineceilings&&this._parseJsonDataChildren({jsonData:this.jsonData.combineceilings,creatorType:Tu}),this.object}}]),t}(ju),Qu=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return Xl(t,e),t}(Zu),Ku=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map[su]=qu,i._map[wu]=Xu,i._map[Tu]=Yu,i._map[Mu]=Ju,i._map[tu]=Zu,i._map[au]=Qu,i}return Xl(t,e),t}(Vu),$u=function(e){function t(e){Wl(this,t);var i=Jl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.creatorTypeConfig=new Ku,i}return Xl(t,e),t}(Gu),ec=new(function(){function e(t){Wl(this,e),this._versionMap={0:{0:Gu,1:$u}},this._smallVersionLibs=[[0,1]],this._bigVersions=[0]}return Gl(e,[{key:"getLoaderManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1],r=i[i.length-1];return new this._versionMap[this._bigVersions.length-1][r]}if(null==t){var n=this._smallVersionLibs[e],o=n[n.length-1];return new this._versionMap[e][o]}var s=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1])){var a=s[s.length-1];return t>a||!this._versionMap[e][t]?new this._versionMap[e][a]:new this._versionMap[e][t]}console.error("bimLoader not support version "+e+"."+t)}}]),e}()),tc=function(){function e(t){Wl(this,e),this.resourceManager=t.resourceManager,this.defaultSetting=t.defaultSetting,this.defaultResource=t.defaultResource,this.objectManager=t.objectManager}return Gl(e,[{key:"load",value:function(e){var t=ec.getLoaderManager(e.bigVersion,e.smallVersion);return t.setDefaultSetting(this.defaultSetting),t.setDefaultResource(this.defaultResource),t.setResourceManager(this.resourceManager),t.setObjectManager(this.objectManager),t.parseObjects(e)}}]),e}(),ic=function(e){function t(e){p(this,t);var i=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.sceneJson=null,i.world=null,i.resourceManager=new Mi,i.objectManager=new oi,i.debugManager=Yt,i.loader=new tc({objectManager:i.objectManager,resourceManager:i.resourceManager}),i.loadVersion=null,i.enableRequestWorld=!0,i.dynamicBuildManager=new st(i),Mt.enableBatchObject&&(i.objectManager.meshBuilderManager.registerMeshBuilder(wt.CombinePlacement,Rl),i.combineManager=new cl({objectManager:i.objectManager})),i}return f(t,e),d(t,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"clearAllResources",value:function(){this.resourceManager.disposeModels(),this.resourceManager.disposeTextures()}},{key:"clearAllObjects",value:function(){this.world.clear()}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"disposeObject",value:function(e){this.dynamicBuildManager.disposeObject(e)}},{key:"findObjectByID",value:function(e){return this.world.findObjectByID(e)}},{key:"load",value:function(e){return this.objectManager.meshBuilderManager=Hl.createManager(e),this.world=this.loader.load(e),this.combineManager&&this.combineManager.parse(this.world),this.dynamicBuildManager.world=this.world,this.enableRequestWorld&&this.requestToBuild(this.world.id),this.world}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),t}(hl),rc="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},nc=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},oc=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),sc=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},ac=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},lc=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},uc={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},cc=function(){function e(){nc(this,e)}return oc(e,null,[{key:"uuid",value:function(){for(var e,t=uc.chars,i=uc.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":rc(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}}]),e}(),hc=function(){function e(t){nc(this,e),this.creatorManager=t.creatorManager}return oc(e,[{key:"initData",value:function(e){this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=e.jsonData,this.objectParent=null,e.parent&&(this.objectParent=e.parent),this.resourceManager=e.resourceManager}},{key:"create",value:function(e){this.initData(e);var t=this._getCreateParams();return this.object=this.creatorManager.objectManager.create(t),t.parent&&(this.object.parent=t.parent),this._loadBaseData(),this.object}},{key:"_loadBaseData",value:function(){if(this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.jsonData=this.jsonData,this.jsonData.position){var e=this.jsonData.position.slice();e[2]=-e[2],this.object.position=e}if(this.jsonData.scale){var t=this.jsonData.scale.slice();0===t[0]&&(t[0]=.01),0===t[1]&&(t[1]=.01),0===t[2]&&(t[2]=.01),this.object.scale=t}if(this.jsonData.rotation){var i=this.jsonData.rotation.slice();i[2]=-i[2],i[3]=-i[3],this.object.rotation=i}if(this.jsonData.properties&&(this.object.properties=this.jsonData.properties,this.object.lowerCaseProperties=this.convertPropertiesToLowerCase(this.jsonData.properties)),cc.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.jsonData.caminfo){var r=this.jsonData.caminfo.eye,n=this.jsonData.caminfo.target;r[2]=-r[2],n[2]=-n[2],this.object.camInfo={eye:r,target:n}}}},{key:"convertPropertiesToLowerCase",value:function(e){var t={};for(var i in e)t[i.toLowerCase()]=e[i].toLowerCase();return t}},{key:"parseChildren",value:function(){}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,this.creatorManager.createObject(e)}}]),e}(),pc=0,dc=1,fc=2,mc=3,gc=4,vc=5,yc=6,bc=7,_c=8,xc=9,Ec=10,wc=11,Tc=12,Mc=13,Cc=14,Sc=15,jc=16,Pc=17,Rc=18,Dc=19,Ac=20,kc=21,Oc=22,Bc=23,Fc=24,Lc=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return ac(t,e),oc(t,[{key:"parseChildren",value:function(){var e=this.jsonData;if(e.outdoors){var t=this._parseJsonDataChild({jsonData:e.outdoors,creatorType:Ec});this.object.outdoors=t}e.buildings&&this._parseJsonDataChildren({jsonData:e.buildings,creatorType:dc})}}]),t}(hc),Ic=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),cc.checkValueEmpty(this.jsonData.structshow)||(this.object.structShow=this.jsonData.structshow),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.facades&&this._parseJsonDataChildren({jsonData:e.facades,creatorType:wc}),e.facadegroups&&this._parseJsonDataChildren({jsonData:e.facadegroups,creatorType:Tc}),e.plans&&this._parseJsonDataChildren({jsonData:e.plans,creatorType:fc})}}]),t}(hc),Nc=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),cc.checkValueEmpty(this.jsonData.alwaysshowinsideobjs)||(this.object.alwaysShowInsideObjs=this.jsonData.alwaysshowinsideobjs),cc.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.corners&&this._parseCorners(e.corners),e.walls&&this._parseWalls(e.walls),e.rooms&&(this._parseJsonDataChildren({jsonData:e.rooms,creatorType:xc}),this.object.calRoomsUV2()),e.placements&&this._parseJsonDataChildren({jsonData:e.placements,creatorType:yc}),e.groups&&this._parseJsonDataChildren({jsonData:e.groups,creatorType:bc}),e.curvelines&&this._parseJsonDataChildren({jsonData:e.curvelines,creatorType:Mc}),e.routelines&&this._parseJsonDataChildren({jsonData:e.routelines,creatorType:Rc}),e.leakwaterlines&&this._parseJsonDataChildren({jsonData:e.leakwaterlines,creatorType:Cc}),e.arrowlines&&this._parseJsonDataChildren({jsonData:e.arrowlines,creatorType:Sc}),e.arrowdatalines&&this._parseJsonDataChildren({jsonData:e.arrowdatalines,creatorType:jc}),e.pipelines&&this._parseJsonDataChildren({jsonData:e.pipelines,creatorType:Pc}),e.videoprobes&&this._parseJsonDataChildren({jsonData:e.videoprobes,creatorType:Dc}),e.grounds&&this._parseJsonDataChildren({jsonData:e.grounds,creatorType:kc})}},{key:"_parseCorners",value:function(e){for(var t=0;t<e.length;t++){var i=e[t],r=i[0],n=i[1],o=-i[2];this.object.existsCorner(r,n,o)?console.error("repeat corner"):this._parseJsonDataChild({jsonData:i,creatorType:mc})}}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var i=e[t],r=null;0===i.type?r=this._parseJsonDataChild({jsonData:i,creatorType:vc}):1===i.type?r=this._parseJsonDataChild({jsonData:i,creatorType:gc}):2===i.type&&(r=this._parseJsonDataChild({jsonData:i,creatorType:Ac})),i.doororwindows&&this._parseDoorOrWindows(i.doororwindows,r)}}},{key:"_parseDoorOrWindows",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i];this._parseJsonDataChild({jsonData:r,attachWall:t,creatorType:_c})}}}]),t}(hc),Uc=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="WallCorner",i}return ac(t,e),oc(t,[{key:"create",value:function(e){sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.jsonData[0],r=this.jsonData[1],n=-this.jsonData[2];return this.object.position=[i,r,n],this.object}}]),t}(hc),zc=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ModelWall",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this._parseCorners(),cc.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),cc.checkValueEmpty(this.jsonData.height)?this.object.height=this.object.resource.size[1]:this.object.height=this.jsonData.height,cc.checkValueEmpty(this.jsonData.thick)||(this.object.thick=this.jsonData.thick),this.object}},{key:"_parseCorners",value:function(){var e=this.jsonData.corners,t=this.objectParent.typeToChildren.WallCorner;this.object.startCorner=t[e[0]],this.object.endCorner=t[e[1]]}}]),t}(hc),Hc=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="StraightManualWall",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this._parseCorners(),this._parseResources(),this.jsonData.uvmultiple&&(this.object.uvMultiple=this.jsonData.uvmultiple),cc.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),cc.checkValueEmpty(this.jsonData.thick)||(this.object.thick=this.jsonData.thick),this.object}},{key:"_parseCorners",value:function(){var e=this.jsonData.corners,t=this.objectParent.typeToChildren.WallCorner;this.object.startCorner=t[e[0]],this.object.endCorner=t[e[1]]}},{key:"_parseResources",value:function(){cc.checkValueEmpty(this.jsonData.lefttexture)||(this.object.leftResource=this.resourceManager.textures[this.jsonData.lefttexture]),cc.checkValueEmpty(this.jsonData.righttexture)||(this.object.rightResource=this.resourceManager.textures[this.jsonData.righttexture]),cc.checkValueEmpty(this.jsonData.edgetexture)||(this.object.edgeResource=this.resourceManager.textures[this.jsonData.edgetexture]),this.resourceManager.wallLightMapResource&&(this.object.lightMapResource=this.resourceManager.wallLightMapResource)}}]),t}(hc),Vc=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Placement",i}return ac(t,e),oc(t,[{key:"create",value:function(e){if(sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object.resource=this.resourceManager.models[this.jsonData.model],cc.checkValueEmpty(this.jsonData.texture)||(this.object.customTextureResource=this.resourceManager.textures[this.jsonData.texture]),this.jsonData.color){var i=this.jsonData.color;this.object.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(this.object.opacity=i[3])}return cc.checkValueEmpty(this.jsonData.rendermode)||(this.object.renderMode=this.jsonData.rendermode),this.jsonData.animinfo&&(this.object.isPlayAnim=this.jsonData.animinfo.isplay,this.object.animClip=this.jsonData.animinfo.clip),cc.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(hc),Wc=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementGroup",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.jsonData.placements&&this._parseJsonDataChildren({jsonData:this.jsonData.placements,creatorType:yc}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:bc}),this.jsonData.videoprobes&&this._parseJsonDataChildren({jsonData:this.jsonData.videoprobes,creatorType:Dc}),cc.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(hc),Gc=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="DoorOrWindow",i}return ac(t,e),oc(t,[{key:"initData",value:function(e){sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initData",this).call(this,e),this.attachWall=e.attachWall}},{key:"create",value:function(e){if(sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object.resource=this.resourceManager.models[this.jsonData.model],cc.checkValueEmpty(this.jsonData.suspendpercent)||(this.object.suspendPercent=this.jsonData.suspendpercent),cc.checkValueEmpty(this.jsonData.isopen)||(this.object.isOpen=this.jsonData.isopen),cc.checkValueEmpty(this.jsonData.diridx)||(this.object.openDirIndex=this.jsonData.diridx),!cc.checkValueEmpty(this.jsonData.iswindow)){var i=this.jsonData.iswindow;"string"==typeof i&&(i="false"!==i.toLocaleString()),this.object.isWindow=i}return this.object.attachWall=this.attachWall,this.attachWall.doorOrWindows.push(this.object),this.object}}]),t}(hc);function qc(e,t){if(!(this instanceof qc))return new qc(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||Xc,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function Xc(e,t){return e<t?-1:e>t?1:0}function Jc(e,t,i){var r,n,o,s;t=t||1;for(var a=0;a<e[0].length;a++){var l=e[0][a];(!a||l[0]<r)&&(r=l[0]),(!a||l[1]<n)&&(n=l[1]),(!a||l[0]>o)&&(o=l[0]),(!a||l[1]>s)&&(s=l[1])}var u=o-r,c=s-n,h=Math.min(u,c),p=h/2,d=new qc(null,Yc);if(0===h)return[r,n];for(var f=r;f<o;f+=h)for(var m=n;m<s;m+=h)d.push(new Zc(f+p,m+p,p,e));var g=function(e){for(var t=0,i=0,r=0,n=e[0],o=0,s=n.length,a=s-1;o<s;a=o++){var l=n[o],u=n[a],c=l[0]*u[1]-u[0]*l[1];i+=(l[0]+u[0])*c,r+=(l[1]+u[1])*c,t+=3*c}return 0===t?new Zc(n[0][0],n[0][1],0,e):new Zc(i/t,r/t,0,e)}(e),v=new Zc(r+u/2,n+c/2,0,e);v.d>g.d&&(g=v);for(var y=d.length;d.length;){var b=d.pop();b.d>g.d&&(g=b,i&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,y)),b.max-g.d<=t||(p=b.h/2,d.push(new Zc(b.x-p,b.y-p,p,e)),d.push(new Zc(b.x+p,b.y-p,p,e)),d.push(new Zc(b.x-p,b.y+p,p,e)),d.push(new Zc(b.x+p,b.y+p,p,e)),y+=4)}return i&&(console.log("num probes: "+y),console.log("best distance: "+g.d)),[g.x,g.y]}function Yc(e,t){return t.max-e.max}function Zc(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=function(e,t,i){for(var r=!1,n=1/0,o=0;o<i.length;o++)for(var s=i[o],a=0,l=s.length,u=l-1;a<l;u=a++){var c=s[a],h=s[u];c[1]>t!=h[1]>t&&e<(h[0]-c[0])*(t-c[1])/(h[1]-c[1])+c[0]&&(r=!r),n=Math.min(n,Qc(e,t,c,h))}return(r?1:-1)*Math.sqrt(n)}(e,t,r),this.max=this.d+this.h*Math.SQRT2}function Qc(e,t,i,r){var n=i[0],o=i[1],s=r[0]-n,a=r[1]-o;if(0!==s||0!==a){var l=((e-n)*s+(t-o)*a)/(s*s+a*a);l>1?(n=r[0],o=r[1]):l>0&&(n+=s*l,o+=a*l)}return(s=e-n)*s+(a=t-o)*a}qc.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,i=this.compare,r=t[e];e>0;){var n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r},_down:function(e){for(var t=this.data,i=this.compare,r=this.length>>1,n=t[e];e<r;){var o=1+(e<<1),s=o+1,a=t[o];if(s<this.length&&i(t[s],a)<0&&(o=s,a=t[s]),i(a,n)>=0)break;t[e]=a,e=o}t[e]=n}};var Kc=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this._createChildren(),this._parseCorners(),this._parsePoints(),0===this.object.points.length&&console.warn("room points is null"),this._parseHolesCorners(),this._parseHolesPoints(),this._parseRoomResources(),this._parseRoomHeight(),this._parseRoomBlockSize(),this._parseRoomVisible(),this._parseRoomBlockAngle(),this._setOutdoorFloorHeight(),this.object.position=this._calRoomPosition(this.object),this._subRoomHolesPointsByPosition(this.object,this.object.position),this._subRoomPointsByPosition(this.object,this.object.position),this.object}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:Oc}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:Bc}),this._parseJsonDataChild({jsonData:{},creatorType:Fc}))}},{key:"_parseCorners",value:function(){if(this.jsonData.corners){for(var e=[],t=this.objectParent.typeToChildren.WallCorner,i=0;i<this.jsonData.corners.length;i++){var r=t[this.jsonData.corners[i]].position.slice();e.push(r)}this.object.points=e}}},{key:"_parsePoints",value:function(){if(this.jsonData.points){for(var e=[],t=0;t<this.jsonData.points.length;t++){var i=this.jsonData.points[t],r=[i[0],i[1],-i[2]];e.push(r)}this.object.points=e}}},{key:"_parseHolesCorners",value:function(){if(this.jsonData.holescorners){for(var e=[],t=this.objectParent.typeToChildren.WallCorner,i=0;i<this.jsonData.holescorners.length;i++){for(var r=this.jsonData.holescorners[i],n=[],o=0;o<r.length;o++){var s=r[o];n.push(t[s].position.slice())}e.push(n)}this.object.holes=e}}},{key:"_parseHolesPoints",value:function(){if(this.jsonData.holespoints){for(var e=[],t=0;t<this.jsonData.holespoints.length;t++){for(var i=this.jsonData.holespoints[t],r=[],n=0;n<i.length;n++){var o=i[n],s=[o[0],o[1],-o[2]];r.push(s)}e.push(r)}this.object.holes=e}}},{key:"_parseRoomResources",value:function(){null!==this.jsonData.floortexture&&void 0!==this.jsonData.floortexture&&(this.object.floorResource=this.resourceManager.textures[this.jsonData.floortexture],this.object.floor.resource=this.object.floorResource),this.object.ceiling&&null!==this.jsonData.ceilingtexture&&void 0!==this.jsonData.ceilingtexture&&(this.object.ceilingResource=this.resourceManager.textures[this.jsonData.ceilingtexture],this.object.ceiling.resource=this.object.ceilingResource),this.object.roof&&null!==this.jsonData.rooftexture&&void 0!==this.jsonData.rooftexture&&(this.object.roofResource=this.resourceManager.textures[this.jsonData.rooftexture],this.object.roof.resource=this.object.roofResource)}},{key:"_parseRoomHeight",value:function(){var e=this.jsonData,t=this.object;t.ceiling&&(void 0!==e.ceilingheight?t.ceiling.height=e.ceilingheight:(t.ceiling.DefaultHeight=this.objectParent.height-.1,t.ceiling.height=t.ceiling.DefaultHeight)),t.roof&&(void 0!==e.roofheight?t.roof.height=e.roofheight:(t.roof.defaultHeight=this.objectParent.height,t.roof.height=t.roof.defaultHeight)),void 0!==e.floorheight&&(t.floor.height=e.floorheight)}},{key:"_parseRoomVisible",value:function(){var e=this.jsonData,t=this.object;t.floor&&void 0!==e.isshowfloor&&(t.floor.visible=e.isshowfloor),t.ceiling&&void 0!==e.isshowceiling&&(t.ceiling.visible=e.isshowceiling),t.roof&&void 0!==e.isshowroof&&(t.roof.visible=e.isshowroof)}},{key:"_parseRoomBlockSize",value:function(){var e=this.jsonData,t=this.object;if(t.floor&&e.floorblocksize){var i=e.floorblocksize;t.floor.blockSize=[i[0],i[1]]}if(t.ceiling&&e.ceilingblocksize){i=e.ceilingblocksize;t.ceiling.blockSize=[i[0],i[1]]}if(t.roof&&e.roofblocksize){i=e.roofblocksize;t.roof.blockSize=[i[0],i[1]]}}},{key:"_parseRoomBlockAngle",value:function(){var e=this.jsonData,t=this.object;t.floor&&e.floorblockangle&&(t.floor.blockAngle=e.floorblockangle),t.ceiling&&e.ceilingblockangle&&(t.ceiling.blockAngle=e.ceilingblockangle),t.roof&&e.roofblockangle&&(t.roof.blockAngle=e.roofblockangle)}},{key:"_setOutdoorFloorHeight",value:function(){var e=this.objectParent,t=this.object;"Outdoors"===e.type&&t.floor.height===t.floor.DefaultHeight&&(t.floor.height=0,t.floor.DefaultHeight=0)}},{key:"_calRoomPosition",value:function(e){for(var t=e.points,i=e.holes,r=[],n=[],o=0;o<t.length;o++){var s=t[o];r.push([s[0],s[2]])}if(i.length>2&&!this._isSamePoints(i))for(o=0;o<i.length;o++){for(var a=i[o],l=[],u=0;u<a.length;u++){s=a[u];l.push([s[0],s[2]])}n.push(l)}var c=this._getLabelPosition(r,n);return c||[0,0,0]}},{key:"_isSamePoints",value:function(e){for(var t=e[0],i=1;i<e.length;i++){var r=e[i];if(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2])return!1}return!0}},{key:"_getLabelPosition",value:function(e,t){if(!e||!e.length)return null;var i=[];i.push(e);var r=Jc(i);return[r[0],0,r[1]]}},{key:"_subRoomPointsByPosition",value:function(e,t){for(var i=e.points,r=0;r<i.length;r++){var n=i[r];n[0]-=t[0],n[1]-=t[1],n[2]-=t[2]}e.points=i}},{key:"_subRoomHolesPointsByPosition",value:function(e,t){for(var i=e.holes,r=0;r<i.length;r++)for(var n=i[r],o=0;o<n.length;o++){var s=n[o];s[0]-=t[0],s[1]-=t[1],s[2]-=t[2]}e.holes=i}}]),t}(hc),$c=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return ac(t,e),t}(Nc),eh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Facade",i}return ac(t,e),t}(Vc),th=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FacadeGroup",i}return ac(t,e),oc(t,[{key:"create",value:function(e){this.initData(e);var t=this._getCreateParams();return this.object=this.creatorManager.objectManager.create(t),t.parent&&(this.object.parent=t.parent),this._loadBaseData(),this.jsonData.facades&&this._parseJsonDataChildren({jsonData:this.jsonData.facades,creatorType:wc}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:Tc}),cc.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(Wc),ih=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CurveLine",i}return ac(t,e),oc(t,[{key:"create",value:function(e){sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.jsonData;if(cc.checkValueEmpty(this.jsonData.texture)?this.object.resource=this.resourceManager.emptyTextureResource:this.object.resource=this.resourceManager.textures[this.jsonData.texture],this.jsonData.color){var r=this.jsonData.color;this.object.color=r,4===r.length&&(this.object.opacity=r[3])}if(void 0!==i.textiling){var n=i.textiling;this.object.textureTiling=n}if(void 0!==i.texoffset){var o=i.texoffset;this.object.textureOffset=o}!cc.checkValueEmpty(this.jsonData.width)&&(this.object.width=this.jsonData.width),this.jsonData.enableanim&&(this.object.enableMaterialAnimation=this.jsonData.enableanim),!cc.checkValueEmpty(this.jsonData.matanimspeed)&&(this.object.materialAnimationSpeed=this.jsonData.matanimspeed);for(var s=this.jsonData.path,a=0;a<s.length;a++){var l=s[a];l[2]=-l[2],this.object.points.push(l)}return this.object}}]),t}(hc),rh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PipeLine",i}return ac(t,e),oc(t,[{key:"create",value:function(e){if(sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),cc.checkValueEmpty(this.jsonData.texture)?this.object.resource=this.resourceManager.emptyTextureResource:this.object.resource=this.resourceManager.textures[this.jsonData.texture],this.jsonData.color){var i=this.jsonData.color;this.object.color=i,4===i.length&&(this.object.opacity=i[3])}this.jsonData.sectionType&&(this.object.sectionType=this.jsonData.sectionType),!cc.checkValueEmpty(this.jsonData.rendermode)&&(this.object.renderMode=this.jsonData.rendermode),!cc.checkValueEmpty(this.jsonData.radius)&&(this.object.radius=this.jsonData.radius),this.jsonData.enableanim&&(this.object.enableMaterialAnimation=this.jsonData.enableanim),!cc.checkValueEmpty(this.jsonData.matanimspeed)&&(this.object.materialAnimationSpeed=this.jsonData.matanimspeed);for(var r=this.jsonData.path,n=0;n<r.length;n++){var o=r[n];o[2]=-o[2],this.object.points.push(o)}return this.object}}]),t}(hc),nh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="LeakWaterLine",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.jsonData.alarmlength&&(this.object.alarmLength=this.jsonData.alarmlength),this.object}}]),t}(rh),oh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ArrowLine",i}return ac(t,e),oc(t,[{key:"create",value:function(e){sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.object,r=this.jsonData;return null!==i.width&&(i.arrowWidth=3*i.width,i.arrowHeight=2*i.width),r.arrow?(cc.checkValueEmpty(r.arrow.texture)?i.arrowResource=this.resourceManager.emptyTextureResource:i.arrowResource=this.resourceManager.textures[r.arrow.texture],r.arrow.width&&(i.arrowWidth=r.arrow.width),r.arrow.height&&(i.arrowHeight=r.arrow.height)):i.arrowResource=this.resourceManager.emptyTextureResource,this.object}}]),t}(ih),sh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ArrowDataLine",i}return ac(t,e),oc(t,[{key:"create",value:function(e){sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.object,r=this.jsonData;if(r.pointuserids){var n=r.pointuserids;i.pointUserIDs=n}if(r.pointproperteis){var o=r.pointproperteis;i.pointProperteis=o}return this.object}}]),t}(oh),ah=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="RouteLine",i}return ac(t,e),t}(ih),lh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="VideoProbe",i}return ac(t,e),t}(Vc),uh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementWall",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}}]),t}(Vc),ch=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementGround",i}return ac(t,e),t}(Vc),hh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Ceiling",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(hc),ph=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Roof",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(hc),dh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Floor",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(hc),fh=function(){function e(t){nc(this,e),this._map={0:Lc,1:Ic,2:Nc,3:Uc,4:zc,5:Hc,6:Vc,7:Wc,8:Gc,9:Kc,10:$c,11:eh,12:th,13:ih,14:nh,15:oh,16:sh,17:rh,18:ah,19:lh,20:uh,21:ch,22:dh,23:hh,24:ph}}return oc(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),mh=function(){function e(t){nc(this,e),this.config=new fh,this.objectManager=null,this.creatorMap={},this.creatorTypePlaceholderMap={}}return oc(e,[{key:"createObject",value:function(e){var t=e.creatorType,i=null;this.creatorMap[t]&&!this.creatorTypePlaceholderMap[t]?i=this.creatorMap[t]:(i=new(this.config.getClass(t))({creatorManager:this}),this.creatorMap[t]=i);this.creatorTypePlaceholderMap[t]||(this.creatorTypePlaceholderMap[t]=e.jsonData.id);var r=i.create(e),n=!0;return void 0!==e.enableCreateChildren&&null!==e.enableCreateChildren&&(n=e.enableCreateChildren),n&&i.parseChildren(),this.creatorTypePlaceholderMap[t]===r.id&&(this.creatorTypePlaceholderMap[t]=null),r}}]),e}(),gh=function(){function e(t){nc(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl,this.userDefaultWallLightMap=!0}return oc(e,[{key:"createResource",value:function(e,t){var i=this.manager.create({id:e,type:t});return i.manager=this.manager,i}},{key:"loadLightMaps",value:function(e){var t=null,i="18091219l1g1hnjt",r="png";e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(i=e.straightmanualwall.lightingtexture.id,r=e.straightmanualwall.lightingtexture.ext,this.manager.userDefaultWallLightMap=!1),(t=this.createResource(i,this.manager.ClassName.TextureResource)).baseUrl=this.manager.baseTextureUrl,t.id=i,t.ext=r,this.manager.wallLightMapResource=t,this.manager.textures.push(t)}},{key:"loadTextures",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];t=r.localurl?this._loadLocalCustomTextureResource(r):this._loadTextureResource(r),this.manager.textures.push(t)}}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource(e.id,"LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource(e.id,this.manager.ClassName.TextureResource);return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];if((t=r.model?this.createResource(r.id,"CustomResource"):r.localurl?this.createResource(r.id,"CustomModelResource"):this.createResource(r.id,this.manager.ClassName.ModelResource)).baseUrl=this.baseModelUrl,r.localurl){if(t.localUrl=r.localurl,t.id=r.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,r.title&&(t.modelName=r.title),t.modelID=r.id,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.color){var n=r.color;t.color=[n[0],n[1],n[2]],4===n.length&&(t.opacity=n[3])}}else if(r.id){if(t.id=r.id,t.modelID=r.id,t.version=r.version,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.model&&(t.modelID=r.model),r.title&&(t.modelName=r.title),r.color){n=r.color;t.color=[n[0],n[1],n[2]],4===n.length&&(t.opacity=n[3])}if(r.size){var o=r.size;t.size=o}r.hasanimation&&(t.hasAnim=r.hasanimation),r.url&&(t.url=r.url)}for(var s=0;s<this.manager.ableToSupportFootAndHeadModelWalls.length;s++){var a=this.manager.ableToSupportFootAndHeadModelWalls[s];if(t.id===a){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var i=e.color;t.color=[i[0],i[1],i[2]],4===i.length&&(t.opacity=i[3])}if(e.size){var r=e.size;t.modelSize=[r[0],r[1],r[2]]}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),vh=function(){function e(){nc(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new fh,this.creatorManager=new mh}return oc(e,[{key:"setObjectTypeConfig",value:function(e){objectManager.objectTypeConfig=e}},{key:"setObjectManager",value:function(e){this.creatorManager.objectManager=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"loadLightMaps",value:function(e){var t=null,i="18091219l1g1hnjt",r="png";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(i=e.straightmanualwall.lightingtexture.id,r=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource(this.resourceManager.ClassName.TextureResource)).baseUrl=this.resourceManager.baseTextureUrl,t.id=i,t.ext=r,this.defaultResource.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource(this.resourceManager.ClassName.TextureResource)).baseUrl=this.resourceManager.baseTextureUrl,t.id="18091216vjlgtwbh",t.ext="jpg",this.defaultResource.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=this.resourceManager.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++){i+=t[r]+"/"}return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,i){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,(function(i){e.sceneJson=JSON.parse(i),t()}),(function(){}),(function(t){i("can not load "+e.sceneURL)}))}else i("load scene json error")}))}},{key:"getResourceLoader",value:function(){return new gh(this.resourceManager)}},{key:"parseSceneJson",value:function(){this.parseResources(this.sceneJson,this.resourceManager),this.parseWorld(this.sceneJson)}},{key:"parseResources",value:function(e,t){var i=new gh(t);i.loadTextures(e.textures),i.loadModels(e.models),i.loadLightMaps(e.materialsetting)}},{key:"parseWorld",value:function(e){this.world=this.creatorManager.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:pc})}},{key:"getCreatorManager",value:function(){return this.creatorManager}},{key:"getCreatorConfig",value:function(){return new fh}}]),e}(),yh=function(){function e(t){nc(this,e),this.creatorManager=t.creatorManager}return oc(e,[{key:"initData",value:function(e){this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=e.jsonData,this.objectParent=null,e.parent&&(this.objectParent=e.parent),this.resourceManager=e.resourceManager}},{key:"create",value:function(e){this.initData(e);var t=this._getCreateParams();return this.object=this.creatorManager.objectManager.create(t),t.parent&&(this.object.parent=t.parent),this._loadBaseData(),this.object}},{key:"_loadBaseData",value:function(){if(this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.jsonData=this.jsonData,this._initIDOnesPlaceNumber(),this.jsonData.position){var e=this.jsonData.position.slice();this._decodePosition(e),e[2]=-e[2],this.object.position=e}if(this.jsonData.scale){var t=this.jsonData.scale.slice();this._decodeScale(t),0===t[0]&&(t[0]=.01),0===t[1]&&(t[1]=.01),0===t[2]&&(t[2]=.01),this.object.scale=t}if(this.jsonData.rotation){var i=this.jsonData.rotation.slice();this._decodeRotation(i),i[2]=-i[2],i[3]=-i[3],this.object.rotation=i}if(this.jsonData.properties&&(this.object.properties=this.jsonData.properties,this.object.lowerCaseProperties=this.convertPropertiesToLowerCase(this.jsonData.properties)),cc.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.jsonData.caminfo){var r=this.jsonData.caminfo.eye,n=this.jsonData.caminfo.target;r[2]=-r[2],n[2]=-n[2],this.object.camInfo={eye:r,target:n}}}},{key:"_initIDOnesPlaceNumber",value:function(){var e=this.object.id,t=-1,i=Number(e);if(isNaN(i)){if(t=0,this._isUUID(e)){var r=e.slice(e.length-2);if(r){var n=parseInt(r,16);isNaN(n)||(t=n)}}}else t=(i=parseInt(e.substring(e.length-1)))%10;this.decodeIDOnesPlace=1^t}},{key:"_decodePosition",value:function(e){0!==e[0]&&(e[0]=this._decodeNumber(e[0])),0!==e[1]&&(e[1]=this._decodeNumber(e[1])),0!==e[2]&&(e[2]=this._decodeNumber(e[2]))}},{key:"_decodeScale",value:function(e){1!==e[0]&&(e[0]=this._decodeNumber(e[0])),1!==e[1]&&(e[1]=this._decodeNumber(e[1])),1!==e[2]&&(e[2]=this._decodeNumber(e[2]))}},{key:"_decodeRotation",value:function(e){0!==e[0]&&(e[0]=this._decodeNumber(e[0])),0!==e[1]&&(e[1]=this._decodeNumber(e[1])),0!==e[2]&&(e[2]=this._decodeNumber(e[2]))}},{key:"_decodeNumber",value:function(e){return e>0?e-this.decodeIDOnesPlace:e+this.decodeIDOnesPlace}},{key:"_decodeArray",value:function(e){for(var t=0;t<e.length;t++){e[t];0!==e[t]&&(e[t]=e[t]>0?e[t]-this.decodeIDOnesPlace:e[t]+this.decodeIDOnesPlace)}}},{key:"convertPropertiesToLowerCase",value:function(e){var t={};for(var i in e)t[i.toLowerCase()]=e[i].toLowerCase();return t}},{key:"parseChildren",value:function(){}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,this.creatorManager.createObject(e)}},{key:"_isUUID",value:function(e){var t=""+e;return null!==(t=t.match("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"))}}]),e}(),bh=1,_h=2,xh=3,Eh=4,wh=5,Th=6,Mh=7,Ch=8,Sh=9,jh=10,Ph=11,Rh=12,Dh=13,Ah=14,kh=15,Oh=16,Bh=17,Fh=18,Lh=19,Ih=20,Nh=21,Uh=22,zh=23,Hh=24,Vh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return ac(t,e),oc(t,[{key:"parseChildren",value:function(){var e=this.jsonData;if(e.outdoors){var t=this._parseJsonDataChild({jsonData:e.outdoors,creatorType:jh});this.object.outdoors=t}e.buildings&&this._parseJsonDataChildren({jsonData:e.buildings,creatorType:bh})}}]),t}(yh),Wh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),cc.checkValueEmpty(this.jsonData.structshow)||(this.object.structShow=this.jsonData.structshow),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.facades&&this._parseJsonDataChildren({jsonData:e.facades,creatorType:Ph}),e.facadegroups&&this._parseJsonDataChildren({jsonData:e.facadegroups,creatorType:Rh}),e.plans&&this._parseJsonDataChildren({jsonData:e.plans,creatorType:_h})}}]),t}(yh),Gh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),cc.checkValueEmpty(this.jsonData.alwaysshowinsideobjs)||(this.object.alwaysShowInsideObjs=this.jsonData.alwaysshowinsideobjs),cc.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.corners&&this._parseCorners(e.corners),e.walls&&this._parseWalls(e.walls),e.rooms&&(this._parseJsonDataChildren({jsonData:e.rooms,creatorType:Sh}),this.object.calRoomsUV2()),e.placements&&this._parseJsonDataChildren({jsonData:e.placements,creatorType:Th}),e.groups&&this._parseJsonDataChildren({jsonData:e.groups,creatorType:Mh}),e.curvelines&&this._parseJsonDataChildren({jsonData:e.curvelines,creatorType:Dh}),e.routelines&&this._parseJsonDataChildren({jsonData:e.routelines,creatorType:Fh}),e.leakwaterlines&&this._parseJsonDataChildren({jsonData:e.leakwaterlines,creatorType:Ah}),e.arrowlines&&this._parseJsonDataChildren({jsonData:e.arrowlines,creatorType:kh}),e.arrowdatalines&&this._parseJsonDataChildren({jsonData:e.arrowdatalines,creatorType:Oh}),e.pipelines&&this._parseJsonDataChildren({jsonData:e.pipelines,creatorType:Bh}),e.videoprobes&&this._parseJsonDataChildren({jsonData:e.videoprobes,creatorType:Lh}),e.grounds&&this._parseJsonDataChildren({jsonData:e.grounds,creatorType:Nh})}},{key:"_parseCorners",value:function(e){for(var t=0;t<e.length;t++){var i=e[t],r=i[0],n=i[1],o=-i[2];this.object.existsCorner(r,n,o)?console.error("repeat corner"):this._parseJsonDataChild({jsonData:i,creatorType:xh})}}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var i=e[t],r=null;0===i.type?r=this._parseJsonDataChild({jsonData:i,creatorType:wh}):1===i.type?r=this._parseJsonDataChild({jsonData:i,creatorType:Eh}):2===i.type&&(r=this._parseJsonDataChild({jsonData:i,creatorType:Ih})),i.doororwindows&&this._parseDoorOrWindows(i.doororwindows,r)}}},{key:"_parseDoorOrWindows",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i];this._parseJsonDataChild({jsonData:r,attachWall:t,creatorType:Ch})}}}]),t}(yh),qh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="WallCorner",i}return ac(t,e),oc(t,[{key:"create",value:function(e){sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.jsonData.slice();this._decodeArray(i);var r=i[0],n=i[1],o=-i[2];return this.object.position=[r,n,o],this.object}},{key:"_initIDOnesPlaceNumber",value:function(){var e=this.object.parent.id;"Outdoors"===this.object.parent.type&&(e="3");var t=-1,i=Number(e);if(isNaN(i)){if(t=0,this._isUUID(e)){var r=e.slice(e.length-2);if(r){var n=parseInt(r,16);isNaN(n)||(t=n)}}}else t=(i=parseInt(e.substring(e.length-1)))%10;this.decodeIDOnesPlace=1^t}}]),t}(yh),Xh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ModelWall",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this._parseCorners(),cc.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),cc.checkValueEmpty(this.jsonData.height)?this.object.height=this.object.resource.size[1]:this.object.height=this.jsonData.height,cc.checkValueEmpty(this.jsonData.thick)||(this.object.thick=this.jsonData.thick),this.object}},{key:"_parseCorners",value:function(){var e=this.jsonData.corners,t=this.objectParent.typeToChildren.WallCorner;this.object.startCorner=t[e[0]],this.object.endCorner=t[e[1]]}}]),t}(yh),Jh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="StraightManualWall",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this._parseCorners(),this._parseResources(),this.jsonData.uvmultiple&&(this.object.uvMultiple=this.jsonData.uvmultiple),cc.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),cc.checkValueEmpty(this.jsonData.thick)||(this.object.thick=this.jsonData.thick),this.object}},{key:"_parseCorners",value:function(){var e=this.jsonData.corners,t=this.objectParent.typeToChildren.WallCorner;this.object.startCorner=t[e[0]],this.object.endCorner=t[e[1]]}},{key:"_parseResources",value:function(){cc.checkValueEmpty(this.jsonData.lefttexture)||(this.object.leftResource=this.resourceManager.textures[this.jsonData.lefttexture]),cc.checkValueEmpty(this.jsonData.righttexture)||(this.object.rightResource=this.resourceManager.textures[this.jsonData.righttexture]),cc.checkValueEmpty(this.jsonData.edgetexture)||(this.object.edgeResource=this.resourceManager.textures[this.jsonData.edgetexture]),this.resourceManager.wallLightMapResource&&(this.object.lightMapResource=this.resourceManager.wallLightMapResource)}}]),t}(yh),Yh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Placement",i}return ac(t,e),oc(t,[{key:"create",value:function(e){if(sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object.resource=this.resourceManager.models[this.jsonData.model],cc.checkValueEmpty(this.jsonData.texture)||(this.object.customTextureResource=this.resourceManager.textures[this.jsonData.texture]),this.jsonData.color){var i=this.jsonData.color;this.object.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(this.object.opacity=i[3])}return cc.checkValueEmpty(this.jsonData.rendermode)||(this.object.renderMode=this.jsonData.rendermode),this.jsonData.animinfo&&(this.object.isPlayAnim=this.jsonData.animinfo.isplay,this.object.animClip=this.jsonData.animinfo.clip),cc.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(yh),Zh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementGroup",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.jsonData.placements&&this._parseJsonDataChildren({jsonData:this.jsonData.placements,creatorType:Th}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:Mh}),this.jsonData.videoprobes&&this._parseJsonDataChildren({jsonData:this.jsonData.videoprobes,creatorType:Lh}),cc.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(yh),Qh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="DoorOrWindow",i}return ac(t,e),oc(t,[{key:"initData",value:function(e){sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initData",this).call(this,e),this.attachWall=e.attachWall}},{key:"create",value:function(e){if(sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object.resource=this.resourceManager.models[this.jsonData.model],cc.checkValueEmpty(this.jsonData.suspendpercent)||(this.object.suspendPercent=this.jsonData.suspendpercent),cc.checkValueEmpty(this.jsonData.isopen)||(this.object.isOpen=this.jsonData.isopen),cc.checkValueEmpty(this.jsonData.diridx)||(this.object.openDirIndex=this.jsonData.diridx),!cc.checkValueEmpty(this.jsonData.iswindow)){var i=this.jsonData.iswindow;"string"==typeof i&&(i="false"!==i.toLocaleString()),this.object.isWindow=i}return this.object.attachWall=this.attachWall,this.attachWall.doorOrWindows.push(this.object),this.object}}]),t}(yh),Kh=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this._createChildren(),this._parseCorners(),this._parsePoints(),0===this.object.points.length&&console.warn("room points is null"),this._parseHolesCorners(),this._parseHolesPoints(),this._parseRoomResources(),this._parseRoomHeight(),this._parseRoomBlockSize(),this._parseRoomVisible(),this._parseRoomBlockAngle(),this._setOutdoorFloorHeight(),this.object.position=this._calRoomPosition(this.object),this._subRoomHolesPointsByPosition(this.object,this.object.position),this._subRoomPointsByPosition(this.object,this.object.position),this.object}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:Uh}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:zh}),this._parseJsonDataChild({jsonData:{},creatorType:Hh}))}},{key:"_parseCorners",value:function(){if(this.jsonData.corners){for(var e=[],t=this.objectParent.typeToChildren.WallCorner,i=0;i<this.jsonData.corners.length;i++){var r=t[this.jsonData.corners[i]].position.slice();e.push(r)}this.object.points=e}}},{key:"_parsePoints",value:function(){if(this.jsonData.points){for(var e=[],t=0;t<this.jsonData.points.length;t++){var i=this.jsonData.points[t],r=[i[0],i[1],-i[2]];e.push(r)}this.object.points=e}}},{key:"_parseHolesCorners",value:function(){if(this.jsonData.holescorners){for(var e=[],t=this.objectParent.typeToChildren.WallCorner,i=0;i<this.jsonData.holescorners.length;i++){for(var r=this.jsonData.holescorners[i],n=[],o=0;o<r.length;o++){var s=r[o];n.push(t[s].position.slice())}e.push(n)}this.object.holes=e}}},{key:"_parseHolesPoints",value:function(){if(this.jsonData.holespoints){for(var e=[],t=0;t<this.jsonData.holespoints.length;t++){for(var i=this.jsonData.holespoints[t],r=[],n=0;n<i.length;n++){var o=i[n],s=[o[0],o[1],-o[2]];r.push(s)}e.push(r)}this.object.holes=e}}},{key:"_parseRoomResources",value:function(){null!==this.jsonData.floortexture&&void 0!==this.jsonData.floortexture&&(this.object.floorResource=this.resourceManager.textures[this.jsonData.floortexture],this.object.floor.resource=this.object.floorResource),this.object.ceiling&&null!==this.jsonData.ceilingtexture&&void 0!==this.jsonData.ceilingtexture&&(this.object.ceilingResource=this.resourceManager.textures[this.jsonData.ceilingtexture],this.object.ceiling.resource=this.object.ceilingResource),this.object.roof&&null!==this.jsonData.rooftexture&&void 0!==this.jsonData.rooftexture&&(this.object.roofResource=this.resourceManager.textures[this.jsonData.rooftexture],this.object.roof.resource=this.object.roofResource)}},{key:"_parseRoomHeight",value:function(){var e=this.jsonData,t=this.object;t.ceiling&&(void 0!==e.ceilingheight?t.ceiling.height=e.ceilingheight:(t.ceiling.DefaultHeight=this.objectParent.height-.1,t.ceiling.height=t.ceiling.DefaultHeight)),t.roof&&(void 0!==e.roofheight?t.roof.height=e.roofheight:(t.roof.defaultHeight=this.objectParent.height,t.roof.height=t.roof.defaultHeight)),void 0!==e.floorheight&&(t.floor.height=e.floorheight)}},{key:"_parseRoomVisible",value:function(){var e=this.jsonData,t=this.object;t.floor&&void 0!==e.isshowfloor&&(t.floor.visible=e.isshowfloor),t.ceiling&&void 0!==e.isshowceiling&&(t.ceiling.visible=e.isshowceiling),t.roof&&void 0!==e.isshowroof&&(t.roof.visible=e.isshowroof)}},{key:"_parseRoomBlockSize",value:function(){var e=this.jsonData,t=this.object;if(t.floor&&e.floorblocksize){var i=e.floorblocksize;t.floor.blockSize=[i[0],i[1]]}if(t.ceiling&&e.ceilingblocksize){i=e.ceilingblocksize;t.ceiling.blockSize=[i[0],i[1]]}if(t.roof&&e.roofblocksize){i=e.roofblocksize;t.roof.blockSize=[i[0],i[1]]}}},{key:"_parseRoomBlockAngle",value:function(){var e=this.jsonData,t=this.object;t.floor&&e.floorblockangle&&(t.floor.blockAngle=e.floorblockangle),t.ceiling&&e.ceilingblockangle&&(t.ceiling.blockAngle=e.ceilingblockangle),t.roof&&e.roofblockangle&&(t.roof.blockAngle=e.roofblockangle)}},{key:"_setOutdoorFloorHeight",value:function(){var e=this.objectParent,t=this.object;"Outdoors"===e.type&&t.floor.height===t.floor.DefaultHeight&&(t.floor.height=0,t.floor.DefaultHeight=0)}},{key:"_calRoomPosition",value:function(e){for(var t=e.points,i=e.holes,r=[],n=[],o=0;o<t.length;o++){var s=t[o];r.push([s[0],s[2]])}if(i.length>2&&!this._isSamePoints(i))for(o=0;o<i.length;o++){for(var a=i[o],l=[],u=0;u<a.length;u++){s=a[u];l.push([s[0],s[2]])}n.push(l)}var c=this._getLabelPosition(r,n);return c||[0,0,0]}},{key:"_isSamePoints",value:function(e){for(var t=e[0],i=1;i<e.length;i++){var r=e[i];if(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2])return!1}return!0}},{key:"_getLabelPosition",value:function(e,t){if(!e||!e.length)return null;var i=[];i.push(e);var r=Jc(i);return[r[0],0,r[1]]}},{key:"_subRoomPointsByPosition",value:function(e,t){for(var i=e.points,r=0;r<i.length;r++){var n=i[r];n[0]-=t[0],n[1]-=t[1],n[2]-=t[2]}e.points=i}},{key:"_subRoomHolesPointsByPosition",value:function(e,t){for(var i=e.holes,r=0;r<i.length;r++)for(var n=i[r],o=0;o<n.length;o++){var s=n[o];s[0]-=t[0],s[1]-=t[1],s[2]-=t[2]}e.holes=i}}]),t}(yh),$h=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return ac(t,e),t}(Gh),ep=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Facade",i}return ac(t,e),t}(Yh),tp=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FacadeGroup",i}return ac(t,e),oc(t,[{key:"create",value:function(e){this.initData(e);var t=this._getCreateParams();return this.object=this.creatorManager.objectManager.create(t),t.parent&&(this.object.parent=t.parent),this._loadBaseData(),this.jsonData.facades&&this._parseJsonDataChildren({jsonData:this.jsonData.facades,creatorType:Ph}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:Rh}),cc.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(Zh),ip=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CurveLine",i}return ac(t,e),oc(t,[{key:"create",value:function(e){sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.jsonData;if(cc.checkValueEmpty(this.jsonData.texture)?this.object.resource=this.resourceManager.emptyTextureResource:this.object.resource=this.resourceManager.textures[this.jsonData.texture],this.jsonData.color){var r=this.jsonData.color;this.object.color=r,4===r.length&&(this.object.opacity=r[3])}if(void 0!==i.textiling){var n=i.textiling;this.object.textureTiling=n}if(void 0!==i.texoffset){var o=i.texoffset;this.object.textureOffset=o}!cc.checkValueEmpty(this.jsonData.width)&&(this.object.width=this.jsonData.width),this.jsonData.enableanim&&(this.object.enableMaterialAnimation=this.jsonData.enableanim),!cc.checkValueEmpty(this.jsonData.matanimspeed)&&(this.object.materialAnimationSpeed=this.jsonData.matanimspeed);for(var s=this.jsonData.path,a=0;a<s.length;a++){var l=s[a];l[2]=-l[2],this.object.points.push(l)}return this.object}}]),t}(yh),rp=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PipeLine",i}return ac(t,e),oc(t,[{key:"create",value:function(e){if(sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),cc.checkValueEmpty(this.jsonData.texture)?this.object.resource=this.resourceManager.emptyTextureResource:this.object.resource=this.resourceManager.textures[this.jsonData.texture],this.jsonData.color){var i=this.jsonData.color;this.object.color=i,4===i.length&&(this.object.opacity=i[3])}this.jsonData.sectionType&&(this.object.sectionType=this.jsonData.sectionType),!cc.checkValueEmpty(this.jsonData.rendermode)&&(this.object.renderMode=this.jsonData.rendermode),!cc.checkValueEmpty(this.jsonData.radius)&&(this.object.radius=this.jsonData.radius),this.jsonData.enableanim&&(this.object.enableMaterialAnimation=this.jsonData.enableanim),!cc.checkValueEmpty(this.jsonData.matanimspeed)&&(this.object.materialAnimationSpeed=this.jsonData.matanimspeed);for(var r=this.jsonData.path,n=0;n<r.length;n++){var o=r[n];o[2]=-o[2],this.object.points.push(o)}return this.object}}]),t}(yh),np=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="LeakWaterLine",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.jsonData.alarmlength&&(this.object.alarmLength=this.jsonData.alarmlength),this.object}}]),t}(rp),op=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ArrowLine",i}return ac(t,e),oc(t,[{key:"create",value:function(e){sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.object,r=this.jsonData;return null!==i.width&&(i.arrowWidth=3*i.width,i.arrowHeight=2*i.width),r.arrow?(cc.checkValueEmpty(r.arrow.texture)?i.arrowResource=this.resourceManager.emptyTextureResource:i.arrowResource=this.resourceManager.textures[r.arrow.texture],r.arrow.width&&(i.arrowWidth=r.arrow.width),r.arrow.height&&(i.arrowHeight=r.arrow.height)):i.arrowResource=this.resourceManager.emptyTextureResource,this.object}}]),t}(ip),sp=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ArrowDataLine",i}return ac(t,e),oc(t,[{key:"create",value:function(e){sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.object,r=this.jsonData;if(r.pointuserids){var n=r.pointuserids;i.pointUserIDs=n}if(r.pointproperteis){var o=r.pointproperteis;i.pointProperteis=o}return this.object}}]),t}(op),ap=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="RouteLine",i}return ac(t,e),t}(ip),lp=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="VideoProbe",i}return ac(t,e),t}(Yh),up=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementWall",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}}]),t}(Yh),cp=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementGround",i}return ac(t,e),t}(Yh),hp=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Ceiling",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(yh),pp=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Roof",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(yh),dp=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Floor",i}return ac(t,e),oc(t,[{key:"create",value:function(e){return sc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(yh),fp=function(){function e(t){nc(this,e),this._map={0:Vh,1:Wh,2:Gh,3:qh,4:Xh,5:Jh,6:Yh,7:Zh,8:Qh,9:Kh,10:$h,11:ep,12:tp,13:ip,14:np,15:op,16:sp,17:rp,18:ap,19:lp,20:up,21:cp,22:dp,23:hp,24:pp}}return oc(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),mp=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.config=new fp,i}return ac(t,e),t}(mh),gp=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.creatorManager=new mp,i}return ac(t,e),t}(vh),vp=function(e){function t(e){return nc(this,t),lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ac(t,e),oc(t,[{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl?this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl:this.resourceManager.localCustomModelBaseUrl="https://www.thingjs.com/",this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}}]),t}(vh),yp=function(e){function t(e){return nc(this,t),lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ac(t,e),t}(mp),bp=function(e){function t(e){nc(this,t);var i=lc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.creatorManager=new yp,i}return ac(t,e),t}(vp),_p=new(function(){function e(t){nc(this,e),this._versionMap={0:{0:vh,1:vh,2:gp},1:{0:vp,2:bp}},this._smallVersionLibs=[[0,1,2],[0,2]],this._bigVersions=[0,1]}return oc(e,[{key:"getLoaderManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1],r=i[i.length-1];return new this._versionMap[this._bigVersions.length-1][r]}if(null==t){var n=this._smallVersionLibs[e],o=n[n.length-1];return new this._versionMap[e][o]}var s=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1])){var a=s[s.length-1];return t>a||!this._versionMap[e][t]?new this._versionMap[e][a]:new this._versionMap[e][t]}console.error("ubuilderLoader not support version "+e+"."+t)}}]),e}()),xp=function(){function e(t){nc(this,e),this.resourceManager=t.resourceManager,this.defaultSetting=t.defaultSetting,this.defaultResource=t.defaultResource,this.objectManager=t.objectManager}return oc(e,[{key:"load",value:function(e){return this.getLoaderManager(e.bigVersion,e.smallVersion).parseObjects(e)}},{key:"getLoaderManager",value:function(e,t){var i=_p.getLoaderManager(e,t);return i.setDefaultSetting(this.defaultSetting),i.setDefaultResource(this.defaultResource),i.setResourceManager(this.resourceManager),i.setObjectManager(this.objectManager),i}},{key:"clear",value:function(){this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.objectManager=null}}]),e}(),Ep=function(e){function t(e){p(this,t);var i=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));i.sceneJson=null,i.world=null,i.debugManager=Yt;var r=new oi,n=new Mi;return r.meshBuilderManager=Vn.create(),r.calculaterManager=$r.create(),r.calculaterManager.testInfo=e,n.modelCombineBuilder=$n,i.objectManager=r,i.loader=new xp({objectManager:r,resourceManager:n,defaultSetting:Mt,defaultResource:jt}),i.combineManager=new So({objectManager:r}),i.dynamicBuildManager=new st(i),i.dynamicBuildManager.testInfo=e,i.objectsMap={},i.enableRequestWorld=!0,i.loadVersion=null,i.resourceManager=n,i}return f(t,e),d(t,[{key:"setResourcesUnitDownloadNumber",value:function(e){this.dynamicBuildManager.maxResourcesUnitDownloadNumber=e}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"clearAllResources",value:function(){this.resourceManager.clear(),this.objectManager.meshBuilderManager.clear(),this.objectManager.calculaterManager.clear(),this.dynamicBuildManager.clear()}},{key:"clearAllObjects",value:function(){this.world.clear()}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"disposeObject",value:function(e){var t=this.world.findObjectByID(e);t&&t.clearBuildMesh()}},{key:"findObjectByID",value:function(e){return this.world.findObjectByID(e)}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this;return i.world=i.loader.load(e),i.combineManager.parse(i.world),i.dynamicBuildManager.world=i.world,i.enableRequestWorld&&i.requestToBuild(i.world.id),t?i.world:new Promise((function(e,t){e(i.world)}))}},{key:"downloadResourceProgress",get:function(){return meshBuilderManager.downloadResProgess}}]),t}(hl),wp=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Tp=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Mp=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},Cp=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Sp=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},jp=new(function(){function e(t){wp(this,e),this.config=null,this.objectManager=null,this.creatorMap={},this.creatorTypePlaceholderMap={},this.loadModeConfig={}}return Tp(e,[{key:"addLoadDataType",value:function(e,t){this.loadModeConfig[e]=t}},{key:"createObject",value:function(e){var t=e.creatorType,i=null;this.creatorMap[t]&&!this.creatorTypePlaceholderMap[t]?i=this.creatorMap[t]:(i=new(this.config.getClass(t)),this.creatorMap[t]=i);this.creatorTypePlaceholderMap[t]||(this.creatorTypePlaceholderMap[t]=e.jsonData.id);var r=i.create(e);return i.parseChildren(),this.creatorTypePlaceholderMap[t]===r.id&&(this.creatorTypePlaceholderMap[t]=null),r}}]),e}()),Pp=function(){function e(t,i){wp(this,e);var r=t.loadversion;if(this.mode=3,this.bigVersion=null,this.smallVersion=null,r)if(isNaN(r)){var n=r.split(".");this.mode=parseInt(n[0]),n[1]&&(this.bigVersion=parseInt(n[1])),n[2]&&(this.smallVersion=parseInt(n[2]))}else this.mode=r;else i&&i.dataVersion&&(this.mode=i.dataVersion.getMode())}return Tp(e,[{key:"getMode",value:function(){return this.mode}},{key:"getBigVersion",value:function(){return this.bigVersion}},{key:"getSmallVersion",value:function(){return this.smallVersion}}]),e}(),Rp=function(){function e(t){wp(this,e)}return Tp(e,[{key:"initData",value:function(e){this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=e.jsonData,this.objectParent=null,e.parent&&(this.objectParent=e.parent),this.resourceManager=e.resourceManager}},{key:"create",value:function(e){this.initData(e);var t=new Pp(this.jsonData,this.objectParent),i=jp.loadModeConfig[t.getMode()].getLoaderManager(t.getBigVersion(),t.getSmallVersion()).getCreatorManager();return this.object=i.createObject(this._initCreateParams(e)),this.object.dataVersion=t,this.object.children.forEach((function(e){return e.dataVersion=t})),this.object}},{key:"parseChildren",value:function(){}},{key:"_initCreateParams",value:function(e){return e.enableCreateChildren=!1,e}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,jp.createObject(e)}}]),e}(),Dp=0,Ap=1,kp=2,Op=10,Bp=11,Fp=12,Lp=function(e){function t(e){wp(this,t);var i=Sp(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return Cp(t,e),Tp(t,[{key:"parseChildren",value:function(){var e=this.jsonData;if(e.outdoors){var t=this._parseJsonDataChild({jsonData:e.outdoors,creatorType:Op});this.object.outdoors=t}e.buildings&&this._parseJsonDataChildren({jsonData:e.buildings,creatorType:Ap})}}]),t}(Rp),Ip=function(e){function t(e){wp(this,t);var i=Sp(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return Cp(t,e),Tp(t,[{key:"create",value:function(e){return Mp(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.facades&&this._parseJsonDataChildren({jsonData:e.facades,creatorType:Bp}),e.facadegroups&&this._parseJsonDataChildren({jsonData:e.facadegroups,creatorType:Fp}),e.plans&&this._parseJsonDataChildren({jsonData:e.plans,creatorType:kp})}}]),t}(Rp),Np=function(e){function t(e){wp(this,t);var i=Sp(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return Cp(t,e),Tp(t,[{key:"_initCreateParams",value:function(e){return e.enableCreateChildren=!0,e}},{key:"create",value:function(e){return Mp(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}}]),t}(Rp),Up=function(e){function t(e){wp(this,t);var i=Sp(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return Cp(t,e),t}(Np),zp=function(e){function t(e){wp(this,t);var i=Sp(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Facade",i}return Cp(t,e),t}(Rp),Hp=function(e){function t(e){wp(this,t);var i=Sp(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FacadeGroup",i}return Cp(t,e),Tp(t,[{key:"_initCreateParams",value:function(e){return e.enableCreateChildren=!0,e}}]),t}(Rp),Vp=function(){function e(t){wp(this,e),this._map={0:Lp,1:Ip,2:Np,10:Up,11:zp,12:Hp}}return Tp(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),Wp=function(){function e(t){wp(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl,this.userDefaultWallLightMap=!0}return Tp(e,[{key:"createResource",value:function(e,t){var i=this.manager.create({id:e,type:t});return i.manager=this.manager,i}},{key:"loadLightMaps",value:function(e){var t=null,i="18091219l1g1hnjt",r="png";e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(i=e.straightmanualwall.lightingtexture.id,r=e.straightmanualwall.lightingtexture.ext,this.userDefaultWallLightMap=!1),(t=this.createResource(i,this.manager.ClassName.TextureResource)).baseUrl=this.manager.baseTextureUrl,t.id=i,t.ext=r,this.manager.wallLightMapResource=t,this.manager.textures.push(t)}},{key:"loadTextures",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];t=r.localurl?this._loadLocalCustomTextureResource(r):this._loadTextureResource(r),this.manager.textures.push(t)}}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource(e.id,"LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource(e.id,this.manager.ClassName.TextureResource);return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i],n=new Pp(r);if(r.model)t=this.createResource(r.id,"CustomResource");else if(r.localurl){var o="CustomModelResource";5===n.getMode()&&(o="Max2TjsResource"),t=this.createResource(r.id,o)}else t=this.createResource(r.id,this.manager.ClassName.ModelResource);if(t.baseUrl=this.baseModelUrl,r.localurl){if(t.localUrl=r.localurl,t.id=r.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,r.title&&(t.modelName=r.title),t.modelID=r.id,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.color){var s=r.color;t.color=[s[0],s[1],s[2]],4===s.length&&(t.opacity=s[3])}}else if(r.id){if(t.id=r.id,t.modelID=r.id,t.version=r.version,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.model&&(t.modelID=r.model),r.title&&(t.modelName=r.title),r.color){s=r.color;t.color=[s[0],s[1],s[2]],4===s.length&&(t.opacity=s[3])}if(r.size){var a=r.size;t.size=a}r.hasanimation&&(t.hasAnim=r.hasanimation),r.url&&(t.url=r.url)}for(var l=0;l<this.manager.ableToSupportFootAndHeadModelWalls.length;l++){var u=this.manager.ableToSupportFootAndHeadModelWalls[l];if(t.id===u){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var i=e.color;t.color=[i[0],i[1],i[2]],4===i.length&&(t.opacity=i[3])}if(e.size){var r=e.size;t.modelSize=[r[0],r[1],r[2]]}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),Gp=function(){function e(){wp(this,e),this.sceneJson=null,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new Vp}return Tp(e,[{key:"setObjectManager",value:function(e){jp.objectManager=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"addLoadDataType",value:function(e,t){jp.addLoadDataType(e,t)}},{key:"parseDataTypeVersion",value:function(e){if(e.loaderVersions){var t=e.loaderVersions;for(var i in t)this.addLoadDataType(i,t[i])}}},{key:"parseObjects",value:function(e){return this.resourceManager=e.resourceManager,e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseDataTypeVersion(e),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"parseSceneJson",value:function(){this.parseResources(this.sceneJson,this.resourceManager),this.parseWorld(this.sceneJson)}},{key:"parseResources",value:function(e,t){var i=new Wp(t);i.loadTextures(e.textures),i.loadModels(e.models),i.loadLightMaps(e.materialsetting)}},{key:"parseWorld",value:function(e){jp.config=this.creatorTypeConfig,this.world=jp.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:Dp})}}]),e}(),qp=(new Gp,new(function(){function e(t){wp(this,e),this._versionMap={0:{0:Gp}},this._smallVersionLibs=[[0]],this._bigVersions=[0]}return Tp(e,[{key:"getLoaderManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][i.length-1]}if(null==t){var r=this._smallVersionLibs[e];return new this._versionMap[e][r.length-1]}return new this._versionMap[e][t]}}]),e}())),Xp=function(){function e(t){wp(this,e)}return Tp(e,[{key:"load",value:function(e){return qp.getLoaderManager(e.bigVersion,e.smallVersion).parseObjects(e)}},{key:"clear",value:function(){}}]),e}(),Jp=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Yp=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Zp=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Qp=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},Kp=function(){function e(t){Jp(this,e),this._initParams(),this.object=t.object,this.manager=t.manager}return Yp(e,[{key:"_initParams",value:function(){this.object=null,this.manager=null}},{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var i=e[t],r=this.manager.parserConfig[i.type];if(r)new r({object:i,manager:this.manager}).parse()}}},{key:"parseInMode",value:function(e){var t=e.dataVersion,i=t.getMode(),r=t.getBigVersion(),n=t.getSmallVersion();this.manager.getCombineManager(i,r,n).parse(e)}},{key:"clear",value:function(){this._initParams()}}]),e}(),$p={World:function(e){function t(e){return Jp(this,t),Qp(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Zp(t,e),Yp(t,[{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var i=e[t];if("Outdoors"===i.type)this.parseInMode(i);else{var r=this.manager.parserConfig[i.type];if(r)new r({object:i,manager:this.manager}).parse()}}}}]),t}(Kp),Building:function(e){function t(e){return Jp(this,t),Qp(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Zp(t,e),Yp(t,[{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var i=e[t];"FloorPlan"===i.type&&this.parseInMode(i)}}}]),t}(Kp)},ed=function(){function e(){Jp(this,e),this.objectManager=null,this.parserConfig=$p,this.rootParser=null,this.combineModeConfig={},this.objectManagerModeConfig={}}return Yp(e,[{key:"addCombineMode",value:function(e,t,i){this.combineModeConfig[e]=t,this.objectManagerModeConfig[e]=i}},{key:"parse",value:function(e){this.initCombineManagerVersions(e);var t=e.object;new(0,this.parserConfig[t.type])({object:t,manager:this}).parse()}},{key:"initCombineManagerVersions",value:function(e){var t=e.combineManagerVersions;for(var i in t)this.combineModeConfig[i]=t[i]}},{key:"initObjectManagerVersions",value:function(e){var t=e.objectManagerVersions;for(var i in t)this.objectManagerModeConfig[i]=t[i]}},{key:"getCombineManager",value:function(e,t,i){return this.combineModeConfig[e].getCombineManager(t,i)}},{key:"clear",value:function(){this.rootParser&&this.rootParser.clear(),this.rootParser=null,this.objectManager=null,this.parserConfig=null,this.combineModeConfig={}}}]),e}(),td=new(function(){function e(t){Jp(this,e),this._versionMap={0:{0:ed}},this._smallVersionLibs=[[0]],this._bigVersions=[0]}return Yp(e,[{key:"getCombinerManager",value:function(e,t){if(null==e){e=this._bigVersions[this._bigVersions.length-1];var i=this._smallVersionLibs[e];return t=i[i.length-1],new this._versionMap[e][t]}if(null==t){var r=this._smallVersionLibs[e];return t=r[r.length-1],new this._versionMap[e][t]}return this._versionMap[e]&&this._versionMap[e][t]?new this._versionMap[e][t]:null}}]),e}()),id=function(){function e(t){Jp(this,e)}return Yp(e,[{key:"parse",value:function(e){var t=td.getCombinerManager(e.bigVersion,e.smallVersion);return t?t.parse(e):null}},{key:"clear",value:function(){}}]),e}(),rd=function(e){function t(e){p(this,t);var i=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.sceneJson=null,i.world=null,i.debugManager=Yt,i.resourceManager=new Mi,i.builderObjectManager=new oi,i.maxObjectManager=new oi,i.loader=new Xp,i.dynamicBuildManager=new st(i),i.combineManager=new id,i.objectsMap={},i.enableRequestWorld=!0,i.loadVersion=null,i}return f(t,e),d(t,[{key:"getMaxLoaderManager",value:function(){return this.maxObjectManager.meshBuilderManager=us.createManager(),new Da({objectManager:this.maxObjectManager,resourceManager:this.resourceManager})}},{key:"getUbuilderLoaderManager",value:function(){return this.builderObjectManager.meshBuilderManager=Vn.create(),this.builderObjectManager.calculaterManager=$r.create(),new xp({objectManager:this.builderObjectManager,resourceManager:this.resourceManager,defaultSetting:Mt,defaultResource:jt})}},{key:"setResourcesUnitDownloadNumber",value:function(e){this.dynamicBuildManager.maxResourcesUnitDownloadNumber=e}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"clearAllResources",value:function(){this.resourceManager.clear()}},{key:"clearAllObjects",value:function(){this.world.clear(),this.builderObjectManager.meshBuilderManager.clear(),this.builderObjectManager.calculaterManager.clear(),this.maxObjectManager.meshBuilderManager.clear(),this.maxObjectManager.calculaterManager.clear()}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"disposeObject",value:function(e){this.dynamicBuildManager.disposeObject(e)}},{key:"findObjectByID",value:function(e){return this.world.findObjectByID(e)}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this;return this.initLoaderParams(e),i.world=i.loader.load(e),i.combineManager.parse({object:i.world,bigVersion:0,smallVersion:0,combineManagerVersions:{3:new So({objectManager:this.builderObjectManager}),5:new cl({objectManager:this.maxObjectManager})}}),i.dynamicBuildManager.world=i.world,i.enableRequestWorld&&i.requestToBuild(i.world.id),t?i.world:new Promise((function(e,t){e(i.world)}))}},{key:"initLoaderParams",value:function(e){e.resourceManager=this.resourceManager,e.loaderVersions={3:this.getUbuilderLoaderManager(),5:this.getMaxLoaderManager()}}},{key:"downloadResourceProgress",get:function(){return meshBuilderManager.downloadResProgess}}]),t}(hl);e.Bim2TjsLoader=ic,e.Building=kt,e.CurveLine=Ot,e.DefaultSetting=Mt,e.DoorOrWindow=Nt,e.Max2TjsLoader=pl,e.MixTjsLoader=rd,e.Outdoors=Vt,e.PipeLine=Wt,e.Placement=Lt,e.PlacementGroup=Ut,e.Room=Tt,e.ThingjsEditorSceneLoader=jo,e.ThingjsEditorSceneLoader_2_0=Po,e.UBuilderSceneLoader=Ep,e.VideoProbe=Xt,e.debugManager=Yt,Object.defineProperty(e,"__esModule",{value:!0})})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).THING=e.THING||{})}(this,(function(e){"use strict";var t,i,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),this._domElement=t.domElement,this._onChange=t.onChange||function(){},this._observer=new MutationObserver(this._onChange)}return e.prototype.watch=function(e){var t={};e.forEach((function(e){t[e]=!0})),this._observer.observe(this._domElement,t)},e.prototype.unwatch=function(){this._observer.disconnect()},e}(),u=function(e){return function(t){return toString.call(t)=="[object "+e+"]"}},c=function(){function e(t){n(this,e);var i,r,o=new TextEncoderLite("utf-8").encode(t),s=[],a=0;for(i=0;i<256;i++)s[i]=i;for(i=0;i<256;i++)a=(a+s[i]+o[i%o.length])%256,r=s[i],s[i]=s[a],s[a]=r;this._s=s,this._i=0,this._j=0}return e.prototype.update=function(e){var t=e;return u("String")(e)&&(t=new TextEncoderLite("utf-8").encode(e)),u("Array")(e)&&(t=new Uint8Array(e)),u("Uint8Array")(t)?this._update(t):null},e.prototype._update=function(e){var t,i,r,n=e.length,o=new Uint8Array(n),s=this._i,a=this._j,l=this._s.concat();for(r=0;r<n;r++)i=l[a=(a+(t=l[s=(s+1)%256]))%256],l[s]=i,l[a]=t,o[r]=e[r]^l[(t+i)%256];return o},e.prototype.toStr=function(e){var t=this.update(e);return t?new TextDecoderLite("utf-8").decode(t):null},e.prototype._toStr=function(e){var t=this._update(e);return t?new TextDecoderLite("utf-8").decode(t):null},e}(),h=new c("bai@3$%218%^$%^~)((&0!?<kjh"),p="";document.getElementsByTagName&&(i=(t=document.getElementsByTagName(h._toStr([76,245,185,246,70,34])))[t.length-1],p=document.querySelector?i.src:i.getAttribute(h._toStr([76,228,168]),4));var d=new Uint8Array([0,97,115,109,1,0,0,0,1,199,128,128,128,0,12,96,1,127,1,127,96,1,127,0,96,2,127,127,0,96,3,127,127,127,1,127,96,2,127,127,1,127,96,5,127,127,127,127,127,1,127,96,2,126,126,1,126,96,3,126,126,126,1,126,96,4,126,126,127,127,0,96,0,0,96,4,127,127,127,127,0,96,0,1,127,2,140,129,128,128,0,8,3,101,110,118,6,95,95,101,120,105,116,0,1,3,101,110,118,14,95,99,111,110,115,111,108,101,66,117,102,102,101,114,0,1,3,101,110,118,11,95,99,111,110,115,111,108,101,76,111,103,0,2,3,101,110,118,14,95,99,111,110,115,111,108,101,78,117,109,98,101,114,0,1,3,101,110,118,5,95,102,114,101,101,0,1,3,101,110,118,7,95,109,97,108,108,111,99,0,0,3,101,110,118,16,95,114,101,113,117,101,115,116,70,105,108,101,83,105,122,101,0,1,3,101,110,118,10,95,114,117,110,83,99,114,105,112,116,0,2,3,185,128,128,128,0,56,3,3,3,3,0,0,0,3,0,4,4,4,3,1,0,0,3,3,1,1,1,1,5,1,4,4,2,6,6,7,8,4,2,2,9,10,11,4,9,2,0,4,0,0,0,3,3,11,11,11,0,0,0,2,11,1,4,132,128,128,128,0,1,112,0,0,5,131,128,128,128,0,1,0,1,6,129,128,128,128,0,0,7,187,134,128,128,0,57,6,109,101,109,111,114,121,2,0,6,109,101,109,115,101,116,0,8,6,109,101,109,99,112,121,0,9,7,109,101,109,109,111,118,101,0,10,6,109,101,109,99,109,112,0,11,7,105,115,80,114,105,109,101,0,12,7,116,111,85,112,112,101,114,0,13,7,116,111,76,111,119,101,114,0,14,12,115,116,114,105,110,103,69,113,117,97,108,115,0,15,12,115,116,114,105,110,103,76,101,110,103,116,104,0,16,15,115,101,97,114,99,104,83,116,114,105,110,103,76,50,82,0,17,15,115,101,97,114,99,104,83,116,114,105,110,103,82,50,76,0,18,10,115,116,97,114,116,87,105,116,104,115,0,19,10,99,111,112,121,83,116,114,105,110,103,0,20,9,109,105,120,83,116,114,105,110,103,0,21,11,103,101,116,70,105,108,101,78,97,109,101,0,22,11,97,108,108,111,99,83,116,114,105,110,103,0,23,12,97,112,112,101,110,100,83,116,114,105,110,103,0,24,9,115,117,98,83,116,114,105,110,103,0,25,13,99,111,110,115,111,108,101,78,117,109,98,101,114,0,26,13,99,111,110,115,111,108,101,66,117,102,102,101,114,0,27,10,99,111,110,115,111,108,101,76,111,103,0,28,9,114,117,110,83,99,114,105,112,116,0,29,10,106,115,109,110,95,112,97,114,115,101,0,30,9,106,115,109,110,95,105,110,105,116,0,31,15,112,97,114,115,101,74,83,79,78,83,116,114,105,110,103,0,32,13,102,105,110,100,74,83,79,78,84,111,107,101,110,0,33,13,102,114,101,101,74,83,79,78,84,111,107,101,110,0,34,3,103,99,100,0,35,9,69,120,116,69,117,99,108,105,100,0,36,10,114,115,97,95,109,111,100,69,120,112,0,37,10,114,115,97,71,101,110,75,101,121,115,0,38,17,114,115,97,71,101,116,69,110,99,114,121,112,116,83,105,122,101,0,39,10,105,110,105,116,71,108,111,98,97,108,0,40,8,105,110,105,116,75,101,121,115,0,41,10,102,114,101,101,71,108,111,98,97,108,0,42,14,115,101,116,82,97,110,100,111,109,83,101,101,100,115,0,43,8,95,95,114,97,110,100,111,109,0,44,10,114,97,110,100,111,109,85,105,110,116,0,45,15,114,101,113,117,101,115,116,70,105,108,101,83,105,122,101,0,46,14,111,110,82,101,99,118,70,105,108,101,83,105,122,101,0,47,21,103,101,116,69,110,99,111,100,105,110,103,83,116,114,105,110,103,83,105,122,101,0,48,21,103,101,116,69,110,99,111,100,105,110,103,83,116,114,105,110,103,68,97,116,97,0,49,12,101,110,99,111,100,101,83,116,114,105,110,103,0,50,21,103,101,116,68,101,99,111,100,105,110,103,83,116,114,105,110,103,83,105,122,101,0,51,12,100,101,99,111,100,101,83,116,114,105,110,103,0,52,20,101,110,99,111,100,101,83,116,114,105,110,103,87,105,116,104,75,101,121,115,0,53,20,100,101,99,111,100,101,83,116,114,105,110,103,87,105,116,104,75,101,121,115,0,54,13,103,101,116,65,116,116,114,105,98,117,116,101,115,0,55,5,103,101,116,73,68,0,56,16,103,101,116,80,108,117,103,105,110,115,78,117,109,98,101,114,0,57,16,103,101,116,80,108,117,103,105,110,86,101,114,115,105,111,110,0,58,13,103,101,116,80,108,117,103,105,110,78,97,109,101,0,59,13,103,101,116,80,108,117,103,105,110,68,101,115,99,0,60,13,115,101,116,65,116,116,114,105,98,117,116,101,115,0,61,14,103,101,116,82,97,110,100,111,109,86,97,108,117,101,0,62,4,101,118,97,108,0,63,10,228,208,128,128,0,56,172,128,128,128,0,1,1,127,2,64,32,2,69,13,0,32,0,33,3,3,64,32,3,32,1,58,0,0,32,3,65,1,106,33,3,32,2,65,127,106,34,2,13,0,11,11,32,0,11,182,128,128,128,0,1,1,127,2,64,32,2,69,13,0,32,0,33,3,3,64,32,3,32,1,45,0,0,58,0,0,32,3,65,1,106,33,3,32,1,65,1,106,33,1,32,2,65,127,106,34,2,13,0,11,11,32,0,11,233,128,128,128,0,1,1,127,2,64,2,64,32,0,32,1,77,13,0,32,2,69,13,1,3,64,32,0,32,2,106,65,127,106,32,1,32,2,106,65,127,106,45,0,0,58,0,0,32,2,65,127,106,34,2,13,0,12,2,11,11,32,2,69,13,0,32,0,33,3,3,64,32,3,32,1,45,0,0,58,0,0,32,3,65,1,106,33,3,32,1,65,1,106,33,1,32,2,65,127,106,34,2,13,0,11,11,32,0,11,202,128,128,128,0,1,1,127,2,64,2,64,32,2,65,1,72,13,0,32,2,65,1,106,33,2,3,64,32,0,45,0,0,32,1,45,0,0,107,34,3,13,2,32,1,65,1,106,33,1,32,0,65,1,106,33,0,32,2,65,127,106,34,2,65,1,74,13,0,11,11,65,0,33,3,11,32,3,11,191,128,128,128,0,1,2,127,2,64,2,64,32,0,65,1,70,13,0,32,0,65,2,109,33,1,32,0,65,4,72,13,0,65,1,33,2,3,64,32,0,32,2,65,1,106,34,2,111,69,13,2,32,2,32,1,72,13,0,11,11,65,0,15,11,65,1,11,147,128,128,128,0,0,32,0,65,96,106,32,0,32,0,65,159,127,106,65,26,73,27,11,147,128,128,128,0,0,32,0,65,32,106,32,0,32,0,65,191,127,106,65,26,73,27,11,167,129,128,128,0,1,1,127,2,64,2,64,2,64,2,64,32,0,69,13,0,32,1,69,13,1,2,64,2,64,32,2,69,13,0,3,64,32,0,44,0,0,34,2,65,32,106,32,2,32,2,65,191,127,106,65,26,73,27,34,3,32,1,44,0,0,34,2,65,32,106,32,2,32,2,65,191,127,106,65,26,73,27,71,13,5,65,1,33,2,32,0,65,1,106,33,0,32,1,65,1,106,33,1,32,3,13,0,12,2,11,11,3,64,32,0,45,0,0,34,3,32,1,45,0,0,71,13,5,65,1,33,2,32,0,65,1,106,33,0,32,1,65,1,106,33,1,32,3,13,0,11,11,32,2,15,11,65,0,15,11,65,0,15,11,65,0,15,11,65,0,11,185,128,128,128,0,1,3,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,0,3,64,32,1,32,0,106,33,2,32,0,65,1,106,34,3,33,0,32,2,45,0,0,13,0,11,32,3,15,11,65,0,11,233,129,128,128,0,1,7,127,65,127,33,8,2,64,2,64,32,1,45,0,0,69,13,0,65,1,33,6,3,64,32,1,32,6,106,33,5,32,6,65,1,106,34,2,33,6,32,5,45,0,0,13,0,11,32,2,65,126,106,33,3,2,64,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,4,65,0,33,6,3,64,32,4,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,11,32,7,32,3,74,13,1,12,2,11,65,0,33,7,65,0,32,3,76,13,1,11,32,0,33,4,32,3,65,0,72,13,1,32,0,33,4,3,64,65,0,33,6,32,2,33,5,2,64,3,64,32,4,32,6,106,45,0,0,32,1,32,6,106,45,0,0,71,13,1,32,6,65,1,106,33,6,32,5,65,127,106,34,5,65,1,74,13,0,12,4,11,11,32,4,65,1,106,33,4,65,127,33,8,32,7,65,127,106,34,7,32,3,74,13,0,11,11,32,8,15,11,32,4,32,0,107,11,242,129,128,128,0,1,5,127,65,0,33,3,65,0,33,6,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,2,65,0,33,5,3,64,32,2,32,5,106,33,4,32,5,65,1,106,34,6,33,5,32,4,45,0,0,13,0,11,11,2,64,32,1,45,0,0,69,13,0,32,1,65,1,106,33,2,65,0,33,5,3,64,32,2,32,5,106,33,4,32,5,65,1,106,34,3,33,5,32,4,45,0,0,13,0,11,11,65,127,33,2,2,64,2,64,32,6,32,3,72,13,0,32,6,32,3,107,34,6,65,0,72,13,0,32,3,65,1,72,13,1,32,0,32,6,106,33,4,65,0,33,0,3,64,32,6,32,0,107,33,2,65,0,33,5,2,64,3,64,32,4,32,5,106,45,0,0,32,1,32,5,106,45,0,0,71,13,1,32,5,65,1,106,34,5,32,3,72,13,0,12,3,11,11,65,127,33,2,32,4,65,127,106,33,4,32,6,32,0,74,33,5,32,0,65,1,106,33,0,32,5,13,0,11,11,32,2,15,11,32,6,11,227,129,128,128,0,1,7,127,2,64,2,64,32,1,45,0,0,69,13,0,65,1,33,6,3,64,32,1,32,6,106,33,5,32,6,65,1,106,34,2,33,6,32,5,45,0,0,13,0,11,32,2,65,126,106,33,3,65,0,33,8,65,0,33,7,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,4,65,0,33,6,3,64,32,4,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,11,11,2,64,32,7,32,3,76,13,0,32,0,33,4,32,3,65,0,72,13,2,32,0,33,4,3,64,65,0,33,6,32,2,33,5,2,64,3,64,32,4,32,6,106,45,0,0,32,1,32,6,106,45,0,0,71,13,1,32,6,65,1,106,33,6,32,5,65,127,106,34,5,65,1,74,13,0,12,5,11,11,32,4,65,1,106,33,4,65,0,33,8,32,7,65,127,106,34,7,32,3,74,13,0,11,11,32,8,15,11,65,0,15,11,32,4,32,0,70,11,255,128,128,128,0,1,4,127,2,64,32,2,69,13,0,32,0,33,6,2,64,32,1,45,0,0,34,4,69,13,0,32,1,65,1,106,33,1,32,0,33,5,2,64,3,64,32,5,34,3,32,4,58,0,0,65,127,33,6,2,64,32,2,65,127,70,13,0,32,2,65,127,106,34,6,69,13,2,11,32,3,65,1,106,33,5,32,1,45,0,0,33,4,32,1,65,1,106,33,1,32,6,33,2,32,4,13,0,11,11,32,3,65,1,106,33,6,11,32,6,65,0,58,0,0,32,0,15,11,65,0,11,163,128,128,128,0,0,2,64,32,0,45,0,0,69,13,0,3,64,32,0,65,3,58,0,0,32,0,65,1,106,34,0,45,0,0,13,0,11,11,11,160,130,128,128,0,1,6,127,65,127,33,2,2,64,32,0,45,0,0,34,1,69,13,0,65,0,33,5,32,0,33,6,3,64,32,5,34,2,65,1,106,33,5,32,6,45,0,1,33,3,32,6,65,1,106,33,6,32,3,13,0,11,65,0,33,6,2,64,2,64,2,64,32,2,65,0,72,13,0,32,0,65,127,106,33,3,3,64,32,3,32,5,106,45,0,0,65,220,0,70,13,2,32,3,65,127,106,33,3,32,2,32,6,74,33,4,32,6,65,1,106,33,6,32,4,13,0,11,11,65,127,33,2,32,1,13,1,12,2,11,32,5,32,6,107,65,127,106,33,2,32,5,32,6,71,13,1,32,1,69,13,1,11,32,0,65,1,106,33,2,65,127,33,6,3,64,32,2,32,6,106,33,5,32,6,65,1,106,34,3,33,6,32,5,65,1,106,45,0,0,13,0,11,2,64,2,64,32,3,65,0,72,13,0,65,127,33,5,32,3,33,6,3,64,32,0,32,6,106,45,0,0,65,47,70,13,2,65,127,33,2,32,6,65,127,106,33,6,32,3,32,5,65,1,106,34,5,74,13,0,12,3,11,11,65,127,33,2,12,1,11,32,6,33,2,11,32,0,32,0,32,2,106,65,1,106,32,2,65,127,70,27,11,195,129,128,128,0,1,6,127,2,64,2,64,32,0,69,13,0,32,0,45,0,0,69,13,1,65,1,33,4,3,64,32,0,32,4,106,33,3,32,4,65,1,106,34,1,33,4,32,3,45,0,0,13,0,11,32,1,16,5,34,6,33,3,2,64,32,0,45,0,0,34,4,69,13,0,32,1,65,127,106,33,1,32,0,65,1,106,33,3,32,6,33,5,2,64,3,64,32,5,34,2,32,4,58,0,0,65,127,33,0,2,64,32,1,65,127,70,13,0,32,1,65,127,106,34,0,69,13,2,11,32,2,65,1,106,33,5,32,3,45,0,0,33,4,32,3,65,1,106,33,3,32,0,33,1,32,4,13,0,11,11,32,2,65,1,106,33,3,11,32,3,65,0,58,0,0,32,6,15,11,65,1,16,5,34,4,65,0,58,0,0,32,4,15,11,65,1,16,5,11,251,128,128,128,0,1,3,127,2,64,32,2,69,13,0,32,0,65,0,58,0,0,11,32,0,33,2,3,64,32,2,34,4,65,1,106,33,2,32,4,45,0,0,13,0,11,2,64,32,1,45,0,0,34,5,69,13,0,32,1,65,1,106,33,1,65,127,33,4,3,64,32,2,32,4,106,32,5,58,0,0,32,1,32,4,106,33,5,32,4,65,1,106,34,3,33,4,32,5,65,1,106,45,0,0,34,5,13,0,11,32,2,32,3,106,33,4,11,32,4,65,0,58,0,0,32,0,11,143,129,128,128,0,1,4,127,32,2,32,1,107,34,5,65,1,106,16,5,33,3,2,64,32,5,69,13,0,32,3,33,2,2,64,32,0,32,1,106,34,0,45,0,0,34,1,69,13,0,32,0,65,1,106,33,2,32,3,33,6,2,64,3,64,32,6,34,4,32,1,58,0,0,65,127,33,0,2,64,32,5,65,127,70,13,0,32,5,65,127,106,34,0,69,13,2,11,32,4,65,1,106,33,6,32,2,45,0,0,33,1,32,2,65,1,106,33,2,32,0,33,5,32,1,13,0,11,11,32,4,65,1,106,33,2,11,32,2,65,0,58,0,0,11,32,3,11,134,128,128,128,0,0,32,0,16,3,11,134,128,128,128,0,0,32,0,16,1,11,193,128,128,128,0,1,4,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,3,3,64,32,1,32,3,106,33,2,32,3,65,1,106,34,4,33,3,32,2,45,0,0,13,0,11,32,0,32,4,16,2,15,11,32,0,65,0,16,2,11,193,128,128,128,0,1,4,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,3,3,64,32,1,32,3,106,33,2,32,3,65,1,106,34,4,33,3,32,2,45,0,0,13,0,11,32,0,32,4,16,7,15,11,32,0,65,0,16,7,11,129,142,128,128,0,1,9,127,32,0,40,2,4,33,11,2,64,2,64,2,64,2,64,2,64,2,64,32,0,40,2,0,34,5,32,2,79,13,0,32,0,65,8,106,33,8,32,11,33,12,2,64,2,64,2,64,3,64,32,1,32,5,106,45,0,0,34,13,69,13,1,2,64,2,64,2,64,2,64,2,64,2,64,2,64,2,64,2,64,2,64,32,13,65,24,116,65,24,117,34,7,65,119,106,34,10,65,212,0,75,13,0,2,64,2,64,2,64,32,10,14,85,12,12,6,6,12,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,12,6,0,6,6,6,6,6,6,6,6,6,2,6,6,6,6,6,6,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,6,4,12,11,32,0,32,5,65,1,106,34,6,54,2,0,2,64,32,6,32,2,79,13,0,32,6,33,13,32,5,33,10,3,64,32,10,33,7,2,64,2,64,2,64,2,64,2,64,32,1,32,13,106,45,0,0,34,10,65,220,0,70,13,0,32,10,69,13,6,32,10,65,34,70,13,1,32,13,33,10,12,4,11,32,13,33,10,32,7,65,2,106,34,13,32,2,79,13,3,32,0,32,13,54,2,0,32,1,32,13,106,44,0,0,65,94,106,34,9,65,211,0,75,13,1,32,13,33,10,2,64,32,9,14,84,4,2,2,2,2,2,2,2,2,2,2,2,2,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,2,2,2,2,2,4,2,2,2,4,2,2,2,2,2,2,2,4,2,2,2,4,2,4,0,4,11,32,0,32,7,65,3,106,34,13,54,2,0,2,64,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,191,127,106,65,6,73,13,0,32,10,65,159,127,106,65,6,79,13,3,11,32,0,32,7,65,4,106,34,13,54,2,0,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,159,127,106,65,6,73,13,0,32,10,65,191,127,106,65,5,75,13,3,11,32,0,32,7,65,5,106,34,13,54,2,0,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,159,127,106,65,6,73,13,0,32,10,65,191,127,106,65,5,75,13,3,11,32,0,32,7,65,6,106,34,13,54,2,0,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,159,127,106,65,6,73,13,0,32,10,65,191,127,106,65,5,75,13,3,11,32,0,32,7,65,7,106,34,13,54,2,0,11,32,0,32,13,65,127,106,34,10,54,2,0,12,3,11,2,64,32,3,69,13,0,32,11,32,4,79,13,2,32,0,65,4,106,32,11,65,1,106,34,7,54,2,0,32,3,32,11,65,20,108,106,34,5,65,3,54,2,0,32,5,32,6,54,2,4,32,5,32,13,54,2,8,32,5,65,0,54,2,12,32,5,32,8,40,2,0,34,10,54,2,16,32,12,65,1,106,33,12,2,64,32,10,65,127,70,13,0,32,3,32,10,65,20,108,106,34,5,32,5,40,2,12,65,1,106,54,2,12,11,32,13,33,5,32,7,33,11,12,17,11,32,12,65,1,106,33,12,32,13,33,5,12,16,11,32,0,32,5,54,2,0,65,126,15,11,32,0,32,5,54,2,0,65,127,15,11,32,0,32,10,65,1,106,34,13,54,2,0,32,13,32,2,73,13,0,11,11,32,0,32,5,54,2,0,12,19,11,32,8,32,11,65,127,106,54,2,0,12,10,11,32,3,69,13,9,32,8,40,2,0,34,13,65,127,70,13,9,32,3,32,13,65,20,108,106,34,13,40,2,0,65,127,106,65,2,73,13,9,32,8,32,13,40,2,16,54,2,0,12,9,11,32,7,65,251,0,70,13,1,32,7,65,253,0,71,13,2,11,32,3,69,13,7,65,126,33,7,32,11,69,13,16,65,1,65,2,32,13,65,253,0,70,27,33,9,32,11,65,127,106,33,10,3,64,2,64,32,3,32,10,65,20,108,106,34,13,40,2,4,65,127,70,13,0,32,13,40,2,8,65,127,70,13,4,11,32,13,40,2,16,34,10,65,127,71,13,0,11,32,13,40,2,0,32,9,71,13,16,32,8,40,2,0,65,127,71,13,7,12,16,11,32,12,65,1,106,33,12,32,3,69,13,6,65,127,33,7,32,11,32,4,79,13,15,32,0,65,4,106,32,11,65,1,106,34,9,54,2,0,32,3,32,11,65,20,108,106,34,10,66,127,55,2,4,32,10,66,128,128,128,128,112,55,2,12,32,10,69,13,15,32,10,65,4,106,33,6,2,64,32,8,40,2,0,34,7,65,127,70,13,0,32,10,65,16,106,32,7,54,2,0,32,3,32,7,65,20,108,106,34,7,32,7,40,2,12,65,1,106,54,2,12,11,32,6,32,5,54,2,0,32,8,32,11,54,2,0,32,10,65,1,65,2,32,13,65,251,0,70,27,54,2,0,32,9,33,11,12,6,11,32,5,33,10,2,64,32,13,69,13,0,32,5,65,1,106,33,7,3,64,32,7,33,10,2,64,2,64,32,13,65,24,116,65,24,117,34,7,65,119,106,34,9,65,49,75,13,0,32,9,14,50,5,5,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,11,32,7,65,221,0,70,13,4,32,7,65,253,0,70,13,4,11,65,126,33,9,32,7,65,32,72,13,11,32,13,65,255,1,113,65,255,0,70,13,11,32,0,32,10,54,2,0,32,10,32,2,79,13,1,32,10,65,1,106,33,7,32,1,32,10,106,45,0,0,34,13,13,0,11,11,32,3,69,13,3,12,2,11,32,13,40,2,0,32,9,71,13,13,32,13,65,8,106,32,5,65,1,106,54,2,0,32,8,32,13,40,2,16,54,2,0,12,4,11,32,10,65,127,106,33,10,32,3,69,13,1,11,32,11,32,4,79,13,5,32,0,65,4,106,32,11,65,1,106,34,9,54,2,0,32,3,32,11,65,20,108,106,34,13,65,4,54,2,0,32,13,32,5,54,2,4,32,13,32,10,54,2,8,32,13,65,0,54,2,12,32,13,32,8,40,2,0,34,7,54,2,16,32,9,33,11,12,1,11,32,8,40,2,0,33,7,11,32,0,32,10,65,127,106,34,5,54,2,0,32,12,65,1,106,33,12,32,3,69,13,0,32,7,65,127,70,13,0,32,3,32,7,65,20,108,106,34,13,32,13,40,2,12,65,1,106,54,2,12,11,32,0,32,5,65,1,106,34,5,54,2,0,32,5,32,2,73,13,0,11,11,32,3,69,13,3,12,4,11,65,127,33,9,11,32,0,32,5,54,2,0,32,9,15,11,32,11,33,12,32,3,13,1,11,32,12,15,11,32,11,65,127,106,34,5,65,0,72,13,2,32,3,32,11,65,20,108,106,65,112,106,33,13,3,64,2,64,32,13,40,2,0,65,127,70,13,0,32,13,65,4,106,40,2,0,65,127,70,13,2,11,32,13,65,108,106,33,13,32,5,65,127,106,34,5,65,127,74,13,0,11,32,12,15,11,65,125,33,7,11,32,7,15,11,32,12,11,144,128,128,128,0,0,32,0,65,127,54,2,8,32,0,66,0,55,2,0,11,232,131,128,128,0,1,14,127,65,12,16,5,34,12,65,127,54,2,8,32,12,66,0,55,2,0,65,0,33,11,65,128,160,1,16,5,65,0,65,128,160,1,16,8,33,2,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,13,65,0,33,14,3,64,32,13,32,14,106,33,9,32,14,65,1,106,34,11,33,14,32,9,45,0,0,13,0,11,11,2,64,2,64,32,12,32,0,32,11,32,2,65,128,8,16,30,34,4,65,127,76,13,0,2,64,32,1,69,13,0,32,1,32,4,54,2,0,11,32,4,65,20,108,34,14,16,5,34,15,65,0,32,14,16,8,33,3,32,4,65,1,72,13,1,32,0,65,1,106,33,5,65,0,33,10,3,64,32,3,32,10,65,20,108,34,14,106,33,7,2,64,32,2,32,14,106,34,6,40,2,0,65,125,106,65,1,75,13,0,32,6,40,2,8,32,6,40,2,4,34,9,107,34,11,65,1,106,16,5,33,8,2,64,32,11,69,13,0,32,8,33,13,2,64,32,0,32,9,106,45,0,0,34,14,69,13,0,32,5,32,9,106,33,9,32,8,33,12,2,64,3,64,32,12,34,1,32,14,58,0,0,65,127,33,13,2,64,32,11,65,127,70,13,0,32,11,65,127,106,34,13,69,13,2,11,32,1,65,1,106,33,12,32,9,45,0,0,33,14,32,9,65,1,106,33,9,32,13,33,11,32,14,13,0,11,11,32,1,65,1,106,33,13,11,32,13,65,0,58,0,0,11,32,7,32,8,54,2,0,11,32,7,32,6,54,2,4,2,64,32,6,40,2,16,34,14,65,127,70,13,0,32,7,32,3,32,14,65,20,108,106,34,9,54,2,8,2,64,2,64,32,9,40,2,12,34,14,69,13,0,3,64,32,14,34,9,40,2,16,34,14,13,0,11,32,9,65,16,106,33,14,12,1,11,32,9,65,12,106,33,14,11,32,14,32,7,54,2,0,11,32,10,65,1,106,34,10,32,4,71,13,0,12,2,11,11,2,64,32,12,69,13,0,32,12,16,4,11,65,0,33,15,32,2,69,13,0,32,2,16,4,65,0,15,11,32,15,11,252,129,128,128,0,1,6,127,65,0,33,6,2,64,32,1,69,13,0,32,0,69,13,0,32,1,65,1,106,33,2,2,64,3,64,2,64,32,0,40,2,0,34,3,69,13,0,2,64,2,64,32,3,45,0,0,69,13,0,32,3,65,1,106,33,4,65,0,33,6,3,64,32,4,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,12,2,11,11,65,0,33,7,11,32,3,32,7,16,2,11,2,64,2,64,32,1,45,0,0,69,13,0,65,0,33,6,3,64,32,2,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,12,2,11,11,65,0,33,7,11,32,1,32,7,16,2,2,64,32,0,40,2,0,34,6,69,13,0,32,1,33,5,3,64,32,6,45,0,0,34,7,32,5,45,0,0,71,13,1,32,6,65,1,106,33,6,32,5,65,1,106,33,5,32,7,13,0,12,3,11,11,32,0,40,2,16,32,1,16,33,34,6,13,2,32,0,40,2,12,34,0,13,0,11,65,0,15,11,32,0,33,6,11,32,6,11,206,128,128,128,0,1,2,127,2,64,2,64,2,64,32,1,65,1,72,13,0,32,0,33,3,3,64,2,64,32,3,40,2,0,34,2,69,13,0,32,2,16,4,32,3,65,0,54,2,0,11,32,3,65,20,106,33,3,32,1,65,127,106,34,1,13,0,12,2,11,11,32,0,69,13,1,11,32,0,16,4,11,11,168,128,128,128,0,1,1,126,2,64,32,0,80,13,0,3,64,32,1,32,0,34,2,129,33,0,32,2,33,1,32,0,66,0,82,13,0,11,32,2,15,11,32,1,11,195,128,128,128,0,1,4,126,2,64,32,0,80,13,0,66,1,33,3,66,0,33,4,3,64,32,3,32,1,32,0,34,2,127,32,4,34,5,126,125,33,4,32,1,32,2,129,33,0,32,5,33,3,32,2,33,1,32,0,66,0,82,13,0,11,32,5,15,11,66,1,11,135,129,128,128,0,1,2,126,2,64,2,64,32,1,32,0,132,66,0,83,13,0,32,2,66,0,85,13,1,11,65,1,16,0,11,32,0,32,2,129,33,0,2,64,2,64,2,64,2,64,32,1,80,13,0,32,1,66,1,82,13,1,32,0,15,11,66,1,33,4,12,1,11,32,1,66,2,129,34,3,66,1,81,13,1,66,0,33,4,32,3,66,0,82,13,0,32,0,32,0,126,32,2,129,32,1,66,2,127,32,2,16,37,32,2,129,15,11,32,4,15,11,32,0,32,1,66,127,124,32,2,16,37,32,0,126,32,2,129,11,149,129,128,128,0,1,7,126,2,64,2,64,32,1,66,127,124,32,0,66,127,124,126,34,4,80,13,0,66,129,2,33,10,66,1,33,7,32,4,33,6,66,0,33,8,3,64,32,7,32,10,32,6,34,5,127,32,8,34,9,126,125,33,8,32,10,32,5,129,33,6,32,9,33,7,32,5,33,10,32,6,66,0,82,13,0,12,2,11,11,66,1,33,9,11,32,1,32,0,126,33,6,32,9,32,4,125,33,10,3,64,32,10,32,4,124,34,10,66,0,83,13,0,11,32,2,66,129,2,55,3,8,32,2,32,6,55,3,0,32,3,32,6,55,3,0,32,3,32,10,55,3,8,11,188,128,128,128,0,1,1,127,2,64,32,1,65,1,72,13,0,65,0,33,2,3,64,65,2,65,1,32,0,44,0,0,65,0,72,27,32,2,106,33,2,32,0,65,1,106,33,0,32,1,65,127,106,34,1,13,0,11,32,2,15,11,65,0,11,131,131,128,128,0,4,2,126,3,127,4,126,3,127,65,0,65,200,0,16,5,34,11,54,2,20,32,11,65,0,65,200,0,16,8,26,65,0,66,211,129,128,128,208,247,229,0,55,2,12,66,129,2,33,9,66,1,33,8,66,184,240,185,10,33,7,66,0,33,10,3,64,32,8,32,9,32,7,34,2,127,32,10,34,3,126,125,33,10,32,9,32,2,129,33,7,32,3,33,8,32,2,33,9,32,7,66,0,82,13,0,11,32,11,66,129,2,55,3,40,32,11,66,199,161,192,10,55,3,48,32,11,65,32,106,66,199,161,192,10,55,3,0,32,11,32,3,66,0,32,3,66,0,85,27,66,183,240,185,10,124,34,9,32,9,32,3,125,66,184,240,185,10,130,125,55,3,56,2,64,2,64,2,64,32,0,69,13,0,32,0,45,0,0,69,13,1,65,1,33,11,3,64,32,0,32,11,106,33,6,32,11,65,1,106,34,4,33,11,32,6,45,0,0,13,0,11,32,4,16,5,34,13,33,6,2,64,32,0,45,0,0,34,11,69,13,0,32,4,65,127,106,33,4,32,0,65,1,106,33,6,32,13,33,12,2,64,3,64,32,12,34,5,32,11,58,0,0,65,127,33,0,2,64,32,4,65,127,70,13,0,32,4,65,127,106,34,0,69,13,2,11,32,5,65,1,106,33,12,32,6,45,0,0,33,11,32,6,65,1,106,33,6,32,0,33,4,32,11,13,0,11,11,32,5,65,1,106,33,6,11,32,6,65,0,58,0,0,12,2,11,65,1,16,5,34,13,65,0,58,0,0,12,1,11,65,1,16,5,33,13,11,65,0,40,2,20,34,11,32,13,54,2,64,32,11,32,1,54,2,68,11,227,129,128,128,0,3,4,126,1,127,5,126,2,64,65,0,40,2,20,34,6,13,0,65,0,65,200,0,16,5,34,6,54,2,20,32,6,65,0,65,200,0,16,8,26,11,65,0,32,1,54,2,16,65,0,32,0,54,2,12,2,64,2,64,32,1,172,34,5,66,127,124,32,0,172,34,4,66,127,124,126,34,2,80,13,0,66,129,2,33,11,66,1,33,8,32,2,33,7,66,0,33,9,3,64,32,8,32,11,32,7,34,3,127,32,9,34,10,126,125,33,9,32,11,32,3,129,33,7,32,10,33,8,32,3,33,11,32,7,66,0,82,13,0,12,2,11,11,66,1,33,10,11,32,5,32,4,126,33,7,32,10,32,2,125,33,11,3,64,32,11,32,2,124,34,11,66,0,83,13,0,11,32,6,32,7,55,3,32,32,6,32,7,55,3,48,32,6,65,32,54,2,64,32,6,65,0,54,2,68,32,6,65,40,106,66,129,2,55,3,0,32,6,65,56,106,32,11,55,3,0,11,156,128,128,128,0,1,1,127,2,64,65,0,40,2,20,34,0,69,13,0,32,0,16,4,65,0,65,0,54,2,20,11,11,165,128,128,128,0,1,1,127,65,0,40,2,20,34,4,32,0,54,2,0,32,4,32,1,54,2,4,32,4,32,2,54,2,8,32,4,32,3,54,2,12,11,154,129,128,128,0,1,5,127,65,0,40,2,20,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,2,32,1,115,32,3,115,32,4,115,11,166,129,128,128,0,1,5,127,65,0,40,2,20,34,2,32,2,40,2,0,34,6,65,6,116,32,6,115,65,13,118,32,6,65,18,116,65,128,128,96,113,114,34,3,54,2,0,32,2,32,2,40,2,4,34,6,65,2,116,34,5,32,6,115,65,27,118,32,5,65,96,113,114,34,4,54,2,4,32,2,40,2,12,33,6,32,2,32,2,40,2,8,34,5,65,13,116,32,5,115,65,21,118,32,5,65,7,116,65,128,112,113,114,34,5,54,2,8,32,2,32,6,32,6,65,3,116,115,65,12,118,32,6,65,13,116,65,128,128,64,113,114,34,6,54,2,12,32,4,32,3,115,32,5,115,32,6,115,65,1,32,0,107,32,1,106,112,32,0,106,11,140,128,128,128,0,0,65,0,40,2,20,40,2,64,16,6,11,182,129,128,128,0,1,5,127,2,64,65,0,40,2,20,34,3,40,2,64,34,5,45,0,0,34,6,69,13,0,32,5,69,13,0,32,0,65,32,32,0,27,34,2,45,0,0,34,0,65,255,1,113,34,4,69,13,0,32,6,32,4,71,13,0,32,5,65,1,106,33,5,32,2,65,1,106,33,6,2,64,3,64,32,0,65,255,1,113,69,13,1,32,6,45,0,0,33,0,32,5,45,0,0,33,4,32,5,65,1,106,33,5,32,6,65,1,106,33,6,32,4,32,0,70,13,0,12,2,11,11,32,3,40,2,68,34,0,32,1,70,13,0,32,1,69,13,0,32,0,69,13,0,32,3,32,3,40,2,16,65,144,128,1,114,54,2,16,11,32,3,32,3,40,2,16,65,128,128,128,128,120,114,54,2,16,11,158,129,128,128,0,1,6,127,65,8,33,6,2,64,32,0,44,0,0,34,1,69,13,0,32,0,65,1,106,33,2,65,126,33,5,3,64,32,2,32,5,106,33,4,32,5,65,1,106,34,3,33,5,32,4,65,2,106,45,0,0,13,0,11,32,3,65,1,106,65,0,72,13,0,65,2,65,1,32,1,65,0,72,27,33,4,2,64,32,3,65,127,70,13,0,32,0,65,1,106,33,0,65,0,33,5,3,64,65,2,65,1,32,0,32,5,106,44,0,0,65,0,72,27,32,4,106,33,4,32,5,32,3,71,33,2,32,5,65,1,106,33,5,32,2,13,0,11,11,32,4,65,3,116,65,8,106,33,6,11,32,6,11,163,128,128,128,0,0,2,64,2,64,32,0,69,13,0,32,0,32,1,106,45,0,0,33,0,12,1,11,65,0,33,0,11,32,0,65,255,1,113,11,220,131,128,128,0,2,10,127,1,126,65,0,33,9,65,0,33,3,2,64,32,0,44,0,0,34,1,69,13,0,32,0,65,1,106,33,7,65,0,33,10,3,64,32,7,32,10,106,33,3,32,10,65,1,106,34,9,33,10,32,3,45,0,0,13,0,11,65,0,33,3,32,9,65,127,106,65,0,72,13,0,65,2,65,1,32,1,65,0,72,27,33,3,32,9,65,1,70,13,0,32,0,65,1,106,33,1,65,0,33,10,3,64,65,2,65,1,32,1,32,10,106,44,0,0,65,0,72,27,32,3,106,33,3,32,10,65,2,106,33,7,32,10,65,1,106,33,10,32,7,32,9,71,13,0,11,11,32,3,65,3,116,65,8,106,16,5,34,1,32,3,172,65,0,40,2,20,34,10,65,40,106,34,2,41,3,0,32,10,41,3,32,16,37,55,3,0,2,64,32,9,65,1,72,13,0,32,10,65,32,106,33,8,65,1,33,10,3,64,2,64,32,0,48,0,0,34,11,66,127,85,13,0,65,0,40,2,20,34,3,32,3,40,2,0,34,7,65,6,116,32,7,115,65,13,118,32,7,65,18,116,65,128,128,96,113,114,34,4,54,2,0,32,3,32,3,40,2,4,34,7,65,2,116,34,6,32,7,115,65,27,118,32,6,65,96,113,114,34,5,54,2,4,32,3,40,2,12,33,7,32,3,32,3,40,2,8,34,6,65,13,116,32,6,115,65,21,118,32,6,65,7,116,65,128,112,113,114,34,6,54,2,8,32,3,32,7,32,7,65,3,116,115,65,12,118,32,7,65,13,116,65,128,128,64,113,114,34,7,54,2,12,32,1,32,10,65,3,116,106,32,5,32,4,115,32,6,115,32,7,115,65,7,112,65,1,106,173,32,2,41,3,0,32,8,41,3,0,16,37,55,3,0,66,0,32,11,125,33,11,32,10,65,1,106,33,10,11,32,1,32,10,65,3,116,106,32,11,32,2,41,3,0,32,8,41,3,0,16,37,55,3,0,32,0,65,1,106,33,0,32,10,65,1,106,33,10,32,9,65,127,106,34,9,13,0,11,11,32,1,11,156,128,128,128,0,0,32,0,41,3,0,65,0,40,2,20,34,0,65,56,106,41,3,0,32,0,41,3,48,16,37,167,11,228,129,128,128,0,3,7,127,1,126,1,127,65,0,33,9,2,64,32,0,41,3,0,65,0,40,2,20,34,6,65,56,106,41,3,0,32,6,41,3,48,16,37,167,34,2,69,13,0,32,2,65,1,106,34,6,16,5,34,9,65,0,32,6,16,8,33,1,65,0,33,6,2,64,32,2,65,1,72,13,0,65,0,33,5,65,0,40,2,20,34,6,65,48,106,33,3,32,6,65,56,106,33,4,65,0,33,6,3,64,2,64,2,64,32,0,32,5,65,1,106,34,7,65,3,116,106,41,3,0,32,4,41,3,0,32,3,41,3,0,16,37,34,8,66,7,85,13,0,66,0,32,0,32,5,65,3,116,106,65,16,106,41,3,0,32,4,41,3,0,32,3,41,3,0,16,37,125,33,8,12,1,11,32,5,33,7,11,32,1,32,6,106,32,8,60,0,0,32,6,65,1,106,33,6,32,7,65,1,106,34,5,32,2,72,13,0,11,11,32,1,32,6,106,65,0,58,0,0,11,32,9,11,214,131,128,128,0,4,2,127,4,126,1,127,5,126,65,0,40,2,16,33,4,65,0,40,2,12,33,3,2,64,65,0,40,2,20,34,9,13,0,65,0,65,200,0,16,5,34,9,54,2,20,32,9,65,0,65,200,0,16,8,26,11,65,0,32,2,54,2,16,65,0,32,1,54,2,12,2,64,2,64,32,2,172,34,8,66,127,124,32,1,172,34,7,66,127,124,126,34,5,80,13,0,66,129,2,33,14,66,1,33,11,32,5,33,10,66,0,33,12,3,64,32,11,32,14,32,10,34,6,127,32,12,34,13,126,125,33,12,32,14,32,6,129,33,10,32,13,33,11,32,6,33,14,32,10,66,0,82,13,0,12,2,11,11,66,1,33,13,11,32,8,32,7,126,33,10,32,13,32,5,125,33,14,3,64,32,14,32,5,124,34,14,66,0,83,13,0,11,32,9,32,10,55,3,32,32,9,32,10,55,3,48,32,9,65,32,54,2,64,32,9,65,0,54,2,68,32,9,65,40,106,66,129,2,55,3,0,32,9,65,56,106,32,14,55,3,0,32,0,16,50,33,1,2,64,65,0,40,2,20,34,9,13,0,65,0,65,200,0,16,5,34,9,54,2,20,32,9,65,0,65,200,0,16,8,26,11,65,0,32,4,54,2,16,65,0,32,3,54,2,12,2,64,2,64,32,4,172,34,8,66,127,124,32,3,172,34,7,66,127,124,126,34,5,80,13,0,66,129,2,33,14,66,1,33,11,32,5,33,10,66,0,33,12,3,64,32,11,32,14,32,10,34,6,127,32,12,34,13,126,125,33,12,32,14,32,6,129,33,10,32,13,33,11,32,6,33,14,32,10,66,0,82,13,0,12,2,11,11,66,1,33,13,11,32,8,32,7,126,33,10,32,13,32,5,125,33,14,3,64,32,14,32,5,124,34,14,66,0,83,13,0,11,32,9,32,10,55,3,32,32,9,32,10,55,3,48,32,9,65,32,54,2,64,32,9,65,0,54,2,68,32,9,65,40,106,66,129,2,55,3,0,32,9,65,56,106,32,14,55,3,0,32,1,11,214,131,128,128,0,4,2,127,4,126,1,127,5,126,65,0,40,2,16,33,4,65,0,40,2,12,33,3,2,64,65,0,40,2,20,34,9,13,0,65,0,65,200,0,16,5,34,9,54,2,20,32,9,65,0,65,200,0,16,8,26,11,65,0,32,2,54,2,16,65,0,32,1,54,2,12,2,64,2,64,32,2,172,34,8,66,127,124,32,1,172,34,7,66,127,124,126,34,5,80,13,0,66,129,2,33,14,66,1,33,11,32,5,33,10,66,0,33,12,3,64,32,11,32,14,32,10,34,6,127,32,12,34,13,126,125,33,12,32,14,32,6,129,33,10,32,13,33,11,32,6,33,14,32,10,66,0,82,13,0,12,2,11,11,66,1,33,13,11,32,8,32,7,126,33,10,32,13,32,5,125,33,14,3,64,32,14,32,5,124,34,14,66,0,83,13,0,11,32,9,32,10,55,3,32,32,9,32,10,55,3,48,32,9,65,32,54,2,64,32,9,65,0,54,2,68,32,9,65,40,106,66,129,2,55,3,0,32,9,65,56,106,32,14,55,3,0,32,0,16,52,33,1,2,64,65,0,40,2,20,34,9,13,0,65,0,65,200,0,16,5,34,9,54,2,20,32,9,65,0,65,200,0,16,8,26,11,65,0,32,4,54,2,16,65,0,32,3,54,2,12,2,64,2,64,32,4,172,34,8,66,127,124,32,3,172,34,7,66,127,124,126,34,5,80,13,0,66,129,2,33,14,66,1,33,11,32,5,33,10,66,0,33,12,3,64,32,11,32,14,32,10,34,6,127,32,12,34,13,126,125,33,12,32,14,32,6,129,33,10,32,13,33,11,32,6,33,14,32,10,66,0,82,13,0,12,2,11,11,66,1,33,13,11,32,8,32,7,126,33,10,32,13,32,5,125,33,14,3,64,32,14,32,5,124,34,14,66,0,83,13,0,11,32,9,32,10,55,3,32,32,9,32,10,55,3,48,32,9,65,32,54,2,64,32,9,65,0,54,2,68,32,9,65,40,106,66,129,2,55,3,0,32,9,65,56,106,32,14,55,3,0,32,1,11,138,128,128,128,0,0,65,0,40,2,20,40,2,16,11,138,128,128,128,0,0,65,0,40,2,20,40,2,20,11,138,128,128,128,0,0,65,0,40,2,20,40,2,24,11,147,128,128,128,0,0,65,0,40,2,20,40,2,28,32,0,65,12,108,106,40,2,4,11,147,128,128,128,0,0,65,0,40,2,20,40,2,28,32,0,65,12,108,106,40,2,0,11,147,128,128,128,0,0,65,0,40,2,20,40,2,28,32,0,65,12,108,106,40,2,8,11,236,137,128,128,0,1,11,127,32,0,65,8,109,33,4,2,64,2,64,2,64,32,1,41,3,0,65,0,40,2,20,34,0,65,56,106,41,3,0,32,0,41,3,48,16,37,167,34,0,65,1,72,13,0,32,4,32,0,72,13,0,32,1,16,52,34,0,69,13,0,32,0,65,4,16,5,34,2,16,32,34,3,69,13,0,2,64,32,0,45,0,0,69,13,0,32,0,33,1,3,64,32,1,65,3,58,0,0,32,1,65,1,106,34,1,45,0,0,13,0,11,11,32,0,16,4,2,64,32,3,40,2,12,34,1,40,2,12,34,0,69,13,0,2,64,2,64,2,64,32,0,40,2,0,34,4,69,13,0,32,4,45,0,0,69,13,1,65,1,33,1,3,64,32,4,32,1,106,33,0,32,1,65,1,106,34,5,33,1,32,0,45,0,0,13,0,11,32,5,16,5,34,10,33,0,2,64,32,4,45,0,0,34,1,69,13,0,32,5,65,127,106,33,5,32,4,65,1,106,33,0,32,10,33,7,2,64,3,64,32,7,34,6,32,1,58,0,0,65,127,33,4,2,64,32,5,65,127,70,13,0,32,5,65,127,106,34,4,69,13,2,11,32,6,65,1,106,33,7,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,4,33,5,32,1,13,0,11,11,32,6,65,1,106,33,0,11,32,0,65,0,58,0,0,12,2,11,65,1,16,5,34,10,65,0,58,0,0,12,1,11,65,1,16,5,33,10,11,65,0,40,2,20,32,10,54,2,20,32,3,65,12,106,40,2,0,33,1,11,2,64,32,1,40,2,16,40,2,16,40,2,12,34,4,69,13,0,65,0,40,2,20,34,5,40,2,24,33,1,2,64,32,4,40,2,12,34,0,69,13,0,32,5,65,24,106,32,1,65,1,106,34,1,54,2,0,32,0,40,2,16,34,0,69,13,0,3,64,32,1,65,1,106,33,1,32,0,40,2,16,34,0,13,0,11,32,5,65,24,106,32,1,54,2,0,11,32,1,65,12,108,16,5,33,8,65,0,40,2,20,32,8,54,2,28,32,4,65,12,106,40,2,0,34,10,69,13,0,65,0,33,11,3,64,2,64,2,64,2,64,32,10,40,2,12,40,2,12,40,2,0,34,4,69,13,0,32,4,45,0,0,69,13,1,65,1,33,1,3,64,32,4,32,1,106,33,0,32,1,65,1,106,34,5,33,1,32,0,45,0,0,13,0,11,32,5,16,5,34,12,33,0,2,64,32,4,45,0,0,34,1,69,13,0,32,5,65,127,106,33,5,32,4,65,1,106,33,0,32,12,33,7,2,64,3,64,32,7,34,6,32,1,58,0,0,65,127,33,4,2,64,32,5,65,127,70,13,0,32,5,65,127,106,34,4,69,13,2,11,32,6,65,1,106,33,7,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,4,33,5,32,1,13,0,11,11,32,6,65,1,106,33,0,11,32,0,65,0,58,0,0,12,2,11,65,1,16,5,34,12,65,0,58,0,0,12,1,11,65,1,16,5,33,12,11,32,8,32,11,65,12,108,106,34,8,32,12,54,2,4,2,64,2,64,2,64,32,10,65,12,106,34,9,40,2,0,40,2,16,40,2,12,40,2,0,34,4,69,13,0,32,4,45,0,0,69,13,1,65,1,33,1,3,64,32,4,32,1,106,33,0,32,1,65,1,106,34,5,33,1,32,0,45,0,0,13,0,11,32,5,16,5,34,12,33,0,2,64,32,4,45,0,0,34,1,69,13,0,32,5,65,127,106,33,5,32,4,65,1,106,33,0,32,12,33,7,2,64,3,64,32,7,34,6,32,1,58,0,0,65,127,33,4,2,64,32,5,65,127,70,13,0,32,5,65,127,106,34,4,69,13,2,11,32,6,65,1,106,33,7,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,4,33,5,32,1,13,0,11,11,32,6,65,1,106,33,0,11,32,0,65,0,58,0,0,12,2,11,65,1,16,5,34,12,65,0,58,0,0,12,1,11,65,1,16,5,33,12,11,32,8,32,12,54,2,0,2,64,2,64,32,9,40,2,0,40,2,16,40,2,16,40,2,12,40,2,0,34,4,13,0,65,1,16,5,34,12,65,0,58,0,0,12,1,11,2,64,32,4,45,0,0,13,0,65,1,16,5,33,12,12,1,11,65,1,33,1,3,64,32,4,32,1,106,33,0,32,1,65,1,106,34,5,33,1,32,0,45,0,0,13,0,11,32,5,16,5,34,12,33,0,2,64,32,4,45,0,0,34,1,69,13,0,32,5,65,127,106,33,5,32,4,65,1,106,33,0,32,12,33,6,2,64,3,64,32,6,34,7,32,1,58,0,0,65,127,33,4,2,64,32,5,65,127,70,13,0,32,5,65,127,106,34,4,69,13,2,11,32,7,65,1,106,33,6,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,4,33,5,32,1,13,0,11,11,32,7,65,1,106,33,0,11,32,0,65,0,58,0,0,11,32,8,32,12,54,2,8,32,10,40,2,16,34,10,69,13,1,32,11,65,1,106,33,11,65,0,40,2,20,40,2,28,33,8,12,0,11,11,32,2,40,2,0,34,0,65,1,72,13,1,32,3,33,1,3,64,2,64,32,1,40,2,0,34,4,69,13,0,32,4,16,4,32,1,65,0,54,2,0,11,32,1,65,20,106,33,1,32,0,65,127,106,34,0,13,0,11,32,3,16,4,32,2,13,2,11,15,11,32,3,16,4,11,32,2,16,4,11,154,129,128,128,0,1,5,127,65,0,40,2,20,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,2,32,1,115,32,3,115,32,4,115,11,193,128,128,128,0,1,4,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,3,3,64,32,1,32,3,106,33,2,32,3,65,1,106,34,4,33,3,32,2,45,0,0,13,0,11,32,0,32,4,16,7,15,11,32,0,65,0,16,7,11,11,138,128,128,128,0,1,0,65,20,11,4,0,0,0,0]),f=function(){function e(t){n(this,e),this._memory=t,this._heap=new Uint8Array(this._memory.buffer),this._blocks=[]}return e.prototype._grow=function(){this._memory.grow(2),this._heap=new Uint8Array(this._memory.buffer)},e.prototype._tryAllocate=function(e){for(var t=32,i=0;i<this._blocks.length;i++){var r=this._blocks[i];if(t+e<r.offset)return t;t=r.offset+r.alignedSize}return t+e>=this._memory.buffer.byteLength?-1:t},e.prototype._sortBlocks=function(){this._blocks.sort((function(e,t){return e.offset-t.offset}))},e.prototype._getAlignedSize=function(e,t){return e%t?(e&~(t-1))+t:e},e.prototype._m=function(e){for(var t=this._getAlignedSize(e,8);;){var i=this._tryAllocate(t);if(-1!==i)return this._blocks.push({offset:i,size:e,alignedSize:t}),this._sortBlocks(),i;this._grow()}},e.prototype._f=function(e){for(var t=0;t<this._blocks.length;t++){if(this._blocks[t].offset==e){this._blocks.splice(t,1),this._sortBlocks();break}}},e.prototype._getBlockSize=function(e){for(var t=0;t<this._blocks.length;t++){var i=this._blocks[t];if(i.offset==e)return i.size}return 0},e}(),m=void 0,g=function(){function e(t){n(this,e),this._instance=null,this._exports=null,this._memory=null,this._registers={},this._bufferAllocator=null,this._init(t)}return e.prototype._init=function(e){if(void 0!==m?m:m=function(){var e=!1;try{var t=new Uint8Array([0,97,115,109,1,0,0,0,1,7,1,96,2,127,127,1,127,3,2,1,0,7,7,1,3,88,79,82,0,0,10,9,1,7,0,32,0,32,1,115,11]),i=new WebAssembly.Instance(new WebAssembly.Module(t)).exports.XOR;if(57005!==i(65280,8621)||48879!==i(43605,5306))throw!1;e=!0}catch(t){e=!1}return e}()){var t=e[h.toStr([93,239,191,250,117,57,54,224])];t&&this._loadFromByteCode(t,e)}else{var i=e.error;i&&i()}},e.prototype._setupComplete=function(e){this._exports=this._instance.exports,this._memory=this._exports.memory,this._bufferAllocator=new f(this._memory),this._initRegisters(e);var t=e.complete;t&&t(this)},e.prototype._getStringByOffset=function(e){var t=this._bufferAllocator._getBlockSize(e),i=new Uint8Array(this._memory.buffer,e,t-1);return(new TextDecoderLite).decode(i)},e.prototype._initImports=function(e){var t=this,i=h;(e=e||{}).env=e.env||{};var r=e.env;r[i.toStr([96,201,174,231,95,34])]=function(e){},r[i.toStr([96,251,170,243,90,57,49])]=function(e){return t._bufferAllocator._m(e)},r[i.toStr([96,240,185,250,83])]=function(e){t._bufferAllocator._f(e)},r[i.toStr([96,245,164,241,69,57,62,224,115,26,73,38,249,156])]=function(e){THING.Utils.log(e)},r[i.toStr([96,245,164,241,69,57,62,224,127,26,66,34,249,156])]=function(e){THING.Utils.log(e)},r[i.toStr([96,245,164,241,69,57,62,224,113,0,67])]=function(e,i){var r=new Uint8Array(t._memory.buffer,e,i);THING.Utils.log((new TextDecoderLite).decode(r))},r[i.toStr([96,228,190,241,101,53,32,236,77,27])]=function(e,i){var r=new Uint8Array(t._memory.buffer,e,i),n=(new TextDecoderLite).decode(r);rt(n)},r[i.toStr([96,228,174,238,67,51,33,241,123,6,72,33,207,135,158,113])]=function(e){var i=t._getStringByOffset(e);dt(i,(function(e){t.onRecvFileSize(i,e)}))};var n=r.callback;return n&&n(r),e},e.prototype._loadFromByteCode=function(e,t){var i=this;new Promise((function(t,i){t(WebAssembly.compile(e))})).then((function(e){new Promise((function(r,n){var o=t.imports;o=i._initImports(o),r(WebAssembly.instantiate(e,o))})).then((function(e){i._instance=e,i._setupComplete(t)}))}))},e.prototype._initFunction=function(e,t){var i=this;this[e]=function(){var e=[];i._pushArguments(t,0,arguments,e);var r=i._call(t.funcName,e);return i._getRetValue(t,r)}},e.prototype._initFunctions=function(){for(var e in this._registers){var t=this._registers[e];void 0===this[e]&&this._initFunction(e,t)}},e.prototype._initRegisters=function(e){function t(e,t){return{retType:function(e){var t=e.indexOf("(");return-1===t?null:e.substring(0,t)}(t=(t=t.replaceAll(" ","")).replaceAll("\t","")),params:function(e){var t=e.indexOf("(");if(-1===t)return null;var i=e.indexOf(")");if(-1===i)return null;var r=e.substring(t+1,i);r=""==r?[]:r.split(",");for(var n=[],o=0;o<r.length;o++){var s=r[o];if(-1!==s.indexOf(":")){var a=s.split(":"),l=a[1];"true"==l?l=!0:"false"==l&&(l=!1),n.push({type:a[0],defaultValue:l})}else n.push({type:s})}return n}(t),funcName:e}}var i=e.register;if(i){for(var r in i){var n=t(r,i[r]);n&&(this._registers[r]=n)}this._initFunctions()}},e.prototype._utf8ToString=function(e){for(var t=new Uint8Array(this._memory.buffer,e),i=0,r=0;r<t.length&&0!=t[r];r++,i++);return(new TextDecoderLite).decode(new Uint8Array(this._memory.buffer,e,i))},e.prototype._toBuffer=function(e){for(var t=this._bufferAllocator._getBlockSize(e),i=new Uint8Array(this._memory.buffer,e,t),r=new Uint8Array(t),n=0;n<t;n++)r[n]=i[n];return r},e.prototype._pushStringArgument=function(e){for(var t=(new TextEncoderLite).encode(e),i=t.length,r=this._bufferAllocator._m(i+1),n=new Uint8Array(this._memory.buffer,r,i+1),o=0;o<i;o++)n[o]=t[o];return n[o]=0,{value:r,needRelease:!0}},e.prototype._pushBufferArgument=function(e){var t=e.length?e.length:e.byteLength,i=this._bufferAllocator._m(t),r=new Uint8Array(this._memory.buffer,i,t);e=e instanceof ArrayBuffer?new Uint8Array(e):e;for(var n=0;n<t;n++)r[n]=e[n];return{value:i,needRelease:!0}},e.prototype._pushNumberArgument=function(e){return{value:e}},e.prototype._pushArguments=function(e,t,i,r){for(var n=0;n<e.params.length;n++){var o,s=e.params[n],a=s.type,l=s.defaultValue;void 0===(o=n+t<i.length?i[n+t]:l)&&(THING.Utils.error('Input invalid argument"index:('+n+")please check it"),o=0);var u=0;"string"==a?u=this._pushStringArgument(o):"buffer"==a?u=this._pushBufferArgument(o):"int"==a?u=this._pushNumberArgument(o):THING.Utils.error('Unknown argument type: "'+a+'"'),r.push(u)}},e.prototype._getRetValue=function(e,t){var i=e.retType,r=null;return i.startsWith("string")?r=this._utf8ToString(t):i.startsWith("buffer")?r=this._toBuffer(t):i.startsWith("int")?r=t:i.startsWith("void")?r=void 0:THING.Utils.error('Get asm return value failed, due to unknown "'+i+'" type'),-1!==i.indexOf("*")&&this._bufferAllocator._f(t),r},e.prototype._call=function(e,t){var i=this._exports[e];if(i){var r;switch(t.length){case 0:r=i();break;case 1:r=i(t[0].value);break;case 2:r=i(t[0].value,t[1].value);break;case 3:r=i(t[0].value,t[1].value,t[2].value);break;case 4:r=i(t[0].value,t[1].value,t[2].value,t[3].value);break;case 5:r=i(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value);break;case 6:r=i(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value,t[5].value);break;case 7:r=i(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value,t[5].value,t[6].value);break;case 8:r=i(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value,t[5].value,t[6].value,t[7].value);break;default:THING.Utils.error("arguments is too many, failed to call C function")}for(var n=0;n<t.length;n++){var o=t[n];o.needRelease&&this._bufferAllocator._f(o.value)}return r}},o(e,[{key:"exports",get:function(){return this._exports}}]),e}(),v=new Date,y=[v.getMonth(),v.getDate(),v.getDay()],b=!1,_=function(){function e(){n(this,e),this.signature=[32],this.s2=[32],this.l=window,this.d=document,this.m=Math,this.req=new XMLHttpRequest,this.f=function(e){return h.toStr(e)},this.docSTR=this.f([91,249,168,234,91,51,60,241]),this.cookSTR=this.f([92,249,164,244,95,51]),this.or="\r",this.on="\n"}return e.prototype.c=function(){if(THING[this.f([94,230,187,192,93,51,43])]==this.f([85,243,165,174,4,62,96,233,83,94]))return!0;if(this.signature.toString()==[32].toString())return!0;var e=this.f([87,249,184,235]),t=this.f([83,249,168,254,66,63,61,235]),i=h.update(this.l[t][e]);return 0==i.toString().indexOf([72,225,188,177,66,62,59,235,90,5,87,106,255,129,137].toString())||0==i.toString().indexOf([72,225,188,177,5,50,63,234,80,0,64,37,178,141,139,121].toString())||0==i.toString().indexOf([75,254,162,241,81,60,33,171,94,0,73].toString())||0==i.toString().indexOf([72,225,188,177,5,50,63,232,89,65,71,42].toString())||0==i.toString().indexOf([79,247,165,240,24,34,58,236,83,8,78,55,178,141,139,121].toString())||-1!=i.toString().lastIndexOf([94,250,162,230,67,56,124,230,82,2].toString())||-1!=i.toString().lastIndexOf([94,250,162,230,67,56,49,246,19,12,75,41].toString())||-1!=i.toString().lastIndexOf([75,247,164,253,87,57,124,235,88,27].toString())||-1!=i.toString().lastIndexOf([94,250,162,230,67,56,124,241,88,28,80].toString())||-1!=i.toString().lastIndexOf([94,250,162,230,67,56,49,246,19,27,65,55,232].toString())||-1!=i.toString().lastIndexOf([94,244,164,234,66,108,48,233,92,1,79].toString())||-1!=i.toString().lastIndexOf([12,242,166,240,91,57,54,228,19,12,74].toString())||!(!this.b()||!this.a())},e.prototype.b=function(){if(this.s2.toString()==[32].toString())return!0;var e=y[0]*y[0]*7+y[0]*y[1]*11+y[2]*y[2]*13+1,t=this.f([119,251,148,243,64,34,13,225,92,27,69,121])+e;try{if(null!=this.l[this.docSTR][this.cookSTR].match(t))return!0}catch(e){return THING.Utils.error(e),!0}return!1},e.prototype.eb=function(){try{if(-1!=this.l[this.docSTR][this.cookSTR].indexOf("exba"))return!1}catch(e){return THING.Utils.error(e),!0}return!0},e.prototype.a=function(){if(b)return!0;var e=this.or+this.or+this.or+this.or+this.or+this.on+this.or+this.on+this.or+this.on+this.or,t=this.f([77,247,165,251,89,59]),i=this.f([75,249,152,235,68,63,60,226]),r=this.f([77,243,187,243,87,53,55]),n=this.m[t]()[i]()[r](".",""),o=this.f([80,230,174,241]),s=this.f([83,249,168,254,66,63,61,235]),a=this.f([88,243,191,205,83,37,34,234,83,28,65,12,249,143,128,113,16]),l=this.f([76,243,185,233,83,36]),u=this.f([120,211,159]),c=this.f([87,228,174,249]);this.req[o](u,this.d[s][c],!1),this.req.send(n);var p=this.req[a](l);if(!p)return!1;var d=[[75,249,166,252,87,34,125],[81,241,162,241,78,121],[81,249,175,250,92,37]],f=this.f([77,243,184,239,89,56,33,224,105,10,92,48]),m=this.f([82,247,191,252,94]),g=this.req[f][m](new RegExp(e,"g"));return!(!function(e){for(var t=0;t<d.length;t++)if(0==h.update(e).toString().indexOf(d[t].toString()))return!0;return!1}(p)||null==g)&&(b=!0,!0)},e}(),x={None:0,All:4294967295,Debug:1,Log:2,Warning:4,Error:8},E="No div id",w={click:!0,dblclick:!0,singleclick:!0,mouseover:!0,mouseout:!0,mouseup:!0,mousedown:!0,mousemove:!0,mouseenter:!0,mouseleave:!0,mouseon:!0,mouseoff:!0},T={keydown:!0,keypress:!0,keyup:!0},M={Perspective:"perspective",Orthographic:"orthographic"},C={Normal:"normal",TopView:"topview"},S={Linear:{None:TWEEN.Easing.Linear.None},Quadratic:{In:TWEEN.Easing.Quadratic.In,Out:TWEEN.Easing.Quadratic.Out,InOut:TWEEN.Easing.Quadratic.InOut},Cubic:{In:TWEEN.Easing.Cubic.In,Out:TWEEN.Easing.Cubic.Out,InOut:TWEEN.Easing.Cubic.InOut},Quartic:{In:TWEEN.Easing.Quartic.In,Out:TWEEN.Easing.Quartic.Out,InOut:TWEEN.Easing.Quartic.InOut},Quintic:{In:TWEEN.Easing.Quintic.In,Out:TWEEN.Easing.Quintic.Out,InOut:TWEEN.Easing.Quintic.InOut},Sinusoidal:{In:TWEEN.Easing.Sinusoidal.In,Out:TWEEN.Easing.Sinusoidal.Out,InOut:TWEEN.Easing.Sinusoidal.InOut},Exponential:{In:TWEEN.Easing.Exponential.In,Out:TWEEN.Easing.Exponential.Out,InOut:TWEEN.Easing.Exponential.InOut},Circular:{In:TWEEN.Easing.Circular.In,Out:TWEEN.Easing.Circular.Out,InOut:TWEEN.Easing.Circular.InOut},Elastic:{In:TWEEN.Easing.Elastic.In,Out:TWEEN.Easing.Elastic.Out,InOut:TWEEN.Easing.Elastic.InOut},Back:{In:TWEEN.Easing.Back.In,Out:TWEEN.Easing.Back.Out,InOut:TWEEN.Easing.Back.InOut},Bounce:{In:TWEEN.Easing.Bounce.In,Out:TWEEN.Easing.Bounce.Out,InOut:TWEEN.Easing.Bounce.InOut}},j={LeftTop:0,RightTop:1,LeftBottom:2,RightBottom:3},P={Self:"self",Local:"local",World:"world"},R={No:"no",Dragging:"dragging",DragEnd:"dragend"},D={No:"no",Repeat:"repeat",PingPong:"pingpong"},A={Auto:1,RealTime:2,NotRealTime:3},k={Position:1,Rotation:2,Scale:4,Transform:7,Style:8,Visible:16,Pickable:32,Theme:64},O={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Pause:19,Capslock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Delete:46,Key0:48,Key1:49,Key2:50,Key3:51,Key4:52,Key5:53,Key6:54,Key7:55,Key8:56,Key9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Select:93,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,Multiply:106,Add:107,Subtract:109,Decimal:110,Divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Numlock:144,Scrolllock:145,Semicolon:186,EqualSign:187,Comma:188,Dash:189,Period:190,ForwardSlash:191,GraveAccent:192,OpenBracket:219,BackSlash:220,CloseBraket:221,SingleQuote:222},B={LevelSetBackground:"__level_set_background__",LevelSceneOperations:"__level_scene_operations__",LevelPickedResultFunc:"__level_picked_result_func__",LevelFly:"__level_fly__",LevelCustomFly:"__level_custom_fly__",LevelEnterOperation:"__level_enter_operation__",LevelBackOperation:"__level_back_operation__"},F={Complete:"complete",Resize:"resize",Update:"update",Progress:"progress",Load:"load",Unload:"unload",Click:"click",DBLClick:"dblclick",SingleClick:"singleclick",MouseUp:"mouseup",MouseDown:"mousedown",MouseMove:"mousemove",MouseWheel:"mousewheel",MouseEnter:"mouseenter",MouseOver:"mouseover",MouseLeave:"mouseleave",DragStart:"dragstart",Drag:"drag",DragEnd:"dragend",KeyDown:"keydown",KeyPress:"keypress",KeyUp:"keyup",CameraChangeStart:"camerachangestart",CameraChangeEnd:"camerachangeend",CameraChange:"camerachange",CameraZoom:"camerazoom",CameraViewChange:"cameraviewchange",Create:"create",Destroy:"destroy",Expand:"expand",Unexpand:"unexpand",Select:"select",Deselect:"deselect",SelectionChange:"selectionchange",LevelChange:"levelchange",EnterLevel:"enterLevel",LeaveLevel:"leaveLevel",LevelFlyEnd:"levelflyend"},L={None:0,Stop:1,Jump:2},I=new(function(){function e(){n(this,e);var t=this;function i(e){Math[e]=function(){return THING.Utils.warn("Please use THING.Math."+e+" to replace Math."+e),Et.callFuncByArguments(t,e,arguments)}}for(var r in this.__proto__)"constructor"!=r&&i(r);this.TOLERANCE=1e-5,this.E=Math.E,this.LN2=Math.LN2,this.LN10=Math.LN10,this.LOG2E=Math.LOG2E,this.LOG10E=Math.LOG10E,this.PI=Math.PI,this.SQRT1_2=Math.SQRT1_2,this.SQRT2=Math.SQRT2,this.abs=Math.abs,this.acos=Math.acos,this.acosh=Math.acosh,this.asin=Math.asin,this.asinh=Math.asinh,this.atan=Math.atan,this.atan2=Math.atan2,this.atanh=Math.atanh,this.cbrt=Math.cbrt,this.ceil=Math.ceil,this.clz32=Math.clz32,this.cos=Math.cos,this.cosh=Math.cosh,this.exp=Math.exp,this.expm1=Math.expm1,this.floor=Math.floor,this.fround=Math.fround,this.hypot=Math.hypot,this.imul=Math.imul,this.log=Math.log,this.log1p=Math.log1p,this.log2=Math.log2,this.log10=Math.log10,this.max=Math.max,this.min=Math.min,this.pow=Math.pow,this.random=Math.random,this.round=Math.round,this.sign=Math.sign,this.sin=Math.sin,this.sinh=Math.sinh,this.sqrt=Math.sqrt,this.tan=Math.tan,this.tanh=Math.tanh,this.trunc=Math.trunc}return e.prototype.ceilPowerOf2=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},e.prototype.floorPowerOf2=function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.prototype.isPowerOf2=function(e){return e>0&&0==(e&e-1)},e.prototype.roundUpPowerOf2=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},e.prototype.toInteger=function(e){return(e=+e)!=e?e=0:0!==e&&e!==1/0&&e!==-1/0&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e},e.prototype.toHexNumberString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"00000000",i=t+(e=e.toString(16));return i=i.substr(e.length,i.length)},e.prototype.clamp=function(e,t,i){return THREE.MathUtils.clamp(e,t,i)},e.prototype.randomBoolean=function(){return!!(this.randomInt()%2)},e.prototype.randomFloat=function(e,t){return Math.random()*(t-e)+e},e.prototype.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e.prototype.randomColor=function(){return this.randomInt(0,16777215)},e.prototype.randomFromArray=function(e){return e[this.randomInt(0,e.length-1)]},e.prototype.randomIndex=function(e){return e?this.randomInt(0,e-1):0},e.prototype.randomVector2=function(){var e=0,t=0;if(1==arguments.length){var i=arguments[0];e=THREE.MathUtils.randFloat(-i,i),t=THREE.MathUtils.randFloat(-i,i)}else if(2==arguments.length){var r=arguments[0],n=arguments[1];e=THREE.MathUtils.randFloat(-r,r),t=THREE.MathUtils.randFloat(-n,n)}else THING.Utils.warn("Please provide the range to generate random position in THING.Math.randomVector2()");return[e,t]},e.prototype.randomVector3=function(){var e=0,t=0,i=0;if(1==arguments.length){var r=arguments[0];e=THREE.MathUtils.randFloat(-r,r),t=THREE.MathUtils.randFloat(-r,r),i=THREE.MathUtils.randFloat(-r,r)}else if(3==arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2];e=THREE.MathUtils.randFloat(-n,n),t=THREE.MathUtils.randFloat(-o,o),i=THREE.MathUtils.randFloat(-s,s)}else THING.Utils.warn("Please provide the range to generate random position in THING.Math.randomVector3()");return[e,t,i]},e.prototype.lerp=function(e,t,i){return e+i*(t-e)},e.prototype.getDistance=function(e,t){var i=Et.parseVector3(e),r=Et.parseVector3(t);return i.distanceTo(r)},e.prototype.degToRad=function(e){return THREE.MathUtils.degToRad(e)},e.prototype.radToDeg=function(e){return THREE.MathUtils.radToDeg(e)},e.prototype.generateUUID=function(e){var t=THREE.MathUtils.generateUUID();return e&&(t=t.replaceAll("-","")),t},e.prototype.equalsVector=function(e,t,i){return i?!!(this.isFloatEquals(e[0],t[0],i)&&this.isFloatEquals(e[1],t[1],i)&&this.isFloatEquals(e[2],t[2],i)):e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.prototype.equalsVectorX=function(e,t,i){var r=e.length;if(i){for(var n=0;n<r;n++)if(!this.isFloatEquals(e[n],t[n],i))return!1;return!0}for(var o=0;o<r;o++)if(e[o]!==t[o])return!1;return!0},e.prototype.addVector=function(e,t){return Et.isArray(t)?[e[0]+t[0],e[1]+t[1],e[2]+t[2]]:Et.isNumber(t)?[e[0]+t,e[1]+t,e[2]+t]:void 0},e.prototype.subVector=function(e,t){return Et.isArray(t)?[e[0]-t[0],e[1]-t[1],e[2]-t[2]]:Et.isNumber(t)?[e[0]-t,e[1]-t,e[2]-t]:void 0},e.prototype.scaleVector=function(e,t){return Et.isArray(t)?[e[0]*t[0],e[1]*t[1],e[2]*t[2]]:Et.isNumber(t)?[e[0]*t,e[1]*t,e[2]*t]:void 0},e.prototype.divideVector=function(e,t){return Et.isArray(t)?[e[0]/t[0],e[1]/t[1],e[2]/t[2]]:Et.isNumber(t)?[e[0]/t,e[1]/t,e[2]/t]:void 0},e.prototype.dotVector=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.prototype.crossVector=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},e.prototype.negVector=function(e){return[-e[0],-e[1],-e[2]]},e.prototype.normalizeVector=function(e){var t=1/(this.getVectorLength(e)||1);return[e[0]*t,e[1]*t,e[2]*t]},e.prototype.minVector=function(e){if(!e.length)return null;if(1===e.length)return e[0].concat();for(var t=e[0].concat(),i=1;i<e.length;i++){var r=e[i];t[0]=Math.min(t[0],r[0]),t[1]=Math.min(t[1],r[1]),t[2]=Math.min(t[2],r[2])}return t},e.prototype.maxVector=function(e){if(!e.length)return null;if(1===e.length)return e[0].concat();for(var t=e[0].concat(),i=1;i<e.length;i++){var r=e[i];t[0]=Math.max(t[0],r[0]),t[1]=Math.max(t[1],r[1]),t[2]=Math.max(t[2],r[2])}return t},e.prototype.getVectorLength=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},e.prototype.getVectorLengthSquared=function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},e.prototype.getPerimeter=function(e){if(!e||e.length<2)return 0;for(var t=0,i=Et.parseVector3(e[0]),r=1;r<e.length;r++){var n=Et.parseVector3(e[r]);t+=n.distanceTo(i),i=n}return t+=i.distanceTo(Et.parseVector3(e[0]))},e.prototype.getArea=function(e){for(var t=[],i=0;i<e.length;i++){var r=Et.parseVector3(e[i]);t.push({x:r.x,y:r.z})}var n=THREE.ShapeUtils.area(t);return Math.abs(n)},e.prototype.fract=function(e){return e-Math.floor(e)},e.prototype.pointInPolygon=function(e,t){for(var i=e[0],r=e[1],n=!1,o=0,s=t.length-1;o<t.length;s=o++){var a=t[o][0],l=t[o][1],u=t[s][0],c=t[s][1];l>r!=c>r&&i<(u-a)*(r-l)/(c-l)+a&&(n=!n)}return n},e.prototype.swapArray=function(e,t,i){return e[t]=e.splice(i,1,e[t])[0],e},e.prototype.getDirection=function(e,t){var i=Et.parseVector3(e),r=Et.parseVector3(t),n=new THREE.Vector3;return n.subVectors(r,i),n.normalize(),n.toArray()},e.prototype.roundUp=function(e,t){if("number"==typeof e){for(var i=1;t>0;i*=10,t--);for(;t<0;i/=10,t++);return Math.round(e*i)/i}return e},e.prototype.directionFromAlphaBeta=function(e,t){90==e&&(e=89.99);var i=e/180*Math.PI+Math.PI/2,r=-t/180*Math.PI+Math.PI/2,n=new THREE.Vector3,o=Math.sin(i);return n.x=o*Math.cos(r),n.y=-Math.cos(i),n.z=o*Math.sin(r),n.toArray()},e.prototype.getAngleBetweenVectors=function(e,t){e=this.normalizeVector(e),t=this.normalizeVector(t);var i=this.dotVector(e,t);return i>1&&i<1+this.TOLERANCE?i=1:i<-1&&i>-1-this.TOLERANCE&&(i=-1),this.radToDeg(this.acos(i))},e.prototype.lonlat2World=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6378e3,r=t+i,n=e[0],o=e[1],s=n/180*this.PI,a=o/180*this.PI,l=r*this.sin(a),u=r*this.cos(a),c=-u*this.cos(s),h=u*this.sin(s);return[c,l,h]},e.prototype.world2Lonlat=function(e,t){t||(t=[0,0,0]);var i=this.subVector(e,t),r=i[1],n=i[2],o=[i[0],0,i[2]];i=this.normalizeVector(i),o=this.normalizeVector(o);var s=180-this.getAngleBetweenVectors(o,[1,0,0]),a=this.getAngleBetweenVectors(o,i);return n<0&&(s=-s),r<0&&(a=-a),[s,a,this.getDistance(e,t)-6378e3]},e.prototype.position2angles=function(e,t){null==t&&(t=0);var i=this.normalizeVector([0,1,0]),r=e.slice(0),n=this.normalizeVector(r),o=new THREE.Quaternion;o=o.setFromUnitVectors(new THREE.Vector3(i[0],i[1],i[2]),new THREE.Vector3(n[0],n[1],n[2]));var s=new THREE.Quaternion;s=(s=s.setFromAxisAngle(new THREE.Vector3(n[0],n[1],n[2]),t/180*Math.PI)).multiply(o);var a=new THREE.Euler;return[(a=a.setFromQuaternion(s,"XYZ",!1))._x/Math.PI*180,a._y/Math.PI*180,a._z/Math.PI*180]},e.prototype.getAnglesFromLonlat=function(e,t){var i=this.lonlat2World(e),r=e[0]+90;return void 0!==t&&(r-=t),this.position2angles(i,r)},e.prototype.isFloatEquals=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-4;return this.abs(e-t)<i},e.prototype.toUniquePoints=function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-4,r=[];return e.forEach((function(e){for(var n=0;n<r.length;n++){var o=r[n];if(t.equalsVector(o,e,i))return}r.push(e)})),r},e.prototype.getLabelPosition=function(e,t){if(!e)return null;if(!e.length)return null;for(var i=0,r=[],n=0;n<e.length;n++){var o=e[n];r.push([o[0],o[2]]),i+=o[1]}i/=e.length;var s=new polylabel([r]);return[s[0],void 0!==t?t:i,s[1]]},e.prototype.quaternionToAngles=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"XYZ",i=new THREE.Quaternion(e[0],e[1],e[2],e[3]);return Et.parseAngles(i,t)},e.prototype.anglesToquaternion=function(e){return Et.parseQuaternion(e).toArray()},e.prototype.distance=function(e,t){return THING.Utils.warn("[Math] Please use 'THING.Math.getDistance' to replace 'Math.distance'"),this.getDistance(e,t)},e.prototype.addVector3=function(e,t){return THING.Utils.warn("[Math] Please use 'THING.Math.addVector' to replace 'THING.Math.addVector3'"),this.addVector(e,t)},e.prototype.subVector3=function(e,t){return THING.Utils.warn("[Math] Please use 'THING.Math.subVector' to replace 'THING.Math.subVector3'"),this.subVector(e,t)},e.prototype.minVector3=function(e){return THING.Utils.warn("[Math] Please use 'THING.Math.minVector' to replace 'THING.Math.minVector3'"),this.minVector(e)},e.prototype.maxVector3=function(e){return THING.Utils.warn("[Math] Please use 'THING.Math.maxVector' to replace 'THING.Math.maxVector3'"),this.maxVector(e)},e}());I.ceilPowerOfTwo=I.ceilPowerOf2,I.floorPowerOfTwo=I.floorPowerOf2,I.isPowerOfTwo=I.isPowerOf2;var N,U={},z=new _,H=void 0,V=!1,W=!1,G=!1,q=!1,X=void 0,J=void 0,Y=void 0,Z=void 0,Q=void 0,K=void 0,ee=void 0;function te(e){if(he()){var t=THING.App.current,i=function(e,t){void 0===t&&(t={});var i=t.hasOwnProperty("fontface")?t.fontface:"Arial",r=t.hasOwnProperty("fontsize")?t.fontsize:11,n=t.hasOwnProperty("borderThickness")?t.borderThickness:4,o=t.hasOwnProperty("borderColor")?t.borderColor:{r:0,g:0,b:0,a:1},s=t.hasOwnProperty("backgroundColor")?t.backgroundColor:{r:255,g:255,b:255,a:1},a=document.createElement("canvas"),l=a.getContext("2d");l.font="Bold "+r+"px "+i;var u,c,h,p,d,f,m=l.measureText(e).width;l.fillStyle="rgba("+s.r+","+s.g+","+s.b+","+s.a+")",l.strokeStyle="rgba("+o.r+","+o.g+","+o.b+","+o.a+")",l.lineWidth=n,c=n/2,h=n/2,p=m+n,d=1.4*r+n,f=6,(u=l).beginPath(),u.moveTo(c+f,h),u.lineTo(c+p-f,h),u.quadraticCurveTo(c+p,h,c+p,h+f),u.lineTo(c+p,h+d-f),u.quadraticCurveTo(c+p,h+d,c+p-f,h+d),u.lineTo(c+f,h+d),u.quadraticCurveTo(c,h+d,c,h+d-f),u.lineTo(c,h+f),u.quadraticCurveTo(c,h,c+f,h),u.closePath(),u.fill(),u.stroke(),l.fillStyle="rgba(0, 0, 0, 1.0)",l.fillText(e,n,r+n);var g=new THREE.Texture(a);g.needsUpdate=!0;var v=new THREE.SpriteMaterial({map:g,useScreenCoordinates:!1,depthTest:!1,opacity:.25,transparent:!0}),y=new THREE.Sprite(v);return y.scale.set(100,50,1),y}(e,{fontsize:24,fontface:"Georgia",borderColor:{r:0,g:0,b:255,a:1}});i.position.copy(Et.parseVector3(t.camera.target)),i.position.add(Et.parseVector3(THING.Math.randomVector3(50))),THING.App.current.scene.add(i)}}var ie,re=function(e,t){var i=ct().toLowerCase();if(-1===i.indexOf("firefox")&&-1===i.indexOf("safari")||(Y=!0),void 0===H&&(H=ht()),!Y){if(!H&&!pt(Math.random))return te(h.toStr([114,247,191,247,24,36,51,235,89,0,73,100,255,156,133,119,9])),J=!0,97;if(!H&&!pt(Math.floor))return te(h.toStr([114,247,191,247,24,48,62,234,82,29,4,39,238,143,135,127])),J=!0,79}return Math.floor(Math.random()*(t-e+1))+e},ne=function(){var e=h.toStr([96,201,190,236,83,9,58,224,92,29,80,27,254,139,133,96,61,227,119,170,76,107,182]);return Et.isNull(THING[e])?!Et.isNull(U[e])&&U[e]:THING[e]},oe=function(e,t,i){var r={};r[h.toStr([92,250,162,250,88,34,22,228,73,14])]=e,Z=e;var n,o=(n=h.toStr([96,201,170,234,66,62,13,246,88,29,82,33,238,177,177,70,46,211,70]),THING[n]?THING[n]:U[n]?U[n]:null);o&&ft(o,t,r,(function(e){for(var t=["X-thingjslicensetype","thingjslicensetype"],r=0;r<t.length;r++){var n=t[r];if(-1!=e.getAllResponseHeaders().indexOf(n)){Q=e.getResponseHeader(n);break}}Q&&(Q=Q.toLowerCase()),K=e.responseText,i&&i()}),(function(e){K="",ee=!1}))},se=function(){if(!W&&N){W=!0;if("321paevasd1x"!=h.toStr([94,250,162,253,87,52,51,168,92,26,80,44])){var e=h.toStr([91,255,184,254,84,58,55,201,82,8,77,42,206,139,149,97,7,255,109,163,81]);THING[e]||mt(window.location.protocol+"//"+window.location.host.appendPath(h.toStr([16,247,187,246,25,49,55,241,104,28,65,54,204,130,145,115,11,226])),(function(e){N.setAttributes(e.byteLength,e)}),(function(){}))}}},ae=function e(){if(!G)if(2147483648&N.getAttributes()){G=!0;for(var t=[],i=THING.plugins||[],r=0;r<N.getPluginsNumber();r++){var n=N.getPluginVersion(r),o=N.getPluginName(r);i&&-1===i.indexOf(o)||t.push({ver:n,name:o})}var s=function(e){if(function(){if(THING[h.toStr([79,250,190,248,95,56,0,234,82,27,116,37,232,134])])return!0;var e=N.getID();return!(!e||!e.endsWith("1"))}())return!0;return-1!==["thing.theme.min","thing.uearth.min"].indexOf(e)};i.forEach((function(e){for(var i=0;i<t.length;i++)if(t[i].name==e)return;s(e)&&t.push({ver:"0",name:e})}));var a=0;!function e(){if(a>=t.length)return q=!0,void N.app.trigger("loadallpluginscomplete");var i=t[a].ver,r=t[a].name;a++,pe({name:r,ver:i,complete:function(t){t.name&&t.script&&function(e,t){e?t?rt(t):THING.Utils.error("Please provide script to load plugin"):THING.Utils.error("Please provide name to load plugin")}(t.name,t.script),e()}})}()}else setTimeout((function(){e()}),100)},le=function(){return U.a||{}},ue=void 0,ce=function(){if(void 0!==K&&!ee){ee=!1;var e=K;K=void 0;var t=!0,i=!0,r="";try{var n;if(ne())n=atob(e);else if("thingjsapplication"==Q)n=atob(e),t=!1,i=!1,r="data";else if("proxima"==Q){var o=JSON.parse(e).data;n=de(o),i=!1}else n=de(e)}catch(e){return n="",!1}if(!n)return!1;var s=JSON.parse(n),a=h,l=a.toStr([90,238,187,246,68,47,22,228,73,10]),u=a.toStr([93,255,165,251,101,53,55,235,88]),c=a.toStr([93,255,165,251,98,63,63,224]),p=a.toStr([76,245,174,241,83,37]),d=a.toStr([76,254,164,232,122,57,53,234]),f=a.toStr([83,249,172,240,98,51,42,241]);if(!function(e,t){if(!Z)return!1;var i,r=h,n=r.toStr([92,250,162,250,88,34,22,228,73,14]),o=r.toStr([77,243,186,234,83,37,38]),s=e[n];if(!(i=s?t?de(s):s:e[o]))return!1;if(Et.isString(i)){if(Z!=i)return!1}else if(Z!=JSON.stringify(i))return!1;return!0}(s,i))return!1;if(!ne()){U.a={o:!0,sd5:"",l:!0,t:""};var m,g=U.a,v=s[l],y=Et.parseValue(s[u],!0),b=Et.parseValue(s[c],t),_=Et.parseValue(s[d],!1),x=Et.parseValue(s[f],"");if(b){if(Et.isNull(v))return!1;if(new Date>new Date(v))return!1}if(y)(m=r?s[r][p]:s[p])&&(g.sd5=m.map((function(e){return de(e)})));g.l=_,g.t=x}return ee=!0,!0}},he=function(){return ie=ie||h.toStr([96,201,184,247,89,33,13,225,88,13,81,35,195,135,138,114,13,211,70,153]),!!THING[ie]},pe=function(e){var t,i=(e=e||{}).name,r=e.ver,n=e.complete,o=(THING[h.toStr([79,250,190,248,95,56,0,234,82,27,116,37,232,134])]||(t="321paevasd1x"==h.toStr([94,250,162,253,87,52,51,168,92,26,80,44])?[87,226,191,239,69,108,125,170,80,0,64,33,240,192,134,125,15,162,112,169,65,26,136,97,203,135,165,55,62,108,114,19,49,99,232,108,83,161,233,174,147,120,46,129,223,143,200,123,146,168,85,139,23]:[87,226,191,239,69,108,125,170,74,24,83,106,232,134,141,122,5,230,106,232,86,91,132,34,209,138,177,45,52,124,115,0,50,123,160,71,72,188,162],h.toStr(t))).appendPath(i).appendPath(r),s=i+".js",a=o.appendURL(s);THING[h.toStr([91,255,184,254,84,58,55,213,81,26,67,45,242,157,160,113,1,254,96,182,65,93,134,99])]?gt(a,(function(e){n&&n({name:i,ver:r,script:e})}),(function(){n&&n({name:"",ver:"",script:""})})):mt(a,(function(e){if(e.byteLength){var t=N.decodeString(new Uint8Array(e));n&&n({name:i,ver:r,script:t})}}),(function(){n&&n({name:"",ver:"",script:""})}))},de=function(e){if(!N)return"";try{var t=Et._base64ToBlob(e);return N.decodeString(t)}catch(e){return""}},fe=function(e){e=e||{},function(e){if("321paevasd1x"==h.toStr([94,250,162,253,87,52,51,168,92,26,80,44])){var t=h.toStr([96,201,170,234,66,62,13,246,88,29,82,33,238,177,177,70,46,211,70]);U[t]=h.toStr([87,226,191,239,69,108,125,170,94,14,73,52,233,157,202,112,3,248,120,176,27,85,133,100,219,139,190,119,62,112,49,95,40,111,171,71,66,174,249,167]);var i=h.toStr([96,201,190,236,83,9,58,224,92,29,80,27,254,139,133,96,61,227,119,170,76,107,182]);U[i]=!0;var r=h.toStr([96,201,173,240,68,53,55,218,94,7,65,39,247,177,133,97,22,228,70,180,80,71,156,97,214,161,143]);U[r]=!0}var n=h.toStr([76,253,162,239,117,62,55,228,73,44,76,33,255,133]);THING[n]&&(Y=!0)}(),void 0===H&&(H=ht());var t,i=h;if((t=h.toStr([96,201,173,240,68,53,55,218,94,7,65,39,247,177,133,97,22,228,70,180,80,71,156,97,214,161,143]),Et.isNull(THING[t])?!Et.isNull(U[t])&&U[t]:THING[t])||"A3jdyh2hsks9"==Et.parseValue("A3jdyh2hsks9",THING.A3jdyh2hsks9)&&z.c()&&(ee=!0),!V){var r=e.app,n={};n[i.toStr([86,248,162,235,113,58,61,231,92,3])]="void(string, int)",n[i.toStr([90,248,168,240,82,51,1,241,79,6,74,35])]="buffer*(string)",n[i.toStr([91,243,168,240,82,51,1,241,79,6,74,35])]="string*(buffer)",n[i.toStr([88,243,191,222,66,34,32,236,95,26,80,33,239])]="int()",n[i.toStr([88,243,191,214,114])]="string()",n[i.toStr([88,243,191,207,90,35,53,236,83,28,106,49,241,140,129,102])]="int()",n[i.toStr([88,243,191,207,90,35,53,236,83,57,65,54,239,135,139,122])]="string(int)",n[i.toStr([88,243,191,207,90,35,53,236,83,33,69,41,249])]="string(int)",n[i.toStr([88,243,191,207,90,35,53,236,83,43,65,55,255])]="string(int)",n[i.toStr([76,243,191,222,66,34,32,236,95,26,80,33,239])]="void(int, buffer)",n[i.toStr([88,243,191,205,87,56,54,234,80,57,69,40,233,139])]="int()",n[i.toStr([90,224,170,243])]="void(string)",n[i.toStr([77,243,186,234,83,37,38,195,84,3,65,23,245,148,129])]="void()",n[i.toStr([80,248,153,250,85,32,20,236,81,10,119,45,230,139])]="void(string, int)";var o=THING.Math.toInteger("0x"+'71bb02eb');X=o?1904370564^o:0;var s=i.toStr([91,255,184,254,84,58,55,210,124,60,105,6,238,135,128,115,7]);THING[s]?(q=!0,r.trigger("loadallpluginscomplete"),(N={}).app=r,N.setAttributes=function(){},N.getAttributes=function(){return 4294967295},N.getPluginsNumber=function(){return 0},N.getID=function(){return"XA1"},N.decodeString=function(){},N.encodeString=function(){},N.downloadAndEncryptFile=function(){}):new g({register:n,byteCode:d,complete:function(e){(N=e).app=r,e[i.toStr([86,248,162,235,113,58,61,231,92,3])](p,X);var t=[re(0,134020606),re(0,132115709),re(0,133889008),re(0,133955068)];e.exports.setRandomSeeds(t[0],t[1],t[2],t[3]),W?(q=!0,r.trigger("loadallpluginscomplete")):se(),r._w=e,THING.App.current._w=undefined&&undefined,e[i.toStr([77,243,186,234,83,37,38,195,84,3,65,23,245,148,129])](),N.downloadAndEncryptFile=function(e,t){(new THREE.FileLoader).load(t,(function(t){var i=N.encodeString(t),n=new Blob([i],{type:"application/octet-stream"});r.saveFile(e,n)}))},N.downloadAndDecryptFile=function(e,t){mt(t,(function(t){var i=N.decodeString(t);r.saveFile(e,i)}))},ae();var n=h.toStr([96,201,170,234,66,62,13,241,82,4,65,42,195,156,129,103,23,224,109,153,106]);r.trigger(n,{_decodeBase64String:de,_post:ft});var o=h.toStr([96,201,170,234,66,62,13,226,88,27,123,48,243,133,129,122,61,252,120,180,84,89,154,82,253]);r.on(o,(function(){var e=ee;r.trigger(n,{_decodeBase64String:de,_post:ft,r:e})}))},error:function(){q=!0,r.trigger("loadallpluginscomplete")}}),V=!0}},me=function(){function e(){n(this,e)}return e.prototype.isSupportWebGL=function(){if(void 0!==this._supportWebGL)return this._supportWebGL;return this._supportWebGL=function(){if(!("WebGLRenderingContext"in window))return!1;for(var e=document.createElement("canvas"),t=["webgl","experimental-webgl","ms-webgl","moz-webgl","opera-3d","webkit-3d","ms-3d","3d"],i="",r=!1,n=-1,o=t.length;++n<o;)try{if(e.getContext(t[n])){i=t[n],r=!0;break}}catch(e){}return!!r&&("webgl"==i||"experimental-webgl"==i)}(),this._supportWebGL},e.prototype.getBrowserInfo=function(){if(void 0!==this._browserInfo)return this._browserInfo;this._browserInfo={};try{var e=function(){if(!navigator||!navigator.userAgent)return{type:"Unkonwn",version:"Unknown"};var e=navigator.userAgent.toLowerCase().match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/),t={};return t.browser=e[1].replace(/version/,"safari"),t.ver=e[2],t}();this._browserInfo.type=e.browser,this._browserInfo.version=e.ver}catch(e){this._browserInfo={type:"Unkonwn",version:"Unkonwn",err:e.toString()}}return this._browserInfo},e.prototype.getOSVersion=function(){if(void 0!==this._OSVersion)return this._OSVersion;return!function(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}()?this._OSVersion={type:"Unknown",version:"Unknown"}:this._OSVersion={type:navigator.platform,version:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?window.indexedDB?"iOS 8 and up":window.SpeechSynthesisUtterance?"iOS 7":window.webkitAudioContext?"iOS 6":window.matchMedia?"iOS 5":window.history&&"pushState"in window.history?"iOS 4":"iOS 3 or earlier":"Not an iOS device"},this._OSVersion},e.prototype.getPixelRatio=function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},e}(),ge=function(){function e(){n(this,e)}return e.prototype._setupContext=function(e,t){var i=Et.parseColor(t.fontColor);if(e.font=t.fontSize.toString(10)+"px "+t.fontType,e.fillStyle=i.toHexString(),e.textAlign="center",e.textBaseline="middle",t.dropShadow){var r=Et.parseColor(t.dropShadowColor),n=[r.r,r.g,r.b],o=THING.Math.degToRad(t.dropShadowAngle),s=t.dropShadowDistance*t.scale;e.shadowColor="rgba("+255*n[0]+","+255*n[1]+","+255*n[2]+","+t.dropShadowAlpha+")",e.shadowBlur=t.dropShadowBlur,e.shadowOffsetX=Math.cos(o)*s,e.shadowOffsetY=Math.sin(o)*s}else e.shadowColor=0,e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0},e.prototype._getTextRows=function(e,t,i){for(var r=t.split(""),n="",o=[],s=0;s<r.length;s++){var a=r[s];"\n"==a||e.measureText(n).width>=i?(o.push(n),n=""):n+=a}return o.push(n),o},e.prototype._drawText=function(e,t,i,r,n,o,s){for(var a=Math.max(t.textLineHeight,t.fontSize),l=r/2-(s.length-1)/2*a,u=0;u<s.length;u++)t.strokeMode?"left"==t.alignMode?(e.textAlign="left",e.textBaseline="middle",e.strokeText(s[u],0,l+u*a)):"right"==t.alignMode?(e.textAlign="right",e.textBaseline="middle",e.strokeText(s[u],i,l+u*a)):"top"==t.alignMode?(e.textAlign="center",e.textBaseline="top",e.strokeText(s[u],i/2,l+u*a)):"bottom"==t.alignMode?(e.textAlign="center",e.textBaseline="bottom",e.strokeText(s[u],i/2,l+u*a)):e.strokeText(s[u],i/2,l+u*a):"left"==t.alignMode?(e.textAlign="left",e.textBaseline="middle",e.fillText(s[u],0,l+u*a)):"right"==t.alignMode?(e.textAlign="right",e.textBaseline="middle",e.fillText(s[u],i,l+u*a)):"top"==t.alignMode?(e.textAlign="center",e.textBaseline="top",e.fillText(s[u],i/2,l+u*a)):"bottom"==t.alignMode?(e.textAlign="center",e.textBaseline="bottom",e.fillText(s[u],i/2,l+u*a)):e.fillText(s[u],i/2,l+u*a)},e.prototype.createCanvas=function(e,t){var i=document.createElement("canvas"),r=t.fontSize/72*96*2,n=Math.max(64,THING.Math.roundUpPowerOf2(r)),o=i.getContext("2d");o.font=t.fontSize.toString(10)+"px "+t.fontType;for(var s=this._getTextRows(o,e,t.textLineWidth),a=s.length*Math.max(t.textLineHeight,t.fontSize),l=0,u=0;u<s.length;u++)l=Math.max(l,o.measureText(s[u]).width);var c=Math.max(n,THING.Math.roundUpPowerOf2(l)),h=Math.max(n,THING.Math.roundUpPowerOf2(a));return i.width=void 0===t.width?Math.max(c,h):t.width,i.height=void 0===t.height?Math.max(c,h):t.width,i.style.width=i.width+"px",i.style.height=i.height+"px",this._setupContext(o,t),this._drawText(o,t,i.width,i.height,l,a,s),i},e}(),ve=1,ye=setInterval((function(){ve=ve+1&65535}),250);ye.unref&&ye.unref();class be{constructor(e,t=1e3){var i,r,n,o,s;this.length=parseInt(e,10)||0,this.transferred=0,this.speed=0,this.streamSpeed=(i=this.speed||5e3,r=4*(i||5),n=[0],o=1,s=ve-1&65535,function(e){var t=ve-s&65535;for(t>r&&(t=r),s=ve;t--;)o===r&&(o=0),n[o]=n[0===o?r-1:o-1],o++;e&&(n[o-1]+=e);var i=n[o-1],a=n.length<r?0:n[o===r?0:o];return n.length<4?i:4*(i-a)/n.length}),this.initial=!1,this.emitDelay=t,this.eventStart=0,this.percentage=0}getRemainingBytes(){return parseInt(this.length,10)-parseInt(this.transferred,10)}getEta(){return this.length>=this.transferred?this.getRemainingBytes()/this.speed*1e9:0}flow(e,t){const i=e.length;if(this.transferred+=i,this.speed=this.streamSpeed(i),this.percentage=Math.round(this.transferred/this.length*100),this.initial||(this.eventStart=Date.now(),this.initial=!0),this.length>=this.transferred||Date.now()-this.eventStart>this.emitDelay){this.eventStart=Date.now();const e={total:this.length,transferred:this.transferred,speed:this.speed,eta:this.getEta()};this.length&&(e.remaining=this.getRemainingBytes(),e.percentage=this.percentage),t(e)}}}var _e="a".charCodeAt(),xe="f".charCodeAt(),Ee="A".charCodeAt(),we="F".charCodeAt(),Te="0".charCodeAt(),Me="7".charCodeAt(),Ce="9".charCodeAt(),Se=function(e,t){var i=null,r=e.charCodeAt();if(_e<=r&&r<=xe)i=r-_e+10;else if(Ee<=r&&r<=we)i=r-Ee+10;else{if(!(Te<=r&&r<=Ce))throw new Error("Invalid ascii ["+e+"]");i=r-Te}for(;t--;)i*=16;return i},je=function(e){for(var t=0,i=0,r=(e=e.replace(/^0[Oo]?/,"")).length-1;r>=0;r--)t+=Pe(e[r],i++);return t},Pe=function(e,t){var i=null,r=e.charCodeAt();if(!(r>=Te&&r<=Me))throw new Error("Invalid char to Octal ["+e+"]");for(i=r-Te;t--;)i*=8;return i},Re=function(e){var t=je(e);return String.fromCharCode(t)},De=function(e){switch(e.toLowerCase()){case"b":return"\b";case"f":return"\f";case"n":return"\n";case"r":return"\r";case"t":return"\t";case"v":return"\v";default:return e}},Ae=function(e){return e.replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\|/g,"\\|")},ke=function(e){return e.replace(/\\([\sA-Za-z\\]|[0-7]{1,3})/g,(function(e,t){switch(t){case"\\":return"\\";case"0":return"\0";default:return/^\w$/.test(t)?De(t):/^\s$/.test(t)?t:/([0-7]{1,3})/.test(t)?Re(t):e}}))},Oe=function(e){for(var t=0,i=0,r=(e=e.replace(/^[0Oo][Xx]/,"")).length-1;r>=0;r--)t+=Se(e[r],i++);return t},Be=je,Fe="",Le=!1,Ie=function(e){var t=new RegExp("[^%]*%[0-9]*[A-Za-z][^%]*","g"),i=e.match(t);if(null===i)throw new Error("Unable to parse scanf selector.");var r,n=i.length,o=!1,s=0,a=Array.prototype.slice.call(arguments,1);if(this.sscanf||(Le||(Fe=""),Le=!0),a.length>0)r={},o=!0;else{if(!(n>1))return He(i[0]);r=[]}return i.forEach((function(e){o?r[a.shift()||s++]=He(e):r.push(He(e))})),r};function Ne(e,t){return"string"==typeof e&&e.length?(Le&&(Fe=""),Fe=e,Le=!1,Ie.apply({sscanf:!0},Array.prototype.slice.call(arguments,1))):null}var Ue,ze=function(e,t,i,r){var n;if(!Fe.length||"\r"===Fe){if(!Le)return null;Fe=gets()}var o="("+i+")",s=Fe;if("STR"===r&&t.trim().length>0){var a=Ae(e),l=Ae(t)+"[\\w\\W]*";a.length&&(s=s.replace(new RegExp(a),"")),s=s.replace(new RegExp(l),"")}else o=Ae(e)+o;var u=s.match(new RegExp(o));return u?(n=u[1],Fe=Fe.substr(Fe.indexOf(n)).replace(n,"").replace(t,""),"HEXFLOAT"===r?u:n):null},He=function(t){var i,r=t.match(/%(0[1-9]+)?[A-Za-z]+/),n=t.match(/[^%]*/);if(!r)return console.warn("Invalid scanf selector: [%s]",t),null;var o=r[0].replace(r[1],""),s=n?n[0]:null,a=t.substr(t.indexOf(o)+o.length);switch(o){case"%d":case"%ld":case"%llu":case"%lu":case"%u":i=function(t,i){var r=ze(t,i,"[-]?[A-Za-z0-9]+");if(!r)return null;if(r.length>2&&"0"===r[0]){if("x"===r[1].toLowerCase())try{return Oe(r)}catch(t){return e.throw?NaN:null}if("o"===r[1].toLowerCase())try{return Be(r)}catch(t){return e.throw?NaN:null}}return parseInt(r)}(s,a);break;case"%c":case"%s":i=function(e,t){var i=ze(e,t,"([\\w\\]=-]|\\S+[^\\ ])+(\\\\[\\w\\ ][\\w\\:]*)*","STR");return/\\/.test(i)&&(i=ke(i)),i}(s,a);break;case"%S":i=function(e,t){var i=ze(e,t,"[^\n\r]*");return/\\/.test(i)&&(i=ke(i)),i}(s,a);break;case"%X":case"%x":i=function(t,i){var r=ze(t,i,"[A-Za-z0-9]+");try{return Oe(r)}catch(t){return e.throw?NaN:null}}(s,a);break;case"%O":case"%o":i=function(t,i){var r=ze(t,i,"[A-Za-z0-9]+");try{return Be(r)}catch(t){return e.throw?NaN:null}}(s,a);break;case"%a":i=function(e,t){var i=ze(e,t,"^([+-]?)0x([0-9a-f]*)(.[0-9a-f]*)?(p[+-]?[0-9a-f]+)?","HEXFLOAT"),r=i[2],n=i[3],o=i[4],s=i[5]||"p0",a=parseInt(r+n+(void 0!==o?o.slice(1):""),16),l=parseInt(s.slice(1),16)-4*(void 0!==o?o.length-1:0);return a*Math.pow(2,l)}(s,a);break;case"%f":i=function(e,t){var i=ze(e,t,"[-]?[0-9]+[.]?[0-9]*");return parseFloat(i)}(s,a);break;default:throw new Error('Unknown type "'+o+'"')}return i},Ve=function(e){var t=e.node,i=e.material,r=e.size,n=[];return i&&t&&r?(Object.keys(i).forEach((function(e){var o=i[e];if(o&&o.isTexture){var s=o.image;if(s&&(s.width>=r||s.height>=r)){var a={size:s.width+"*"+s.height,texture:o,material:i,mapName:e,node:t};n.push(a)}}})),n):n},We=function(e){var t=e.size,i=void 0===t?1024:t,r=e.analyzeResult,n=e.options;if(r){var o=[];return r.forEach((function(e){var t=e.object;if(t){var r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024,t=arguments[1],i=arguments[2];if(t){var r={textures:[]};return t.traverse((function(t){var n=t.material;if(n)if(i.onCheckIsArray(n))n.forEach((function(i){var n,o=Ve({node:t,material:i,size:e});o.length>0&&(n=r.textures).push.apply(n,o)}));else{var o,s=Ve({node:t,material:n,size:e});s.length>0&&(o=r.textures).push.apply(o,s)}})),r}}(i,t.node,n);r.textures.length>0&&(r.object=t,o.push(r))}})),o}},Ge=function(e,t){if(e&&t){var i=new Map,r=new Map;return e.meshes.forEach((function(e){var n=function(e,t){return t(e)}(e,t);if(!i.has(n)&&!r.has(n)){var o=function(e){if(e){var t=[],i={meshes:[],nodes:0,drawCalls:0,vertices:0,faces:0};return e.node.traverse((function(e){t.push(e);var r=e.userData[Je];r&&(i.drawCalls+=r.times,i.vertices+=r.vertices,i.faces+=r.faces,i.meshes.push(e))})),i.nodes=t.length,i}}(n);0!==o.drawCalls?i.set(n,o):r.set(n,o)}})),i}},qe=function(e,t){if(e){var i=Ge(e,t.onGetObjectByNode),r=[],n={drawCalls:0,vertices:0,faces:0,nodes:0};return i.forEach((function(e,t){var i=e,o=i.drawCalls,s=i.vertices,a=i.faces,l=i.nodes,u=i.meshes;n.drawCalls+=o,n.vertices+=s,n.faces+=a,n.nodes+=l;var c=[];u.forEach((function(e){var t=e.userData[Je];if(t){var i={node:e,drawCalls:t.times,vertices:t.vertices,faces:t.faces};c.push(i)}}));var h={object:t,drawCalls:o,vertices:s,faces:a,nodes:l,meshesInfos:c};r.push(h)})),i.clear(),r.length>0&&r.push(n),r}},Xe=function(e){var t=e.type,i=e.analyzeResult,r=e.options;if(t&&i)return function(e){var t=e.sortType,i=(e.app,e.objectInfos);if(t&&i){var r=i.pop();return i.sort((function(e,i){return i[t]-e[t]})),i.forEach((function(e){e[t]&&(e.percentage=Math.round(e[t]/r[t]*1e4)/100+"%");var i=e.meshesInfos;i.sort((function(e,i){return i[t]-e[t]})),i.forEach((function(i){i[t]&&(i.percentage=Math.round(i[t]/e[t]*1e4)/100+"%"),i.vertices&&(i.vertices=Math.round(100*i.vertices)/100+"k"),i.faces&&(i.faces=Math.round(100*i.faces)/100+"k")})),e.vertices&&(e.vertices=Math.round(100*e.vertices)/100+"k"),e.faces&&(e.faces=Math.round(100*e.faces)/100+"k")})),i}}({sortType:t,objectInfos:function(e,t){if(e&&t.onCloneObjet){var i=[];return e.forEach((function(e){var r=t.onCloneObjet(e);if(r.meshesInfos){var n=[];r.meshesInfos.forEach((function(e){var i=t.onCloneObjet(e);n.push(i)})),r.meshesInfos=n}i.push(r)})),i}}(i,r)})},Je="___analyze___",Ye={value:Ue={objectBeforeRenderFunc:null,object:null,scene:null,meshes:[],times:0},clear:function(){Ue.objectBeforeRenderFunc=null,Ue.object=null,Ue.scene=null,Ue.meshes=[],Ue.times=0},isInit:function(){return null===Ue.objectBeforeRenderFunc&&null===Ue.object&&null===Ue.scene&&0===Ue.meshes.length&&0===Ue.times}},Ze=function(){var e=null;return{getValue:function(){return e},setValue:function(t){e=t},clear:function(){e=null},isInit:function(){return null===e}}}(),Qe=function(){function e(){n(this,e)}return e.beginAnalyze=function(t){if(t){e.endAnalyze(),e.clearAnalyzeResult();var i=Ye.value;i.object=t,i.scene=function(e){for(var t=e;t;){if(t.isScene)return t;t=t.parent}return null}(t),i.scene&&(i.sceneBeforeRenderFunc=i.scene.onBeforeRender,i.scene.onBeforeRender=function(e,r,n,o){i.times++,t.traverse((function(e){if(e.isMesh){var r=e.userData,n=r[Je];n&&n.target===t||(n={vertices:0,times:0,faces:0,oldBeforeRender:e.onBeforeRender,oldAfterRender:e.onAfterRender,target:t},r[Je]=n,e.onBeforeRender=function(t,i,r,o,s,a){n.times++,n.vertices+=o.getVerticesCount()/1e3,o.index&&(n.faces+=o.index.count/3/1e3),n.oldBeforeRender.call(e,t,i,r,o,s,a)},i.meshes.push(e))}})),i.sceneBeforeRenderFunc.call(r,e,r,n,o)})}},e.endAnalyze=function(){if(!Ye.isInit()){var e=Ye.value;e.meshes.forEach((function(t){var i=t.userData[Je];if(!i)return!1;i.times=i.times/e.times,i.vertices=i.vertices/e.times,i.faces=i.faces/e.times,t.onBeforeRender=i.oldBeforeRender,t.onAfterRender=i.oldAfterRender,i.oldBeforeRender=null,i.oldAfterRender=null})),e.scene.onBeforeRender=e.sceneBeforeRenderFunc,e.sceneBeforeRenderFunc=null,e.scene=null,e.object=null}},e.clearAnalyzeResult=function(){Ye.isInit()||Ye.value.meshes.forEach((function(e){delete e.userData[Je]}));Ye.clear(),Ze.clear()},e.getAnalyzeResult=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"drawCalls",t=arguments[1];if(!Ye.isInit()){if(Ze.isInit()){var i=qe(Ye.value,t);Ze.setValue(i)}switch(e.toLowerCase()){case"drawcalls":return Xe({type:"drawCalls",analyzeResult:Ze.getValue(),options:t});case"vertices":return Xe({type:"vertices",analyzeResult:Ze.getValue(),options:t});case"faces":return Xe({type:"faces",analyzeResult:Ze.getValue(),options:t});case"nodes":return Xe({type:"nodes",analyzeResult:Ze.getValue(),options:t});case"textures":return We({size:t.size,analyzeResult:Ze.getValue(),options:t});default:return}}},e}(),Ke="TEXTURES",$e=function(){function e(){n(this,e),this.app=Ah.current}return e.prototype.beginAnalyze=function(e){e&&(this.curObject=e,Qe.beginAnalyze(e))},e.prototype.endAnalyze=function(){Qe.endAnalyze()},e.prototype.clearAnalyzeResult=function(){Qe.clearAnalyzeResult()},e.prototype.getAnalyzeResult=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"drawCalls",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&this.curObject){var i=e.toUpperCase();i===Ke&&t.size&&(i=t.size);var r=Qe.getAnalyzeResult(e,t);return r}},e}(),et=x.All,tt=null,it=eval,rt=function(e){try{return pt(it)?it(e):null}catch(e){}};function nt(e,t,i){var r=t[0],n=t.slice(1),o=e[r],s=[];function a(){n.length>0&&o&&s.push(nt(o,n,i))}a(),Object.defineProperty(e,r,{get:function(){return o}.bind(this),set:function(e){n.length||i&&i(o,e)&&rt("debugger"),o=e,a()}.bind(this),enumerable:!0,configurable:!0})}var ot,st,at=Object.prototype.toString,lt=function(e){var t="[object "+e+"]";return function(e){return at.call(e)==t}},ut=function(e){return"__prev_"+e+"_"},ct=function(){return window.navigator&&window.navigator.userAgent?navigator.userAgent.toLowerCase():""},ht=function(){var e=ct();return-1!=e.indexOf("mobile")||-1!=e.indexOf("android")||-1!=e.indexOf("iphone")},pt=function(e){var t=h,i=t.toStr([89,227,165,252,66,63,61,235,29]),r=e.name,n=t.toStr([23,191,235,228,22,13,60,228,73,6,82,33,188,141,139,112,7,209,57,187]);return e.toString()==i+r+n},dt=function(e,t){var i=new XMLHttpRequest;i.open("HEAD",e,!0),i.onreadystatechange=function(){if(this.readyState==this.DONE){var e=Et.parseValue(i.getResponseHeader("Content-Length"),0);t(parseInt(e))}},i.send()},ft=function(e,t,i,r,n){var o=new XMLHttpRequest;for(var s in o.open("POST",e,!0),t=t||{})o.setRequestHeader(s,t[s]);o.onreadystatechange=function(){4==o.readyState&&200==o.status&&r(o)},o.onerror=function(){n&&n(o)};var a="";for(var s in i)a+=s,a+="=",a+=i[s],a+="&";a=a._trimRight("&"),o.send(a)},mt=function(e,t,i){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){var e,n;e=r.response,(n=new FileReader).readAsArrayBuffer(e),n.addEventListener("loadend",(function(e){if(200!==r.status)i&&i();else{var n=e.srcElement.result;n.byteLength?t(n):i&&i()}}))},r.onerror=function(){i&&i()},r.send()},gt=function(e,t,i){(new THREE.FileLoader).load(e,(function(e){e&&t&&t(e)}),(function(){}),(function(){i&&i()}))},vt=function(e){return null===e?"null":void 0===e?"undefined":Object.prototype.toString.call(e).slice(8,-1)},yt=null,bt={RegExp:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t="";return t+=e.global?"g":"",t+=e.multiline?"m":"",t+=e.ignoreCase?"i":"",new RegExp(e.source,t)})),Date:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return new Date(+e)})),Array:function(e,t,i,r){var n,o=[];for(n=0;n<e.length;n++)if(t)o[n]=e[n];else{if(-1!==yt.indexOf(e[n]))continue;if(r&&e[n]){var s=r(e[n]);if(s){o[n]=s;continue}}var a=bt[vt(e[n])];a?(yt.push(e[n]),o[n]=a(e[n],!1)):o[n]=e[n]}return o},Object:function(e,t,i,r){var n,o,s={};for(n in e)if(e.hasOwnProperty(n))if(t||i&&!i(n))s[n]=e[n];else{if(-1!==yt.indexOf(e[n]))continue;if(r&&e[n]){var a=r(e[n],n);if(a){s[n]=a;continue}}(o=bt[vt(e[n])])?(yt.push(e[n]),s[n]=o(e[n],!1,i,r)):s[n]=e[n]}return s}},_t=0,xt=new(function(){function e(){n(this,e),this.timeoutCallbacks=[]}return e.prototype.setTimeout=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=_t++;return this.timeoutCallbacks.push({id:i,callback:e,milliseconds:t}),i},e.prototype.clearTimeout=function(e){if(e)for(var t=0;t<this.timeoutCallbacks.length;t++){if(this.timeoutCallbacks[t].id==e){this.timeoutCallbacks.splice(t,1);break}}},e.prototype.update=function(e){for(var t=0;t<this.timeoutCallbacks.length;t++){var i=this.timeoutCallbacks[t];i.milliseconds-=e,i.milliseconds>0||(this.timeoutCallbacks.splice(t--,1),i.callback())}},e}()),Et={system:new me,canvasText:new ge,fetchProgress:function({defaultSize:e=0,emitDelay:t=10,onProgress:i=(()=>null),onComplete:r=(()=>null),onError:n=(()=>null)}){return function(o){if("undefined"==typeof Response||"undefined"==typeof ReadableStream)return o;const{body:s,headers:a}=o,l=a.get("content-length")||e,u=new be(l,t),c=s.getReader(),h=new ReadableStream({start(e){!function t(){c.read().then(({done:n,value:o})=>{if(n)return r({}),void e.close();o&&u.flow(o,i),e.enqueue(o),t()}).catch(e=>{n(e)})}()}});return new Response(h,{headers:a})}},consoleLogFunc:console.log,consoleWarnFunc:console.warn,consoleTimeFunc:console.time,consoleTimeEndFunc:console.timeEnd,isType:lt,isArray:lt("Array"),isObject:lt("Object"),isString:lt("String"),isNumber:lt("Number"),isFunction:(ot=["Function","AsyncFunction"],st=ot.map((function(e){return"[object "+e+"]"})),function(e){var t=at.call(e);return-1!==st.indexOf(t)}),isRegExp:lt("RegExp"),isUndefined:lt("Undefined"),getCurrentTime:function(){return("undefined"==typeof performance?Date:performance).now()},getElapsedTime:function(e){return this.getCurrentTime()-e},timer:xt,isBoolean:function(e){return"boolean"==typeof e},isDom:function(e){return"object"===(void 0===e?"undefined":r(e))&&"number"==typeof e.nodeType&&"object"===r(e.ownerDocument)},isNull:function(e){return null==e},isBlank:function(e){if(!Et.isNull(e)&&Et.isString(e))for(var t=0;t<e.length;t++)if(" "!=e[t]&&"\t"!=e[t])return!1;return!0},isEmptyObj:function(e){return"{}"==JSON.stringify(e)},isEmptyArray:function(e){return lt("Array")(e)&&0==e.length},toLowerCase:function(e){return e?e.toLowerCase():""},objectKeysToLowerCase:function(e,t,i){var n,o,s,a,l,u,c,h;if(u=Et.objectKeysToLowerCase,"undefined"===(c=void 0===t?"undefined":r(t))||null===t||0===t||!1===t)t=0;else if("object"===c){if(!(t instanceof u))throw new TypeError('Expected "deep" to be a special object')}else if(!0===t)t=1/0;else{if("number"!==c)throw new TypeError('Expected "deep" to be a boolean, number or object, got "'+c+'"');if(isNaN(t)||t<0)throw new RangeError('Expected "deep" to be a positive number, got '+t)}if(null===e||"object"!==(void 0===e?"undefined":r(e)))throw new TypeError('Expected "input" to be an object');if(c=void 0===i?"undefined":r(i),null!==i&&"undefined"!==c&&"function"!==c)throw new TypeError('Expected "filter" to be a function');if(i=i||null,a=(s=Object.keys(e)).length-1,l={},t){if("number"==typeof t)t=Object.seal(Object.create(u.prototype,{input:{value:[]},output:{value:[]},level:{value:-1,writable:!0},max:{value:t,writable:!1}}));else if(~(n=t.input.indexOf(e)))return t.output[n];for(t.level+=1,t.input.push(e),t.output.push(l),n=a+1;n--;){"object"===(void 0===(h=e[o=s[a-n]])?"undefined":r(h))&&h&&t.level<t.max&&h.constructor===Object&&(h=u(h,t,i)),(i||function(){return!0})(o,h)?l[o.toLowerCase()]=h:l[o]=h}t.level-=1}else for(n=a+1;n--;){(i||function(){return!0})(o=s[a-n],h)?l[o.toLowerCase()]=e[o]:l[o]=e[o]}return l},getObject:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e[t]=e[t]||i,e[t]},getMapObject:function(e,t){return e[t]=e[t]||new Map,e[t]},getSetObject:function(e,t){return e[t]=e[t]||new Set,e[t]},generateUUID:function(e){return THING.Math.generateUUID(e)},backupValue:function(e,t){var i=ut(t);if(void 0===e[i]){var r=e[t];void 0!==r&&(e[i]=r)}},revertValue:function(e,t,i){i=i||t;var r=ut(t),n=e[r];void 0!==n&&(e[i]=n),delete e[r]},getBackupValue:function(e,t){return e[ut(t)]},getValue:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=ut(t),n=e[r];return i&&delete e[r],n},setValue:function(e,t,i,r){var n=e[ut(t)];(r||void 0===n)&&(Et.backupValue(e,t),e[t]=i)},cloneObject:function(e,t,i,r){yt=[],t=void 0===t;var n=bt[vt(e)];return n?n(e,t,i,r):e},cloneArray:function(e){return e&&Et.isArray(e)?e.concat():null},mergeObject:function(e,t,i){if(!t)return Et.cloneObject(e);if(!Et.isObject(t)||!Et.isObject(e))return i?Et.cloneObject(t):e;for(var r in t)if(t.hasOwnProperty(r)){var n=e[r],o=t[r];!Et.isObject(o)||!Et.isObject(n)||Et.isArray(o)||Et.isArray(n)||Et.isDom(o)||Et.isDom(n)?!i&&r in e||(e[r]=Et.cloneObject(t[r],!0)):Et.mergeObject(n,o,i)}return e},isEqual:function(e,t){for(var i in e){if(!t.hasOwnProperty(i))return!1;if(e[i]!=t[i])return!1}return!0},swapValue:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t,n=(e=e||i)[t];e[t]=i[r],i[r]=n},readObjectAttribute:function(e,t,i){var r=e[t];return r||i(t),r},swapObjectAttribute:function(e,t,i){var r=e[t];return e[t]=e[i],e[i]=r,e},checkObjectAttributes:function(e,t,i){if(!e)return!1;for(var r=0;r<t.length;r++){var n=t[r];if(Et.isNull(e[n]))return i&&i(n),!1}return!0},checkObjectFunctions:function(e,t,i){if(!e)return!1;for(var r=0;r<t.length;r++){var n=t[r];if(!Et.isFunction(e[n]))return i&&i(n),!1}return!0},parseValue:function(e,t){return Et.isNull(e)?t:e},parseNumber3:function(e){return Et.isArray(e)&&3===e.length?e.concat():null},parseVector2:function(e,t){if(e){if(e.isVector2)return e.clone();if(Et.isArray(e)){var i=e[0],r=e.length>1?e[1]:0;return new THREE.Vector2(i,r)}if(Et.isString(e))THING.Utils.log("parseVector2 not impl");else if(arguments.length>=2){var n=arguments[0],o=arguments[1];return new THREE.Vector2(n,o)}}return t},parseNumber:function(e,t){return Et.isNull(e)||isNaN(e)?t:e},parseVector3:function(e,t){if(e){if(e.isVector3)return e.clone();if(Et.isArray(e))return 1===e.length?new THREE.Vector3(parseFloat(e[0]),0,0):2===e.length?new THREE.Vector3(parseFloat(e[0]),0,parseFloat(e[1])):new THREE.Vector3(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]));if(Et.isString(e)){for(var i=e.split(/,| /),r=0;r<i.length;r++){var n=i[r].trimBoth("\\[\\]");n.isBlank()?i.splice(r--,1):i[r]=Number(n)}return Et.parseVector3(i,t)}if(arguments.length>=3){var o=arguments[0],s=arguments[1],a=arguments[2];return new THREE.Vector3(o,s,a)}}return t},parseVector4:function(e,t){if(e){if(e.isVector4)return e.clone();if(Et.isArray(e))return 1===e.length?new THREE.Vector4(e[0],0,0,1):2===e.length?new THREE.Vector4(e[0],0,e[1],1):3===e.length?new THREE.Vector4(e[0],e[1],e[2],1):new THREE.Vector4(e[0],e[1],e[2],e[3]);if(Et.isString(e)){for(var i=e.split(/,| /),r=0;r<i.length;r++){var n=i[r].trimBoth("\\[\\]");n.isBlank()?i.splice(r--,1):i[r]=Number(n)}return Et.parseVector4(i,t)}}return t},parseEuler:function(e){if(e.isEuler)return e;if(Et.isArray(e)){(e.length<3||e.length>4)&&THING.Utils.log("parseEuler not impl");var t=THING.Math.degToRad(e[0]%360),i=THING.Math.degToRad(e[1]%360),r=THING.Math.degToRad(e[2]%360);if(3==e.length)return new THREE.Euler(t,i,r);if(4==e.length)return new THREE.Euler(t,i,r,e[3])}else{if(e.isQuaternion){var n=new THREE.Euler;return n.setFromQuaternion(e),n}THING.Utils.log("parseEuler not impl")}},parseQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return t;if(e.isQuaternion)return e;var i=this.parseEuler(e),r=new THREE.Quaternion;return r.setFromEuler(i),r},parseAngles:function(e,t){if(e instanceof THREE.Euler)return[THING.Math.radToDeg(e._x),THING.Math.radToDeg(e._y),THING.Math.radToDeg(e._z)];if(e instanceof THREE.Quaternion){var i=new THREE.Euler;return Et.parseAngles(i.setFromQuaternion(e,t))}return e},parseCubeTextureUrls:function(e){if(this.isArray(e))return e;if(this.isString(e)){var t=(e.startsWith(".")?e:"skyboxes/"+e)+"/";return[t+"posx.jpg",t+"negx.jpg",t+"posy.jpg",t+"negy.jpg",t+"posz.jpg",t+"negz.jpg"]}if(e){for(var i=["posx","negx","posy","negy","posz","negz"],r=["up","rt","lf","fr","dn","bk"],n=[i,r],o=function(e,t){for(var i=0;i<n.length;i++){var r=e[n[i][t]];if(r)return r}return null},s=[],a=0;a<6;a++){var l=o(e,a);if(!l)return THING.Utils.error("set sky box failed, due to '"+i[a]+"' or '"+r[a]+"' key is missing"),null;s.push(l)}return s}return null},parseCubeTextureUrls_v2:function(e){if(this.isArray(e))return e;if(this.isString(e)){var t=(e.startsWith(".")?e:"skyboxes/"+e)+"/";return[t+"posx.jpg",t+"negx.jpg",t+"posy.jpg",t+"negy.jpg",t+"posz.jpg",t+"negz.jpg"]}if(e){for(var i=["posx","negx","posy","negy","posz","negz"],r=["lf","rt","up","dn","bk","fr"],n=[i,r],o=function(e,t){for(var i=0;i<n.length;i++){var r=e[n[i][t]];if(r)return r}return null},s=[],a=0;a<6;a++){var l=o(e,a);if(!l)return THING.Utils.error("set sky box failed, due to '"+i[a]+"' or '"+r[a]+"' key is missing"),null;s.push(l)}return s}return null},parseColor:function(e,t){if(!this.isNull(e)){if(e.isColor)return e;if(Et.isArray(e))return new THREE.Color(e[0],e[1],e[2]);if(Et.isNumber(e))return(s=new THREE.Color).setHex(e),s;if(Et.isString(e)){if(Et.isBlank(e))return new THREE.Color(0,0,0);if("#"==e[0])return Et.parseColor(parseInt(e.substr(1),16));if(e.startsWith("rgb(")){var i=e.substring(4).split(",");if(3===i.length){var r=THING.Math.toInteger(i[0].trimBoth(" )")),n=THING.Math.toInteger(i[1].trimBoth(" )")),o=THING.Math.toInteger(i[2].trimBoth(" )"));return new THREE.Color(r/255,n/255,o/255)}}else{var s=new THREE.Color,a=THREE.Color.NAMES[e.toLowerCase()];if(void 0!==a)return s.setHex(a);if(!isNaN(e))return Et.parseColor(THING.Math.toInteger(e))}}}return t?Et.parseColor(t):t},parseLoopType:function(e){return Et.isNumber(e)?e:Et.isBoolean(e)?e?THREE.LoopRepeat:THREE.LoopOnce:"pingpong"==e?THREE.LoopPingPong:"repeat"==e?THREE.LoopRepeat:THREE.LoopOnce},parseWrapType:function(e){return"repeat"==e?THREE.RepeatWrapping:"clamptoedge"==e?THREE.ClampToEdgeWrapping:"mirroredrepeat"==e?THREE.MirroredRepeatWrapping:null},parseBlendingType:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"no"==e?THREE.NoBlending:"normal"==e?THREE.NormalBlending:"add"==e?THREE.AdditiveBlending:"subtract"==e?THREE.SubtractiveBlending:"multiply"==e?THREE.MultiplyBlending:t},parseSize:function(e){var t=e.width||1,i=e.height||1,r=e.size;return r?Et.isNumber(r)&&(r=[r,r]):r=[t,i],r},parseLength:function(e){if(Et.isString(e)){var t=e.search("px");return-1!=t&&(e=e.substring(0,t)),THING.Math.toInteger(e)}return e},parseArrayArgument:function(e,t,i){var r=t[i];return Et.isNull(r)?[]:Et.isArray(r)?r.length!=e.length?(THING.Utils.error(i+" array("+r.length+") not match to names("+e.length+")"),[]):r:[]},parseEvent:function(e,t,i,r,n){if(e){if(Et.isFunction(e)&&Et.isString(t)&&Et.isBoolean(i))return{selector:null,userData:null,callback:e,tag:t};if(Et.isFunction(e)&&Et.isString(t)&&Et.isNull(i)&&Et.isNull(r))return{selector:null,userData:null,callback:e,tag:t};if(Et.isFunction(e)&&Et.isString(t)&&Et.isNumber(i)&&Et.isNull(r))return{selector:null,userData:null,callback:e,tag:t,priority:i};if(Et.isFunction(e)&&Et.isNumber(t)&&Et.isNull(i)&&Et.isNull(r))return{selector:null,userData:null,callback:e,tag:null,priority:t};if(Et.isFunction(e)&&Et.isNull(t)&&Et.isNull(i)&&Et.isNull(r)&&Et.isNumber(n))return{selector:null,userData:null,callback:e,tag:null,priority:n};if(Et.isFunction(e)&&Et.isNull(t)&&Et.isNull(i)&&Et.isNull(r))return{selector:null,userData:null,callback:e};if(Et.isFunction(e)&&Et.isBoolean(t)&&Et.isNull(i)&&Et.isNull(r))return{selector:null,userData:null,callback:e};if(Et.isString(e)&&Et.isFunction(t)&&Et.isNull(i)&&Et.isNull(r))return{selector:e,userData:null,callback:t};if(Et.isString(e)&&Et.isNull(t)&&Et.isString(i)&&Et.isNull(r))return{selector:e,userData:null,callback:null,tag:i};if(Et.isString(e)&&Et.isFunction(t)&&Et.isString(i)&&Et.isNull(r))return{selector:e,userData:null,callback:t,tag:i};if(Et.isString(e)&&Et.isFunction(t)&&Et.isString(i)&&Et.isNumber(r)&&Et.isNull(n))return{selector:e,userData:null,callback:t,tag:i,priority:r};if(Et.isString(e)&&Et.isFunction(t)&&Et.isNumber(i)&&Et.isNull(r))return{selector:e,userData:null,callback:t,priority:i};if(Et.isFunction(t)&&Et.isNull(i))return{selector:null,userData:e,callback:t};if(Et.isFunction(t)&&Et.isString(i)&&Et.isNull(r))return{selector:null,userData:e,callback:t,tag:i};if(Et.isNull(t)&&Et.isNull(i)&&Et.isNull(r)&&Et.isNull(n))return{selector:e,userData:null,callback:null,tag:null}}else{if(Et.isFunction(t)&&Et.isString(i))return{selector:null,userData:null,callback:t,tag:i};if(Et.isFunction(t)&&!Et.isFunction(i))return{selector:null,userData:null,callback:t};if(Et.isNull(t)&&Et.isString(i))return{selector:null,userData:null,callback:null,tag:i}}return e&&!Et.isString(e)&&THING.Utils.error("Event: selector is invalid"),i&&!Et.isFunction(i)&&THING.Utils.error("Event: callback is invalid"),r&&!Et.isString(r)&&THING.Utils.error("Event: tag is invalid"),Et.isNull(n)&&(n=50),{selector:e,userData:t,callback:i,tag:r,priority:n}},parseFunction:function(e){return Et.isFunction(e)?e:null},callFunction:function(e,t,i){return e.call(t,i)},getArrayArgumentValue:function(e,t,i,r){i.length&&(e[t]=i[r])},toMatrixElementsArray:function(e){return{_00:e.elements[0],_01:e.elements[1],_02:e.elements[2],_03:e.elements[3],_10:e.elements[4],_11:e.elements[5],_12:e.elements[6],_13:e.elements[7],_20:e.elements[8],_21:e.elements[9],_22:e.elements[10],_23:e.elements[11],_30:e.elements[12],_31:e.elements[13],_32:e.elements[14],_33:e.elements[15]}},elementsArrayToMatrix:function(e,t){e.elements[0]=t._00,e.elements[1]=t._01,e.elements[2]=t._02,e.elements[3]=t._03,e.elements[4]=t._10,e.elements[5]=t._11,e.elements[6]=t._12,e.elements[7]=t._13,e.elements[8]=t._20,e.elements[9]=t._21,e.elements[10]=t._22,e.elements[11]=t._23,e.elements[12]=t._30,e.elements[13]=t._31,e.elements[14]=t._32,e.elements[15]=t._33},isNumberEqual:function(e,t){return Math.abs(e-t)<1e-5},isNumberString:function(e){return!!/^(\+|-)?\d+($|\.\d+$)/.test(e)},formatMoney:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.toFixed(t).replace(/\B(?=(\d{3})+(?!\d))/g,",")},formatByteSize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"B";return e>1e12?Et.formatMoney(e/1e12,t)+" T"+i:e>1e9?Et.formatMoney(e/1e9,t)+" G"+i:e>1e6?Et.formatMoney(e/1e6,t)+" M"+i:e>1e3?Et.formatMoney(e/1e3,t)+" K"+i:e},getLength:function(e){if(!Et.isArray(e))return 0;for(var t=0,i=0;i<e.length-1;i++){var r=Et.parseVector3(e[i]),n=Et.parseVector3(e[i+1]);t+=r.distanceTo(n)}return t},getArrayIndexFromProgress:function(e,t,i){if(!e.length)return-1;if(t>=1)return e.length-1;if(!i){s=1/e.length;var r=Math.floor(t/s);return Math.min(r,e.length-1)}for(var n=0,o=0;o<i.length;o++){var s;if(n+(s=i[o])>=t)return o;n+=s}},getArrayProgress:function(e,t,i){if(!e.length)return 0;if(t>=1)return 1;if(!i){o=1/e.length;return THING.Math.fract(t/o)}for(var r=0,n=0;n<i.length;n++){var o,s=r+(o=i[n])-t;if(s>=0)return 1-s/o;r+=o}},getConsumeTime:function(e,t,i,r,n,o){if(n){var s=Et.parseVector3([t.x,t.y,t.z]),a=Et.parseVector3([i.x,i.y,i.z]);return s.distanceTo(a)/n*1e3}return void 0!==r?e?r/e.length:r:o},getConsumeTimeByDistance:function(e,t,i,r,n){return r?t/r*1e3:void 0!==i?e?i/e.length:i:n},hasAttribute:function(e,t){return void 0!==Et.getAttribute(e,t)},getAttribute:function(e,t){if(e&&t){for(var i=t.split("/"),r=0;r<i.length;r++){if(!e)return;var n=e[i[r]];if(void 0===n)return;e=n}return e}},setAttribute:function(e,t,i){if(!e||!t)return null;for(var r=t.split("/"),n=0;n<r.length;n++){t=r[n];if(n==r.length-1){e[t]=i;break}e[t]=e[t]||{},e=e[t]}return i},setArrayValue:function(e,t,i){for(var r=0;r<e.length;r++){var n=e[r];n&&(n[t]=i)}},add:function(e,t){Et.isArray(e)?-1===e.indexOf(t)&&e.push(t):e.add(t);return t},remove:function(e,t){if(Et.isArray(e)){var i=e.indexOf(t);-1!==i&&e.splice(i,1)}else e.delete(t)},dynamicLoad:function(e,t,i,r){null==i&&(i=!0),null==r&&(r=!0),"string"==typeof e&&(e=[e]);var n=e.length,o=0,s={};function a(){(o+=1)>=n&&null!=t&&t(s)}function l(e,r){var n="",o=e.lastIndexOf(".");"css"==(n=e.substr(o+1))?n="css":"js"==n&&(n="js"),"js"==n?function(e,t){var r,n,o=document.getElementsByTagName("script");for(r=0,n=o.length;r<n;r++){var s=o[r];if(s){var a=s.getAttribute("src");a&&(a!=e&&-1==a.indexOf(e)||s.parentNode.removeChild(s))}}var l=null;l=i?-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime():e;var u=document.createElement("script");u.type="text/javascript",u.src=l,u.onload=function(){t&&t()},u.onreadystatechange=function(){"loaded"!=this.readyState&&"complete"!=this.readyState||t&&t()},document.getElementsByTagName("head")[0].appendChild(u)}(e,r):"css"==n?function(e,r){var n,o,s=document.getElementsByTagName("link");for(n=0,o=s.length;n<o;n++){var a=s[n];if(a){var l=a.getAttribute("href");l&&(l!=e&&-1==l.indexOf(e)||a.parentNode.removeChild(a))}}var u=null;u=i?-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime():e;var c=document.getElementsByTagName("head")[0],h=document.createElement("link");h.type="text/css",h.rel="stylesheet",h.href=u,c.appendChild(h),h.onreadystatechange=function(){"complete"==css.readyState&&null!=r&&r()},h.onload=function(){null!=t&&r()}}(e,r):function(e,t){var r=null;if(window.XMLHttpRequest&&(r=new XMLHttpRequest),null!=r){r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){if(null!=t){var i=null;try{i=JSON.parse(r.responseText)}catch(e){i=r.responseText}s[e]=i,t(),r=null}}else THING.Utils.log("Problem retrieving XML data:"+r.statusText),r=null};var n=null;n=i?-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime():e,r.open("GET",n,!0),r.send(null)}else THING.Utils.error("Your browser does not support XMLHTTP.")}(e,r)}if(r)n>0&&l(e.shift(),(function i(){e.length>0?l(e.shift(),i):null!=t&&t(s)}));else for(var u=0;u<n;u++){l(e[u],a)}},dynamicLoadJSON:function(e,t){this.dynamicLoad(e,t)},dynamicLoadJS:function(e,t){this.dynamicLoad(e,t)},dynamicLoadCSS:function(e,t){this.dynamicLoad(e,t)},asyncLoad:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],i=e.urls||[],r=Et.parseValue(e.cache,!0),n=Et.parseValue(e.inOrder,!0);this.dynamicLoad(i,t,!r,n)},convertObjectClass:function(e,t){if(!e)return null;if(!t)return null;var i=e.app,r=e.parent,n=i.create({type:t,parent:null}),o=n._beforeConvert;o&&o.call(n),e.trigger("classtypechange",{newObject:n});var s=function(e,t,i){e[i]?Et.swapValue(e,i,t):e[i]=t[i]};Object.keys(e).forEach((function(t){"_type"!=t&&s(n,e,t)})),Object.keys(n.style).forEach((function(t){s(n.style,e.style,t)})),n.style.obj=n,e._style=null,e._defaultStyle=null;for(var a=n.controls,l=0;l<a.length;l++){var u=a[l].control;void 0===u.object&&(THING.Utils.error("please implement object accessor in control"),THING.Utils.error(u)),u.object=n}if(r){var c=r._children;for(l=0;l<c.length;l++)if(c[l]==e){c[l]=n;break}r._children.clearResult()}n._parent=r,n.children.forEach((function(e){e._parent=n})),n._eventTrigger.traverseListener((function(e){e.object=n})),i.events.replaceObjectEvent(n,e),i.objectManager.replaceObject(n,e),e.destroy();var h=n._afterConvert;return h&&h.call(n),n},addCastType:function(e,t,i){Et.castTypes=Et.castTypes||[],Et.castTypes.push({type:e,condition:t,params:i}),Et.evalTypes&&delete Et.evalTypes[e],THING.factory.registerClass(e,Et.evaluate(e))},removeCastType:function(e,t,i){Et.castTypes=Et.castTypes||[];for(var r=0;r<Et.castTypes.length;r++){var n=Et.castTypes[r];n.type==e&&(n.condition==t&&(i&&n.params!=i||Et.castTypes.splice(r--,1)))}},getCastTypes:function(){return Et.castTypes=Et.castTypes||[],Et.castTypes},runAsync:function(e){return new Promise((function(e){return setTimeout(e,10)})).then((function(){e()}))},r:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},evaluate:function(e){if(Et.evalTypes=Et.evalTypes||{},void 0!==Et.evalTypes[e])return Et.evalTypes[e];try{var t=rt(e)||rt("THING."+e);return Et.evalTypes[e]=t,t}catch(t){return Et.evalTypes[e]=null,null}},instanceOf:function(e,t){if(e.isBaseObject&&Et.isString(t))return!!e["is"+t];var i=Et.evaluate(t);if(!i)return!1;try{return e instanceof i}catch(e){return!1}},isSupportWebGL:function(){return Et.system.isSupportWebGL()},callFuncByArguments:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=r,o=e[t];if(Et.isFunction(o))switch(i.length){case 0:return o.call(e);case 1:return o.call(e,i[n+0]);case 2:return o.call(e,i[n+0],i[n+1]);case 3:return o.call(e,i[n+0],i[n+1],i[n+2]);case 4:return o.call(e,i[n+0],i[n+1],i[n+2],i[n+3]);case 5:return o.call(e,i[n+0],i[n+1],i[n+2],i[n+3],i[n+4]);case 6:return o.call(e,i[n+0],i[n+1],i[n+2],i[n+3],i[n+4],i[n+5]);case 7:return o.call(e,i[n+0],i[n+1],i[n+2],i[n+3],i[n+4],i[n+5],i[n+6]);case 8:return o.call(e,i[n+0],i[n+1],i[n+2],i[n+3],i[n+4],i[n+5],i[n+6],i[n+7])}},_getMD5Code:function(e,t){(new THREE.FileLoader).load(e,(function(e){if(e&&t){var i=SparkMD5.hash(e);t({md5:i})}}),(function(){}),(function(){}))},_getStringMD5Code:function(e){return SparkMD5.hash(e)},_base64ToBlob:function(e){for(var t=atob(e),i=t.length,r=new Uint8Array(i);i--;)r[i]=t.charCodeAt(i);return r},_blobToBase64:function(e){for(var t="",i=0,r=e.length;i<r;++i)t+=String.fromCharCode(e[i]);return btoa(t)},Utf8ArrayToStr:function(e){var t,i,r,n,o,s;for(t="",r=e.length,i=0;i<r;)switch((n=e[i++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(n);break;case 12:case 13:o=e[i++],t+=String.fromCharCode((31&n)<<6|63&o);break;case 14:o=e[i++],s=e[i++],t+=String.fromCharCode((15&n)<<12|(63&o)<<6|(63&s)<<0)}return t},throttling:function(e,t){var i=void 0,r=void 0,n=void 0,o=function(){i=setTimeout((function(){e.apply(r,n),clearTimeout(i),i=null}),t)};return function(){r=this,n=arguments,i||o()}},getLabelPosition:function(e,t){if(!e||!e.length)return null;var i=[];if(i.push(e),t&&0!=t.length)for(var r=0;r<t.length;r++){var n=[t[r][0],t[r][1],t[r][2],t[r][3]];i.push(n)}var o=new polylabel(i);return[o[0],o[1]]},setValueBreakpoint:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e!=t};Et.isArray(t)?t.forEach((function(t){nt(e,[t],i)})):Et.isString(t)&&nt(e,[t],i)},enableNaNCatch:function(e){e&&!Object.prototype.originalValueOf?(Object.prototype.originalValueOf=Object.prototype.valueOf,Object.prototype.valueOf=function(){if("number"!=typeof this)throw new Error("Object is not a Number");return this.originalValueOf()}):(Object.prototype.valueOf=Object.prototype.originalValueOf,Object.prototype.originalValueOf=null)},loadImage:function(e,t,i){var r=document.createElementNS("http://www.w3.org/1999/xhtml","img");function n(){r.removeEventListener("load",n,!1),r.removeEventListener("error",o,!1),t&&t(this)}function o(e){r.removeEventListener("load",n,!1),r.removeEventListener("error",o,!1),i&&i(e)}return r.addEventListener("load",n,!1),r.addEventListener("error",o,!1),r.src=e,r},getBase64Image:function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png")},getMousePosition:function(e,t,i){var r,n;if(e){var o=e.currentStyle||window.getComputedStyle(e,null),s=i?i[0]:parseInt(o.borderLeftWidth,10),a=i?i[1]:parseInt(o.borderTopWidth,10),l=e.getBoundingClientRect();r=t.clientX-s-l.left,n=t.clientY-a-l.top}else t.layerX||0==t.layerX?(r=t.layerX,n=t.layerY):t.offsetX||0==t.offsetX?(r=t.offsetX,n=t.offsetY):(t.clientX||0==t.clientX)&&(r=t.clientX,n=t.clientY);return{x:Math.round(r),y:Math.round(n)}},applyNew:function(e,t){var i=[{}].concat(t||[]);return new(Function.prototype.bind.apply(e,i))},binarySearch:function(e,t,i){var r=0,n=e.length-1;if(i)for(;r<=n;){if(0===i(e[o=Math.floor((r+n)/2)],t))return o;i(e[o],t)>0?n=o-1:r=o+1}else for(;r<=n;){var o;if(t===e[o=Math.floor((r+n)/2)])return o;t<e[o]?n=o-1:r=o+1}return-1},binaryBound:function(e,t,i){if(!e.length)return 0;var r=0,n=e.length-1;if(i){for(;r<n-1;){var o=i(e[s=Math.floor((r+n)/2)],t);if(0==o)return s;o<0?r=s:n=s}if(i(e[r],t)>0)return r;if(i(e[n],t)>0)return n}else{for(;r<n-1;){var s;if(e[s=Math.floor((r+n)/2)]===t)return s;e[s]<t?r=s:n=s}if(e[r]>t)return r;if(e[n]>t)return n}return-1},insertBinaryBound:function(e,t,i){var r=Et.binaryBound(e,t,i);return-1===r?e.push(t):e.splice(r,0,t),e},itoa:function(e){return String.fromCharCode(e)},atoi:function(e){return e.charCodeAt()},debugBreak:function(){rt("debugger")},debug:function(){et&x.Debug&&console.debug.apply(console,arguments)},log:function(){et&x.Log&&console.log.apply(console,arguments)},warn:function(){et&x.Warning&&console.warn.apply(console,arguments)},error:function(){et&x.Error&&console.error.apply(console,arguments)},scanf:function(e,t){return Ne(e,t)},beginRenderAnalyze:function(e){return(tt=tt||new $e).beginAnalyze(e||Ah.current.root.node)},endRenderAnalyze:function(){return(tt=tt||new $e).endAnalyze()},getRenderAnalyzeResult:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Ah.current,r=i.objectManager;tt=tt||new $e;var n={onGetObjectByNode:function(e){return r.getBaseObject(e)},onCloneObjet:function(e){return Et.cloneObject(e)},onCheckIsArray:function(e){return Et.isArray(e)}};for(var o in t)Object.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return tt.getAnalyzeResult(e,n)}};function wt(e,t,i,r){this._delaunayTriangles=null,this._rebuiltTriangles=null,this._points=[],this._indices=[],this._graph=null,this._extraIds=[],this._init(e,t,i||40,r)}function Tt(e,t){for(var i=[],r=0,n=e.length;r<n;r++){var o=e[r];if(void 0!==t&&0!==i.length){for(var s=i[i.length-1],a=new poly2tri.Point(o.x,o.y),l=Math.ceil(a.clone().sub(s).length()/t),u=a.clone().sub(s).length()/l,c=a.clone().sub(s),h=1;h<l;h++)c.normalize(),i.push(s.clone().add(c.mul(u*h)));i.push(a.clone())}else i.push(new poly2tri.Point(o.x,o.y))}if(void 0!==t)for(s=i[i.length-1],a=i[0],l=Math.ceil(a.clone().sub(s).length()/t),u=a.clone().sub(s).length()/l,c=a.clone().sub(s),h=1;h<l;h++)c.normalize(),i.push(s.clone().add(c.mul(u*h)));return i}function Mt(e,t){for(var i=1/0,r=0,n=0,o=t.length;n<o;n++){var s=e.distanceTo(t[n]);s<i&&(i=s,r=n)}return r}Object.defineProperties(Et,{logLevelType:{get:function(){return et},set:function(e){et=e}},disableLog:{get:function(){return console.log!=Et.consoleLogFunc},set:function(e){console.log=e?function(){}:Et.consoleLogFunc}},disableWarning:{get:function(){return console.warn!=Et.consoleWarnFunc},set:function(e){console.warn=e?function(){}:Et.consoleWarnFunc}},disableTime:{get:function(){return console.time!=Et.consoleTimeFunc},set:function(e){e?(console.time=function(){},console.timeEnd=function(){}):(console.time=Et.consoleTimeFunc,console.timeEnd=Et.consoleTimeEndFunc)}}}),Object.assign(wt.prototype,{_init:function(e,t,i,r){var n,o;if(e.contour)(n={}).contour=Tt(e.contour,i),n.holes=e.holes.map((function(e){return Tt(e,i)})),o=e.y;else{var s=new THREE.Geometry;s.fromBufferGeometry(e),s.mergeVertices(),n=function(e,t){for(var i={},r=0,n=e.faces,o=n.length;r<o;r++)for(var s=[n[r].a,n[r].b,n[r].c].sort((function(e,t){return e-t})),a=[[0,1],[1,2],[0,2]],l=0;l<a.length;l++){var u=s[a[l][0]],c=s[a[l][1]];i[u+"_"+c]?i[u+"_"+c].count++:i[u+"_"+c]={start:u,end:c,count:1}}var h=[];for(var p in i)1===i[p].count&&h.push(i[p]);var d=[];for(;h.length>0;){var f,m=[],g=h[0].start,v=h[0].end;for(f=e.vertices[h[0].end],m.push({x:f.x,y:f.z}),h.splice(0,1);v!==g;)for(r=0,o=h.length;r<o;r++){if(h[r].start==v){f=e.vertices[h[r].end],m.push({x:f.x,y:f.z}),v=h[r].end,h.splice(r,1);break}if(h[r].end==v){f=e.vertices[h[r].start],m.push({x:f.x,y:f.z}),v=h[r].start,h.splice(r,1);break}}d.push(m)}function y(e){for(var t=1/0,i=1/0,r=0;r<e.length;r++)e[r].x<t&&(t=e[r].x),e[r].y<i&&(i=e[r].y);return{x:t,y:i}}var b=1/0,_=1/0,x=0,E=[];for(r=0,o=d.length;r<o;r++){var w=Tt(d[r],t);E.push(w);var T=y(w);(T.x<b||T.y<_)&&(b=T.x,_=T.y,x=r)}var M=E[x];return E.splice(x,1),{contour:M,holes:E}}(s,i),o=s.vertices[0].y}var a=new poly2tri.SweepContext(n.contour);if(a.addHoles(n.holes),a.triangulate(),this._delaunayTriangles=a.getTriangles(),this._rebuiltTriangles=function(e,t){for(var i=[],r=0;r<e.length;r++){var n=e[r].getPoints(),o=new THREE.Triangle;o.a.set(n[0].x,t,n[0].y),o.b.set(n[1].x,t,n[1].y),o.c.set(n[2].x,t,n[2].y),i.push(o)}return i}(this._delaunayTriangles,o),function(e,t,i,r){var n=0;e.forEach((function(e){for(var t=0;t<e.points_.length;t++)void 0===e.points_[t]._id&&(e.points_[t]._id=n++)}));var o=[[1,2],[0,2],[0,1]],s={},a=0;e.forEach((function(e){for(var n=[],l=0;l<3;l++){if(!e.constrained_edge[l]){var u=e.getPoint(o[l][0]),c=e.getPoint(o[l][1]);if(!s[u._id+"_"+c._id]){var h=new THREE.Vector3((u.x+c.x)/2,r,(u.y+c.y)/2);h._index=a++;var p=(new THREE.Vector3).set(u.x,r,u.y);p._id=u._id;var d=(new THREE.Vector3).set(c.x,r,c.y);d._id=c._id,h._endPoints=[p,d],t.push(h),s[u._id+"_"+c._id]=h,s[c._id+"_"+u._id]=h}n.push(s[u._id+"_"+c._id])}}2===n.length&&i.push(n[0]._index,n[1]._index),3===n.length&&(i.push(n[0]._index,n[1]._index),i.push(n[1]._index,n[2]._index),i.push(n[2]._index,n[0]._index)),e._sharedMidPoints=n}))}(this._delaunayTriangles,this._points,this._indices,o),t&&t.length>0)for(var l=this._points.slice(0),u=0;u<t.length;u++){var c=t[u],h=this._points.length,p=Mt(c,l);this._points.push(c.clone()),this._indices.push(h,p),this._extraIds.push(h)}this._graph=function(e,t,i){var r={};i&&i.forEach((function(e){e.box=(new THREE.Box3).setFromPoints(e)}));for(var n=0,o=t.length;n<o;n+=2){var s=t[n+0],a=t[n+1],l=e[s],u=e[a];r[s]=r[s]||{},r[a]=r[a]||{},i&&i.find((function(e){return Dt(l,u,e)}))?r[s][a]=r[a][s]=1/0:r[s][a]=r[a][s]=l.distanceTo(u)}return new Graph(r)}(this._points,this._indices,r)},findPath:function(e,t,i){var r=void 0!==(i=i||{}).includeStart&&i.includeStart,n=void 0!==i.includeEnd&&i.includeEnd,o=void 0===i.fixEnds||i.fixEnds,s=void 0!==i.pathSmooth?i.pathSmooth:{enable:!1,minFov:.115},a=this,l=[];if(!(c=this._extraIds.find((function(t){return a._points[t].equals(e)})))){var u=this._rebuiltTriangles.findIndex((function(t){return t.containsPoint(e)}));if(u>-1)l=this._delaunayTriangles[u]._sharedMidPoints.map((function(e){return e._index}));else l=[Mt(e,this._points)];var c=this._points.length;this._points.push(e),this._graph.map[c]={},l.forEach((function(t){a._graph.map[t][c]=a._graph.map[c][t]=e.distanceTo(a._points[t])}))}var h=this._extraIds.find((function(e){return a._points[e].equals(t)})),p=[];if(!h){var d=this._rebuiltTriangles.findIndex((function(e){return e.containsPoint(t)}));if(d>-1)p=this._delaunayTriangles[d]._sharedMidPoints.map((function(e){return e._index}));else p=[Mt(t,this._points)];h=this._points.length,this._points.push(t),this._graph.map[h]={},p.forEach((function(e){a._graph.map[e][h]=a._graph.map[h][e]=t.distanceTo(a._points[e])}))}var f=this._graph.findShortestPath(c,h).map((function(e){return a._points[+e]}));if(!r&&f.shift(),!n&&f.pop(),l.length>0&&(l.forEach((function(e){delete a._graph.map[e][c],delete a._graph.map[c][e]})),this._points.length=this._points.length-1),p.length>0&&(p.forEach((function(e){delete a._graph.map[e][h],delete a._graph.map[h][e]})),this._points.length=this._points.length-1),r&&o&&f.length>=3&&jt(f[0],f[1],f[2])<.25*Math.PI&&f.splice(1,1),n&&o&&f.length>=3){var m=f.length-1,g=f.length-2,v=f.length-3;jt(f[m],f[g],f[v])<.25*Math.PI&&f.splice(g,1)}return s&&s.enable&&(f=function(e,t){t=void 0!==t?t:.115;var i=[],r=[],n=-1,o=-1,s=!1;e.forEach((function(e,t){if(0!==t){if(s)return i.push(null),void r.push(null);var a=e._endPoints;if(!a)return i.push(null),r.push(null),void(s=!0);0===i.length?(i.push(a[0]),r.push(a[1]),n=a[0]._id,o=a[1]._id):a[0]._id===n?(i.push(null),r.push(a[1]),o=a[1]._id):a[0]._id===o?(r.push(null),i.push(a[1]),n=a[1]._id):a[1]._id===n?(i.push(null),r.push(a[0]),o=a[0]._id):a[1]._id===o?(r.push(null),i.push(a[0]),n=a[0]._id):(i.push(null),r.push(null),s=!0)}}));for(var a=e[0].clone(),l=new THREE.Vector3,u=new THREE.Vector3,c=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Vector3,d=[0],f=0;f<i.length;f++){var m=i[f],g=r[f];if(null===m&&null===g)if(f>0&&f===i.length-1&&(null!==i[f-1]||null!==r[f-1])){p.subVectors(e[f+1],a);var v=c.angleTo(p),y=p.angleTo(h);(Math.sign(Pt(c,p))!==Math.sign(Pt(p,h))||v<t/2||y<t/2)&&d.push(f)}else d.push(f);else if(0===f)l.copy(m),u.copy(g),c.subVectors(l,a),h.subVectors(u,a);else if(m){p.subVectors(m,a);var b=c.angleTo(h),_=p.angleTo(h);Math.sign(Pt(c,h))===Math.sign(Pt(p,h))&&_<=b&&_>t?(c.copy(p),l.copy(m)):(d.push(f),a.copy(e[f]),l.copy(m),c.subVectors(l,a),h.subVectors(u,a))}else if(g){p.subVectors(g,a);b=c.angleTo(h),_=c.angleTo(p);Math.sign(Pt(h,c))===Math.sign(Pt(p,c))&&_<=b&&_>t?(h.copy(p),u.copy(g)):(d.push(f),a.copy(e[f]),u.copy(g),c.subVectors(l,a),h.subVectors(u,a))}else console.error("side1 and side2 must has one null value!");f===i.length-1&&d.push(f+1)}return d.map((function(t){return e[t]}))}(f,s.minFov)),f.map((function(e){return e.clone()}))},getExtraPoints:function(){var e=[],t=this;return this._extraIds.forEach((function(i){e.push(t._points[i])})),e},getDistance:function(e,t){for(var i=Mt(e,this._points),r=Mt(t,this._points),n=this._graph.findShortestPath(i,r),o=0,s=0,a=n.length;s<a-1;s++){var l=n[s],u=n[s+1];o+=this._graph.map[l][u]}return o},findNearestPathPoint:function(e){var t=Mt(e,this._points);return this._points[t]},getPoints:function(){return this._points},getIndices:function(){return this._indices},getRebuiltTriangles:function(){return this._rebuiltTriangles}});var Ct=new THREE.Vector3,St=new THREE.Vector3;function jt(e,t,i){return Ct.copy(t).sub(e),St.copy(t).sub(i),Ct.angleTo(St)}function Pt(e,t){return e.x*t.z-e.z*t.x}var Rt=new THREE.Box3;function Dt(e,t,i){if(Rt.makeEmpty(),Rt.expandByPoint(e),Rt.expandByPoint(t),r=i.box,(n=Rt).max.x<r.min.x||n.min.x>r.max.x||n.max.z<r.min.z||n.min.z>r.max.z)return!1;for(var r,n,o=!1,s=0,a=i.length-1;s<i.length;a=s++)if(At(e,t,i[s],i[a])){o=!0;break}return!!o||function(e,t){for(var i=e.x,r=e.z,n=!1,o=0,s=t.length-1;o<t.length;s=o++){var a=t[o].x,l=t[o].z,u=t[s].x,c=t[s].z;l>r!=c>r&&i<(u-a)*(r-l)/(c-l)+a&&(n=!n)}return n}(e,i)}function At(e,t,i,r){var n=(e.x-i.x)*(t.z-i.z)-(e.z-i.z)*(t.x-i.x),o=(e.x-r.x)*(t.z-r.z)-(e.z-r.z)*(t.x-r.x);if(n*o>0)return!1;var s=(i.x-e.x)*(r.z-e.z)-(i.z-e.z)*(r.x-e.x);if(s*(s+n-o)>0)return!1;var a=s/(o-n),l=a*(t.x-e.x),u=a*(t.z-e.z);return{x:e.x+l,z:e.z+u}}function kt(e){this._navigations=e,this._map=null,this._connectNavMap=null,this._connectPoints=[],this._init()}function Ot(e,t){for(var i=-1,r=0;r<t.length;r++)t[r].equals(e)&&(i=r);return i}function Bt(e){var t={};for(var i in e)t[i]=Object.assign({},e[i]);return t}function Ft(e){this._navigation=e}Object.assign(kt.prototype,{_init:function(){this._map={},this._connectNavMap={};for(var e=0;e<this._navigations.length;e++){for(var t=this._navigations[e],i=t.getExtraPoints(),r=0;r<i.length;r++){var n=i[r],o=Ot(n,this._connectPoints);o<0?(o=this._connectPoints.length,n._index=o,this._connectPoints.push(n)):n._index=this._connectPoints[o]._index}if(i.length>1)for(r=0;r<i.length;r++)for(var s=0;s<i.length;s++)if(s!==r){var a=t.getDistance(i[s],i[r]),l=i[s]._index,u=i[r]._index;this._map[l]=this._map[l]||{},this._map[u]=this._map[u]||{},this._map[l][u]=a,this._map[u][l]=a,this._connectNavMap[l]=this._connectNavMap[l]||{},this._connectNavMap[u]=this._connectNavMap[u]||{},this._connectNavMap[l][u]=t,this._connectNavMap[u][l]=t}}},findPath:function(e,t,i,r,n){if((n=n||{}).includeStart=void 0!==n.includeStart&&n.includeStart,n.includeEnd=void 0!==n.includeEnd&&n.includeEnd,e==i)return this._navigations[e].findPath(t,r,n);if(0==this._navigations[e].getExtraPoints().length||0==this._navigations[i].getExtraPoints().length)return console.info("closed space: "+e+" or "+i),[];var o=Bt(this._map),s=Bt(this._connectNavMap),a=0,l=0,u=this._connectPoints.length,c=0;function h(e,t,i){for(var r=t.getExtraPoints(),n=0;n<r.length;n++){var a=Ot(r[n],i),l=t.getDistance(e,r[n]);o[d]=o[d]||{},o[a]=o[a]||{},o[d][a]=l,o[a][d]=l,s[d]=s[d]||{},s[a]=s[a]||{},s[d][a]=t,s[a][d]=t}}var p=(x=this._navigations[e]).findNearestPathPoint(t).clone();if(Ot(p,this._connectPoints)<0){var d=u+c;c++,h(p,x,this._connectPoints),this._connectPoints.push(p),a=d}else a=Ot(p,this._connectPoints);var f=(x=this._navigations[i]).findNearestPathPoint(r).clone();if(Ot(f,this._connectPoints)<0){d=u+c;c++,h(f,x,this._connectPoints),this._connectPoints.push(f),l=d}else l=Ot(f,this._connectPoints);if(a===l){var m=[];return n.includeStart&&m.push(t.clone()),n.includeEnd&&m.push(r.clone()),m}var g=Graph.findShortestPath(o,a,l);if(!g)return console.info("find no path between rooms: "+e+" or "+i),[];for(var v=[],y=0;y<g.length-1;y++){var b=+g[y],_=+g[y+1],x=s[b][_],E={};E.includeStart=y>0||n.includeStart,E.includeEnd=y<g.length-2||n.includeEnd,E.fixEnds=n.fixEnds,E.pathSmooth=n.pathSmooth;var w=x.findPath(0===y?t:this._connectPoints[b],y>=g.length-2?r:this._connectPoints[_],E);0!==y&&w.shift(),v=v.concat(w)}return this._connectPoints.length=u,v}}),Object.assign(Ft.prototype,{createPathPointsMesh:function(){for(var e=this._navigation.getPoints(),t=[],i=0,r=e.length;i<r;i++){e[i].toArray(t,3*i)}var n=new THREE.BufferGeometry;return n.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),new THREE.Points(n)},createPathLineSegmentsMesh:function(){for(var e=this._navigation,t=e.getPoints(),i=[],r=e.getIndices(),n=0,o=t.length;n<o;n++){t[n].toArray(i,3*n)}var s=new THREE.BufferGeometry;return s.addAttribute("position",new THREE.BufferAttribute(new Float32Array(i),3)),s.setIndex(r),new THREE.LineSegments(s)},createRebuiltTrianglesMesh:function(){for(var e=this._navigation.getRebuiltTriangles(),t=[],i=0,r=e.length;i<r;i++){var n=e[i];n.a.toArray(t,18*i+0),n.b.toArray(t,18*i+3),n.b.toArray(t,18*i+6),n.c.toArray(t,18*i+9),n.c.toArray(t,18*i+12),n.a.toArray(t,18*i+15)}var o=new THREE.BufferGeometry;return o.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),new THREE.LineSegments(o)},createPathNodeByPoints:function(e){for(var t=[],i=0,r=e.length;i<r;i++){e[i].toArray(t,3*i)}var n=[];for(i=0,r=e.length;i<r;i++)i!==r-1&&n.push(i,i+1);var o=new THREE.Group,s=new THREE.BufferGeometry;s.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3));var a=new THREE.Points(s);o.add(a);var l=new THREE.BufferGeometry;l.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),l.setIndex(n);var u=new THREE.LineSegments(l);return o.add(u),o}});var Lt,It=function(){function e(t){n(this,e),this.object=t,this.prevObjectPosition=null,this.prevObjectScale=null,this.prevObjectAngles=null,this._objects=[],this.groupNavigation=null,this.navigationHelpersNode=null,this.navigationHelpers=[]}return e.prototype.clear=function(){this.showHelper(!1),this.prevObjectPosition=null,this.prevObjectScale=null,this.prevObjectAngles=null,this._objects=[],this.groupNavigation=null,this.navigationHelpers=[]},e.prototype.needGen=function(){var e=this.object;if(!e)return!0;if(!this.prevObjectPosition||!this.prevObjectScale||!this.prevObjectAngles)return!0;var t=Et.parseVector3(e.position),i=Et.parseVector3(e.scale),r=Et.parseVector3(e.angles);return!t.equals(this.prevObjectPosition)||(!i.equals(this.prevObjectScale)||!r.equals(this.prevObjectAngles))},e.prototype.getClipAreas=function(e,t){var i=function(e,t){return e==t||!!e.isChildOf(t)},r=[];if(t)for(var n=0;n<t.length;n++){var o=t[n];if(i(e,o.object)){for(var s=[],a=o.area,l=0;l<a.length;l++){var u=Et.parseVector3(a[l]);s.push(u)}r.push(s)}}return r},e.prototype.genFromData=function(e,t,i,r){if(!Et.isFunction(e.getNavigationData))return!1;var n=e.getNavigationData();if(!n)return!1;for(var o=[],s=0;s<8;s+=2)o.push({x:n.data[s],y:n.data[s+1]});var a=[];for(s=0;s<n.holes.length;s++){for(var l=2*n.holes[s],u=[],c=0;c<8;c+=2)u.push({x:n.data[l+c],y:n.data[l+c+1]});a.push(u)}var h=new wt({contour:o,holes:a,y:0},t,30,this.getClipAreas(e,r));i.push(h);var p=new Ft(h);return this.navigationHelpers.push(p),!0},e.prototype.genFromMesh=function(e,t,i,r,n){if(!Et.isFunction(e.getNavigationMesh))return!1;var o=e.getNavigationMesh();if(!o)return!1;var s=o.geometry;if(!s)return!1;var a=s.clone();a.isBufferGeometry||(a=(new THREE.BufferGeometry).fromGeometry(a)),a.applyMatrix4(o.matrixWorld),a.applyMatrix4(n);var l=new wt(a,t,30,this.getClipAreas(e,r));i.push(l);var u=new Ft(l);return this.navigationHelpers.push(u),!0},e.prototype._getCampus=function(){return this.object.isCampus?this.object:this.object.parents.query(".Campus")[0]},e.prototype.initFromObjects=function(e,t){var i=this._getCampus();if(i){var r=new THREE.Matrix4;r.getInverse(i.node.matrixWorld);for(var n=[],o=0;o<e.length;o++){var s=e[o],a=[];s.doors&&s.doors.forEach((function(e){var t=Et.parseVector3(e.position);t.applyMatrix4(r),a.push(t)})),(this.genFromData(s,a,n,t)||this.genFromMesh(s,a,n,t,r))&&this._objects.push(s)}this.groupNavigation=new kt(n)}},e.prototype.init=function(e){this.clear();var t=this.object;this.prevObjectPosition=Et.parseVector3(t.position),this.prevObjectScale=Et.parseVector3(t.scale),this.prevObjectAngles=Et.parseVector3(t.angles);try{if(t.isFloor){var i=t.rooms;i.length?this.initFromObjects(i,e):this.initFromObjects([t],e)}else t.isCampus&&this.initFromObjects([t],e)}catch(e){THING.Utils.error(e),THING.Utils.error(e.toString()),THING.Utils.error("Init object(name:"+this.object.name+", id:"+this.object.id+") navigation failed")}},e.prototype.getRoomID=function(e){if(e.isBaseObject)return this._objects.indexOf(e);for(var t=0;t<this._objects.length;t++){var i=this._objects[t];if(i.isFloor)return t;if(i.getRayCastPosition(e))return t;for(var r=i.doors,n=0;n<r.length;n++){var o=r[n];if(THING.Math.equalsVector(o.position,e))return t}}return-1},e.prototype.getEntryInfo=function(e,t,i){var r=e[t],n=e[i],o=-1;return this.object.isFloor?r?o=this.getRoomID(r):n&&(o=this.getRoomID(n)):this.object.isCampus&&(o=0),-1===o?null:{id:o,pos:Et.parseVector3(n)}},e.prototype.findPath=function(e){e=e||{};var t=this.getEntryInfo(e,"startRoom","startPosition");if(!t)return null;var i=this.getEntryInfo(e,"endRoom","endPosition");if(!i)return null;var r=this._getCampus();if(!r)return null;var n=new THREE.Matrix4;n.getInverse(r.node.matrixWorld);var o=t.pos.clone();o.applyMatrix4(n);var s=i.pos.clone();s.applyMatrix4(n);var a=this.groupNavigation.findPath(t.id,o,i.id,s,{includeStart:!0,includeEnd:!0,fixEnds:!0,pathSmooth:{enable:!0}});if(!a||!a.length)return null;for(var l=e.height||0,u=t.pos,c=[],h=0;h<a.length;h++){var p=a[h];p.y+=l,length+=p.distanceTo(u),u=p,p.applyMatrix4(r.node.matrixWorld),c.push(p.toArray())}return(c=THING.Math.toUniquePoints(c)).getPathLength=function(){return Et.getLength(this)},c},e.prototype.showHelper=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.object)if(e){if(!this.navigationHelpersNode){this.navigationHelpersNode=new THREE.Group;var t=this._getCampus();if(!t)return;for(var i=0;i<this.navigationHelpers.length;i++){var r=this.navigationHelpers[i],n=r.createRebuiltTrianglesMesh();n.position.y=.1,n.material.color.setHex(6985427),this.navigationHelpersNode.add(n);var o=r.createPathPointsMesh();this.navigationHelpersNode.add(o);var s=r.createPathLineSegmentsMesh();this.navigationHelpersNode.add(s)}this.navigationHelpersNode.applyMatrix4(t.node.matrixWorld),this.object.app.scene.add(this.navigationHelpersNode)}}else this.navigationHelpersNode&&(this.object.app.resourceManager.remove(this.navigationHelpersNode),this.navigationHelpersNode=null)},e}(),Nt=function(e){return!e.isLight&&!e.userData.skipBoundingBox},Ut=function(){function e(){n(this,e),this.object=null,this._boxes=null,this._initBoxes(),this._disable=!1}return e.prototype.onAdd=function(e){this.object=e},e.prototype.onRemove=function(){},e.prototype.onUpdate=function(e){},e.prototype._getKey=function(e,t){return(e?"_onlyVisible":"_all")+(t?"_onlySelf":"")},e.prototype._getBox=function(e,t,i){var r=this._getKey(t,i);return this._boxes[e][r]},e.prototype._setBox=function(e,t,i,r){if(!t||this.object.visible){var n=this._getKey(t,i);this._boxes[e][n]=r}},e.prototype._updateBox=function(e,t,i,r,n){var o=this._getBox(e,t,i);if(!o){var s=new THREE.Box3,a=this.object.node;s._setFromObject(a,(function(e){return(!n||!1!==n(e))&&(!(t&&!e.ensureVisible())&&Nt(e))}),r),o=this._processBox(s,this.object),this._setBox(e,t,i,o)}return o},e.prototype._getVector3=function(e){return e.toArray()},e.prototype._processBoxResult=function(e,t){e.toBox=function(){var t=Et.parseVector3(e.min),i=Et.parseVector3(e.max);return t.z==i.z&&(t.z-=1e-6,i.z+=1e-6),new THREE.Box3(t,i)},e.getWorldPosition=function(e){var i=t.getOffsetPosition(e);i=THING.Math.divideVector(i,t.scale);var r=e.boundingBox||t.boundingBox,n=t.worldToSelf(r.center),o=THING.Math.addVector(n,i);return t.selfToWorld(o)},void 0===e.initSize&&Object.defineProperties(e,{initSize:{get:function(){if(t._initBoxSize)return t._initBoxSize;var e,i=function(e){var t=new THREE.Vector3;return e.getSize(t),t.toArray()},r=function(e){return!e||!!THING.Math.equalsVector(e,[0,0,0])},n=t.app.modelResource.getBoundingBox(t.url);if(n&&(e=n.size.concat()),r(e)&&t._loadingBoxSize&&(e=t._loadingBoxSize),r(e)){var o=new THREE.Box3;t._traverseSelfNodes((function(e){e.isMesh&&o.union((new THREE.Box3)._setFromObject(e,Nt))})),e=i(o)}return r(e)?(o=(new THREE.Box3)._setFromObject(t.node,Nt),t._initBoxSize=i(o)):t._initBoxSize=e,t._initBoxSize}}})},e.prototype._processBox=function(e,t){var i=[];e.getBoundingPositions().forEach((function(e){i.push(e.toArray())}));var r=new THREE.Vector3;e.getSize(r);var n=new THREE.Vector3;e.getCenter(n);var o=this._getVector3(e.min),s=this._getVector3(e.max),a=this._getVector3(r),l=this._getVector3(n),u={points:i,min:o,max:s,center:l,size:a,radius:r.length()};return this._processBoxResult(u,t),u},e.prototype._processOrientedBox=function(e,t){var i=t.node,r=(t.position,e.points),n=[],o=new THREE.Vector3(1/0,1/0,1/0),s=new THREE.Vector3(-1/0,-1/0,-1/0);r.forEach((function(e){var t=Et.parseVector3(e);t.x!=1/0&&t.x!=-1/0||(t.x=0),t.y!=1/0&&t.y!=-1/0||(t.y=0),t.z!=1/0&&t.z!=-1/0||(t.z=0),t.applyMatrix4(i.matrixWorld),o.min(t),s.max(t),n.push(t.toArray())}));var a=new THREE.Vector3;i.getWorldScale(a);var l=Et.parseVector3(e.size).multiply(a),u=new THREE.Vector3;u.addVectors(o,s).multiplyScalar(.5);var c=this._getVector3(o),h=this._getVector3(s),p=this._getVector3(l),d=this._getVector3(u),f={points:n,min:c,max:h,center:d,size:p,radius:l.length()};return this._processBoxResult(f,t),f},e.prototype._getInverseMatrixWorld=function(e){var t=new THREE.Matrix4;return e.updateWorldMatrix(!0,!1),t.getInverse(e.matrixWorld),t},e.prototype.getBoundingBox=function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(i){var r=this;e=function(e){return!r.object._isChildNode(e)}}var n=this._updateBox("boundingBox",t,i,null,e);return n},e.prototype.getOrientedBoundingBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._getBox("orientedBoundingBox",e,t);return i||(i=this._processOrientedBox(this.getLocalBoundingBox(e,t),this.object),this._setBox("orientedBoundingBox",e,t,i)),i},e.prototype.getLocalBoundingBox=function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this._getInverseMatrixWorld(this.object.node);if(i){var n=this;e=this._updateBox("selfLocalBoundingBox",t,i,r,(function(e){return!n.object._isChildNode(e)}))}else e=this._updateBox("localBoundingBox",t,i,r);return e},e.prototype._traverse=function(e){for(var t in this._boxes){var i=this._boxes[t];for(var t in i)i[t]&&(i[t]=e(i[t],t))}},e.prototype._initBoxes=function(){this._boxes={boundingBox:{},orientedBoundingBox:{},localBoundingBox:{},selfLocalBoundingBox:{}}},e.prototype.translate=function(e,t){var i=Et.parseVector3(e);this._traverse((function(e,r){return t&&t!=r||e.translate(i),e}))},e.prototype.setDirty=function(e,t){for(var i in this._boxes){var r=this._getKey(e,t);this._boxes[i][r]=null}},o(e,[{key:"dirty",set:function(e){this._disable||e&&this._initBoxes()}},{key:"disable",set:function(e){this._disable=e},get:function(){return this._disable}}]),e}();Ut._processBox=function(e,t){return(Lt=Lt||new Ut)._processBox(e,t)};var zt=new Map,Ht=new Map,Vt=new Map;function Wt(e,t){for(var i=0,r=t.length;i<r;i++){var n=t[i];if(e.startsWith(n))return!0}return!1}function Gt(e){for(var t="",i=0;i<e.length;i++){var r=e[i];if("="!=r&&"<"!=r&&">"!=r&&"!"!=r)break;t+=r}return"="==t&&(t="=="),t.trimBoth(" \t")}function qt(e,t){for(var i=e+"('",r="",n=0;n<t.length;n++){var o=t[n];if("="==o||"<"==o||">"==o||"!"==o)break;r+=o}i+=r.trimBoth('" \t'),i+="'",i+=",";var s=t.substring(n);if(s){var a=Gt(s);a&&((s=(s=s._trimLeft(a).trimBoth(" \t")).replaceAll("^(0+)",""))?Et.isNumberString(s)||'"'!=s[0]&&"'"!=s[0]&&(s="'"+s+"'"):s="0"),i+=s}return i+=")"}function Xt(e,t){for(var i=e+"('",r="",n=0;n<t.length;n++){var o=t[n];if("="==o||"<"==o||">"==o||"!"==o)break;r+=o}i+=r.trimBoth('" \t'),i+="'",i+=")";var s=t.substring(n);if(s){var a=Gt(s);a&&((s=(s=s._trimLeft(a).trimBoth(" \t")).replaceAll("^(0+)",""))?Et.isNumberString(s)||'"'!=s[0]&&"'"!=s[0]&&(s="'"+s+"'"):s="0"),i+=a,i+=s}return i}function Jt(e,t,i,r){var n="";n+=e+"(",r&&(n+='"');var o=function(e,t){var i="";if(Et.isArray(t))for(var r=0,n=e.length;r<n&&!Wt(e.substring(r),t);r++)i+=e[r];else for(r=0,n=e.length;r<n;r++){var o=e[r];if(-1!==t.indexOf(o))break;i+=o}return i.trimBoth(" ")}(t,i);return n+=o,r&&(n+='"'),{expression:n+=")",value:o}}function Yt(e){for(var t=0;t<e.length;t++){var i=e[t];if("="==i||"<"==i||">"==i||"!"==i)return!0}return!1}function Zt(e,t,i){e.forEach((function(e){e.isBaseObject&&t.evaluate(function(e){return{_name:function(t){return e.name==t},_id:function(t){return t.startsWith("#")?e.uuid==t.substring(1):e.id==t},_type:function(t){return!!e["is"+t]||e.type==t},_regExp:function(t,i){var r=i;if(i.startsWith("[")){var n=i.substr(1,i.length-2).trimBoth(" \t");r=e.getAttribute(n)}if(Et.isString(r)){var o=Vt.get(t);return o||(o=new RegExp(t),Vt.set(t,o)),o.test(r)}return!1},_regExpAttribute:function(t,i){var r=[];THING.__new__selector__?(r.push(e.getAttribute(t)),r.push(e.getAttribute("userData/"+t))):(r.push(e.getAttribute("userData/"+t)),r.push(e.getAttribute(t)));var n=Ht.get(i);n||(n=new RegExp("^"+i._trimRight("*")),Ht.set(i,n));for(var o=0;o<r.length;o++)if(n.test(r[o]))return!0;return!1},_attribute:function(t){var i;return THING.__new__selector__?void 0===(i=e.getAttribute(t))&&(i=e.getAttribute("userData/"+t)):void 0===(i=e.getAttribute("userData/"+t))&&(i=e.getAttribute(t)),i},_hasAttribute:function(t){var i=!1;return THING.__new__selector__?(i=e.hasAttribute(t))||(i=e.hasAttribute("userData/"+t)):(i=e.hasAttribute("userData/"+t))||(i=e.hasAttribute(t)),i}}}(e))&&Qt(i,e)}))}function Qt(e,t){t.canNotQueryFromSelector||e.push(t)}var Kt=function(){function e(t,i){n(this,e),this.app=t,this.objects=i}return e.prototype._setAttribute=function(e,t){for(var i=0;i<this.objects.length;i++){var r=this.objects[i];r&&(r.style[e]=t)}},e.prototype.setMaterial=function(e){this.objects.forEach((function(t){t.style.setMaterial(e)}))},o(e,[{key:"renderOrder",set:function(e){this._setAttribute("renderOrder",e)}},{key:"color",set:function(e){this._setAttribute("color",e)}},{key:"opacity",set:function(e){this._setAttribute("opacity",e)}},{key:"outlineColor",set:function(e){this._setAttribute("outlineColor",e)}},{key:"defaultOutlineColor",set:function(e){this._setAttribute("defaultOutlineColor",e)}},{key:"skipOutline",set:function(e){this._setAttribute("skipOutline",e)}},{key:"skipBoundingBox",set:function(e){this._setAttribute("skipBoundingBox",e)}},{key:"wireframe",set:function(e){this._setAttribute("wireframe",e)}},{key:"axisHelper",set:function(e){this._setAttribute("axisHelper",e)}},{key:"boundingBox",set:function(e){this._setAttribute("boundingBox",e)}},{key:"boundingBoxColor",set:function(e){this._setAttribute("boundingBoxColor",e)}},{key:"alwaysOnTop",set:function(e){this._setAttribute("alwaysOnTop",e)}},{key:"glow",set:function(e){this._setAttribute("glow",e)}},{key:"innerGlow",set:function(e){this._setAttribute("innerGlow",e)}},{key:"emissive",set:function(e){this._setAttribute("emissive",e)}}]),e}(),$t=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n(this,e),this.objects=[],this.app=t,this.objectManager=t.objectManager,this.events=t.events,this.length=0,this.initObjectPool=i||this.objectManager.objects,this.ignoreCheckingQueryableObjects=r}return e.prototype.query=function(t){var i=new e(this.app,this.initObjectPool);return i.select(t,this.objects),i},e.prototype._getObjects=function(t){var i=null;if(t.isSelector)i=(r=t).objects;else if(Et.isString(t)){var r;(r=new e(this.app,this.initObjectPool)).select(t),i=r.objects}else Et.isArray(t)?i=t:t.isBaseObject||t.isGroup?i=[t]:THING.Utils.error("selector.add unkown: "+t);return i},e.prototype.remove=function(e){if(!e)return this;var t=this._getObjects(e);if(!t)return this;for(var i=this.objects,r=0;r<i.length;r++)for(var n=0;n<t.length;n++)if(i[r]==t[n]){i.splice(r--,1);break}return this.buildReturnObject(i)},e.prototype.add=function(e){if(!e)return this;var t=this._getObjects(e);if(!t)return this;var i=this.objects.concat(t),r=Array.from(new Set(i));return this.buildReturnObject(r)},e.prototype.not=function(t){if(!t)return this;var i=null;if(t.isSelector)i=(r=t).objects;else if(Et.isString(t)){var r;(r=new e(this.app,this.initObjectPool)).select(t),i=r.objects}else if(Et.isArray(t))i=t;else{if(!t.isBaseObject&&!t.isGroup)return THING.Utils.error("selector.not unkown: "+t),this;i=[t]}for(var n=0;n<i.length;n++){var o=i[n],s=this.objects.indexOf(o);s>-1&&this.objects.splice(s,1)}var a=this.objects;return this.buildReturnObject(a)},e.prototype.parse=function(e,t,i){if(Et.isString(e))if("*"==(e=(e=e._trimLeft("$")).trimBoth(' \t"')))!function(e,t){e.forEach((function(e){Qt(t,e)}))}(t,i);else{var r=zt.get(e);if(r)Zt(t,r,i);else{var n=function(e){for(var t="",i=0;i<e.length;i++){var r=e[i];if(" "!=r&&"\t"!=r)if("#"==r)t+=(a=Jt("_id",e.substring(i+1),"\t|&",!0)).expression,i+=a.value.length;else if("."==r)t+=(a=Jt("_type",e.substring(i+1),"\t|&",!0)).expression,i+=a.value.length;else if("/"==r){i+=(a=Jt("_regExp",e.substring(i+1),"/",!0)).value.length+1;var n=e.substring(i).indexOf("(");if(-1!==n){i+=n+1;var o=e.substring(i).indexOf(")");if(-1!==o){var s=e.substr(i,o);t+="_regExp('"+a.value+"', '"+s+"')",i+=o+1}}}else if("["==r)(a=Jt("",e.substring(i+1),"]")).value.endsWith("*")?t+=qt("_regExpAttribute",a.value):t+=Xt(Yt((a=Jt("",e.substring(i+1),"]")).value)?"_attribute":"_hasAttribute",a.value),i+=a.value.length+1;else if("|"==r)"|"==e[i+1]&&i++,t+="||";else if("&"==r)"&"==e[i+1]&&i++,t+="&&";else if("("==r||")"==r)t+=r;else{var a;t+=(a=Jt("_name",e.substring(i),["\t","||","&&"],!0)).expression,i+=a.value.length}}return t}(e);(r=function(e,t,i){var r=zt.get(e);if(!r)try{r=new THING.Plugins.EVAL.Eval(e)}catch(e){return THING.Utils.error(e),null}return Zt(t,r,i),r}(n,t,i))?zt.set(e,r):THING.Utils.error("Eval '"+e+"' expression failed")}}else Et.isRegExp(e)?function(e,t,i){t.forEach((function(t){e.test(t.name)&&Qt(i,t)}))}(e,t,i):Et.isFunction(e)?function(e,t,i){t.forEach((function(t){e(t)&&Qt(i,t)}))}(e,t,i):e.isSelector&&function(e,t,i){t.forEach((function(t){e.has(t)&&Qt(i,t)}))}(e,t,i)},e.prototype.queryResult=function(e,t){e=e||{},t=t||this.initObjectPool;var i=[];return this.parse(e,t,i),i},e.prototype.test=function(e,t){return!!this.queryResult(e,t).length},e.prototype.select=function(e,t){var i=this.queryResult(e,t);return this.buildReturnObject(i)},e.prototype.buildReturnObject=function(e){if(this.clear(),(e=e||[]).isSelector&&(e=e.toArray()),!this.ignoreCheckingQueryableObjects)for(var t=0;t<e.length;t++)e[t].canNotQueryFromSelector&&e.splice(t--,1);this.objects=e,this.length=e.length;for(t=0;t<e.length;t++)this[t]=e[t];return this},e.prototype.clear=function(){for(var e=0;e<this.length;e++)this[e]=null;this.objects=[],this.length=0},e.prototype.forEach=function(e){if(e)for(var t=0;t<this.objects.length;t++){var i=this.objects[t];if(i)if(!1===e(i,t))break}},e.prototype.filter=function(t){var i=this.objects.filter((function(e,i){return!!e&&!1!==t(e,i)})),r=new e(this.app,i);return r.buildReturnObject(i),r},e.prototype.sort=function(e){e=e||function(e,t){var i=e.levelFromRoot;return t.levelFromRoot-i},this.objects.sort(e);for(var t=0;t<this.objects.length;t++)this[t]=this.objects[t];return this},e.prototype.toJSON=function(){return JSON.stringify(this.objects)},e.prototype.toArray=function(){return this.objects},e.prototype.indexOf=function(e){return this.objects.indexOf(e)},e.prototype.splice=function(e,t){for(var i=0;i<this.length;i++)delete this[i];this.objects.splice(e,t),this.length=this.objects.length;for(i=0;i<this.objects.length;i++)this[i]=this.objects[i];return this},e.prototype.concat=function(t){var i=new e(this.app,this.objects);if(i.buildReturnObject(this.objects),t)for(var r=0;r<t.length;r++)-1===i.indexOf(t[r])&&i.add(t[r]);return i},e.prototype.reverse=function(){var t=this.objects.reverse(),i=new e(this.app,t);return i.buildReturnObject(t),i},e.prototype.has=function(e){return-1!==this.objects.indexOf(e)},e.prototype.equals=function(e){if(this.length!=e.length)return!1;for(var t=0;t<this.length;t++)if(this[t]!=e[t])return!1;return!0},e.prototype.setOpacity=function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=0;i<this.objects.length;i++){var r=this.objects[i];r&&r.style.setOpacity(e,t)}},e.prototype.flipVisible=function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t&&(t.visible=!t.visible)}},e.prototype.fadeIn=function(e){for(var t=0;t<this.objects.length;t++){var i=this.objects[t];i&&i.fadeIn(e)}},e.prototype.fadeOut=function(e){for(var t=0;t<this.objects.length;t++){var i=this.objects[t];i&&i.fadeOut(e)}},e.prototype.destroyAll=function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t&&t.destroy()}this.clear()},e.prototype.on=function(e,t,i,r,n){this.objects.forEach((function(o){o.on(e,t,i,r,n)}))},e.prototype.off=function(e,t,i){this.objects.forEach((function(r){r.off(e,t,i)}))},e.prototype.one=function(e,t,i,r,n){this.objects.forEach((function(o){o.one(e,t,i,r,n)}))},e.prototype.trigger=function(e,t,i){for(var r=0;r<this.objects.length;r++)this.objects[r].trigger(e,t,i),t&&(t.object=null)},e.prototype.pauseEvent=function(e,t,i){for(var r=0;r<this.objects.length;r++)this.objects[r].pauseEvent(e,t,i)},e.prototype.pauseEventInFrame=function(e,t,i){for(var r=0;r<this.objects.length;r++)this.objects[r].pauseEventInFrame(e,t,i)},e.prototype.resumeEvent=function(e,t,i){for(var r=0;r<this.objects.length;r++)this.objects[r].resumeEvent(e,t,i)},e.prototype.getNodes=function(){for(var e=function(e,t){for(var i=0;i<e.length;i++)if(t==e[i]||t.isChildOf(e[i]))return!0;return!1},t=[],i=0;i<this.objects.length;i++){var r=this.objects[i];e(t,r.node)||t.push(r.node)}return t},e.prototype.destroy=function(){THING.Utils.warn("[Selector] Please use '.destroyAll()' to replace '.destroy()'"),this.destroyAll()},e.prototype.showBoundingBox=function(e){THING.Utils.warn("[Selector] Please use '.style.boundingBox=' to replace '.showBoundingBox()'"),this.style.boundingBox=e},o(e,[{key:"isSelector",get:function(){return!0}},{key:"inheritVisible",set:function(e){Et.setArrayValue(this.objects,"inheritVisible",e)}},{key:"inheritStyle",set:function(e){Et.setArrayValue(this.objects,"inheritStyle",e)}},{key:"inheritPosition",set:function(e){Et.setArrayValue(this.objects,"inheritPosition",e)}},{key:"inheritAngles",set:function(e){Et.setArrayValue(this.objects,"inheritAngles",e)}},{key:"inheritScale",set:function(e){Et.setArrayValue(this.objects,"inheritScale",e)}},{key:"visible",set:function(e){Et.setArrayValue(this.objects,"visible",e)}},{key:"pickable",set:function(e){Et.setArrayValue(this.objects,"pickable",e)}},{key:"draggable",set:function(e){Et.setArrayValue(this.objects,"draggable",e)}},{key:"style",get:function(){return new Kt(this.app,this.objects)}},{key:"opacity",set:function(e){THING.Utils.warn("[Selector] Please use '.style.opacity=' to replace '.opacity'"),this.style.opacity=e}}]),e}(),ei=Symbol("private");function ti(e,t){e[ei]={};var i=e[ei];i.init=function(){i.values=Et.parseValue(t.values,0),i.onChange=t.onChange},i.notifyChangeEvent=function(){if(i.previousValues!=i.values){for(var e=0;e<32;e++){var t=1<<e,r=i.values&t;if((i.previousValues&t)!=r){var n=i.watchers[t];n&&n(!!r)}}var o=i.onChange;o&&o({previousValues:i.previousValues,values:i.values})}},i.values=0,i.previousValues=0,i.watchers={},i.onChange=null,i.init()}var ii=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),ti(this,t)}return e.prototype.enable=function(e,t){var i=this[ei],r=i.values;return t?this.combine(e):this.clear(e),r!=i.values},e.prototype.check=function(e,t){return!!(this[ei].values&e)==t},e.prototype.set=function(e){if(!Et.isNull(e)){var t=this[ei];t.previousValues=t.values,t.values=e,t.notifyChangeEvent()}},e.prototype.get=function(e){return!!(this[ei].values&e)},e.prototype.combine=function(e){var t=this[ei];t.previousValues=t.values,t.values|=e,t.notifyChangeEvent()},e.prototype.clear=function(e){var t=this[ei];t.previousValues=t.values,Et.isNull(e)?t.values=0:t.values&=~e,t.notifyChangeEvent()},e.prototype.has=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this[ei];return t?(i.values&e)==e:0!=(i.values&e)},e.prototype.watch=function(e,t){for(var i=this[ei].watchers,r=0;r<32;r++){var n=e&1<<r;n&&(i[n]=t)}},o(e,[{key:"values",get:function(){return this[ei].values}},{key:"onChange",get:function(){return this[ei].onChange},set:function(e){this[ei].onChange=e}}]),e}(),ri=Symbol("private"),ni=1,oi=2,si=1;var ai=function(){function e(){n(this,e),function(e){e[ri]={};var t=e[ri];t.parseEvent=function(e,t,i,r){e=Et.parseValue(e,"");var n={condition:null,callback:null,tag:null,priority:50};return Et.isFunction(e)?(n.callback=e,Et.isString(t)?(n.tag=t,n.priority=r||n.priority):Et.isNumber(t)&&(n.priority=t)):Et.isString(e)&&(Et.isFunction(t)||THING.onError("Parse event failed, due to callback is not function with condition"),n.condition=e,n.callback=t,Et.isString(i)?(n.tag=i,n.priority=r||n.priority):Et.isNumber(i)?n.priority=i:n.priority=r||n.priority),n.callback||THING.onError("Parse event failed, deu to callback function is not existing"),n},t.createCacheKey=function(e,t){return e.uuid+"|"+t},t.updateListenerMap=function(e,t){var i=e.get(t.object);i?Et.insertBinaryBound(i,t,(function(e,t){return t.priority==e.priority?e.__index-t.__index:t.priority-e.priority})):e.set(t.object,[t])},t.addListener=function(e,i){var r=i.callback;r.key=t.createCacheKey(i.object,i.tag),e.caches.set(r.key,i),t.updateListenerMap(e.listenerMap,i),i.condition&&(e.conditionalListeners=e.conditionalListeners||new Map,t.updateListenerMap(e.conditionalListeners,i))},t.removeAllListeners=function(e,t){e.listenerMap.get(t).forEach((function(t){e.caches.delete(t.callback.key)})),e.listenerMap.delete(t);var i=e.conditionalListeners;i&&i.delete(t)},t.getListener=function(e,i,r){var n=t.createCacheKey(i,r);return e.caches.get(n)},t.getListeners=function(e,i){var r=t.hookers[e];return r?r.listenerMap.get(i):null},t.traverseListener=function(e){var i=t.hookers;for(var r in i)t.traverseListenerByType(r,e)},t.traverseListenerByType=function(e,i){var r=t.hookers[e];r&&r.listenerMap.forEach((function(e){e.forEach((function(e){i(e)}))}))},t.createListeners=function(){return{listenerMap:new Map,caches:new Map,conditionalListeners:null}},t.deleteListeners=function(e){e.listenerMap.forEach((function(e){e.forEach((function(e){e.object=null}))})),e.listenerMap.clear(),e.caches.clear(),e.conditionalListeners=null},t.removeListenerFromMap=function(e,t){e&&e.forEach((function(e){var i=e.indexOf(t);-1!==i&&e.splice(i,1)}))},t.removeListener=function(e,i){var r=i.callback.key,n=e.caches.get(r);n&&n.removed&&e.caches.delete(r),t.removeListenerFromMap(e.listenerMap,i),t.removeListenerFromMap(e.conditionalListeners,i)},t.invokeListener=function(e,t){var i=THING.onBeforeCallEventListener;i&&i(e,t),(t=t||{}).object=t.object||e.object,t.data=t.data||e.userData;var r=e.callback.call(t.object,t,e.tag),n=THING.onAfterCallEventListener;return n&&n(e,t),e.once&&(e.removed=!0),r},t.dispatchEvent=function(e,i,r,n,o){for(var s=null,a=0;a<i.length;a++){var l=i[a];if(l.removed)a--,t.removeListener(e,l);else if(!(l.paused||o&&l.tag!=o)){if(l.selector){if(l.object&&!r.isChildOf(l.object))continue;if(l.selector&&!l.selector.test(l.condition,r))continue}else if(l.object&&l.object!=r)continue;var u=t.invokeListener(l,n);s=s||u}}return s},t.addEventListener=function(i,r,n,o,s,a,l,u){t.hookers[i]=t.hookers[i]||t.createListeners();var c=t.hookers[i];s&&e.removeEventListener(i,r,s);var h={__index:si++,type:i,object:r,callback:o,tag:s,priority:a,once:l,userData:u,state:new ii};Object.defineProperties(h,{removed:{get:function(){return this.state.has(ni)},set:function(e){if(this.state.enable(ni,e),e){var t=this.callback.onRemove;t&&t()}}},paused:{get:function(){return this.state.has(oi)},set:function(e){this.state.enable(oi,e)}},actived:{get:function(){return!this.removed&&!this.paused}}}),n&&Et.isString(n)&&(h.selector=new $t,h.condition=n),t.addListener(c,h);var p=THING.onAddEventListener;p&&p(h)},t.removeEventListener=function(e,i,r){var n=t.hookers[e];if(n)if(r){var o=t.getListener(n,i,r);if(!o)return;o.removed=!0;var s=THING.onRemoveEventListener;s&&s(o)}else n.listenerMap.forEach((function(e){e.forEach((function(e){e.removed=!0;var t=THING.onRemoveEventListener;t&&t(e)}))}))},t.hookers={}}(this)}return e.prototype.dispose=function(){var e=this[ri];for(var t in e.hookers)e.deleteListeners(e.hookers[t]);e.hookers={}},e.prototype.addEventListener=function(e,t,i,r,n,o,s,a){var l=this[ri],u=l.parseEvent(i,r,n,o);u&&l.addEventListener(e,t,u.condition,u.callback,u.tag,u.priority,s,a)},e.prototype.removeEventListener=function(e,t,i){this[ri].removeEventListener(e,t,i)},e.prototype.removeAllEventListeners=function(e){this[ri].traverseListener((function(t){if(t.object==e){t.removed=!0;var i=THING.onRemoveEventListener;i&&i(t)}}))},e.prototype.traverseListener=function(e){this[ri].traverseListener(e)},e.prototype.traverseListenerByType=function(e,t){this[ri].traverseListenerByType(e,t)},e.prototype.getEventListener=function(e,t,i,r){var n=this[ri].getListeners(e,t);if(!n)return null;for(var o=0;o<n.length;o++){var s=n[o];if(!s.removed&&(s.condition==i&&(!r||s.tag==r)))return s}return null},e.prototype.getEventListeners=function(e,t){var i=this[ri],r=[];if(e){var n=i.getListeners(e,t);if(!n)return[];for(var o=0;o<n.length;o++){var s=n[o];s.removed||(t&&s.object!=t||r.push(s))}}else i.traverseListener((function(e){e.removed||t&&e.object!=t||r.push(e)}));return r},e.prototype.dispatchEvent=function(e,t,i,r){var n=this[ri];if(t.destroyed)return null;var o=n.hookers[e];if(!o)return null;var s=null,a=o.listenerMap.get(t);if(a){var l=n.dispatchEvent(o,a,t,i,r);s=s||l}var u=o.conditionalListeners;return u&&u.forEach((function(e){var a=n.dispatchEvent(o,e,t,i,r);s=s||a})),s},e.prototype.invokeListener=function(e,t){var i=this[ri];e.actived&&i.invokeListener(e,t)},e}(),li=Symbol("private");var ui=function(){function e(){n(this,e),function(e,t){e[li]={};var i=e[li];i.sortStates=function(){i.states.sort((function(e,t){return e.priority!==t.priority?t.priority-e.priority:t.id-e.id}))},i.updateExistingState=function(e,t,r){for(var n=i.states,o=0;o<n.length;o++){var s=n[o];if(s.name==t)return s.value=e,Et.isNumber(r)&&(s.priority=r),i.sortStates(),!0}return!1},i.id=1,i.states=[]}(this)}return e.prototype.isAnyEnable=function(){for(var e=this[li].states,t=0;t<e.length;t++)if(e[t].value)return!0;return!1},e.prototype.has=function(e){for(var t=this[li].states,i=0;i<t.length;i++){if(t[i].name==e)return!0}return!1},e.prototype.isEnable=function(e){var t=this[li].states;if(e)for(var i=0;i<t.length;i++){var r=t[i];if(r.name==e)return r.value}else if(t.length)return t[0].value;return!1},e.prototype.enable=function(e,t,i){if(t){var r=this[li],n=r.states;r.updateExistingState(e,t,i)||(i=Et.parseValue(i,0),n.push({id:r.id++,value:e,name:t,priority:i}),r.sortStates())}},e.prototype.clear=function(){this[li].states=[]},e.prototype.getValue=function(e){for(var t=this[li].states,i=0;i<t.length;i++){var r=t[i];if(r.name==e)return r.value}return null},o(e,[{key:"states",get:function(){return this[li].states}}]),e}(),ci=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;n(this,e),this.object=null,this.app=null,2==t.length?this._size=Et.parseVector2(t):this._size=Et.parseVector3(t),this._node=i,this._factor=r}return e.prototype._updateSize=function(e){if(this.object.visible){var t=Et.parseVector3(this.app.camera.position);this._node.keepSize(t,this._size,this._factor,e,this.object.static,this.app.renderCamera.matrixWorldInverse),this.object.synIndependentWorldScale(!1)}},e.prototype.onAdd=function(e){this.object=e,this._node=this._node||this.object.node,this.app=e.app,this.object.tickable=!0,this._node&&this._node.updateWorldMatrix(!0),this._updateSize()},e.prototype.onRemove=function(){},e.prototype.onUpdate=function(e){return this._updateSize(),!0},o(e,[{key:"size",set:function(e){this._size=Et.parseVector2(e),this.object.synIndependentWorldScale(),this._updateSize(!0)},get:function(){return this._size.toArray()}},{key:"node",set:function(e){this._node=e},get:function(){return this._node}}]),e}(),hi=Symbol("private"),pi=function(e){e[hi]={};var t=e[hi];return t.onFilter=null,t.result=null,t},di=function e(){return n(this,e),pi(this),Array.apply(this,arguments),this.length=0,Object.defineProperties(this,{length:{enumerable:!1}}),this};di.prototype=new Array,["push","pop","splice","shift"].forEach((function(e){di.prototype[e]=function(){var t=this[hi];return t.result=null,Array.prototype[e].apply(this,arguments)}})),di.prototype.concat=function(){return[].concat(this.map((function(e){return e})))},di.prototype.clear=function(){this.length=0},di.prototype.clearResult=function(){this[hi].result=null},Object.defineProperties(di.prototype,{push:{enumerable:!1},pop:{enumerable:!1},splice:{enumerable:!1},shift:{enumerable:!1},concat:{enumerable:!1},clear:{enumerable:!1},clearResult:{enumerable:!1},onFilter:{get:function(){return this[hi].onFilter},set:function(e){this[hi].onFilter=e},enumerable:!1,configurable:!1},result:{get:function(){var e=this[hi];return e.result?e.result:e.onFilter?(e.result=this.filter(e.onFilter),e.result):this},enumerable:!1,configurable:!1}});var fi=new THREE.Vector3,mi=new THREE.Vector3,gi=new THREE.Quaternion,vi=new THREE.Vector3,yi=new THREE.Vector3(1,1,1),bi=new THREE.Vector3,_i=(new THREE.Vector3,new THREE.Matrix3),xi=1,Ei=new THREE.Vector3,wi=new THREE.Vector3,Ti=new THREE.Quaternion,Mi=(new THREE.Quaternion,new THREE.Matrix4),Ci=new THREE.Matrix4,Si=function(){function e(t){n(this,e),this.app=t,this._type="",this._id="",this._name="",this._uuid="",this._queryID=xi++,this._parent=null,this._children=new di,this._children.onFilter=function(e){return!e.isCombinedObject},this.node=new THREE.Group,this.renderNode=this.node,this._lodNode=null,this._lodLevel=-1,this._builder=[],this._defaultStyle=null,this._style=null,this._initBoxSize=null,this._extensionsFile=null,this.anchorNode=null,this._ignoreParentScale=!1,this._ignoreParentAngles=!1,this._grid=null,this._boxNode=null,this._dragState=R.No,this._draggable=!1,this.isTickable=!1,this._catchEventAnyTime=!1,this._pickable=!0,this._lookingAtObject=null,this._stateFlags=new ii,this._independentControlFlags=new ii,this._hideNodesInScene=null,this._renderDistance=null,this._shadowDistance=null,this._localClippingPlanes=[],this._lockedOffset=[],this._independentPosition=null,this._independentWorldAngles=null,this._independentWorldScale=null,this.scaling=!1,this.scaleTween=null,this.rotating=!1,this.rotateTween=null,this.fadeTween=null,this.pathTween=null,this.pathTweens=[],this._attachPoints=null,this._controls=[],this.waitCommands=[],this._loadState=e.waitForLoading,this._internalUserData={},this._userData={},this._tags=[],this._groups=[],this._tweens=[],this._autoEnsureParentsVisible=!0,this._autoSynVisible=!0,this._keepSize=!1,this._ignoreEvents=null,this._visibleGroupStates=new ui,this._scaleGroupStates=new ui,this._eventTrigger=new ai(t),this._useShadow=!0,this.initStaticMembers()}return e.prototype._init=function(e,t){return this._parent=t,this.node=e||this.node,this.loaded=!0,this},e.prototype.initStaticMembers=function(){e.hasStaticMembers||(e.hasStaticMembers=!0,e.waitForLoading=1,e.loading=2,e.loadCompleted=3,e.stateHideBySceneFlag=1)},e.prototype.isBlockMouseOffEvent=function(e){return!1},e.prototype.setUserDataFlag=function(e,t){t?this.node.traverse((function(t){t.userData[e]=!0})):this.node.traverse((function(t){delete t.userData[e]}))},e.prototype.setupUserData=function(e){e=e||{};var t=this.node.userData;t.isBaseObject=!0,t.id=this._queryID,t.withGeometryIDAttributes=e.withGeometryIDAttributes;var i=this;t.getObject=function(){return i.app.objectManager.get(i._queryID)}},e.prototype.setupNode=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("LOD"==e.type&&(this._lodNode=e,this.tickable=!0),e.visible||(e.ensureVisible(!0,!0),e.ensureVisible(!1,!1),this.visible=!1),t){var i=this.node.userData;this.node=e,this.setupUserData(i)}else this.renderNode=e,this.node.add(e)},e.prototype.setupName=function(e){this._name=this._name||this._id},e.prototype.setupID=function(e){this._id=Et.parseValue(e.id,this._id),this._name=Et.parseValue(e.name,this._name),this._uuid=Et.parseValue(e.uuid,this._uuid),this._id=this._id||this._uuid||this._name,this._id||this._uuid||(this._id=THREE.MathUtils.generateUUID()),this.setupName(e),this.setupCommonInfo(e)},e.prototype.setupCommonInfo=function(t){this._internalUserData=t.internalUserData||this._internalUserData,this._stateFlags.enable(e.stateHideBySceneFlag,t.hideByScene),this._userData=t.properties||t.userData||{},this._tags=t.tags||[],t.forceBoundingBox&&(this.node.userData.forceBoundingBox=!0);var i=Et.parseValue(t.inheritStyle,!0);this.inheritStyle!=i&&(this.inheritStyle=i);var r=Et.parseValue(t.inheritTheme,!0);this.inheritTheme!=r&&(this.inheritTheme=r),this.inheritVisible=Et.parseValue(t.inheritVisible,!0)},e.prototype._setupLocalPosition=function(e){var t=e.localPosition,i=e.ignoreParentScale;t&&this.setLocalPosition(t,i)},e.prototype.setupTranslation=function(t){if(this._ignoreParentScale=Et.parseValue(t.ignoreParentScale,!1),this._ignoreParentAngles=Et.parseValue(t.ignoreParentAngles,!1),!t.skipSetupTranslation){var i=e.DefaultPosition||{},r=e.DefaultAngles||{},n=e.DefaultScale||{},o=t.position||i[this._type];o?this.position=o:t.basePoint||this._setupLocalPosition(t);var s=t.angle;if(s)this.angles=[0,s,0];else{var a=t.angles||t.localAngles||r[this._type];a&&(this.angles=a)}var l=t.quaternion;l&&(this.quaternion=l);var u=t.scale||n[this._type];u&&this.node.scale.copy(Et.parseVector3(u)),this.synIndependentWorldScale(!0,t.inheritScale)}var c=t.initBoxSize;c&&(this._initBoxSize=c.concat())},e.prototype.setupEnvMap=function(e){var t=this.getEnvMapResources();if(t){var i=e||this.isOutdoors;void 0===i&&(i=!!this.isCombinedObject&&this.isChildOfType("Facade|Ground")),i?t.outdoorsEnvMap&&this.traverseAllSelfNodes((function(e){if(!e.userData.skipEnvMap&&e.material&&e.isMesh)if(Array.isArray(e.material))e.material.map((function(e){if("envMap"in e){if(e.relaPosType&&"Outdoor"!==e.relaPosType){var i=e.clone();return i.envMap=t.outdoorsEnvMap,i.envMap.refCount=i.envMap.refCount||1,i.envMap.refCount++,i.envMapIntensity=1.3,i.relaPosType="Outdoor",i}return e.envMap=t.outdoorsEnvMap,e.envMap.refCount=e.envMap.refCount||1,e.envMap.refCount++,e.envMapIntensity=1.3,e.relaPosType="Outdoor",e}return e}));else if("envMap"in e.material)if(e.material.relaPosType&&"Outdoor"!==e.material.relaPosType){var i=e.material.clone();i.envMap=t.outdoorsEnvMap,i.envMap.refCount=i.envMap.refCount||1,i.envMap.refCount++,i.envMapIntensity=1.3,i.relaPosType="Outdoor",e.material=i}else e.material.envMap=t.outdoorsEnvMap,e.material.envMap.refCount=e.material.envMap.refCount||1,e.material.envMap.refCount++,e.material.envMapIntensity=1.3,e.material.relaPosType="Outdoor"})):t.indoorsEnvMap&&this.traverseAllSelfNodes((function(e){if(!e.userData.skipEnvMap&&e.material&&e.isMesh)if(Array.isArray(e.material))e.material.map((function(e){if("envMap"in e){if(e.relaPosType&&"Indoor"!==e.relaPosType){var i=e.clone();return i.envMap=t.indoorsEnvMap,i.envMap.refCount=i.envMap.refCount||1,i.envMap.refCount++,i.envMapIntensity=1.3,i.relaPosType="Indoor",i}return e.envMap=t.indoorsEnvMap,e.envMap.refCount=e.envMap.refCount||1,e.envMap.refCount++,e.envMapIntensity=1.3,e.relaPosType="Indoor",e}return e}));else if("envMap"in e.material)if(e.material.relaPosType&&"Indoor"!==e.material.relaPosType){var i=e.material.clone();i.envMap=t.indoorsEnvMap,i.envMap.refCount=i.envMap.refCount||1,i.envMap.refCount++,i.envMapIntensity=1.3,i.relaPosType="Indoor",e.material=i}else e.material.envMap=t.indoorsEnvMap,e.material.envMap.refCount=e.material.envMap.refCount||1,e.material.envMap.refCount++,e.material.envMapIntensity=1.3,e.material.relaPosType="Indoor"}))}},e.prototype.loadFromURL=function(e,t){t&&t()},e.prototype.setupFromURL=function(e){if(e.node)this._url=Et.parseValue(e.url,this._url),this._setup(e);else{var t=this;this.loadFromURL(e,(function(){t._setup(e)}))}},e.prototype.setupFromData=function(e){this._setup(e)},e.prototype.setupChildVisibleAsParent=function(e,t){},e.prototype.setupVisible=function(e){this._autoEnsureParentsVisible=Et.parseValue(e.autoEnsureParentsVisible,!0),this._autoSynVisible=Et.parseValue(e.autoSynVisible,!0);var t=e.visible;if(!Et.isNull(t)){this.visible=t;var i=e.parent;i&&t&&this._autoEnsureParentsVisible&&(i.node.visible=t,i.node.ensureParentsVisible(t))}},e.prototype._setup=function(e){var t=e.node;t&&this.setupNode(t,Et.parseValue(e.nodeOverride,!0)),this.setupCommonInfo(e),this.setupUserData(e),this.setupParent(e),this.customSetup(e),this.setupComplete(e)},e.prototype.setup=function(e){this._beforeSetup(e),this.loading=!0,this.setupID(e),this.setupVisible(e);var t=e.url,i=e.data,r=e.domElement;t?(e.url=this.app.confirmURL(t)._trimRight("/"),this.setupFromURL(e)):r?this.setupFromDom(e):i?this.setupFromData(e):this._setup(e)},e.prototype._beforeSetupStyle=function(e){},e.prototype._afterSetupStyle=function(e){},e.prototype.setupStyle=function(e){var t=e.style;if(t){for(var i in this._beforeSetupStyle(e),t){var r=t[i];void 0!==r&&(this.style[i]=r)}this._afterSetupStyle(e)}var n=e.keepSize;n&&(this.keepSize=n)},e.prototype.setupMaterials=function(e){if(!Et.parseValue(e.lights,!0)){var t=this.node.getMeshes();this.node.getMaterials().forEach((function(e){var i=new THREE.MeshBasicMaterial;i.copy(e),i.defines={},i.lights=!1,i.needsUpdate=!0,t.forEach((function(t){if(Et.isArray(t.material))for(var r=0;r<t.material.length;r++){var n=t.material[r];n==e&&(n.dispose(),t.material[r]=i)}else t.material==e&&(t.material.dispose(),t.material=i)}))}))}},e.prototype.setupResources=function(e){if(this.loaded=Et.parseValue(e.loaded,!0),this.loaded){if(this.setupCommands(e),this._processModel(!0,!0),this.dataToRecover){this._setupResources(this.dataToRecover),this._resettingStyle=!0;var t=this.style,i=this.dataToRecover.style;["color","opacity","outlineColor","alwaysOnTop","renderOrder"].forEach((function(e){t[e]!=i[e]&&(t[e]=i[e])})),delete this._resettingStyle,delete this.dataToRecover}this._boxNode&&this._boxNode.removeBySelf()}this.trigger("setupResources")},e.prototype._setupResources=function(e){},e.prototype._synFrom=function(e){if(!e.isBaseObject)return!1;this._visibleGroupStates.clear();for(var t=e._visibleGroupStates.states,i=0;i<t.length;i++){var r=t[i];this._setVisible(r.value,r.name)}return!0},e.prototype.setupCommands=function(e){if(this._style&&Et.isFunction(this._style._syn)&&this._style._syn(),this.loaded&&this.waitCommands.length){var t=this.app.commandManager.create(this.waitCommands);t&&t.execute(),this.waitCommands=[]}},e.prototype.setupInheritAttributes=function(e){var t=Et.parseValue(e.inheritPosition,!0),i=Et.parseValue(e.inheritAngles,!0),r=Et.parseValue(e.inheritScale,!0);this.inheritPosition==t&&this.inheritAngles==i&&this.inheritScale==r||(t&&i&&r||this.node.updateMatrixWorld(),this.inheritPosition=t,this.inheritAngles=i,this.inheritScale=r,this.synIndependentWorldPosition(),this.synIndependentWorldAngles(),this.synIndependentWorldScale()),Et.parseValue(e.inheritPickable,!0)||(this.inheritPickable=!1)},e.prototype.setupParent=function(e){if(!e.skipSetupParent&&!e.independent){var t=e.parent;t&&(t.isBaseObject?this._parent=t:THING.Utils.error("[BaseObject] Please make sure parent is BaseObject")),null==this._parent&&void 0===t&&(this._parent||(this._parent=this.app.root)),this._parent&&(this._parent._style&&this._parent._style._inheritThemeName&&this.inheritTheme&&this.applyTheme(this._parent._style._inheritThemeName,!1),this._parent._add(this,e,-1))}},e.prototype.customSetup=function(e){},e.prototype._beforeSetup=function(e){},e.prototype._notifyCompleteEvent=function(t){this._stateFlags.has(e.stateHideBySceneFlag)&&(this._hideByScene=!0);var i=this;Et.timer.setTimeout((function(){i.trigger("load",{object:i}),i.trigger("complete",{object:i})}),1)},e.prototype._callComplete=function(e){this.loaded=Et.parseValue(e.loaded,!0),this.queryID&&this.app.objectManager.objects.set(this.queryID,this),this._notifyCompleteEvent(e),Et.parseValue(e.queryable,!0)||(this.canNotQueryFromSelector=!0),this.trigger(F.Create,{object:this}),this.app.trigger(F.Create,{object:this});var t=e.successCallback||e.complete;t&&t.call(this,{object:this}),this.app.needUpdate=!0,this._ignoreParentScale=null,this._ignoreParentAngles=null},e.prototype._beforeSetupComplete=function(e){},e.prototype._afterSetupComplete=function(e){},e.prototype.useBottomCenterOfBoundingBoxAsPosition=function(){var e=this.boundingBox,t=e.center,i=e.size,r=this.node.children.map((function(e){var t=new THREE.Vector3;return e.getWorldPosition(t),t}));this.position=t,this.translateY(-i[1]/2),this.node.updateMatrixWorld();for(var n=0;n<this.node.children.length;n++){this.node.children[n]._setWorldPosition(r[n])}},e.prototype.setupComplete=function(e){this.loaded=Et.parseValue(e.loaded,!0),this._userData=this._userData||{},this._internalUserData=this._internalUserData||{},this.setupTranslation(e),this.setupInheritAttributes(e),this._beforeSetupComplete(e),this.setupStyle(e),this.setupEnvMap(),this.setupMaterials(e),this.setupResources(e),this.setupCommands(e),this.static?this.node._synMatrixWorld():this.node.updateWorldMatrix(!1,!1),this._afterSetupComplete(e),this.selfUpdate(),this._callComplete(e)},e.prototype.setParent=function(e,t,i){var r=this._parent;if(r&&r!=e&&r.remove(this,!1,t),this._parent=e,e){var n=e.node;t||!this.node.parent?n&&n.add(this.node):this.node.attachToParent(n,this.app.scene,i),this._style&&this._style.alwaysOnTop&&this._style._setAlwaysOnTop(!0)}},e.prototype.synTickableObject=function(){this.isTickable?this.app.objectManager.addTickableObject(this):this.app.objectManager.removeTickableObject(this)},e.prototype._setDirtyFlag=function(e,t){if(this._boundingBoxControl&&(this._boundingBoxControl.dirty=!0),e)for(var i=this.parent;i;i=i.parent)i._boundingBoxControl&&(i._boundingBoxControl.dirty=!0);t&&this._children.forEach((function(e){e._setDirtyFlag(!1,!0)}))},e.prototype.getChildByPath=function(e,t){var i=e.search("/");if(-1!==i)i=e.substring(0,i),e=e.substring(i.length+1);else if(i=e,t){if(t(this,i))return this}else if(this._id==i)return this;for(var r=0;r<this._children.length;r++){var n=this._children[r],o=null;if(t?t(n,i)&&(o=n):n.id==i&&(o=n),o){var s=o.getChildByPath(e);if(s)return s}}return null},e.prototype._getBasePointNode=function(e){var t=this.node.traverseBreakable((function(t){return t.name.contains(e)}));return t||(t=this.node.traverseBreakable((function(t){return t.name==e}))),t},e.prototype._addFromCampus=function(e){},e.prototype.add=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if((e=e||{}).isBaseObject){if(e.parent==this)return!1;this._add(e,null,t)}else{var i=e.url;if(Et.isString(i)){var r=e.position||this.position,n=e.angles||e.localAngles||this.angles,o=Et.parseValue(e.isCamFitScene,!1),s=e.complete,a=this;this.app.create({type:"Campus",url:i,position:r,angles:n,isCamFitScene:o,complete:function(e){var t=e.object;a._addFromCampus(t),t.destroy(),a.dirty=!0,s&&s(),this.app.trigger("addFromCampusComplete")}})}else{var l=e.object;if(!Et.isNull(l)){if(l.parent==this)return!1;this._add(l,e,t)}}}},e.prototype._add=function(e,t,i){if(!e)return!1;if(!e.isBaseObject)return!1;e._builder=this.builder;var r=(t=t||{}).basePoint,n=t.offset||t.localPosition,o=t.angles||t.localAngles,s=Et.parseValue(t.keepNode,!1),a=Et.parseValue(t.keepVisible,!0);if(this.node.updateWorldMatrix(!0,!1),s){var l=e.parent;if(l){var u=l._children.indexOf(e);-1!==u&&l._children.splice(u,1)}e._parent=this}else{var c=Et.parseValue(t.keepLocalPosition||t.node,!1),h=Et.parseValue(t.force||t.position||t.angles||t.scale,!1);e.setParent(this,c,h)}var p=void 0;if(Et.isString(r)){if(!(p=this._getBasePointNode(r)))return THING.Utils.error("The '"+r+"' basePoint is not existing"),!1;p.updateWorldMatrix(!0);var d=new THREE.Vector3;p.getWorldPosition(d),e.position=d.toArray(),n&&(e.position=THING.Math.addVector(e.position,n))}else n&&(e.localPosition=n);return o&&(e.angles=o),e._setDirtyFlag(!0,!1),i>=this._children.length||-1===i?this._children.push(e):this._children.splice(i,0,e),p&&e.node.attachToParent(p,!0),e.node.userData.removedNode&&(e.node.visible=!0,delete e.node.userData.removedNode),this._style&&e.inheritStyle&&e._syncStyleFrom(this),a&&(this.visible||(e.visible=this.visible)),Et.parseValue(t.inheritPickable,e.inheritPickable)&&e.pickable!=this.pickable&&(e.pickable=this.pickable),!0},e.prototype._syncStyleFrom=function(e){var t=this,i=e.style;["wireframe","color","opacity","emissive","roughness","outlineColor","skipBoundingBox","skipOutline","glow","innerGlow","lineBloom","radialBlur","radialBlur2","radialOffset","focusRegion","vertexNormalHelper","axisHelper","edgeColor","alwaysOnTop","doubleSide"].forEach((function(e){var r=i[e];r&&("opacity"==e&&1==r||(t.style[e]=r))}))},e.prototype.remove=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return!1;if(!e.isBaseObject)return!1;if(!e.isChildOf(this))return!1;e._setDirtyFlag(!0,!1),e.node.updateWorldMatrix(!0,!1);var r=e.node.getParents();-1!==r.indexOf(this.app.scene)&&(i?this.app.scene.add(e.node):e.node.attachToParent(this.app.scene,!1),t&&(e.node.visible=!1,e.node.userData.removedNode=!0)),e._parent=null;var n=this._children.indexOf(e);return-1!==n&&this._children.splice(n,1),!0},e.prototype.swapChild=function(e,t){var i=this._children.indexOf(e),r=this._children.indexOf(t);-1!==i&&-1!==r&&THING.Math.swapArray(this._children,i,r)},e.prototype.hasChild=function(e){if(!e)return!!this._children.length;for(var t=0;t<this._children.length;t++){if(this._children[t]==e)return!0}return!1},e.prototype.destroy=function(){var e=this,t=this._notifyDestroy;t&&t.call(this),this.pickable=!1,this.clearNode();var i=this.builder;i&&(i.disposeObject&&i.disposeObject(this._uuid,!1),this.isCampus&&i.clearAllResources&&i.clearAllResources()),this.stopMoving(),this.stopRotating(),this.stopScaling(),this.stopFade(),this.stopAllLerpTo();var r=this._style;r&&(r.isBaseStyle&&(r.alwaysOnTop=!1,r._traverse((function(t){e.app.effectManager.clearAllEffects(t)})),r.setEdgeWireframe(null),r.revertMaterial()),r._obj=null),this.tickable=!1,this.removeAllControls(!1),this.app.objectManager.destroy(this);for(var n=this._children.concat(),o=0;o<n.length;o++)n[o].destroy();this._children.clear(),this.clearAttachPoints(),this._parent&&(this._parent.remove(this),this._parent=null),this.node.parent&&this.node.parent.remove(this.node),this.app.events.unbindCallObj(null,null,null,[this]),this._eventTrigger.dispose(),this._lodNode=null,this._queryID=0,delete this.node.userData.getObject,this.app.needUpdate=!0,this._builder=null,this._style&&(this._style.obj=null,this._style=null),this._defaultStyle&&(this._defaultStyle.obj=null,this._defaultStyle=null)},e.prototype.getRaycastPosition=function(e){if(!e)return null;var t=new THREE.Raycaster;t.ray.origin=Et.parseVector3(this.position),t.ray.direction=Et.parseVector3(e);var i=t.intersectObject(this.app.scene,!0);if(!i.length)return null;for(var r=0;r<i.length;r++){var n=i[r],o=n.object;if(this.app.objectManager.getBaseObject(o)&&!o.isChildOf(this.node))return n.point.toArray()}return null},e.prototype.removePickingResources=function(){this.app.picker.removePickingResources(this.node)},e.prototype.setPickable=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._pickable=e;var i=this;if(this._traverseSelfNodes((function(t){t.setPickable(e,!1),e||i.app.picker.removePickingResources(t)})),i.app.picker.forceUpdate=!0,t)for(var r=0;r<this._children.length;r++){var n=this._children[r];n.inheritPickable&&(n.pickable=e)}},e.prototype.synPickable=function(){this.setPickable(this._pickable)},e.prototype.localToSelf=function(e){return this.worldToSelf(this.localToWorld(e))},e.prototype.selfToLocal=function(e){return this.worldToLocal(this.selfToWorld(e))},e.prototype.worldToSelf=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=Et.parseVector3(e);return this.node.updateWorldMatrix(!0),t?(this.node.matrixWorld.decompose(Ei,Ti,wi),Mi.compose(Ei,Ti,wi.set(1,1,1)),Ci.getInverse(Mi),Ei.fromArray(e).applyMatrix4(Ci).toArray()):this.node.worldToLocal(i).toArray()},e.prototype.selfToWorld=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e=Et.parseVector3(e);if(this.node.updateWorldMatrix(!0),t){var r=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Quaternion;this.node.matrixWorld.decompose(r,o,n);var s=new THREE.Matrix4;return s.compose(r,o,i?this.node.parent._getWorldScale():new THREE.Vector3(1,1,1)),e.applyMatrix4(s).toArray()}return this.node.localToWorld(e).toArray()},e.prototype.localToWorld=function(e){return this._parent?this._parent.selfToWorld(e):this.node.localToWorld(Et.parseVector3(e)).toArray()},e.prototype.worldToLocal=function(e){if(this._parent)return this._parent.worldToSelf(e);var t=Et.parseVector3(e);return this.node.worldToLocal(t).toArray()},e.prototype.distanceTo=function(e){return e?(e.isBaseObject&&(e=e.position),Et.parseVector3(this.position).distanceTo(Et.parseVector3(e))):0},e.prototype._lookAtPosition=function(){this.node._lookAtPosition(this._lookingAtObject,this.static),this.synIndependentWorldAngles()},e.prototype.lookAt=function(e,t){if(e){var i,r,n;if(t=t||{},Et.isArray(t)?i=t:(i=t.angles,r=Et.parseValue(t.lockYAxis,!1)),e.isBaseObject?n=e.position:e.isCameraController?n=e.cameraObject.position:(n=e,e=null),!n)return void THING.Utils.error("lookAt failed, due to target is not existing");var o=Et.parseValue(t.always,!0);if(this._lookingAtObject={target:e,targetPosition:Et.parseVector3(n),type:"axis",axis:r?"y":null,quat:Et.parseQuaternion(i)},this.node.quaternion.set(0,0,0,1),this.node.updateWorldMatrix(!0,!1),this.node.up.set(0,1,0),e&&e.isCameraController){var s=this.parents.query(".Campus")[0];if(s){var a=s.up;this.node.up.set(a[0],a[1],a[2])}}o?this.tickable=!0:(this._lookAtPosition(),this._lookingAtObject=null),this.selfUpdate(),this._updateLookAt()}else this._lookingAtObject=null,this.node.up.set(0,1,0)},e.prototype.rotate=function(e,t){var i=THING.Math.degToRad(e);(t=Et.parseVector3(t||[0,1,0])).normalize(),this.node.rotateOnAxis(t,i),this.synIndependentWorldAngles(),this.dirty=!0},e.prototype.rotateX=function(e){isNaN(e)||(this.node.rotateX(THING.Math.degToRad(e)),this._synWorldAngles())},e.prototype.rotateY=function(e){isNaN(e)||(this.node.rotateY(THING.Math.degToRad(e)),this._synWorldAngles())},e.prototype.rotateZ=function(e){isNaN(e)||(this.node.rotateZ(THING.Math.degToRad(e)),this._synWorldAngles())},e.prototype.rotateAround=function(e){var t=(e=e||{}).object,i=e.target,r=Et.parseValue(e.yRotateAngle||e.angle,0),n=Et.parseValue(e.xRotateAngle,0),o=e.time,s=e.speed,a=Et.parseLoopType(e.loopType),l=e.stop,u=e.update,c=e.complete;if(i&&(i.isBaseObject?(t=i,i=null):i=Et.parseVector3(i)),o){if(s=0,!r&&!n)return void THING.Utils.error("Please provide yRotateAngle or xRotateAngle to rotate around object")}else s?o=16777215:r||n?(s=0,o=1e3):(s=10,o=16777215);var h=Et.parseVector3(this.position),p=new THREE.Spherical,d=h.clone(),f=i||Et.parseVector3(t.position);d.sub(f),p.setFromVector3(d),this.stopRotating(),this.rotating=!0;var m=this.position,g=new THREE.Vector3,v=p.theta,y=p.phi,b=this,_=function(){a==THREE.LoopOnce?c&&c():a==THREE.LoopRepeat?(b.position=m,b.rotateAround(e)):a==THREE.LoopPingPong&&(void 0!==r&&(e.yRotateAngle=-r),void 0!==n&&(e.xRotateAngle=-n),b.rotateAround(e))},x=function(){var e=!1;if(s){var o=r>0?s:-1*s;p.theta+=o/1e3;var a=v+THING.Math.degToRad(r);r>0?p.theta>=a&&(p.theta=a,e=!0):p.theta<=a&&(p.theta=a,e=!0)}else{var c=this._object.progress;r&&(p.theta=v+c*THING.Math.degToRad(r)),n&&(p.phi=y+c*THING.Math.degToRad(n))}var h=i?i.clone():Et.parseVector3(t.position);if(p.radius=b.distanceTo(h.toArray()),p.makeSafe(),g.setFromSpherical(p),h.add(g),b.node.position.copy(h),u&&u(),e){var d=l;l=null,this.stop(),l=d,_.call(this)}};this.rotateTween=new TWEEN.Tween({progress:0}).to({progress:1},o).easing(S.Linear.None).onStop((function(){l&&l()})).onUpdate((function(){x.call(this)})).onComplete((function(){_.call(this)})),this.rotateTween.start()},e.prototype.rotateOnWorldAxis=function(e){e=e||{};var t=Et.parseVector3(e.axis),i=e.angle;if(t&&i){t.normalize();var r=THING.Math.degToRad(i);this.node.rotateOnWorldAxis(t,r),this.static&&this.node._synMatrixWorld()}},e.prototype.rotateTo=function(e){var t=(e=e||{}).quaternion,i=e.angles||e.localAngles,r=e.time,n=e.speed,o=e.lerpType||S.Linear.None,s=e.loopType||D.No,a=e.complete;if(t){var l=this.node.quaternion.clone(),u=t,c=new THREE.Quaternion,h=Et.getConsumeTimeByDistance(null,100,r,n,2e3);n&&(o=S.Linear.None),this.stopRotating(),this.rotating=!0;var p=this;this.rotateTween=new TWEEN.Tween({progress:0}).to({progress:1},h).easing(o).onUpdate((function(){var e=this._object.progress;c.copy(l),c.slerp(u,e),p.angles=Et.parseAngles(c)})).onComplete((function(){s==D.Repeat?(p.angles=Et.parseAngles(l),p.rotateTo(e)):s==D.PingPong?(e.quaternion=l,p.rotateTo(e)):a&&a.call(p,{object:p})})).start()}else if(i){var d=Et.parseVector3(this.angles),f=d.clone(),m=Et.parseVector3(i),g=Et.getConsumeTime(null,d,m,r,n,2e3);this.stopRotating(),this.rotating=!0;var v=this;this.rotateTween=new TWEEN.Tween(d).to(m,g).easing(o).onUpdate((function(){v.angles=[this._object.x,this._object.y,this._object.z]})).onComplete((function(){s==D.Repeat?(v.angles=f.toArray(),v.rotateTo(e)):s==D.PingPong?(e.angles=f.toArray(),v.rotateTo(e)):a&&a.call(v,{object:v})})).start()}},e.prototype.stopRotating=function(){this.rotating=!1,this.rotateTween&&this.rotateTween.stop()},e.prototype.scaleTo=function(e){var t=(e=e||{}).scale||[1,1,1],i=e.time,r=e.speed,n=e.lerpType||S.Linear.None,o=e.loopType||D.No,s=e.complete;t[2]=t[2]||1;var a=Et.parseVector3(this.scale),l=a.clone(),u=Et.parseVector3(t),c=Et.getConsumeTime(null,a,u,i,r,2e3);this.stopScaling(),this.scaling=!0;var h=this;this.scaleTween=new TWEEN.Tween(a).to(u,c).easing(n).onUpdate((function(){h.scale=[this._object.x,this._object.y,this._object.z]})).onStop((function(){})).onComplete((function(){o==D.Repeat?(h.scale=l.toArray(),h.scaleTo(e)):o==D.PingPong?(e.scale=l.toArray(),h.scaleTo(e)):s&&s.call(h,{object:h})})).start()},e.prototype.stopScaling=function(){this.scaling=!1,this.scaleTween&&this.scaleTween.stop()},e.prototype.canAcceptEvent=function(e){var t=e.type,i=e.object;if("update"==t)return this;if(T[t])return this;if(i){if("drag"==t&&this.app.events.eventProcessor._draggingObject==this)return this;if(i.isChildOf(this)){if("mouseover"==t)return this;if("mousedown"==t)return this;if("mouseup"==t)return this}}return null},e.prototype._createDispatchEvent=function(e){var t=this.app.events,i={};if(w[e]){var r=t.mouseMovePos;i=t.createMouseEvent(e,{clientX:r[0],clientY:r[1]})}return i},e.prototype._isAppEvent=function(e){return-1!==["drag","dragging","keydown","keypress","keyup"].indexOf(e)},e.prototype._on=function(e,t,i,r,n,o,s){if(!(e=Et.toLowerCase(e)))return THING.Utils.error("event type is invalid, please check it"),null;var a=Et.parseEvent(t,i,r,n,o);return a?a.selector||this._isAppEvent(e)?this.app.events.bindCallObj(e,a.selector,a.userData,a.callback,[this],a.tag,s,a.priority):("update"==e&&(this.tickable=!0),this._eventTrigger.addEventListener(e,this,null,a.callback,a.tag,a.priority,s,a.userData)):null},e.prototype._off=function(e,t,i){e=Et.toLowerCase(e);var r=Et.parseEvent(t,null,i);return r?r.selector?this.app.events.unbindCallObj(e,r.selector,r.callback,[this]):this._eventTrigger.removeEventListener(e,this,r.tag):null},e.prototype._pauseEvent=function(e,t,i,r){if(e=Et.toLowerCase(e),t)this.app.events.pauseEvent(e,t,i,r,this);else{this.parent&&this.parent.pauseEvent(e,this,i,r);var n=this._eventTrigger.getEventListener(e,this,null,i);n&&(n.paused=!0)}},e.prototype._resumeEvent=function(e,t,i){if(e=Et.toLowerCase(e),t)this.app.events.resumeEvent(e,t,i,this);else{this.parent&&this.parent.resumeEvent(e,this,i);var r=this._eventTrigger.getEventListener(e,this,null,i);r&&(r.paused=!1)}},e.prototype.on=function(e,t,i,r,n,o){for(var s=this._on(e,t,i,r,n,o),a=0;a<this._controls.length;a++){var l=this._controls[a].control;Et.isFunction(l.onRegisterEvent)&&l.onRegisterEvent(e,s)}return this},e.prototype.off=function(e,t,i){this.resumeEvent(e,t,i);for(var r=this._off(e,t,i),n=0;n<this._controls.length;n++){var o=this._controls[n].control;Et.isFunction(o.onUnregisterEvent)&&o.onUnregisterEvent(e,r)}return this},e.prototype.one=function(e,t,i,r,n,o){for(var s=this._on(e,t,i,r,n,o,!0),a=0;a<this._controls.length;a++){var l=this._controls[a].control;Et.isFunction(l.onRegisterEvent)&&l.onRegisterEvent(e,s,!0)}return this},e.prototype.hasAnyEvents=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.app.events.hasAnyCallObjects([this],e);return t||(t=!!this._eventTrigger.getEventListeners().length),t},e.prototype.hasEvent=function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e=Et.toLowerCase(e);var r=this.app.events.hasEvent(e,this,t,i);return r||(r=!!this._eventTrigger.getEventListener(e,this,null,t)),r},e.prototype.trigger=function(e,t,i){e=Et.toLowerCase(e);var r=this.app.events.dispatchBindCallObj(e,t,[this],i),n=this._eventTrigger.dispatchEvent(e,this,t,i);return Et.parseValue(r,n)},e.prototype.pauseEvent=function(e,t,i){this._pauseEvent(e,t,i,!1)},e.prototype.pauseEventInFrame=function(e,t,i){this._pauseEvent(e,t,i,!0)},e.prototype.resumeEvent=function(e,t,i){this._resumeEvent(e,t,i)},e.prototype.isPauseEvent=function(e,t,i){if(e=Et.toLowerCase(e),i){var r=this.getEvents(e);if(t){for(var n=!1,o=0;o<r.length;o++){var s=r[o];if(t&&s.tag==t){n=!0;break}}if(!n)return!0}else if(!r.length)return!0}var a=this.app.events.isPauseEvent(e,this,t);if(!a){var l=this._eventTrigger.getEventListener(e,this,null,t);if(l)return l.paused}return a},e.prototype.getEvents=function(e){e=Et.toLowerCase(e);var t=this.app.events.getEvents(e,this);if(!t)return[];for(var i=[],r=0;r<t.length;r++){var n=t[r];i.push({condition:n.condition,callback:n.callback,type:n.type,priority:n.priority,userData:n.userData,tag:n.tag,once:n.once})}return this._eventTrigger.getEventListeners(e,this).forEach((function(e){i.push({condition:null,callback:e.callback,type:e.type,priority:e.priority,userData:e.userData,tag:e.tag,once:e.once})})),i},e.prototype._traverseObjects=function(e,t){for(var i=0;i<this._children.length;i++){var r=this._children[i];Et.isFunction(e)?e(r):Et.isArray(e)&&e.push(r),t&&r._traverseObjects(e,t)}},e.prototype._isChildNode=function(e){for(var t=this.children,i=0,r=t.length;i<r;i++){var n=t[i];if(e==n.node||e.isChildOf(n.node))return!0}return!1},e.prototype._getChildNodes=function(){var e=[];return this.children.forEach((function(t){e.push(t.node)})),e},e.prototype._getAllChildNodes=function(){var e=[];return this._children.forEach((function(t){e.push(t.node)})),e},e.prototype._traverseSelfNodes=function(e){if(e){var t=this._getChildNodes();this.node.traverseBranch((function(i){if(-1!==t.indexOf(i))return!1;e(i)}))}},e.prototype._traverseAllSelfNodes=function(e){if(e){var t=this._getAllChildNodes();this.node.traverseBranch((function(i){if(-1!==t.indexOf(i))return!1;e(i)}))}},e.prototype.traverseSelfNodes=function(e){return this._traverseSelfNodes(e)},e.prototype.traverseAllSelfNodes=function(e){return this._traverseAllSelfNodes(e)},e.prototype._traverseNodes=function(e,t,i){for(var r=0;r<e.children.length;r++){var n=e.children[r],o=n.userData.baseObject_bindSubNode;o||((o=THING.SubObject.create(n,this)).name=n.name),Et.isFunction(t)?t(o):Et.isArray(t)&&t.push(o),i&&this._traverseNodes(n,t,i)}},e.prototype.isSubNode=function(){return!!this.node.userData.baseObject_bindSubNode},e.prototype.traverse=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&(e(this),this._traverseObjects(e,t))},e.prototype._check=function(e){var t=new $t(this.app,[this]);return t.select(e),!!t.length},e.prototype.query=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Et.isString(e)&&e.startsWith("/")){for(var r=0,n=0;n<e.length;n++)"/"==e[n]&&r++;if(1===r)return THING.Utils.warn("[BaseObject] Please use '.subNodes.query()' to replace it, and remove '/' prefix of params"),this.subNodes.query(new RegExp(e.substring(1)),t)}var o=[];this._traverseObjects(o,t),i&&o.push(this);var s=new $t(this.app,o);return s.select(e),s},e.prototype._queryChild=function(e){var t=new $t(this.app,this._children);return t.select(e),t},e.prototype.isChildOf=function(e){if(!e)return!1;for(var t=this._parent;t;){if(t==e)return!0;t=t.parent}return!1},e.prototype.isBrotherOf=function(e){if(!e)return!1;var t=this._parent;return!!t&&-1!==t._children.indexOf(e)},e.prototype.clearAttachPoints=function(){if(this._attachPoints){for(var e=0;e<this._attachPoints.length;e++)this._attachPoints[e].destroy();this._attachPoints=null}},e.prototype.isAttachPoint=function(e){if(e&&e.node)for(var t=["dummy:","point:","connector:"],i=0;i<t.length;i++)if(e.name.startsWith(t[i]))return!0;return!1},e.prototype.translate=function(e){this.node.translateX(e[0]),this.node.translateY(e[1]),this.node.translateZ(e[2]),this.static&&this.node._synMatrixWorld(),this.synIndependentWorldPosition(),this.dirty=!0},e.prototype.translateX=function(e){this.translate([e,0,0])},e.prototype.translateY=function(e){this.translate([0,e,0])},e.prototype.translateZ=function(e){this.translate([0,0,e])},e.prototype.moveTo=function(e){Et.isArray(e)&&(e={position:e});var t=e.offset||e.offsetPosition||e.localPosition,i=e.direction,r=Et.parseValue(e.ignoreScale,!0);if(t)t=Et.parseVector3(t);else if(i){t=Et.parseVector3(i);var n=Et.parseValue(e.distance,5);t.multiplyScalar(n)}t&&(e.position=this.selfToWorld(t.toArray(),r)),this.movePath(e)},e.prototype.createPathTween=function(e,t,i,r,n,o){var s,a=Et.parseVector3(e).clone(),l=Et.parseVector3(t).clone();if(i){!o&&n&&(o=new THREE.Matrix4,n.updateWorldMatrix(!0,!1),o.getInverse(n.matrixWorld));var u=new THREE.Matrix4,c=a.clone(),h=l.clone();c.applyMatrix4(o),h.applyMatrix4(o),u.lookAt(h,c,this.node.up);var p=new THREE.Quaternion;if(p.setFromRotationMatrix(u),r){var d=new THREE.Quaternion;d.setFromAxisAngle(new THREE.Vector3(0,1,0),THING.Math.degToRad(r)),p.multiply(d)}s=p}return{distance:a.distanceTo(l),from:a,to:l,toQuat:s}},e.prototype.createPathTweens=function(e,t,i,r){var n=new THREE.Matrix4;e&&(e.updateWorldMatrix(!0,!1),n.getInverse(e.matrixWorld));for(var o=0;o<t.length-1;o++){var s=t[o],a=t[o+1],l=this.createPathTween(s,a,i,r,e,n);this.pathTweens.push(l)}},e.prototype.startPathTweens=function(e,t,i,r,n,o,s,a,l,u,c,h){var p=function(e){for(var t=0,i=0;i<e.length;i++)t+=e[i].distance;return t}(this.pathTweens);if(p){i&&(e=p/i*1e3,s=S.Linear.None);var d=-1,f={progress:p},m=function(e,t){for(var i=[],r=0;r<e.length;r++)i.push(e[r].distance/t);return i}(this.pathTweens,p),g=new THREE.Vector3,v=new THREE.Quaternion,y=this;this.pathTween=new TWEEN.Tween({progress:0}).to(f,e).easing(s).delay(t).onUpdate((function(){var e=this._object.progress/p,t=Et.getArrayIndexFromProgress(y.pathTweens,e,m),i=Et.getArrayProgress(y.pathTweens,e,m),s=y.pathTweens[t];t!=d&&(d=t,r&&(s.fromQuat=y.node.quaternion.clone())),n?y.node.lookAt(n):r&&(o?(v.copy(a?s.fromQuat:y.node.quaternion),v.slerp(s.toQuat,i),y.angles=Et.parseAngles(v)):y.angles=Et.parseAngles(s.toQuat)),g.copy(s.from),g.lerp(s.to,i),y.position=g.toArray(),l&&l({progress:e,fromPosition:s.from.toArray(),toPosition:s.to.toArray()})})).onStart((function(){u&&u()})).onStop((function(){c&&c()})).onComplete((function(){h&&h()})).start()}else h&&h()},e.prototype.movePath=function(e){var t,i=(e=e||{}).path,r=e.time||1e3,n=Et.parseValue(e.delayTime,0),o=e.speed,s=Et.parseValue(e.local,!1),a=Et.parseValue(e.orientToPath,!1),l=e.orientToPathDegree,u=e.lookAt,c=e.loopType,h=function(e){return null!==e.lerp&&null!==e.lerpType&&Et.parseValue(e.lerp,!0)}(e),p=e.lerpType||S.Linear.None,d=Et.parseValue(e.smooth,!0),f=e.update,m=e.complete;e.loop&&(c=D.Repeat,THING.Utils.warn('[BaseObject] movePath() use "loopType(THING.LoopType)" to instead "loop(Boolean)" argument'));var g=this.parents.query(".Campus")[0];if(t=g?g.node:this.node.parent,i){if(e.path=i.concat(),s){for(var v=[],y=0;y<i.length;y++)v.push(this.localToWorld(i[y]));i=v}1===i.length&&(i=[this.position,i[0]])}else{var b=e.position;b&&(i=b.isBaseObject?[this.position,b.position]:[this.position,b]),i&&(e.path=i.concat())}if(i&&0!=i.length){u&&(a=null,u=Et.parseVector3(u)),this.stopMoving();var _=[];for(y=0;y<i.length;y++){var x=null;2==i[y].length?x=new THREE.Vector3(i[y][0],this.position[1],i[y][1]):3==i[y].length&&(x=Et.parseVector3(i[y])),_.push(x)}this.createPathTweens(t,_,a,l);var E=this.pathTweens[0].from;this.position=[E.x,E.y,E.z];var w=this;this.startPathTweens(r,n,o,a,u,h,p,d,(function(e){f&&(e.object=w,f.call(w,e))}),(function(){}),(function(){}),(function(){c==D.Repeat?w.movePath(e):c==D.PingPong?(e.path.reverse(),void 0!==e.orientToPathDegree&&(e.orientToPathDegree=360-e.orientToPathDegree),w.movePath(e)):m&&m.call(w,{object:w})}))}else THING.Utils.error("You must provide the path or position to call moveTo()")},e.prototype.stopMoving=function(){this.pathTweens=[],this.pathTween&&this.pathTween.stop()},e.prototype.hasAttribute=function(e){return Et.hasAttribute(this,e)},e.prototype.getAttribute=function(e){return Et.getAttribute(this,e)},e.prototype.setAttribute=function(e,t){return Et.setAttribute(this,e,t)},e.prototype.setAttributes=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(var i in e=e||{})(t||Et.isUndefined(this.getAttribute(i)))&&this.setAttribute(i,e[i])},e.prototype._updateLookAt=function(){if(this._lookingAtObject){if(this._lookingAtObject.target){var e=this._lookingAtObject.target.position;this._lookingAtObject.targetLocalPosition=Et.parseVector3(this.worldToLocal(e)),this._lookingAtObject.targetPosition=Et.parseVector3(e)}this._lookAtPosition()}},e.prototype.selfUpdate=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=this,r=0;this._style&&this._style.update&&(r|=this._style.update(t)),this._localClippingPlanes.length&&(this._localClippingPlanes.forEach((function(t){var i=t.basePlane,r=_i.getNormalMatrix(e.node.matrixWorld),n=bi.copy(i.normal).multiplyScalar(-i.constant),o=i.normal.clone().applyMatrix3(r).normalize(),s=-n.dot(o),a=t.localPlane;a.normal=o,a.constant=s})),r=!0),this._lodNode&&(-1!=this._lodLevel?this._lodNode.setLevel(this._lodLevel):this._lodNode.update(this.app.renderCamera),r=!0),this._lookingAtObject&&(this.visible&&this._updateLookAt(),r=!0),this._independentPosition&&(this.visible&&this._getIndependentControlRenderNode()._setWorldPosition(this._independentPosition.clone(),this.static),r=!0),this._independentWorldAngles&&(this.visible&&this._getIndependentControlRenderNode()._setWorldAngles(this._independentWorldAngles.clone(),this.static),r=!0),this._independentWorldScale&&(this.visible&&this._getIndependentControlRenderNode()._setWorldScale(this._independentWorldScale.clone(),this.static),r=!0);var n=this.builder;n&&n.startToBuildingQueue&&n.startToBuildingQueue.length&&(n._isBuilding||n._old_build_version==n._build_version||(n._old_build_version=n._build_version,n._isBuilding=!0,n.startToBuild((function(e){for(var t=n.startToBuildingQueue,r=t.length,o=0;o<r;o++)if(!(t[o].version>n._build_version)){var s=t[o].progressCallback;s&&s({progress:e}),1==e&&(t.splice(o--,1),r--)}1==e?(n._isBuilding=!1,n.campus.static&&n.campus.node._synMatrixWorld()):i.tickable=!0}))),r=!0);var o=this._eventTrigger.getEventListeners("update",this);return o.forEach((function(i){e._eventTrigger.invokeListener(i,{deltaTime:t}),r=!0})),r},e.prototype.update=function(e){for(var t=this.selfUpdate(e),i=0;i<this._controls.length;i++){var r=this._controls[i].control,n=r.onUpdate;n&&(t|=n.call(r,e))}return t},e.prototype.createGrid=function(e,t,i,r){this._grid=this.app.create({type:"Grid",size:e,divisions:t,color1:i,color2:r,parent:this}),this._grid.style.skipBoundingBox=!0,this._grid.userData.topNode=!0,this._grid.userData.skipOutline=!0,this._grid.userData.independent=!0,this._grid.canNotQueryFromSelector=!0;this._grid.translateY(-.01)},e.prototype.showGrid=function(e,t,i,r){var n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(Et.isBoolean(e)){var o=e;o&&(this._grid||this.createGrid(300,28,1131673,1131673)),this._grid&&(this._grid.visible=o)}else if(this._grid&&(this._grid.destroy(),this._grid=null),this.createGrid(e,t,i,r),n){var s=e;Et.isNumber(n)&&(s=n),this._grid.addPickableGround({size:s})}},e.prototype.stopFade=function(){this.fadeTween&&(this.fadeTween.stop(),this.fadeTween=null)},e.prototype.fade=function(e,t){var i=(e=e||{}).time||1e3,r=e.complete;this.stopFade();var n={opacity:this.style.opacity},o={opacity:t};this.visible=!0;var s=this;this.fadeTween=new TWEEN.Tween(n).to(o,i).easing(TWEEN.Easing.Linear.None).onUpdate((function(){s.style.opacity=this._object.opacity})).onComplete((function(){0==s.style.opacity&&(s.visible=!1),r&&r.call(s,{object:s})})).start()},e.prototype.fadeIn=function(e){this.style.opacity=0,this.fade(e,1)},e.prototype.fadeOut=function(e){this.style.opacity=1,this.fade(e,0)},e.prototype.setClippingPlanes=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Et.isObject(t)&&(t=[t]),this.clearClippingPlanes(),t.forEach((function(t){var i=t.height,r=Et.parseVector3(t.direction,new THREE.Vector3(0,-1,0)),n=new THREE.Plane(r,i),o=n.clone();e._localClippingPlanes.push({basePlane:n,localPlane:o})}));var i=this;this.node.traverse((function(e){e.isMesh&&(e._clip_prev_material=e.material,e.material=e.material.clone(),e.material.clippingPlanes=i._localClippingPlanes.map((function(e){return e.localPlane})))})),this.tickable=!0},e.prototype.clearClippingPlanes=function(){this.node.traverse((function(e){e.isMesh&&e._clip_prev_material&&(e.material=e._clip_prev_material,e.material.clippingPlanes=null)})),this._localClippingPlanes=[]},e.prototype.toJSON=function(){return{type:this.type,id:this.id,name:this.name,position:this.position,angles:this.angles,scale:this.scale,style:{color:this.style.color,opacity:this.style.opacity,outlineColor:this.style.outlineColor,alwaysOnTop:this.style.alwaysOnTop,glow:this.style.glow,innerGlow:this.style.innerGlow,renderOrder:this.style.renderOrder}}},e.prototype.addControl=function(e,t,i){if(e){if(Et.isString(t)&&(i=i||t,t={},this.removeControl(i)),!Et.isNumber(e)){if(this.hasControl(e))return THING.Utils.error("The control is existing when addControl() with '"+e+"'"),null;this._controls.push({control:e,name:i});var r=e.onAdd;return Et.isFunction(r)&&r.call(e,this),this.tickable=!0,this.visible&&(this.app.needUpdate=!0),e}for(var n=[],o=0;o<n.length;o++){var s=n[o];if(s.id==e){var a=new s.type(this);return a.setup(t),this.addControl(a)}}return null}},e.prototype.getControl=function(e){for(var t=0;t<this._controls.length;t++)if(e==this._controls[t].name)return this._controls[t].control;return null},e.prototype.removeControl=function(e){if(e){var t=!1;if(Et.isString(e)){for(var i=0;i<this._controls.length;i++)if(this._controls[i].name==e){(n=(r=this._controls[i].control).onRemove)&&n.call(r),this._controls.splice(i,1),t=!0;break}}else for(i=0;i<this._controls.length;i++)if(this._controls[i].control==e){var r,n;(n=(r=this._controls[i].control).onRemove)&&n.call(r),this._controls.splice(i,1),t=!0;break}t&&this.visible&&(this.app.needUpdate=!0)}},e.prototype.removeAllControls=function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=0;t<this._controls.length;t++){var i=this._controls[t].control,r=i.onRemove;r&&r.call(i)}this._controls=[],e&&this.visible&&(this.app.needUpdate=!0)},e.prototype.hasControl=function(e){if(Et.isString(e)){for(var t=0;t<this._controls.length;t++)if(e==this._controls[t].name)return!0}else if(-1!==this._controls.indexOf(e))return!0;return!1},e.prototype.setWorldPosition=function(e){var t=Et.parseVector3(e);this.node._setWorldPosition(t,this.static),this.dirty=!0},e.prototype.setWorldAngles=function(e){var t=Et.parseQuaternion(e);this.node._setWorldAngles(t,this.static),this.dirty=!0},e.prototype.setWorldScale=function(e){var t=Et.parseVector3(e);this.node._setWorldScale(t,this.static),this.dirty=!0},e.prototype.setLocalPosition=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=Et.parseVector3(e),r=Et.parseValue(t,this._ignoreParentScale);if(r){var n=this.node.parent;if(n){var o=new THREE.Vector3;this.node.updateWorldMatrix(!0,!1),n.getWorldScale(o),i.divide(o)}}this.localPosition=i.toArray()},e.prototype.getLocalPosition=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.node.position.clone();if(e){var i=new THREE.Vector3;this.node.updateMatrixWorld(),this.node.getWorldScale(i),t.multiply(i)}return t.toArray()},e.prototype._setScale=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",i=Et.parseVector3(e);0==i.x&&(THING.Utils.error("Please check scale-x value, it can not be zero"),i.x=Number.EPSILON),0==i.y&&(THING.Utils.error("Please check scale-y value, it can not be zero"),i.y=Number.EPSILON),0==i.z&&(THING.Utils.error("Please check scale-z value, it can not be zero"),i.z=Number.EPSILON),yi.set(1,1,1),this._scaleGroupStates.enable(i,t),this._scaleGroupStates.states.forEach((function(e){var t=e.value;yi.multiply(t)}));var r=this._getIndependentControlRenderNode();this.anchorNode&&(r=this.anchorNode),r.scale.copy(yi),this.synIndependentWorldScale(),this.static&&this.node._synMatrixWorld(),this.dirty=!0},e.prototype._getScale=function(e){if(e){var t=this._scaleGroupStates.getValue(e);return t?t.toArray():[1,1,1]}var i=this._getIndependentControlRenderNode();return this.anchorNode&&(i=this.anchorNode),i.scale.toArray()},e.prototype._synWorldAngles=function(){this.dirty=!0,this.synIndependentWorldAngles(),this.static&&this.node._synMatrixWorld()},e.prototype._getAttributeFromSelfToRoot=function(e){for(var t=this;t;t=t.parent){var i=t.node.userData[e];if(i)return i}return null},e.prototype._getBaseMatrix=function(){return this._getAttributeFromSelfToRoot("_baseMatrix")},e.prototype._getPosition=function(){this.node.updateWorldMatrix(!0,!1);var e=new THREE.Vector3;return this.node.getWorldPosition(e),e.toArray()},e.prototype._setPosition=function(e){e&&(this.setWorldPosition(e),this.synIndependentWorldPosition())},e.prototype._needUseWorldPosition=function(){var e=this._parent;return!!e&&e.node!=this.node.parent},e.prototype._setLocalPosition=function(e){if(this.anchorNode){var t=Et.parseVector3(this.parent.selfToWorld(e));this.node._setWorldPosition(t,this.static)}else if(this._needUseWorldPosition()){var i=Et.parseVector3(this._parent.selfToWorld(e));this.node._setWorldPosition(i,this.static)}else{var r=Et.parseVector3(e);this.node.position.copy(r),this.static&&this.node._synMatrixWorld()}this._setDirtyFlag(!1,!0,!0);var n=this._notifyPositionChange;n&&n.call(this)},e.prototype._getLocalPosition=function(){if(!this._parent)return[0,0,0];if(this.anchorNode)return this._parent.worldToSelf(this.position);if(this._needUseWorldPosition()){var e=new THREE.Vector3;return this.node.getWorldPosition(e),this._parent.node.worldToLocal(e),e.toArray()}return(e=this.node.position).toArray()},e.prototype._getAngles=function(){var e=this.node.parent;if(e&&e.userData.childUseWorldAnglesAlways)return this.worldAngles;return this.anchorNode?this.anchorNode.getAngles():this.node.getAngles()},e.prototype._setAngles=function(e){if(!THING.Math.equalsVector(this.angles,e)){var t=this.node;this.anchorNode&&(t=this.anchorNode),t.setAngles(e),this._synWorldAngles()}},e.prototype._getQuaternion=function(){var e=this.node.parent;if(e&&e.userData.childUseWorldAnglesAlways)return this.worldQuaternion;return this.anchorNode?this.anchorNode.quaternion.toArray():this.node.quaternion.toArray()},e.prototype._setQuaternion=function(e){if(e.isQuaternion&&(e=e.toArray()),!THING.Math.equalsVectorX(this.node.quaternion.toArray(),e)){var t=this.node;this.anchorNode&&(t=this.anchorNode),t.quaternion.fromArray(e),this._synWorldAngles()}},e.prototype.setAnchorPosition=function(e){if(e){var t=this.anchorNode;t?(t.children[0].getWorldPosition(vi),fi.fromArray(e),t._setWorldPosition(fi,!1,this.static),t.updateWorldMatrix(!1,!1),t.children[0]._setWorldPosition(vi,this.static)):(t=new THREE.Object3D,this.node.parent.add(t),fi.fromArray(e),t._setWorldPosition(fi,this.static),t.updateWorldMatrix(!1,!1),t.attach(this.node),this.anchorNode=t)}else this.anchorNode&&(this.anchorNode.parent.attach(this.anchorNode.children[0]),this.anchorNode.removeBySelf(),this.anchorNode=null)},e.prototype.getAnchorPosition=function(){var e=this.anchorNode;return e?(e.getWorldPosition(vi),this.worldToSelf(vi.toArray())):null},e.prototype.getBoundingBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.boundingBoxControl.getBoundingBox(e,t)},e.prototype.getOrientedBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.boundingBoxControl.getOrientedBoundingBox(e,t)},e.prototype.getLocalBoundingBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.boundingBoxControl.getLocalBoundingBox(e,t)},e.prototype._setBoundingBoxPivot=function(e){this.node.userData.boundingBoxPivot=e,this.dirty=!0},e.prototype._getBoundingBoxPivot=function(){var e=this.node.userData.boundingBoxPivot;return e||null},e.prototype._setBoundingBoxSize=function(e){e&&(isNaN(e[0])&&THING.Utils.error("_setBoundingBoxSize() failed, value[0] is NaN",this),isNaN(e[1])&&THING.Utils.error("_setBoundingBoxSize() failed, value[1] is NaN",this),isNaN(e[2])&&THING.Utils.error("_setBoundingBoxSize() failed, value[2] is NaN",this)),this.node.userData.boundingBoxSize=e,this.dirty=!0},e.prototype._getBoundingBoxSize=function(){var e=this.node.userData.boundingBoxSize;return e||null},e.prototype._updateKeepSize=function(e,t,i,r){return this._keepSize!=e&&(this._keepSize=e,e?(r=r||this.distanceTo(this.app.camera.position),i=i||this.scale,this.addControl(new ci(i,t,r),"SizeAdjustmentControl")):this.removeControl("SizeAdjustmentControl"),!0)},e.prototype.getOffsetPosition=function(e){if(e=e||{},!Et.isNull(e.xAngle)||!Et.isNull(e.yAngle)){var t=Et.parseValue(e.yAngle,0),i=Et.parseValue(e.xAngle,0),r=Et.parseValue(e.distance,e.radius);if(void 0===r){var n=Et.parseValue(e.onlyVisible,!0);r=this.boundingBoxControl.getBoundingBox(n).radius}var o=e.radiusFactor;return o&&(r*=o),(new THREE.Vector3).getDirectionFromAngles(t,i,r).toArray()}if(e.direction){var s=Et.parseVector3(e.direction),a=e.distance||e.radius;s.multiplyScalar(a);var l=Et.parseVector3(this.position);return l.add(s),this.worldToSelf(l.toArray())}},e.prototype.getWorldPosition=function(e){var t=this.getOffsetPosition(e)||[0,0,0];return this.selfToWorld(t)},e.prototype.getLayoutPosition=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!Et.isArray(e))return null;if(3!==e.length)return null;var o=i?this.getOrientedBox(r,n):this.getBoundingBox(r,n),s=o.points,a=[];if(i)for(var l=0;l<s.length;l++)a.push(this.worldToSelf(s[l]));else a=s.concat();var u=[[a[0],a[1]],[a[0],a[4]],[a[0],a[2]]],c=function(e,t){var i=0;Et.isString(t)?t.equals("left",!0)||t.equals("bottom",!0)||t.equals("back",!0)?i=0:t.equals("right",!0)||t.equals("top",!0)||t.equals("front",!0)?i=1:t.equals("center",!0)&&(i=.5):Et.isNumber(t)?i=t:THING.Utils.error("get layout position failed, due to unknown layout type("+t+")");var r=Et.parseVector3(e[0]),n=Et.parseVector3(e[1]);return r.lerp(n,i),r},h=c(u[0],e[0]).x,p=c(u[1],e[1]).y,d=c(u[2],e[2]).z,f=[h,p,d];if(i||(f=this.worldToSelf(f)),t){var m=this.worldToSelf(t);f=THING.Math.subVector(m,f)}return f=this.selfToWorld(f)},e.prototype._setStyle=function(e){this._style=e},e.prototype._getStyle=function(){return this._style||(this._style=this.app.styleManager.createStyle("Default",this),this._defaultStyle=this._style),this._style},e.prototype.applyTheme=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.style._inheritThemeName=e||null,t&&this.children.forEach((function(t){t.inheritTheme&&t.applyTheme(e,!0,i)})),this.userData.SKIP_THEME||"Facade"==this.type&&this.building&&this.building.userData.SKIP_THEME||("CombinedObject"===this.type?this.loaded?this._parent.applyTheme(e,t,!0):this.waitCommands.push({type:"ApplyObjectTheme",object:this._parent,params:{name:e,traverse:t,force:!0}}):this.loaded?this.style._applyTheme&&this.style._applyTheme(e,i):this.waitCommands.push({type:"ApplyObjectTheme",object:this,params:{name:e,traverse:!1,force:i}}))},e.prototype._getChildVisibles=function(){var e=[];return this.children.forEach((function(t){e.push(t.visible)})),e},e.prototype._onGetChild=function(){return this.children},e.prototype._setChildVisible=function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",r=this._onGetChild(),n=0;n<r.length;n++){var o=r[n];if(o)if(o.inheritVisible)o._setVisible(e,i);else for(var s=t[n],a=o._visibleGroupStates.states,l=0;l<a.length;l++){var u=a[l];if(u.value==s){o._setVisible(s,u.name);break}}}},e.prototype._setNodeVisible=function(e){var t=this;this._traverseSelfNodes((function(i){i.userData.asBoundingBox||i.ensureVisible(e,t._autoSynVisible)}))},e.prototype._getHidePermission=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=this._visibleGroupStates.states,i=0;i<t.length;i++){var r=t[i];if(r.name!=e&&r.value)return!1}return!0},e.prototype.setVisible=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.renderNode.visible=e,t&&this.children.forEach((function(i){i.setVisible(e,t)}))},e.prototype._setVisible=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";if(!this._hideNodesInScene){this._visibleGroupStates.enable(e,t);var i=this._visibleGroupStates.isAnyEnable();THING.disableVisibleGroupStates&&(i=this._visibleGroupStates.has("default")?this._visibleGroupStates.isEnable("default"):this.visible);var r=this.visible,n=this._notifyBeforeChangeVisible;n&&n.call(this);var o=this._getChildVisibles();i&&this._autoEnsureParentsVisible&&this.node.ensureParentsVisible(i),this._setNodeVisible(i),this._setChildVisible(e,o,t);for(var s=0;s<this._controls.length;s++){var a=this._controls[s].control;Et.isFunction(a.onVisible)&&a.onVisible(i)}var l=this._notifyAfterChangeVisible;l&&l.call(this),r!=i&&(this.dirty=!0)}},e.prototype._getVisible=function(){return!this._hideNodesInScene&&(!!this.node.visible&&this.node.getLayerVisible())},e.prototype._getChildrenSelector=function(){var e=new $t(this.app,this.children);return e.buildReturnObject(this.children),e},e.prototype._getChildren=function(){return this._children.result},e.prototype._getBrothers=function(){var e=this,t=void 0,i=this._parent;t=i?i._children.filter((function(t){return t!==e&&!t.isCombinedObject})):[];var r=new $t(this.app,t);return r.buildReturnObject(t),r},e.prototype._getParents=function(){for(var e=[],t=this._parent;t;t=t.parent)t.isCombinedObject||e.push(t);var i=new $t(this.app,e,!0);return i.buildReturnObject(e),i},e.prototype.indexOfParent=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._parent;if(!t)return-1;var i=this._parent._children.indexOf(this);if(-1===i)return-1;if(e){i=0;for(var r=this._parent._children,n=0;n<r.length;n++){var o=r[n];if(o==this)return i;o.type==this.type&&i++}}return i},e.prototype._loadResource=function(e){e&&this._children.forEach((function(e){e.loadResource()}))},e.prototype._unloadResource=function(e){e&&this._children.forEach((function(e){e.unloadResource()}))},e.prototype._notifyLoadingObjects=function(){var e=this.parents.query(".Campus")[0];e&&e._loadingObjects.add(this)},e.prototype._loadSelfResource=function(){var e=this.builder;e&&e.requestToBuild&&e.requestToBuild(this.uuid)},e.prototype.loadResource=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.builder;t&&t.requestToBuild&&(this._loadResource(e),this._notifyLoadingObjects(),this._loadSelfResource(),this.loaded&&(this.dataToRecover=this.toJSON()))},e.prototype.unloadResource=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._unloadResource(e),this._boxNode&&this._boxNode.removeBySelf();var t=[],i=this;this._traverseSelfNodes((function(e){(i.app.resourceManager.unload(e,!1,!1,!1,!1),e._skipDispose)?t.push(e):e.material&&(e.disposeMaterial(),t.push(e))})),t.forEach((function(e){i.app.picker.removePickingResources(e),e.removeBySelf()}));var r=this.builder;r&&r.disposeObject&&r.disposeObject(this.uuid),this._boxNode&&this.node.add(this._boxNode),this.loaded=!1},e.prototype.setBoxNode=function(e){e.userData.asBoundingBox=!0,e.userData.skipStyle=!0,e.userData.useToCaculateBoundingBox=!0,this._boxNode=e,this.node.add(e)},e.prototype.startToBuild=function(e){var t=this.builder;t&&Et.isFunction(t.startToBuild)&&(t._old_build_version=t._build_version,t._build_version=t._build_version||1,t._build_version++,t.startToBuildingQueue=t.startToBuildingQueue||[],t.startToBuildingQueue.push({version:t._build_version,progressCallback:e}),this.tickable=!0)},e.prototype.clearNode=function(e){this._url&&(this.app.modelResource.unload(this._url),this._url=null),this.removePickingResources(),this.app.resourceManager.remove(this.node,e)},e.prototype.cloneSelf=function(e){return this.app.create(e)},e.prototype.clone=function(e,t){var i=this,r=this.node.cloneByFilter((function(e){for(var t=0;t<i._children.length;t++){var r=i._children[t].node;if(e==r||e.isChildOf(r))return!1}return!0}));r.traverse((function(e){e.userData={}}));var n={type:this.type,url:this.url,position:this.position,angles:this.angles,scale:this.scale,visible:this.visible,parent:t||this._parent,node:r},o=this.cloneSelf(n);if(!o)return null;if(e)for(var s=0;s<this._children.length;s++)this._children[s].clone(e,o);return o},e.prototype.getEnvMapResources=function(){for(var e=this.parent;e;e=e.parent){var t=e.envMapResources;if(t)return t}return null},e.prototype._synEffectRefCounts=function(){var e=this.app.effectManager;e&&this.node.traverse((function(t){e.synEffect(t)}))},e.prototype._processBillboard=function(e,t){var i=this;e.setUserDataValue("skipOutline",!0),t.billboard=!0,e._lookAt(t,(function(){return i.static}))},e.prototype._processModel=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.app.isMobileDevice,n=this._useShadow&&!r,o=this.app.effectManager;i=i&&!!o,this.node.traverse((function(s){var a=s.userData.gltfExtensions;a&&a.billboard&&(a.billboard.axis="y",e._processBillboard(s,a.billboard),delete a.billboard);var l=s.material;t&&l&&!s.__effectInited&&(s.__effectInited=!0,Array.isArray(l)?l.forEach((function(e){return e.needsUpdate=!0})):l.needsUpdate=!0,s.isMesh&&!s.isSky&&(s.castShadow=n,s.receiveShadow=n),l.map&&(l.map.anisotropy=r?1:16,l.map.version>0&&(l.map.needsUpdate=!0))),i&&o.synEffect(s)}))},e.prototype.synIndependentWorldPosition=function(){if(this._independentControlFlags.has(k.Position)){var e=new THREE.Vector3;this._getIndependentControlRenderNode().getWorldPosition(e),this._independentPosition=e}var t=this._notifyPositionChange;t&&t.call(this)},e.prototype.synIndependentWorldAngles=function(){if(this._independentControlFlags.has(k.Rotation)){var e=this._getIndependentControlRenderNode().quaternion.clone();this._independentWorldAngles=e}var t=this._notifyAnglesChange;t&&t.call(this)},e.prototype.synIndependentWorldScale=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._independentControlFlags;if(!(t=Et.parseValue(this.inheritScale,t))||i.has(k.Scale)){var r=this._getIndependentControlRenderNode()._getWorldScale(),n=this.node.parent;if(n){var o=n._getWorldScale();r.divide(o)}this._independentWorldScale?this._independentWorldScale.copy(r):this._independentWorldScale=r,e&&(this.dirty=!0)}var s=this._notifyScalesChange;s&&s.call(this)},e.prototype.synIndependentTransform=function(){var e=this._independentControlFlags;e.has(k.Position)&&this.synIndependentWorldPosition(),e.has(k.Rotation)&&this.synIndependentWorldAngles(),e.has(k.Scale)&&this.synIndependentWorldScale()},e.prototype._getIndependentControlRenderNode=function(){return this.node},e.prototype._useIndependentTransform=function(e){var t=this._getIndependentControlRenderNode();e.updateWorldMatrix(!0);var i=e.matrixWorld,r=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Quaternion;i.decompose(r,o,n);var s=new THREE.Matrix4;s.getInverse(t.matrixWorld);var a=new THREE.Matrix4;if(a.premultiply(s),a.multiply(i),t.updateWorldMatrix(!0),this._independentPosition?r=this._independentPosition.clone():r.setFromMatrixPosition(t.matrixWorld),this._independentWorldAngles){if(o=this._independentWorldAngles.clone(),!this._independentPosition){var l=this.parent.node,u=this.parent.node.getMatrixWorldFromRoot(l.parent),c=new THREE.Matrix4;this._independentWorldScale||(c.compose(new THREE.Vector3,new THREE.Quaternion,l.scale),u.multiply(c)),u.multiply(t.matrix);var h=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Quaternion;u.decompose(h,d,p),r=h}}else t.matrixWorld.decompose(fi,o,mi);this._independentWorldScale?n=this._independentWorldScale.clone():t.matrixWorld.decompose(fi,gi,n);var f=new THREE.Matrix4;f.compose(r,o,n),i.multiplyMatrices(f,a)},e.prototype._useIndependentRaycast=function(e){var t=this._getIndependentControlRenderNode();if(t)if(e){t.userData.original_raycast=t.userData.original_raycast||t.raycast;var i=this;t.raycast=function(e,t){var r=i._getIndependentControlRenderNode();return r&&i._useIndependentTransform(r),this.userData.original_raycast.call(this,e,t)}}else t.userData.original_raycast&&(t.raycast=t.userData.original_raycast,delete t.userData.original_raycast)},e.prototype._enableIndependentControl=function(){var e=this;this._traverseSelfNodes((function(e){e.removeBeforeRenderFunction("independentControlRender",!1)}));var t=!1,i=this._independentControlFlags;if(i.has(k.Transform)){this.node.traverse((function(e){Et.backupValue(e,"frustumCulled"),e.frustumCulled=!1})),this.synIndependentTransform(),this.tickable=!0;var r=this._getIndependentControlRenderNode();if(!r.hasBeforeRenderFunction("independentControlRender")){e=this;r.addBeforeRenderFunction("independentControlRender",(function(t,i,r){e._useIndependentTransform(this)}),0)}t=!0}else this.node.traverse((function(e){Et.revertValue(e,"frustumCulled")}));return i.has(k.Position)||(this._independentPosition=null),i.has(k.Rotation)||(this._independentWorldAngles=null),i.has(k.Scale)||(this._independentWorldScale=null),this._useIndependentRaycast(t),t},e.prototype.enableIndependentControl=function(e,t){if(this._independentControlFlags.enable(e,t))return this._enableIndependentControl()},e.prototype.stopAllLerpTo=function(){for(var e=0;e<this._tweens.length;e++)this._tweens[e].tween.stop();this._tweens=[]},e.prototype.stopLerpTo=function(e){for(var t=0;t<this._tweens.length;t++)e==this._tweens[t].name&&(this._tweens[t].tween.stop(),this._tweens.splice(t--,1))},e.prototype.lerpTo=function(e,t){var i=function(e){for(var t={},i=Object.keys(e),r=0;r<i.length;r++){var n=i[r],o=e[n];if(Et.isArray(o)){if(3==o.length)(s=Et.parseVector3(o))&&(o=s,t["__"+n+"_x"]=o.x,t["__"+n+"_y"]=o.y,t["_#vector3"+n]=o.z);else if(2==o.length){var s;(s=Et.parseVector2(o))&&(o=s,t["__"+n+"_x"]=o.x,t["_#vector2"+n]=o.y)}}else t[n]=o}return t},r=function(e,t){var i=e.stop;e.start=null,e.stop=null,m.lerpTo(e,t),e.stop=i},n=function(e,t,i){for(var r=0;r<e.length;r++){if(!(o=e[r]).startsWith("__")){var n=i[o];if(o.startsWith("_#vector3"))n=[i["__"+(o=o.substring(9))+"_x"],i["__"+o+"_y"],n];else if(o.startsWith("_#vector2")){var o;n=[i["__"+(o=o.substring(9))+"_x"],n]}else n=i[o];Et.setAttribute(t,o,n)}}},o=i((e=e||{}).from||{}),s=i(e.to||{}),a=e.time||1e3,l=Et.parseValue(e.delayTime,0),u=e.update,c=e.complete,h=e.lerpType||THING.LerpType.Linear.None,p=Et.parseLoopType(e.loopType);o.__progress=Et.parseValue(o.__progress,0),s.__progress=Et.parseValue(s.__progress,1);var d=0;t&&this.stopLerpTo(t);var f=Object.keys(o),m=this,g=new TWEEN.Tween(o).to(s,a).delay(l).easing(h).onStop((function(){var t={object:m};n(f,t,this._object),n(f,m,this._object),e.stop&&e.stop.call(m,t)})).onStart((function(){var t={object:m,delta:0};n(f,t,this._object),n(f,m,this._object),e.start&&e.start.call(m,t)})).onUpdate((function(){var e=this._object.__progress-d;d=this._object.__progress;var t={object:m,delta:e};n(f,t,this._object),n(f,m,this._object),u&&u.call(m,t)})).onComplete((function(){var i=this._object.__progress-d;d=this._object.__progress;var o={object:m,delta:i};if(n(f,o,this._object),n(f,m,this._object),p==THREE.LoopOnce)c&&c.call(m,o);else if(p==THREE.LoopRepeat)r(e,t);else if(p==THREE.LoopPingPong){var s=e.from;e.from=e.to,e.to=s,r(e,t)}})).start();this._tweens.push({name:t,tween:g})},e.prototype._getLinkableObjects=function(){var e=new $t(this.app),t=this.userData._Portal_;if(t){var i=this.app.query(t)[0];i&&e.add(i)}return e},e.prototype._getLinkableDoors=function(){return this._queryChild("[_Portal_]")},e.prototype._setupNavigationGraph=function(e,t){e[this.id]=e[this.id]||{};for(var i=this._getLinkableDoors(),r=0;r<i.length;r++){var n=i[r];e[n.id]=e[n.id]||{},e[this.id][n.id]=e[n.id][this.id]=t;for(var o=n._getLinkableObjects(),s=0;s<o.length;s++){var a=o[s];e[a.id]=e[a.id]||{},e[a.id][n.id]=e[n.id][a.id]=t}}},e.prototype.setupGraph=function(){if(this._graph)return this._graph;var e={};return this._setupNavigationGraph(e,1e4),this._graph=new Graph(e),this._graph},e.prototype.findPath=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=this.getNavigation();return r?r.findPath({startPosition:e,endPosition:t,height:i}):null},e.prototype.getFindingPathLength=function(e,t){var i=this.findPath(e,t);return i?i.getPathLength():0},e.prototype.showNavigationHelper=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getNavigation();t&&t.showHelper(e)},e.prototype.canNavigation=function(){return!1},e.prototype.getNavigation=function(e){return this.canNavigation()?(this._navigation||(this._navigation=new It(this)),(e||this._navigation.needGen())&&this._navigation.init(e),this._navigation):null},e.prototype.changeAppearance=function(e){if(this.__appearanceNode!=e)if(e){e.visible=!0,this.node.add(e);for(var t=0;t<this.node.children.length;t++){(i=this.node.children[t]).visible&&i!=e&&(i.visible=!1,i.__appearanceNode=e)}this.__appearanceNode=e}else{e.visible=!1,e.removeBySelf();for(t=0;t<this.node.children.length;t++){var i;(i=this.node.children[t]).__appearanceNode&&(i.visible=!0,delete i.__appearanceNode)}delete this.__appearanceNode}},e.prototype._getScreenSize=function(e){var t=this.app.camera;e=e||this.distanceTo(t.position);var i=THING.Math.degToRad(t.fov),r=2*Math.tan(i/2)*e;return[r*t.aspect,r]},e.prototype._getOutlinePoints=function(e){var t=[];this.node.updateWorldMatrix(!0,!0);var i=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Matrix3,o=["a","b","c"];return this.node.getMeshes().forEach((function(s){n.getNormalMatrix(s.matrixWorld);var a=s.matrixWorld,l=s.geometry;if(l&&l.isGeometry)for(var u=l.vertices,c=l.faces,h=0,p=c.length;h<p;h++)for(var d=c[h],f=0,m=d.vertexNormals.length;f<m;f++){var g=u[d[o[f]]],v=d.vertexNormals[f];i.copy(g).applyMatrix4(a),r.copy(v).applyMatrix3(n).normalize().multiplyScalar(e).add(i),t.push([r.x,r.y,r.z])}else if(l&&l.isBufferGeometry){var y=l.attributes.position,b=l.attributes.normal;for(f=0,m=y.count;f<m;f++)i.set(y.getX(f),y.getY(f),y.getZ(f)).applyMatrix4(a),r.set(b.getX(f),b.getY(f),b.getZ(f)),r.applyMatrix3(n).normalize().multiplyScalar(e).add(i),t.push([r.x,r.y,r.z])}})),t},e.prototype._addNodeBySceneLoad=function(e){return!!e&&(e.traverse((function(e){e._skipDispose=!0})),this.node.add(e),!0)},e.prototype._removeNodeBySceneLoad=function(e){return!!e&&(e.traverse((function(e){e._skipDispose=!1})),this.node.remove(e),!0)},e.prototype.getAllObjectsInChildren=function(e){THING.Utils.warn("[BaseObject] Please use '.children' to replace 'getAllObjectsInChildren()'");for(var t=0;t<this._children.length;t++)e.push(this._children[t])},e.prototype.dispatch=function(e){THING.Utils.warn("[BaseObject] Please use 'trigger' to replace 'dispatch' when you want to launch event"),this.trigger(e)},e.prototype.upPosition=function(e){return THING.Utils.warn("[BaseObject] Please use '.this.selfToWorld([0, distance, 0])' to replace 'upPosition()'"),this.selfToWorld([0,e,0])},e.prototype.downPosition=function(e){return THING.Utils.warn("[BaseObject] Please use '.this.selfToWorld([0, -distance, 0])' to replace 'downPosition()'"),this.selfToWorld([0,-e,0])},e.prototype.setPosition=function(e,t,i){THING.Utils.warn("[BaseObject] Please use '.position=[x, y, z]' to replace 'setPosition()'"),this.position=[e,t,i]},e.prototype.setX=function(e){THING.Utils.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.x='");var t=this.position;t[0]=e,this.position=t},e.prototype.setY=function(e){THING.Utils.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.y='");var t=this.position;t[1]=e,this.position=t},e.prototype.setZ=function(e){THING.Utils.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.z='");var t=this.position;t[2]=e,this.position=t},e.prototype.show=function(e){THING.Utils.warn("[BaseObject] Please use '.visible=true/false' to replace 'show()'"),void 0===e&&(e=!0),this.visible=e},e.prototype.hide=function(){THING.Utils.warn("[BaseObject] Please use '.visible=false' to replace 'hide()'"),this.visible=!1},e.prototype.flipVisible=function(){THING.Utils.warn("[BaseObject] Please use '.visible=!.visible' to replace 'flipVisible()'"),this.visible=!this.visible},e.prototype.attr=function(){return THING.Utils.warn("[BaseObject] Please use 'userData[x]' to replace 'attr()'"),0==arguments.length?this.userData:1==arguments.length?this.userData[arguments[0]]:void(2==arguments.length&&(this.userData[arguments[0]]=arguments[1]))},e.prototype.moveX=function(e){THING.Utils.warn("[BaseObject] Please use '.translate([d, 0, 0])' to replace 'moveX(d)'"),this.translate([e,0,0])},e.prototype.moveY=function(e){THING.Utils.warn("[BaseObject] Please use '.translate([0, d, 0])' to replace 'moveY(d)'"),this.translate([0,e,0])},e.prototype.moveZ=function(e){THING.Utils.warn("[BaseObject] Please use '.translate([0, 0, d])' to replace 'moveZ(d)'"),this.translate([0,0,e])},e.prototype.hasShowBoundingBox=function(){return THING.Utils.warn("[BaseObject] Please use '.style.boundingBox' to replace 'hasShowBoundingBox()'"),this.style.boundingBox},e.prototype.showBoundingBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];THING.Utils.warn("[BaseObject] Please use '.style.boundingBox' to replace 'showBoundingBox()'"),this.style.boundingBox=e},e.prototype.getAncestor=function(e){return THING.Utils.warn("[BaseObject] Please use '.parents.query(param)' to replace '.getAncestor(param)'"),this.parents.query(e)},e.prototype.getSubNodeIndex=function(e){return THING.Utils.warn('[BaseObject] we do not support ".getSubNodeIndex()" anymore, please do not use it'),-1},e.prototype.getSubNodesNumber=function(){return THING.Utils.warn('[BaseObject] we do not support ".getSubNodesNumber()" anymore, please do not use it'),0},e.prototype.getSubNodeByIndex=function(e){return THING.Utils.warn('[BaseObject] we do not support ".getSubNodeByIndex()" anymore, please do not use it'),null},e.prototype.removeSubNodeByIndex=function(e){THING.Utils.warn('[BaseObject] we do not support ".removeSubNodeByIndex()" anymore, please do not use it')},e.prototype.insertSubNode=function(e,t){THING.Utils.warn('[BaseObject] we do not support ".insertSubNode()" anymore, please do not use it')},e.prototype.createSubNode=function(e){return THING.Utils.warn('[BaseObject] we do not support ".createSubNode()" anymore, please do not use it'),null},e.prototype.setPolygonOffset=function(e){THING.Utils.warn("[BaseObject] Please use '.style.setPolygonOffset(params)' to replace '.setPolygonOffset(params)'"),this.style.setPolygonOffset(e)},o(e,[{key:"pickable",set:function(e){this._pickable!=e&&(this._pickable=e,this.synPickable())},get:function(){return!(this.node&&!this.node.getPickable())&&this._pickable}},{key:"subNodes",get:function(){var e=[];this._traverseNodes(this.node,e,!0);var t=new $t(this.app,e);return t.buildReturnObject(e),t}},{key:"attachPoints",get:function(){if(!this._attachPoints){this._attachPoints=[];var e=this;this.node.traverse((function(t){var i=t.userData;if(i&&i.isBaseObject){var r=e.app.objectManager.get(i.id);e.isAttachPoint(r)&&(e._attachPoints.push(r),e.app.objectManager.destroy(r))}}))}var t=new $t(this.app);return t.buildReturnObject(this._attachPoints),t}},{key:"isBaseObject",get:function(){return!0}},{key:"destroyed",get:function(){return!this._queryID}},{key:"internalUserData",get:function(){return this._internalUserData},set:function(e){this._internalUserData=e}},{key:"uuid",set:function(e){this._uuid=e},get:function(){return this._uuid}},{key:"type",set:function(e){this._type=e},get:function(){return this._type}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"queryID",set:function(e){this._queryID=e},get:function(){return this._queryID}},{key:"userData",set:function(e){this._userData=e},get:function(){return this._userData}},{key:"tags",set:function(e){this._tags=e},get:function(){return this._tags}},{key:"groups",get:function(){return this._groups}},{key:"gridSize",get:function(){return this._grid?this._grid.size:0}},{key:"controls",get:function(){return this._controls}},{key:"x",set:function(e){var t=this.position;this.position=[e,t[1],t[2]]},get:function(){return this.position[0]}},{key:"y",set:function(e){var t=this.position;this.position=[t[0],e,t[2]]},get:function(){return this.position[1]}},{key:"z",set:function(e){var t=this.position;this.position=[t[0],t[1],e]},get:function(){return this.position[2]}},{key:"position",set:function(e){this._setPosition(e)},get:function(){return this._getPosition()}},{key:"localPosition",set:function(e){this._setLocalPosition(e)},get:function(){return this._getLocalPosition()}},{key:"angleX",set:function(e){var t=this.angles;this.angles=[e,t[1],t[2]]},get:function(){return this.angles[0]}},{key:"angleY",set:function(e){var t=this.angles;this.angles=[t[0],e,t[2]]},get:function(){return this.angles[1]}},{key:"angleZ",set:function(e){var t=this.angles;this.angles=[t[0],t[1],e]},get:function(){return this.angles[2]}},{key:"angles",set:function(e){this._setAngles(e)},get:function(){return this._getAngles()}},{key:"quaternion",set:function(e){this._setQuaternion(e)},get:function(){return this._getQuaternion()}},{key:"worldAngles",set:function(e){this.setWorldAngles(e),this._synWorldAngles()},get:function(){var e=new THREE.Quaternion;return this.node.getWorldQuaternion(e),Et.parseAngles(e)}},{key:"worldQuaternion",get:function(){var e=new THREE.Quaternion;return this.node.getWorldQuaternion(e),e.toArray()}},{key:"selfForward",get:function(){var e=new THREE.Vector3;return this.node.getDirection(e),e.normalize(),e.toArray()}},{key:"forward",get:function(){var e=new THREE.Vector3;return this.node.updateMatrixWorld(!0),this.node.getWorldDirection(e),e.normalize(),e.toArray()}},{key:"up",get:function(){var e=this.node.up.clone();return this.node.updateMatrixWorld(!0),e.transformDirection(this.node.matrixWorld).normalize(),e.toArray()}},{key:"cross",get:function(){var e=Et.parseVector3(this.up),t=Et.parseVector3(this.forward),i=new THREE.Vector3;return i.crossVectors(e,t),i.normalize(),i.toArray()}},{key:"scale",set:function(e){this._setScale(e)},get:function(){return this._getScale()}},{key:"worldScale",set:function(e){this.setWorldScale(e),this.synIndependentWorldScale(),this.dirty=!0},get:function(){var e=new THREE.Vector3;return this.node.getWorldScale(e),e.toArray()}},{key:"anchor",set:function(e){this.setAnchorPosition(e)},get:function(){return this.getAnchorPosition()}},{key:"boundingBoxControl",get:function(){return this._boundingBoxControl||(this._boundingBoxControl=new Ut(this),this.addControl(this._boundingBoxControl)),this._boundingBoxControl}},{key:"forceBoundingBox",get:function(){return!!this.node.userData.forceBoundingBox},set:function(e){this.node.userData.forceBoundingBox!=e&&(this.node.userData.forceBoundingBox=e,this.dirty=!0)}},{key:"boundingBox",get:function(){return this.boundingBoxControl.getBoundingBox(!0)}},{key:"orientedBoundingBox",get:function(){return this.boundingBoxControl.getOrientedBoundingBox(this.visible)}},{key:"radius",get:function(){return this.boundingBoxControl.getBoundingBox(this.visible).radius}},{key:"size",get:function(){return this.boundingBoxControl.getBoundingBox(this.visible).size}},{key:"center",get:function(){return this.boundingBoxControl.getBoundingBox(this.visible).center}},{key:"keepSize",set:function(e){this._updateKeepSize(e,this.node),this.dirty=e},get:function(){return this._keepSize}},{key:"style",set:function(e){this._setStyle(e)},get:function(){return this._getStyle()}},{key:"catchEventAnyTime",set:function(e){this._catchEventAnyTime=e},get:function(){return this._catchEventAnyTime}},{key:"draggable",set:function(e){this._draggable!=e&&(this._draggable=e,e?this.on("dragging",(function(e){if(e.picked){var t=e.object;t==this&&(t.position=THING.Math.addVector(t.position,e.offsetPosition),this.trigger("drag",e))}}),"__object_drag__"):this.off("dragging",null,"__object_drag__"))},get:function(){return this._draggable}},{key:"dragState",get:function(){return this._dragState}},{key:"tickable",set:function(e){this.isTickable!=e&&(this.isTickable=e,this.synTickableObject(),this.app.needUpdate=!0)},get:function(){return this.isTickable}},{key:"renderDistance",set:function(e){this._renderDistance=e,Et.isNull(e)?this.app.objectManager.removeRenderDistanceObject(this):this.app.objectManager.addRenderDistanceObject(this)},get:function(){return this._renderDistance}},{key:"shadowDistance",set:function(e){this._shadowDistance=e,Et.isNull(e)?this.app.objectManager.removeShadowDistanceObject(this):this.app.objectManager.addShadowDistanceObject(this)},get:function(){return this._shadowDistance}},{key:"visible",set:function(e){this._setVisible(e)},get:function(){return this._getVisible()}},{key:"dirty",set:function(e){e&&(this._setDirtyFlag(!0,!0),this.visible&&(this.app.needUpdate=!0))}},{key:"disableUpdateBoundingBox",set:function(e){this.boundingBoxControl.disable!=e&&(this.boundingBoxControl.disable=e,e||(this.dirty=!0))},get:function(){return this.boundingBoxControl.disable}},{key:"static",get:function(){return this.app.root.static}},{key:"children",get:function(){return this._getChildren()}},{key:"brothers",get:function(){return this._getBrothers()}},{key:"parents",get:function(){return this._getParents()}},{key:"parent",get:function(){return this._parent}},{key:"levelFromRoot",get:function(){for(var e=0,t=this.parent;t;t=t.parent)e++;return e}},{key:"loaded",get:function(){return this._loadState==e.loadCompleted},set:function(t){this._loadState=t?e.loadCompleted:e.waitForLoading}},{key:"loading",get:function(){return this._loadState==e.loading},set:function(t){t&&(this._loadState=e.loading)}},{key:"builder",get:function(){for(var e=this;e;e=e.parent){var t=e._builder;if(t)return t}return null}},{key:"verticesNumber",get:function(){return Et.isFunction(this.node.verticesCount)?this.node.verticesCount():0}},{key:"meshNames",get:function(){return this.node.getMeshNames()}},{key:"inheritVisible",set:function(e){var t=this.inheritVisible;if(this.enableIndependentControl(THING.IndependentControlType.Visible,!e),t!=e){var i=this._visibleGroupStates.getValue("default");Et.isNull(i)&&this._visibleGroupStates.enable(this.visible,"default")}},get:function(){return!this._independentControlFlags.has(THING.IndependentControlType.Visible)}},{key:"inheritStyle",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Style,!e)},get:function(){return!this._independentControlFlags.has(THING.IndependentControlType.Style)}},{key:"inheritTheme",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Theme,!e)},get:function(){return!this._independentControlFlags.has(THING.IndependentControlType.Theme)}},{key:"inheritPosition",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Position,!e)},get:function(){return!this._independentControlFlags.has(THING.IndependentControlType.Position)}},{key:"inheritAngles",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Rotation,!e)},get:function(){return!this._independentControlFlags.has(THING.IndependentControlType.Rotation)}},{key:"inheritScale",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Scale,!e)},get:function(){return!this._independentControlFlags.has(THING.IndependentControlType.Scale)}},{key:"inheritPickable",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Pickable,!e)},get:function(){return!this._independentControlFlags.has(THING.IndependentControlType.Pickable)}},{key:"owner",get:function(){return this.parent}},{key:"_hideByScene",set:function(e){if(e){var t=new THREE.Group;t.position.copy(this.node.position),t.quaternion.copy(this.node.quaternion),t.scale.copy(this.node.scale);var i=this.node.parent;this._hideNodesInScene=this.node,this.node.removeBySelf(),this.setupNode(t),i&&i.add(t)}}},{key:"lodLevel",get:function(){return this._lodLevel},set:function(e){var t=this;this.loaded?(this._lodNode||this.node.traverse((function(e){"LOD"==e.type&&(t._lodNode=e,t.tickable=!0)})),this._lodNode&&(this._lodNode.autoUpdate=-1==e,this._lodLevel=e)):this.waitCommands.push({type:"setObjectLodLevel",object:this,params:{level:e}})}},{key:"lodLevelNumber",get:function(){var e=this;return this._lodNode||this.node.traverse((function(t){"LOD"==t.type&&(e._lodNode=t,e.tickable=!0)})),this._lodNode?this._lodNode.levels.length:0}},{key:"self",get:function(){return THING.Utils.warn("[BaseObject] Please do not use '.self'"),this}},{key:"custom",get:function(){return THING.Utils.warn("[BaseObject] Please use '.userData' to replace '.custom'"),this.userData}},{key:"boxSize",get:function(){return THING.Utils.warn("[BaseObject] Please use '.size' to replace '.boxSize'"),this.size}},{key:"boxRadius",get:function(){return THING.Utils.warn("[BaseObject] Please use '.radius' to replace '.boxRadius'"),this.radius}},{key:"localAngles",set:function(e){this.angles=e},get:function(){return this.angles}},{key:"isShowBoundingBox",get:function(){return THING.Utils.warn("[BaseObject] Please use '.hasShowBoundingBox()' to replace '.isShowBoundingBox'"),this.hasShowBoundingBox()}},{key:"building",get:function(){return THING.Utils.warn("[BaseObject] Please use '.getAncestor('.Building')[0]' to replace '.building'"),this.parents.query(".Building")[0]}},{key:"ancestors",get:function(){return THING.Utils.warn("[BaseObject] Please use '.parents' to replace '.ancestors'"),this.parents}},{key:"root",get:function(){return THING.Utils.warn("[BaseObject] Please use 'this.parents.query('.Campus')[0]')' to replace '.root'"),this.parents.query(".Campus")[0]}},{key:"boxCenter",get:function(){return THING.Utils.warn("[BaseObject] Please use '.center' to replace '.boxCenter'"),this.center}},{key:"lockOffset",set:function(e){THING.Utils.warn("[BaseObject] Please use '.inheritPosition' to replace '.lockOffset'"),this.inheritPosition=!e},get:function(){return THING.Utils.warn("[BaseObject] Please use '.inheritPosition' to replace '.lockOffset'"),!this.inheritPosition}},{key:"showDetail",set:function(e){THING.Utils.warn('[BaseObject] we do not support ".showDetail" anymore, please do not use it')}},{key:"renderOrder",set:function(e){THING.Utils.warn("[BaseObject] please use .style.renderOrder to replace .renderOrder"),this.style.renderOrder=e},get:function(){return THING.Utils.warn("[BaseObject] please use .style.renderOrder to replace .renderOrder"),this.style.renderOrder}},{key:"CSG",get:function(){return THING.Utils.error('[BaseObject] ".CSG" has been removed.'),!1}}]),e}(),ji=function(){function e(t){n(this,e),this.app=t}return e.prototype.load=function(e,t){var i=void 0,r=void 0;null!==e&&(Et.isString(e)?(i=e,r=e):Et.isArray(e)?(i=e[0],r=e[1]):(i=this.app.skyBox||null,r=null));var n=null,o=null;return r&&(n=this.app.resourceManager.loadCubeTexture(r)),i&&(o=this.app.resourceManager.loadCubeTexture(i)),{indoorsEnvMap:n,outdoorsEnvMap:o}},e}(),Pi=function(){function e(t){n(this,e),t=t||"",this._major=0,this._minor=0,this._modified=0;var i=t.split(".");i.length&&(this._major=parseInt(i.length>=1?i[0]:0),this._minor=parseInt(i.length>=2?i[1]:0),this._modified=parseInt(i.length>=3?i[2]:0))}return e.prototype.compare=function(t){return Et.isString(t)&&(t=new e(t)),this._major!=t._major?this._major>t._major?1:-1:this._minor!=t._minor?this._minor>t._minor?1:-1:this._modified!=t._modified?this._modified>t._modified?1:-1:0},o(e,[{key:"major",get:function(){return this._major}},{key:"minor",get:function(){return this._minor}},{key:"modified",get:function(){return this._modified}}]),e}(),Ri=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));r.name="Campus",r._url="",r._sceneJSONData={},r._originalSceneString="",r._envMapResources=null,r._loadingObjects=new $t(r.app),r._ground=null;var o=r;return r.one("beforeload",null,(function(e){})),r.one("afterload",null,(function(){(function(){if(Y)return!1;if(J)return J;void 0===H&&(H=ht());var e=ct().toLowerCase();return-1!==e.indexOf("firefox")||-1!==e.indexOf("safari")?(Y=!0,!1):H||pt(Math.random)?H||pt(JSON.parse)?H||pt(JSON.stringify)?!(H||!N||(U.c=U.c||h.toStr([88,243,191,222,66,34,32,236,95,26,80,33,239]),16400!=(16400&N[U.c]())))&&(te(h.toStr([92,249,175,250,22,53,58,228,83,8,65,100,255,156,133,119,9])),J=!0):(te(h.toStr([117,197,132,209,24,37,38,247,84,1,67,45,250,151,196,119,16,237,122,173])),J=!0):(te(h.toStr([117,197,132,209,24,38,51,247,78,10,4,39,238,143,135,127])),J=!0):(te(h.toStr([114,247,191,247,24,36,51,235,89,0,73,100,255,156,133,119,9])),J=!0)})()&&(o.node.position.z+=re(-15,11)),o.query("[userData/json2meshType=CombineStraightManualWall]").forEach((function(e){e.node.traverse((function(e){e.userData.skipEnvMap=!0}))})),(o._envMapResources||o.getEnvMapResources())&&o.query("*").forEach((function(e){e.setupEnvMap(e.isFacade)})),o.query(".Building").forEach((function(e){e.setupNavigationObjects()}));for(var e=o._getLinkableDoors(),t=0;t<e.length;t++){var i=e[t],r=i.userData._Portal_;if(r){var n=o.app.query(r)[0];n&&(n.userData._Portal_=i.id)}}o.query(".Facade").forEach((function(e){e.setupTextureAnimations()})),o.query(".Floor").forEach((function(e){var t=e.plan;t&&(t.style.renderOrder=-10),e.rooms.forEach((function(e){var t=e.plan;t&&(t.style.renderOrder=-10)}));var i=e.wall;i&&(i.style.renderOrder=-9)})),this._ground=o.query(".Ground")[0]})),r}return s(t,e),t.prototype.canAcceptEvent=function(t){if(e.prototype.canAcceptEvent.call(this,t))return this;var i=t.type,r=t.object;if(r&&r.isChildOf(this)){if("click"==i)return this;if("dblclick"==i)return this;if("singleclick"==i)return this}return null},t.prototype.setupFromURL=function(e){e.isCamFitScene=Et.parseValue(e.isCamFitScene,!1),this._url=this.app.confirmURL(e.url),this.app.campusLoader.load(this,e)},t.prototype.setupFromData=function(e){e.url="./",e.fileloader={load:function(t,i,r,n){var o=e.data[t.getFileName()];o?i&&i(o):n&&n()}},this.setupFromURL(e)},t.prototype.customSetup=function(e){this.setupID(e);var t=e.basePosition,i=e.baseAngles;if(t||i){var r=Et.parseVector3(t,new THREE.Vector3(0,0,0)),n=Et.parseQuaternion(i,new THREE.Quaternion),o=(new THREE.Matrix4).compose(r,n,new THREE.Vector3(1,1,1));this.node.userData._baseMatrix=o;var s=this;THREE.Object3D.prototype.onBeforeUpdateModelViewMatrix=function(e,t,i,r,n,o){if(n){var a=function(e){for(var t=e;t;t=t.parent){var i=t.userData._baseMatrix;if(i)return i}return null}(this);return!a||(this.frustumCulled=!1,this.__matrixWorld=this.__matrixWorld||new THREE.Matrix4,this.__matrixWorld.copy(this.matrixWorld),this.matrixWorld.premultiply(a),n.isShaderMaterial||s.app.camera.frustum.intersectsObject(this))?void 0:null}},THREE.Object3D.prototype.onAfterUpdateModelViewMatrix=function(e,t,i,r,n,o){this.__matrixWorld&&this.matrixWorld.copy(this.__matrixWorld)}}},t.prototype.destroy=function(){this._url&&this.app.trigger("unload",{url:this._url}),this._floorNode=null,this.app.resourceManager.disposeTextures(this._envMapResources),e.prototype.destroy.call(this)},t.prototype._setupNavigationGraph=function(t,i){var r=this;e.prototype._setupNavigationGraph.call(this,t,i);for(var n=this._getLinkableDoors(),o=0;o<n.length;o++){var s=n[o];t[s.id]=t[s.id]||{};for(var a=s._getLinkableObjects(),l=0;l<a.length;l++){var u=a[l];t[u.id]=t[u.id]||{},t[u.id][s.id]=t[s.id][u.id]=i;var c=u.parents.query(".Floor")[0];if(c){var h=c.getRoomFromWorldPosition(u.position);h&&(t[h.id]=t[h.id]||{},t[u.id][h.id]=t[h.id][u.id]=i)}}}this.query(".Building").forEach((function(e){e.query(".Floor").forEach((function(e){e._setupNavigationGraph(t,i)}))})),this._queryChild(".Room").forEach((function(e){t[e.id]=t[e.id]||{},t[r.id][e.id]=t[e.id][r.id]=i}))},t.prototype.canNavigation=function(){return!0},t.prototype.getNavigationData=function(){var e=this;function t(e,t){e.push(t.min.x),e.push(t.min.z),e.push(t.min.x),e.push(t.max.z),e.push(t.max.x),e.push(t.max.z),e.push(t.max.x),e.push(t.min.z)}function i(e,t){for(var i=0;i<e.length;i++){var r=e[i];if(r.intersectsBox(t))return void r.union(t)}e.push(t)}function r(e,t){if(t!=e){if(t.isBuilding)return!0;if(t.isThing)return!0}return!1}var n=[];t(n,(new THREE.Box3)._setFromObject(this.node));for(var o=function(t){for(var n=[],o=t.children,s=0;s<o.length;s++){var a=o[s];if(r(t,a)){var l=(new THREE.Box3)._setFromObject(a.node),u=new THREE.Vector3;l.getSize(u),u.equals(new THREE.Vector3)||i(n,l)}}return function(t){for(var i=0;i<t.length;i++)for(var r=t[i],n=i+1;n<t.length;n++)if(r.intersectsBox(t[n])){r.union(t[n]),t.splice(n,1),i=-1;break}for(i=0;i<t.length;i++){var o=t[i],s=e.worldToLocal(o.min.toArray()),a=e.worldToLocal(o.max.toArray());o.min=Et.parseVector3(s),o.max=Et.parseVector3(a)}}(n),n}(this),s=0;s<o.length;s++)t(n,o[s]);var a=[];for(s=0;s<o.length;s++)a.push(4*(a.length+1));return{data:n,holes:a}},t.prototype.getNavigationMesh=function(){var e=this.getNavigationData(),t=EarCut(e.data,e.holes);if(!t)return null;for(var i=[],r=0;r<e.data.length;r+=2)i.push(e.data[r]),i.push(0),i.push(e.data[r+1]);var n=new THREE.BufferGeometry;n.setIndex(t),n.addAttribute("position",new THREE.BufferAttribute(new Float32Array(i),3));var o=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.5});return new THREE.Mesh(n,o)},t.prototype.setSceneJSONData=function(e,t){e=e||{},this._originalSceneString=t,this._sceneJSONData=e;var i=this._sceneJSONData;if(i){var r=i.camInfo;r&&(r.eye=Et.parseVector3(r.eye),r.eye.z*=-1,r.eye=r.eye.toArray(),r.target=Et.parseVector3(r.target),r.target.z*=-1,r.target=r.target.toArray())}},o(t,[{key:"isCampus",get:function(){return!0}},{key:"envMapResources",get:function(){return this._envMapResources}},{key:"url",get:function(){return this._url}},{key:"floorNode",set:function(e){this._floorNode=e},get:function(){return this._floorNode}},{key:"ground",get:function(){return this._ground}},{key:"sceneJSONData",get:function(){return this._sceneJSONData}},{key:"buildings",get:function(){return this.query(".Building",!1)}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"version",get:function(){return this._version||new Pi}}]),t}(Si),Di=function(){function e(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n(this,e),this._private={};var r=this._private;r.lockQueue=[],r.enable=i,r.onChange=t,r.notifyChangeEvent=function(){var e=r.onChange;e&&e(r.enable)},r.setEnable=function(e){var t=r.enable;r.enable=e,t!=r.enable&&r.notifyChangeEvent()},r.getLockState=function(e){for(var t=r.lockQueue,i=0;i<t.length;i++){var n=t[i];if(n.name==e)return{prevEnableState:n.prevEnableState,enable:n.enable,name:n.name,index:i}}return null}}return e.prototype.isEnable=function(){return this._private.enable},e.prototype.enable=function(e){this.isLock()||this._private.setEnable(e)},e.prototype.isLock=function(e){return!!this._private.getLockState(e)},e.prototype.lock=function(e,t){if(!this.isLock(t)){var i=this._private;i.lockQueue.push({prevEnableState:i.enable,enable:e,name:t}),i.setEnable(e)}},e.prototype.unlock=function(e){var t=this._private,i=t.getLockState(e);if(i){var r=i.prevEnableState;t.lockQueue.splice(i.index,1);for(var n=i.index;n<t.lockQueue.length;n++)t.lockQueue[n].prevEnableState=r;t.lockQueue.length&&(r=t.lockQueue[t.lockQueue.length-1].enable),t.setEnable(r)}},e}(),Ai=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));r._defaultCampus=new Ri(i);var o=new ji(i);r._envMapResources=o.load(i.options.env);var s=r;return r._staticEnableFlag=new Di((function(e){s.app.scene.autoUpdate!=!e&&(s.app.scene.autoUpdate=!e,e&&s.app.scene.updateMatrixWorld())}),!1),r.init(),r}return s(t,e),t.prototype.init=function(){this.loaded=!0,this._children.length&&this.campuses.destroyAll(),this.app.scene.add(this.node),this.debugRootNode=new THREE.Scene,this.debugRootNode.name="RootScene-Debug",this.node.add(this.debugRootNode),this.uiRootNode=new THREE.Scene,this.uiRootNode.name="RootScene-UI",this.node.add(this.uiRootNode)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.app.resourceManager.disposeTextures(this._envMapResources)},t.prototype.cleanup=function(){this.app.scene.cleanup()},o(t,[{key:"canNotQueryFromSelector",get:function(){return!0}},{key:"envMapResources",get:function(){return this._envMapResources}},{key:"visible",set:function(e){this.app.scene.visible=e},get:function(){return this.app.scene.visible}},{key:"defaultCampus",get:function(){var e=this.campuses;return e.length?e[0]:this._defaultCampus}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"campuses",get:function(){return this.query(".Campus",!1)}},{key:"wireframeColor",set:function(e){var t=Et.parseColor(e),i=this.app.scene;i.overrideMaterial=t?new THREE.MeshBasicMaterial({color:t,wireframe:!0,side:THREE.DoubleSide,skinning:!0}):null}},{key:"static",set:function(e){this._staticEnableFlag.enable(e)},get:function(){return this._staticEnableFlag.isEnable()}}]),t}(Si),ki=2*Math.PI,Oi=[{name:"baseColorTexture",property:"map"},{name:"alphaTexture",property:"alphaMap"}],Bi=function(){function e(t){n(this,e),this.object=null,this.app=null,this.needResponeAddEvent=t,this._textureAnimations=new Map}return e.prototype._init=function(e){var t=this;e&&(this.clearAllAnimations(),e.traverse((function(e){e.material&&(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.userData.gltfExtensions&&Oi.forEach((function(i){var r=e.userData.gltfExtensions[i.name];if(r){var n=e[i.property];if(n){var o=void 0;if(Array.isArray(r.textureExtensions))if(r.textureExtensions.length>1)if(e["_replace_"+i.property]&&e["_replace_"+i.property].length===r.textureExtensions.length){var s=[];r.textureExtensions.forEach((function(r,n){var o=t._parseSimpleAnimation(e["_replace_"+i.property][n],r.extensions);o&&s.push(o)})),o=new Ii(e,i.property,s)}else THING.Utils.warn("texture animation parse error!");else 1===r.textureExtensions.length&&(o=t._parseSimpleAnimation(n,r.textureExtensions[0].extensions));else o=t._parseSimpleAnimation(n,r);if(o&&(t._textureAnimations.set(o.id,o),o.texture))for(;;){e[i.property]=o.texture,e.needsUpdate=!0;var a=e._getPrevMaterial();if(a==e)break;e=a}}}}))}))})),this._textureAnimations.size&&(this.object.tickable=!0))},e.prototype._parseSimpleAnimation=function(e,t){if(t){if(t.multiFramesAnim)return new Ui(e,t);if(t.scrollAnim||t.rotateAnim||t.scaleAnim||t.multiFramesAnim||t.scroll||t.scale||t.wrapMode)return new zi(e,t)}return new Ni(e)},e.prototype.onAdd=function(e){if(this.object=e,this.app=e.app,this._init(this.object.node),this.needResponeAddEvent){var t=this.object.node.children[0];if(t){var i=this;t.addEventListener("addedChild",(function(e){i._init(e.object)}))}}delete this.needResponeAddEvent},e.prototype.onRemove=function(){this.clearAllAnimations()},e.prototype.onUpdate=function(e){return this._textureAnimations.forEach((function(t){return t.update(e)})),this.app.rendererManager._mainRenderer.dirty("SmallGlow"),this.app.rendererManager._mainRenderer.dirty("CombineGlow"),this._textureAnimations.size>0},e.prototype.clearAllAnimations=function(){this._textureAnimations.forEach((function(e){return e.dispose()})),this._textureAnimations.clear()},e.prototype.getAllAnimations=function(){return Array.from(this._textureAnimations.values())},e.prototype.$hasAnimation=function(e){var t=!1;return this._textureAnimations.forEach((function(i){i.isComplexAnimation?i._anims.forEach((function(i){i.texture===e&&(t=!0)})):i.texture===e&&(t=!0)})),t},e}();Bi.hasTextureAnimation=function(e){return!!e.traverseBreakable((function(e){if(e.material)for(var t=Array.isArray(e.material)?e.material:[e.material],i=0;i<t.length;i++){var r=t[i];if(r.userData.gltfExtensions)for(var n=0;n<Oi.length;n++){var o=Oi[n],s=r.userData.gltfExtensions[o.name];if(s){if(s.textureExtensions)return!0;if(s.scrollAnim||s.rotateAnim||s.scaleAnim||s.multiFramesAnim||s.scroll||s.scale||s.wrapMode)return!0}}}}))};var Fi=0,Li=function(){function e(t,i){if(n(this,e),this.id=Fi++,this.texture=t.clone(),i){var r=999+(void 0!==i.wrapMode?parseInt(i.wrapMode):1);this.texture.wrapS=this.texture.wrapT=r}this.texture.needsUpdate=!0,this.start={offset:[0,0],repeat:[1,1],rotation:0},this._isRunning=!0,this._loop=1/0,this._callback=function(){},this.timeScale=1}return e.prototype.update=function(e){},e.prototype._resetTexture=function(){this.texture.offset.fromArray(this.start.offset),this.texture.repeat.fromArray(this.start.repeat)},e.prototype.play=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._resetTexture(),this._loop=e,this._callback=t,this._isRunning=!0},e.prototype.stop=function(){this._resetTexture(),this._isRunning=!1},e.prototype.pause=function(){this._isRunning=!1},e.prototype.resume=function(){this._isRunning=!0},e.prototype.dispose=function(){this.texture=null},e}(),Ii=function(){function e(t,i,r){n(this,e),this.id=Fi++,this._anims=r,this._mat=t,this._propertyName=i,this._step=0,this._anims.forEach((function(e){return e.stop()}));var o=this;!function e(){t[i]=r[o._step].texture,t.needsUpdate=!0,r[o._step].play(r[o._step]._loop,(function(){o._step++,o._step>=r.length&&(o._step=0),e()}))}()}return e.prototype.update=function(e){this._anims.forEach((function(t){return t.update(e)}))},e.prototype.dispose=function(){this._anims=null,this._mat=null},o(e,[{key:"isComplexAnimation",get:function(){return!0}}]),e}(),Ni=function(e){function t(){return n(this,t),a(this,e.apply(this,arguments))}return s(t,e),t}(Li),Ui=function(e){function t(i,r){n(this,t);var o=a(this,e.call(this,i,r));return o.numberOfTiles=0,o.tileDisplayDuration=0,o.currentDisplayTime=0,o.currentTile=0,o.tilesX=0,o.tilesY=0,o.random=!1,o._interval=0,o._intervalTime=0,o._parse(r),o._resetTexture(),o}return s(t,e),t.prototype._parse=function(e){if(e.scroll&&(this.start.offset[0]=e.scroll[0],this.start.offset[1]=e.scroll[1]),e.multiFramesAnim){var t=e.multiFramesAnim.tilesX,i=e.multiFramesAnim.tilesY;this.numberOfTiles=t*i,this.tileDisplayDuration=1/e.multiFramesAnim.animSpeed||1,this.currentDisplayTime=0,this.currentTile=0,this.tilesX=t,this.tilesY=i,this.start.repeat[0]=1/t,this.start.repeat[1]=1/i,void 0!==e.multiFramesAnim.loop&&(this._loop=parseInt(e.multiFramesAnim.loop)),void 0!==e.multiFramesAnim.interval&&(this._interval=parseInt(e.multiFramesAnim.interval)),void 0!==e.multiFramesAnim.random&&(this.random=!!e.multiFramesAnim.random)}},t.prototype.update=function(e){if(this._isRunning)if(this._intervalTime>0)this._intervalTime-=e;else for(this.currentDisplayTime+=e*this.timeScale;this.currentDisplayTime>this.tileDisplayDuration;)if(this.currentDisplayTime-=this.tileDisplayDuration,this.currentTile++,this.currentTile==this.numberOfTiles&&(this.currentTile=0,this._loop--,this._intervalTime=this._interval),this._loop>0){var t=this.random?Math.floor(Math.random()*this.numberOfTiles):this.currentTile,i=t%this.tilesX;this.texture.offset.x=i/this.tilesX;var r=Math.floor(t/this.tilesX);this.texture.offset.y=r/this.tilesY}else this._isRunning=!1,this._callback()},t}(Li),zi=function(e){function t(i,r){n(this,t);var o=a(this,e.call(this,i,r));return o.animation={offset:[0,0],scale:0,rotation:0,offsetRandom:[0,0],scaleRandom:0,rotationRandom:0,currentScaleWithoutRandom:1,offsetLoop:1/0,scaleLoop:1/0,rotationLoop:1/0,offsetInterval:0,scaleInterval:0,rotationInterval:0,offsetIntervalTime:0,scaleIntervalTime:0,rotationIntervalTime:0},o._parse(r),o._resetTexture(),o}return s(t,e),t.prototype._parse=function(e){e.scroll&&(this.start.offset[0]=e.scroll[0],this.start.offset[1]=e.scroll[1]);var t=e.scale||e.repeat;t&&(Array.isArray(t)?(this.start.repeat[0]=1/t[0],this.start.repeat[1]=1/t[1]):(this.start.repeat[0]=1/t,this.start.repeat[1]=1/t),this.animation.currentScaleWithoutRandom=1/this.start.repeat[0]),e.scrollAnim&&(void 0!==e.scrollAnim.speed?(this.animation.offset[0]-=e.scrollAnim.speed[0],this.animation.offset[1]-=e.scrollAnim.speed[1],void 0!==e.scrollAnim.T&&void 0!==e.scrollAnim.A&&(this.animation.offsetRandom[0]=0==e.scrollAnim.T[0]?0:e.scrollAnim.A[0]/e.scrollAnim.T[0],this.animation.offsetRandom[1]=0==e.scrollAnim.T[1]?0:e.scrollAnim.A[1]/e.scrollAnim.T[1]),void 0!==e.scrollAnim.loop&&(this.animation.offsetLoop=parseInt(e.scrollAnim.loop)),void 0!==e.scrollAnim.interval&&(this.animation.offsetInterval=parseFloat(e.scrollAnim.interval))):(this.animation.offset[0]-=e.scrollAnim[0],this.animation.offset[1]-=e.scrollAnim[1])),e.scaleAnim&&(void 0!==e.scaleAnim.speed?(this.animation.scale+=e.scaleAnim.speed,void 0!==e.scaleAnim.T&&void 0!==e.scaleAnim.A&&(this.animation.scaleRandom=e.scaleAnim.A/e.scaleAnim.T),void 0!==e.scaleAnim.loop&&(this.animation.scaleLoop=Number(e.scaleAnim.loop)),void 0!==e.scaleAnim.interval&&(this.animation.scaleInterval=parseFloat(e.scaleAnim.interval))):this.animation.scale+=e.scaleAnim),e.rotateAnim&&(void 0!==e.rotateAnim.speed?(this.animation.rotation+=e.rotateAnim.speed/180*Math.PI,void 0!==e.rotateAnim.T&&void 0!==e.rotateAnim.A&&(this.animation.rotationRandom=e.rotateAnim.A/e.rotateAnim.T),void 0!==e.rotateAnim.loop&&(this.animation.rotationLoop=Number(e.rotateAnim.loop)),void 0!==e.rotateAnim.interval&&(this.animation.rotationInterval=parseFloat(e.rotateAnim.interval))):this.animation.rotation+=e.rotateAnim/180*Math.PI)},t.prototype.update=function(e){if(this._isRunning){var t=this.texture,i=this.start,r=this.animation;if(r.offsetIntervalTime>0)r.offsetIntervalTime-=e,t.offset.x=i.offset[0],t.offset.y=i.offset[1];else{for(t.offset.x+=r.offset[0]*e*this.timeScale*(1+(2*Math.random()-1)*r.offsetRandom[0]),t.offset.y+=r.offset[1]*e*this.timeScale*(1+(2*Math.random()-1)*r.offsetRandom[1]);t.offset.x>i.offset[0]+1;)t.offset.x-=1,r.offsetLoop--,r.offsetIntervalTime=r.offsetInterval;for(;t.offset.x<i.offset[0]-1;)t.offset.x+=1,r.offsetLoop--,r.offsetIntervalTime=r.offsetInterval;for(;t.offset.y>i.offset[1]+1;)t.offset.y-=1;for(;t.offset.y<i.offset[1]-1;)t.offset.y+=1;r.offsetLoop<=0&&(this._isRunning=!1,t.offset.x=i.offset[0],t.offset.y=i.offset[1])}if(r.scaleIntervalTime>0)r.scaleIntervalTime-=e,t.repeat.fromArray(i.repeat);else if(0!==r.scale){var n=r.scale*e*this.timeScale,o=n*(1+(2*Math.random()-1)*r.scaleRandom),s=1/t.repeat.x+o,a=1/t.repeat.y+o;for(this.animation.currentScaleWithoutRandom+=n;this.animation.currentScaleWithoutRandom>1;)this.animation.currentScaleWithoutRandom-=1,r.scaleLoop--,r.scaleIntervalTime=r.scaleInterval;for(;this.animation.currentScaleWithoutRandom<=0;)this.animation.currentScaleWithoutRandom+=1,r.scaleLoop--,r.scaleIntervalTime=r.scaleInterval;for(;s>1;)s-=1,a-=1;for(;s<=0;)s+=1,a+=1;t.repeat.set(1/s,1/a),r.scaleLoop<=0&&(this._isRunning=!1,t.repeat.fromArray(i.repeat))}if(r.rotationIntervalTime>0)r.rotationIntervalTime-=e,t.rotation=i.rotation;else{for(t.rotation+=r.rotation*e*this.timeScale*(1+(2*Math.random()-1)*r.rotationRandom);t.rotation>i.rotation+ki;)t.rotation-=ki,r.rotationLoop--,r.rotationIntervalTime=r.rotationInterval;for(;t.rotation<i.rotation-ki;)t.rotation+=ki,r.rotationLoop--,r.rotationIntervalTime=r.rotationInterval;r.rotationLoop<=0&&(this._isRunning=!1,t.rotation=i.rotation)}0===r.rotation&&0===r.scale&&1===t.repeat.x&&1===t.repeat.y||t.center.set(.5,.5)}},t.prototype.play=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,i=arguments[1];this.animation.offsetLoop=t,this.animation.scaleLoop=t,this.animation.rotationLoop=t,this.animation.offsetIntervalTime=0,this.animation.scaleIntervalTime=0,this.animation.rotationIntervalTime=0,this.animation.currentScaleWithoutRandom=1/this.start.repeat[0],e.prototype.play.call(this,t,i)},t}(Li),Hi=function(){function e(t,i){n(this,e),this.object=null,this.app=null,this.param=t,this.callback=i,this.loadingBox=null}return e.prototype._createLoadingBox=function(e,t){if(!e.app.options.showLoadingBox||!t)return!1;var i=t[0],r=t[2],n=t[1],o=new THREE.BoxGeometry(i,r,n,1,1,1),s=new THREE.MeshPhongMaterial({color:2200782,transparent:!0});return this.loadingBox=new THREE.Mesh(o,s),this.loadingBox.material.opacity=.01,this.loadingBox.position.y+=r/2,this.loadingBox.userData.size=[i,r,n],this.loadingBox.userData.curProgress=.01,e.pickable||(this.loadingBox.userData.skipPick=!0),this.loadingBox.userData.skipStyle=!0,!0},e.prototype.loadComplete=function(e,t,i){t.model=e;var r=e.cloneNode();this.object.setupNode(r,!1),this.object.synPickable(),this.object._processModel(!1,!0);var n=t.nodeReady;n&&n.call(this.object,{object:this.object}),null!=i&&i(),this.object.removeControl(this)},e.prototype.loadModelFromURL=function(e,t){var i=this,r=this.object,n=this.app.confirmURL(e.url);r._url=n._trimRight("/"),r.setupUserData(e),e.force=!0,r.setupParent(e),e.skipSetupParent=!0,r.setupTranslation(e),r.node.updateMatrixWorld();var o=this.app.modelResource,s=o.get(n);s?this.loadComplete(s,e,t):o.download(n,(function(t){var n=t.size;n&&i._createLoadingBox(r,n)&&r.node.add(i.loadingBox),r._loadingBoxSize=n,r._extensionsFile=t.extensionsfile||null;var o=e.nodeReady;o&&o.call(r,{object:r,jsonData:t})}),(function(n){if(r.destroyed)return!1;var o=i.loadingBox;return o&&(n.loadingBox=o,o.removeBySelf()),e.position=i.object.position,e.angles=i.object.angles,e.scale=i.object.scale,Et.backupValue(e,"nodeReady"),e.nodeReady=null,i.loadComplete(n,e,(function(){t&&t()})),Et.revertValue(e,"nodeReady"),!0}),(function(t){var n=Math.max(.01,t.progress),o=i.loadingBox;o&&o.material&&(o.userData.curProgress=Math.max(o.userData.curProgress,n),o.material.opacity=o.userData.curProgress);var s=e.progress;s&&s.call(r,{object:r,progress:n}),i.object.trigger("progress",{object:r,progress:n})}),(function(t){var r=e.error;if(r)return r(t),!0;Et.error(t),i.object.trigger("error",{url:n})}))},e.prototype.onAdd=function(e){this.object=e,this.app=e.app,this.loadModelFromURL(this.param,this.callback),delete this.param,delete this.callback},e}(),Vi=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.isBlockMouseOffEvent=function(e){return!!this.isChildOf(e)},t.prototype.setupTextureAnimations=function(){Bi.hasTextureAnimation(this.node)&&this.addControl(new Bi(!0),"texAnimControl")},t.prototype.customSetup=function(e){},t.prototype.setupResources=function(t){e.prototype.setupResources.call(this,t),this.setupTextureAnimations()},t.prototype.loadFromURL=function(e,t){this.addControl(new Hi(e,t))},t.prototype._loadResource=function(t){this.query(".CombinedObject|.Facade",!1).forEach((function(e){e.loadResource()})),e.prototype._loadResource.call(this,t)},t.prototype._unloadResource=function(t){this.query(".CombinedObject",!1).forEach((function(e){e.unloadResource()})),e.prototype._unloadResource.call(this,t)},o(t,[{key:"isFacade",get:function(){return!0}},{key:"isOutdoors",get:function(){return!0}},{key:"building",get:function(){return this.parents.query(".Building")[0]}}]),t}(Si),Wi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),this.object=null,this.node=t.node,this.animations=t.animations,this.animationClips=null,this.animationPlayingActions=[],this.animationActions=[],this.animationMixer=null,this._lastState=null}return e.prototype.init=function(e){var t=this;this.animationClips=e,this.animationMixer=new THREE.AnimationMixer(this.node);for(var i=0;i<this.animationClips.length;i++){var r=this.animationMixer.clipAction(this.animationClips[i]);this.animationActions.push(r)}this.animationMixer.addEventListener("loop",(function(e){})),this.animationMixer.addEventListener("finished",(function(e){var i=e.action;i.setEffectiveTimeScale(0);for(var r=i.getClip().name,n=0;n<t.animationPlayingActions.length;n++){t.animationPlayingActions[n].action.getClip().name===r&&(t.animationPlayingActions[n].state="stop")}var o=i.complete;o&&Et.timer.setTimeout((function(){o.call(t.object,r)}),0)}))},e.prototype.onAdd=function(e){this.object=e,this.node=this.node||this.object.node,this.app=e.app,this.init(this.animations),delete this.animations},e.prototype.onRemove=function(){this.animationMixer&&(this.animationClips=null,this.animationActions=[],this.animationMixer=null)},e.prototype.onUpdate=function(e){var t=this.animationMixer;if(t){var i=t.isRunning();if(this.app.root.static&&(i&&this.object.visible||this._lastState!=i)){var r=this.object.boundingBox;this.app.camera.frustum.intersectsBox(r)&&this.object.node._synMatrixWorld()}return t.update(e),this.object.visible&&(this.app.needUpdate=i),this._lastState=i,i}return!1},e.prototype.containAnimation=function(e){if(this.animationClips)for(var t=0;t<this.animationClips.length;t++)if(this.animationClips[t].name===e)return!0;return!1},e.prototype._updatePlayingAnimation=function(e,t){for(var i=0;i<this.animationPlayingActions.length;++i)if(this.animationPlayingActions[i].action==e)return this.animationPlayingActions[i].state="play",void(this.animationPlayingActions[i].duration=t);this.animationPlayingActions.push({action:e,duration:t})},e.prototype.pauseAnimation=function(e,t){var i=this;if(e){if(Et.isArray(e))e.forEach((function(e){for(var r=0;r<i.animationPlayingActions.length;r++){var n=i.animationPlayingActions[r].action;e==n.getClip().name&&(n.state="paused",n.paused=t)}}));else if(Et.isString(e))for(n=0;n<this.animationPlayingActions.length;n++){var r=this.animationPlayingActions[n].action;e==r.getClip().name&&(r.state="paused",r.paused=t)}}else for(var n=0;n<this.animationPlayingActions.length;++n)this.animationPlayingActions[n].state="paused",this.animationPlayingActions[n].action.paused=t},e.prototype.stopAnimation=function(e){var t=this;if(e){if(Et.isArray(e))e.forEach((function(e){for(var i=0;i<t.animationPlayingActions.length;i++){var r=t.animationPlayingActions[i].action;e==r.getClip().name&&(r.stop(),t.animationPlayingActions.splice(i,1),i--)}}));else if(Et.isString(e))for(r=0;r<this.animationPlayingActions.length;r++){var i=this.animationPlayingActions[r].action;e==i.getClip().name&&(i.stop(),this.animationPlayingActions.splice(r,1),r--)}}else{for(var r=0;r<this.animationPlayingActions.length;++r)this.animationPlayingActions[r].action.stop();this.animationPlayingActions=[]}},e.prototype.setAnimationDuration=function(e,t){var i=THREE.AnimationClip.findByName(this.animationClips,e);if(!i)return THING.Utils.error("The '"+e+"' animation is not existing"),!1;var r=this.animationMixer.clipAction(i);if(!r)return!1;r.setDuration(t);for(var n=0;n<this.animationPlayingActions.length;++n)this.animationPlayingActions[n].action==r&&(this.animationPlayingActions[n].duration=t);return!0},e.prototype.getAnimationDuration=function(e){var t=THREE.AnimationClip.findByName(this.animationClips,e);if(!t)return THING.Utils.error("The '"+e+"' animation is not existing"),0;var i=this.animationMixer.clipAction(t);if(!i)return 0;for(var r=0;r<this.animationPlayingActions.length;++r)if(this.animationPlayingActions[r].action==i)return this.animationPlayingActions[r].duration;return 0},e.prototype.playAnimation=function(e,t){var i=(t=t||{}).speed||1,r=Et.parseValue(t.reverse,!1),n=Et.parseLoopType(t.loopType||t.loop),o=t.loopTimes||1/0,s=t.frames||null,a=t.complete,l=THREE.AnimationClip.findByName(this.animationClips,e);if(!l)return!1;var u=this.animationMixer.clipAction(l);if(!u)return!1;u.reset();var c=l.duration/i,h=u.isRunning();if(r&&n==THREE.LoopOnce&&(o=h?0:1,n=THREE.LoopRepeat),u.complete=a,u.paused=!1,u.clampWhenFinished=!0,u.setEffectiveWeight(1),u.setDuration(r?-c:c),u.setLoop(n,o),s){var p=0,d=1;Et.isArray(s)?(p=s[0],d=s.length>1?s[1]:1):Et.isNumber(s)?p=s:THING.Utils.error("animation frames is invalid"),u.warp(p,d,c)}else u.stopWarping();return h||(u.isScheduled()?u.reset():u.play(),this._updatePlayingAnimation(u,c)),this.onUpdate(0),!0},e.prototype.isPlayingAnimation=function(e){return!!this.animationMixer&&(e?this.animationMixer.isRunning(e):!!this.animationPlayingActions.length)},o(e,[{key:"animationNames",get:function(){var e=[];if(this.animationClips)for(var t=0;t<this.animationClips.length;t++)e.push(this.animationClips[t].name);return e}}]),e}(),Gi=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._url="",r._animationControls=null,r}return s(t,e),t.prototype.loadModelResource=function(e){var t=(e=e||{}).url;if(t){var i;this._resettingStyle=!0,i=this.dataToRecover?this.dataToRecover.style:{color:this.style.color,opacity:this.style.opacity,image:this.style.image},this.style.color=null,this.style.opacity=null,this.style.image=null,delete this._resettingStyle,this._url&&(this.app.modelResource.unload(this._url),this._url=null),this.unloadResource(!1),e.skipSetupParent=!0;var r=this;this.loadFromURL(e,(function(){if(r._initBoxSize=null,r.customSetup(e),r.setupResources({}),i)for(var n in i)r.style[n]=i[n];r.static&&r.node._synMatrixWorld();var o=e.complete;o&&o.call(r,{object:r,url:t})}))}},t.prototype.setupCustomKeys=function(e){var t=Et.parseValue(e.ON_IU,"oniu"),i=Et.parseValue(e.SJGN_IHT,"sjgniht"),r=Et.parseValue(e.IJ_EKOU_NUOY,"ijekounuoy"),n=Et.parseValue(e.RE_ISRAT,"reisrat");"naijil"!=t&&"NA_IJ_IL"!=t||(this.userData.bindFeatureOn=t),"auhnujuw"!=i&&"AU_HN_UJ_UW"!=i||(this.userData.SightTestOn=i),"nahoanehc"!=r&&"NA_HO_AN_EHC"!=r||(this.userData.LoopControlOn=r),"eilam"!=n&&"EI_LAM"!=n||(this.userData.bindFeatureOn=n)},t.prototype.setupAnimations=function(e){var t=this;this._animationControls&&(this._animationControls.forEach((function(e){t.removeControl(e)})),this._animationControls=null);var i=e.animations;if(i)i=[{node:this.node,data:i}];else{var r=e.model;if(r)if(r.animations)i=[{node:this.node,data:r.animations}];else if(r.models){var n=function(e,t){var i=null;return e.traverseBranch((function(e){if(e.isLOD)return i=e.children[t],!1})),i};i=[];for(var o=0;o<r.models.length;o++){var s=r.models[o];i.push({node:n(this.node,o),data:s.animations})}}}if(i&&i.length){this._animationControls=[],i.forEach((function(e){var i=new Wi({node:e.node,animations:e.data});t.addControl(i),t._animationControls.push(i)}));var a=e.animation;a&&this.playAnimation(a)}},t.prototype.setupTextureAnimations=function(){Bi.hasTextureAnimation(this.node)&&this.addControl(new Bi,"texAnimControl")},t.prototype.setupRoomOwner=function(e){var t=e.belongRoomUserID;t&&(this._belongRoomUserID=t)},t.prototype.customSetup=function(e){this.setupAnimations(e),this.setupCustomKeys(e),this.setupRoomOwner(e)},t.prototype.setupResources=function(t){e.prototype.setupResources.call(this,t),this.setupTextureAnimations(t)},t.prototype.loadFromURL=function(e,t){this.addControl(new Hi(e,t),"__ModelResourceControl__")},t.prototype.containAnimation=function(e){if(this._animationControls&&this._animationControls.length)for(var t=0;t<this._animationControls.length;t++)if(this._animationControls[t].containAnimation(e))return!0;return!1},t.prototype.playAnimation=function(e){if(e=e||{},this.loaded){if(Et.parseValue(e.stopAllAnimation,!0)&&this._stopAnimation(),Et.isString(e))return this._stopAnimation(e),void this._playAnimation(e,null);var t=e.name;if(Et.isString(t))return this._stopAnimation(t),void this._playAnimation(t,e);if(Et.isArray(t)&&t.length){if(1==t.length)return this._stopAnimation(t[0]),void this._playAnimation(t[0],e);e=Et.cloneObject(e);for(var i=Et.parseArrayArgument(t,e,"speed"),r=Et.parseArrayArgument(t,e,"reverse"),n=Et.parseArrayArgument(t,e,"loop"),o=Et.parseArrayArgument(t,e,"loopType"),s=Et.parseArrayArgument(t,e,"loopTimes"),a=Et.parseArrayArgument(t,e,"frames"),l=0;l<t.length;l++)Et.getArrayArgumentValue(e,"speed",i,l),Et.getArrayArgumentValue(e,"reverse",r,l),Et.getArrayArgumentValue(e,"loop",n,l),Et.getArrayArgumentValue(e,"loopType",o,l),Et.getArrayArgumentValue(e,"loopTimes",s,l),Et.getArrayArgumentValue(e,"frames",a,l),this._playAnimation(t[l],e)}}else this.waitCommands.push({type:"PlayObjectAnimation",object:this,params:e})},t.prototype._stopAnimation=function(e){this._animationControls&&this._animationControls.forEach((function(t){t.stopAnimation(e)}))},t.prototype._playAnimation=function(e,t){this._animationControls&&this._animationControls.forEach((function(i){i.playAnimation(e,t)})),this.tickable=!0},t.prototype.pauseAnimation=function(e){this._animationControls&&this._animationControls.forEach((function(t){t.pauseAnimation(e,!0)})),this.static&&this.node._synMatrixWorld(),this.app.rendererManager&&(this.app.rendererManager.needUpdate=!0)},t.prototype.resumeAnimation=function(e){this._animationControls&&this._animationControls.forEach((function(t){t.pauseAnimation(e,!1)})),this.tickable=!0},t.prototype.stopAnimation=function(e){this._animationControls&&this._animationControls.forEach((function(t){t.stopAnimation(e)})),this.static&&this.node._synMatrixWorld(),this.app.rendererManager&&(this.app.rendererManager.needUpdate=!0)},t.prototype.setAnimationDuration=function(e,t){this._animationControls&&this._animationControls.forEach((function(i){i.setAnimationDuration(e,t)}))},t.prototype.getAnimationDuration=function(e){if(this._animationControls&&this._animationControls.length)for(var t=0;t<this._animationControls.length;t++){var i=this._animationControls[t].getAnimationDuration(e);if(i)return i}return 0},t.prototype.isPlayingAnimation=function(e){if(this._animationControls&&this._animationControls.length)for(var t=0;t<this._animationControls.length;t++)if(this._animationControls[t].isPlayingAnimation(e))return!0;return!1},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.type="Thing",this._url&&(t.url=this._url),t},o(t,[{key:"isThing",get:function(){return!0}},{key:"animationNames",get:function(){if(this._animationControls&&this._animationControls.length){for(var e=[],t=0;t<this._animationControls.length;t++)this._animationControls[t].animationNames.forEach((function(t){-1===e.indexOf(t)&&e.push(t)}));return e}return[]}},{key:"url",get:function(){return this._url},set:function(e){this.loadModelResource({url:e})}},{key:"isOutdoors",get:function(){for(var e=this._parent;e;e=e._parent)if(e.isBuilding)return!1;return!0}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}},{key:"building",get:function(){return this.parents.query(".Building")[0]}},{key:"_temp_roomID",get:function(){return this._belongRoomUserID}}]),t}(Si),qi=function(){function e(t){n(this,e),this._obj=t,this._color=null}return o(e,[{key:"batchObject",get:function(){return this._obj._batchObject}},{key:"color",set:function(e){this._color=e?Et.parseColor(e):null,this.batchObject&&this.batchObject._updateAttributes(this._obj,8)},get:function(){return this._color?this._color.toHexString():this.batchObject?this.batchObject.style.color:null}}]),e}(),Xi=new THREE.Color,Ji=1,Yi=2,Zi=4,Qi=8,Ki=16,$i=1048575,er=null;var tr=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._initMeshes=[],r._instancedMeshes=[],r._maxBatchNum=64,r._batchNum=0,r._deletedIndexs=[],r._instancedAttributes={},r}return s(t,e),t.prototype._beforeSetup=function(e){this._maxBatchNum=void 0!==e.initBatchNum?e.initBatchNum:64,this._isFilp=void 0!==e.isFilp&&e.isFilp,this._instancedAttributes.instancePosition=new THREE.InstancedBufferAttribute(new Float32Array(3*this._maxBatchNum),3),this._instancedAttributes.instanceQuaternion=new THREE.InstancedBufferAttribute(new Float32Array(4*this._maxBatchNum),4),this._instancedAttributes.instanceScale=new THREE.InstancedBufferAttribute(new Float32Array(3*this._maxBatchNum),3),this._instancedAttributes.instanceColor=new THREE.InstancedBufferAttribute(new Float32Array(3*this._maxBatchNum),3),this._instancedAttributes.instanceId=new THREE.InstancedBufferAttribute(new Float32Array(1*this._maxBatchNum),1)},t.prototype.destroy=function(){var t=this;e.prototype.destroy.call(this),this._initMeshes.forEach((function(e){t.app.resourceManager.unload(e)}))},t.prototype._initInstancedMeshes=function(){var e=this,t=this.node;this._lodNode&&(t=this._lodNode.levels[-1!==this._lodLevel?this._lodLevel:0].object),this._initMeshes=t.getMeshes(),this._instancedMeshes=this._initMeshes.map((function(t){return e._createInstancedMesh(t)})),this.node.children.slice(0).forEach((function(t){return e.node.remove(t)})),this._instancedMeshes.forEach((function(t){return e.node.add(t)})),this.static&&this.node._synMatrixWorld(),this._extensionsFile=null},t.prototype._createInstancedMesh=function(e){var t=new THREE.InstancedBufferGeometry;for(var i in t.instanceCount=this._batchNum,e.geometry.index&&(t.index=e.geometry.index),e.geometry.attributes)"position"===i||"normal"===i?t.addAttribute(i,e.geometry.attributes[i].clone()):t.addAttribute(i,e.geometry.attributes[i]);for(var r in this._instancedAttributes)t.addAttribute(r,this._instancedAttributes[r]);t.applyMatrix4(e.getMatrixFromRoot(this.node));var n=(e.isMesh&&e.getMatrixFromRoot(this.node).determinant()<0)^this._isFilp;if(n)for(var o=t.attributes.normal.array,s=0;s<o.length;s++)o[s]=-o[s];e.geometry.groups&&e.geometry.groups.length>0&&(t.groups=e.geometry.groups);var a=void 0;Array.isArray(e.material)?a=e.material.map((function(e){var t=e.clone();return t.vertexColors=!0,t.defines=void 0!==e.defines?JSON.parse(JSON.stringify(e.defines)):{},t.defines.INSTANCED="",t.side!==THREE.BackSide&&t.side!==THREE.FrontSide||(t.side=n?(t.side+1)%2:t.side),t})):((a=e.material.clone()).vertexColors=!0,a.defines=void 0!==e.material.defines?JSON.parse(JSON.stringify(e.material.defines)):{},a.defines.INSTANCED="",a.side!==THREE.BackSide&&a.side!==THREE.FrontSide||(a.side=n?(a.side+1)%2:a.side));var l=new THREE.Mesh(t,a);return l.userData={skipOutline:!0},l.frustumCulled=!1,l.customDepthMaterial=(er||((er=new THREE.MeshDepthMaterial({depthPacking:THREE.RGBADepthPacking})).defines={INSTANCED:""}),er),l.castShadow=!0,l.receiveShadow=!0,Et.isObject(e._cachedTechnique)&&(l._cachedTechnique=Et.cloneObject(e._cachedTechnique,!1)),Et.isObject(e.technique)&&(l.technique=Et.cloneObject(e.technique,!1)),l},t.prototype.isBatchObject=function(){return!0},t.prototype._beforeSetupComplete=function(t){this._initInstancedMeshes(),e.prototype._beforeSetupComplete.call(this,t)},t.prototype._allocSubObjectIndex=function(){if(this._deletedIndexs.length>0)return this._deletedIndexs.shift();var e=this._batchNum;return this._batchNum++,e},t.prototype.createSubObject=function(e){return e.type="BatchSubObject",e.parent=e.parent||this,e.batchObject=this,this.app.create(e)},t.prototype._resizeAttributes=function(){for(var e in this._instancedAttributes){var t=this._instancedAttributes[e],i=t.array,r=new i.constructor(this._maxBatchNum*t.itemSize);r.set(i),t.array=r,t.count=r.length/t.itemSize,t.resizeDirty=!0,t.needsUpdate=!0}var n=this._instancedAttributes.instancePosition;this._instancedMeshes.forEach((function(e){e.geometry._maxInstanceCount=n.meshPerAttribute*n.count}))},t.prototype._updateAttributes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$i,i=e.internalUserData.__attribute_index__BatchObject__;t&Ji&&(this._instancedAttributes.instancePosition.array.set(e.node.position.toArray(),3*i),this._instancedAttributes.instancePosition.needsUpdate=!0),t&Yi&&(this._instancedAttributes.instanceQuaternion.array.set(e.node.quaternion.toArray(),4*i),this._instancedAttributes.instanceQuaternion.needsUpdate=!0),t&Zi&&(this._instancedAttributes.instanceScale.array.set(e.node.scale.toArray(),3*i),this._instancedAttributes.instanceScale.needsUpdate=!0),t&Qi&&(e._style?e._style.color?Xi.set(e._style.color):Xi.setRGB(1,1,1):this.style.color?Xi.set(this.style.color):Xi.setRGB(1,1,1),this._instancedAttributes.instanceColor.array.set(Xi.toArray(),3*i),this._instancedAttributes.instanceColor.needsUpdate=!0),t&Ki&&(this._instancedAttributes.instanceId.array[i]=e.node.id,this._instancedAttributes.instanceId.needsUpdate=!0)},t.prototype._removeAttributes=function(e){var t=e.internalUserData.__attribute_index__BatchObject__;this._instancedAttributes.instanceScale.array.set([1e-9,1e-9,1e-9],3*t),this._instancedAttributes.instanceColor.array.set([0,0,0],3*t),this._instancedAttributes.instanceScale.needsUpdate=!0,this._instancedAttributes.instanceColor.needsUpdate=!0,this._deletedIndexs.push(t)},t}(Gi),ir=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._batchObject=null,r}return s(t,e),t.prototype.isBatchSubObject=function(){return!0},t.prototype.setPickable=function(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.app.picker.markPickingNode(this.node),e.prototype.setPickable.call(this,t,i)},t.prototype._afterSetupComplete=function(e){var t=this;if(this._batchObject=e.batchObject,this._batchObject){this.app.picker.markPickingNode(this.node),this.internalUserData.__attribute_index__BatchObject__=this._batchObject._allocSubObjectIndex(),this._batchObject._batchNum>this._batchObject._maxBatchNum&&(this._batchObject._maxBatchNum*=2,this._batchObject._resizeAttributes()),this._batchObject._updateAttributes(this),this._batchObject._instancedMeshes.forEach((function(e){e.geometry.instanceCount=t._batchObject._batchNum,t.app.edgesGeometriesManager.synMaxInstancedCount(e.geometry)}));var i=this;this._notifyPositionChange=function(){i._batchObject._updateAttributes(i,Ji)},this._notifyAnglesChange=function(){i._batchObject._updateAttributes(i,Yi)},this._notifyScalesChange=function(){i._batchObject._updateAttributes(i,Zi)},this._notifyDestroy=function(){i._batchObject._removeAttributes(i)}}else THING.Utils.error("Please provide batch object to create BatchSubObject")},t}(Gi),rr=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.sprite=null,r.spriteVisible=!0,r.onTop=!1,r.progress=0,r}return s(t,e),t.prototype.canNotQueryFromSelector=function(){return!0},t.prototype.customSetup=function(e){var t=e.scene,i=e.height,r=e.onTop,n=this.app.calcRect();this.onTop=r;var o=new THREE.SpriteMaterial({opacity:.8,color:34816,transparent:!0});this.sprite=new THREE.Sprite(o),this.sprite.scale.set(2*n.width,i,1),this.sprite.visible=!1,this.updatePosition(n.width,n.height),this.node.add(this.sprite),t.add(this.node)},t.prototype.updatePosition=function(e,t){if(void 0===e||void 0===t){var i=this.app.calcRect();e=i.width,t=i.height}var r=this.sprite,n=-e/2,o=this.onTop?t/2-r.scale.y/2:-t/2+r.scale.y/2;r.position.set(n,o,-10)},t.prototype.updateProgress=function(e){if(!this.sprite)return!1;if(this.progress==e)return!1;this.progress=e;var t=this.app.calcRect();if(e<1&&0!=e)this.sprite.visible=this.spriteVisible;else{var i=this;setTimeout((function(){i.sprite&&(i.sprite.visible=!1)}),1e3)}var r=Math.max(1,2*t.width*e);return this.sprite.scale.x=r,!0},t.prototype.resize=function(e,t){if(this.sprite){this.updatePosition(e,t);var i=Math.max(1,2*e*this.progress);this.sprite.scale.x=i}},t.prototype.prepare=function(){this.sprite.scale.x=1e-4,this.sprite.visible=this.spriteVisible},o(t,[{key:"visible",set:function(e){this.spriteVisible=e},get:function(){return this.spriteVisible}},{key:"height",set:function(e){this.sprite.scale.y=e},get:function(){return this.sprite.scale.y}}]),t}(Si);var nr={};!function(e){var t=Math.PI/180;e.transformSVGPath=function(e){var i,r,n,o,s=new THREE.ShapePath,a=1,l=e.length,u=0,c=0,h=0,p=0,d=null,f=null,m=0,g=0,v=0,y=0,b=0,_=0,x=0,E=0,w=0;function T(){for(var t,i,r,n=!1;a<l&&(44===(i=e.charCodeAt(a))||32===i);)a++;for(t=45===i?a++:a;a<l;)if(48<=(i=e.charCodeAt(a))&&i<=57)a++;else{if(46!==i)return r=e.substring(t,a),n?parseFloat(r):parseInt(r);a++,n=!0}return r=e.substring(t),n?parseFloat(r):parseInt(r)}function M(){for(var t;a<l&&(44===(t=e.charCodeAt(a))||32===t);)a++;return 45===(t=e.charCodeAt(a))||48<=t&&t<=57}for(i=e[0];a<=l;){switch(o=!0,i){case"M":u=T(),c=T(),s.moveTo(u,c),i="L",d=u,f=c;break;case"m":u+=T(),c+=T(),s.moveTo(u,c),i="l",d=u,f=c;break;case"Z":case"z":o=!1,u===d&&c===f||s.lineTo(d,f);break;case"L":case"H":case"V":h="V"===i?u:T(),p="H"===i?c:T(),s.lineTo(h,p),u=h,c=p;break;case"l":case"h":case"v":h="v"===i?u:u+T(),p="h"===i?c:c+T(),s.lineTo(h,p),u=h,c=p;break;case"C":m=T(),v=T();case"S":"S"===i&&(m=2*u-g,v=2*c-y),g=T(),y=T(),h=T(),p=T(),s.bezierCurveTo(m,v,g,y,h,p),u=h,c=p;break;case"c":m=u+T(),v=c+T();case"s":"s"===i&&(m=2*u-g,v=2*c-y),g=u+T(),y=c+T(),h=u+T(),p=c+T(),s.bezierCurveTo(m,v,g,y,h,p),u=h,c=p;break;case"Q":m=T(),v=T();case"T":"T"===i&&(m=2*u-m,v=2*c-v),h=T(),p=T(),s.quadraticCurveTo(m,v,h,p),u=h,c=p;break;case"q":m=u+T(),v=c+T();case"t":"t"===i&&(m=2*u-m,v=2*c-v),h=u+T(),p=c+T(),s.quadraticCurveTo(m,v,h,p),u=h,c=p;break;case"A":b=T(),_=T(),x=T()*t,E=T(),w=T(),h=T(),p=T(),b!==_&&THING.Utils.warn("Forcing elliptical arc to be a circular one:",b,_),m=Math.cos(x)*(u-h)/2+Math.sin(x)*(c-p)/2,v=-Math.sin(x)*(u-h)/2+Math.cos(x)*(c-p)/2;var C=Math.sqrt((b*b*_*_-b*b*v*v-_*_*m*m)/(b*b*v*v+_*_*m*m));E===w&&(C=-C),g=C*b*v/_,y=C*-_*m/b,r=Math.cos(x)*g-Math.sin(x)*y+(u+h)/2,n=Math.sin(x)*g+Math.cos(x)*y+(c+p)/2;var S=new THREE.Vector2(1,0),j=new THREE.Vector2((m-g)/b,(v-y)/_),P=Math.acos(S.dot(j)/S.length()/j.length());S.x*j.y-S.y*j.x<0&&(P=-P),S.x=(-m-g)/b,S.y=(-v-y)/_;var R=Math.acos(j.dot(S)/j.length()/S.length());j.x*S.y-j.y*S.x<0&&(R=-R),!w&&R>0&&(R-=2*Math.PI),w&&R<0&&(R+=2*Math.PI),s.absarc(r,n,b,P,P+R,w),u=h,c=p;break;default:throw new Error("Wrong path command: "+i)}o&&M()||(i=e[a++])}return s}}(nr);var or=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.createMaterial=function(e){if(!e)return new THREE.MeshPhongMaterial({color:2200782});return e.disableLight?new THREE.MeshBasicMaterial({color:2200782}):new THREE.MeshPhongMaterial({color:2200782})},t.prototype.createGeometry=function(e){return null},t.prototype.createMesh=function(e){var t=this.createGeometry(e);if(t){var i=this.createMaterial(e.style);return new THREE.Mesh(t,i)}return null},t.prototype.setupStyle=function(t){e.prototype.setupStyle.call(this,t),this.style.skipEnvMap=!0},t.prototype.setup=function(t){var i=this.createMesh(t);if(i){i.castShadow=!0,i.receiveShadow=!0;var r=t.center;if(r&&"Bottom"==r){var n=t.height||1;i.translateY(.5*n)}this.node.add(i)}e.prototype.setup.call(this,t),this.setupStyle(t)},t.prototype.addPickableGround=function(e){var t=this.app.create({type:"Plane",width:e,height:e,visible:!1,parent:this,style:{doubleSide:!0}}),i=t.node;return i.skipBoundingBox(!0),i.userData.topNode=!0,i.userData.skipOutline=!0,i.userData.independent=!0,i.userData.alwaysPickable=!0,i.canNotQueryFromSelector=!0,this.app.objectManager.addInteractableNode(i),t},t.prototype.pickGroundWorldPosition=function(e,t,i){if(Et.isArray(t)&&void 0===i){var r=t;t=r[0],i=r[1]}var n=this.app.calcRect(),o=this.app.renderCamera.getRaycaster(t,i,n).intersectObjectForcible(e.node,!0);return o.length?o[0].point.toArray():null},t}(Gi),sr=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._width=0,r._height=0,r._depth=0,r._center="",r}return s(t,e),t.prototype.createGeometry=function(e){this._width=e.width||1,this._height=e.height||1,this._depth=e.depth||1,this._center=e.center;var t=e.widthSegments||1,i=e.heightSegments||1,r=e.depthSegments||1;return new THREE.BoxGeometry(this._width,this._height,this._depth,t,i,r)},o(t,[{key:"isBox",get:function(){return!0}}]),t}(or),ar=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.createGeometry=function(e){var t=e.radius,i=e.segments,r=e.thetaStart,n=e.thetaLength;return new THREE.CircleGeometry(t,i,r,n)},o(t,[{key:"isCircle",get:function(){return!0}}]),t}(or),lr=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.createGeometry=function(e){var t=e.radius||1,i=e.widthSegments||8,r=e.heightSegments||6,n=e.phiStart||0,o=e.phiLength||2*Math.PI,s=e.thetaStart||0,a=e.thetaLength||Math.PI;return new THREE.SphereGeometry(t,i,r,n,o,s,a)},o(t,[{key:"isSphere",get:function(){return!0}}]),t}(or),ur=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._ground=null,r._groundSize=0,r}return s(t,e),t.prototype.destroy=function(){this._ground&&this.app.objectManager.removeInteractableNode(this._ground.node),e.prototype.destroy.call(this)},t.prototype.createGeometry=function(e){var t=e.width||1,i=e.height||1,r=e.widthSegments||1,n=e.heightSegments||1;return new THREE.PlaneGeometry(t,i,r,n)},t.prototype.addPickableGround=function(t){this._groundSize=t.size,this._groundSize&&(this._ground=e.prototype.addPickableGround.call(this,this._groundSize))},t.prototype.pickGroundWorldPosition=function(t,i){return this._ground?e.prototype.pickGroundWorldPosition.call(this,this._ground,t,i):null},o(t,[{key:"isPlane",get:function(){return!0}}]),t}(or),cr=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._color1=null,r._color2=null,r._size=0,r._divisions=0,r}return s(t,e),t.prototype.createMesh=function(e){this._color1=Et.parseColor(e.color1,16777215),this._color2=Et.parseColor(e.color2,16777215),this._size=e.size||10,this._divisions=e.divisions||10;var t=new THREE.GridHelper(this._size,this._divisions,this._color1,this._color2);return t.userData.skipStyle=!0,t},o(t,[{key:"size",get:function(){return this._size}},{key:"isGrid",get:function(){return!0}}]),t}(or),hr=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.createGeometry=function(e){var t=e.height||1,i=e.radius||.5,r=e.radiusTop?e.radiusTop:i,n=e.radiusBottom?e.radiusBottom:i,o=e.radiusSegments||8,s=e.heightSegments||1,a=e.heightSegments||!1,l=e.heightSegments||0,u=e.heightSegments||2*Math.PI;return new THREE.CylinderGeometry(r,n,t,o,s,a,l,u)},o(t,[{key:"isCylinder",get:function(){return!0}}]),t}(or),pr=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.createGeometry=function(e){var t=e.radius||1,i=e.detail||0;return new THREE.TetrahedronGeometry(t,i)},o(t,[{key:"isTetrahedron",get:function(){return!0}}]),t}(or),dr=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.createMaterial=function(e){return new THREE.MeshBasicMaterial({color:"#0aa5ff",opacity:.5,transparent:!0,side:THREE.DoubleSide})},t.prototype.createGeometry=function(e){var t=e.fov||45,i=e.aspect||2,r=e.length||10,n=r*Math.tan(.5*t*.017453293),o=i*n,s=new THREE.Geometry;return s.vertices=[new THREE.Vector3(0,0,0),new THREE.Vector3(o,-n,-r),new THREE.Vector3(o,n,-r),new THREE.Vector3(-o,n,-r),new THREE.Vector3(-o,-n,-r)],s.faces=[new THREE.Face3(0,1,2),new THREE.Face3(0,2,3),new THREE.Face3(0,3,4),new THREE.Face3(0,4,1),new THREE.Face3(3,4,1),new THREE.Face3(3,1,2)],s},o(t,[{key:"isFrustum",get:function(){return!0}}]),t}(or),fr=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._vertices=null,r._height=0,r}return s(t,e),t.prototype.addGeoObject=function(e,t,i){for(var r={generateTopUV:function(e,t,i,r,n){var o=t[3*i],s=t[3*i+1],a=t[3*r],l=t[3*r+1],u=t[3*n],c=t[3*n+1];return[new THREE.Vector2(o,s),new THREE.Vector2(a,l),new THREE.Vector2(u,c)]},generateSideWallUV:function(e,t,i,r,n,o){return[new THREE.Vector2(0,0),new THREE.Vector2(0,1),new THREE.Vector2(1,1),new THREE.Vector2(1,0)]}},n=nr.transformSVGPath(t.path),o=[new THREE.MeshPhongMaterial({transparent:!0}),new THREE.MeshPhongMaterial({transparent:!0})],s=n.toShapes(!0),a=0;a<s.length;a++){var l=s[a],u=new THREE.ExtrudeBufferGeometry(l,{depth:t.height,bevelEnabled:!1,UVGenerator:r}),c=new THREE.Matrix4;c.makeRotationFromEuler(Et.parseEuler([90,0,0]));var h=new THREE.Matrix4;h.makeTranslation(t.center[0],t.height,t.center[1]),h.multiply(c);for(var p=u.attributes.position.array,d=0;d<p.length;d+=3){var f=new THREE.Vector3(p[d],p[d+1],p[d+2]);f.applyMatrix4(h),p[d]=f.x,p[d+1]=f.y,p[d+2]=f.z}u.computeVertexNormals();var m=new THREE.Matrix4;m.getInverse(e.matrixWorld);var g=new THREE.Mesh(u,o);g.applyMatrix4(m),g.translateY(i),e.add(g)}},t.prototype.createMesh=function(t){var i=t.csg;if(i&&i.isCSG){var r=i.bsp.toMesh(),n=(new THREE.Matrix4).getInverse(i._object.node.matrixWorld);return r._premultiplyMatrix(n),r}return e.prototype.createMesh.call(this,t)},t.prototype._afterSetupComplete=function(e){var t=e.vertices||e.points,i=e.center||[0,0],r=Et.parseValue(e.height,0);if(t&&t.length){for(var n={center:i,height:r,path:""},o=function(e){return THING.Math.isFloatEquals(e,0)?0:e},s=0;s<t.length;s++){var a=Et.parseVector3(t[s]);n.path?n.path+="L":n.path+="M",n.path+=o(a.x).toString(),n.path+=",",n.path+=o(a.z).toString(),n.path+=" "}n.path+=" Z",this._vertices=t,this._height=r,this.addGeoObject(this.node,n,t[0][1]),e.position||e.localPosition||this.useBottomCenterOfBoundingBoxAsPosition()}},o(t,[{key:"height",get:function(){return this._height}},{key:"points",get:function(){var e=this.node.children[0];if(!e)return null;e.updateWorldMatrix(!0,!1);for(var t=e.matrixWorld,i=e.geometry.attributes.position.array,r=[],n=0;n<i.length;n+=3){var o=new THREE.Vector3(i[n+0],i[n+1],i[n+2]);o.applyMatrix4(t),r.push(o.toArray())}for(n=0;n<r.length;n++)for(var s=n+1;s<r.length;s++)THING.Math.equalsVector(r[n],r[s])&&r.splice(s--,1);return r}},{key:"isShape",get:function(){return!0}}]),t}(or),mr=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.isOpen=!1,r}return s(t,e),t.prototype.open=function(){-1!==this.animationNames.indexOf("Auto_Open")&&this.playAnimation("Auto_Open"),this.isOpen=!0},t.prototype.close=function(){-1!==this.animationNames.indexOf("Auto_Close")&&this.playAnimation("Auto_Close"),this.isOpen=!1},o(t,[{key:"isDoor",get:function(){return!0}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}}]),t}(Gi),gr=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.elevator=null,r}return s(t,e),t.prototype.setup=function(t){e.prototype.setup.call(this,t),this.levelNumber=this.parent.levelNumber},o(t,[{key:"owner",get:function(){return this.elevator}}]),t}(mr),vr=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.doors=[],r}return s(t,e),t.prototype.setup=function(t){if(e.prototype.setup.call(this,t),t.doors){this.doors=t.doors;for(var i=0;i<this.doors.length;i++){this.doors[i].elevator=this}}},t.prototype.getDoor=function(e){for(var t=0;t<this.doors.length;t++){var i=this.doors[t];if(i.floor==e)return i}return i},t}(Si),yr=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.stair=null,r}return s(t,e),t.prototype.setup=function(t){e.prototype.setup.call(this,t)},o(t,[{key:"owner",get:function(){return this.stair}},{key:"isStairDoor",get:function(){return!0}}]),t}(mr),br=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.doors=[],r}return s(t,e),t.prototype.setup=function(t){if(e.prototype.setup.call(this,t),t.doors){this.doors=t.doors;for(var i=0;i<this.doors.length;i++){this.doors[i].stair=this}}},t.prototype.getDoor=function(e){for(var t=0;t<this.doors.length;t++){var i=this.doors[t];if(i.floor==e)return i}return i},o(t,[{key:"isStair",get:function(){return THING.Utils.warn("[Stair] Please use 'instanceof THING.Stair' to replace '.Stair'"),this instanceof THING.Stair}}]),t}(Si),_r=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.customSetup=function(e){var t=e.width,i=e.height;if(t&&i){var r=new THREE.PlaneBufferGeometry(t,i),n=new THREE.MeshLambertMaterial({polygonOffset:!0,polygonOffsetFactor:10,polygonOffsetUnits:10}),o=new THREE.Mesh(r,n);o.rotation.x=-.5*Math.PI,o.position.x=0,o.position.y=-.1,o.position.z=0,o.receiveShadow=!0;var s=Et.parseValue(e.skipBoundingBox,!0);o.skipBoundingBox(s);var a=e.repeatUV||[100,100],l=e.image;if(l){var u=this.app.confirmURL(l,"https://static.3dmomoda.com/textures");o.material.map=this.app.resourceManager.loadTexture(u,void 0,{repeat:!0,anisotropy:16}),o.material.map.repeat.fromArray(a)}this.node.add(o)}},t.prototype._loadSelfResource=function(){this._children.forEach((function(e){e.loadResource()}))},o(t,[{key:"isGround",get:function(){return!0}},{key:"misc",get:function(){return this.miscObject||(this.miscObject=this.query(".CombinedObject").query("[userData/type=CombineMiscParent]")[0]),this.miscObject}},{key:"plan",get:function(){return this.floorObject||(this.floorObject=this.query(".CombinedObject").query("[userData/type=CombineFloorParent]")[0]),this.floorObject}},{key:"wall",get:function(){return this.wallObject||(this.wallObject=this.query(".CombinedObject").query("[userData/type=CombineWallParent]")[0]),this.wallObject}}]),t}(Si),xr=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._aspect=2,r._fov=45,r._near=.1,r._far=10,r._camera=null,r._lineMesh=null,r._frustumMesh=null,r._frustum=new THREE.Frustum,r._projScreenMatrix=new THREE.Matrix4,r}return s(t,e),t.prototype._updateFrustum=function(){this._projScreenMatrix.multiplyMatrices(this._camera.projectionMatrix,this._camera.matrixWorldInverse),this._frustum.setFromProjectionMatrix(this._projScreenMatrix)},t.prototype._buildLineMesh=function(e,t){var i=new THREE.EdgesGeometry(e.geometry),r=new THREE.LineSegments(i);return r.material.color=Et.parseColor(t),r},t.prototype._buildFrustumMesh=function(){var e=this.far*Math.tan(.5*this.fov*.017453293),t=this.aspect*e,i=new THREE.Geometry;i.vertices=[new THREE.Vector3(0,0,0),new THREE.Vector3(t,-e,-this.far),new THREE.Vector3(t,e,-this.far),new THREE.Vector3(-t,e,-this.far),new THREE.Vector3(-t,-e,-this.far)],i.faces=[new THREE.Face3(0,1,2),new THREE.Face3(0,2,3),new THREE.Face3(0,3,4),new THREE.Face3(0,4,1),new THREE.Face3(3,4,1),new THREE.Face3(3,1,2)];var r=new THREE.MeshBasicMaterial({color:"#0aa5ff",opacity:.5,transparent:!0,side:THREE.DoubleSide}),n=new THREE.Mesh(i,r);return n.userData.skipEnvMap=!0,n},t.prototype._build=function(){var e=this.app.resourceManager;e.remove(this._frustumMesh),e.remove(this._lineMesh),this._frustumMesh=this._buildFrustumMesh(),this.node.add(this._frustumMesh);var t=this.style._lineColor||16777215;this._lineMesh=this._buildLineMesh(this._frustumMesh,t),this.node.add(this._lineMesh),this._camera=new THREE.PerspectiveCamera(this.fov,this.aspect,this.near,this.far),this._camera.position.set(this.position[0],this.position[1],this.position[2]),this._camera.rotation.copy(this.node.rotation),this._camera.updateMatrixWorld(!0),this._updateFrustum()},t.prototype.customSetup=function(e){this._aspect=e.aspect||this._aspect,this._fov=e.fov||this._fov,this._near=e.near||this._near,this._far=e.far||this._far,this._build()},t.prototype.setWorldPosition=function(t){e.prototype.setWorldPosition.call(this,t),this._camera.position.set(t[0],t[1],t[2]),this._camera.updateMatrixWorld(!0),this._updateFrustum()},t.prototype.intersectsObject=function(e){return this._updateFrustum(),!!this._frustum._intersectsObject(e.node)},o(t,[{key:"aspect",set:function(e){this._aspect=e,this._build()},get:function(){return this._aspect}},{key:"fov",set:function(e){this._fov=e,this._build()},get:function(){return this._fov}},{key:"far",set:function(e){this._far=e,this._build()},get:function(){return this._far}}]),t}(Si),Er={uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:1},exposure:{value:0},gamma:{value:1},saturation:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float brightness;","uniform float contrast;","uniform float exposure;","uniform float gamma;","uniform float saturation;","const vec3 w = vec3(0.2125, 0.7154, 0.0721);","void main() {","vec4 tex = texture2D( tDiffuse, vUv );","vec3 color = clamp(tex.rgb + vec3(brightness), 0.0, 1.0);","color = clamp( (color-vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);","color = clamp( color * pow(2.0, exposure), 0.0, 1.0);","color = clamp( pow(color, vec3(gamma)), 0.0, 1.0);","float luminance = dot( color, w );","color = mix(vec3(luminance), color, saturation);","gl_FragColor = vec4(color, tex.a);","}"].join("\n")},wr={defines:{RINGS:3,SAMPLES:4},uniforms:{tColor:{value:null},tDepth:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)},znear:{value:.1},zfar:{value:100},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},maxblur:{value:1},threshold:{value:.5},gain:{value:2},bias:{value:.5},dithering:{value:1e-4}},vertexShader:"\n        varying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}\n    ",fragmentShader:"\n        #include <common>\n\n        varying vec2 vUv;\n\n        uniform sampler2D tColor;\n        uniform sampler2D tDepth;\n\n        uniform vec2 resolution;\n\n        uniform float znear;\n        uniform float zfar;\n\n        uniform float focalDepth;\n        uniform float focalLength;\n        uniform float fstop;\n\n        uniform float maxblur; // clamp value of max blur (0.0 = no blur, 1.0 default)\n        uniform float threshold; // highlight threshold\n        uniform float gain; // highlight gain\n        uniform float bias; // bokeh edge bias\n        uniform float dithering;\n\n        const int samples = SAMPLES;\n        const int rings = RINGS;\n        const int maxringsamples = rings * samples;\n\n        float CoC = 0.03; // circle of confusion size in mm (35mm film = 0.03mm)\n\n        vec3 color(vec2 coords, float blur) {\n            vec3 col = texture2D(tColor, coords).rgb;\n            vec3 lumcoeff = vec3(0.299,0.587,0.114);\n            float lum = dot(col.rgb, lumcoeff);\n            float thresh = max((lum - threshold) * gain, 0.0);\n            return col + mix(vec3(0.0), col, thresh * blur);\n        }\n\n        float linearize(float depth) {\n            return -zfar * znear / (depth * (zfar - znear) - zfar);\n        }\n\n        float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {\n            float rings2 = float(rings);\n            float step = PI * 2.0 / float(ringsamples);\n            float pw = cos(j * step) * i;\n            float ph = sin(j * step) * i;\n            col += color(vUv + vec2(pw * w, ph * h), blur) * mix(1.0, i / rings2, bias);\n            return mix(1.0, i / rings2, bias);\n        }\n\n        void main() {\n            float depth = linearize(texture2D(tDepth, vUv).x);\n            float fDepth = focalDepth;\n\n            // dof blur factor calculation\n\n            float f = focalLength; // focal length in mm\n            float d = fDepth * 1000.; // focal plane in mm\n            float o = depth * 1000.; // depth in mm\n\n            float a = (o * f) / (o - f);\n            float b = (d * f) / (d - f);\n            float c = (d - f) / (d * fstop * CoC);\n\n            float blur = abs(a - b) * c;\n            blur = clamp(blur, 0.0, 1.0);\n\n            // calculation of pattern for dithering\n\n            vec2 noise = vec2(rand(vUv), rand(vUv + vec2(0.4, 0.6))) * dithering * blur;\n\n            // getting blur x and y step factor\n\n            float w = resolution.x * blur * maxblur + noise.x;\n            float h = resolution.y * blur * maxblur + noise.y;\n\n            // calculation of final color\n\n            vec3 col = vec3(0.0);\n\n            if (blur < 0.05) {\n                col = texture2D(tColor, vUv).rgb;\n            } else {\n                col = texture2D(tColor, vUv).rgb;\n\n                float s = 1.0;\n                int ringsamples;\n\n                for(int i = 1; i <= rings; i++) {\n                    ringsamples = i * samples;\n\n                    for (int j = 0; j < maxringsamples; j++) {\n                        if (j >= ringsamples) break;\n                        s += gather(float(i), float(j), ringsamples, col, w, h, blur);\n                    }\n                }\n\n                col /= s; // divide by sample count\n            }\n\n            gl_FragColor = vec4(col, 1.0);\n        }\n    "},Tr={uniforms:{tDiffuse:{value:null},time:{value:0},nIntensity:{value:.5},sIntensity:{value:.05},sCount:{value:4096},grayscale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float dx = rand( vUv + time );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},Mr={uniforms:{tDiffuse:{value:null},uChromaFactor:{value:.025},uResolutionRatio:{value:new THREE.Vector2(1,1)},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float uChromaFactor;","uniform vec2 uResolutionRatio;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","vec2 uv = vUv;","vec2 dist = uv - 0.5;","vec2 offset = uChromaFactor * dist * length(dist);","vec4 col = texture2D(tDiffuse, min(uv, 1.0 - resolution) * uResolutionRatio);","col.r = texture2D(tDiffuse, min(uv - offset, 1.0 - resolution) * uResolutionRatio).r;","col.b = texture2D(tDiffuse, min(uv + offset, 1.0 - resolution) * uResolutionRatio).b;","gl_FragColor = col;","}"].join("\n")},Cr={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},Sr={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immedates.","    // Immedates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")},jr=new THREE.OrthographicCamera(-1,1,1,-1,0,1),Pr=new THREE.Scene,Rr=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null);Rr.frustumCulled=!1,Pr.add(Rr);var Dr=new THREE.Color,Ar=function(){function e(t,i,r,o){n(this,e),this.clear=!0,this.clearColor=new THREE.Color(0,0,0),this.clearAlpha=1,this.clearDepthStencil=!0,this.textureID=void 0!==i?i:"tDiffuse",this.resolutionID=void 0!==r?r:"resolution",this.resolutionScaler=void 0!==o?o:1,t instanceof THREE.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=THREE.UniformsUtils.clone(t.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader||"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t}\n",fragmentShader:t.fragmentShader}))}return e.prototype.setSize=function(e,t){this.uniforms[this.resolutionID]&&this.uniforms[this.resolutionID].value.set(this.resolutionScaler/e,this.resolutionScaler/t)},e.prototype.render=function(e,t,i,r,n){this.uniforms[this.textureID]&&i&&(this.uniforms[this.textureID].value=i.texture),this.uniforms.time&&(this.uniforms.time.value+=r,this.uniforms.time.value>10&&(this.uniforms.time.value=0));var o=e.getClearAlpha(),s=e.autoClear;e.autoClear=!1,this.clear&&(Dr.copy(e.getClearColor()),e.setClearColor(this.clearColor,this.clearAlpha)),Rr.material=this.material,e.setRenderTarget(void 0!==t?t:null),this.clear&&e.clear(!0,this.clearDepthStencil,this.clearDepthStencil),e.render(Pr,jr),this.clear&&e.setClearColor(Dr,o),e.autoClear=s},e}(),kr={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1,generateMipmaps:!1};function Or(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8,o=new THREE.WebGLMultisampleRenderTarget(t,i,kr);return o.texture.name=e+".mrt",o.stencilBuffer=r,o.samples=Math.min(5,n),o}function Br(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=new THREE.WebGLRenderTarget(t,i,kr);return n.texture.name=e+".rt",n.stencilBuffer=r,n}function Fr(e,t,i){return{vertexShader:"\n\t\t\t#include <common>\n\t\t\t#include <skinning_pars_vertex>\n\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\tvoid main() {\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <skinning_vertex>\n\t\t\t\t#include <project_vertex>\n\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t}\n\t\t",fragmentShader:"\n\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\tvoid main() {\n\t\t\t\t#include <logdepthbuf_fragment>\n\t\t\t\tgl_FragColor = vec4("+e.toFixed(1)+", "+t.toFixed(1)+", "+i.toFixed(1)+", 1.0);\n\t\t\t}\n\t\t"}}var Lr=Fr(0,0,0),Ir=new Map;function Nr(e,t){var i=e.isInstancedMesh+"_"+t.skinning,r=void 0;return Ir.has(i)?r=Ir.get(i):((r=new THREE.ShaderMaterial(Lr)).skinning=t.skinning,Ir.set(i,r)),r}function Ur(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.depthTest=t.depthTest,e.depthWrite=t.depthWrite,e.colorWrite=t.colorWrite,e.colorWrite&&!i&&(e.colorWrite=!(t.transparent&&!t.depthWrite)),e.side=t.side}function zr(e,t){if(!e)return null;var i=e[t];return i?"[object Object]"===toString.call(i)?i.skip?"skip":void 0!==i.value?i.value:1:i:null}function Hr(e,t){return"BackgroundCubeMaterial"==t.name||"BackgroundMaterial"==t.name||"sky"===e.name||!0===e.isSky}var Vr=function(){function e(t,i,r,o){n(this,e),this._mrt=Or("SceneBuffer",t,i,r,o),this._rt=Br("SceneBuffer",t,i,r),this._depthBindType=null,this.useMRT=!1}return e.prototype.setDepthTexture=function(e){return this._rt.depthTexture!==e&&(this._rt.depthTexture=e,this._rt.webglDepthRenderbuffer=null,this._rt.dispose(),!0)},e.prototype.setDepthRenderBuffer=function(e,t){return(this._rt.webglDepthRenderbuffer!==t||this._mrt.webglDepthRenderbuffer!==e)&&(this._rt.depthTexture=null,this._rt.webglDepthRenderbuffer=t,this._mrt.webglColorRenderbuffer=null,this._mrt.webglDepthRenderbuffer=e,this._rt.dispose(),this._mrt.dispose(),!0)},e.prototype.setColorDepthRenderBuffer=function(e,t){return(this._mrt.webglColorRenderbuffer!==e||this._mrt.webglDepthRenderbuffer!==t)&&(this._mrt.webglColorRenderbuffer=e,this._mrt.webglDepthRenderbuffer=t,this._mrt.dispose(),!0)},e.prototype.setSize=function(e,t){this._mrt.setSize(e,t),this._rt.setSize(e,t)},e.prototype.render=function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=e.autoClear;e.autoClear=!1,e.setRenderTarget(this.useMRT?this._mrt:this._rt),r&&e.clear(),e.render(t,i),e.autoClear=n},e.prototype.getSchemeTexture=function(){return this.useMRT?this._mrt.texture:this._rt.texture},e.prototype.getSchemeBuffer=function(){return this.useMRT?this._mrt:this._rt},e.prototype.dispose=function(){this._mrt.dispose(),this._rt.dispose()},e}(),Wr={_USE_ROUGHNESSMAP:!1},Gr={roughness:{value:1},roughnessMap:{value:null}},qr="\n        varying vec3 vNormal;\n        varying vec2 vUv;\n\n        #include <common>\n        #include <morphtarget_pars_vertex>\n        #include <skinning_pars_vertex>\n        // #include <logdepthbuf_pars_vertex>\n        #include <clipping_planes_pars_vertex>\n\n        void main() {\n\n            vUv = uv;\n\n            #include <beginnormal_vertex>\n            #include <morphnormal_vertex>\n            #include <skinbase_vertex>\n            #include <skinnormal_vertex>\n\n            // @THREE-Modification\n            // normal instanced\n            #ifdef INSTANCED\n\n                mat4 instanceMat = compose( instancePosition, instanceQuaternion, instanceScale );\n                mat3 im = mat3( instanceMat );\n                objectNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n                objectNormal = im * objectNormal;\n\n            #endif\n\n            #include <defaultnormal_vertex>\n\n            vNormal = normalize( transformedNormal );\n\n            #include <begin_vertex>\n\n            // @THREE-Modification\n            // position instanced\n            #ifdef INSTANCED\n                transformed.xyz = ( instanceMat * vec4( transformed, 1.0 ) ).xyz;\n            #endif\n\n            #include <morphtarget_vertex>\n            #include <skinning_vertex>\n            #include <project_vertex>\n            // #include <logdepthbuf_vertex>\n            #include <clipping_planes_vertex>\n\n        }\n    ",Xr="\n        uniform float roughness;\n\n        #ifdef _USE_ROUGHNESSMAP\n            uniform sampler2D roughnessMap;\n        #endif\n\n        varying vec3 vNormal;\n        varying vec2 vUv;\n\n        #include <packing>\n        // #include <logdepthbuf_pars_fragment>\n        #include <clipping_planes_pars_fragment>\n\n        void main() {\n\n            #include <clipping_planes_fragment>\n            // #include <logdepthbuf_fragment>\n\n            vec3 normal = normalize( vNormal );\n\n            float roughnessFactor = roughness;\n\n            #ifdef _USE_ROUGHNESSMAP\n                roughnessFactor *= texture2D( roughnessMap, vUv ).g;\n            #endif\n\n            gl_FragColor = vec4( packNormalToRGB( normal ), clamp(1. - roughnessFactor, 0., 1.) );\n\n        }\n    ",Jr=function(){function e(t,i){n(this,e),this._rt=new THREE.WebGLRenderTarget(t,i,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.HalfFloatType,generateMipmaps:!1}),this._rt.depthTexture=new THREE.DepthTexture(t,i),this._rt.depthTexture.format=THREE.DepthStencilFormat,this._rt.depthTexture.type=THREE.UnsignedInt248Type,this._rt.depthTexture.generateMipmaps=!1,this.ignoreTransparent=!0}return e.prototype._checkStrategyInited=function(e){return e.materialManager.hasStrategy("GBuffer")},e.prototype._initStrategy=function(e){var t=this;e.materialManager.addStrategy("GBuffer",(function(e,i,r,n,o,s){return t.ignoreTransparent&&o.transparent||Hr(this,o)||o.isSpriteMaterial||this._gBufferIgnore||t.ignoreTransparent&&o.alphaTest>0?null:Zr.getNormalGlossinessMaterial(this,o)}))},e.prototype.setSize=function(e,t){this._rt.setSize(e,t)},e.prototype.render=function(e,t,i,r){this._checkStrategyInited(e)||this._initStrategy(e),this.ignoreTransparent=r;var n=e.getClearColor().getHex(),o=e.getClearAlpha(),s=e.autoClear;e.autoClear=!1,e.setClearColor(7829503,0),e.materialManager.setMode("GBuffer");var a=t.autoUpdate,l=t.background,u=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.initRenderList=!1,e.renderCustom1=!1,e.setRenderTarget(this._rt),e.clear(),e.render(t,i),t.autoUpdate=a,t.background=l,e.shadowMap.enable=u,e.initRenderList=!0,e.renderCustom1=!0,e.materialManager.setMode(0),e.autoClear=s,e.setClearColor(n,o)},e.prototype.getNormalGlossinessTexture=function(){return this._rt.texture},e.prototype.getDepthTexture=function(){return this._rt.depthTexture},e.prototype.dispose=function(){this._rt.dispose()},e}(),Yr={},Zr=new(function(){function e(){n(this,e),this._normalGlossinessMaterials=new Map}return e.prototype.getNormalGlossinessMaterial=function(e,t){Yr.instancing=e.isInstancedMesh,Yr.useRoughnessMap=!!t.roughnessMap&&void 0===e._gBufferRoughness,Yr.skinning=t.skinning,Yr.morphTargets=t.morphTargets,Yr.morphNormals=t.morphNormals,Yr.side=t.side,Yr.instanced=t.defines&&(""===t.defines.INSTANCED||t.defines.INSTANCED);var i=void 0,r=Yr.instancing+"_"+Yr.useRoughnessMap+"_"+Yr.skinning+"_"+Yr.morphTargets+"_"+Yr.morphNormals+"_"+Yr.side+"_"+Yr.instanced;this._normalGlossinessMaterials.has(r)?i=this._normalGlossinessMaterials.get(r):((i=new THREE.ShaderMaterial({defines:Object.assign({},Wr),uniforms:THREE.UniformsUtils.clone(Gr),vertexShader:qr,fragmentShader:Xr})).skinning=t.skinning,i.morphTargets=t.morphTargets,i.morphNormals=t.morphNormals,i.side=t.side,i.defines._USE_ROUGHNESSMAP=!!Yr.useRoughnessMap&&"",Yr.instanced&&(i.defines.INSTANCED=""),this._normalGlossinessMaterials.set(r,i));var n=.5;return void 0!==e._gBufferRoughness?n=e._gBufferRoughness:void 0!==t.roughness&&(n=t.roughness),i.uniforms.roughness.value=n,i.uniforms.roughnessMap.value=t.roughnessMap,i.uniformsNeedUpdate=!0,i},e}()),Qr={defines:{DEPTH_PACKING:1,KERNEL_SIZE:64,EPSILON:1e-6},uniforms:{normalTex:{value:null},depthTex:{value:null},noiseTex:{value:null},texSize:{value:new THREE.Vector2},noiseTexSize:{value:new THREE.Vector2(4,4)},projection:{value:new THREE.Matrix4},projectionInv:{value:new THREE.Matrix4},kernel:{value:null},radius:{value:.2},power:{value:1},bias:{value:.004},intensity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp sampler2D;","#include <packing>","varying vec2 vUv;","uniform sampler2D normalTex;","uniform sampler2D depthTex;","uniform vec2 texSize;","uniform sampler2D noiseTex;","uniform vec2 noiseTexSize;","uniform mat4 projection;","uniform mat4 projectionInv;","uniform vec3 kernel[KERNEL_SIZE];","uniform float radius;","uniform float power;","uniform float bias;","uniform float intensity;","float getDepth( const in vec2 screenPosition ) {","#if DEPTH_PACKING == 1","return unpackRGBAToDepth( texture2D( depthTex, screenPosition ) );","#elif DEPTH_PACKING == 2","return texture2D( depthTex, screenPosition ).w;","#else","return texture2D( depthTex, screenPosition ).x;","#endif","}","vec3 getViewNormal( const in vec2 screenPosition ) {","return unpackRGBToNormal( texture2D( normalTex, screenPosition ).xyz );","}","float ssaoEstimator(in mat3 kernelBasis, in vec3 originPos, in vec3 N) {","float occlusion = 0.0;","for (int i = 0; i < KERNEL_SIZE; i++) {","vec3 samplePos = kernel[i];","samplePos = kernelBasis * samplePos;","samplePos = samplePos * radius + originPos;","vec4 texCoord = projection * vec4(samplePos, 1.0);","texCoord.xy /= texCoord.w;","texCoord.xy = texCoord.xy * 0.5 + 0.5;","float sampleDepth = getDepth(texCoord.xy);","float z = sampleDepth * 2.0 - 1.0;","#ifdef ALCHEMY","vec4 projectedPos = vec4(texCoord.xy * 2.0 - 1.0, z, 1.0);","vec4 p4 = projectionInv * projectedPos;","p4.xyz /= p4.w;","vec3 cDir = p4.xyz - originPos;","float vv = dot(cDir, cDir);","float vn = dot(cDir, N);","float radius2 = radius * radius;","vn = max(vn + p4.z * bias, 0.0);","float f = max(radius2 - vv, 0.0) / radius2;","occlusion += f * f * f * max(vn / (0.01 + vv), 0.0);","#else","if (projection[3][3] == 0.0) {","z = projection[3][2] / (z * projection[2][3] - projection[2][2]);","} else {","z = (z - projection[3][2]) / projection[2][2];","}","float factor = step(samplePos.z, z - bias);","float rangeCheck = smoothstep(0.0, 1.0, radius / abs(originPos.z - z));","occlusion += rangeCheck * factor;","#endif","}","occlusion = 1.0 - occlusion / float(KERNEL_SIZE);","return pow(occlusion, power);","}","void main() {","float centerDepth = getDepth( vUv );","if( centerDepth >= ( 1.0 - EPSILON ) ) {","\tdiscard;","}","vec3 N = getViewNormal( vUv );","vec2 noiseTexCoord = texSize / vec2(noiseTexSize) * vUv;","vec3 rvec = texture2D(noiseTex, noiseTexCoord).rgb * 2.0 - 1.0;","vec3 T = normalize(rvec - N * dot(rvec, N));","vec3 BT = normalize(cross(N, T));","mat3 kernelBasis = mat3(T, BT, N);","float z = centerDepth * 2.0 - 1.0;","vec4 projectedPos = vec4(vUv * 2.0 - 1.0, z, 1.0);","vec4 p4 = projectionInv * projectedPos;","vec3 position = p4.xyz / p4.w;","float ao = ssaoEstimator(kernelBasis, position, N);","ao = clamp(1.0 - (1.0 - ao) * intensity, 0.0, 1.0);","gl_FragColor = vec4(vec3(ao), 1.0);","}"].join("\n")},Kr={defines:{NORMALTEX_ENABLED:1,DEPTHTEX_ENABLED:1,DEPTH_PACKING:1},uniforms:{tDiffuse:{value:null},textureSize:{value:new THREE.Vector2},direction:{value:0},blurSize:{value:1},depthTex:{value:null},normalTex:{value:null},projection:{value:new THREE.Matrix4},depthRange:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec2 vUv;","uniform vec2 textureSize;","uniform float blurSize;","uniform sampler2D tDiffuse;","uniform int direction;","#if NORMALTEX_ENABLED == 1","uniform sampler2D normalTex;","vec3 getViewNormal( const in vec2 screenPosition ) {","return unpackRGBToNormal( texture2D( normalTex, screenPosition ).xyz );","}","#endif","#if DEPTHTEX_ENABLED == 1","uniform sampler2D depthTex;","uniform mat4 projection;","uniform float depthRange;","float getDepth( const in vec2 screenPosition ) {","#if DEPTH_PACKING == 1","return unpackRGBAToDepth( texture2D( depthTex, screenPosition ) );","#elif DEPTH_PACKING == 2","return texture2D( depthTex, screenPosition ).w;","#else","return texture2D( depthTex, screenPosition ).x;","#endif","}","float getLinearDepth(vec2 coord) {","float depth = getDepth(coord) * 2.0 - 1.0;","return projection[3][2] / (depth * projection[2][3] - projection[2][2]);","}","#endif","void main() {","float kernel[5];","kernel[0] = 0.122581;","kernel[1] = 0.233062;","kernel[2] = 0.288713;","kernel[3] = 0.233062;","kernel[4] = 0.122581;","vec2 off = vec2(0.0);","if (direction == 0) {","off[0] = blurSize / textureSize.x;","}","else {","off[1] = blurSize / textureSize.y;","}","float sum = 0.0;","float weightAll = 0.0;","#if NORMALTEX_ENABLED == 1","vec3 centerNormal = getViewNormal(vUv);","#endif","#if DEPTHTEX_ENABLED == 1","float centerDepth = getLinearDepth(vUv);","#endif","for (int i = 0; i < 5; i++) {","vec2 coord = clamp(vUv + vec2(float(i) - 2.0) * off, vec2(0.0), vec2(1.0));","float w = kernel[i];","#if NORMALTEX_ENABLED == 1","vec3 normal = getViewNormal(coord);","w *= clamp(dot(normal, centerNormal), 0.0, 1.0);","#endif","#if DEPTHTEX_ENABLED == 1","float d = getLinearDepth(coord);","w *= (1.0 - smoothstep(0.0, 1.0, abs(centerDepth - d) / depthRange));","#endif","weightAll += w;","sum += w * texture2D(tDiffuse, coord).r;","}","gl_FragColor = vec4(vec3(sum / weightAll), 1.0);","}"].join("\n")};function $r(e){return e.replace(/^\S/,(function(e){return e.toUpperCase()}))}function en(e,t){if("[object Object]"!==t.toString())return t;for(var i in t)t.hasOwnProperty(i)&&(e||(e={}),e[i]=en(e[i],t[i]));return e}var tn={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1};function rn(e,t){return new THREE.WebGLRenderTarget(e,t,tn)}var nn=new Map;function on(e){for(var t=new Uint8Array(e*e*4),i=0,r=new THREE.Vector3,n=0;n<e;n++)for(var o=0;o<e;o++)r.set(2*Math.random()-1,2*Math.random()-1,0).normalize(),t[i++]=255*(.5*r.x+.5),t[i++]=255*(.5*r.y+.5),t[i++]=0,t[i++]=255;return t}function sn(e,t){for(var i=0,r=1/t,n=e;n>0;)i+=r*(n%t),n=Math.floor(n/t),r/=t;return i}var an=function(){function e(t,i){n(this,e),this._tempRenderTarget=rn(t,i),this._tempRenderTarget2=rn(t,i),this._ssaoPass=new Ar(Qr,void 0,"texSize"),this._ssaoPass.material.depthTest=!1,this._ssaoPass.material.depthWrite=!1,this._blurPass=new Ar(Kr,void 0,"textureSize"),this._blurPass.material.depthTest=!1,this._blurPass.material.depthWrite=!1,this._blurPass.material.transparent=!0,this._blurPass.material.blending=THREE.CustomBlending,this._blurPass.material.blendSrc=THREE.ZeroFactor,this._blurPass.material.blendDst=THREE.SrcColorFactor,this._blurPass.material.blendEquation=THREE.AddEquation,this._blurPass.material.blendSrcAlpha=THREE.ZeroFactor,this._blurPass.material.blendDstAlpha=THREE.SrcColorFactor,this._blurPass.material.blendEquationAlpha=THREE.AddEquation,this._kernels={},this.setNoiseSize(4),this.setKernelSize(12),this.setParameter("radius",.2),this.setParameter("bias",.004),this.setParameter("power",1),this.setParameter("intensity",.8),this.setParameter("blurSize",1),this._ssaoPass.setSize(1/t,1/i),this._blurPass.setSize(1/t,1/i)}return e.prototype.setKernelSize=function(e,t){t=void 0!==t?t:0,this._kernels[e+"_"+t]||(this._kernels[e+"_"+t]=function(e,t,i){var r=new Float32Array(3*e);t=t||0;for(var n=0;n<e;n++){var o=sn(n+t,2)*(i?1:2)*Math.PI,s=sn(n+t,3)*Math.PI,a=Math.random(),l=Math.cos(o)*Math.sin(s)*a,u=Math.cos(s)*a,c=Math.sin(o)*Math.sin(s)*a;r[3*n]=l,r[3*n+1]=u,r[3*n+2]=c}return r}(e,e*t,!0)),this._ssaoPass.material.defines.KERNEL_SIZE=e,this._ssaoPass.material.uniforms.kernel.value=this._kernels[e+"_"+t],this._ssaoPass.material.needsUpdate=!0},e.prototype.setNoiseSize=function(e){var t=this._ssaoPass.material.uniforms.noiseTex.value;t?(t.image.data=on(e),t.image.width=e,t.image.height=e,t.needsUpdate=!0):(t=function(e){var t=new THREE.DataTexture(on(e),e,e,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping);return t.needsUpdate=!0,t}(e),this._ssaoPass.material.uniforms.noiseTex.value=t),this._ssaoPass.material.uniforms.noiseTexSize.value.set(e,e)},e.prototype.setParameter=function(e,t){"noiseTexSize"===e?this.setNoiseSize(t):"kernelSize"===e?this.setKernelSize(t):"blurSize"===e?this._blurPass.material.uniforms.blurSize.value=t:this._ssaoPass.material.uniforms[e].value=t},e.prototype.setSize=function(e,t){this._tempRenderTarget.setSize(e,t),this._tempRenderTarget2.setSize(e,t),this._ssaoPass.setSize(1/e,1/t),this._blurPass.setSize(1/e,1/t)},e.prototype.render=function(e,t,i,r,n,o){this._ssaoPass.material.uniforms.normalTex.value=e,this._ssaoPass.material.uniforms.depthTex.value=t,this._ssaoPass.material.uniforms.projection.value.copy(r.projectionMatrix),this._ssaoPass.material.uniforms.projectionInv.value.getInverse(r.projectionMatrix),this._blurPass.material.uniforms.normalTex.value=e,this._blurPass.material.uniforms.depthTex.value=t,this._blurPass.material.uniforms.projection.value.copy(r.projectionMatrix),t===e?(this._ssaoPass.material.defines.DEPTH_PACKING=2,this._blurPass.material.defines.DEPTH_PACKING=2):t.isDepthTexture?(this._ssaoPass.material.defines.DEPTH_PACKING=0,this._blurPass.material.defines.DEPTH_PACKING=0):(this._ssaoPass.material.defines.DEPTH_PACKING=1,this._blurPass.material.defines.DEPTH_PACKING=1),this._ssaoPass.clearColor.setRGB(1,1,1),this._ssaoPass.clearAlpha=1,this._ssaoPass.render(i,this._tempRenderTarget),this._blurPass.clearColor.setRGB(1,1,1),this._blurPass.clearAlpha=1,this._blurPass.clear=!0,this._blurPass.material.uniforms.direction.value=0,this._blurPass.material.transparent=!1,this._blurPass.render(i,this._tempRenderTarget2,this._tempRenderTarget),o?(this._blurPass.clearColor.setRGB(0,0,0),this._blurPass.clearAlpha=0):this._blurPass.clear=!1,this._blurPass.material.uniforms.direction.value=1,this._blurPass.material.transparent=!o,this._blurPass.material.blending=o?THREE.NoBlending:THREE.CustomBlending,this._blurPass.render(i,void 0!==n?n:null,this._tempRenderTarget2)},e.prototype.dispose=function(){this._tempRenderTarget.dispose(),this._tempRenderTarget2.dispose(),this._ssaoPass.material.dispose(),this._blurPass.material.dispose()},e}(),ln={defines:{},uniforms:{colorTex:{value:null},gBufferTexture1:{value:null},gBufferTexture2:{value:null},projection:{value:new THREE.Matrix4},projectionInv:{value:new THREE.Matrix4},maxRayDistance:{value:200},pixelStride:{value:16},pixelStrideZCutoff:{value:50},screenEdgeFadeStart:{value:.9},eyeFadeStart:{value:.4},eyeFadeEnd:{value:.8},minGlossiness:{value:.2},zThicknessThreshold:{value:.1},jitterOffset:{value:0},nearZ:{value:0},viewportSize:{value:new THREE.Vector2(512,512)},maxMipmapLevel:{value:5}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n        #define MAX_ITERATION 20;\n\t\t#define MAX_BINARY_SEARCH_ITERATION 5;\n\n\t\tuniform sampler2D colorTex;\n\t\tuniform sampler2D gBufferTexture1;\n\t\tuniform sampler2D gBufferTexture2;\n\n\t\tuniform mat4 projection;\n\t\tuniform mat4 projectionInv;\n\t\t// uniform mat4 viewInverseTranspose;\n\n\t\tuniform float maxRayDistance;\n\n\t\tuniform float pixelStride;\n\t\t// ray origin Z at this distance will have a pixel stride of 1.0\n\t\tuniform float pixelStrideZCutoff;\n\n\t\t// distance to screen edge that ray hits will start to fade (0.0 -> 1.0)\n\t\tuniform float screenEdgeFadeStart;\n\n\t\t// ray direction's Z that ray hits will start to fade (0.0 -> 1.0)\n\t\tuniform float eyeFadeStart;\n\t\t// ray direction's Z that ray hits will be cut (0.0 -> 1.0)\n\t\tuniform float eyeFadeEnd;\n\n\t\t// Object larger than minGlossiness will have ssr effect\n\t\tuniform float minGlossiness;\n\t\tuniform float zThicknessThreshold;\n\n\t\tuniform float jitterOffset;\n\n\t\tuniform float nearZ;\n\t\tuniform vec2 viewportSize;\n\n        uniform float maxMipmapLevel;\n        \n        varying vec2 vUv;\n\n        float fetchDepth(sampler2D depthTexture, vec2 uv) {\n\t\t\tvec4 depthTexel = texture2D(depthTexture, uv);\n\t\t\treturn depthTexel.r * 2.0 - 1.0;\n\t\t}\n\n\t\tfloat linearDepth(float depth) {\n\t\t\treturn projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n\t\t}\n\n\t\tbool rayIntersectDepth(float rayZNear, float rayZFar, vec2 hitPixel) {\n\t\t    // Swap if bigger\n\t\t\tif (rayZFar > rayZNear) {\n\t\t\t\tfloat t = rayZFar; rayZFar = rayZNear; rayZNear = t;\n\t\t\t}\n\t\t\tfloat cameraZ = linearDepth(fetchDepth(gBufferTexture2, hitPixel));\n\t\t    // float cameraBackZ = linearDepth(fetchDepth(backDepthTex, hitPixel));\n\t\t    // Cross z\n\t\t\treturn rayZFar <= cameraZ && rayZNear >= cameraZ - zThicknessThreshold;\n\t\t}\n\n\t\t// Trace a ray in screenspace from rayOrigin (in camera space) pointing in rayDir (in camera space)\n\t\t//\n\t\t// With perspective correct interpolation\n\t\t//\n\t\t// Returns true if the ray hits a pixel in the depth buffer\n\t\t// and outputs the hitPixel (in UV space), the hitPoint (in camera space) and the number\n\t\t// of iterations it took to get there.\n\t\t//\n\t\t// Based on Morgan McGuire & Mike Mara's GLSL implementation:\n\t\t// http://casual-effects.blogspot.com/2014/08/screen-space-ray-tracing.html\n\t\tbool traceScreenSpaceRay(vec3 rayOrigin, vec3 rayDir, float jitter, out vec2 hitPixel, out vec3 hitPoint, out float iterationCount) {\n\t\t    // Clip to the near plane\n\t\t\tfloat rayLength = ((rayOrigin.z + rayDir.z * maxRayDistance) > -nearZ) ? (-nearZ - rayOrigin.z) / rayDir.z : maxRayDistance;\n\n\t\t\tvec3 rayEnd = rayOrigin + rayDir * rayLength;\n\n\t\t    // Project into homogeneous clip space\n\t\t\tvec4 H0 = projection * vec4(rayOrigin, 1.0);\n\t\t\tvec4 H1 = projection * vec4(rayEnd, 1.0);\n\n\t\t\tfloat k0 = 1.0 / H0.w, k1 = 1.0 / H1.w;\n\n\t\t    // The interpolated homogeneous version of the camera space points\n\t\t\tvec3 Q0 = rayOrigin * k0, Q1 = rayEnd * k1;\n\n\t\t    // Screen space endpoints\n\t\t    // PENDING viewportSize ?\n\t\t\tvec2 P0 = (H0.xy * k0 * 0.5 + 0.5) * viewportSize;\n\t\t\tvec2 P1 = (H1.xy * k1 * 0.5 + 0.5) * viewportSize;\n\n\t\t    // If the line is degenerate, make it cover at least one pixel to avoid handling\n\t\t    // zero-pixel extent as a special case later\n\t\t\tP1 += dot(P1 - P0, P1 - P0) < 0.0001 ? 0.01 : 0.0;\n\t\t\tvec2 delta = P1 - P0;\n\n\t\t    // Permute so that the primary iteration is in x to collapse\n\t\t    // all quadrant-specific DDA case later\n\t\t\tbool permute = false;\n\t\t\tif (abs(delta.x) < abs(delta.y)) {\n\t\t    // More vertical line\n\t\t\t\tpermute = true;\n\t\t\t\tdelta = delta.yx;\n\t\t\t\tP0 = P0.yx;\n\t\t\t\tP1 = P1.yx;\n\t\t\t}\n\t\t\tfloat stepDir = sign(delta.x);\n\t\t\tfloat invdx = stepDir / delta.x;\n\n\t\t    // Track the derivatives of Q and K\n\t\t\tvec3 dQ = (Q1 - Q0) * invdx;\n\t\t\tfloat dk = (k1 - k0) * invdx;\n\n\t\t\tvec2 dP = vec2(stepDir, delta.y * invdx);\n\n            // Calculate pixel stride based on distance of ray origin from camera.\n            // Since perspective means distant objects will be smaller in screen space\n            // we can use this to have higher quality reflections for far away objects\n            // while still using a large pixel stride for near objects (and increase performance)\n            // this also helps mitigate artifacts on distant reflections when we use a large\n            // pixel stride.\n\t\t\tfloat strideScaler = 1.0 - min(1.0, -rayOrigin.z / pixelStrideZCutoff);\n\t\t\tfloat pixStride = 1.0 + strideScaler * pixelStride;\n\n\t\t    // Scale derivatives by the desired pixel stride and the offset the starting values by the jitter fraction\n\t\t\tdP *= pixStride; dQ *= pixStride; dk *= pixStride;\n\n\t\t    // Track ray step and derivatives in a vec4 to parallelize\n\t\t\tvec4 pqk = vec4(P0, Q0.z, k0);\n\t\t\tvec4 dPQK = vec4(dP, dQ.z, dk);\n\n\t\t\tpqk += dPQK * jitter;\n\t\t\tfloat rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n\t\t\tfloat rayZNear;\n\n\t\t\tbool intersect = false;\n\n\t\t\tvec2 texelSize = 1.0 / viewportSize;\n\n\t\t\titerationCount = 0.0;\n\n\t\t\tfor (int i = 0; i < 20; i++) {\n\t\t\t\tpqk += dPQK;\n\n\t\t\t\trayZNear = rayZFar;\n\t\t\t\trayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n\n\t\t\t\thitPixel = permute ? pqk.yx : pqk.xy;\n\t\t\t\thitPixel *= texelSize;\n\n\t\t\t\tintersect = rayIntersectDepth(rayZNear, rayZFar, hitPixel);\n\n\t\t\t\titerationCount += 1.0;\n\n\t\t        // PENDING Right on all platforms?\n\t\t\t\tif (intersect) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t    // Binary search refinement\n\t\t    // FIXME If intersect in first iteration binary search may easily lead to the pixel of reflect object it self\n\t\t\tif (pixStride > 1.0 && intersect && iterationCount > 1.0) {\n\t\t        // Roll back\n\t\t\t\tpqk -= dPQK;\n\t\t\t\tdPQK /= pixStride;\n\n\t\t\t\tfloat originalStride = pixStride * 0.5;\n\t\t\t\tfloat stride = originalStride;\n\n\t\t\t\trayZNear = pqk.z / pqk.w;\n\t\t\t\trayZFar = rayZNear;\n\n\t\t\t\tfor (int j = 0; j < 5; j++) {\n\t\t\t\t\tpqk += dPQK * stride;\n\t\t\t\t\trayZNear = rayZFar;\n\t\t\t\t\trayZFar = (dPQK.z * -0.5 + pqk.z) / (dPQK.w * -0.5 + pqk.w);\n\t\t\t\t\thitPixel = permute ? pqk.yx : pqk.xy;\n\t\t\t\t\thitPixel *= texelSize;\n\n\t\t\t\t\toriginalStride *= 0.5;\n\t\t\t\t\tstride = rayIntersectDepth(rayZNear, rayZFar, hitPixel) ? -originalStride : originalStride;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tQ0.xy += dQ.xy * iterationCount;\n\t\t\tQ0.z = pqk.z;\n\t\t\thitPoint = Q0 / pqk.w;\n\n\t\t\treturn intersect;\n\t\t}\n\n\t\tfloat calculateAlpha(float iterationCount, float reflectivity, vec2 hitPixel, vec3 hitPoint, float dist, vec3 rayDir) {\n\t\t\tfloat alpha = clamp(reflectivity, 0.0, 1.0);\n\t\t    // Fade ray hits that approach the maximum iterations\n\t\t\talpha *= 1.0 - (iterationCount / float(20));\n\t\t    // Fade ray hits that approach the screen edge\n\t\t\tvec2 hitPixelNDC = hitPixel * 2.0 - 1.0;\n\t\t\tfloat maxDimension = min(1.0, max(abs(hitPixelNDC.x), abs(hitPixelNDC.y)));\n\t\t\talpha *= 1.0 - max(0.0, maxDimension - screenEdgeFadeStart) / (1.0 - screenEdgeFadeStart);\n\n\t\t    // Fade ray hits base on how much they face the camera\n\t\t\tfloat _eyeFadeStart = eyeFadeStart;\n\t\t\tfloat _eyeFadeEnd = eyeFadeEnd;\n\t\t\tif (_eyeFadeStart > _eyeFadeEnd) {\n\t\t\t\tfloat tmp = _eyeFadeEnd;\n\t\t\t\t_eyeFadeEnd = _eyeFadeStart;\n\t\t\t\t_eyeFadeStart = tmp;\n\t\t\t}\n\n\t\t\tfloat eyeDir = clamp(rayDir.z, _eyeFadeStart, _eyeFadeEnd);\n\t\t\talpha *= 1.0 - (eyeDir - _eyeFadeStart) / (_eyeFadeEnd - _eyeFadeStart);\n\n\t\t    // Fade ray hits based on distance from ray origin\n\t\t\talpha *= 1.0 - clamp(dist / maxRayDistance, 0.0, 1.0);\n\n\t\t\treturn alpha;\n        }\n        \n        void main() {\n\t\t\tvec4 normalAndGloss = texture2D(gBufferTexture1, vUv);\n\n\t\t    // Is empty\n\t\t\tif (dot(normalAndGloss.rgb, vec3(1.0)) == 0.0) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat g = normalAndGloss.a;\n\t\t\tif (g <= minGlossiness) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat reflectivity = (g - minGlossiness) / (1.0 - minGlossiness);\n\n\t\t\tvec3 N = normalAndGloss.rgb * 2.0 - 1.0;\n            // N = normalize((viewInverseTranspose * vec4(N, 0.0)).xyz);\n            N = normalize(N);\n\n\t\t    // Position in view\n\t\t\tvec4 projectedPos = vec4(vUv * 2.0 - 1.0, fetchDepth(gBufferTexture2, vUv), 1.0);\n\t\t\tvec4 pos = projectionInv * projectedPos;\n\t\t\tvec3 rayOrigin = pos.xyz / pos.w;\n\n\t\t\tvec3 rayDir = normalize(reflect(normalize(rayOrigin), N));\n\t\t\tvec2 hitPixel;\n\t\t\tvec3 hitPoint;\n\t\t\tfloat iterationCount;\n\n\t\t    // Get jitter\n\t\t\tvec2 uv2 = vUv * viewportSize;\n\t\t\tfloat jitter = fract((uv2.x + uv2.y) * 0.25) + jitterOffset;\n\n\t\t\tbool intersect = traceScreenSpaceRay(rayOrigin, rayDir, jitter, hitPixel, hitPoint, iterationCount);\n\n\t\t\tfloat dist = distance(rayOrigin, hitPoint);\n\n\t\t\tfloat alpha = calculateAlpha(iterationCount, reflectivity, hitPixel, hitPoint, dist, rayDir) * float(intersect);\n\n\t\t\tvec3 hitNormal = texture2D(gBufferTexture1, hitPixel).rgb * 2.0 - 1.0;\n            // hitNormal = normalize((viewInverseTranspose * vec4(hitNormal, 0.0)).xyz);\n            hitNormal = normalize(hitNormal);\n\n\t\t    // Ignore the pixel not face the ray\n\t\t    // TODO fadeout ?\n\t\t    // PENDING Can be configured?\n\t\t\tif (dot(hitNormal, rayDir) >= 0.0) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t    // vec4 color = decodeHDR(texture2DLodEXT(colorTex, hitPixel, clamp(dist / maxRayDistance, 0.0, 1.0) * maxMipmapLevel));\n\n\t\t\tif (!intersect) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tvec4 color = texture2D(colorTex, hitPixel);\n\t\t\tgl_FragColor = vec4(color.rgb * alpha, color.a);\n\n            // gl_FragColor = vec4(vec3(iterationCount / 2.0), 1.0);\n            // gl_FragColor = texture2D(colorTex, vUv);\n\t\t}\n    "},un={defines:{NORMALTEX_ENABLED:1,DEPTHTEX_ENABLED:1,DEPTH_PACKING:1},uniforms:{tDiffuse:{value:null},textureSize:{value:new THREE.Vector2},direction:{value:0},blurSize:{value:1},depthTex:{value:null},normalTex:{value:null},projection:{value:new THREE.Matrix4},depthRange:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec2 vUv;","uniform vec2 textureSize;","uniform float blurSize;","uniform sampler2D tDiffuse;","uniform int direction;","#if NORMALTEX_ENABLED == 1","uniform sampler2D normalTex;","vec3 getViewNormal( const in vec2 screenPosition ) {","return unpackRGBToNormal( texture2D( normalTex, screenPosition ).xyz );","}","#endif","#if DEPTHTEX_ENABLED == 1","uniform sampler2D depthTex;","uniform mat4 projection;","uniform float depthRange;","float getDepth( const in vec2 screenPosition ) {","#if DEPTH_PACKING == 1","return unpackRGBAToDepth( texture2D( depthTex, screenPosition ) );","#elif DEPTH_PACKING == 2","return texture2D( depthTex, screenPosition ).w;","#else","return texture2D( depthTex, screenPosition ).x;","#endif","}","float getLinearDepth(vec2 coord) {","float depth = getDepth(coord) * 2.0 - 1.0;","return projection[3][2] / (depth * projection[2][3] - projection[2][2]);","}","#endif","void main() {","float kernel[5];","kernel[0] = 0.122581;","kernel[1] = 0.233062;","kernel[2] = 0.288713;","kernel[3] = 0.233062;","kernel[4] = 0.122581;","vec2 off = vec2(0.0);","if (direction == 0) {","off[0] = blurSize / textureSize.x;","}","else {","off[1] = blurSize / textureSize.y;","}","vec4 sum = vec4(0.0);","float weightAll = 0.0;","#if NORMALTEX_ENABLED == 1","vec3 centerNormal = getViewNormal(vUv);","#endif","#if DEPTHTEX_ENABLED == 1","float centerDepth = getLinearDepth(vUv);","#endif","for (int i = 0; i < 5; i++) {","vec2 coord = clamp(vUv + vec2(float(i) - 2.0) * off, vec2(0.0), vec2(1.0));","float w = kernel[i];","#if NORMALTEX_ENABLED == 1","vec3 normal = getViewNormal(coord);","w *= clamp(dot(normal, centerNormal), 0.0, 1.0);","#endif","#if DEPTHTEX_ENABLED == 1","float d = getLinearDepth(coord);","w *= (1.0 - smoothstep(0.0, 1.0, abs(centerDepth - d) / depthRange));","#endif","weightAll += w;","sum += w * texture2D(tDiffuse, coord);","}","gl_FragColor = sum / weightAll;","}"].join("\n")},cn=function(){function e(t,i){n(this,e),this._tempRenderTarget=rn(t,i),this._tempRenderTarget2=rn(t,i),this._ssrPass=new Ar(ln,void 0,"viewportSize"),this._ssrPass.material.depthTest=!1,this._ssrPass.material.depthWrite=!1,this._blurPass=new Ar(un,void 0,"textureSize"),this._blurPass.material.uniforms.blurSize.value=2,this._blurPass.material.depthTest=!1,this._blurPass.material.depthWrite=!1,this._ssrPass.setSize(1/t,1/i),this._blurPass.setSize(1/t,1/i),this.jitter=!1}return e.prototype.setSize=function(e,t){this._tempRenderTarget.setSize(e,t),this._tempRenderTarget2.setSize(e,t),this._ssrPass.setSize(1/e,1/t),this._blurPass.setSize(1/e,1/t)},e.prototype.render=function(e,t,i,r,n,o,s){this._ssrPass.material.uniforms.colorTex.value=e,this._ssrPass.material.uniforms.gBufferTexture1.value=t,this._ssrPass.material.uniforms.gBufferTexture2.value=i,this._ssrPass.material.uniforms.projection.value.copy(n.projectionMatrix),this._ssrPass.material.uniforms.projectionInv.value.getInverse(n.projectionMatrix),this._ssrPass.material.uniforms.jitterOffset.value=this.jitter?Math.random():0,this._blurPass.material.uniforms.normalTex.value=t,this._blurPass.material.uniforms.depthTex.value=i,this._blurPass.material.uniforms.projection.value.copy(n.projectionMatrix),i===t?this._blurPass.material.defines.DEPTH_PACKING=2:i.isDepthTexture?this._blurPass.material.defines.DEPTH_PACKING=0:this._blurPass.material.defines.DEPTH_PACKING=1,this._ssrPass.clearColor.setRGB(0,0,0),this._ssrPass.clearAlpha=1,this._ssrPass.render(r,this._tempRenderTarget),this._blurPass.clearColor.setRGB(0,0,0),this._blurPass.clearAlpha=1,this._blurPass.clear=!0,this._blurPass.material.uniforms.direction.value=0,this._blurPass.material.transparent=!1,this._blurPass.render(r,this._tempRenderTarget2,this._tempRenderTarget),s?(this._blurPass.clearColor.setRGB(0,0,0),this._blurPass.clearAlpha=1):this._blurPass.clear=!1,this._blurPass.material.uniforms.direction.value=1,this._blurPass.material.transparent=!s,this._blurPass.material.blending=s?THREE.NoBlending:THREE.AdditiveBlending,this._blurPass.render(r,void 0!==o?o:null,this._tempRenderTarget2)},e.prototype.dispose=function(){this._tempRenderTarget.dispose(),this._tempRenderTarget2.dispose(),this._ssrPass.material.dispose(),this._blurPass.material.dispose()},e}(),hn=function(){function e(){n(this,e),this._schemeBuffer,this._dirty=!0,this.enable=!1,this.$enable=!0}return e.prototype.isActive=function(){return this.enable&&this.$enable},e.prototype.dispose=function(){},e.prototype.setSize=function(e,t){},e.prototype.render=function(e,t,i,r,n){},e.prototype.dirty=function(){this._dirty=!0},e}(),pn=0,dn=1,fn=2,mn=new THREE.Color,gn=function(){function e(t,i,r,o){n(this,e),this.name=r,this._mrt=Or(r,t,i,void 0,o),this._rt=Br(r,t,i),this._depthShareType=pn,this.useMRT=!1,this.enableLayer1=!1}return e.prototype._checkStrategyInited=function(e){return e.materialManager.hasStrategy(this.name)},e.prototype._initStrategy=function(e){},e.prototype.shareDepthTexture=function(e){return this._depthShareType!==dn&&(this._rt.depthTexture=e,this._rt.dispose(),this._depthShareType=dn,!0)},e.prototype.shareDepthRenderBuffer=function(e,t){return(this._depthShareType!==fn||this._mrt.webglDepthRenderbuffer!==e||this._rt.webglDepthRenderbuffer!==t)&&(this._mrt.webglDepthRenderbuffer=e,this._rt.webglDepthRenderbuffer=t,this._mrt.dispose(),this._rt.dispose(),this._depthShareType=fn,!0)},e.prototype.clearDepthShare=function(){return this._depthShareType!==pn&&(this._mrt.webglDepthRenderbuffer=null,this._rt.webglDepthRenderbuffer=null,this._mrt.dispose(),this._rt.dispose(),this._depthShareType=pn,!0)},e.prototype.setSize=function(e,t){this._mrt.setSize(e,t),this._rt.setSize(e,t)},e.prototype.render=function(e,t,i){this._checkStrategyInited(e)||this._initStrategy(e),mn.copy(e.getClearColor());var r=e.getClearAlpha(),n=e.autoClear;e.autoClear=!1,e.setClearColor(0,0),e.materialManager.setMode(this.name),this.depthShared&&(e.state.buffers.depth.setMask(!1),e.state.buffers.depth.setLocked(!0));var o=t.autoUpdate,s=t.background,a=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.initRenderList=!1,e.renderCustom1=!1,this.enableLayer1&&i.layers.enable(1),e.setRenderTarget(this.useMRT?this._mrt:this._rt),e.clear(!0,!this.depthShared,!0),e.render(t,i),this.enableLayer1&&i.layers.disable(1),t.autoUpdate=o,t.background=s,e.shadowMap.enable=a,e.initRenderList=!0,e.renderCustom1=!0,this.depthShared&&e.state.buffers.depth.setLocked(!1),e.materialManager.setMode(0),e.autoClear=n,e.setClearColor(mn,r)},e.prototype.setupRenderTarget=function(e){e.setRenderTarget(this.useMRT?this._mrt:this._rt)},e.prototype.getSchemeTexture=function(){return this.useMRT?this._mrt.texture:this._rt.texture},e.prototype.dispose=function(){this._mrt.dispose(),this._rt.dispose()},o(e,[{key:"depthShared",get:function(){return this._depthShareType!==pn}},{key:"depthShareType",get:function(){return this._depthShareType}}]),e}(),vn=0,yn=function(e){function t(i,r,o,s){n(this,t);var l=a(this,e.call(this,i,r,$r(o)+"Scheme_"+ ++vn,s));return l.marker=o,l}return s(t,e),t.prototype._initStrategy=function(e){var t=this;e.materialManager.addStrategy(this.name,(function(e,i,r,n,o,s){if(Hr(this,o))return null;var a=zr(this.technique,t.marker);if("skip"===a)return null;var l=void 0,u=!1;if(a){if(!a.isMaterial)return o;l=a,u=!0}else{if(t.depthShared)return null;l=Nr(this,o)}return Ur(l,o,u),l}))},t}(gn),bn=function(e){function t(i,r,o,s){var l;n(this,t),l=Array.isArray(o)?o.map((function(e){return $r(e)})).join(""):$r(o);var u=a(this,e.call(this,i,r,l,s));return u.marker=o,u}return s(t,e),t.prototype._initStrategy=function(e){var t=this;Array.isArray(t.marker)?e.materialManager.addStrategy(this.name,(function(e,i,r,n,o,s){if(Hr(this,o))return null;for(var a=void 0,l=0,u=t.marker.length;l<u;l++){var c=zr(this.technique,t.marker[l]);if(c&&"skip"!=c&&"0"!=c){a=c;break}if(l===u-1){a=c;break}}if("skip"===a)return null;if(a)return a.isMaterial?a:"number"!=typeof a||isNaN(a)||1===a?o:xn(o,a);if(t.depthShared)return null;var h=Nr(this,o);return Ur(h,o),h})):e.materialManager.addStrategy(this.name,(function(e,i,r,n,o,s){if(Hr(this,o))return null;var a=zr(this.technique,t.marker);if("skip"===a)return null;if(a)return a.isMaterial?a:"number"!=typeof a||isNaN(a)||1===a?o:xn(o,a);if(t.depthShared)return null;var l=Nr(this,o);return Ur(l,o),l}))},t}(yn),_n=new Map;function xn(e,t){var i=e.uuid+"_"+t,r=_n.get(i);return r||(e.addEventListener("dispose",En),(r=e.clone()).isShaderMaterial&&r.uniforms.strength?r.uniforms.strength.value=t:(t<1?e.transparent?(r.opacity=t,r.defines&&(r.defines.PREMULTIPLIED_ALPHA=!0),r.blending=THREE.CustomBlending,r.blendEquation=THREE.AddEquation,r.blendSrc=THREE.OneFactor,r.blendDst=THREE.ZeroFactor,r.blendSrcAlpha=THREE.ZeroFactor,r.blendDstAlpha=THREE.OneFactor):r.color?(r.color.r*=t,r.color.g*=t,r.color.b*=t):console.warn("strengthMat is not transparent and does not have color attribute"):r.color?(r.color.r*=t,r.color.g*=t,r.color.b*=t):console.warn("strengthMat does not have color attribute"),r.envMap=null),_n.set(i,r)),r}function En(e){var t=e.target;t.removeEventListener("dispose",En);var i=[];_n.forEach((function(e,r){r.indexOf(t.uuid)>-1&&i.push(r)})),i.forEach((function(e){_n.get(e).dispose(),_n.delete(e)}))}var wn={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new THREE.Color(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},Tn={defines:{KERNEL_RADIUS:7,SIGMA:7},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"#include <common>        varying vec2 vUv;\n        uniform sampler2D colorTexture;\n        uniform vec2 texSize;        uniform vec2 direction;                float gaussianPdf(in float x, in float sigma) {            return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;        }        void main() {\n            vec2 invSize = 1.0 / texSize;            float fSigma = float(SIGMA);            float weightSum = gaussianPdf(0.0, fSigma);            vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;            for( int i = 1; i < KERNEL_RADIUS; i ++ ) {                float x = float(i);                float w = gaussianPdf(x, fSigma);                vec2 uvOffset = direction * invSize * x;                vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;                vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;                diffuseSum += (sample1 + sample2) * w;                weightSum += 2.0 * w;            }            gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n        }"},Mn={defines:{NUM_MIPS:5},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"varying vec2 vUv;        uniform sampler2D blurTexture1;        uniform sampler2D blurTexture2;        uniform sampler2D blurTexture3;        uniform sampler2D blurTexture4;        uniform sampler2D blurTexture5;        uniform sampler2D dirtTexture;        uniform float bloomStrength;        uniform float bloomRadius;        uniform float bloomFactors[NUM_MIPS];        uniform vec3 bloomTintColors[NUM_MIPS];                float lerpBloomFactor(const in float factor) {             float mirrorFactor = 1.2 - factor;            return mix(factor, mirrorFactor, bloomRadius);        }                void main() {            gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +                                                 lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +                                                 lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +                                                 lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +                                                 lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );        }"},Cn=new THREE.Vector2(1,0),Sn=new THREE.Vector2(0,1),jn=function(e){function t(i,r,o,s){n(this,t);var l=a(this,e.call(this));l.strength=1.5,l.radius=.4,l.threshold=.2,l._schemeBuffer=new bn(i,r,o||"glow",s),l.renderTargetsHorizontal=[],l.renderTargetsVertical=[],l.nMips=5;var u=0,c=Math.round(i/2),h=Math.round(r/2);for(l.renderTargetBright=rn(c,h),l.renderTargetBright.texture.name="GlowPass.bright",u=0;u<l.nMips;u++){var p=rn(c,h);p.texture.name="GlowPass.h"+u,l.renderTargetsHorizontal.push(p);var d=rn(c,h);d.texture.name="GlowPass.v"+u,l.renderTargetsVertical.push(d),c=Math.round(c/2),h=Math.round(h/2)}l.highPass=new Ar(wn),l.highPass.clearAlpha=0,l.highPass.uniforms.luminosityThreshold.value=l.threshold,l.highPass.uniforms.smoothWidth.value=.01,l.separableBlurPasses=[];var f=[3,5,7,9,11];for(c=Math.round(i/2),h=Math.round(r/2),u=0;u<l.nMips;u++){var m=new Ar(Tn);m.clearAlpha=0,m.material.defines.KERNEL_RADIUS=f[u],m.material.defines.SIGMA=f[u],m.uniforms.texSize.value.set(c,h),l.separableBlurPasses.push(m),c=Math.round(c/2),h=Math.round(h/2)}l.compositePass=new Ar(Mn),l.compositePass.clearAlpha=0,l.compositePass.material.defines.NUM_MIPS=5,l.compositePass.uniforms.blurTexture1.value=l.renderTargetsVertical[0].texture,l.compositePass.uniforms.blurTexture2.value=l.renderTargetsVertical[1].texture,l.compositePass.uniforms.blurTexture3.value=l.renderTargetsVertical[2].texture,l.compositePass.uniforms.blurTexture4.value=l.renderTargetsVertical[3].texture,l.compositePass.uniforms.blurTexture5.value=l.renderTargetsVertical[4].texture,l.compositePass.uniforms.bloomStrength.value=l.strength,l.compositePass.uniforms.bloomRadius.value=.1;return l.compositePass.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],l.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],l.compositePass.uniforms.bloomTintColors.value=l.bloomTintColors,l.copyPass=new Ar(Cr),l.copyPass.clearAlpha=0,l.copyPass.clear=!1,l.copyPass.uniforms.opacity.value=1,l.copyPass.material.blending=THREE.CustomBlending,l.copyPass.material.blendSrc=THREE.SrcAlphaFactor,l.copyPass.material.blendDst=THREE.OneFactor,l.copyPass.material.blendEquation=THREE.AddEquation,l.copyPass.material.blendSrcAlpha=THREE.ZeroFactor,l.copyPass.material.blendDstAlpha=THREE.OneFactor,l.copyPass.material.blendEquationAlpha=THREE.AddEquation,l.copyPass.material.depthTest=!1,l.copyPass.material.depthWrite=!1,l.copyPass.material.transparent=!0,l}return s(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose();for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t);var i=Math.round(e/2),r=Math.round(t/2);this.renderTargetBright.setSize(i,r);for(var n=0;n<this.nMips;n++)this.renderTargetsHorizontal[n].setSize(i,r),this.renderTargetsVertical[n].setSize(i,r),this.separableBlurPasses[n].uniforms.texSize.value.set(i,r),i=Math.round(i/2),r=Math.round(r/2)},t.prototype.render=function(e,t,i,r,n){if(this._dirty){this._schemeBuffer.useMRT=n,this._schemeBuffer.render(e,t,i),this.highPass.uniforms.tDiffuse.value=this._schemeBuffer.getSchemeTexture(),this.highPass.uniforms.luminosityThreshold.value=this.threshold,this.highPass.render(e,this.renderTargetBright);for(var o=this.renderTargetBright,s=0;s<this.nMips;s++)this.separableBlurPasses[s].uniforms.colorTexture.value=o.texture,this.separableBlurPasses[s].uniforms.direction.value.copy(Cn),this.separableBlurPasses[s].render(e,this.renderTargetsHorizontal[s]),this.separableBlurPasses[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurPasses[s].uniforms.direction.value.copy(Sn),this.separableBlurPasses[s].render(e,this.renderTargetsVertical[s]),o=this.renderTargetsVertical[s];this.compositePass.uniforms.bloomStrength.value=this.strength,this.compositePass.uniforms.bloomRadius.value=this.radius,this.compositePass.uniforms.bloomTintColors.value=this.bloomTintColors,this.compositePass.render(e,this.renderTargetsHorizontal[0]),this._dirty=!1}this.copyPass.render(e,r,this.renderTargetsHorizontal[0])},t}(hn),Pn={uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:.5},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")},Rn={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},Dn={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},An=function(e){function t(i,r,o){n(this,t);var s=a(this,e.call(this));s.strength=1,s.blendRate=.7,s.blurSize=1,s._schemeBuffer=new bn(i,r,"lineBloom",o),s.renderTargetsHorizontal=[],s.renderTargetsVertical=[],s.nMips=6;for(var l=i,u=r,c=0;c<s.nMips;c++){var h=rn(l,u);h.texture.name="LineBloomPass.h"+c,s.renderTargetsHorizontal.push(h);var p=rn(l,u);p.texture.name="LineBloomPass.v"+c,s.renderTargetsVertical.push(p),l=Math.round(l/2),u=Math.round(u/2)}return s._downSamplePass=new Ar(kn),s._brightPass=new Ar(On),s._blurXPass=new Ar(Dn),s._blurYPass=new Ar(Rn),s._blendPass=new Ar(Pn),s._copyPass=new Ar(Cr),s._copyPass.clearAlpha=0,s._copyPass.clear=!1,s._copyPass.uniforms.opacity.value=1,s._copyPass.material.blending=THREE.CustomBlending,s._copyPass.material.blendSrc=THREE.OneFactor,s._copyPass.material.blendDst=THREE.OneFactor,s._copyPass.material.blendEquation=THREE.AddEquation,s._copyPass.material.blendSrcAlpha=THREE.ZeroFactor,s._copyPass.material.blendDstAlpha=THREE.OneFactor,s._copyPass.material.blendEquationAlpha=THREE.AddEquation,s._copyPass.material.depthTest=!1,s._copyPass.material.depthWrite=!1,s._copyPass.material.transparent=!0,s}return s(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose();for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t);for(var i=e,r=t,n=0;n<this.nMips;n++)this.renderTargetsHorizontal[n].setSize(i,r),this.renderTargetsVertical[n].setSize(i,r),i=Math.round(i/2),r=Math.round(r/2)},t.prototype.render=function(e,t,i,r,n){if(this._dirty){this._schemeBuffer.useMRT=n,this._schemeBuffer.render(e,t,i),this._downSamplePass.uniforms.tDiffuse.value=this._schemeBuffer.getSchemeTexture(),this._downSamplePass.uniforms.texSize.value.set(this.renderTargetsHorizontal[0].width,this.renderTargetsHorizontal[0].height),this._downSamplePass.render(e,this.renderTargetsHorizontal[1]),this._brightPass.render(e,this.renderTargetsVertical[1],this.renderTargetsHorizontal[1]);for(var o=2;o<this.nMips;o++)this._downSamplePass.uniforms.texSize.value.set(this.renderTargetsVertical[o-1].width,this.renderTargetsVertical[o-1].height),this._downSamplePass.render(e,this.renderTargetsVertical[o],this.renderTargetsVertical[o-1]);for(var s=0;s<this.nMips-1;s++)this._blurXPass.uniforms.h.value=2*this.blurSize/this.renderTargetsHorizontal[s].width,this._blurXPass.render(e,this.renderTargetsHorizontal[s],this.renderTargetsVertical[s+1]);for(var a=0;a<this.nMips-1;a++)this._blurYPass.uniforms.v.value=2*this.blurSize/this.renderTargetsVertical[a].height,this._blurYPass.render(e,this.renderTargetsVertical[a],this.renderTargetsHorizontal[a]);for(var l=this.nMips-2;l>=0;l--)this._blendPass.uniforms.tDiffuse1.value=this.renderTargetsVertical[l].texture,this._blendPass.uniforms.tDiffuse2.value=this.renderTargetsVertical[l+1].texture,this._blendPass.uniforms.mixRatio.value=this.blendRate,this._blendPass.uniforms.opacity.value=this.strength,this._blendPass.render(e,this.renderTargetsHorizontal[l]);this._dirty=!1}this._copyPass.render(e,r,this.renderTargetsHorizontal[0])},t}(hn),kn={uniforms:{tDiffuse:{value:null},texSize:{value:new THREE.Vector2(512,512)}},vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}\n    ",fragmentShader:"\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec2 texSize;\n\t\t\n\t\tvoid main() {\n    \t\tvec4 d = vec4(-1.0, -1.0, 1.0, 1.0) / texSize.xyxy;\n\t\t\tgl_FragColor = (texture2D(tDiffuse, vUv + d.xy) +\n\t\t\t\ttexture2D(tDiffuse, vUv + d.zy) +\n\t\t\t\ttexture2D(tDiffuse, vUv + d.xw) +\n\t\t\t\ttexture2D(tDiffuse, vUv + d.zw)) * 0.25;\n\t\t}\n\t"},On={uniforms:{tDiffuse:{value:null},scale:{value:4}},vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}\n    ",fragmentShader:"\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float scale;\n\t\t\n\t\tvoid main() {\n\t\t\tgl_FragColor = texture2D(tDiffuse, vUv) * scale;\n\t\t}\n\t"},Bn={uniforms:{scene:{value:null},texSize:{value:new THREE.Vector2(1,1)},Stride:{value:10}},vertexShader:"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t}\n    ",fragmentShader:"\n\t#define WT9_0 1.0\n\t#define WT9_1 0.8\n\t#define WT9_2 0.6\n\t#define WT9_3 0.4\n\t#define WT9_4 0.2\n\t#define WT9_NORMALIZE 5.2\n\tvarying vec2 vUv;\n\tuniform sampler2D scene;\n\tuniform vec2 texSize;\n\tuniform float Stride;\n\tvoid main() {\n\t\tfloat TexelIncrement =0.25 * Stride /texSize.x;\n\n\t\tfloat colour = texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement =0.5 * Stride /texSize.x;\n\t\tcolour += texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement =0.75 * Stride /texSize.x;\n\t\tcolour += texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement =Stride /texSize.x;\n\t\tcolour += texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tfloat col = 1.0-colour*0.25;\n\n\t\tgl_FragColor = vec4(col,col,col,col);\n\t}\n    "},Fn={uniforms:{blurX:{value:null},scene:{value:null},texSize:{value:new THREE.Vector2(1,1)},Stride:{value:10},Glowness:{value:2},GlowColor:{value:new THREE.Vector4(1,0,0,1)}},vertexShader:"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t}\n\t",fragmentShader:"\n\t#define WT9_0 1.0\n\t#define WT9_1 0.8\n\t#define WT9_2 0.6\n\t#define WT9_3 0.4\n\t#define WT9_4 0.2\n\t#define WT9_NORMALIZE 5.2\n\tvarying vec2 vUv;\n\tuniform vec2 texSize;\n\tuniform float Stride;\n\tuniform float Glowness;\n\tuniform vec4 GlowColor;\n\tuniform sampler2D blurX;\n\tuniform sampler2D scene;\n\tvoid main() {\n\n\t\tfloat TexelIncrement = 0.25 * Stride / texSize.y;\n\n\t\tfloat colour = texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement = 0.5 * Stride / texSize.y;\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement = 0.75 * Stride / texSize.y;\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement = Stride / texSize.y;\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tvec4 glo = (0.25 * Glowness * colour) * GlowColor;\n\t\tvec4 OldCol = texture2D(scene, vec2(vUv.x , vUv.y));\n\t\t\n\t\tgl_FragColor = vec4(OldCol.x*glo.xyz,1);\n\t}\n\t"},Ln=Fr(1,1,1),In=new Map;var Nn=0,Un=function(e){function t(i,r,o,s){n(this,t);var l=a(this,e.call(this,i,r,$r(o)+"Scheme_"+ ++Nn,s));return l.marker=o,l}return s(t,e),t.prototype._initStrategy=function(e){var t=this;e.materialManager.addStrategy(this.name,(function(e,i,r,n,o,s){if(Hr(this,o))return null;var a=zr(this.technique,t.marker);if("skip"===a)return null;var l=void 0,u=!1;if(a)l=a.isMaterial?a:function(e,t){var i=e.isInstancedMesh+"_"+t.skinning,r=void 0;return In.has(i)?r=In.get(i):((r=new THREE.ShaderMaterial(Ln)).skinning=t.skinning,In.set(i,r)),r}(this,o),u=!0;else{if(t.depthShared)return null;l=Nr(this,o)}return Ur(l,o,u),l}))},t}(gn),zn=function(e){function t(i,r,o){n(this,t);var s=a(this,e.call(this));return s.color=new THREE.Vector4(1,0,0,1),s.strength=2,s.stride=10,s._schemeBuffer=new Un(i,r,"innerGlow",o),s.tempRenderTarget=rn(i,r),s.tempRenderTarget.texture.name="InnerGlowPass.temp",s.resultRenderTarget=rn(i,r),s.resultRenderTarget.texture.name="InnerGlowPass.result",s._blurXPass=new Ar(Bn),s._blurXPass.uniforms.texSize.value.set(i,r),s._blurYPass=new Ar(Fn),s._blurYPass.uniforms.texSize.value.set(i,r),s._copyPass=new Ar(Cr),s._copyPass.clear=!1,s._copyPass.uniforms.opacity.value=1,s._copyPass.uniforms.tDiffuse.value=s.resultRenderTarget.texture,s._copyPass.material.blending=THREE.CustomBlending,s._copyPass.material.blendSrc=THREE.SrcAlphaFactor,s._copyPass.material.blendDst=THREE.OneFactor,s._copyPass.material.blendEquation=THREE.AddEquation,s._copyPass.material.blendSrcAlpha=THREE.ZeroFactor,s._copyPass.material.blendDstAlpha=THREE.OneFactor,s._copyPass.material.blendEquationAlpha=THREE.AddEquation,s._copyPass.material.depthTest=!1,s._copyPass.material.depthWrite=!1,s._copyPass.material.transparent=!0,s}return s(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose(),this.tempRenderTarget.dispose(),this.resultRenderTarget.dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t),this.tempRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t),this._blurXPass.uniforms.texSize.value.set(e,t),this._blurYPass.uniforms.texSize.value.set(e,t)},t.prototype.render=function(e,t,i,r,n){this._dirty&&(this._schemeBuffer.useMRT=n,this._schemeBuffer.render(e,t,i),this._blurXPass.uniforms.scene.value=this._schemeBuffer.getSchemeTexture(),this._blurXPass.uniforms.Stride.value=this.stride,this._blurXPass.render(e,this.tempRenderTarget),this._blurYPass.uniforms.blurX.value=this.tempRenderTarget.texture,this._blurYPass.uniforms.scene.value=this._schemeBuffer.getSchemeTexture(),this._blurYPass.uniforms.Stride.value=this.stride,this._blurYPass.uniforms.Glowness.value=this.strength,this._blurYPass.uniforms.GlowColor.value.copy(this.color),this._blurYPass.render(e,this.resultRenderTarget),this._dirty=!1),this._copyPass.render(e,void 0!==r?r:null)},t}(hn),Hn=function(e){function t(i,r,o){n(this,t);var s=a(this,e.call(this));return s._schemeBuffer=new yn(i,r,"radialBlur",o),s.resultRenderTarget=rn(i,r),s.resultRenderTarget.texture.name="RadialBlurPass.result",s._blurPass=new Ar(Vn),s._copyPass=new Ar(Cr),s._copyPass.clear=!1,s._copyPass.uniforms.opacity.value=1,s._copyPass.uniforms.tDiffuse.value=s.resultRenderTarget.texture,s._copyPass.material.blending=THREE.CustomBlending,s._copyPass.material.blendSrc=THREE.OneFactor,s._copyPass.material.blendDst=THREE.OneFactor,s._copyPass.material.blendEquation=THREE.AddEquation,s._copyPass.material.blendSrcAlpha=THREE.ZeroFactor,s._copyPass.material.blendDstAlpha=THREE.OneFactor,s._copyPass.material.blendEquationAlpha=THREE.AddEquation,s._copyPass.material.depthTest=!1,s._copyPass.material.depthWrite=!1,s._copyPass.material.transparent=!0,s}return s(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose(),this.resultRenderTarget.dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t),this.resultRenderTarget.setSize(e,t)},t.prototype.render=function(e,t,i,r,n){this._dirty&&(this._schemeBuffer.useMRT=n,this._schemeBuffer.render(e,t,i),this._blurPass.uniforms.blurMap.value=this._schemeBuffer.getSchemeTexture(),this._blurPass.render(e,this.resultRenderTarget),this._dirty=!1),this._copyPass.render(e,void 0!==r?r:null)},t}(hn),Vn={uniforms:{blurMap:{value:null},BlurStart:{value:1},BlurWidth:{value:-.1},direction:{value:new THREE.Vector2(0,1)},Intensity:{value:10},GlowGamma:{value:.8},CX:{value:.5},CY:{value:.5}},vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}\n    ",fragmentShader:"\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D blurMap;\n\t\tuniform float BlurStart;\n\t\tuniform float BlurWidth;\n\t\tuniform vec2 direction;\n\t\tuniform float Intensity;\n\t\tuniform float GlowGamma;\n\t\tuniform float CX;\n\t\tuniform float CY;\n\n\t\tvoid main() {\n\t\t\tvec2 texCoord = vUv;\n\t\t\tvec2 ctrPt = vec2(CX,CY);\n\t\t\tvec4 blurred = texture2D(blurMap, texCoord);\n\t\t\tvec2 resCoord = vec2(0.0);\n\t\t\tfor(float i=0.0; i<31.0; i++) {\n\t\t\t\tfloat scale = BlurStart + BlurWidth*((31.0-i)/(31.0-1.0));\n\t\t\t\tvec2 tmp = texCoord*scale;\n\t\t\t\tresCoord = mix(texCoord, tmp, direction);\n\t\t\t\tvec4 tmpc = texture2D(blurMap, resCoord )*(i/31.0)*(i/31.0);\n\t\t\t\tblurred += tmpc/31.0;\n\t\t\t}\n\n\t\t\tblurred.r = pow(blurred.r,GlowGamma);\n\t\t\tblurred.g = pow(blurred.g,GlowGamma);\n\t\t\tblurred.b = pow(blurred.b,GlowGamma);\n\t\t\tblurred.rgb *= Intensity;\n\t\t\tblurred.rgb = clamp(blurred.rgb, 0.0, 1.0);\n\n\t\t\tvec4 origTex = texture2D(blurMap, texCoord  );\n\t\t\tvec4 blurResult=origTex+blurred;\n\t\t\t//blurResult *= 2;\n\n\t\t\tvec2 dir=texCoord - ctrPt;\n\t\t\tfloat dist = sqrt( dir.x*dir.x + dir.y*dir.y );\n\t\t\tfloat t = dist * 1.0;\n\t\t\tt =  clamp(t, 0.0, 1.0);//We need 0 <= t <= 1\n\n\t\t\tgl_FragColor = blurResult*t;\n\t\t}\n\t"},Wn=function(e){function t(i,r,o){n(this,t);var s=a(this,e.call(this));return s._schemeBuffer=new yn(i,r,"radialBlur2",o),s.resultRenderTarget=rn(i,r),s.resultRenderTarget.texture.name="RadialBlur2Pass.result",s._blurPass=new Ar(Gn),s._copyPass=new Ar(Cr),s._copyPass.clear=!1,s._copyPass.uniforms.opacity.value=1,s._copyPass.uniforms.tDiffuse.value=s.resultRenderTarget.texture,s._copyPass.material.blending=THREE.CustomBlending,s._copyPass.material.blendSrc=THREE.OneFactor,s._copyPass.material.blendDst=THREE.OneFactor,s._copyPass.material.blendEquation=THREE.AddEquation,s._copyPass.material.blendSrcAlpha=THREE.ZeroFactor,s._copyPass.material.blendDstAlpha=THREE.OneFactor,s._copyPass.material.blendEquationAlpha=THREE.AddEquation,s._copyPass.material.depthTest=!1,s._copyPass.material.depthWrite=!1,s._copyPass.material.transparent=!0,s}return s(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose(),this.resultRenderTarget.dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t),this.resultRenderTarget.setSize(e,t)},t.prototype.render=function(e,t,i,r,n){this._dirty&&(this._schemeBuffer.useMRT=n,this._schemeBuffer.render(e,t,i),this._blurPass.uniforms.blurMap.value=this._schemeBuffer.getSchemeTexture(),this._blurPass.render(e,this.resultRenderTarget),this._dirty=!1),this._copyPass.render(e,void 0!==r?r:null)},t}(hn),Gn={uniforms:{blurMap:{value:null},BlurStart:{value:1},BlurWidth:{value:-.1},Intensity:{value:10},GlowGamma:{value:.8},CX:{value:.5},CY:{value:.5}},vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}\n    ",fragmentShader:"\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D blurMap;\n\t\tuniform float BlurStart;\n\t\tuniform float BlurWidth;\n\t\tuniform float CX;\n\t\tuniform float CY;\n\t\tuniform float Intensity;\n\t\tuniform float GlowGamma;\n\t\t\n\t\tvoid main() {\n\t\t\tvec2 texCoord = vUv;\n\t\t\tvec2 ctrPt = vec2(CX,CY);\n\t\t\tvec4 blurred = texture2D(blurMap, texCoord );\n\t\t\n\t\t\tfor(float i=0.0; i<31.0; i++) {\n\t\t\t\tfloat scale = BlurStart + BlurWidth*((31.0-i)/(31.0-1.0));\n\t\t\t\tvec2 tmp = (texCoord - ctrPt)*scale + ctrPt;\n\t\t\t\tvec4 tmpc = texture2D(blurMap, tmp )*(i/31.0)*(i/31.0);\n\t\t\n\t\t\t\tblurred += tmpc/31.0;\n\t\t\n\t\t\t}\n\t\t\n\t\t\tblurred.r = pow(blurred.r,GlowGamma);\n\t\t\tblurred.g = pow(blurred.g,GlowGamma);\n\t\t\tblurred.b = pow(blurred.b,GlowGamma);\n\t\t\tblurred.rgb *= Intensity;\n\t\t\tblurred.rgb = clamp(blurred.rgb, 0.0, 1.0);\n\t\t\n\t\t\tvec4 origTex = texture2D(blurMap, texCoord  );\n\t\t\tvec4 blurResult=origTex+blurred;\n\t\t\t//blurResult *= 2;\n\t\t\n\t\t\tvec2 dir=texCoord - ctrPt;\n\t\t\tfloat dist = sqrt( dir.x*dir.x + dir.y*dir.y );\n\t\t\tfloat t = dist * 1.0;\n\t\t\tt =  clamp(t, 0.0, 1.0);//We need 0 <= t <= 1\n\t\t\n\t\t\tgl_FragColor = blurResult*t;\n\t\t}\n\t"},qn=function(e){function t(i,r,o){n(this,t);var s=a(this,e.call(this));return s._schemeBuffer=new yn(i,r,"radialOffset",o),s.resultRenderTarget=rn(i,r),s.resultRenderTarget.texture.name="RadialOffsetPass.result",s._blurPass=new Ar(Xn),s._copyPass=new Ar(Cr),s._copyPass.clear=!1,s._copyPass.uniforms.opacity.value=1,s._copyPass.uniforms.tDiffuse.value=s.resultRenderTarget.texture,s._copyPass.material.blending=THREE.CustomBlending,s._copyPass.material.blendSrc=THREE.OneFactor,s._copyPass.material.blendDst=THREE.OneFactor,s._copyPass.material.blendEquation=THREE.AddEquation,s._copyPass.material.blendSrcAlpha=THREE.ZeroFactor,s._copyPass.material.blendDstAlpha=THREE.OneFactor,s._copyPass.material.blendEquationAlpha=THREE.AddEquation,s._copyPass.material.depthTest=!1,s._copyPass.material.depthWrite=!1,s._copyPass.material.transparent=!0,s}return s(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose(),this.resultRenderTarget.dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t),this.resultRenderTarget.setSize(e,t)},t.prototype.render=function(e,t,i,r,n){this._dirty&&(this._schemeBuffer.useMRT=n,this._schemeBuffer.render(e,t,i),this._blurPass.uniforms.tex0.value=this._schemeBuffer.getSchemeTexture(),this._blurPass.render(e,this.resultRenderTarget),this._dirty=!1),this._copyPass.render(e,void 0!==r?r:null)},t}(hn),Xn={uniforms:{tex0:{value:null},BlurStart:{value:1},BlurWidth:{value:-.1},Intensity:{value:3},GlowGamma:{value:1},CX:{value:.5},CY:{value:.5}},vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}\n    ",fragmentShader:"\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D tex0;\n\t\tuniform float BlurStart;\n\t\tuniform float BlurWidth;\n\t\tuniform float CX;\n\t\tuniform float CY;\n\t\tuniform float Intensity;\n\t\tuniform float GlowGamma;\n\t\t\n\t\t\n\t\tvoid main() {\n\t\t\tvec2 uv = vUv;\n\t\t\tvec2 ctrPt = vec2(CX, CY);\n\t\t\n\t\t\tfloat scale = BlurStart + BlurWidth * 1.0;\n\t\t\tvec2 tmp = (uv - ctrPt) * scale + ctrPt;\n\n\t\t\tvec4 blurred = texture2D(tex0, tmp);\n\t\t\tblurred.rgb = pow(blurred.rgb, vec3(GlowGamma));\n\t\t\tblurred.rgb *= Intensity;\n\t\t\tblurred.rgb = clamp(blurred.rgb, 0.0, 1.0);\n\t\t\t\n\t\t\tvec2 dir = uv - ctrPt;\n\t\t\tfloat dist = sqrt(dir.x * dir.x + dir.y * dir.y);\n\t\t\n\t\t\tgl_FragColor = blurred * clamp(dist, 0.0, 1.0);\n\t\t}\n\t"},Jn={uniforms:{colorMap:{value:null},maskMap:{value:null},darkFactor:{value:.5},brightFactor:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D colorMap;","uniform sampler2D maskMap;","uniform float darkFactor;","uniform float brightFactor;","varying vec2 vUv;","void main() {","float mask = texture2D( maskMap, vUv ).a;","vec4 color = texture2D( colorMap, vUv );","color.rgb = color.rgb * (1.0 - mask) * darkFactor + color.rgb * mask * brightFactor;","gl_FragColor = color;","}"].join("\n")},Yn=Fr(1,1,1),Zn=new Map;var Qn=0,Kn=function(e){function t(i,r,o,s){n(this,t);var l=a(this,e.call(this,i,r,$r(o)+"Scheme_"+ ++Qn,s));return l.marker=o,l}return s(t,e),t.prototype.shareDepthTexture=function(e){},t.prototype.shareDepthRenderBuffer=function(e,t){},t.prototype.clearDepthShare=function(){},t.prototype._initStrategy=function(e){var t=this;e.materialManager.addStrategy(this.name,(function(e,i,r,n,o,s){if(Hr(this,o))return null;var a=zr(this.technique,t.marker);if("skip"===a)return null;var l=void 0;return a?(Ur(l=a.isMaterial?a:function(e,t){var i=e.isInstancedMesh+"_"+t.skinning,r=void 0;return Zn.has(i)?r=Zn.get(i):((r=new THREE.ShaderMaterial(Yn)).skinning=t.skinning,Zn.set(i,r)),r}(this,o),o,!0),l):null}))},t}(gn),$n=function(e){function t(i,r,o){n(this,t);var s=a(this,e.call(this));return s.darkFactor=.5,s.brightFactor=1,s._schemeBuffer=new Kn(i,r,"focusRegion",o),s.resultRenderTarget=rn(i,r),s.resultRenderTarget.texture.name="FocusRegionPass.result",s._blendPass=new Ar(Jn),s._copyPass=new Ar(Cr),s._copyPass.uniforms.opacity.value=1,s._copyPass.uniforms.tDiffuse.value=s.resultRenderTarget.texture,s}return s(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose(),this.resultRenderTarget.dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t),this.resultRenderTarget.setSize(e,t)},t.prototype.render=function(e,t,i,r,n){this._dirty&&(this._schemeBuffer.useMRT=n,this._schemeBuffer.render(e,t,i),this._dirty=!1),this._blendPass.uniforms.colorMap.value=r.texture,this._blendPass.uniforms.maskMap.value=this._schemeBuffer.getSchemeTexture(),this._blendPass.uniforms.darkFactor.value=this.darkFactor,this._blendPass.uniforms.brightFactor.value=this.brightFactor,this._blendPass.render(e,this.resultRenderTarget),this._copyPass.render(e,r)},t}(hn),eo=Fr(0,1,1),to=new Map;var io=function(e){function t(i,r,o){n(this,t);var s=a(this,e.call(this,i,r,"OutlineScheme_"+o));return s._edgeColorString=o,s.enableLayer1=!0,s}return s(t,e),t.prototype._initStrategy=function(e){var t=this;e.materialManager.addStrategy(this.name,(function(e,i,r,n,o,s){if(!this.userData.forceOutline&&!r.layers.test(this.layers))return null;var a="outline_0x"+t._edgeColorString,l=zr(this.technique,a);return l&&"skip"!==l?this.technique[a].isMaterial?this.technique[a]:function(e,t){var i=e.isInstancedMesh+"_"+t.skinning,r=void 0;return to.has(i)?r=to.get(i):((r=new THREE.ShaderMaterial(eo)).side=THREE.DoubleSide,r.skinning=t.skinning,to.set(i,r)),r}(this,o):null}))},t}(gn),ro={uniforms:{maskTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},edgeColor:{value:new THREE.Color(1,1,1)}},fragmentShader:"\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D maskTexture;\n\t\tuniform vec2 texSize;\n\t\tuniform vec3 edgeColor;\n\t\t\n\t\tvoid main() {\n\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\n\t\t\tvec4 c1 = texture2D(maskTexture, vUv + uvOffset.xy);\n\t\t\tvec4 c2 = texture2D(maskTexture, vUv - uvOffset.xy);\n\t\t\tvec4 c3 = texture2D(maskTexture, vUv + uvOffset.yw);\n\t\t\tvec4 c4 = texture2D(maskTexture, vUv - uvOffset.yw);\n\t\t\tfloat b1 = max(c1.b, c2.b);\n\t\t\tfloat b2 = max(c3.b, c4.b);\n\t\t\tfloat a = max(b1, b2);\n\t\t\tgl_FragColor = vec4(edgeColor, a);\n\t\t}\n\t"},no={defines:{MAX_RADIUS:4},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)},kernelRadius:{value:1}},fragmentShader:"\n\t\t#include <common>\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D colorTexture;\n\t\tuniform vec2 texSize;\n\t\tuniform vec2 direction;\n\t\tuniform float kernelRadius;\n\t\t\n\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\treturn 0.39894 * exp(-0.5 * x * x / (sigma * sigma)) / sigma;\n\t\t}\n\t\tvoid main() {\n\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\n\t\t\tvec4 diffuseColor = texture2D(colorTexture, vUv);\n\t\t\tvec4 diffuseSum = diffuseColor * weightSum;\n\t\t\tvec2 delta = direction * invSize * kernelRadius / float(MAX_RADIUS);\n\t\t\tvec2 uvOffset = delta;\n\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\n\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\n\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\n\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\n\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\n\t\t\t\tweightSum += (2.0 * w);\n\t\t\t\tuvOffset += delta;\n\t\t\t}\n\t\t\tvec4 color = diffuseSum / weightSum;\n\t\t\tgl_FragColor = color;\n\t\t}\n\t"},oo={uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},edgeStrength:{value:1},edgeGlow:{value:1}},fragmentShader:"\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D maskTexture;\n\t\tuniform sampler2D edgeTexture1;\n\t\tuniform sampler2D edgeTexture2;\n\t\tuniform float edgeStrength;\n\t\tuniform float edgeGlow;\n\t\t\n\t\tvoid main() {\n\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\n\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\n\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\n\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\n\t\t\tvec4 finalColor = edgeStrength * edgeValue;\n\t\t\tfloat a = finalColor.a * (1.0 - maskColor.b);\n\t\t\tgl_FragColor = vec4(finalColor.rgb, a);\n\t\t}\n\t"},so=function(e){function t(i,r,o){n(this,t);var s=a(this,e.call(this));s.edgeColor=(new THREE.Color).setHex(void 0!==o?o:16777215),s.edgeGlow=0,s.edgeThickness=1,s.edgeStrength=1.5,s.downSampleRatio=2,s._schemeBuffer=new io(i,r,s.edgeColor.getHexString());var l=Math.round(i/s.downSampleRatio),u=Math.round(r/s.downSampleRatio);return s.renderTargetMaskDownSampleBuffer=rn(l,u),s.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",s.renderTargetBlurBuffer1=rn(l,u),s.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",s.renderTargetBlurBuffer2=rn(Math.round(l/2),Math.round(u/2)),s.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",s.renderTargetEdgeBuffer1=rn(l,u),s.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",s.renderTargetEdgeBuffer2=rn(Math.round(l/2),Math.round(u/2)),s.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",s._copyPass=new Ar(Cr),s._copyPass.clearAlpha=0,s._copyPass.uniforms.opacity.value=1,s._copyPass.material.blending=THREE.NoBlending,s._copyPass.material.depthTest=!1,s._copyPass.material.depthWrite=!1,s._copyPass.material.transparent=!0,s._edgeDetectionPass=new Ar(ro),s._edgeDetectionPass.clearAlpha=0,s._edgeDetectionPass.textureID="maskTexture",s._blur1Pass=new Ar(no),s._blur1Pass.clearAlpha=0,s._blur1Pass.textureID="colorTexture",s._blur1Pass.uniforms.texSize.value.set(l,u),s._blur1Pass.material.defines.MAX_RADIUS=4,s._blur1Pass.uniforms.kernelRadius.value=1,s._blur2Pass=new Ar(no),s._blur2Pass.clearAlpha=0,s._blur2Pass.textureID="colorTexture",s._blur2Pass.uniforms.texSize.value.set(Math.round(l/2),Math.round(u/2)),s._blur2Pass.material.defines.MAX_RADIUS=4,s._blur2Pass.uniforms.kernelRadius.value=4,s._overlayPass=new Ar(oo),s._overlayPass.clear=!1,s._overlayPass.material.blending=THREE.NormalBlending,s._overlayPass.material.depthTest=!1,s._overlayPass.material.depthWrite=!1,s._overlayPass.material.transparent=!0,s._overlayPass.uniforms.edgeTexture1.value=s.renderTargetEdgeBuffer1.texture,s._overlayPass.uniforms.edgeTexture2.value=s.renderTargetEdgeBuffer2.texture,s}return s(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t);var i=Math.round(e/this.downSampleRatio),r=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(i,r),this.renderTargetBlurBuffer1.setSize(i,r),this.renderTargetEdgeBuffer1.setSize(i,r),this._blur1Pass.uniforms.texSize.value.set(i,r),i=Math.round(i/2),r=Math.round(r/2),this.renderTargetBlurBuffer2.setSize(i,r),this.renderTargetEdgeBuffer2.setSize(i,r),this._blur2Pass.uniforms.texSize.value.set(i,r)},t.prototype.render=function(e,t,i,r,n){this._dirty&&(this._schemeBuffer.useMRT=n,this._schemeBuffer.render(e,t,i),this._copyPass.uniforms.tDiffuse.value=this._schemeBuffer.getSchemeTexture(),this._copyPass.render(e,this.renderTargetMaskDownSampleBuffer),this._edgeDetectionPass.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this._edgeDetectionPass.uniforms.edgeColor.value.copy(this.edgeColor),this._edgeDetectionPass.render(e,this.renderTargetEdgeBuffer1,this.renderTargetMaskDownSampleBuffer),this._blur1Pass.uniforms.kernelRadius.value=this.edgeThickness,this._blur1Pass.uniforms.direction.value.set(1,0),this._blur1Pass.render(e,this.renderTargetBlurBuffer1,this.renderTargetEdgeBuffer1),this._blur1Pass.uniforms.direction.value.set(0,1),this._blur1Pass.render(e,this.renderTargetEdgeBuffer1,this.renderTargetBlurBuffer1),this.edgeGlow>0&&(this._blur2Pass.uniforms.direction.value.set(1,0),this._blur2Pass.render(e,this.renderTargetBlurBuffer2,this.renderTargetEdgeBuffer1),this._blur2Pass.uniforms.direction.value.set(0,1),this._blur2Pass.render(e,this.renderTargetEdgeBuffer2,this.renderTargetBlurBuffer2)),this._overlayPass.uniforms.maskTexture.value=this._schemeBuffer.getSchemeTexture(),this._overlayPass.uniforms.edgeStrength.value=this.edgeStrength,this._overlayPass.uniforms.edgeGlow.value=this.edgeGlow,this._dirty=!1),this._overlayPass.render(e,void 0!==r?r:null)},t.prototype.dirty=function(){this._dirty=!0},t}(hn),ao=function(e,t){for(var i=0,r=1/t,n=e;n>0;)i+=r*(n%t),n=Math.floor(n/t),r/=t;return i};function lo(e,t,i){this._samplingSize=i||30;for(var r=[],n=0;n<this._samplingSize;n++)r.push([ao(n,2),ao(n,3)]);this._haltonSequence=r,this._prevFrame=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._output=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._frame=0,this.quadCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.quadScene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(Pn.uniforms),vertexShader:Pn.vertexShader,fragmentShader:Pn.fragmentShader,depthTest:!1,depthWrite:!1})),this.quadScene.add(this.quadCamera),this.quadScene.add(this.quad)}lo.prototype=Object.assign(lo.prototype,{constructor:lo,setSize:function(e,t){this._prevFrame.setSize(e,t),this._output.setSize(e,t)},setSamplingSize:function(e){this._samplingSize=e||30;for(var t=[],i=0;i<this._samplingSize;i++)t.push([ao(i,2),ao(i,3)]);this._haltonSequence=t,this._frame=0},getSamplingSize:function(){return this._samplingSize},start:function(){this._frame=0},finished:function(){return this._frame>=this._samplingSize},frame:function(){return this._frame},jitterProjection:function(e,t,i){var r=this._haltonSequence[this._frame];r||console.error("THREE.SuperSampler: try to jitter camera after finished!",this._frame,this._haltonSequence.length),e.setViewOffset&&e.setViewOffset(t,i,.5*(2*r[0]-1),.5*(2*r[1]-1),t,i)},sample:function(e,t){var i=0===this._frame;this.quad.material.uniforms.tDiffuse1.value=t,this.quad.material.uniforms.tDiffuse2.value=this._prevFrame.texture,this.quad.material.uniforms.mixRatio.value=i?0:.9,this.quad.material.uniforms.opacity.value=1;var r=e.getClearColor().getHex(),n=e.getClearAlpha();e.setClearColor(0,0),e.setRenderTarget(this._output),e.clear(),e.render(this.quadScene,this.quadCamera),e.setClearColor(r,n);var o=this._prevFrame;return this._prevFrame=this._output,this._output=o,this._frame++,this._prevFrame},output:function(){return this._prevFrame},dispose:function(){this._prevFrame.dispose(),this._output.dispose(),this.quadScene.remove(this.quadCamera),this.quadScene.remove(this.quad),this.quad.material.dispose()}});var uo={temporalSuperSampling:{enable:!1,size:30},postEffect:{enable:!0,bloom:{enable:!1,strength:.14,radius:.4,threshold:.7},screenSpaceAmbientOcclusion:{enable:!1,radius:.2,quality:"medium",intensity:.8,temporalFilter:!0,ignoreTransparent:!1},screenSpaceReflection:{enable:!1,maxRayDistance:200,pixelStride:16,pixelStrideZCutoff:50,screenEdgeFadeStart:.9,eyeFadeStart:.4,eyeFadeEnd:.8,minGlossiness:.2,temporalFilter:!0},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1.1,saturation:1.1,gamma:1},dof:{enable:!1,focalDepth:1,focalLength:24,fstop:.9,maxblur:1,threshold:.9,gain:1,bias:.5,dithering:1e-4},vignette:{enable:!1,type:"color",color:0,offset:1},film:{enable:!1,grayscale:!0,noiseIntensity:.35,scanlinesIntensity:.5,scanlinesCount:2048},chromaticAberration:{enable:!1,chromaFactor:.025},blur:{enable:!1,bounds:[[0,0,1,1]],radius:5},FXAA:{enable:!1},MSAA:{enable:!0}}},co=function(){function e(){n(this,e),this.needSwapBuffer=!0}return e.prototype.setSize=function(e,t){},e.prototype.render=function(e,t,i,r,n){console.error("Effect: .render() must be implemented in derived pass.")},e.prototype.dispose=function(){},e}(),ho=function(e){function t(i,r,o){n(this,t);var s=a(this,e.call(this));return s._pass=i,void 0!==r&&void 0!==o&&s.setSize(r,o),s}return s(t,e),t.prototype.setSize=function(e,t){this._pass.setSize(e,t)},t.prototype.render=function(e,t,i,r,n){this._pass.render(e,t,i,r,n)},t.prototype.dispose=function(){this._pass.material.dispose()},t}(co),po=new THREE.Vector2(1,0),fo=new THREE.Vector2(0,1),mo=function(e){function t(i,r){n(this,t);var o=a(this,e.call(this));o.needSwapBuffer=!1,o.strength=.14,o.radius=.4,o.threshold=.6,o.renderTargetsHorizontal=[],o.renderTargetsVertical=[],o.nMips=5;var s=0,l=Math.round(i/2),u=Math.round(r/2);for(o.renderTargetBright=rn(l,u),o.renderTargetBright.texture.name="BloomEffect.bright",s=0;s<o.nMips;s++){var c=rn(l,u);c.texture.name="BloomEffect.h"+s,o.renderTargetsHorizontal.push(c);var h=rn(l,u);h.texture.name="BloomEffect.v"+s,o.renderTargetsVertical.push(h),l=Math.round(l/2),u=Math.round(u/2)}o.highPass=new Ar(wn),o.highPass.clearAlpha=0,o.highPass.uniforms.luminosityThreshold.value=o.threshold,o.highPass.uniforms.smoothWidth.value=.01,o.separableBlurPasses=[];var p=[3,5,7,9,11];for(l=Math.round(i/2),u=Math.round(r/2),s=0;s<o.nMips;s++){var d=new Ar(Tn);d.clearAlpha=0,d.material.defines.KERNEL_RADIUS=p[s],d.material.defines.SIGMA=p[s],d.uniforms.texSize.value.set(l,u),o.separableBlurPasses.push(d),l=Math.round(l/2),u=Math.round(u/2)}o.compositePass=new Ar(Mn),o.compositePass.clearAlpha=0,o.compositePass.material.defines.NUM_MIPS=5,o.compositePass.uniforms.blurTexture1.value=o.renderTargetsVertical[0].texture,o.compositePass.uniforms.blurTexture2.value=o.renderTargetsVertical[1].texture,o.compositePass.uniforms.blurTexture3.value=o.renderTargetsVertical[2].texture,o.compositePass.uniforms.blurTexture4.value=o.renderTargetsVertical[3].texture,o.compositePass.uniforms.blurTexture5.value=o.renderTargetsVertical[4].texture,o.compositePass.uniforms.bloomStrength.value=o.strength,o.compositePass.uniforms.bloomRadius.value=.1;return o.compositePass.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],o.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],o.compositePass.uniforms.bloomTintColors.value=o.bloomTintColors,o.copyPass=new Ar(Cr),o.copyPass.clear=!1,o.copyPass.uniforms.opacity.value=1,o.copyPass.material.blending=THREE.CustomBlending,o.copyPass.material.blendSrc=THREE.SrcAlphaFactor,o.copyPass.material.blendDst=THREE.OneFactor,o.copyPass.material.blendEquation=THREE.AddEquation,o.copyPass.material.blendSrcAlpha=THREE.ZeroFactor,o.copyPass.material.blendDstAlpha=THREE.OneFactor,o.copyPass.material.blendEquationAlpha=THREE.AddEquation,o.copyPass.material.depthTest=!1,o.copyPass.material.depthWrite=!1,o.copyPass.material.transparent=!0,o}return s(t,e),t.prototype.setSize=function(e,t){var i=Math.round(e/2),r=Math.round(t/2);this.renderTargetBright.setSize(i,r);for(var n=0;n<this.nMips;n++)this.renderTargetsHorizontal[n].setSize(i,r),this.renderTargetsVertical[n].setSize(i,r),this.separableBlurPasses[n].uniforms.texSize.value.set(i,r),i=Math.round(i/2),r=Math.round(r/2)},t.prototype.render=function(e,t,i,r,n){this.highPass.uniforms.luminosityThreshold.value=this.threshold,this.highPass.render(e,this.renderTargetBright,i);for(var o=this.renderTargetBright,s=0;s<this.nMips;s++)this.separableBlurPasses[s].uniforms.colorTexture.value=o.texture,this.separableBlurPasses[s].uniforms.direction.value.copy(po),this.separableBlurPasses[s].render(e,this.renderTargetsHorizontal[s]),this.separableBlurPasses[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurPasses[s].uniforms.direction.value.copy(fo),this.separableBlurPasses[s].render(e,this.renderTargetsVertical[s]),o=this.renderTargetsVertical[s];this.compositePass.uniforms.bloomStrength.value=this.strength,this.compositePass.uniforms.bloomRadius.value=this.radius,this.compositePass.uniforms.bloomTintColors.value=this.bloomTintColors,this.compositePass.render(e,this.renderTargetsHorizontal[0]),this.copyPass.render(e,i,this.renderTargetsHorizontal[0])},t.prototype.dispose=function(){this.renderTargetBright.dispose(),this.renderTargetsHorizontal.forEach((function(e){return e.dispose()})),this.renderTargetsVertical.forEach((function(e){return e.dispose()}))},t}(co),go={defines:{USE_VIGNETTE_TEXTURE:!1},uniforms:{tDiffuse:{value:null},vignetteOffset:{value:1},vignetteColor:{value:new THREE.Color(0)},vignetteTexture:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n\t    uniform sampler2D tDiffuse;\n\n\t\tuniform float vignetteOffset;\n        uniform vec3 vignetteColor;\n        \n        #ifdef USE_VIGNETTE_TEXTURE\n            uniform sampler2D vignetteTexture;\n        #endif\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 color = texture2D(tDiffuse, vUv);\n            vec2 uv = (vUv - vec2(0.5)) * vec2(vignetteOffset);\n            \n            vec3 color2 = vignetteColor;\n\n            #ifdef USE_VIGNETTE_TEXTURE\n                color2 *= texture2D(vignetteTexture, vUv).rgb;\n            #endif\n\n\t\t\tcolor.rgb = mix(color.rgb, color2, clamp(dot(uv, uv), 0.0, 1.0));\n\t\t\tgl_FragColor = color;\n\n\t\t}\n    "},vo=function(e){function t(i,r){n(this,t);var o=a(this,e.call(this));return o.type="color",o.color=new THREE.Color(0),o.offset=1,o.tempRenderTarget=rn(i/2,r/2),o.tempRenderTarget2=rn(i/2,r/2),o.effectHBlur=new Ar(Dn),o.effectVBlur=new Ar(Rn),o.effectHBlur.uniforms.h.value=4/i,o.effectVBlur.uniforms.v.value=4/r,o.blendPass=new Ar(go),o}return s(t,e),t.prototype.setSize=function(e,t){this.tempRenderTarget.setSize(e/2,t/2),this.tempRenderTarget2.setSize(e/2,t/2),this.effectHBlur.uniforms.h.value=4/e,this.effectVBlur.uniforms.v.value=4/t},t.prototype.render=function(e,t,i,r,n){"color"===this.type?(this.blendPass.uniforms.vignetteOffset.value=this.offset,this.blendPass.uniforms.vignetteColor.value.copy(this.color),this.blendPass.material.defines.USE_VIGNETTE_TEXTURE&&(this.blendPass.material.defines.USE_VIGNETTE_TEXTURE=!1,this.blendPass.material.needsUpdate=!0)):"blur"===this.type&&(this.effectHBlur.render(e,this.tempRenderTarget2,i),this.effectVBlur.render(e,this.tempRenderTarget,this.tempRenderTarget2),this.blendPass.uniforms.vignetteOffset.value=this.offset,this.blendPass.uniforms.tDiffuse.value=i.texture,this.blendPass.uniforms.vignetteTexture.value=this.tempRenderTarget.texture,this.blendPass.uniforms.vignetteColor.value.setRGB(1,1,1),this.blendPass.material.defines.USE_VIGNETTE_TEXTURE||(this.blendPass.material.defines.USE_VIGNETTE_TEXTURE=!0,this.blendPass.material.needsUpdate=!0)),this.blendPass.render(e,t,i)},t.prototype.dispose=function(){this.tempRenderTarget.dispose(),this.tempRenderTarget2.dispose()},t}(co),yo={defines:{USE_MASKMAP:0},uniforms:{tDiffuse:{value:null},bounds:{value:new THREE.Vector4(0,0,1,1)},filletXRadius:{value:new THREE.Vector4},filletYRadius:{value:new THREE.Vector4},blendTexture:{value:null},maskMap:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D blendTexture;\n\n\t\tuniform vec4 bounds;\n\n\t\tuniform vec4 filletXRadius;\n\t\tuniform vec4 filletYRadius;\n\n\t\tuniform sampler2D maskMap;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\tvec4 color = texture2D(tDiffuse, vUv);\n\t\t\tvec3 color2 = texture2D(blendTexture, vUv).rgb;\n\t\t\t\n\t\t\tvec2 blurCenter = (bounds.xy + bounds.zw) * 0.5;\n\t\t\tvec2 blurSize = bounds.zw - bounds.xy;\n\n\t\t\tvec2 uv = vUv.xy;\n\t\t\tuv.y = 1.0 - uv.y;\n\n\t\t\tvec2 blurCoords = (uv - blurCenter) / blurSize;\n\n\t\t\t#if USE_MASKMAP\n\t\t\t\tblurCoords = abs(blurCoords);\n\n\t\t\t\tvec2 newUv = (uv - bounds.xy) / blurSize;\n\t\t\t\tnewUv.y = 1. - newUv.y;\n\n\t\t\t\tfloat blend = texture2D(maskMap, newUv).r;\n\t\t\t\tblend *= step(blurCoords.x, 0.5) * step(blurCoords.y, 0.5);\n\t\t\t#else\n\t\t\t\tvec2 filletRadius = vec2(0.);\n\n\t\t\t\tif (blurCoords.x > 0. && blurCoords.y < 0.) {\n\t\t\t\t\tfilletRadius.x = filletXRadius[1];\n\t\t\t\t\tfilletRadius.y = filletYRadius[1];\n\t\t\t\t} else if (blurCoords.x < 0. && blurCoords.y < 0.) {\n\t\t\t\t\tfilletRadius.x = filletXRadius[0];\n\t\t\t\t\tfilletRadius.y = filletYRadius[0];\n\t\t\t\t} else if (blurCoords.x < 0. && blurCoords.y > 0.) {\n\t\t\t\t\tfilletRadius.x = filletXRadius[2];\n\t\t\t\t\tfilletRadius.y = filletYRadius[2];\n\t\t\t\t} else if (blurCoords.x > 0. && blurCoords.y > 0.) {\n\t\t\t\t\tfilletRadius.x = filletXRadius[3];\n\t\t\t\t\tfilletRadius.y = filletYRadius[3];\n\t\t\t\t}\n\n\t\t\t\tblurCoords = abs(blurCoords);\n\n\t\t\t\tvec2 coreRange = 0.5 - filletRadius;\n\n\t\t\t\tfloat rx = blurCoords.x - coreRange.x;\n\t\t\t\tfloat ry = blurCoords.y - coreRange.y;\n\n\t\t\t\tfloat blend = step(blurCoords.x, 0.5) * step(blurCoords.y, 0.5) \n\t\t\t\t\t* (\n\t\t\t\t\t\t1.0 - step(coreRange.x, blurCoords.x)\n\t\t\t\t\t\t* step(coreRange.y, blurCoords.y)\n\t\t\t\t\t\t* step(filletRadius.x * filletRadius.x * filletRadius.y * filletRadius.y, rx * rx * filletRadius.y * filletRadius.y + ry * ry * filletRadius.x * filletRadius.x)\n\t\t\t\t\t);\n\t\t\t#endif\n\n\t\t\tcolor.rgb = mix(color.rgb, color2, blend);\n\t\t\tgl_FragColor = color;\n\t\t}\n    "},bo={defines:{SAMPLERS:9},uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)},direction:{value:new THREE.Vector2(1,0)}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n        uniform sampler2D tDiffuse;\n        uniform vec2 resolution;\n        uniform vec2 direction;\n        varying vec2 vUv;\n\n        #if (SAMPLERS == 5) \n            vec4 blur(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n                vec4 color = vec4(0.0);\n                vec2 off1 = vec2(1.3333333333333333) * direction;\n                color += texture2D(image, uv) * 0.29411764705882354;\n                color += texture2D(image, uv + (off1 * resolution)) * 0.35294117647058826;\n                color += texture2D(image, uv - (off1 * resolution)) * 0.35294117647058826;\n                return color; \n            }\n        #endif\n        #if (SAMPLERS == 9)\n            vec4 blur(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n                vec4 color = vec4(0.0);\n                vec2 off1 = vec2(1.3846153846) * direction;\n                vec2 off2 = vec2(3.2307692308) * direction;\n                color += texture2D(image, uv) * 0.2270270270;\n                color += texture2D(image, uv + (off1 * resolution)) * 0.3162162162;\n                color += texture2D(image, uv - (off1 * resolution)) * 0.3162162162;\n                color += texture2D(image, uv + (off2 * resolution)) * 0.0702702703;\n                color += texture2D(image, uv - (off2 * resolution)) * 0.0702702703;\n                return color;\n            }\n        #endif\n        #if (SAMPLERS == 13)\n            vec4 blur(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n                vec4 color = vec4(0.0);\n                vec2 off1 = vec2(1.411764705882353) * direction;\n                vec2 off2 = vec2(3.2941176470588234) * direction;\n                vec2 off3 = vec2(5.176470588235294) * direction;\n                color += texture2D(image, uv) * 0.1964825501511404;\n                color += texture2D(image, uv + (off1 * resolution)) * 0.2969069646728344;\n                color += texture2D(image, uv - (off1 * resolution)) * 0.2969069646728344;\n                color += texture2D(image, uv + (off2 * resolution)) * 0.09447039785044732;\n                color += texture2D(image, uv - (off2 * resolution)) * 0.09447039785044732;\n                color += texture2D(image, uv + (off3 * resolution)) * 0.010381362401148057;\n                color += texture2D(image, uv - (off3 * resolution)) * 0.010381362401148057;\n                return color;\n            }\n        #endif\n\n        void main() {\n            gl_FragColor = blur(tDiffuse, vUv, resolution, direction);\n        }\n    "},_o=function(e){function t(i,r){n(this,t);var o=a(this,e.call(this));return o.tempRenderTarget=rn(i,r),o.tempRenderTarget2=rn(i,r),o.tempRenderTarget3=rn(i,r),o.tempRenderTarget4=rn(i,r),o.blurPass=new Ar(bo),o.blendPass=new Ar(yo),o.blendPass.uniforms.blendTexture.value=o.tempRenderTarget.texture,o.blendWithMapPass=new Ar(yo),o.blendWithMapPass.material.defines.USE_MASKMAP=1,o.blendWithMapPass.uniforms.blendTexture.value=o.tempRenderTarget.texture,o.bounds=[[0,0,1,1]],o.radius=5,o}return s(t,e),t.prototype.setSize=function(e,t){this.tempRenderTarget.setSize(e,t),this.tempRenderTarget2.setSize(e,t),this.tempRenderTarget3.setSize(e,t),this.tempRenderTarget4.setSize(e,t)},t.prototype.render=function(e,t,i,r,n){for(var o=this,s=this.tempRenderTarget3.width,a=this.tempRenderTarget3.height,l=2+2*Math.floor(this.radius/2),u=0;u<l;u++){this.blurPass.uniforms.resolution.value.set(1/s,1/a);var c=this.radius*(u+1)/l;u%2==0?(this.blurPass.uniforms.direction.value.set(c,0),this.blurPass.render(e,this.tempRenderTarget2,0===u?i:this.tempRenderTarget)):(this.blurPass.uniforms.direction.value.set(0,c),this.blurPass.render(e,this.tempRenderTarget,this.tempRenderTarget2))}var h=i,p=this.tempRenderTarget3,d=void 0;this.bounds.forEach((function(i,r){var n,s=void 0,a=Object.prototype.toString.call(i[4]);"[object String]"==a?((s=o.blendWithMapPass).uniforms.filletXRadius.value.set(0,0,0,0),s.uniforms.filletYRadius.value.set(0,0,0,0),s.uniforms.maskMap.value=(n=i[4],nn.has(n)||nn.set(n,(new THREE.TextureLoader).load(n)),nn.get(n))):"[object Number]"==a?((s=o.blendPass).uniforms.filletXRadius.value.set(i[4],i[6],i[8],i[10]),s.uniforms.filletYRadius.value.set(i[5],i[7],i[9],i[11]),s.uniforms.maskMap.value=null):((s=o.blendPass).uniforms.filletXRadius.value.set(0,0,0,0),s.uniforms.filletYRadius.value.set(0,0,0,0),s.uniforms.maskMap.value=null),s.uniforms.bounds.value.fromArray(i),s.render(e,r===o.bounds.length-1?t:p,h),d=h,h=p,p=0===r?o.tempRenderTarget4:d}))},t.prototype.dispose=function(){this.tempRenderTarget.dispose(),this.tempRenderTarget2.dispose(),this.tempRenderTarget3.dispose(),this.tempRenderTarget4.dispose()},t}(co),xo=function(){function e(){n(this,e),this._defaultSharedMRB=null,this._defaultSharedRB=null,this._inputColorTexture=null,this._inputDepthTexture=null,this._inputColorRenderbuffer=null,this._inputDepthRenderbuffer=null,this._inited=!1}return e.prototype.begin=function(e){this._inited||(this._defaultSharedMRB=e.createRenderbuffer(),this._defaultSharedRB=e.createRenderbuffer(),this._inited=!0)},e.prototype.setupSceneBuffer=function(e){this._inputDepthTexture?e.setDepthTexture(this._inputDepthTexture):this._inputColorRenderbuffer&&this._inputDepthRenderbuffer?e.setColorDepthRenderBuffer(this._inputColorRenderbuffer,this._inputDepthRenderbuffer):e.setDepthRenderBuffer(this._defaultSharedMRB,this._defaultSharedRB)},e.prototype.setupPasses=function(e){var t=this,i=!1;return e.forEach((function(e){e.isActive()&&(t._inputDepthTexture?e._schemeBuffer.shareDepthTexture(t._inputDepthTexture):t._inputColorRenderbuffer&&t._inputDepthRenderbuffer?e._schemeBuffer.shareDepthRenderBuffer(t._inputDepthRenderbuffer,t._defaultSharedRB)&&(i=!0):e._schemeBuffer.__shareDepthRenderBuffer?e._schemeBuffer.shareDepthRenderBuffer(t._defaultSharedMRB,t._defaultSharedRB)&&(i=!0):e._schemeBuffer.clearDepthShare()&&(i=!0))})),i},e.prototype.clearInputs=function(){this._inputColorTexture=null,this._inputDepthTexture=null,this._inputColorRenderbuffer=null,this._inputDepthRenderbuffer=null},e.prototype.setInputTextures=function(e,t){this._inputColorTexture=e,this._inputDepthTexture=t,this._inputColorRenderbuffer=null,this._inputDepthRenderbuffer=null},e.prototype.setInputRenderbuffers=function(e,t){this._inputColorTexture=null,this._inputDepthTexture=null,this._inputColorRenderbuffer=e,this._inputDepthRenderbuffer=t},e.prototype.getInputColorTexture=function(){return this._inputColorTexture},e.prototype.supportMSAA=function(){return!this._inputDepthTexture&&(!!this._inputDepthRenderbuffer||null)},e.prototype.needSwap=function(){return this._inputColorTexture||this._inputDepthTexture||this._inputColorRenderbuffer||this._inputDepthRenderbuffer},e.prototype.needClear=function(){return!(this._inputColorRenderbuffer&&this._inputDepthRenderbuffer||this._inputColorTexture)},e.prototype.dispose=function(){},e}(),Eo=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n(this,e);var o=void 0!==r.stencil&&r.stencil,s=void 0!==r.maxSamplers?r.maxSamplers:8;this._tempRenderTarget1=rn(t,i),this._tempRenderTarget2=rn(t,i),this._sceneBuffer=new Vr(t,i,o,s),this._superSampler=new lo(t,i,30),this._gBuffer=new Jr(t,i),this._bufferShareManager=new xo,this._ssaoPrePass=new an(t,i),this._ssaoKernalSize=12,this._ssrPrePass=new cn(t,i),this._copyPass=new Ar(Cr),this._copyPass.material.depthWrite=!1,this._copyPass.clearAlpha=0,this._colorEffect=new ho(new Ar(Er)),this._dofEffect=new ho(new Ar(wr,"tColor")),this._dofEffect._pass.uniforms.tDepth.value=this._gBuffer.getDepthTexture(),this._vignetteEffect=new vo(t,i),this._bloomEffect=new mo(t,i),this._filmEffect=new ho(new Ar(Tr)),this._chromaticAberrationEffect=new ho(new Ar(Mr)),this._fxaaEffect=new ho(new Ar(Sr),t,i),this._rectBlurEffect=new _o(t,i),this._effects=new Map([["colorCorrection",this._colorEffect],["dof",this._dofEffect],["vignette",this._vignetteEffect],["bloom",this._bloomEffect],["film",this._filmEffect],["chromaticAberration",this._chromaticAberrationEffect],["FXAA",this._fxaaEffect],["blur",this._rectBlurEffect]]),this._effectList1=["colorCorrection","dof","vignette","bloom"],this._effectList2=["chromaticAberration","FXAA","blur","film"],this._glowPass=new jn(t,i,"glow",s),this._middleGlowPass=new jn(t,i,"middleGlow",s),this._smallGlowPass=new jn(t,i,"smallGlow",s),this._combineGlowPass=new jn(t,i,["glow","middleGlow","smallGlow"],s),this._combineGlowPass.$enable=!1,this._lineBloomPass=new An(t,i,s),this._innerGlowPass=new zn(t,i,s),this._radialBlurPass=new Hn(t,i,s),this._radialBlur2Pass=new Wn(t,i,s),this._radialOffsetPass=new qn(t,i,s),this._focusRegionPass=new $n(t,i,s),this._overLayPasses=new Map([["Glow",this._glowPass],["MiddleGlow",this._middleGlowPass],["SmallGlow",this._smallGlowPass],["CombineGlow",this._combineGlowPass],["LineBloom",this._lineBloomPass],["InnerGlow",this._innerGlowPass],["RadialBlur",this._radialBlurPass],["RadialBlur2",this._radialBlur2Pass],["RadialOffset",this._radialOffsetPass],["FocusRegion",this._focusRegionPass]]),this._outlinePasses=new Map,this._config=en({},uo),this.setConfig({}),this.width=t,this.height=i,this.supportTransparent=!1,this.schemeAutoMSAA=!0,this.autoClearDepthStencil=!0,this._needPreSetupRenderTarget=!0,this.onlyAO=!1,this.onlySSR=!1,this.enableOutlines=!0,this.enableOverlays=!0}return e.prototype.setConfig=function(e){this._config=en(this._config,e),this._superSampler.setSamplingSize(this._config.temporalSuperSampling.size);var t=void 0;t=this._config.postEffect.bloom,this._bloomEffect.strength=t.strength,this._bloomEffect.radius=t.radius,this._bloomEffect.threshold=t.threshold,t=this._config.postEffect.screenSpaceAmbientOcclusion,this._ssaoPrePass.setParameter("radius",t.radius),this._ssaoPrePass.setParameter("bias",t.radius/50),this._ssaoPrePass.setParameter("intensity",t.intensity),this._ssaoKernalSize={low:6,medium:12,high:32,ultra:64}[t.quality]||12,this._ssaoPrePass.setKernelSize(this._ssaoKernalSize),t=this._config.postEffect.screenSpaceReflection,this._ssrPrePass._ssrPass.uniforms.maxRayDistance.value=t.maxRayDistance,this._ssrPrePass._ssrPass.uniforms.pixelStride.value=t.pixelStride,this._ssrPrePass._ssrPass.uniforms.pixelStrideZCutoff.value=t.pixelStrideZCutoff,this._ssrPrePass._ssrPass.uniforms.screenEdgeFadeStart.value=t.screenEdgeFadeStart,this._ssrPrePass._ssrPass.uniforms.eyeFadeStart.value=t.eyeFadeStart,this._ssrPrePass._ssrPass.uniforms.eyeFadeEnd.value=t.eyeFadeEnd,this._ssrPrePass._ssrPass.uniforms.minGlossiness.value=t.minGlossiness,t=this._config.postEffect.colorCorrection,this._colorEffect._pass.uniforms.exposure.value=t.exposure,this._colorEffect._pass.uniforms.brightness.value=t.brightness,this._colorEffect._pass.uniforms.contrast.value=t.contrast,this._colorEffect._pass.uniforms.saturation.value=t.saturation,this._colorEffect._pass.uniforms.gamma.value=t.gamma,t=this._config.postEffect.dof,this._dofEffect._pass.uniforms.focalDepth.value=t.focalDepth,this._dofEffect._pass.uniforms.focalLength.value=t.focalLength,this._dofEffect._pass.uniforms.fstop.value=t.fstop,this._dofEffect._pass.uniforms.maxblur.value=t.maxblur,this._dofEffect._pass.uniforms.threshold.value=t.threshold,this._dofEffect._pass.uniforms.gain.value=t.gain,this._dofEffect._pass.uniforms.bias.value=t.bias,this._dofEffect._pass.uniforms.dithering.value=t.dithering,t=this._config.postEffect.vignette,this._vignetteEffect.type=t.type,Array.isArray(t.color)?this._vignetteEffect.color.fromArray(t.color):this._vignetteEffect.color.setHex(t.color),this._vignetteEffect.offset=t.offset,t=this._config.postEffect.film,this._filmEffect._pass.uniforms.grayscale.value=t.grayscale,this._filmEffect._pass.uniforms.nIntensity.value=t.noiseIntensity,this._filmEffect._pass.uniforms.sIntensity.value=t.scanlinesIntensity,this._filmEffect._pass.uniforms.sCount.value=t.scanlinesCount,t=this._config.postEffect.chromaticAberration,this._chromaticAberrationEffect._pass.uniforms.uChromaFactor.value=t.chromaFactor,t=this._config.postEffect.blur,this._rectBlurEffect.bounds=t.bounds,this._rectBlurEffect.radius=t.radius,this.dirty()},e.prototype.enable=function(e){if(e.indexOf("outline")>-1){var t=e.split("_"),i=t[1];if(e=t[0],this._outlinePasses.has(i))this._outlinePasses.get(i).enable=!0;else{var r=new so(this.width,this.height,i);r.enable=!0,this._outlinePasses.set(i,r)}}else e=$r(e),this._overLayPasses.has(e)&&(this._overLayPasses.get(e).enable=!0),"Glow"!==e&&"MiddleGlow"!==e&&"SmallGlow"!==e||(this._overLayPasses.get("CombineGlow").enable=this._overLayPasses.get("Glow").enable||this._overLayPasses.get("MiddleGlow").enable||this._overLayPasses.get("SmallGlow").enable)},e.prototype.disable=function(e){if(e.indexOf("outline")>-1){var t=e.split("_"),i=t[1];if(e=t[0],this._outlinePasses.has(i))this._outlinePasses.get(i).enable=!1}else e=$r(e),this._overLayPasses.has(e)&&(this._overLayPasses.get(e).enable=!1),"Glow"!==e&&"MiddleGlow"!==e&&"SmallGlow"!==e||(this._overLayPasses.get("CombineGlow").enable=this._overLayPasses.get("Glow").enable||this._overLayPasses.get("MiddleGlow").enable||this._overLayPasses.get("SmallGlow").enable)},e.prototype.getPass=function(e){return e=$r(e),this._overLayPasses.has(e)?this._overLayPasses.get(e):null},e.prototype.clearInputs=function(){this._bufferShareManager.clearInputs(),this.dirty()},e.prototype.setInputTextures=function(e,t){this._bufferShareManager.setInputTextures(e,t),this.dirty()},e.prototype.setInputRenderbuffers=function(e,t){this._bufferShareManager.setInputRenderbuffers(e,t),this.dirty()},e.prototype.shareDepthRenderBuffer=function(e,t){if(t){var i=this.getPass(t);i?e?i._schemeBuffer.__shareDepthRenderBuffer=!0:delete i._schemeBuffer.__shareDepthRenderBuffer:console.warn("AdvancedRenderer: shareDepthRenderBuffer pass <"+t+"> can not find.")}else this._overLayPasses.forEach((function(t){e?t._schemeBuffer.__shareDepthRenderBuffer=!0:delete t._schemeBuffer.__shareDepthRenderBuffer}));this.dirty()},e.prototype.setSize=function(e,t){this._sceneBuffer.setSize(e,t),this._tempRenderTarget1.setSize(e,t),this._tempRenderTarget2.setSize(e,t),this._gBuffer.setSize(e,t),this._superSampler.setSize(e,t),this._ssaoPrePass.setSize(e,t),this._ssrPrePass.setSize(e,t),this._effects.forEach((function(i){return i.setSize(e,t)})),this._overLayPasses.forEach((function(i){return i.setSize(e,t)})),this._outlinePasses.forEach((function(i){return i.setSize(e,t)})),this.width=e,this.height=t,this._needPreSetupRenderTarget=!0,this.dirty()},e.prototype.render=function(e,t,i,r){var n=this,o=this._config.temporalSuperSampling.enable,s=this._config.postEffect.enable,a=e.capabilities.isWebGL2;if(s||o||this._bufferShareManager.needSwap()){var l=this._bufferShareManager.supportMSAA();null===l&&(l=a&&s&&this._config.postEffect.MSAA.enable);var u=void 0,c=void 0;if(o&&this._superSampler.finished())u=this._superSampler.output();else{o&&this._superSampler.jitterProjection(i,this.width,this.height),this._bufferShareManager.begin(e.getContext()),this._bufferShareManager.setupSceneBuffer(this._sceneBuffer);var h=this._bufferShareManager.setupPasses(this._overLayPasses);(this._needPreSetupRenderTarget||h)&&(this._overLayPasses.forEach((function(t,i){t.isActive()&&2===t._schemeBuffer.depthShareType&&t._schemeBuffer.setupRenderTarget(e)})),this._needPreSetupRenderTarget=!1),this._sceneBuffer.useMRT=l,c=this._sceneBuffer.getSchemeBuffer();var p=this._bufferShareManager.getInputColorTexture();p&&(this._copyPass.uniforms[this._copyPass.textureID].value=p,this._copyPass.clear=!0,this._copyPass.clearDepthStencil=this.autoClearDepthStencil,this._copyPass.material.transparent=!1,this._copyPass.render(e,c),this._copyPass.clearDepthStencil=!0),this._sceneBuffer.render(e,t,i,this._bufferShareManager.needClear()),s&&((this._config.postEffect.screenSpaceAmbientOcclusion.enable||this._config.postEffect.screenSpaceReflection.enable||this._config.postEffect.dof.enable)&&this._gBuffer.render(e,t,i,this._config.postEffect.screenSpaceAmbientOcclusion.ignoreTransparent),this._config.postEffect.screenSpaceAmbientOcclusion.enable&&(o&&this._config.postEffect.screenSpaceAmbientOcclusion.temporalFilter&&this._ssaoPrePass.setKernelSize(this._ssaoKernalSize,this._superSampler.frame()),this._ssaoPrePass.render(this._gBuffer.getNormalGlossinessTexture(),this._gBuffer.getDepthTexture(),e,i,c,this.onlyAO)),this._config.postEffect.screenSpaceReflection.enable&&(o&&this._config.postEffect.screenSpaceReflection.temporalFilter?(this._ssrPrePass.jitter=!!this._superSampler.frame(),this._ssrPrePass._blurPass.material.uniforms.blurSize.value=1+this._superSampler.frame()/this._superSampler.getSamplingSize()):(this._ssrPrePass.jitter=!1,this._ssrPrePass._blurPass.material.uniforms.blurSize.value=2),this._ssrPrePass.render(c.texture,this._gBuffer.getNormalGlossinessTexture(),this._gBuffer.getDepthTexture(),e,i,c,this.onlySSR))),o?(u=this._superSampler.sample(e,c.texture),i.clearViewOffset()):u=c}this._copyPass.clear=!0,this._copyPass.material.transparent=!1,this._copyPass.render(e,this._tempRenderTarget2,u);var d=this._tempRenderTarget2,f=this._tempRenderTarget1,m=function(t){if(n._config.postEffect[t].enable){var r=n._effects.get(t);if("dof"==t&&(r._pass.uniforms.znear.value=i.near,r._pass.uniforms.zfar.value=i.far),r.render(e,f,d,.01667),r.needSwapBuffer){var o=d;d=f,f=o}}};this._effectList1.forEach(m),this.enableOverlays&&this._overLayPasses.forEach((function(r){r.isActive()&&r.render(e,t,i,d,l)})),this.enableOutlines&&this._outlinePasses.forEach((function(r){r.isActive()&&r.render(e,t,i,d,l)})),this._effectList2.forEach(m),this._copyPass.clear=e.autoClear,this._copyPass.material.transparent=this.supportTransparent,this._copyPass.render(e,r||void 0,d)}else{e.setRenderTarget(r||null),e.render(t,i);var g=this.schemeAutoMSAA&&a;this.enableOverlays&&this._overLayPasses.forEach((function(r){r.isActive()&&(r._schemeBuffer.clearDepthShare(),r.render(e,t,i,void 0,g))})),this.enableOutlines&&this._outlinePasses.forEach((function(r){r.isActive()&&r.render(e,t,i,void 0,g)}))}},e.prototype.dirty=function(e){this._config.temporalSuperSampling.enable&&this._superSampler.start(),e?"Outline"===(e=$r(e))?this._outlinePasses.forEach((function(e){return e.dirty()})):this._overLayPasses.has(e)&&this._overLayPasses.get(e).dirty():(this._overLayPasses.forEach((function(e){return e.dirty()})),this._outlinePasses.forEach((function(e){return e.dirty()})))},e.prototype.dispose=function(){this._tempRenderTarget1.dispose(),this._tempRenderTarget2.dispose(),this._sceneBuffer.dispose(),this._superSampler.dispose(),this._gBuffer.dispose(),this._bufferShareManager.dispose(),this._ssaoPrePass.dispose(),this._ssrPrePass.dispose(),this._copyPass.material.dispose(),this._overLayPasses.forEach((function(e){return e.dispose()})),this._outlinePasses.forEach((function(e){return e.dispose()})),this._effects.forEach((function(e){return e.dispose()}))},e.prototype.getActiveOverlayPasses=function(){return this.enableOverlays?Array.from(this._overLayPasses.values()).filter((function(e){return e.isActive()})):[]},e.prototype.getOutlinePasses=function(){return this._outlinePasses},e.prototype.disableAllOverlayPasses=function(){this._overLayPasses.forEach((function(e){return e.$enable=!1}))},o(e,[{key:"combineGlow",set:function(e){this._overLayPasses.get("CombineGlow").$enable=e,this._overLayPasses.get("Glow").$enable=!e,this._overLayPasses.get("MiddleGlow").$enable=!e,this._overLayPasses.get("SmallGlow").$enable=!e},get:function(){return this._overLayPasses.get("CombineGlow").$enable}}]),e}(),wo=new THREE.Vector3,To=new THREE.Vector3,Mo={vertexShader:"\n        #include <skinning_pars_vertex>\n        void main() {\n            #include <skinbase_vertex>\n            #include <begin_vertex>\n            #include <skinning_vertex>\n            #include <project_vertex>\n        }\n    ",fragmentShader:"\n        void main() {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    "},Co=new THREE.ShaderMaterial(Mo),So=new THREE.ShaderMaterial(Mo);So.skinning=!0;var jo=new THREE.Color,Po=function(){function e(t,i){n(this,e),this.camera=new THREE.OrthographicCamera;var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.tempRenderTarget=new THREE.WebGLRenderTarget(t,i,r),this.radius=.1,this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;for(var o=Math.round(t/2),s=Math.round(i/2),a=0;a<this.nMips;a++){var l=new THREE.WebGLRenderTarget(o,s,r);l.texture.name="AOBaker.h"+a,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l);var u=new THREE.WebGLRenderTarget(o,s,r);u.texture.name="AOBaker.v"+a,u.texture.generateMipmaps=!1,this.renderTargetsVertical.push(u),o=Math.round(o/2),s=Math.round(s/2)}this.separableBlurMaterials=[];var c=[3,5,7,9,11];o=Math.round(t/2),s=Math.round(i/2);for(var h=0;h<this.nMips;h++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(c[h])),this.separableBlurMaterials[h].uniforms.texSize.value=new THREE.Vector2(o,s),o=Math.round(o/2),s=Math.round(s/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[.5,.7,.8,.9,1],this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)}return e.prototype.bake=function(e,t,i,r){i&&this.fit(i,r),e.materialManager.hasStrategy("AOBaker")||e.materialManager.addStrategy("AOBaker",(function(e,t,i,r,n,o){return this.userData.ground?null:n.skinning?So:Co}));var n=e.autoClear;e.autoClear=!1,jo.copy(e.getClearColor());var o=e.getClearAlpha();e.setClearColor(new THREE.Color(1,1,1),1),e.materialManager.setMode("AOBaker");var s=t.autoUpdate,a=t.background,l=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.setRenderTarget(this.tempRenderTarget),e.clear(),e.render(t,this.camera),t.autoUpdate=s,t.background=a,e.shadowMap.enable=l,e.materialManager.setMode(0);for(var u=this.tempRenderTarget,c=0;c<this.nMips;c++)this.quad.material=this.separableBlurMaterials[c],this.separableBlurMaterials[c].uniforms.colorTexture.value=u.texture,this.separableBlurMaterials[c].uniforms.direction.value=new THREE.Vector2(1,0),e.setRenderTarget(this.renderTargetsHorizontal[c]),e.clear(),e.render(this.scene,this._camera),this.separableBlurMaterials[c].uniforms.colorTexture.value=this.renderTargetsHorizontal[c].texture,this.separableBlurMaterials[c].uniforms.direction.value=new THREE.Vector2(0,1),e.setRenderTarget(this.renderTargetsVertical[c]),e.clear(),e.render(this.scene,this._camera),u=this.renderTargetsVertical[c];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomRadius.value=1-this.radius,e.setRenderTarget(this.tempRenderTarget),e.clear(),e.render(this.scene,this._camera),e.setClearColor(jo,o),e.autoClear=n},e.prototype.fit=function(e,t){var i=e.getCenter(wo),r=e.getSize(To);this.camera.position.set(i.x,i.y+r.y,i.z),this.camera.rotation.set(-Math.PI/2,0,0),this.camera.matrixAutoUpdate=!1,this.camera.updateMatrix(),this.camera.matrix.premultiply(t),this.camera.near=r.y/3,this.camera.far=2*r.y,this.camera.left=-r.x/2+.075,this.camera.right=r.x/2-.075,this.camera.top=r.z/2-.075,this.camera.bottom=-r.z/2+.075,this.camera.updateProjectionMatrix(),r.x=1024,r.z=1024,this.tempRenderTarget.setSize(r.x,r.z);for(var n=Math.round(r.x/2),o=Math.round(r.z/2),s=0;s<this.nMips;s++)this.renderTargetsHorizontal[s].setSize(n,o),this.renderTargetsVertical[s].setSize(n,o),this.separableBlurMaterials[s].uniforms.texSize.value=new THREE.Vector2(n,o),n=Math.round(n/2),o=Math.round(o/2)},e.prototype.dispose=function(){this.tempRenderTarget.dispose();for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(var t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose()},e.prototype.getSeperableBlurMaterial=function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},e.prototype.getCompositeMaterial=function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomFactors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\t\n\t\t\t\tfloat lerpBloomFactor(const in float factor) { \n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat factor0 = lerpBloomFactor(bloomFactors[0]);\n\t\t\t\t\tfloat factor1 = lerpBloomFactor(bloomFactors[1]);\n\t\t\t\t\tfloat factor2 = lerpBloomFactor(bloomFactors[2]);\n\t\t\t\t\tfloat factor3 = lerpBloomFactor(bloomFactors[3]);\n\t\t\t\t\tfloat factor4 = lerpBloomFactor(bloomFactors[4]);\n\t\t\t\t\tgl_FragColor = (factor0 * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor1 * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor2 * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor3 * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor4 * texture2D(blurTexture5, vUv)) / (factor0 + factor1 + factor2 + factor3 + factor4);\n\t\t\t\t}\t\n\t\t\t"})},o(e,[{key:"ao",get:function(){return this.tempRenderTarget.texture}}]),e}(),Ro=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.setupTextureAnimations=function(){Bi.hasTextureAnimation(this.node)&&this.addControl(new Bi,"texAnimControl")},t.prototype.setupUserData=function(t){e.prototype.setupUserData.call(this,t),this.node.userData.isCombinedObject=!0},t.prototype.setupResources=function(t){if(e.prototype.setupResources.call(this,t),this.loaded){for(var i=this;i&&i.isCombinedObject;)i=i.parent;var r=i.style._inheritThemeName;r&&i.loaded&&i.applyTheme(r,!1,!0)}},t.prototype._notifyLoadingObjects=function(){},t.prototype.loadResource=function(){e.prototype.loadResource.call(this,!0)},t.prototype.unloadResource=function(){e.prototype.unloadResource.call(this,!0)},t.prototype.isChildOfType=function(e){for(var t=e.split("|"),i=this._parent;i;i=i._parent)for(var r=0;r<t.length;r++){if(i["is"+t[r]])return!0}return!1},o(t,[{key:"isCombinedObject",get:function(){return!0}}]),t}(Si),Do=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._height=3,r._initBoxSize=null,r.miscObject=null,r.wallObject=null,r.roofObject=null,r.ceilingObject=null,r._marker=null,r._navigation=null,r._groundAOBaker=null,r._baked=!1,r._showObjectsInParentLevels=!1,r}return s(t,e),t.prototype.isBlockMouseOffEvent=function(e){return!!this.isChildOf(e)},t.prototype.destroy=function(){this._groundAOBaker&&(this.plan.node.traverse((function(e){var t=e.material;t&&(t.aoMap=null,t.needsUpdate=!0)})),this._groundAOBaker.dispose(),this._groundAOBaker=null),e.prototype.destroy.call(this)},t.prototype.synTransform=function(e){this.setupUserData(e),this.parent||this.setupParent(e),e.skipSetupParent=!0,this.setupTranslation(e)},t.prototype.setupFromURL=function(e){var t=this.app.confirmURL(e.url);this._url=t,this._setup(e)},t.prototype.customSetup=function(e){this._height=e.height||this._height,this._initBoxSize=e.initBoxSize,this._showObjectsInParentLevels=Et.parseValue(e.alwaysShowInsideObjs,this._showObjectsInParentLevels)},t.prototype.loadResource=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(t)e.prototype.loadResource.call(this,t);else{var i=[this.roof,this.wall,this.plan,this.ceiling];i.forEach((function(e){e&&e.loadResource()})),this.doors.forEach((function(e){e.loadResource()})),this.things.forEach((function(e){e.isWindow&&e.loadResource()}));var r=this.misc;r&&r.traverse((function(e){e.node.isDoorOrWin&&e.loadResource()})),this.rooms.forEach((function(e){e.loadResource(!1)}))}},t.prototype.unloadResource=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(t)e.prototype.unloadResource.call(this,t);else{var i=[this.roof,this.wall,this.plan,this.ceiling];i.forEach((function(e){e&&e.unloadResource()})),this.doors.forEach((function(e){e.unloadResource()})),this.things.forEach((function(e){e.isWindow&&e.unloadResource()}));var r=this.misc;r&&r.traverse((function(e){e.node.isDoorOrWin&&e.unloadResource()})),this.rooms.forEach((function(e){e.unloadResource(!1)}))}},t.prototype.setupResources=function(t){e.prototype.setupResources.call(this,t),this._ceilingNode=t.ceilingNode||this._ceilingNode,this._roofNode=t.roofNode||this._roofNode,this._floorNode=t.floorNode||this._floorNode,this._ceilingNode&&(this.ceiling.node=this._ceilingNode),this._roofNode&&(this.roof.node=this._roofNode),this._floorNode&&(this.plan.node=this._floorNode)},t.prototype._getChildVisibles=function(){var e=this.children.concat([this.roof,this.ceiling,this.plan]),t=[];return e.forEach((function(e){e&&t.push(e.visible)})),t},t.prototype._onGetChild=function(){return this.children.concat([this.roof,this.ceiling,this.plan])},t.prototype._getDoors=function(e){for(var t=[],i=0;i<this.doors.length;i++){var r=this.doors[i];r[e]&&t.push(r)}return t},t.prototype._createMarker=function(e){var t=(e=e||{}).connectorName||/connector/,i=e.markerName||/marker/,r=this.attachPoints.query(t),n=this.attachPoints.query(i);if(0!=r.length||0!=n.length){var o=r[0],s=n[0];e.type="Marker",e.parent=this,Et.isNull(e.size)?THING.Utils.error("floor's marker must provide size to show"):Et.isNull(e.canvas)&&Et.isNull(e.url)?THING.Utils.error("floor's marker must provide 'canvas' or 'url' to show"):(s&&(e.position=s.position),o?e.lineToPosition=o.position:e.lineColor&&THING.Utils.error("Please make sure connector is avaliable for showing connection line of marker"),this._marker=this.app.create(e))}},t.prototype.setupChildVisibleAsParent=function(e,t){this.visible||this._showObjectsInParentLevels||(e.visible=!1)},t.prototype.traverseRoofs=function(e){this.roof&&e(this.roof);for(var t=this.rooms,i=0;i<t.length;i++){var r=t[i].roof;r&&e(r)}},t.prototype.showAllRoofs=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.roof&&(this.roof.visible=e);for(var t=this.rooms,i=0;i<t.length;i++){var r=t[i].roof;r&&(r.visible=e)}},t.prototype.showAllCeilings=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.ceiling;t&&(t.visible=e);for(var i=this.rooms,r=0;r<i.length;r++)i[r].ceiling.visible=e},t.prototype.showMarker=function(e){this._marker||this._createMarker(e),Et.isBoolean(e)?this._marker.visible=e:this._marker.setParams(e)},t.prototype.getRoomFromLocalPosition=function(e){return this.getRoomFromWorldPosition(this.selfToWorld(e))},t.prototype.getRoomFromWorldPosition=function(e){for(var t=this.rooms,i=0;i<t.length;i++){var r=t[i];if(r.getRayCastPosition(e))return r}return null},t.prototype.bake=function(e){var t=this.plan;if(t){for(var i=t.node.getMeshes(),r=0;r<i.length;r++)if(i[r]instanceof THREE.Water)return;if(s=this.wall){var n=this;if(null===e){if(!this._baked)return;var o=function(e){e.isShaderMaterial||(Et.revertValue(e,"aoMap"),Et.revertValue(e,"aoMapIntensity"),e.needsUpdate=!0)};t.node.traverseMaterials(o),this.rooms.forEach((function(e){var t=e.plan;t&&t.node.traverseMaterials(o)})),this._baked=!1}else{var s;if(e=e||{},!(s=this.wall))return;var a=Et.parseValue(e.intensity,1.4);this._groundAOBaker||(this._groundAOBaker=new Po);var l=s.getLocalBoundingBox(!0,!0).toBox();this._initBoxSize&&l.max.addVectors(l.min,Et.parseVector3(this._initBoxSize).addScalar(.15)),this._groundAOBaker.bake(this.app.renderer,s.node,l,this.node.matrixWorld);var u=function(e,t){t.isShaderMaterial||(Et.backupValue(t,"aoMap"),Et.backupValue(t,"aoMapIntensity"),t.aoMap=n._groundAOBaker.ao,t.aoMapIntensity=a,t.needsUpdate=!0)};t.style._cloneAndModifyMaterial((function(e,t,i){u(0,t)}),!0,(function(e){return!!e.isShaderMaterial||!e._mustClone&&!(!e._isCloned()||!e._getOriginal())})),this.rooms.forEach((function(e){var t=e.plan;t&&t.style._cloneAndModifyMaterial((function(e,t,i){u(0,t)}))})),this._baked=!0}}}},t.prototype.canNavigation=function(){return!0},t.prototype._getLinkableObjects=function(){var t=this.rooms;return t=t.concat(e.prototype._getLinkableObjects.call(this))},t.prototype._getLinkableDoors=function(){var t=this.elevatorDoors;return t=(t=t.concat(this.stairDoors)).concat(e.prototype._getLinkableDoors.call(this))},t.prototype._setupNavigationGraph=function(t,i){e.prototype._setupNavigationGraph.call(this,t,i);for(var r=this._getLinkableObjects(),n=0;n<r.length;n++)for(var o=r[n],s=o._getLinkableDoors(),a=0;a<s.length;a++){t[(l=s[a]).id]=t[l.id]||{},t[o.id]=t[o.id]||{},t[o.id][l.id]=t[l.id][o.id]=i}t[this.id]=t[this.id]||{};for(s=this._getLinkableDoors(),n=0;n<s.length;n++){var l,u=(l=s[n]).owner;u&&(t[l.id]=t[l.id]||{},t[u.id]=t[u.id]||{},t[this.id][l.id]=t[l.id][this.id]=i,t[u.id][l.id]=t[l.id][u.id]=i)}},t.prototype.onBeforeCapture=function(){var e=this.plan;if(e){var t=function(e){var t=e.material;t&&(Et.backupValue(t,"aoMap"),t.aoMap=null,t.needsUpdate=!0)};e.node.traverseAll((function(e){t(e)})),this.rooms.forEach((function(e){var i=e.plan;i&&i.node.traverseAll((function(e){t(e)}))}))}},t.prototype.onAfterCapture=function(){var e=this.plan;if(e){var t=function(e){var t=e.material;t&&(Et.revertValue(t,"aoMap"),t.needsUpdate=!0)};e.node.traverseAll((function(e){t(e)})),this.rooms.forEach((function(e){var i=e.plan;i&&i.node.traverseAll((function(e){t(e)}))}))}},t.prototype.showThings=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];THING.Utils.warn("[Floor] Please use '.things.visible=true/false' to replace '.showThings'"),this.things.visible=e},t.prototype.showDoors=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];THING.Utils.warn("[Floor] Please use '.things.visible=true/false' to replace '.showThings'"),this.doors.visible=e},t.prototype.hideMarker=function(){THING.Utils.warn("[Floor] Please use '.showMarker(false)' to replace '.hideMarker'"),this.showMarker(!1)},t.prototype.setMarker=function(e){THING.Utils.warn("[Floor] Please use '.showMarker(params)' to replace '.setMarker'"),this.showMarker(e)},t.prototype.showRoof=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];THING.Utils.warn("[Floor] Please use '.showAllRoofs()' to replace '.showRoof()'"),this.showAllRoofs(e)},t.prototype.showCeiling=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];THING.Utils.warn("[Floor] Please use '.showAllCeilings()' to replace '.showCeiling()'"),this.showAllCeilings(e)},o(t,[{key:"isFloor",get:function(){return!0}},{key:"isOutdoors",get:function(){for(var e=this._parent;e;e=e._parent)if(e.isBuilding&&!e.hasFacades())return!0;return!1}},{key:"building",get:function(){return this.parents.query(".Building")[0]}},{key:"indexOfBuilding",get:function(){return this.indexOfParent(!0)}},{key:"levelNumber",get:function(){return this.indexOfParent(!0)+1}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"doors",get:function(){return this.query(".Door",!1)}},{key:"elevatorDoors",get:function(){return this.doors.query(".ElevatorDoor",!1)}},{key:"stairDoors",get:function(){return this.doors.query(".StairDoor",!1)}},{key:"stairs",get:function(){return this.query(".Stair",!1)}},{key:"rooms",get:function(){return this.query(".Room",!1)}},{key:"misc",get:function(){return this.miscObject||(this.miscObject=this.query(".CombinedObject").query("[userData/type=CombineMiscParent]")[0]),this.miscObject}},{key:"plan",get:function(){return this.floorObject||(this.floorObject=this.query(".CombinedObject").query("[userData/type=CombineFloorParent]")[0]),this.floorObject}},{key:"wall",get:function(){return this.wallObject||(this.wallObject=this.query(".CombinedObject").query("[userData/type=CombineWallParent]")[0]),this.wallObject}},{key:"roof",get:function(){return this.roofObject||(this.roofObject=this.query(".CombinedObject").query("[userData/type=CombineRoofParent]")[0]),this.roofObject}},{key:"ceiling",get:function(){return this.ceilingObject||(this.ceilingObject=this.query(".CombinedObject").query("[userData/type=CombineCeilingParent]")[0]),this.ceilingObject}},{key:"marker",get:function(){return this._marker}},{key:"height",get:function(){return this._height}},{key:"showObjectsInParentLevels",get:function(){return this._showObjectsInParentLevels}},{key:"isFloorPlan",get:function(){return THING.Utils.warn("[Floor] Please use '.isFloor' to replace '.isFloorPlan'"),!0}},{key:"levelNum",get:function(){return THING.Utils.warn("[Floor] Please use '.levelNumber' to replace '.levelNum'"),this.levelNumber}}]),t}(Si),Ao=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.name="Outdoors",r._floorNode=null,r}return s(t,e),t.prototype.destroy=function(){this._floorNode=null,e.prototype.destroy.call(this)},t.prototype.setupChildVisibleAsParent=function(){},t.prototype.setup=function(e){this.setupID(e),this.setupParent(e),this.parent.outdoors=this,this.setupUserData(e)},t.prototype.setPolygonOffset=function(e){var t=this._floorNode;t&&new Si(this.app)._init(t).style.setPolygonOffset(e)},o(t,[{key:"floorNode",set:function(e){this._floorNode=e},get:function(){return this._floorNode}},{key:"canNotQueryFromSelector",get:function(){return!0}},{key:"isOutdoors",get:function(){return!0}}]),t}(Do),ko=function(){function e(t){n(this,e),this.app=t,this._style=null,this._id="",this._name="",this._queryID=THING.Math.generateUUID(),this._userData={},this._angles=[0,0,0],this._events={},this._tags=[],this._groups=[],this._children=new $t(this.app)}return e.prototype.isGroup=function(){return!0},e.prototype.setup=function(e){this._id=e.id||"",this._name=e.name||"",this._tags=e.tags||[]},e.prototype.destroy=function(){this.app.objectManager.destroy(this);var e=this;this._children.forEach((function(t){var i=t.groups.indexOf(e);for(var r in-1!==i&&t.groups.splice(i,1),e._events){var n=e._events[r];for(var o in n)t.off(o)}}))},e.prototype.destroyAll=function(){this.destroy(),this._children.destroyAll()},e.prototype.hasAttribute=function(e){return Et.hasAttribute(this,e)},e.prototype.getAttribute=function(e){return Et.getAttribute(this,e)},e.prototype.setAttribute=function(e,t){return Et.setAttribute(this,e,t)},e.prototype.setAttributes=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(var i in e=e||{})(t||Et.isUndefined(this[i]))&&this.setAttribute(i,e[i])},e.prototype.add=function(e){var t=this;if(e instanceof $t)e.forEach((function(e){t.add(e)}));else for(var i in this._children.add(e),-1===e.groups.indexOf(this)&&e.groups.push(this),this._children.forEach((function(e){e.groups.sort((function(e,t){return t.children.length-e.children.length}))})),this._events){var r=this._events[i];for(var n in r){var o=r[n];this.on(i,o.selector,o.userData,o.callback,null,o.priority)}}},e.prototype.remove=function(e){var t=this;if(e instanceof $t)e.forEach((function(e){t.remove(e)}));else{this._children.remove(e);var i=e.groups.indexOf(this);for(var r in-1!==i&&e.groups.splice(i,1),this._events){var n=this._events[r];for(var o in n){var s=n[o];this.off(r,s.selector,s.tag)}}}},e.prototype._transform=function(e){var t=new THREE.Group;t.position.copy(Et.parseVector3(this.position)),this.app.scene.add(t),t.updateMatrixWorld();for(var i=[],r=0;r<this._children.length;r++){var n=this._children[r];i.push(n.node.parent),n.node.attachToParent(t,this.app.scene)}e(t),t.updateWorldMatrix(!1,!1);for(r=0;r<this._children.length;r++){(n=this._children[r]).node.attachToParent(i[r],this.app.scene),n.static&&n.node._synMatrixWorld()}this.app.scene.remove(t)},e.prototype.translate=function(e){this._transform((function(t){t.translateX(e[0]),t.translateY(e[1]),t.translateZ(e[2])}))},e.prototype.translateX=function(e){this.translate([e,0,0])},e.prototype.translateY=function(e){this.translate([0,e,0])},e.prototype.translateZ=function(e){this.translate([0,0,e])},e.prototype.query=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=new $t(this.app,this._children);return i.select(e),t&&this._children.forEach((function(t){i.add(t.query(e))})),i},e.prototype._parseEvent=function(e,t,i,r,n){var o=Et.parseEvent(e,t,i,r,n);o._callback=o.callback;var s=this;return o.callback=function(e){o._callback&&o._callback.call(s,e)},o.tag=o.tag||"",o.tag+="_"+this._queryID,o},e.prototype._updateEvents=function(e){this._events[e.eventType]=this._events[e.eventType]||[],this._events[e.eventType][e.tag]=e},e.prototype._removeEvents=function(e){var t=this._events[e.eventType];t&&delete t[e.tag]},e.prototype.on=function(e,t,i,r,n,o){var s=this._parseEvent(t,i,r,n,o);return s.eventType=e,this._updateEvents(s),this.children.on(e,s.selector,s.userData,s.callback,s.tag,s.priority),this},e.prototype.off=function(e,t,i){var r=this._parseEvent(t,null,i);return r.eventType=e,this._removeEvents(r),this.children.off(e,r.selector,r.tag),this},e.prototype.one=function(e,t,i,r,n,o){var s=this._parseEvent(t,i,r,n,o);return s.eventType=e,this._updateEvents(s),this.children.one(e,s.selector,s.userData,s.callback,s.tag,s.priority),this},e.prototype._getAvgVector3=function(e){if(!this._children.length)return[0,0,0];var t=new THREE.Vector3;return this._children.forEach((function(i){var r=Et.parseVector3(i[e]);t.add(r)})),t.divideScalar(this._children.length),t.toArray()},o(e,[{key:"type",get:function(){return"Group"}},{key:"style",get:function(){return this._children.style}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"queryID",set:function(e){this._queryID=e},get:function(){return this._queryID}},{key:"userData",set:function(e){this._userData=e},get:function(){return this._userData}},{key:"tags",set:function(e){this._tags=e},get:function(){return this._tags}},{key:"groups",get:function(){return this._groups}},{key:"position",set:function(e){var t=Et.parseVector3(e),i=this;this._transform((function(e){e._setWorldPosition(t,i.app.root.static)}))},get:function(){return this._getAvgVector3("position")}},{key:"angles",set:function(e){var t=THING.Math.subVector(this._angles,e);this._angles=e;var i=Et.parseEuler(t);this._transform((function(e){e.quaternion.setFromEuler(i)}))},get:function(){return this._angles}},{key:"parents",get:function(){var e=new THING.Selector(this.app,[]);return this._children.forEach((function(t){e.add(t.parents)})),e}},{key:"children",get:function(){return this._children}},{key:"visible",set:function(e){this.children.visible=e}},{key:"pickable",set:function(e){this.children.pickable=e}},{key:"boundingBox",get:function(){for(var e=new THREE.Box3,t=0;t<this.children.length;t++){var i=this.children[t];e.union(i.box)}var r=new THREE.Vector3;e.getCenter(r);var n=new THREE.Vector3;e.getSize(n);var o=this;return{min:e.min.toArray(),max:e.max.toArray(),center:r.toArray(),size:n.toArray(),radius:n.length(),getWorldPosition:function(e){var t=Et.parseValue(e.yAngle,0),i=Et.parseValue(e.xAngle,0),r=Et.parseValue(e.distance||e.radius,n.length()),s=e.radiusFactor;s&&(r=n.length()*s);var a=(new THREE.Vector3).getDirectionFromAngles(t,i,r);return o.selfToWorld(a)}}}}]),e}(),Oo=function(){function e(t,i){n(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.outdoors=this.app.outdoors,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.campus=null,this.baseURL=null,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.loadSpeed=.1,this.isCamFitScene=!0,i&&(i.position&&(this.campusPosition=i.position),i.rotation&&(this.campusRotation=i.rotation),void 0!==i.isCamFitScene&&null!==i.isCamFitScene&&(this.isCamFitScene=i.isCamFitScene),void 0!==i.isDelayLoadFloorPlan&&null!==i.isDelayLoadFloorPlan&&(this.isDelayLoadFloorPlan=i.isDelayLoadFloorPlan),i.campus&&(this.campus=i.campus))}return e.prototype.load=function(e){var t=this;return this.baseURL=e,this.scene.add(this.worldNode),new Promise((function(e,i){t.loadSceneJson().then((function(i){t.parseObjects().then((function(){e(t.campus)}))})).then((function(){e(t.campus)})).catch((function(e){i(e)}))}))},e.prototype.loadSceneJson=function(){var e=this;return new Promise((function(t,i){new THREE.FileLoader(e.app.loadingManager).load(e.baseURL+"/scene.json",(function(i){var r=JSON.parse(i);e.sceneJsonData=r,t(r)}),(function(e){}),(function(e){i("cant not load file: scene.json")}))}))},e.prototype.parseObjects=function(){var e=this.sceneJsonData,t=this;return new Promise((function(i,r){t.parse(e).then((function(){t.sliceRootNodeArray=[],i()})).catch((function(e){r(e)}))}))},e.prototype.parse=function(e){var t=this;return new Promise((function(i,r){t.parseWorld(e),i()}))},e.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.app.scene.add(this.campus.node)),this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),e.outdoors&&this.parseOutdoors(e.outdoors,t),e.buildings){var i=e.buildings;for(var r in i){var n=i[r],o=new THREE.Vector3(0,0,0),s=r,a=void 0;n.name&&(s=n.name),n.id&&(a=n.id);var l=new THREE.Object3D,u=this.app.objectManager.create({type:"Building",name:s,id:a,parent:this.campus,node:l});if(u.app=this.app,u.node.position.x=o.x,u.node.position.y=o.y,u.node.position.z=o.z,n.plans&&this.parseFloorPlans(n.plans,u),n.facades){var c=n.facades;for(var h in c)this.createThing(c[h],u,"Facade")}if(n.facadegroups){var p=n.facadegroups;for(var d in p)n=p[d],this.createGroup(n,u,"Facade")}if(n.groups){p=n.groups;for(var d in p){n=p[d];this.createGroup(n,u)}}}}},e.prototype.parseOutdoors=function(e){var t=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:t}),this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors),this.processFloorPlanData(e,this.outdoors)},e.prototype.processFloorPlanData=function(e,t){t.app=this.app,e.placements&&this.parseThings(e.placements,t),e.videoprobes&&this.parseThings(e.videoprobes,t),e.groups&&this.parseGroups(e.groups,t),e.doororwindows&&this.parseDoorWins(e.doororwindows,t),e.rooms&&this.parseRooms(e.rooms,t)},e.prototype.parseRooms=function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=null;r.name&&(n=r.name);var o=new THREE.Object3D("room_temp"),s=null,a=r.properties;if(a)for(var l in s={},a){var u=a[l];s[l]=u}var c=null,h=null,p=null,d={};if(r.area&&(h=r.area,d.area=h),r.circumference&&(p=r.circumference,d.circumference=p),r.center){var f=r.center;(c=new THREE.Vector3).set(f[0],f[1],-f[2]),d.center=c}this.app.objectManager.create({type:"Room",name:n,node:o,id:undefined,parent:t,properties:s,auxiliaryInfo:d})}},e.prototype.parseDoorWins=function(e,t){new THREE.Group("doors");for(var i in e){var r=e[i],n=i,o=void 0;r.name&&(n=r.name),r.id&&(o=r.id);var s=new THREE.Object3D("doororwin_temp"),a=null;if(r.properties){var l=r.properties;for(var u in a={},l){var c=l[u];a[u]=c}}this.app.objectManager.create({type:"Door",name:n,node:s,id:o,parent:t,properties:a})}},e.prototype.parseGroups=function(e,t){for(var i in e){var r=e[i];(r.name||r.properties)&&this.createGroup(r,t)}},e.prototype.createGroup=function(e,t){var i,r,n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Thing",s=new THREE.Object3D("group_temp");e.id&&(i=e.id),e.name&&(r=e.name);var a=e.properties;if(a)for(var l in n={},a){var u=a[l];n[l]=u}var c=this.app.objectManager.create({type:o,name:r,id:i,node:s,parent:t,properties:n});return c},e.prototype.parseFloorPlans=function(e,t){var i=[];for(var r in e){var n=e[r],o=n.id,s="";n.name&&(s=n.name);var a=new THREE.Object3D,l=this.app.objectManager.create({type:"Floor",name:s,id:o,node:a,parent:t});a.name="floorPlan",t.node.add(l.node),this.processFloorPlanData(n,l),i.push(l)}return i},e.prototype.parseThings=function(e,t,i){for(var r in e){var n=e[r];(n.name||n.properties)&&this.createThing(n,t,i)}},e.prototype.createThing=function(e,t,i){var r,n,o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&(r=e.id),e.name&&(n=e.name);var a=e.properties;if(a)for(var l in o={},a){var u=a[l];o[l]=u}var c=new THREE.Object3D("temp_cannotuse"),h=this.app.objectManager.create({type:s,name:n,node:c,id:r,parent:t,properties:o});return h},e}(),Bo=function(){function e(t,i,r){n(this,e),this.app=t,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=i,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0;this.worldNode;if(i&&(i.position&&(this.campusPosition=i.position),i.rotation&&(this.campusRotation=i.rotation),void 0!==i.isCamFitScene&&null!==i.isCamFitScene&&(this.isCamFitScene=i.isCamFitScene),i.scale&&(this.campusScale=i.scale),void 0!==i.outdoorsVisible&&(this.outdoorsVisible=i.outdoorsVisible),void 0!==i.campusVisible&&(this.campusVisible=i.campusVisible),i.campus&&(this.campus=i.campus),void 0!==i.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=i.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),i&&i.default){var o=i.default;o.sceneJson&&(this.sceneJson="export.json"),o.wallTexture&&(this.defaultWallTextureUri=o.wallTexture),o.wallEdgeTexture&&(this.defaultWallEdgeTextureUri=o.wallEdgeTexture),o.floorTexture&&(this.defaultFloorTextureUri=o.floorTexture),o.ceilingTexture&&(this.defaultCeilingTextureUri=o.ceilingTexture),o.roofTexture&&(this.defaultRoofTextureUri=o.roofTexture)}r.loaderResourceUrl&&(this.resourceUrl=r.loaderResourceUrl),null!=this.app.options.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=this.app.options.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson&&this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary)}return e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var s=[Number(n[0]),Number(n[1]),Number(n[2])];s[2]=-s[2],this.app.camera.position=o,this.app.camera.target=s},e.prototype.exportJsonString=function(e){for(var t=e.outdoors,i=e.buildings,r=[],n=[],o=0;o<t.things.length;o++){var s=t.things[o];r.push({id:s.id,name:s.name})}for(o=0;o<t.rooms.length;o++){var a=t.rooms[o];n.push({id:a.id,name:a.name})}var l=[];for(o=0;o<i.length;o++){for(var u=i[o],c=[],h=0;h<u.floors.length;h++){for(var p=u.floors[h],d=[],f=[],m=0;m<p.things.length;m++){var g=p.things[m];d.push({id:g.id,name:g.name})}for(m=0;m<p.rooms.length;m++){a=p.rooms[m];f.push({id:a.id,name:a.name})}c.push({id:p.id,name:p.name,placements:d,rooms:f})}l.push({id:u.id,name:u.name,plans:c})}return{id:e.id,name:e.name,outdoors:{id:t.id,name:t.name,placements:r,rooms:n},buildings:l}},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node)}return this.relativeResourceUrl&&(this.resourceUrl=this.sceneURL+this.relativeResourceUrl),new Promise((function(e,i){t.updateProgress(.1),t.loadSceneJson().then((function(i){t.sceneJson=JSON.parse(i),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.15);var r=new json2mesh.UBuilderSceneSimpleLoader;t.resourceUrl&&(r.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",r.resourceManager.baseModelUrl=t.resourceUrl+"/model/"),r.load({json:t.sceneJson,customModeBaseUrl:t.sceneURL+"/"}).then((function(i){t.parseWorld(i),t.updateProgress(.2),t.updateProgress(1),e(t.campus)}))}))}))},e.prototype.loadSceneJson=function(){var e=this;return new Promise((function(t,i){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL.appendURL(e.sceneJsonUri),(function(e){t(e)}))}))},e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.createTextureLoaderPromise=function(e){var t=this;return new Promise((function(i,r){(new THREE.TextureLoader).load(t.sceneURL+"/"+e,(function(e){i(e)}),(function(t){THING.Utils.log(e+" "+t.loaded/t.total*100+"% loaded")}),(function(t){THING.Utils.log(e+"load error")}))}))},e.prototype.loadDefaultTexture=function(){var e=this;return new Promise((function(t,i){var r=e.createTextureLoaderPromise(e.defaultWallTextureUri),n=e.createTextureLoaderPromise(e.defaultWallEdgeTextureUri),o=e.createTextureLoaderPromise(e.defaultFloorTextureUri),s=e.createTextureLoaderPromise(e.defaultRoofTextureUri),a=e.createTextureLoaderPromise(e.defaultCeilingTextureUri);Promise.all([r,n,o,s,a]).then((function(e){DefaultResource.wallTexture=e[0],DefaultResource.wallEdgeTexture=e[1],DefaultResource.floorTexture=e[2],DefaultResource.ceilinngTexture=e[3],DefaultResource.roofTexture=e[4],t()}))}))},e.prototype.parseWorld=function(e){null===this.campus?(this.campus=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Campus",name:"Campus",node:this.worldNode}),this.campus.visible=this.campusVisible,this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)):(this.campus.uuid=e.id,e.userID&&(this.campus.id=e.userID));for(var t=0;t<e.buildings.length;t++){var i=e.buildings[t];this.parseBuilding(i)}if(e.outdoors){var r=new THREE.Object3D("outdoors");r.name="plan",this.outdoors=this.app.objectManager.create({uuid:e.outdoors.id,id:e.outdoors.userID,type:"Outdoors",name:e.outdoors.name,parent:this.campus,node:r}),this.outdoors.visible=this.outdoorsVisible,this.parseFloorPlan(e.outdoors,this.outdoors)}},e.prototype.parseBuilding=function(e){var t=new THREE.Object3D("building");t.name="building";var i=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Building",name:e.name,parent:this.campus,node:t,properties:e.properties});i.localPosition=e.position;for(var r=e.floorplans,n=e.facades,o=e.facadeGroups,s=0;s<n.length;s++){var a=n[s];this.app.objectManager.create({type:"Facade",id:a.userID,name:a.name,uuid:a.id,node:a.delayObject,parent:i,properties:a.properties})}for(s=0;s<o.length;s++)a=o[s],this.app.objectManager.create({type:"Facade",uuid:a.id,id:a.userID,name:a.name,node:a.delayObject,parent:i,properties:a.properties});for(var l=0;l<r.length;l++){var u=r[l],c=new THREE.Object3D("floorplan");c.name="plan";var h=this.app.objectManager.create({id:u.userID,uuid:u.id,type:"Floor",name:u.name,properties:u.properties,node:c,parent:i});h.localPosition=u.position,this.parseFloorPlan(u,h),0!==i.facades.length&&(h.visible=!1)}},e.prototype.placementInitCallback=function(e){this.app.objectManager.create({id:e.id,name:e.name,node:e.mesh,parent:plan,animations:e.resource.animations,properties:e.properties})},e.prototype.parseOutdoors=function(e){},e.prototype.parseFloorPlan=function(e,t){for(var i=0;i<e.walls.length;i++)for(var r=e.walls[i],n=0;n<r.doorOrWindows.length;n++){var o=r.doorOrWindows[n],s="Door";if(o.jsonData&&o.jsonData.type&&(s=o.jsonData.type),o.mesh){var a=this.app.objectManager.create({type:"Door",uuid:o.id,id:o.userID,name:o.name,node:o.delayObject,parent:t,animations:o.resource.animations,properties:o.properties});if(o.isOpen&&a.open(),a.animationClips)for(n=0;n<a.animationClips.length;n++){var l=a.animationClips[n];if("_defaultAnim_"===l.name){a.playAnimation({name:l.name,loop:!0,speed:.15});break}}}else o.initCompleteCallback=function(e){e.jsonData&&e.jsonData.type&&e.jsonData.type;var i=b.app.objectManager.create({type:"Door",uuid:e.id,id:e.userID,name:e.name,node:e.mesh,parent:t,animations:e.resource.animations,properties:e.properties});if(t.miscNode.add(i.node),e.isOpen&&i.open(),i.animationClips)for(var r=0;r<i.animationClips.length;r++){var n=i.animationClips[r];if("_defaultAnim_"===n.name){i.playAnimation({name:n.name,loop:!0,speed:.15});break}}}}var u=new THREE.Object3D("combineFloor");for(i=0;i<e.combineFloors.length;i++){var c=e.combineFloors[i];u.add(c)}t.node.add(u),t.floorNode=u;var h=new THREE.Object3D("combineCeiling");for(i=0;i<e.combineCeilings.length;i++){var p=e.combineCeilings[i];h.add(p)}t.node.add(h),t.ceilingNode=h;var d=new THREE.Object3D("combineRoof");for(i=0;i<e.combineRoofs.length;i++){var f=e.combineRoofs[i];d.add(f)}t.node.add(d),t.roofNode=d;var m=new THREE.Object3D("combinePlacement");for(i=0;i<e.combinePlacements.length;i++){var g=e.combinePlacements[i];m.add(g)}t.node.add(m),t.miscNode=m;for(var v=new THREE.Object3D("combineWall"),y=0;y<e.combineStraightManualWalls.length;y++){r=e.combineStraightManualWalls[y];v.add(r)}for(y=0;y<e.combineModelWalls.length;y++){r=e.combineModelWalls[y];v.add(r)}for(y=0;y<e.combineDoorOrWins.length;y++){g=e.combineDoorOrWins[y];v.add(g)}t.node.add(v),t.wallNode=v;for(i=0;i<e.groups.length;i++){g=e.groups[i],s="Thing";g.jsonData&&g.jsonData.type&&(s=g.jsonData.type);a=this.app.objectManager.create({uuid:g.id,id:g.userID,name:g.name,node:g.delayObject,belongRoomUserID:g.belongRoomUserID,type:s,parent:t,properties:g.properties})}var b=this;for(i=0;i<e.placements.length;i++){g=e.placements[i],s="Thing";if(g.jsonData&&g.jsonData.type&&(s=g.jsonData.type),g.mesh){if((a=this.app.objectManager.create({uuid:g.id,id:g.userID,name:g.name,type:s,belongRoomUserID:g.belongRoomUserID,node:g.delayObject,parent:t,url:g.resource.getModelUrl(),animations:g.resource.animations,properties:g.properties})).bundleID=g.resource.modelID,a.bundleName=g.resource.modelName,g.isPlayAnim&&a.containAnimation(g.animClip)){var _={name:g.animClip,loop:!1,speed:.15};g.hasSkin&&(_.loop=!0),a.playAnimation(_)}}else g.initCompleteCallback=function(e){s="Thing",e.jsonData&&e.jsonData.type&&(s=e.jsonData.type);var i=b.app.objectManager.create({uuid:e.id,id:e.userID,belongRoomUserID:e.belongRoomUserID,name:e.name,node:e.mesh,parent:t,type:s,url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});if(i.bundleID=e.resource.modelID,i.bundleName=e.resource.modelName,t.miscNode.add(i.node),e.isPlayAnim&&i.containAnimation(e.animClip)){var r={name:e.animClip,loop:!1,speed:.15};e.hasSkin&&(r.loop=!0),i.playAnimation(r)}}}for(i=0;i<e.videoprobes.length;i++){if((g=e.videoprobes[i]).mesh)a=this.app.objectManager.create({id:g.userID,name:g.name,uuid:g.id,belongRoomUserID:g.belongRoomUserID,node:g.delayObject,parent:t,url:g.resource.getModelUrl(),animations:g.resource.animations,properties:g.properties});else g.initCompleteCallback=function(e){var i=b.app.objectManager.create({id:e.userID,name:e.name,uuid:e.id,belongRoomUserID:e.belongRoomUserID,node:e.mesh,parent:t,url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});t.miscNode.add(i.node)}}for(i=0;i<e.rooms.length;i++){var x=e.rooms[i];c=this.app.objectManager.create({type:"Room",name:x.name,node:x.mesh,uuid:x.id,id:x.userID,ceilingNode:x.ceiling.mesh,roofNode:x.roof.mesh,floorNode:x.floor.mesh,parent:t,properties:x.properties})}for(i=0;i<e.curvelines.length;i++){var E=e.curvelines[i];this.parseCurveLines(E,t)}for(i=0;i<e.pipelines.length;i++){E=e.pipelines[i];this.parsePipeLines(E,t)}},e.prototype.parsePipeLines=function(e,t){var i={type:"PolygonLine",name:e.name,points:e.points,id:e.userID,uuid:e.id,parent:t,style:{}};e.color&&(i.style.color="#"+e.color.getHexString());var r=this;if(e.resource)e.initCompleteCallback=function(t){i.image=t.resource.getTextureUrl();var n=r.app.objectManager.create(i);n.node.position.set(e.position.x,e.position.y,e.position.z),e.sectionType&&"Triangle"===e.sectionType&&(n.pathRadialSegments=3,n._updateByPoints()),e.radius&&(n.width=e.radius)};else{var n=r.app.objectManager.create(i);n.node.position.set(e.position.x,e.position.y,e.position.z),e.sectionType&&"Triangle"===e.sectionType&&(n.pathRadialSegments=3,n._updateByPoints()),e.radius&&(n.width=e.radius)}},e.prototype.parseCurveLines=function(e,t){var i={type:"RouteLine",parent:t,name:e.name,uuid:e.id,id:e.userID,points:e.points,arrowFlag:!1,style:{}},r=this;if(e.color&&(i.style.color="#"+e.color.getHexString()),e.resource)e.initCompleteCallback=function(t){if(t.resource.texture){var n=t.resource.texture.clone();n.rotation=Math.PI/2,i.image=n}var o=r.app.objectManager.create(i);null!==e.width&&(o.width=e.width),o.node.position.set(e.position.x,e.position.y,e.position.z)};else{var n=r.app.objectManager.create(i);null!==e.width&&(n.width=e.width),n.node.position.set(e.position.x,e.position.y,e.position.z)}},e}();"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Fo(e,t){return e(t={exports:{}},t.exports),t.exports}var Lo=Fo((function(e){!function(t){var i=Object.prototype,r=i.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag",l=t.regeneratorRuntime;if(l)e.exports=l;else{(l=t.regeneratorRuntime=e.exports).wrap=f;var u={},c={};c[o]=function(){return this};var h=Object.getPrototypeOf,p=h&&h(h(M([])));p&&p!==i&&r.call(p,o)&&(c=p);var d=y.prototype=g.prototype=Object.create(c);v.prototype=d.constructor=y,y.constructor=v,y[a]=v.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(d),e},l.awrap=function(e){return{__await:e}},b(_.prototype),_.prototype[s]=function(){return this},l.AsyncIterator=_,l.async=function(e,t,i,r){var n=new _(f(e,t,i,r));return l.isGeneratorFunction(t)?n:n.next().then((function(e){return e.done?e.value:n.next()}))},b(d),d[a]="Generator",d[o]=function(){return this},d.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var r=t.pop();if(r in e)return i.value=r,i.done=!1,i}return i.done=!0,i}},l.values=M,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=undefined)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,r){return s.type="throw",s.arg=e,t.next=i,r&&(t.method="next",t.arg=undefined),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var a=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(a&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),w(i),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;w(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:M(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=undefined),u}}}function f(e,t,i,r){var n=t&&t.prototype instanceof g?t:g,o=Object.create(n.prototype),s=new T(r||[]);return o._invoke=function(e,t,i){var r="suspendedStart";return function(n,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw o;return C()}for(i.method=n,i.arg=o;;){var s=i.delegate;if(s){var a=x(s,i);if(a){if(a===u)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var l=m(e,t,i);if("normal"===l.type){if(r=i.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r="completed",i.method="throw",i.arg=l.arg)}}}(e,i,s),o}function m(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}function g(){}function v(){}function y(){}function b(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function _(e){var t;this._invoke=function(i,n){function o(){return new Promise((function(t,o){!function t(i,n,o,s){var a=m(e[i],e,n);if("throw"!==a.type){var l=a.arg,u=l.value;return u&&"object"==typeof u&&r.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,o,s)}),(function(e){t("throw",e,o,s)})):Promise.resolve(u).then((function(e){l.value=e,o(l)}),s)}s(a.arg)}(i,n,t,o)}))}return t=t?t.then(o,o):o()}}function x(e,t){var i=e.iterator[t.method];if(undefined===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=undefined,x(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=m(i,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var n=r.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,u):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function M(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(r.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=undefined,t.done=!0,t};return n.next=n}}return{next:C}}function C(){return{value:undefined,done:!0}}}(function(){return this}()||Function("return this")())})),Io=function(){return this}()||Function("return this")(),No=Io.regeneratorRuntime&&Object.getOwnPropertyNames(Io).indexOf("regeneratorRuntime")>=0,Uo=No&&Io.regeneratorRuntime;Io.regeneratorRuntime=void 0;var zo=Lo;if(No)Io.regeneratorRuntime=Uo;else try{delete Io.regeneratorRuntime}catch(y){Io.regeneratorRuntime=void 0}var Ho=zo,Vo=function e(t,i,r,o){n(this,e),this.positionArray=t.geometry.getAttribute("position").array.slice();var s=t.geometry.getAttribute("normal");s?this.normalArray=s.array.slice():THING.Utils.warn("not has normal");var a=t.geometry.getAttribute("uv");a&&(this.uvArray=a.array);var l=t.geometry.getAttribute("uv2");l&&(this.uv2Array=l.array);var u=t.geometry.getAttribute("color");u&&(this.colorArray=u.array),this.indexArray=t.geometry.index.array,this.material=t.material;for(var c=this.positionArray,h=this.normalArray,p=0;p<c.length;){for(var d=o.length-1;d>-1;d--){var f=i[d],m=r[d],g=o[d];c[p]*=f.x,c[p+1]*=f.y,c[p+2]*=f.z;var v=new THREE.Vector3(c[p],c[p+1],c[p+2]);if((v=v.applyQuaternion(m)).x+=g.x,v.y+=g.y,v.z+=g.z,c[p]=v.x,c[p+1]=v.y,c[p+2]=v.z,h){var y=new THREE.Vector3(h[p],h[p+1],h[p+2]);y=y.applyQuaternion(m),h[p]=y.x,h[p+1]=y.y,h[p+2]=y.z}}p+=3}this.vertexCount=this.positionArray.length/3,this.indexCount=this.indexArray.length},Wo=function(){function e(t){n(this,e),this.bundeObj=t,this.materialMap=new Map,this.combineBundleMeshs=[]}return e.prototype.combine=function(){this._combine(this.bundeObj,[],[],[])},e.prototype._combine=function(e,t,i,r){if(t.push(e.scale),r.push(e.position),i.push(e.quaternion),e instanceof THREE.Mesh){var n=new Vo(e,t,i,r);0!==n.vertexCount&&(this.combineBundleMeshs.push(n),void 0===this.materialMap.get(n.material)&&this.materialMap.set(n.material,[]),this.materialMap.get(n.material).push(n))}if(0!==e.children.length)for(var o=0;o<e.children.length;o++){var s=i.slice(),a=t.slice(),l=r.slice();this._combine(e.children[o],a,s,l)}},e}(),Go=function e(){n(this,e),this.positions=[],this.scales=[],this.quaternions=[]},qo=function(){function e(t){n(this,e),this.vertexCount=0,this.indexCount=0,this.material=t,this.bundeMeshs=[],this.transformations=[],this.maxCount=65534,this.combineMesh=null}return e.prototype.isExceed=function(e){return this.vertexCount+e>this.maxCount},e.prototype.add=function(e,t){if(this.isExceed(e.vertexCount))return THING.Utils.error("combine exceed vertex count "),!1;this.vertexCount+=e.vertexCount,this.indexCount+=e.indexCount,this.bundeMeshs.push(e),this.transformations.push(t)},e.prototype.build=function(){for(var e=this.bundeMeshs,t=this.indexCount,i=this.vertexCount,r=new Float32Array(3*i),n=new Float32Array(3*i),o=new Float32Array(2*i),s=new Float32Array(4*i),a=new Float32Array(2*i),l=new Uint16Array(t),u=0,c=0,h=0,p=0,d=0,f=new THREE.BufferGeometry,m=0;m<e.length;m++){for(var g=e[m],v=this.transformations[m],y=v.positions,b=v.scales,_=v.quaternions,x=g.indexArray,E=0;E<x.length;E++)l[E+p]=u/3+x[E];p+=x.length;var w=g.positionArray;for(E=0;E<w.length;){for(var T=new THREE.Vector3(w[E],w[E+1],w[E+2]),M=y.length-1;M>-1;M--){var C=y[M],S=b[M],j=_[M];T.x*=S.x,T.y*=S.y,T.z*=S.z,(T=T.applyQuaternion(j)).x+=C.x,T.y+=C.y,T.z+=C.z}r[E+u]=T.x,r[E+u+1]=T.y,r[E+u+2]=T.z,E+=3}u+=w.length;var P=g.normalArray;for(E=0;E<P.length;){var R=new THREE.Vector3(P[E],P[E+1],P[E+2]);for(M=_.length-1;M>-1;M--){j=_[M];R=R.applyQuaternion(j)}n[E+c]=R.x,n[E+c+1]=R.y,n[E+c+2]=R.z,E+=3}c+=P.length;var D=g.uvArray;if(D)for(E=0;E<D.length;E++)o[E+h]=D[E];var A=g.uv2Array;if(A)for(E=0;E<A.length;E++)a[E+h]=A[E];D&&(h+=D.length);var k=g.colorArray;if(k){for(E=0;E<k.length;E++)s[E+d]=k[E];d+=k.length}}f.addAttribute("position",new THREE.BufferAttribute(r,3)),f.addAttribute("normal",new THREE.BufferAttribute(n,3)),f.addAttribute("uv",new THREE.BufferAttribute(o,2)),0!==a.length&&f.addAttribute("uv2",new THREE.BufferAttribute(a,2)),0!==s.length&&f.addAttribute("color",new THREE.BufferAttribute(s,4)),f.setIndex(new THREE.BufferAttribute(l,1));var O=new THREE.Mesh(f,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,O.name="combine",this.combineMesh=O},e}(),Xo=function(){function e(t){n(this,e),this.app=t,this.combineBundleObjectMap={},this.processorMap=new Map,this.floorMaterialMap=new Map,this.processors=[]}return e.prototype.combineModels=function(){var e=this.app.modelResource.models,t=[],i=this;for(var r in e)t.push(new Promise((function(t,n){var o=performance.now(),s=new Wo(e[r].node);i.combineBundleObjectMap[r]=s,s.combine(),performance.now()-o>.1?setTimeout((function(){t()}),10):t()})));return Promise.all(t)},e.prototype.getModelObject=function(e){var t=this.combineBundleObjectMap[e];return t||null},e.prototype.addPlacement=function(e,t,i,r,n){var o=this.floorMaterialMap.get(e);o||(o=new Map,this.floorMaterialMap.set(e,o));var s=this.processorMap.get(e);s||(this.processorMap.set(e,[]),s=this.processorMap.get(e));var a=new Go;a.positions=i,a.scales=r,a.quaternions=n,this.combineBundleObjectMap[t].materialMap.forEach((function(e,t,i){for(var r=e,n=t,l=0;l<r.length;l++){var u=r[l],c=o.get(n);c&&!c.isExceed(u.vertexCount)||(c=new qo(n),o.set(n,c),s.push(c)),c.add(u,a)}}))},e.prototype.getCombineProcessors=function(e,t,i,r){var n=[],o=new Map;for(var s in e){var a=e[s];if(!a.uid&&!a.name){var l=this.app.modelResource.bundleIDArray[a.bIdx],u=(this.app.modelResource.get(l).node,new THREE.Vector3(0,0,0)),c=new Go;if(a.pos){var h=a.pos.split(" ");u.x=parseFloat(h[0]),u.y=parseFloat(h[1]),u.z=-parseFloat(h[2])}var p=new THREE.Vector3(1,1,1);if(a.scl){var d=a.scl.split(" ");p.x=parseFloat(d[0]),p.y=parseFloat(d[1]),p.z=parseFloat(d[2])}var f=new THREE.Quaternion(0,0,0,1);if(a.rot){var m=a.rot.split(" ");f.x=parseFloat(m[0]),f.y=parseFloat(m[1]),f.z=-parseFloat(m[2]),f.w=-parseFloat(m[3])}var g=t.slice(),v=i.slice(),y=r.slice();y.push(f),v.push(p),g.push(u),c.positions=g,c.scales=v,c.quaternions=y,this.combineBundleObjectMap[l].materialMap.forEach((function(e,t,i){for(var r=e,s=t,a=0;a<r.length;a++){var l=r[a],u=o.get(s);u&&!u.isExceed(l.vertexCount)||(u=new qo(s),o.set(s,u),n.push(u)),u.add(l,c)}}))}}return n},e}(),Jo=function(){function e(t){n(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.app.scene.add(this.worldNode),this.baseURL=t.sceneURL,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.combineManager=new Xo(this.app),this.combineProcessorMap=new Map,this.loadSpeed=.1}return e.prototype.load=function(){var e=this;return new Promise((function(t,i){e.loadSceneJson().then((function(t){return t.camInfo&&(e.parseCamInfo(t.camInfo),e.app.camera.update()),e.sceneJsonData=JSON.parse(t),e.loadStructureJson()})).then((function(t){var i=e.getSortedStructureGLTFs(t);return new Promise((function(t,r){e.loadStructure(i,(function(){e.parseObjects().then((function(){t(e.worldNode)}))}))}))})).then((function(){t(e.worldNode)})).catch((function(e){i(e)}))}))},e.prototype.loadSceneJson=function(e){var t=this;return e&&(t.sceneURL=e),new Promise((function(e,i){t.sceneJsonData?e(t.sceneJsonData):new THREE.FileLoader(t.app.loadingManager).load(t.sceneURL.appendURL(t.sceneJsonUri),(function(t){e(t)}))}))},e.prototype.loadStructureJson=function(){var e=this;return new Promise((function(t,i){(new THREE.FileLoader).load(e.baseURL+"/structure.json",(function(e){var i=JSON.parse(e);t(i)}),(function(){}),(function(e){i("cant not load file: structure.json")}))}))},e.prototype.loadStructure=function(e,t,i){this.splitLoadedGLTFCount=0;var r=this,n=0;if(0==e.length)t&&t();else for(var o=r.curLoadGLTFIndex;o<e.length&&(0==n||n%10!=0);o++){n++,r.curLoadGLTFIndex++;var s=new THREE.GLTFLoader(r.app.loadingManager);s.setCrossOrigin("anonymous"),s.load(r.baseURL+"/"+e[o].path,(function(n){var o=n.scene.children[0].children[0];r.nodes[o.name]=o,r.sliceRootNodeArray.push(o),o.traverse((function(e){r.nodes[e.name]=e})),r.splitLoadedGLTFCount++,r.allLoadedGLTFCount++,10===r.splitLoadedGLTFCount&&r.loadStructure(e,t,i),r.app.scene.add(o),r.allLoadedGLTFCount==e.length&&t&&t()}),(function(){}),(function(t){i&&i("load "+r.baseURL+"/"+e[o].path+" failed")}))}},e.prototype.parseObjects=function(){var e=this.sceneJsonData,t=this;return e.bIdList?new Promise((function(i,r){t.parseBundleList(e.bIdList).then((function(){return t.parse(e)})).then((function(){t.sliceRootNodeArray=[],i()})).catch((function(e){r(e)}))})):new Promise((function(i,r){t.parse(e).then((function(){t.sliceRootNodeArray=[],i()})).catch((function(e){r(e)}))}))},e.prototype.getSortedStructureGLTFs=function(e){var t=[],i=[],r=[],n=e.outdoors,o=e.buildings;for(var s in n){var a=n[s];t.push(a)}for(var l=0;l<t.length;l++){var u=t[l];if(0!=i.length)for(var c=0;c<i.length;c++){var h=i[c];if(u.size<h.size){i.splice(c,0,u);break}if(c==i.length-1){i.push(u);break}}else i.push(t[l])}for(var s in t=[],o)t.push(o[s]);for(l=0;l<t.length;l++){u=t[l];if(0!=r.length)for(c=0;c<r.length;c++){h=r[c];if(u.size<h.size){r.splice(c,0,u);break}if(c==r.length-1){r.push(u);break}}else r.push(t[l])}return i.concat(r)},e.prototype._nestingLoopYield=function(e,t,i){var r=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done;o instanceof Promise?o.then((function(n){return r._nestingLoopYield(e,t,i)})).catch((function(e){i(e)})):this._nestingLoopYield(e,t,i)},e.prototype.parse=function(e){var t=this;return this.combineManager.combineModels().then((function(){return new Promise((function(i,r){if(e.objects){var n=e.objects,o=null;for(var s in n){o=n[s];break}t._nestingLoopYield(t.parseWorld(o),(function(){i()}))}if(e.camInfo){var a=e.camInfo;t.parseCamInfo(a)}}))}))},e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var s=[Number(n[0]),Number(n[1]),Number(n[2])];s[2]=-s[2],this.app.camera.position=o,this.app.camera.target=s},e.prototype.parseWorld=function(e){var t=Ho.mark(v),i=this.worldNode;if(e.plan&&this.parseOutdoors(e.plan,i),e.bds){var r=e.bds;for(var n in r){var o=r[n],s=new THREE.Vector3(0,0,0);if(o.pos){var a=o.pos.split(" ");s.x=parseFloat(a[0]),s.y=parseFloat(a[1]),s.z=-parseFloat(a[2])}var l=new THREE.Object3D,u=this.app.objectManager.create({type:"Building",name:n,node:l});if(u.name=n,u.app=this.app,u.id=n,i.add(l),o.plans)this.parseFloorPlans(o.plans,u);if(o.facades){var c=o.facades;for(var h in c){var p=this.createThing(c[h],u,null,"Facade"),d=p.node.position;d.x+=s.x,d.y+=s.y,d.z+=s.z,p.node.position.set(d.x,d.y,d.z)}}if(o.groups){var f=o.groups;for(var m in f){o=f[m];this.createGroup(o,u)}}}}var g=this;function v(e){var i,r,n,o,s,a,l,u,c;return Ho.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=g.loadSpeed,r=10,n=e.keys(),o=Array.isArray(n),s=0,n=o?n:n[Symbol.iterator]();case 3:if(!o){t.next=9;break}if(!(s>=n.length)){t.next=6;break}return t.abrupt("break",24);case 6:a=n[s++],t.next=13;break;case 9:if(!(s=n.next()).done){t.next=12;break}return t.abrupt("break",24);case 12:a=s.value;case 13:l=a,u=e.get(l),c=0;case 16:if(!(c<u.length)){t.next=22;break}return t.next=19,new Promise((function(e,t){var n=performance.now();u[c].build();var o=u[c].combineMesh;l.node.add(o),performance.now()-n>i?setTimeout((function(){e()}),r):e()}));case 19:c++,t.next=16;break;case 22:t.next=3;break;case 24:case"end":return t.stop()}}),t,this)}return v(this.combineProcessorMap)},e.prototype.parseOutdoors=function(e,t){var i,r;for(var n in e){r=e[n],i=n;break}var o=this.app.outdoors;this.worldNode.add(o.node),this.processFloorPlanData(i,r,o)},e.prototype.processFloorPlanData=function(e,t,i){i.name=e,i.app=this.app,i.id=e;var r=new THREE.Vector3(0,0,0);if(t.pos){var n=t.pos.split(" ");r.x=parseFloat(n[0]),r.y=parseFloat(n[1]),r.z=-parseFloat(n[2])}var o=t.cwalls;if(o){var s=new THREE.Group;for(var a in s.name="combinewall",o){var l=o[a].gltfid,u=this.nodes[l];u&&s.add(u)}i.node.add(s),s.updateMatrixWorld(),i.wallNode=s}var c=t.croofs;if(c){var h=new THREE.Group;for(var a in h.name="combineroof",c){l=c[a].gltfid;var p=this.nodes[l];p&&h.add(p)}i.node.add(h),i.roofNode=h}var d=t.cceilings;if(d){var f=new THREE.Group;for(var a in f.name="combineceiling",d){l=d[a].gltfid;var m=this.nodes[l];m&&f.add(m)}i.node.add(f),i.ceilNode=f}if(v=t.cfloors){var g=new THREE.Group;for(var a in g.name="combinefloor",v){var v;if(l=(v=v[a]).gltfid){var y=this.nodes[l];y&&g.add(y)}}i.node.add(g),i.floorNode=g}var b=new THREE.Group;b.name="combinePlacement",i.miscNode=b,i.node.add(b);var _=t.cplcs;if(_)for(var a in _){l=_[a].gltfid;var x=this.nodes[l];x&&(b.add(x),x.updateMatrixWorld())}if(t.plcs){var E=this.combineManager.getCombineProcessors(t.plcs,[r],[new THREE.Vector3(1,1,1)],[new THREE.Quaternion(0,0,0,1)]);this.combineProcessorMap.set(i,E),this.parseThings(t.plcs,i,r)}t.routes&&this.parseStructureThing(t.routes,i),t.pipelines&&this.parseStructureThing(t.pipelines,i),t.curvelines&&this.parseStructureThing(t.curvelines,i),t.arrowlines&&this.parseStructureThing(t.arrowlines,i),t.arrowdatalines&&this.parseStructureThing(t.arrowdatalines,i),t.leakwaterlines&&this.parseStructureThing(t.leakwaterlines,i),t.vps&&this.parseThings(t.vps,i,r),t.groups&&this.parseGroups(t.groups,i,[new THREE.Vector3(1,1,1)],[new THREE.Quaternion(0,0,0,1)],[r],r),t.dws&&this.parseDoorWins(t.dws,i,r)},e.prototype.parseDoorWins=function(e,t,i){for(var r in e){var n=e[r],o=r;n.uid&&(o=n.uid);var s=null;if(n.gltfid){var a=n.gltfid;this.nodes[a]&&((s=this.nodes[a]).position.x+=i.x,s.position.y+=i.y,s.position.z+=i.z,t.node.add(s))}var l=null;if(n.prop){var u=n.prop;for(var c in l={},u){var h=u[c];l[c]=h}}this.app.objectManager.create({type:"Door",name:o,node:s,parent:t,properties:l})}},e.prototype.parseGroups=function(e,t,i,r,n,o){for(var s in e){var a=e[s];a.uid?this.createGroup(a,t):this.combineGroup(a,t,i,r,n,o)}},e.prototype.createGroup=function(e,t){var i,r,n=this.instanceGroup(e);e.id&&e.id,e.uid&&(i=e.uid);var o=e.prop;if(o)for(var s in r={},o){var a=o[s];r[s]=a}return this.app.objectManager.create({type:"Thing",name:i,node:n,parent:t,properties:r})},e.prototype.parseFloorPlans=function(e,t){var i=[];for(var r in e){var n=e[r],o=new THREE.Object3D,s=this.app.objectManager.create({type:"Floor",name:r,node:o,parent:t});s.id=r,o.name="floorPlan",t.node.add(s.node),this.processFloorPlanData(r,n,s),s._parent=t,i.push(s)}return i},e.prototype.parseBundleList=function(e){this.app.modelResource.bundleIDArray=e;var t=0,i=this;return new Promise((function(r,n){0!=e.length?e.forEach((function(o){var s=new THREE.GLTFLoader(i.app.loadingManager);s.setCrossOrigin("anonymous"),s.load(i.baseURL+"/"+o+"/scene.gltf",(function(n){t++,i.app.modelResource.set(o,n.scene.children[0].children[0]),t==e.length&&r()}),(function(){}),(function(e){n("can not load "+i.baseURL+"/"+o+"/scene.gltf")}))})):r()}))},e.prototype.combineGroup=function(e,t,i,r,n,o){var s=e,a=new THREE.Vector3(0,0,0);if(s.pos){var l=s.pos.split(" ");a.x=parseFloat(l[0]),a.y=parseFloat(l[1]),a.z=-parseFloat(l[2])}var u=new THREE.Vector3(1,1,1);if(s.scl){var c=s.scl.split(" ");u.x=parseFloat(c[0]),u.y=parseFloat(c[1]),u.z=parseFloat(c[2])}var h,p,d,f=new THREE.Quaternion(0,0,0,1);if(s.rot){c=s.rot.split(" ");f.x=parseFloat(c[0]),f.y=parseFloat(c[1]),f.z=-parseFloat(c[2]),f.w=-parseFloat(c[3])}if(n?(h=i.slice(),d=r.slice(),p=n.slice()):(h=[],p=[],d=[]),h.push(u),p.push(a),d.push(f),s.plcs){var m=this.combineManager.getCombineProcessors(s.plcs,p,h,d),g=this.combineProcessorMap.get(t);g&&(m=g.concat(m)),this.combineProcessorMap.set(t,m)}if(s.groups)for(var v in s.groups)this.combineGroup(s.groups[v],t,h,d,p,o)},e.prototype.instanceGroup=function(e){var t=new THREE.Vector3(0,0,0);if(e.pos){var i=e.pos.split(" ");t.x=parseFloat(i[0]),t.y=parseFloat(i[1]),t.z=-parseFloat(i[2])}var r=new THREE.Vector3(1,1,1);if(e.scl){var n=e.scl.split(" ");r.x=parseFloat(n[0]),r.y=parseFloat(n[1]),r.z=parseFloat(n[2])}var o=new THREE.Quaternion(0,0,0,1);if(e.rot){n=e.rot.split(" ");o.x=parseFloat(n[0]),o.y=parseFloat(n[1]),o.z=-parseFloat(n[2]),o.w=-parseFloat(n[3])}var s=new THREE.Group;if(e.plcs)for(var a in e.plcs){var l=this.instanceChildOfGroup(e.plcs[a]);s.add(l)}if(e.groups)for(var a in e.groups){l=this.instanceGroup(e.plcs[a]);s.add(l)}return s.scale.copy(r),s.setRotationFromQuaternion(o),s.position.copy(t),s},e.prototype.instanceChildOfGroup=function(e){var t=this.app.modelResource.bundleIDArray[e.bIdx],i=this.app.modelResource.get(t).node.clone();if(e.pos){var r=e.pos.split(" ");i.position.x=parseFloat(r[0]),i.position.y=parseFloat(r[1]),i.position.z=-parseFloat(r[2])}if(e.rot){r=e.rot.split(" ");var n=new THREE.Quaternion;n.x=parseFloat(r[0]),n.y=parseFloat(r[1]),n.z=-parseFloat(r[2]),n.w=-parseFloat(r[3]),i.setRotationFromQuaternion(n)}return i},e.prototype.parseThings=function(e,t,i){for(var r in e){var n=e[r];(n.uid||n.prop)&&this.createThing(n,t,i)}},e.prototype.createThing=function(e,t,i){var r,n,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&e.id,e.uid&&(r=e.uid);var s=e.prop;if(s)for(var a in n={},s){var l=s[a];n[a]=l}var u=this.app.modelResource.bundleIDArray[e.bIdx],c=this.app.modelResource.get(u).node,h=c.clone();if(e.pos){var p=e.pos.split(" "),d=new THREE.Vector3(parseFloat(p[0]),parseFloat(p[1]),-parseFloat(p[2]));i&&(d.x+=i.x,d.y+=i.y,d.z+=i.z),h.position.x=d.x,h.position.y=d.y,h.position.z=d.z}if(e.rot){p=e.rot.split(" ");var f=new THREE.Quaternion;f.x=parseFloat(p[0]),f.y=parseFloat(p[1]),f.z=-parseFloat(p[2]),f.w=-parseFloat(p[3]),h.setRotationFromQuaternion(f)}if(e.scl){p=e.scl.split(" ");var m=new THREE.Vector3;m.x=parseFloat(p[0]),m.y=parseFloat(p[1]),m.z=-parseFloat(p[2]),h.scale.x=m.x,h.scale.y=m.y,h.scale.z=m.z}var g=this.app.objectManager.create({type:o,name:r,node:h,parent:t,properties:n});return g},e.prototype.parseStructureThing=function(e,t,i){for(var r in e){var n=e[r];if(n.gltfid){var o=new Gi(this.app);o.name=r,o.app=this.app,n.id&&(o.id=n.id),n.uid&&(o.name=n.uid);var s=n.gltfid;if(this.nodes[s]){var a=this.nodes[s];o.node=a,t.add(o),i&&(a.position.x=i.x,a.position.y=i.y,a.position.z=i.z)}}}},e}(),Yo=function(){function e(t,i){n(this,e),this.app=t,this.nodes=[],this.outdoors=this.app.outdoors,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.worldNode.name="world",this.campus=null,this.baseURL=null,this.sceneJsonUri="scene.json",this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.combineManager=new Xo(this.app),this.loadSpeed=.1,this.isCamFitScene=!0,this.loadStageWeight=[.1,.1,.3,.5],this.loadedProgress=0,this.curStageLoadProgress=0,this.isDelayLoadFloorPlan=!1,this.envMap=null,this.appFirstTimeLoad=!1,this.outdoors?this.appFirstTimeLoad=!1:this.appFirstTimeLoad=!0,i&&(i.position&&(this.campusPosition=i.position),i.rotation&&(this.campusRotation=i.rotation),void 0!==i.isCamFitScene&&null!==i.isCamFitScene&&(this.isCamFitScene=i.isCamFitScene),void 0!==i.isDelayLoadFloorPlan&&null!==i.isDelayLoadFloorPlan&&(this.isDelayLoadFloorPlan=i.isDelayLoadFloorPlan),i.campus&&(this.campus=i.campus));var r=this.worldNode;null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:r}),this.app.scene.add(this.campus.node)),this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.scene=this.campus.node}return e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.loadSkybox=function(){if(this.sceneJsonData.skybox){for(var e=this.sceneJsonData.skybox,t=0;t<e.length;t++){var i=e[t];i=this.baseURL+i,e[t]=i}var r=this;return new Promise((function(t,i){(new THREE.CubeTextureLoader).load(e,(function(e){e.flipY=!0,r.envMap=e,t()}),null,(function(){THING.Utils.warn("load skybox fail"),t()}))}))}return new Promise((function(e,t){e()}))},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.baseURL=e;else if("Object"===e.constructor.name){var i=e;this.baseURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node)}return new Promise((function(e,i){t.loadSceneJson().then((function(e){return e.camInfo&&t.isCamFitScene&&t.parseCamInfo(e.camInfo),t.sceneJsonData=JSON.parse(e),t.updateProgress(.1),t.loadSkybox().then((function(){return t.loadStructureJson()}))})).then((function(e){t.updateProgress(.2);var i=t.getSortedStructureGLTFs(e);return new Promise((function(e,r){t.updateProgress(.3),t.loadStructure(i,(function(){t.updateProgress(.7),t.parseObjects().then((function(){t.updateProgress(.8),e(t.campus)}))}))}))})).then((function(){t.updateProgress(1),e(t.campus)})).catch((function(e){i(e)}))}))},e.prototype.loadSceneJson=function(e){var t=this;return e&&(t.sceneURL=e),new Promise((function(e,i){t.sceneJsonData?e(t.sceneJsonData):new THREE.FileLoader(t.app.loadingManager).load(t.sceneURL.appendURL(t.sceneJsonUri),(function(t){e(t)}))}))},e.prototype.loadStructureJson=function(){var e=this;return new Promise((function(t,i){(new THREE.FileLoader).load(e.baseURL+"/structure.json",(function(e){var i=JSON.parse(e);t(i)}),(function(){}),(function(e){i("cant not load file: structure.json")}))}))},e.prototype.addEnvMap=function(e){var t=this;this.envMap&&e.traverse((function(e){e.material&&(e.material.opacity<1&&!e.material.transparent&&(e.material.transparent=!0,e.material.needsUpdate=!0),e.material.transparent&&(e.material.metalness=1,e.material.roughness=0,e.material.envMap=t.envMap,e.material.envMapIntensity=2,e.material.refractionRatio=1,e.material.needsUpdate=!0),e.material.isMeshStandardMaterial&&(e.material.envMap=t.envMap,e.material.envMapIntensity=1,e.material.refractionRatio=1,e.material.needsUpdate=!0))}))},e.prototype.loadStructure=function(e,t,i){this.splitLoadedGLTFCount=0;var r=this,n=0;if(0==e.length)t&&t();else for(var o=r.curLoadGLTFIndex;o<e.length&&(0==n||n%10!=0);o++){n++,r.curLoadGLTFIndex++;var s=new thingjs.GLTFLoader;s.setCrossOrigin("anonymous");var a=e[o];s.load(r.baseURL+"/"+a.path,(function(n){var o=n.scene.children[0].children[0];r.nodes[o.name]=o,r.sliceRootNodeArray.push(o),o.traverse((function(e){r.nodes[e.name]=e})),r.splitLoadedGLTFCount++,r.allLoadedGLTFCount++,10===r.splitLoadedGLTFCount&&r.loadStructure(e,t,i),(void 0===a.show||a.show)&&r.scene.add(o),r.addEnvMap(o),o.updateMatrixWorld(),r.scene.updateMatrixWorld(!0),r.allLoadedGLTFCount==e.length&&t&&t()}),(function(){}),(function(t){i?i("load "+r.baseURL+"/"+e[o].path+" failed"):THING.Utils.error("load "+r.baseURL+"/"+a.path+" failed"),THING.Utils.error(t)}))}},e.prototype.parseObjects=function(){var e=this.sceneJsonData,t=this;return e.models?new Promise((function(i,r){t.parseBundleList(e.models).then((function(){return t.parse(e)})).then((function(){t.sliceRootNodeArray=[],i()})).catch((function(e){r(e)}))})):new Promise((function(i,r){t.parse(e).then((function(){t.sliceRootNodeArray=[],i()})).catch((function(e){r(e)}))}))},e.prototype.getSortedStructureGLTFs=function(e){var t=[],i=[],r=[],n=e.outdoors,o=e.buildings;for(var s in n){var a=n[s];t.push(a)}for(var l=0;l<t.length;l++){var u=t[l];if(0!=i.length)for(var c=0;c<i.length;c++){var h=i[c];if(u.size<h.size){i.splice(c,0,u);break}if(c==i.length-1){i.push(u);break}}else i.push(t[l])}for(var s in t=[],o)t.push(o[s]);for(l=0;l<t.length;l++){u=t[l];if(0!=r.length)for(c=0;c<r.length;c++){h=r[c];if(u.size<h.size){r.splice(c,0,u);break}if(c==r.length-1){r.push(u);break}}else r.push(t[l])}return i.concat(r)},e.prototype._nestingLoopYield=function(e,t,i){var r=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done;o instanceof Promise?o.then((function(n){return r._nestingLoopYield(e,t,i)})).catch((function(e){i(e)})):this._nestingLoopYield(e,t,i)},e.prototype.parse=function(e){var t=this;return this.combineManager.combineModels().then((function(){return new Promise((function(i,r){var n=t.parseWorld(e);if(n?t._nestingLoopYield(n,(function(){i()}),(function(e){r(e)})):i(),e.camInfo&&t.isCamFitScene){var o=e.camInfo;t.parseCamInfo(o)}}))}))},e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var s=[Number(n[0]),Number(n[1]),Number(n[2])];s[2]=-s[2],this.app.camera.position=o,this.app.camera.target=s},e.prototype.parseWorld=function(e){var t=Ho.mark(x);if(e.outdoors&&this.parseOutdoors(e.outdoors),e.buildings){var i=e.buildings;for(var r in i){var n=i[r],o=new THREE.Vector3(0,0,0),s=r,a=void 0;n.id&&(a=n.id),n.name&&(s=n.name);var l=n.properties,u=null;if(l)for(var c in u={},l){var h=l[c];u[c]=h}if(n.position){var p=n.position;o.x=p[0],o.y=p[1],o.z=-p[2]}var d=new THREE.Object3D,f=this.app.objectManager.create({type:"Building",name:s,id:a,properties:u,parent:this.campus,node:d});if(f.app=this.app,f.node.position.x=o.x,f.node.position.y=o.y,f.node.position.z=o.z,n.facades){var m=n.facades;for(var g in m)this.createThing(m[g],f,null,"Facade")}if(n.facadegroups){var v=n.facadegroups;for(var y in v){var b=v[y];this.createGroup(b,f,"Facade")}}if(n.plans)this.parseFloorPlans(n.plans,f)}}var _=this;function x(e){var i,r,n,o,s,a,l,u,c;return Ho.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=_.loadSpeed,r=10,n=e.keys(),o=Array.isArray(n),s=0,n=o?n:n[Symbol.iterator]();case 3:if(!o){t.next=9;break}if(!(s>=n.length)){t.next=6;break}return t.abrupt("break",24);case 6:a=n[s++],t.next=13;break;case 9:if(!(s=n.next()).done){t.next=12;break}return t.abrupt("break",24);case 12:a=s.value;case 13:l=a,u=e.get(l),c=0;case 16:if(!(c<u.length)){t.next=22;break}return t.next=19,new Promise((function(e,t){var n=performance.now();u[c].build();var o=u[c].combineMesh;l.miscNode.add(o),performance.now()-n>i?setTimeout((function(){e()}),r):e()}));case 19:c++,t.next=16;break;case 22:t.next=3;break;case 24:case"end":return t.stop()}}),t,this)}if(this.isDelayLoadFloorPlan){var E=new Map,w=this.combineManager.processorMap.get(this.outdoors);w&&E.set(this.outdoors,w);var T=this.combineManager.processorMap.keys(),M=Array.isArray(T),C=0;for(T=M?T:T[Symbol.iterator]();;){var S;if(M){if(C>=T.length)break;S=T[C++]}else{if((C=T.next()).done)break;S=C.value}var j=S;j!=this.outdoors&&(j.isLoaded=!1)}return x(E)}return x(this.combineManager.processorMap)},e.prototype.parseOutdoors=function(e){var t=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:t}),this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors),this.processFloorPlanData(e,this.outdoors)},e.prototype.processFloorPlanData=function(e,t){t.app=this.app;var i=new THREE.Vector3(0,0,0);if(e.position){var r=e.position;i.x=r[0],i.y=r[1],i.z=-r[2]}t.node.position.x=i.x,t.node.position.y=i.y,t.node.position.z=i.z,t.node.updateMatrixWorld(),t.node.updateMatrix(),this.parseStructure(e,t),e.placements&&(this.parseCombineProcessors(t,e.placements,[],[],[]),this.parseThings(e.placements,t,i)),e.videoprobes&&this.parseThings(e.videoprobes,t,i),e.groups&&this.parseGroups(e.groups,t,[],[],[],i),e.doororwindows&&this.parseDoorWins(e.doororwindows,t,i),e.rooms&&this.parseRooms(e.rooms,t),e.routes&&this.parseStructureThing(e.routes,t),e.pipelines&&this.parseStructureThing(e.pipelines,t),e.curvelines&&this.parseStructureThing(e.curvelines,t),e.arrowlines&&this.parseStructureThing(e.arrowlines,t),e.arrowdatalines&&this.parseStructureThing(e.arrowdatalines,t),e.leakwaterlines&&this.parseStructureThing(e.leakwaterlines,t)},e.prototype.parseRooms=function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=null;r.name&&(n=r.name),e.id&&e.id;var o=null,s=r.gltfid;s&&this.nodes[s]&&(o=this.nodes[s]);var a=null,l=r.properties;if(l)for(var u in a={},l){var c=l[u];a[u]=c}var h=null,p=null,d=null;r.floor&&(s=r.floor.gltfid,this.nodes[s]&&(d=this.nodes[s])),r.ceiling&&(s=r.ceiling.gltfid,this.nodes[s]&&(h=this.nodes[s])),r.roof&&(s=r.roof.gltfid,this.nodes[s]&&(p=this.nodes[s]));var f=r.isShown;if(f){var m="false"!==(f=f.toLowerCase());o.visible=m}var g=null,v=null,y=null,b={};if(r.area&&(v=r.area,b.area=v),r.circumference&&(y=r.circumference,b.circumference=y),r.center){var _=r.center;(g=new THREE.Vector3).set(_[0],_[1],-_[2]),b.center=g}this.app.objectManager.create({type:"Room",name:n,node:o,ceilingNode:h,roofNode:p,floorNode:d,parent:t,properties:a,auxiliaryInfo:b})}},e.prototype.parseCombineProcessors=function(e,t,i,r,n){for(var o in t){var s=t[o];if(!s.name&&!s.properties){var a=this.app.modelResource.bundleIDArray[s.model].uri;a||(a=this.app.modelResource.bundleIDArray[s.model].id);var l=new THREE.Vector3(0,0,0);if(s.position){var u=s.position;l.x=u[0],l.y=u[1],l.z=-u[2]}var c=new THREE.Vector3(1,1,1);if(s.scale){var h=s.scale;c.x=h[0],c.y=h[1],c.z=h[2]}var p=new THREE.Quaternion(0,0,0,1);if(s.rotation){var d=s.rotation;p.x=d[0],p.y=d[1],p.z=-d[2],p.w=-d[3]}var f=i.slice(),m=r.slice(),g=n.slice();g.push(p),m.push(c),f.push(l),this.combineManager.addPlacement(e,a,f,m,g)}}},e.prototype.parseStructure=function(e,t){t.node.updateMatrixWorld();var i=t.node.position,r=new THREE.Vector3;t.parent&&!t.isOutdoors&&(r=t.parent.node.position);var n=new THREE.Vector3(r.x+i.x,r.y+i.y,r.z+i.z);if(e.structure){var o=(e=e.structure).walls;if(o){var s=new THREE.Group;for(var a in s.name="structurnWall",o){var l=o[a].gltfid,u=this.nodes[l];u.traverse((function(e){e.material&&(e.material.defines=e.material.defines||{},e.material.defines.WALL_AO=!0,e.material.metalness=.2,e.material.roughness=.8,e.material.needsUpdate=!0)})),u&&s.add(u)}t.node.add(s),s.position.set(-n.x,-n.y,-n.z),t.wallNode=s}var c=e.roofs;if(c){var h=new THREE.Group;for(var a in h.name="structurnRoof",c){l=c[a].gltfid;var p=this.nodes[l];p&&h.add(p)}t.node.add(h),h.position.set(-n.x,-n.y,-n.z),t.roofNode=h}var d=e.ceilings;if(d){var f=new THREE.Group;for(var a in f.name="structureCeiling",d){l=d[a].gltfid;var m=this.nodes[l];m&&f.add(m)}t.node.add(f),f.position.set(-n.x,-n.y,-n.z),t.ceilNode=f}if(v=e.floors){var g=new THREE.Group;for(var a in g.name="structureFloor",v){var v;if(l=(v=v[a]).gltfid){var y=this.nodes[l];y.traverse((function(e){e.material&&(e.material.roughness=.9,e.material.needsUpdate=!0)})),y&&g.add(y)}}t.node.add(g),g.position.set(-n.x,-n.y,-n.z),t.floorNode=g}var b=new THREE.Group;b.name="structurePlacement",t.miscNode=b,t.node.add(b),t.floorNode||(t.floorNode=b),b.updateMatrixWorld(),b.updateMatrix(),b.position.set(0,0,0);var _=e.placements;if(_)for(var a in _){l=_[a].gltfid;var x=this.nodes[l];x&&b.add(x)}e.routes&&this.parseStructureThing(e.routes,t),e.pipelines&&this.parseStructureThing(e.pipelines,t),e.curvelines&&this.parseStructureThing(e.curvelines,t),e.arrowlines&&this.parseStructureThing(e.arrowlines,t),e.arrowdatalines&&this.parseStructureThing(e.arrowdatalines,t),e.leakwaterlines&&this.parseStructureThing(e.leakwaterlines,t)}},e.prototype.parseDoorWins=function(e,t,i){new THREE.Group("doors");for(var r in e){var n=e[r],o=r;n.name&&(o=n.name);var s=null;if(n.gltfid){var a=n.gltfid;this.nodes[a]&&(s=this.nodes[a],t.node.add(s))}var l=null;if(n.properties){var u=n.properties;for(var c in l={},u){var h=u[c];l[c]=h}}this.app.objectManager.create({type:"Door",name:o,node:s,parent:t,properties:l})}},e.prototype.parseGroups=function(e,t,i,r,n,o){for(var s in e){var a=e[s];a.name||a.properties?this.createGroup(a,t):this.combineGroup(a,t,i,r,n,o)}},e.prototype.createGroup=function(e,t){var i,r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Thing",o=this.instanceGroup(e);e.id&&e.id,e.name&&(i=e.name);var s=e.properties;if(s)for(var a in r={},s){var l=s[a];r[a]=l}var u=this.app.objectManager.create({type:n,name:i,node:o,parent:t,properties:r});return u},e.prototype.parseFloorPlans=function(e,t){for(var i=[],r=0;r<e.length;r++){var n=e[r],o=n.id,s="";n.name&&(s=n.name);var a=new THREE.Object3D,l=this.app.objectManager.create({type:"Floor",name:s,id:o,node:a,parent:t});a.name="floorPlan",0!=t.facades.length&&(l.node.visible=!1),t.node.add(l.node),t.node.updateMatrixWorld(),t.node.updateMatrix(),this.processFloorPlanData(n,l),i.push(l)}return i},e.prototype.parseBundleList=function(e){this.app.modelResource.bundleIDArray=e;var t=0,i=this;return new Promise((function(r,n){0!==e.length?e.forEach((function(o){if(u=o.uri){var s=new thingjs.GLTFLoader;s.setCrossOrigin("anonymous"),s.load(i.baseURL+"/"+u,(function(n){t++;var o=null;-1!==n.asset.generator.indexOf("Unity")?(o=n.scene.children[0].children[0],i.app.modelResource.set(u,o,n.animations)):(o=n.scene.children[0],i.app.modelResource.set(u,o,n.animations)),i.addEnvMap(o),t===e.length&&r()}),(function(){}),(function(e){n("can not load "+i.baseURL+"/"+u)}))}else{var a=o.id,l=o.version,u="http://model.3dmomoda.com/models/"+a+"/"+l+"/gltf/",c=new THREE.FileLoader;c.setResponseType("json"),c.load(u+"index.json",(function(o){var s=o.gltfFiles[0],l=new thingjs.GLTFLoader;l.setCrossOrigin("anonymous"),l.load(u+s,(function(n){t++,i.app.modelResource.set(a,n.scene.children[0],n.animations),t===e.length&&r()}),(function(){}),(function(e){n("can not load "+i.baseURL+"/"+u)}))}))}})):r()}))},e.prototype.combineGroup=function(e,t,i,r,n,o){var s=e,a=new THREE.Vector3(0,0,0);if(s.position){var l=s.position;a.x=l[0],a.y=l[1],a.z=-l[2]}var u=new THREE.Vector3(1,1,1);if(s.scale){var c=s.scale;u.x=c[0],u.y=c[1],u.z=c[2]}var h,p=new THREE.Quaternion(0,0,0,1);if(s.rotation){var c=s.rotation;p.x=c[0],p.y=c[1],p.z=-c[2],p.w=-c[3]}if(n?(h=i.slice(),c=r.slice(),l=n.slice()):(h=[],l=[],c=[]),h.push(u),l.push(a),c.push(p),s.placements&&this.parseCombineProcessors(t,s.placements,l,h,c),s.groups)for(var d in s.groups)this.combineGroup(s.groups[d],t,h,c,l,o)},e.prototype.instanceGroup=function(e){var t=new THREE.Vector3(0,0,0);if(e.position){var i=e.position;t.x=i[0],t.y=i[1],t.z=-i[2]}var r=new THREE.Vector3(1,1,1);if(e.scale){var n=e.scale;r.x=n[0],r.y=n[1],r.z=n[2]}var o=new THREE.Quaternion(0,0,0,1);if(e.rotation){n=e.rotation;o.x=n[0],o.y=n[1],o.z=-n[2],o.w=-n[3]}var s=new THREE.Group;if(e.placements)for(var a in e.placements){var l=this.instanceChildOfGroup(e.placements[a]);s.add(l)}if(e.groups)for(var a in e.groups){l=this.instanceGroup(e.groups[a]);s.add(l)}return s.scale.copy(r),s.setRotationFromQuaternion(o),s.position.copy(t),s},e.prototype.instanceChildOfGroup=function(e){var t=this.app.modelResource.bundleIDArray[e.model].uri;t||(t=this.app.modelResource.bundleIDArray[e.model].id);var i=this.app.modelResource.get(t).node.clone();if(e.scale){var r=e.scale;i.scale.x=r[0],i.scale.y=r[1],i.scale.z=r[2]}if(e.rotation){r=e.rotation;var n=new THREE.Quaternion;n.x=r[0],n.y=r[1],n.z=-r[2],n.w=-r[3],i.setRotationFromQuaternion(n)}if(e.position){r=e.position;i.position.x=r[0],i.position.y=r[1],i.position.z=-r[2]}return i},e.prototype.parseThings=function(e,t,i){for(var r in e){var n=e[r];(n.name||n.properties||n.type)&&this.createThing(n,t,i)}},e.prototype.createThing=function(e,t,i){var r,n,o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&(r=e.id);var a=e.type||s;e.name&&(n=e.name);var l=e.properties;if(l)for(var u in o={},l){var c=l[u];o[u]=c}var h=this.app.modelResource.bundleIDArray[e.model].uri;h||(h=this.app.modelResource.bundleIDArray[e.model].id);var p=this.app.modelResource.get(h).node,d=p.clone(),f=this.app.modelResource.get(h).animations;if(e.position){var m=e.position,g=new THREE.Vector3(m[0],m[1],-m[2]);d.position.x=g.x,d.position.y=g.y,d.position.z=g.z}if(e.rotation){var v=e.rotation,y=new THREE.Quaternion;y.x=v[0],y.y=v[1],y.z=-v[2],y.w=-v[3],d.setRotationFromQuaternion(y)}if(e.scale){var b=e.scale,_=new THREE.Vector3;_.x=b[0],_.y=b[1],_.z=b[2],d.scale.x=_.x,d.scale.y=_.y,d.scale.z=_.z}var x=e.isShown;if(x){var E="false"!==(x=x.toLowerCase());d.visible=E}var w=this.app.objectManager.create({type:a,id:r,name:n,node:d,parent:t,animations:f,properties:o});return w},e.prototype.parseStructureThing=function(e,t,i){for(var r in e){var n=e[r];if(n.gltfid){var o=new Gi(this.app);o.name=r,o.app=this.app,n.id&&(o.id=n.id),n.name&&(o.name=n.name);var s=n.gltfid;if(this.nodes[s]){var a=this.nodes[s];t.node.add(a),o.node=a,t.add(o),i&&(a.position.x=i.x,a.position.y=i.y,a.position.z=i.z)}}}},e.prototype.delayLoadFloorPlan=function(e){var t=Ho.mark(r),i=this;function r(r){var n,o,s;return Ho.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=i.loadSpeed,o=10,s=0;case 3:if(!(s<r.length)){t.next=9;break}return t.next=6,new Promise((function(t,i){var a=performance.now();r[s].build();var l=r[s].combineMesh;e.miscNode.add(l),performance.now()-a>n?setTimeout((function(){t()}),o):t()}));case 6:s++,t.next=3;break;case 9:case"end":return t.stop()}}),t,this)}var n=null,o=null;return e.isLoaded||(n=this.combineManager.processorMap.get(e),o=r(n)),new Promise((function(t,r){o?i._nestingLoopYield(o,(function(){e.isLoaded=!0,t()}),(function(e){r(e)})):e.isLoaded?THING.Utils.warn("floorplan "+e.id+" has been loaded!"):r()}))},e}(),Zo=function(e){function t(i,r){return n(this,t),a(this,e.call(this,i,r))}return s(t,e),t.prototype.parseDoorWins=function(e,t,i){new THREE.Group("doors");for(var r in e){var n=e[r];n.type||(n.type="Door"),this.createThing(n,t,i)}},t}(Yo),Qo=function(){function e(t){n(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.rootNode=null,this.campus=null,this.sceneURL=null,this.sceneJsonData=null,this.loadedSceneGLTF=null,this.worldNode=new THREE.Object3D,this.fitCamInfo=null}return e.prototype.parse=function(e){for(var t in e)if("objects"==t){var i=e.objects;for(var r in i){var n=i[r];this.parseWorld(n);break}}else if("camInfo"==t){var o=e[t];this.fitCamInfo=o}else THING.Utils.log("unkown other parser: "+t)},e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var s=[Number(n[0]),Number(n[1]),Number(n[2])];s[2]=-s[2],this.app.camera.position=o,this.app.camera.target=s},e.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.campus.node.name="campus",this.app.scene.add(this.campus.node)),e.plan&&this.parseOutdoors(e.plan),e.bds){var i=e.bds;this.parseBuildings(i)}},e.prototype.parseOutdoors=function(e){var t=null;for(var i in e){t=e[i];break}var r=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:r});var n=this.outdoors,o=t.gltfid;if(o&&this.nodes[o]){var s=this.nodes[o];THREE.SceneUtils.detach(s,s.parent,this.app.scene),THREE.SceneUtils.attach(s,this.app.scene,n.node),n.node.updateMatrixWorld()}this.parseFloorPlan(t,n)},e.prototype.parseBuildings=function(e){for(var t in e){var i=e[t],r=null;if(i.gltfid){var n=i.gltfid;this.nodes[n]&&(r=this.nodes[n])}var o=this.app.objectManager.create({type:"Building",name:t,parent:this.campus,node:r});i.plans&&this.parseFloorPlans(i.plans,o),i.facades&&this.parseFacades(i.facades,o)}},e.prototype.parseFloorPlans=function(e,t){for(var i in e){var r=null,n=e[i],o=n.gltfid;o&&this.nodes[o]&&(r=this.nodes[o]);var s=this.app.objectManager.create({type:"Floor",name:i,node:r,parent:t});this.parseFloorPlan(n,s)}},e.prototype.parseFloorPlan=function(e,t){e.plcs&&this.parseThings(e.plcs,t),e.vps&&this.parseThings(e.vps,t),e.dws&&this.parseDoorWins(e.dws,t),e.routes&&this.parseThings(e.routes,t),e.pipelines&&this.parseThings(e.pipelines,t),e.curvelines&&this.parseThings(e.curvelines,t),e.arrowlines&&this.parseThings(e.arrowlines,t),e.arrowdatalines&&this.parseThings(e.arrowdatalines,t),e.leakwaterlines&&this.parseThings(e.leakwaterlines,t);var i=e.cplcs;if(i)for(var r in i){var n=i[r].gltfid,o=this.nodes[n];if(o){t.miscNode=o.parent;break}}var s=e.cwalls;if(s)for(var r in s){n=s[r].gltfid;var a=this.nodes[n];if(a){t.wallNode=a.parent;break}}var l=e.croofs;if(l)for(var r in l){n=l[r].gltfid;var u=this.nodes[n];if(u){t.roofNode=u.parent;break}}var c=e.cceilings;if(c)for(var r in c){n=c[r].gltfid;var h=this.nodes[n];if(h){t.ceilingNode=h.parent;break}}if(p=e.cfloors)for(var r in p){var p;if(n=(p=p[r]).gltfid){var d=this.nodes[n];if(d){t.floorNode=d.parent;break}}}var f=e.groups;f&&this.parseGroup(f,t)},e.prototype.parseGroup=function(e,t){for(var i in e){var r=e[i],n=i;r.uid&&(n=r.uid);var o=r.type||"Thing",s=null,a=r.gltfid;a&&this.nodes[a]&&(s=this.nodes[a]);var l=null,u=r.prop;if(u)for(var c in l={},u){var h=u[c];l[c]=h}this.app.objectManager.create({type:o,name:n,node:s,parent:t,properties:l}),r.plcs&&this.parseThings(r.plcs,t)}},e.prototype.parseFacades=function(e,t){for(var i in e){var r=e[i],n=i;r.uid&&(n=r.uid);var o=null,s=r.gltfid;s&&this.nodes[s]&&(o=this.nodes[s]);var a=null,l=r.prop;if(l)for(var u in a={},l){var c=l[u];a[u]=c}var h=r.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Facade",name:n,node:o,parent:t,properties:a});t.node.add(o)}},e.prototype.parseThings=function(e,t){for(var i in e){var r=e[i],n=i;r.uid&&(n=r.uid);var o=null,s=r.gltfid;s&&this.nodes[s]&&(o=this.nodes[s]);var a=null,l=r.prop;if(l)for(var u in a={},l){var c=l[u];a[u]=c}var h=r.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Thing",name:n,node:o,parent:t,properties:a})}},e.prototype.parseDoorWins=function(e,t){for(var i in e){var r=e[i],n=i;r.uid&&(n=r.uid);var o=null;if(r.gltfid){var s=r.gltfid;this.nodes[s]&&(o=this.nodes[s])}var a=null;if(r.prop){var l=r.prop;for(var u in a={},l){var c=l[u];a[u]=c}}this.app.objectManager.create({type:"Door",name:n,node:o,parent:t,properties:a})}},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node)}return new Promise((function(e,i){t.loadGLTF().then((function(e){return t.loadedSceneGLTF=e,e.scene.traverse((function(e){t.nodes[e.name]=e})),t.parseSceneJson()})).then((function(i){t.fitCamInfo?t.parseCamInfo(t.fitCamInfo):t.campus.node&&t.app.camera.fit(t.campus),e(t.campus)})).catch((function(){t.campus.node.add(t.loadedSceneGLTF.scene.children[0]),t.campus&&t.app.camera.fit(t.campus),e(t.campus)}))}))},e.prototype.loadGLTF=function(){var e=this;return new Promise((function(t,i){var r=new THREE.GLTFLoader(e.app.loadingManager);r.setCrossOrigin("anonymous"),r.load(e.sceneURL+"/Unity2GLTF.gltf",(function(e){t(e)}))}))},e.prototype.parseSceneJson=function(){var e=this;return new Promise((function(t,i){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/scene.json",(function(i){var r=JSON.parse(i);for(var n in e.sceneJsonData=r,r)if("objects"==n){var o=r.objects;for(var s in o){var a=o[s];e.parseWorld(a);break}}else if("camInfo"==n){var l=r[n];e.fitCamInfo=l}else THING.Utils.log("unkown other parser: "+n);t(r)}),(function(){}),(function(){THING.Utils.error("not find file scene.json "),i()}))}))},e}(),Ko="FacadeMain",$o="Ground",es="Thing",ts="Tree",is="Objects",rs="FloorFloor",ns="FloorRoof",os="FloorCeiling",ss="FloorManualWall",as="Door";function ls(){}ls.addThingJsObjectSfStyle=function(e,t){if(e){var i=e.properties;i&&i._styleTag_&&(t=i._styleTag_),t&&ls.addNodeSfStyle(e.mesh,t)}},ls.addJson2meshObjectSfStyle=function(e,t){if(e){var i=e.properties;i&&i._styleTag_&&(t=i._styleTag_),t&&ls.addNodeSfStyle(e.mesh,t)}},ls.addPlacementGroupSfStyle=function(e,t){var i=e.placements;if(i)for(var r=0;r<i.length;r++){var n=i[r],o=n.resource.modelID,s=es;this.isTree(o)?s=ts:this.isWall(o)&&(s="Outdoors"===t?$o:ss),ls.addJson2meshObjectSfStyle(n,s)}var a=e.groups;if(a)for(var l=0;l<a.length;l++){var u=a[l];this.addPlacementGroupSfStyle(u)}},ls.addNodeSfStyle=function(e,t){if(e){var i=ls.getMeshes(e);i&&i.length>0&&i.forEach((function(e){e._sfStyle=t}))}},ls.addBatchCombinePlacementStyle=function(e,t,i){var r=null,n=t.properties;n?n._styleTag_&&(r=n._styleTag_):r="Outdoors"===t.parent.type?ls.isTree(i)?ts:ls.isWall(i)?$o:is:ls.isTree(i)?ts:ls.isWall(i)?ss:is,ls.addNodeSfStyle(e.node,r)},ls.addBatchPlacementStyle=function(e,t,i){var r=null,n=t.properties;n?n._styleTag_&&(r=n._styleTag_):r="Outdoors"===t.parent.type?ls.isTree(i)?ts:ls.isWall(i)?$o:es:ls.isTree(i)?ts:ls.isWall(i)?ss:es,ls.addNodeSfStyle(e.node,r)},ls.getMeshes=function(e){var t=[];return e.traverse((function(e){e.isMesh&&t.push(e)})),t},ls.isWall=function(e){return!!us[e]},ls.isTree=function(e){return!!cs[e]};var us={BC4ACD398A9640859A6B386E1BF9231D:{id:"BC4ACD398A9640859A6B386E1BF9231D",type:"Wall",size:[.8,2.999,.8],version:"5"},"25DFE916055244849463F89A03DA97CD":{id:"25DFE916055244849463F89A03DA97CD",type:"Wall",size:[.845,3.099,.849],version:"5"}},cs={"3629A959F80C4D0EA31D1E26524735B8":{id:"3629A959F80C4D0EA31D1E26524735B8",type:"Placement",size:[8.1,9.60776,8.7],version:"7"},BB23ED379CFB4A0AB14BD124EC2995BE:{id:"BB23ED379CFB4A0AB14BD124EC2995BE",type:"Placement",size:[.64347,1.34912,.8],version:"7"},A7D96546FA744C38A949DFC6FEE43B6A:{id:"A7D96546FA744C38A949DFC6FEE43B6A",type:"Placement",size:[.6,1.1,.6],version:"7"},FA5766D2AA074128ABB5D4CA3FF45B36:{id:"FA5766D2AA074128ABB5D4CA3FF45B36",type:"Placement",size:[.4,.61599,.39999],version:"6"},"8EC4FF7178E64C538B215D69684E4F92":{id:"8EC4FF7178E64C538B215D69684E4F92",type:"Placement",size:[.4,.5,.4],version:"6"},"449c02c5e8f84a2aa32f58ed53aa24b9":{id:"449c02c5e8f84a2aa32f58ed53aa24b9",type:"Placement",size:[.23118,.5986,.24155],version:"1"},c26acc8a9f804d8da2f49aba46283ac3:{id:"c26acc8a9f804d8da2f49aba46283ac3",type:"Placement",size:[7.85544,7.80654,7.44832],version:"2"},"07b2d180e1ea42de98723fe147f6750a":{id:"07b2d180e1ea42de98723fe147f6750a",type:"Placement",size:[10.3207,9.84333,10.0598],version:"3"},"2c969242db5f4da58442182ccbda7471":{id:"2c969242db5f4da58442182ccbda7471",type:"Placement",size:[7.20139,25.1363,6.56474],version:"4"},D26DB25C34C94CAABF24FED40F1A9719:{id:"D26DB25C34C94CAABF24FED40F1A9719",type:"Placement",size:[8.24071,19.2,7.6],version:"6"},"ebafecf0-cc89-42dc-b847-0f841a31bdca":{id:"ebafecf0-cc89-42dc-b847-0f841a31bdca",type:"Placement",size:[4.94077,5.83847,4.78861],version:"9"},"4EF86FC4FFA44013AC4F45E8CD0D343F":{id:"4EF86FC4FFA44013AC4F45E8CD0D343F",type:"Placement",size:[5.66699,7.4,6.233],version:"6"},"9C27FD900C4443FBA1151C9DF767D19A":{id:"9C27FD900C4443FBA1151C9DF767D19A",type:"Placement",size:[7.50716,8.2,7.87936],version:"6"},"6b768c2d-3c2f-4954-a625-ef4b57f72a47":{id:"6b768c2d-3c2f-4954-a625-ef4b57f72a47",type:"Placement",size:[6.32989,7.49752,5.72546],version:"8"},"9fc66d5b-a213-4fc6-9fc6-f759aa88716a":{id:"9fc66d5b-a213-4fc6-9fc6-f759aa88716a",type:"Placement",size:[4.5,9.4,4.4],version:"4"},"963de658-70b6-49e7-bb0e-504ad603fe27":{id:"963de658-70b6-49e7-bb0e-504ad603fe27",type:"Placement",size:[1.4073,4.03187,1.37224],version:"5"},"d5b06cf7-2a31-4252-8d7c-02d48815ed18":{id:"d5b06cf7-2a31-4252-8d7c-02d48815ed18",type:"Placement",size:[7.3,7.4,6.1],version:"4"},"f9058709-ee84-41f6-8260-fbb734dc9483":{id:"f9058709-ee84-41f6-8260-fbb734dc9483",type:"Placement",size:[4.3,7.2,4],version:"4"},"be7d0bfc-ce60-4132-8a88-afd1301c82b3":{id:"be7d0bfc-ce60-4132-8a88-afd1301c82b3",type:"Placement",size:[4.41539,7.57112,4.49063],version:"5"},"95bd04fe237f42e0adeabb78028c8ee7":{id:"95bd04fe237f42e0adeabb78028c8ee7",type:"Placement",size:[4.41539,7.57112,4.49063],version:"1"},"1d2827ffd12b4ac1a2035fa81646a450":{id:"1d2827ffd12b4ac1a2035fa81646a450",type:"Placement",size:[12.63521,15.81749,13.21056],version:"3"}},hs=function(){function e(){n(this,e),this.world=null,this.styleTable={outdoors:{},buildings:{}}}return e.prototype.clear=function(){this.world=null,this.styleTable={outdoors:{},buildings:{}}},e.prototype.parseWorld=function(e){this._parseObject(e)},e.prototype._parseObject=function(e){if(e.registerBuildCallbackListener(this.objectBuildedCallback,{loader:this}),e.isContainer)for(var t=0;t<e.children.length;t++){var i=e.children[t];this._parseObject(i)}},e.prototype.objectBuildedCallback=function(e,t){var i=t.loader;"Facade"===e.type||"FacadeGroup"===e.type?i.facadeBuildCallback(e,t):"Placement"===e.type||"PlacementGround"===e.type?i.placementBuildCallback(e,t):"DoorOrWindow"===e.type?i.doorOrWindowBuildCallback(e,t):"VideoProbe"===e.type?i.videoProbeBuildCallback(e,t):"Room"===e.type?i.roomBuildCallback(e,t):"PlacementGroup"===e.type?i.groupBuildCallback(e,t):-1!==e.type.indexOf("Combine")&&i.combinedObjectBuildCallback(e,t)},e.prototype.parseBuilding=function(e){this.parseFacades(e);for(var t=e.floorplans,i=0;i<t.length;i++){var r=t[i];this.parseFloorPlan(r)}},e.prototype.parseFacades=function(e){for(var t=e.facades,i=e.facadeGroups,r=0;r<t.length;r++){t[r].registerBuildCallbackListener(this.facadeBuildCallback,{loader:this})}for(var n=0;n<i.length;n++){i[n].registerBuildCallbackListener(this.facadeBuildCallback,{loader:this})}},e.prototype.facadeBuildCallback=function(e,t){t.loader;var i=void 0,r=e.properties;r&&(i=r._styleTag_);var n=ls.getMeshes(e.mesh);n&&n.length>0&&n.forEach((function(e){e._sfStyle=i||Ko}))},e.prototype.parseFloorPlan=function(e){this.parseDoorOrWindows(e),this.parseCombineFloors(e),this.parseCombineCeilings(e),this.parseCombineRoofs(e),this.parseCombinePlacements(e),this.parseCombineStraightManualWalls(e),this.parseCombineModelWalls(e),this.parseCombineDoorOrWindows(e),this.parseGroups(e),this.parsePlacements(e),this.parseRooms(e),this.parseVideoProbes(e),this.parsePlacementGround(e),this.parseCombinePlacementWalls(e)},e.prototype.parsePlacementGround=function(e){for(var t=0;t<e.placementGrounds.length;t++){e.placementGrounds[t].registerBuildCallbackListener(this.placementBuildCallback,{loader:this})}},e.prototype.parseCombineFloors=function(e){for(var t=0;t<e.combineFloorObjects.length;t++){var i=e.combineFloorObjects[t];this.registerCombineObjectBuildCallback(i,"CombineFloor")}},e.prototype.parseCombineCeilings=function(e){for(var t=0;t<e.combineCeilingObjects.length;t++){var i=e.combineCeilingObjects[t];this.registerCombineObjectBuildCallback(i,"CombineCeiling")}},e.prototype.parseCombineRoofs=function(e){for(var t=0;t<e.combineRoofObjects.length;t++){var i=e.combineRoofObjects[t];this.registerCombineObjectBuildCallback(i,"CombineRoof")}},e.prototype.parseCombinePlacements=function(e){for(var t=0;t<e.combinePlacementObjects.length;t++){var i=e.combinePlacementObjects[t];this.registerCombineObjectBuildCallback(i,"CombinePlacement")}},e.prototype.parseCombineStraightManualWalls=function(e){for(var t=0;t<e.combineStraightManualWallObjects.length;t++){var i=e.combineStraightManualWallObjects[t];this.registerCombineObjectBuildCallback(i,"CombineStraightManualWall")}},e.prototype.parseCombineModelWalls=function(e){for(var t=0;t<e.combineModelWallObjects.length;t++){var i=e.combineModelWallObjects[t];this.registerCombineObjectBuildCallback(i,"CombineModelWall")}},e.prototype.parseCombinePlacementWalls=function(e){for(var t=0;t<e.combinePlacementWallObjects.length;t++){var i=e.combinePlacementWallObjects[t];this.registerCombineObjectBuildCallback(i,"CombinePlacementWall")}},e.prototype.parseCombineDoorOrWindows=function(e){for(var t=0;t<e.combineDoorOrWindowObjects.length;t++){var i=e.combineDoorOrWindowObjects[t];this.registerCombineObjectBuildCallback(i,"CombineDoorOrWindow")}},e.prototype.parsePlacements=function(e){for(var t=0;t<e.placements.length;t++){e.placements[t].registerBuildCallbackListener(this.placementBuildCallback,{loader:this})}},e.prototype.placementBuildCallback=function(e,t){t.loader;var i=e.resource.modelID,r=es;ls.isTree(i)?r=ts:ls.isWall(i)&&(r="Outdoors"===e.parent.type?$o:ss),ls.addThingJsObjectSfStyle(e,r)},e.prototype.parseDoorOrWindows=function(e){for(var t=0;t<e.doorOrWindows.length;t++){e.doorOrWindows[t].registerBuildCallbackListener(this.doorOrWindowBuildCallback,{loader:this})}},e.prototype.doorOrWindowBuildCallback=function(e,t){t.loader;e.isWindow?ls.addThingJsObjectSfStyle(e,e.parent instanceof json2mesh.Outdoors?is:es):ls.addThingJsObjectSfStyle(e,e.parent instanceof json2mesh.Outdoors?is:as)},e.prototype.parseGroups=function(e){for(var t=0;t<e.groups.length;t++){e.groups[t].registerBuildCallbackListener(this.groupBuildCallback,{loader:this})}},e.prototype.groupBuildCallback=function(e,t){t.loader;var i=e.parent.type;ls.addPlacementGroupSfStyle(e,i)},e.prototype.parseRooms=function(e){for(var t=0;t<e.rooms.length;t++){e.rooms[t].registerBuildCallbackListener(this.roomBuildCallback,{loader:this})}},e.prototype.roomBuildCallback=function(e,t){t.loader;"Outdoors"===e.parent.type?ls.addThingJsObjectSfStyle(e.floor,$o):(ls.addThingJsObjectSfStyle(e.ceiling,os),ls.addThingJsObjectSfStyle(e.roof,ns),ls.addThingJsObjectSfStyle(e.floor,rs))},e.prototype.parseVideoProbes=function(e){for(var t=0;t<e.videoprobes.length;t++){e.videoprobes[t].registerBuildCallbackListener(this.videoProbeBuildCallback,{loader:this})}},e.prototype.videoProbeBuildCallback=function(e,t){t.loader;ls.addThingJsObjectSfStyle(e,es)},e.prototype.registerCombineObjectBuildCallback=function(e,t){e.registerBuildCallbackListener(this.combinedObjectBuildCallback,{loader:this,typeName:t})},e.prototype.combinedObjectBuildCallback=function(e,t){var i=e,r=e.type;t.loader;if("CombineFloor"===r)ls.addThingJsObjectSfStyle(i,e.parent instanceof json2mesh.Outdoors?$o:rs);else if("CombineCeiling"===r)ls.addThingJsObjectSfStyle(i,os);else if("CombineRoof"===r)ls.addThingJsObjectSfStyle(i,ns);else if("CombinePlacement"===r){var n=e.resource.modelID,o=is;ls.isTree(n)?o=ts:ls.isWall(n)&&(o="Outdoors"!==e.parent.type?ss:$o),ls.addThingJsObjectSfStyle(i,o)}else if("CombineStraightManualWall"===r)ls.addThingJsObjectSfStyle(i,e.parent instanceof json2mesh.Outdoors?$o:ss);else if("CombineModelWall"===r)ls.addThingJsObjectSfStyle(i,e.parent instanceof json2mesh.Outdoors?$o:ss);else if("CombineDoorOrWindow"===r)ls.addThingJsObjectSfStyle(i,e.parent instanceof json2mesh.Outdoors?is:as);else if("CombinePlacementWall"===r)ls.addThingJsObjectSfStyle(i,e.parent instanceof json2mesh.Outdoors?$o:ss);else if("CombinePlacementGroup"===r){var s=is;ls.addThingJsObjectSfStyle(i,s)}else{var a=is;ls.addThingJsObjectSfStyle(i,a)}},e}(),ps=function(){function e(t){n(this,e),t.config&&(this.config=t.config),this.events=[],t.events&&(this.events=t.events),this.app=t.app,this.creators=[]}return e.prototype.clear=function(){for(var e=0;e<this.creators.length;e++){this.creators[e].clear()}this.events=[],this.app=null,this.creators=[],this.config=[]},e.prototype.setConfig=function(e){this.config=e},e.prototype.createTjsObject=function(e,t){var i=new(this.config.getClass(e.type))({json2meshObject:e,app:this.app,thingjsParent:t,events:this.events,config:this.config});return this.creators.push(i),i.create()},e.prototype.createTjsFacadeObject=function(e,t){var i=new(this.config.getClass("Facade"))({json2meshObject:e,json2meshBuilding:e,app:this.app,thingjsParent:t,events:this.events,config:this.config});return this.creators.push(i),i.create()},e}(),ds=function(){function e(t){n(this,e),this.json2meshObject=t.json2meshObject,this.app=t.app,this.thingjsParent=t.thingjsParent,this.createType=null,this.thingjsObject=null,this.config=t.config,this._createdCallbacks=[],this._createdCallbackParams=[],this._buildedCallbacks=[],this._buildedCallbackParams=[],t.events&&this.initEvents(t.events)}return e.prototype.clear=function(){this.json2meshObject=null,this.app=null,this.thingjsParent=null,this.createType=null,this.thingjsObject=null,this.config=null,this._createdCallbacks=[],this._createdCallbackParams=[],this._buildedCallbacks=[],this._buildedCallbackParams=[]},e.prototype.initEvents=function(e){for(var t=0;t<e.length;t++){e[t].init(this)}},e.prototype.create=function(){var e=this._getCreateParams();return this.thingjsObject=this.config.getCreatedThingjsObject(this.json2meshObject.id),this.thingjsObject?this._initCreatedThingjsObjectParams(e):this.thingjsObject=this.app.objectManager.create(e),this.thingjsObject.localPosition=this._getThingjsLocalPosition(),this.thingjsObject.scale=this.json2meshObject.scale,this.thingjsObject.node.quaternion.set(this.json2meshObject.rotation[0],this.json2meshObject.rotation[1],this.json2meshObject.rotation[2],this.json2meshObject.rotation[3]),this.json2meshObject.registerBuildCallbackListener(this._callback,{creator:this,uuid:this.thingjsObject.uuid}),this.json2meshObject.camInfo&&(this.thingjsObject.userData.camInfo=this.json2meshObject.camInfo),this._notifyCreatedCompleteListeners(),this._registerChangeTypeEvent(),this.thingjsObject},e.prototype._registerChangeTypeEvent=function(){var e=this;this.thingjsObject.one("classtypechange",(function(t){e._changeTypeCallback(t)}))},e.prototype._changeTypeCallback=function(e){this.thingjsObject=e.newObject},e.prototype._getThingjsLocalPosition=function(){return this.json2meshObject.position},e.prototype._initCreatedThingjsObjectParams=function(e){this.thingjsObject.uuid=e.uuid,this.thingjsObject.id=e.id,this.thingjsObject.name=e.name},e.prototype.registerCreatedCallbackListener=function(e,t){this._createdCallbacks.push(e),this._createdCallbackParams.push(t)},e.prototype._notifyCreatedCompleteListeners=function(){for(var e=0;e<this._createdCallbacks.length;e++){(0,this._createdCallbacks[e])(this,this._createdCallbackParams[e])}},e.prototype.registerBuildedCallbackListener=function(e,t){this._buildedCallbacks.push(e),this._buildedCallbackParams.push(t)},e.prototype._notifyBuildedCompleteListeners=function(){for(var e=0;e<this._buildedCallbacks.length;e++){(0,this._buildedCallbacks[e])(this,this._buildedCallbackParams[e])}},e.prototype._getCreateParams=function(){var e={};e.uuid=this.json2meshObject.id,null!==this.json2meshObject.userID&&(e.id=this.json2meshObject.userID),null!==this.json2meshObject.name&&(e.name=this.json2meshObject.name),null!==this.json2meshObject.properties&&(e.properties=this.json2meshObject.properties),null!==this.thingjsParent&&void 0!==this.thingjsParent&&(e.parent=this._getParent(this.thingjsParent,this.createType));var t=this.createType;return this.json2meshObject.jsonData&&this.json2meshObject.jsonData.type&&(t=this.json2meshObject.jsonData.type),e.type=t,e.loaded=!1,e.node=new THREE.Object3D,e.node.name=t,this.json2meshObject.resource&&this.json2meshObject.resource.getModelUrl&&(e.url=this.json2meshObject.resource.getModelUrl()),e},e.prototype._callback=function(e,t){var i=t.creator;i._processCallback();var r=i.thingjsObject;i._notifyBuildedCompleteListeners(),r.setupResources({loaded:!0}),t.thingjsObject=r},e.prototype._processCallback=function(){var e=this.json2meshObject,t=this.thingjsObject;e.mesh&&(e.mesh.position.set(0,0,0),e.mesh.quaternion.set(0,0,0,1),e.mesh.scale.set(1,1,1),t._addNodeBySceneLoad(e.mesh))},e.prototype._createCube=function(){var e=new THREE.BoxGeometry(1,1,1),t=new THREE.MeshBasicMaterial({color:65280});return new THREE.Mesh(e,t)},e.prototype._getParent=function(e,t){return null==t&&(t="Thing"),"Ground"===e.type?"CombinedObject"===t||"BatchObject"===t?e:e.parent:e},e.prototype._isNullOrUndefined=function(e){return null==e},e}(),fs=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="Campus",r}return s(t,e),t.prototype.create=function(){var e=this._getCreateParams();return this.thingjsObject=this.config.getCreatedThingjsObject(this.json2meshObject.id),this.thingjsObject?this._initCreatedThingjsObjectParams(e):this.thingjsObject=this.app.objectManager.create(e),this.json2meshObject.registerBuildCallbackListener(this._callback,{creator:this,uuid:this.thingjsObject.uuid}),this.json2meshObject.camInfo&&(this.thingjsObject.userData.camInfo=this.json2meshObject.camInfo),this._notifyCreatedCompleteListeners(),this._registerChangeTypeEvent(),this.config.campus=this.thingjsObject,this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.loaded=!0,t},t.prototype._initCreatedThingjsObjectParams=function(e){this.thingjsObject.uuid=this.json2meshObject.id,this.json2meshObject.userID&&(this.thingjsObject.id=this.json2meshObject.userID)},t}(ds),ms=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="Building",r}return s(t,e),t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.loaded=!0,t.structShow=this.json2meshObject.structShow,t},t.prototype.create=function(){return e.prototype.create.call(this),this.thingjsObject},t}(ds),gs=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="Floor",r}return s(t,e),t.prototype.create=function(){return e.prototype.create.call(this),this._createCombineObjectParent("CombineWallParent"),this._createCombineObjectParent("CombineMiscParent"),this._createCombineObjectParent("CombineRoofParent"),this._createCombineObjectParent("CombineCeilingParent"),this._createCombineObjectParent("CombineFloorParent"),this.thingjsObject},t.prototype._hidePlanObjs=function(e){if(!e.showObjectsInParentLevels){for(var t=e._children,i=0;i<t.length;i++){var r=t[i];if(r.isCombinedObject&&"CombineMiscParent"===r.userData.type)for(var n=r._children,o=0;o<n.length;o++){var s=n[o];s.isCombinedObject&&("CombinePlacement"===s.userData.json2meshType&&(s.visible=!1))}}for(var a=0;a<e.children.length;a++){var l=e.children[a];l.isDoor||"Room"===l.type||("Thing"===l.type&&l.isWindow||(l.visible=!1))}}},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.height=this.json2meshObject.height,t.alwaysShowInsideObjs=this.json2meshObject.alwaysShowInsideObjs,t.initBoxSize=this.json2meshObject.size,t},t.prototype._createCombineObjectParent=function(e){var t=this.app.objectManager.create({node:new THREE.Object3D,loaded:!0,parent:this._getParent(this.thingjsObject,"CombinedObject"),type:"CombinedObject"});t.userData.type=e,t.userData.isCombineParent=!0},t.prototype._callback=function(e,t){for(var i=t.creator,r=i.thingjsObject,n=r._children,o=0;o<n.length;o++){var s=n[o];s.isCombinedObject&&(s.loaded||s.setupResources({}))}r.loaded||r.setupResources({}),i._notifyBuildedCompleteListeners()},t}(ds),vs=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.json2meshObject.jsonData&&r.json2meshObject.jsonData.type?r.createType=r.json2meshObject.jsonData.type:r.createType="Thing",r}return s(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this);return t.bundleID=this.json2meshObject.resource.modelID,t.bundleName=this.json2meshObject.resource.modelName,this._setVisible(),this.thingjsObject},t.prototype._setVisible=function(){var e=this.thingjsObject;"Floor"!==e.parent.type||e.parent.showObjectsInParentLevels||(e.visible=!1)},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.belongRoomUserID=this.json2meshObject.belongRoomUserID,t.hideByScene=!this.json2meshObject.visible,t.initBoxSize=this.json2meshObject.size,t.url=this.json2meshObject.resource.getModelUrl(),t},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i);var r=i.thingjsObject;if(r._hideByScene=!t.visible,r.setupAnimations({model:t.resource.downloadModelRoot}),t.isPlayAnim&&r.containAnimation(t.animClip)){var n={name:t.animClip,loop:!1,speed:1};"_defaultAnim_"===t.animClip&&(n.loop=!0),r.playAnimation(n)}},t}(ds),ys=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="Ground",r}return s(t,e),t.prototype.create=function(){return e.prototype.create.call(this),this.thingjsObject.name=this.json2meshObject.id,this._createCombineObjectParent("CombineWallParent"),this._createCombineObjectParent("CombineMiscParent"),this._createCombineObjectParent("CombineFloorParent"),this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.height=this.json2meshObject.height,t.alwaysShowInsideObjs=this.json2meshObject.alwaysShowInsideObjs,t.loaded=!0,t},t.prototype._createCombineObjectParent=function(e){var t=this.app.objectManager.create({node:new THREE.Object3D,loaded:!0,parent:this._getParent(this.thingjsObject,"CombinedObject"),type:"CombinedObject"});t.userData.type=e,t.userData.isCombineParent=!0},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i);var r=i.creator,n=i.thingjsObject;n.wall.setupResources({}),r._setupResourcesToChildren(n.wall),n.plan.setupResources({}),r._setupResourcesToChildren(n.plan),n.misc.setupResources({}),r._setupResourcesToChildren(n.misc)},t.prototype._setupResourcesToChildren=function(e){for(var t=0;t<e.children.length;t++){e.children[t].setupResources({})}},t}(ds),bs=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="CombinedObject",r}return s(t,e),t.prototype.create=function(){return e.prototype.create.call(this).userData.json2meshType=this.json2meshObject.type,this.thingjsObject},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i),i.creator._checkCombineParentObjectLoaded()},t.prototype._checkCombineParentObjectLoaded=function(){for(var e=this.thingjsParent,t=0;t<e._children.length;t++){if(!e._children[t].loaded)return}e.setupResources({}),this._checkParentOfCombineParentObjectsLoaded(e.parent)},t.prototype._checkParentOfCombineParentObjectsLoaded=function(e){for(var t=e.query(".CombinedObject",!1),i=0;i<t.length;i++){var r=t[i];if("CombineMiscParent"!==r.userData.type&&!r.loaded)return}e.setupResources({})},t}(ds),_s=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.wall,r.thingjsParent.loaded=!1,r}return s(t,e),t}(bs),xs=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.ceiling,r.thingjsParent.loaded=!1,r}return s(t,e),t}(bs),Es=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.misc,r.thingjsParent.loaded=!1,r}return s(t,e),t.prototype.create=function(){return e.prototype.create.call(this).node.isDoorOrWin=!0,this.thingjsObject},t}(bs),ws=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.plan,r.thingjsParent.loaded=!1,r}return s(t,e),t}(bs),Ts=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.wall,r.thingjsParent.loaded=!1,r}return s(t,e),t}(bs),Ms=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.misc,r.thingjsParent.loaded=!1,r}return s(t,e),t}(bs),Cs=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.roof,r.thingjsParent.loaded=!1,r}return s(t,e),t}(bs),Ss=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="Room",r}return s(t,e),t.prototype.create=function(){e.prototype.create.call(this);return this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return this.json2meshObject.floor&&(t.floorHideByScene=!this.json2meshObject.floor.visible),this.json2meshObject.ceiling&&(t.ceilingHideByScene=!this.json2meshObject.ceiling.visible),this.json2meshObject.roof&&(t.roofHideByScene=!this.json2meshObject.roof.visible),t.holes=this._getRoomHoles(),t.points=this._getRoomPoints(),t},t.prototype._getRoomPoints=function(){for(var e=[],t=0;t<this.json2meshObject.points.length;t++){var i=this.json2meshObject.points[t];e.push(new THREE.Vector3(i[0],i[1],i[2]))}return e},t.prototype._getRoomHoles=function(){for(var e=[],t=0;t<this.json2meshObject.holes.length;t++){for(var i=this.json2meshObject.holes[t],r=[],n=0;n<i.length;n++){var o=i[n];r.push(new THREE.Vector3(o[0],o[1],o[2]))}e.push(r)}return e},t.prototype._processCallback=function(){var e=this.thingjsObject,t=this.json2meshObject;t.floor&&t.floor.visible&&(e._floorNode=t.floor.mesh,e._addNodeBySceneLoad(t.floor.mesh)),t.ceiling&&t.ceiling.visible&&(e._ceilingNode=t.ceiling.mesh,e._addNodeBySceneLoad(t.ceiling.mesh)),t.roof&&t.roof.visible&&(e._addNodeBySceneLoad(t.roof.mesh),e._roofNode=t.roof.mesh),e.setRelativePoints(t.points)},t}(ds),js=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t}(vs),Ps=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.json2meshObject.jsonData&&r.json2meshObject.jsonData.type?r.createType=r.json2meshObject.jsonData.type:r.createType="Thing",r.json2meshObject.enableCreateMesh=!1,r}return s(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this);return"Floor"!==t.parent.type||t.parent.showObjectsInParentLevels||(t.visible=!1),this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.belongRoomUserID=this.json2meshObject.belongRoomUserID,t.hideByScene=!this.json2meshObject.visible,t.initBoxSize=this.json2meshObject.size,t},t.prototype._callback=function(e,t){var i=t.creator,r=i.thingjsObject;i.thingjsObject=r,r.setupResources({loaded:!0}),t.thingjsObject=r,i._notifyBuildedCompleteListeners(),r._hideByScene=!e.visible,r.setupTextureAnimations()},t}(ds),Rs=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="Door",r.json2meshObject.isWindow&&(r.createType="Thing"),r}return s(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this);return t.node.isDoorOrWin=!0,t.isWindow=this.json2meshObject.isWindow,t.userData.isWindow=this.json2meshObject.isWindow,this.thingjsObject},t.prototype._setVisible=function(){},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i);var r=i.thingjsObject;if(r.node.quaternion.set(t.rotation[0],t.rotation[1],t.rotation[2],t.rotation[3]),r.localPosition=i.creator._getThingjsLocalPosition(),t.isWindow||t.isOpen&&r.open(),r.animationNames)for(var n=0;n<r.animationNames.length;n++){var o=r.animationNames[n];if("_defaultAnim_"===o){r.playAnimation({name:o,loop:!0,speed:1});break}}},t}(vs),Ds=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="RouteLine",r}return s(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this);return null!==this.json2meshObject.width&&(t.width=this.json2meshObject.width),"Ground"===this.thingjsParent.type||t.parent.showObjectsInParentLevels||(t.visible=!1),t.scrollSpeed=-10,t.rotateScrollDirection=!0,this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.hideByScene=!this.json2meshObject.visible,t.arrowFlag=!1,t},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i);for(var r=[],n=new THREE.Vector3(t.position[0],t.position[1],t.position[2]),o=0;o<t.points.length;o++){var s=new THREE.Vector3(t.points[o][0],t.points[o][1],t.points[o][2]);s.add(n),r.push(s)}var a=i.thingjsObject;if(a.addPoints(r,THING.SpaceType.Local),t.resource&&t.resource.texture){var l=t.resource.texture.clone();l.flipY=!1,l.rotation=Math.PI/2,a.synPathTexture(l),l.needsUpdate=!0}if(t.color){var u=new THREE.Color(t.color[0],t.color[1],t.color[2]);a.style.color="#"+u.getHexString()}if(void 0!==t.enableMaterialAnimation&&(a.imageScroll=t.enableMaterialAnimation),void 0!==t.materialAnimationSpeed&&(a.imageScrollSpeed=-t.materialAnimationSpeed),void 0!==t.textureTiling){var c=t.textureTiling;c[1]*=a.width,a.imageRepeat=c}t.textureOffset,ls.addNodeSfStyle(a.node,is)},t}(ds),As=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="PolygonLine",r}return s(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this);return this.json2meshObject.sectionType&&("Triangle"===this.json2meshObject.sectionType&&(t.pathRadialSegments=3,t._updateByPoints()),"Square"===this.json2meshObject.sectionType&&(t.pathRadialSegments=4,t.pathStartRad=Math.PI/4,t._updateByPoints())),this.json2meshObject.radius&&(t.width=this.json2meshObject.radius),"Ground"===this.thingjsParent.type||t.parent.showObjectsInParentLevels||(t.visible=!1),this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.hideByScene=!this.json2meshObject.visible,t},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i);for(var r=[],n=new THREE.Vector3(t.position[0],t.position[1],t.position[2]),o=0;o<t.points.length;o++){var s=new THREE.Vector3(t.points[o][0],t.points[o][1],t.points[o][2]);s.add(n),r.push(s)}var a=i.thingjsObject;if(a.addPoints(r,THING.SpaceType.Local),t.resource&&t.resource.texture){var l=t.resource.texture.clone();l.flipY=!1,a.synPathTexture(l),l.needsUpdate=!0}if(t.color){var u=new THREE.Color(t.color[0],t.color[1],t.color[2]);a.style.color="#"+u.getHexString()}else a.style.color="#ffffff";if(void 0!==t.enableMaterialAnimation&&(a.imageScroll=t.enableMaterialAnimation),void 0!==t.materialAnimationSpeed&&(a.imageScrollSpeed=t.materialAnimationSpeed),void 0!==t.textureTiling){var c=1.1*a.width*2*Math.PI/t.textureTiling[0];a.imageRepeat=[c,c]}t.textureOffset,ls.addNodeSfStyle(a.node,is)},t}(ds),ks=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.json2meshBuilding=i.json2meshBuilding,r.createType="Facade",r.shouldCombineJson2meshObjects=[],r.shouldNotCombineJson2meshObjects=[],r.combineFacade=null,r.notCombineFacades=[],r}return s(t,e),t.prototype.clear=function(){e.prototype.clear.call(this),this.json2meshBuilding=null,this.shouldCombineJson2meshObjects=[],this.shouldNotCombineJson2meshObjects=[],this.combineFacade=null,this.notCombineFacades=[]},t.prototype.create=function(){var e=this.json2meshBuilding,t=this._getFacadeRelation(e);return this.shouldCombineJson2meshObjects=t.facades,this.shouldNotCombineJson2meshObjects=t.children,t.children&&t.facades&&(this.thingjsObject=this._createCombineFacade(t,this.thingjsParent),this._createFacadeChildren(t,this.thingjsObject)),this._notifyCreatedCompleteListeners(),this.thingjsObject},t.prototype._createCombineFacade=function(e,t){var i=e.facades,r=new THREE.Object3D,n=this.app.objectManager.create({type:"Facade",loaded:!1,node:r,parent:t});this.combineFacade=n;for(var o=0;o<i.length;o++){var s=i[o],a=this.app.objectManager.create({uuid:s.id,type:"CombinedObject",node:new THREE.Object3D,loaded:!1,parent:n});a.userData.isCombinedObject=!0,s.registerBuildCallbackListener(this._facadeBuildCallback,{loader:this,tjsObject:a,relation:e,parent:n})}return n},t.prototype._createFacadeChildren=function(e,t){for(var i=e.children,r=0;r<i.length;r++){var n=i[r],o=void 0;o="FacadeGroup"===n.type?this._createFacadeGroup(n,t,e):this._createFacade(n,t,e),this.notCombineFacades.push(o)}},t.prototype._createFacadeGroup=function(e,t,i){for(var r=this.app.objectManager.create({type:"Facade",uuid:e.id,id:e.userID,name:e.name,node:new THREE.Object3D,parent:t,loaded:!1,properties:e.properties}),n=0;n<e.children.length;n++){var o=e.children[n];"FacadeGroup"===o.type?this._createFacadeGroup(o,r,i):this._createFacade(o,r,i)}return e.registerBuildCallbackListener(this._facadeChildBuildCallback,{loader:this,tjsObject:r,relation:i,parent:t}),r},t.prototype._createFacade=function(e,t,i){var r=this.app.objectManager.create({type:"Facade",uuid:e.id,id:e.userID,name:e.name,node:new THREE.Object3D,parent:t,loaded:!1,url:e.resource.getModelUrl(),properties:e.properties});return e.registerBuildCallbackListener(this._facadeChildBuildCallback,{loader:this,tjsObject:r,relation:i,parent:t}),r},t.prototype.parseJson2meshObject=function(e,t){var i=this.creatorManager.createTjsObject(e,t),r=e.children;if(r)for(var n=0;n<r.length;n++){var o=r[n];this.parseJson2meshObject(o,i)}return i},t.prototype._getFacadeRelation=function(e){var t=e.typeToChildren.Facade,i=e.typeToChildren.FacadeGroup;if(!t&&!i)return{};var r=[],n=[];if(t)for(var o=0;o<t.length;o++){var s=t[o];this._isFacadeShouldBeChild(s)?r.push(s):n.push(s)}if(i)for(var a=0;a<i.length;a++){var l=i[a];this._isFacadeShouldBeChild(l)?r.push(l):n.push(l)}return{facades:n,children:r}},t.prototype._isFacadeShouldBeChild=function(e){return!this._isNullOrUndefined(e.name)||(!this._isNullOrUndefined(e.userID)||!this._isNullOrUndefined(e.properties))},t.prototype._facadeChildBuildCallback=function(e,t){var i=t.tjsObject,r=t.loader,n=t.relation,o=t.parent;i._addNodeBySceneLoad(e.mesh),i.setupResources({loaded:!0}),r._checkFacadeBuildedComplete(n,o)},t.prototype._checkFacadeBuildedComplete=function(e,t){for(var i=e.facades,r=e.children,n=!0,o=0;o<i.length;o++){if(!i[o].isBuilded){n=!1;break}}for(var s=0;s<r.length;s++){if(!r[s].isBuilded){n=!1;break}}n&&(t.setupResources({}),this._notifyBuildedCompleteListeners())},t.prototype._facadeBuildCallback=function(e,t){var i=t.tjsObject,r=t.loader,n=t.relation,o=t.parent;i._addNodeBySceneLoad(e.mesh);var s=e.mesh.getMeshes();s&&s.length>0&&s.forEach((function(e){e._sfStyle=Ko})),i.setupResources({loaded:!0}),r._checkFacadeBuildedComplete(n,o)},t}(ds),Os=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="RouteLine",r}return s(t,e),t.prototype.create=function(){e.prototype.create.call(this);return this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.arrowFlag=!0,t},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i)},t}(Ds),Bs=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="RouteLine",r}return s(t,e),t.prototype.create=function(){e.prototype.create.call(this);return this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.arrowFlag=!0,t},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i);var r=i.creator.thingjsObject;t.pointUserIDs&&(r.userData.pointUserIDs=t.pointUserIDs),t.pointProperteis&&(r.userData.pointProperteis=t.pointProperteis)},t}(Os),Fs=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="PolygonLine",r}return s(t,e),t.prototype.create=function(){e.prototype.create.call(this);return this.thingjsObject},t.prototype._getCreateParams=function(){return e.prototype._getCreateParams.call(this)},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i);var r=i.creator.thingjsObject;t.alarmLength&&(r.userData.alarmLength=t.alarmLength)},t}(As),Ls=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="RouteLine",r}return s(t,e),t.prototype.create=function(){e.prototype.create.call(this);return this.thingjsObject},t.prototype._getCreateParams=function(){return e.prototype._getCreateParams.call(this)},t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i)},t}(Ds),Is=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.wall,r.thingjsParent.loaded=!1,r}return s(t,e),t}(bs),Ns=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="Thing",r}return s(t,e),t.prototype.create=function(){return e.prototype.create.call(this)},t.prototype._getCreateParams=function(){return e.prototype._getCreateParams.call(this)},t.prototype._setVisible=function(){var e=this.thingjsObject;"Floor"!==this.thingjsParent.type||this.thingjsParent.showObjectsInParentLevels||(e.visible=!1)},t.prototype._getParent=function(e,t){return e},t}(vs),Us=function(){function e(){n(this,e),this.convertFontSizeFactor=16/26*.1,this.sharpness=1,this.context=null,this.lineSpacing=.2,this.textSpacing=.1,this.fontSize=null,this.orgFontSize=null,this.saveData=null}return e.prototype.save=function(){var e={};e.sharpness=this.sharpness,e.convertFontSizeFactor=this.convertFontSizeFactor,e.sharpness=this.sharpness,e.lineSpacing=this.lineSpacing,e.textSpacing=this.textSpacing,e.fontSize=this.fontSize,e.orgFontSize=this.orgFontSize,this.saveData=e,this.context.save()},e.prototype.restore=function(){this.sharpness=this.saveData.sharpness,this.convertFontSizeFactor=this.saveData.convertFontSizeFactor,this.sharpness=this.saveData.sharpness,this.lineSpacing=this.saveData.lineSpacing,this.textSpacing=this.saveData.textSpacing,this.fontSize=this.saveData.fontSize,this.orgFontSize=this.saveData.orgFontSize,this.context.restore()},e.prototype.setupContext=function(e){var t=Ws.parseColor(e.fontColor);this.context.font=this.fontSize+"px "+e.fontType,this.context.fillStyle=t.toHexString(),this.context.textAlign="start",this.context.textBaseline="alphabetic"},e.prototype.setOrgFontSize=function(e){this.orgFontSize=e,this.fontSize=this._convertFontSize(e)},e.prototype._convertFontSize=function(e){return this.sharpness*e*.195/this.convertFontSizeFactor},e.prototype.setupDecorations=function(e){for(var t=0;t<e.length;t++){var i=e[t];this._setupSingleDecoration(i)}},e.prototype._setupSingleDecoration=function(e){if("color"===e.key)this.context.fillStyle=e.value;else if("b"===e.key){var t=this.context.font;t="bolder "+t,this.context.font=t}else if("size"===e.key){for(var i=this.context.font.split(" "),r="",n=0;n<i.length;n++){-1!==i[n].indexOf("px")&&(this.fontSize=this._convertFontSize(e.value),i[n]=this.fontSize+"px"),r+=" "+i[n]}this.context.font=r}else if("i"===e.key){var o=this.context.font;o="italic "+o,this.context.font=o}},e.prototype.measureTextWidth=function(e){return this.context.measureText(e).width},e.prototype.letterSpacingText=function(e,t,i){var r=this.context,n=this.fontSize*this.textSpacing,o=e.split(""),s=r.textAlign||"left",a=r.measureText(e).width+n*(o.length-1);"center"===s?t-=a/2:"right"===s&&(t-=a),r.textAlign="left",o.forEach((function(e){var o=r.measureText(e).width;r.fillText(e,t,i),t=t+o+n})),r.textAlign=s},e}(),zs=function(){function e(t){n(this,e),this.factor=null,this.decorationFactor=1,this.brush=null}return e.prototype.calCanvasSize=function(e,t){this.brush.sharpness=1;e.style.fontType;var i=t.fontSize;this.brush.setOrgFontSize(i);var r=(i=this.brush.fontSize)/72*96,n=Math.max(64,THING.Math.roundUpPowerOf2(r));this.brush.setupContext(t),this.calRichTextSize(e,i);var o=e.richTextSize,s=o.height,a=o.width,l=Math.max(n,THING.Math.roundUpPowerOf2(a)),u=Math.max(n,THING.Math.roundUpPowerOf2(s)),c={};c.width=Math.max(l,u),c.height=Math.max(l,u),e.canvasSize=c,e.planHeight=c.height*this.brush.convertFontSizeFactor},e.prototype.calRichTextSize=function(e){for(var t=-1,i=0,r=0;r<e.textRows.length;r++){var n=e.textRows[r];this._calRowSize(n);var o=n.size;o.width>t&&(t=o.width),i+=o.height,r!==e.textRows.length-1&&(i+=o.height*this.brush.lineSpacing)}e.richTextSize={width:t,height:i}},e.prototype._calRowSize=function(e){for(var t=e.texts,i=0,r=-1,n=0;n<t.length;n++){var o=t[n];this.brush.save(),this.brush.setupDecorations(o.decorations),this._calTextWidth(o),i+=o.width,this._calTextHeight(o);var s=o.height;s>r&&(r=s),this.brush.restore()}-1===r&&(r=this.brush.fontSize),e.size={width:i,height:r}},e.prototype._calTextWidth=function(e){for(var t=e.content.split(""),i=this.brush.fontSize,r=0,n=0;n<t.length;n++){var o=t[n];r+=this.brush.measureTextWidth(o),n!==t.length-1&&(r+=i*this.brush.textSpacing)}return e.width=r,r},e.prototype._calTextHeight=function(e){e.height=this.brush.fontSize},e}(),Hs=function(){function e(t){n(this,e),this.calculater=t,this.fontSize=null,this.brush=null}return e.prototype.setContext=function(e){this.brush.context=e},e.prototype.calCanvasSize=function(e,t){this.calculater.calCanvasSize(e,t)},e.prototype.calRichTextSize=function(e){this.calculater.calRichTextSize(e)},e.prototype.draw=function(e,t,i,r){this.brush.sharpness=2,this.brush.setOrgFontSize(r.fontSize),this.fontSize=this.brush.fontSize,this.brush.setupContext(r),this.calculater.calRichTextSize(e);var n=(i-e.richTextSize.height)/2;e.textRows.length>0&&(n+=.84*e.textRows[0].size.height);for(var o=t/2,s=n,a=0;a<e.textRows.length;a++){var l=e.textRows[a],u=l.size;0!==a&&(s+=.84*u.height),this._drawRow(l,o-.5*u.width,s),s+=u.height*(.16+this.brush.lineSpacing)}},e.prototype._drawRow=function(e,t,i){for(var r=0,n=0;n<e.texts.length;n++){var o=e.texts[n];0!==n&&(r+=e.texts[n-1].width),this._drawText(o,t+r,i)}},e.prototype._drawText=function(e,t,i){this.brush.save(),this.brush.setupDecorations(e.decorations),this.brush.letterSpacingText(e.content,t,i),this.brush.restore()},e}(),Vs=function(e){var t="[object "+e+"]";return function(e){return toString.call(e)==t}},Ws={isNull:function(e){return null==e},isArray:Vs("Array"),isObject:Vs("Object"),isString:Vs("String"),isNumber:Vs("Number"),isBlank:function(e){if(!Ws.isNull(e)&&Ws.isString(e))for(var t=0;t<e.length;t++)if(" "!=e[t]&&"\t"!=e[t])return!1;return!0},parseColor:function(e,t){if(!this.isNull(e)){if(e.isColor)return e;if(Ws.isArray(e))return new THREE.Color(e[0],e[1],e[2]);if(Ws.isNumber(e))return(i=new THREE.Color).setHex(e),i;if(Ws.isString(e)){if(Ws.isBlank(e))return new THREE.Color(0,0,0);if("#"==e[0])return Ws.parseColor(parseInt(e.substr(1),16));var i=new THREE.Color,r=THREE.Color.NAMES[e.toLowerCase()];if(void 0!==r)return i.setHex(r);if(!isNaN(e))return Ws.parseColor(THING.Math.toInteger(e))}}return t?Ws.parseColor(t):t}},Gs=new zs,qs=new Hs(Gs),Xs=new Us;qs.brush=Xs,Gs.brush=Xs;var Js,Ys=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="_UbuilderRichTextRegion",r}return s(t,e),t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);t.localPosition=this.json2meshObject.position,t.text=this.json2meshObject.text,t.textRows=this.json2meshObject.textRows;var i=this.json2meshObject.fontSize;return t.style={fontColor:this.json2meshObject.color,fontSize:i},t.drawer=qs,t},t.prototype.create=function(){return e.prototype.create.call(this),"FloorPlan"===this.json2meshObject.parent.type&&(this.thingjsObject.visible=!1),this.thingjsObject},t}(ds),Zs=function(){function e(){n(this,e),this._map={World:fs,Building:ms,FloorPlan:gs,Placement:vs,Outdoors:ys,CombineStraightManualWall:_s,CombineCeiling:xs,CombineDoorOrWindow:Es,CombineFloor:ws,CombineModelWall:Ts,CombinePlacement:Ms,CombinePlacementGroup:Ms,CombineRoof:Cs,CombinePlacementWall:Is,Room:Ss,VideoProbe:js,PlacementGroup:Ps,DoorOrWindow:Rs,CurveLine:Ds,PipeLine:As,Facade:ks,FacadeGroup:ks,ArrowLine:Os,ArrowDataLine:Bs,LeakWaterLine:Fs,RouteLine:Ls,PlacementGround:Ns,Text3D:Ys},this._createdThingjsObjectMap={},this.campus=null}return e.prototype.getClass=function(e){return this._map[e]},e.prototype.addCreatedThingjsObject=function(e,t){this._createdThingjsObjectMap[e.id]=t},e.prototype.getCreatedThingjsObject=function(e){return this._createdThingjsObjectMap[e]},e}(),Qs={changeParentToRoom:function(e){var t=e.json2meshObject;e.app;if(t.belongRoomUserID&&"FloorPlan"===t.parent.type){var i=this.allRooms[t.belongRoomUserID];e.thingjsParent=i}},getThingjsObjectInRoomLocalPosition:function(e,t,i){if(i){var r=i.parent.selfToWorld(e.position);return r=t.worldToLocal(r)}return e.position}},Ks=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return Qs.changeParentToRoom(r),r}return s(t,e),t.prototype._getThingjsLocalPosition=function(){var e=null;return"Room"===this.thingjsParent.type&&(e=this.thingjsParent),Qs.getThingjsObjectInRoomLocalPosition(this.json2meshObject,this.thingjsObject,e)},t}(vs),$s=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return Qs.changeParentToRoom(r),r}return s(t,e),t.prototype._getThingjsLocalPosition=function(){var e=null;return"Room"===this.thingjsParent.type&&(e=this.thingjsParent),Qs.getThingjsObjectInRoomLocalPosition(this.json2meshObject,this.thingjsObject,e)},t}(Ps),ea=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="Room",r}return s(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this),i=this.app.objectManager.create({node:new THREE.Object3D,parent:this._getParent(t,"CombinedObject"),type:"CombinedObject"});i.userData.type="CombineMiscParent",i.userData.isCombineParent=!0},t}(Ss),ta=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return Qs.changeParentToRoom(r),"Room"===r.thingjsParent.type&&(r.thingjsParent=r.thingjsParent.misc,r.thingjsParent.loaded=!1),r}return s(t,e),t.prototype._getThingjsLocalPosition=function(){var e=null;return"Room"===this.thingjsParent.parent.type&&(e=this.thingjsParent.parent),Qs.getThingjsObjectInRoomLocalPosition(this.json2meshObject,this.thingjsObject,e)},t.prototype._checkParentOfCombineParentObjectsLoaded=function(e){},t}(Ms),ia=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return Qs.changeParentToRoom(r),r}return s(t,e),t.prototype._getThingjsLocalPosition=function(){var e=null;return"Room"===this.thingjsParent.type&&(e=this.thingjsParent),Qs.getThingjsObjectInRoomLocalPosition(this.json2meshObject,this.thingjsObject,e)},t}(js),ra=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._map.Placement=Ks,r._map.PlacementGroup=$s,r._map.Room=ea,r._map.CombinePlacement=ta,r._map.VideoProbe=ia,r}return s(t,e),t}(Zs),na=function(){function e(){n(this,e)}return e.prototype.init=function(e){},e.prototype.onFire=function(e){},e}(),oa=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerCreatedCallbackListener(this.onFire,{event:this}),t.registerBuildedCallbackListener(this._buildCallback,{event:this})},t.prototype.onFire=function(e,t){var i=e.thingjsObject,r=e.json2meshObject,n=t.event;if("Building"!==i.type&&"Campus"!==i.type&&"CombinedObject"!==i.type&&"Room"!==i.type&&"RouteLine"!==i.type&&"PolygonLine"!==i.type&&"Ground"!==i.type)if("Facade"===i.type){var o=e.json2meshBuilding;n._addFacadeBoxNode(o,i)}else n._addBoxNode(r,i)},t.prototype._addFacadeBoxNode=function(e,t){var i=this._getFacadesBoundingBox(e),r=new THREE.Vector3,n=new THREE.Vector3;i.getSize(r),i.getCenter(n);var o=new THREE.BoxBufferGeometry(1,1,1),s=new THREE.MeshBasicMaterial;s.visible=!1;var a=new THREE.Mesh(o,s);a.scale.set(r.x,r.y,r.z),t.setBoxNode(a),a.position.set(n.x,n.y,n.z)},t.prototype._getFacadesBoundingBox=function(e){var t=new THREE.Box3,i=new THREE.Object3D,r=e.typeToChildren.Facade,n=e.typeToChildren.FacadeGroup;if(r)for(var o=0;o<r.length;o++){var s=r[o];i.add(this._createBoxMesh(s))}if(n)for(var a=0;a<n.length;a++){var l=n[a];i.add(this._createBoxMesh(l))}return t.setFromObject(i),t},t.prototype._createBoxMesh=function(e){var t=new THREE.BoxBufferGeometry(1,1,1),i=new THREE.MeshBasicMaterial,r=new THREE.Mesh(t,i);return r.scale.set(e.size[0],e.size[1],e.size[2]),r.quaternion.set(e.rotation[0],e.rotation[1],e.rotation[2],e.rotation[3]),r.position.set(e.position[0],e.position[1],e.position[2]),r.position.y=(e.position[1]+e.size[1])/2,r},t.prototype._addBoxNode=function(e,t){var i=new THREE.Vector3(e.center[0],e.center[1],e.center[2]),r=new THREE.BoxBufferGeometry(1,1,1),n=new THREE.MeshBasicMaterial;n.visible=!1;var o=new THREE.Mesh(r,n),s=new THREE.Vector3(e.size[0],e.size[1],e.size[2]);s.divide(t.node.scale),o.scale.set(0===s.x?.001:s.x,0===s.y?.001:s.y,0===s.z?.001:s.z),t.setBoxNode(o),"Building"===t.type||"Floor"===t.type?o.position.set(i.x,i.y,i.z):o.position.set(0,e.size[1]/2,0)},t.prototype._buildCallback=function(e,t){for(var i=e.thingjsObject,r=(e.json2meshObject,i.node),n=0;n<r.children.length;n++){var o=r.children[n];if(o.userData.asBoundingBox){o.visible=!1;break}}},t}(na),sa=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.app=i.app,r}return s(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){var i=e.thingjsObject,r=e.json2meshObject,n=t.event;if("CombinePlacement"===r.type){i._removeNodeBySceneLoad(r.mesh);var o=r.objects,s=r.transformations,a=r.resource.modelID;r.resource.model.updateMatrixWorld();for(var l=e.app.create({type:"BatchObject",nodeOverride:!1,node:r.resource.model,initBatchNum:o.length,parent:i}),u=0;u<o.length;u++){var c=o[u],h=n.calMatrixs(s[u]),p=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Quaternion;h.decompose(p,f,d);var m=p.toArray(),g=d.toArray(),v=new THREE.Euler;v.setFromQuaternion(f);var y=v.toArray();y[0]*=180/Math.PI,y[1]*=180/Math.PI,y[2]*=180/Math.PI;l.createSubObject({parent:i,id:c.id,localPosition:m,scale:g,angles:y})}ls.addBatchCombinePlacementStyle(l,r,a)}},t.prototype.calMatrixs=function(e){for(var t=new THREE.Matrix4,i=e.positions.length-1;i>-1;i--){var r=e.positions[i],n=e.quaternions[i],o=e.scales[i],s=new THREE.Vector3(r[0],r[1],r[2]),a=new THREE.Quaternion(n[0],n[1],n[2],n[3]),l=new THREE.Vector3(o[0],o[1],o[2]),u=new THREE.Matrix4;u.compose(s,a,l),t.premultiply(u)}return t},t}(na),aa=function(e){function t(){return n(this,t),a(this,e.call(this))}return s(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){e.thingjsObject;var i=e.json2meshObject,r=t.event;"Room"===i.type?r._createRoomWater(e):"CombineFloor"!==i.type&&"CombineCeiling"!==i.type&&"CombineRoof"!==i.type||r._createCombineFloorWater(e)},t.prototype._createRoomWater=function(e){var t=e.json2meshObject,i=e.thingjsObject;if(t.floor&&this._checkIsWater(t.floor.resource)){var r=t.floor.mesh.position,n=t.floor.mesh.quaternion,o=this._createWater(e,t.floor.mesh);i.node.remove(t.floor.mesh),o.userData.json2meshType=t.type,t.floor.mesh=o.node,i._floorNode=o.node,i.add(o),o.node.position.copy(r),o.node.quaternion.copy(n),t.mesh.children[0]=o.node}if(t.ceiling&&this._checkIsWater(t.ceiling.resource)){var s=t.ceiling.mesh.position,a=t.ceiling.mesh.quaternion,l=this._createWater(e,t.ceiling.mesh);l.userData.json2meshType=t.type,i.node.remove(t.ceiling.mesh),t.ceiling.mesh=l.node,i._ceilingNode=l.node,i.add(l),l.node.position.copy(s),t.mesh.children[1]=l.node,l.node.position.copy(s),l.node.quaternion.copy(a)}if(t.roof&&this._checkIsWater(t.roof.resource)){var u=t.roof.mesh.position,c=t.roof.mesh.quaternion,h=this._createWater(e,t.roof.mesh);t.roof.mesh=h.node,i._roofNode=h.node,i.node.remove(t.roof.mesh),i.add(h),h.node.position.copy(u),t.mesh.children[2]=h.node,h.node.position.copy(u),h.node.quaternion.copy(c)}},t.prototype._createCombineFloorWater=function(e){var t=e.json2meshObject,i=e.thingjsObject;if(this._checkIsWater(t.resource)){var r=this._createWater(e,t.mesh);r.scale.y*=-1,i.node.remove(t.mesh),i.add(r),r.node.position.copy(t.mesh.position),r.node.quaternion.copy(t.mesh.quaternion)}},t.prototype._checkIsWater=function(e){return!(!e||"bundle"!==e.ext||"test0000000003"!==e.id&&"test0000000004"!==e.id)},t.prototype._createWater=function(e,t){var i=e.app.objectManager.create({type:"Water",style:{waterColor:"#1D282C",waterScale:.3,flowXDirection:2,flowYDirection:1},geometry:t.geometry});return i.water.position.set(0,0,0),i.water.quaternion.set(0,0,0,1),i},t}(na),la=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this._buildCallback,{event:this})},t.prototype._buildCallback=function(e,t){var i=e.thingjsObject,r=e.json2meshObject,n=t.event;i.node;"Building"===r.type&&"Facade"===i.type?n._processFacade(e,t):r.resource&&r.resource.indexJson&&(i._extensionsFile=r.resource.indexJson.extensionsfile||null)},t.prototype._processFacade=function(e,t){for(var i=e.thingjsObject,r=(e.json2meshObject,e.shouldNotCombineJson2meshObjects),n=0;n<r.length;n++){var o=r[n],s=i.query("##"+o.id)[0];o.resource&&o.resource.indexJson&&(s._extensionsFile=o.resource.indexJson.extensionsfile||null)}},t}(na),ua=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));r.resourceManager=i.resourceManager,r.localUseStaticImageResources={};var o=r;return r.useStaticImageKey="useStaticImage",r.manualUseStaticImage="manualUseStaticImage",r.skipManualObjects=void 0!==THING[r.manualUseStaticImage]&&!THING[r.manualUseStaticImage],THING.onValueChange=function(e){e.type===o.useStaticImageKey?o.onUseStaticImageChange(e.value):e.type===o.manualUseStaticImage&&o.onManualUseStaticImageChange(e.value)},r}return s(t,e),t.prototype.onUseStaticImageChange=function(e){for(var t=0;t<this.resourceManager.textures.length;t++){var i=this.resourceManager.textures[t];void 0===this.localUseStaticImageResources[i.id]&&(i.useStaticImage=e)}for(var r=0;r<this.resourceManager.models.length;r++){var n=this.resourceManager.models[r];void 0===this.localUseStaticImageResources[n.id]&&(n.useStaticImage=e)}},t.prototype.onManualUseStaticImageChange=function(e){for(var t=0;t<this.resourceManager.textures.length;t++){var i=this.resourceManager.textures[t];void 0===this.localUseStaticImageResources[i.id]&&(i.useStaticImage=e)}},t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerCreatedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){var i=e.thingjsObject,r=e.json2meshObject,n=t.event;if("Facade"===i.type){var o=e.json2meshBuilding;n.processFacades(o.typeToChildren.Facade),n.processFacadeGroups(o.typeToChildren.FacadeGroup)}else"PlacementGroup"===r.type?n.processGroup(r):"CombineStraightManualWall"===r.type||"CombineFloor"===r.type||"CombineRoof"===r.type||"CombineCeiling"===r.type||"Ceiling"===r.type||"Floor"===r.type||"Roof"===r.type?n.skipManualObjects&&n.processJson2meshObject(r,!1):n.processJson2meshObject(r)},t.prototype.processFacades=function(e){if(e)for(var t=0;t<e.length;t++){var i=e[t];this.processJson2meshObject(i)}},t.prototype.processFacadeGroups=function(e){if(e)for(var t=0;t<e.length;t++){var i=e[t];this.processGroup(i)}},t.prototype.processGroup=function(e,t,i){void 0===i&&(i=this.getLocalUseStaticImageSetting(e));for(var r=0;r<e.groups.length;r++){var n=e.groups[r];this.processGroup(n,t,i)}for(var o=0;o<e.placements.length;o++){var s=e.placements[o];s.resource&&this.processJson2meshObject(s,t,i)}},t.prototype.processJson2meshObject=function(e,t,i){if(void 0===i&&(i=this.getLocalUseStaticImageSetting(e)),void 0===t&&(t=THING[this.useStaticImageKey]),e.resources)for(var r=0;r<e.resources.length;r++){var n=e.resources[r];if(void 0!==this.localUseStaticImageResources[n.id])return;void 0===i?void 0!==t&&(n.useStaticImage=t):(n.useStaticImage=i,void 0!==!this.localUseStaticImageResources[n.id]&&(this.localUseStaticImageResources[n.id]=i))}},t.prototype.getLocalUseStaticImageSetting=function(e){if(e.lowerCaseProperties){if("true"===e.lowerCaseProperties._usestaticimage_)return!0;if("false"===e.lowerCaseProperties._usestaticimage_)return!1}},t.prototype.getGlobalUseStaticImageSetting=function(){if(void 0!==THING[this.useStaticImageKey])return THING[this.useStaticImageKey]},t}(na),ca=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.resourceManager=i.resourceManager,r.processGlobalSetting(),r}return s(t,e),t.prototype.processGlobalSetting=function(){if(THING.useStaticImage){for(var e=0;e<this.resourceManager.textures.length;e++){this.resourceManager.textures[e].useStaticImage=true}for(var t=0;t<this.resourceManager.models.length;t++){this.resourceManager.models[t].useStaticImage=true}}},t.prototype.init=function(e){},t}(na),ha=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return Qs.allRooms={},r}return s(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerCreatedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){var i=e.thingjsObject,r=e.json2meshObject;t.event;"Room"===i.type&&r.userID&&(Qs.allRooms[r.userID]=i)},t}(na),pa=function(e){function t(){n(this,t);var i=a(this,e.call(this));return i.tag="model-wall",i}return s(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){e.thingjsObject;var i=e.json2meshObject,r=t.event;if("CombineModelWall"===i.type){var n=r.getMeshes(i.mesh);n&&n.length>0&&n.forEach((function(e){e._cls=r.tag}))}},t.prototype.getMeshes=function(e){var t=[];return e.traverse((function(e){e.isMesh&&t.push(e)})),t},t}(na),da=Fo((function(e,t){!function(e){var t,i,n,o,s,a,l,u,c,h="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)},p=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},d=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),f=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},m=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t},g=function(){function e(){p(this,e)}return d(e,null,[{key:"compatibilityProcessWorld",value:function(e){this.compatibilityProcessPlan(e.outdoors);for(var t=e.buildings,i=0;i<t.length;i++)for(var r=t[i].floorplans,n=0;n<r.length;n++){var o=r[n];this.compatibilityProcessPlan(o)}}},{key:"compatibilityProcessPlan",value:function(e){for(var t=0;t<e.combineStraightManualWallObjects.length;t++){var i=e.combineStraightManualWallObjects[t];e.combineStraightManualWalls.push(i.delayObject)}for(var r=0;r<e.combineCeilingObjects.length;r++){var n=e.combineCeilingObjects[r];e.combineCeilings.push(n.delayObject)}for(var o=0;o<e.combineFloorObjects.length;o++){var s=e.combineFloorObjects[o];e.combineFloors.push(s.delayObject)}for(var a=0;a<e.combineRoofObjects.length;a++){var l=e.combineRoofObjects[a];e.combineRoofs.push(l.delayObject)}for(var u=0;u<e.combineModelWallObjects.length;u++){var c=e.combineModelWallObjects[u];e.combineModelWalls.push(c.delayObject)}for(var h=0;h<e.combineDoorOrWindowObjects.length;h++){var p=e.combineDoorOrWindowObjects[h];e.combineDoorOrWins.push(p.delayObject)}for(var d=0;d<e.combinePlacementObjects.length;d++){var f=e.combinePlacementObjects[d];e.combinePlacements.push(f.delayObject)}}},{key:"combineObjectBuildCallback",value:function(e){var t=null;-1!==e.constructor.name.indexOf("Ceiling")?t=e.parent.combineCeilings:-1!==e.constructor.name.indexOf("DoorOrWindow")?t=e.parent.combineDoorOrWins:-1!==e.constructor.name.indexOf("Floor")?t=e.parent.combineFloors:-1!==e.constructor.name.indexOf("ModelWall")?t=e.parent.combineModelWalls:-1!==e.constructor.name.indexOf("Placement")?t=e.parent.combinePlacements:-1!==e.constructor.name.indexOf("Roof")?t=e.parent.combineRoofs:-1!==e.constructor.name.indexOf("Straight")&&(t=e.parent.combineStraightManualWalls),t.push(e.mesh)}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":h(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}}]),e}(),v=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},y=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),b=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},_=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},x=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},E=new(function(){function e(t){v(this,e),this.config=null,this.objectManager=null}return y(e,[{key:"createObject",value:function(e){var t=new(this.config.getClass(e.creatorType))(e),i=t.create();return t.parseChildren(),i}}]),e}()),w={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:(i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(36),o=0,function(){for(var e=0;e<36;e++)8===e||13===e||18===e||23===e?n[e]="-":14===e?n[e]="4":(o<=2&&(o=33554432+16777216*Math.random()|0),t=15&o,o>>=4,n[e]=i[19===e?3&t|8:t]);return n.join("")}),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*w.DEG2RAD},radToDeg:function(e){return e*w.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},T=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},M=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),C=function(){function e(t,i,r,n){T(this,e),this._x=t||0,this._y=i||0,this._z=r||0,this._w=void 0!==n?n:1}return M(e,[{key:"slerp",value:function(e,t,i,r){return i.copy(e).slerp(t,r)}},{key:"slerpFlat",value:function(e,t,i,r,n,o,s){var a=i[r+0],l=i[r+1],u=i[r+2],c=i[r+3],h=n[o+0],p=n[o+1],d=n[o+2],f=n[o+3];if(c!==f||a!==h||l!==p||u!==d){var m=1-s,g=a*h+l*p+u*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,s=Math.sin(s*_)/b}var x=s*v;if(a=a*m+h*x,l=l*m+p*x,u=u*m+d*x,c=c*m+f*x,m===1-s){var E=1/Math.sqrt(a*a+l*l+u*u+c*c);a*=E,l*=E,u*=E,c*=E}}e[t]=a,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"set",value:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,r=e._y,n=e._z,o=e.order,s=Math.cos,a=Math.sin,l=s(i/2),u=s(r/2),c=s(n/2),h=a(i/2),p=a(r/2),d=a(n/2);return"XYZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"YXZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"ZXY"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"ZYX"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"YZX"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c-h*p*d):"XZY"===o&&(this._x=h*u*c-l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c+h*p*d),!1!==t&&this.onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this.onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],s=i[1],a=i[5],l=i[9],u=i[2],c=i[6],h=i[10],p=r+a+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(s-n)*t):r>a&&r>h?(t=2*Math.sqrt(1+r-a-h),this._w=(c-l)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(o+u)/t):a>h?(t=2*Math.sqrt(1+a-r-h),this._w=(o-u)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-r-a),this._w=(s-n)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var i,r=new S,n=1e-6;return void 0===r&&(r=new S),(i=e.dot(t)+1)<n?(i=0,Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0):r.set(0,-e.z,e.y)):r.crossVectors(e,t),this._x=r.x,this._y=r.y,this._z=r.z,this._w=i,this.normalize()}},{key:"inverse",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,s=t._x,a=t._y,l=t._z,u=t._w;return this._x=i*u+o*s+r*l-n*a,this._y=r*u+o*a+n*s-i*l,this._z=n*u+o*l+i*a-r*s,this._w=o*u-i*s-r*a-n*l,this.onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,s=o*e._w+i*e._x+r*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(r+this._y),this._z=.5*(n+this._z),this;var l=Math.atan2(a,s),u=Math.sin((1-t)*l)/a,c=Math.sin(t*l)/a;return this._w=o*u+this._w*c,this._x=i*u+this._x*c,this._y=r*u+this._y*c,this._z=n*u+this._z*c,this.onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"onChange",value:function(e){return this.onChangeCallback=e,this}},{key:"onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}]),e}(),S=function(){function e(t,i,r){T(this,e),this.x=t||0,this.y=i||0,this.z=r||0,this.isVector3=!0}return M(e,[{key:"set",value:function(e,t,i){return this.x=e,this.y=t,this.z=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(){var e=new C;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}()}},{key:"applyAxisAngle",value:function(){var e=new C;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i))}()}},{key:"applyMatrix3",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}},{key:"applyQuaternion",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*i,u=a*i+s*t-n*r,c=a*r+n*i-o*t,h=-n*t-o*i-s*r;return this.x=l*a+h*-n+u*-s-c*-o,this.y=u*a+h*-o+c*-n-l*-s,this.z=c*a+h*-s+l*-o-u*-n,this}},{key:"transformDirection",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(){var t=new e,i=new e;return function(e,r){return t.set(e,e,e),i.set(r,r,r),this.clamp(t,i)}()}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-i*e.z,this.z=i*e.y-r*e.x,this}},{key:"crossVectors",value:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this}},{key:"projectOnVector",value:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)}},{key:"projectOnPlane",value:function(){var t=new e;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}},{key:"reflect",value:function(){var t=new e;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}()}},{key:"angleTo",value:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(w.clamp(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this}},{key:"setFromCylindrical",value:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}]),e}();function j(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}!function(){function e(t,i){T(this,e),this.isBox3=!0,this.min=void 0!==t?t:new S(1/0,1/0,1/0),this.max=void 0!==i?i:new S(-1/0,-1/0,-1/0)}M(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,l=e.length;a<l;a+=3){var u=e[a],c=e[a+1],h=e[a+2];u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,i,r),this.max.set(n,o,s),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,l=e.count;a<l;a++){var u=e.getX(a),c=e.getY(a),h=e.getZ(a);u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,i,r),this.max.set(n,o,s),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var i=(new S).copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){var t=e||new S;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){var t=e||new S;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=new S,i=this;return e.updateMatrixWorld(!0),e.traverse((function(e){var r,n,o=e.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(r=0,n=s.length;r<n;r++)t.copy(s[r]),t.applyMatrix4(e.matrixWorld),i.expandByPoint(t)}else if(o.isBufferGeometry){var a=o.attributes.position;if(void 0!==a)for(r=0,n=a.count;r<n;r++)t.fromBufferAttribute(a,r).applyMatrix4(e.matrixWorld),i.expandByPoint(t)}})),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return(t||new S).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsPlane",value:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=e.constant&&i>=e.constant}},{key:"clampPoint",value:function(e,t){return(t||new S).copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return(new S).copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){var t=[new S,new S,new S,new S,new S,new S,new S,new S];return this.isEmpty()||(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}])}(),Object.assign(j.prototype,{isMatrix4:!0,set:function(e,t,i,r,n,o,s,a,l,u,c,h,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new j).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(){var e=new S;return function(t){var i=this.elements,r=t.elements,n=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),s=1/e.setFromMatrixColumn(t,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[4]=r[4]*o,i[5]=r[5]*o,i[6]=r[6]*o,i[8]=r[8]*s,i[9]=r[9]*s,i[10]=r[10]*s,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,o=Math.cos(i),s=Math.sin(i),a=Math.cos(r),l=Math.sin(r),u=Math.cos(n),c=Math.sin(n);if("XYZ"===e.order){var h=o*u,p=o*c,d=s*u,f=s*c;t[0]=a*u,t[4]=-a*c,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-s*a,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*a}else if("YXZ"===e.order){var m=a*u,g=a*c,v=l*u,y=l*c;t[0]=m+y*s,t[4]=v*s-g,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-s,t[2]=g*s-v,t[6]=y+m*s,t[10]=o*a}else if("ZXY"===e.order)m=a*u,g=a*c,v=l*u,y=l*c,t[0]=m-y*s,t[4]=-o*c,t[8]=v+g*s,t[1]=g+v*s,t[5]=o*u,t[9]=y-m*s,t[2]=-o*l,t[6]=s,t[10]=o*a;else if("ZYX"===e.order)h=o*u,p=o*c,d=s*u,f=s*c,t[0]=a*u,t[4]=d*l-p,t[8]=h*l+f,t[1]=a*c,t[5]=f*l+h,t[9]=p*l-d,t[2]=-l,t[6]=s*a,t[10]=o*a;else if("YZX"===e.order){var b=o*a,_=o*l,x=s*a,E=s*l;t[0]=a*u,t[4]=E-b*c,t[8]=x*c+_,t[1]=c,t[5]=o*u,t[9]=-s*u,t[2]=-l*u,t[6]=_*c+x,t[10]=b-E*c}else"XZY"===e.order&&(b=o*a,_=o*l,x=s*a,E=s*l,t[0]=a*u,t[4]=-c,t[8]=l*u,t[1]=b*c+E,t[5]=o*u,t[9]=_*c-x,t[2]=x*c-_,t[6]=s*u,t[10]=E*c+b);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e._x,r=e._y,n=e._z,o=e._w,s=i+i,a=r+r,l=n+n,u=i*s,c=i*a,h=i*l,p=r*a,d=r*l,f=n*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(p+f),t[4]=c-v,t[8]=h+g,t[1]=c+v,t[5]=1-(u+f),t[9]=d-m,t[2]=h-g,t[6]=d+m,t[10]=1-(u+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:(l=new S,u=new S,c=new S,function(e,t,i){var r=this.elements;return c.subVectors(e,t),0===c.lengthSq()&&(c.z=1),c.normalize(),l.crossVectors(i,c),0===l.lengthSq()&&(1===Math.abs(i.z)?c.x+=1e-4:c.z+=1e-4,c.normalize(),l.crossVectors(i,c)),l.normalize(),u.crossVectors(c,l),r[0]=l.x,r[4]=u.x,r[8]=c.x,r[1]=l.y,r[5]=u.y,r[9]=c.y,r[2]=l.z,r[6]=u.z,r[10]=c.z,this}),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],u=i[1],c=i[5],h=i[9],p=i[13],d=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],_=i[15],x=r[0],E=r[4],w=r[8],T=r[12],M=r[1],C=r[5],S=r[9],j=r[13],P=r[2],R=r[6],D=r[10],A=r[14],k=r[3],O=r[7],B=r[11],F=r[15];return n[0]=o*x+s*M+a*P+l*k,n[4]=o*E+s*C+a*R+l*O,n[8]=o*w+s*S+a*D+l*B,n[12]=o*T+s*j+a*A+l*F,n[1]=u*x+c*M+h*P+p*k,n[5]=u*E+c*C+h*R+p*O,n[9]=u*w+c*S+h*D+p*B,n[13]=u*T+c*j+h*A+p*F,n[2]=d*x+f*M+m*P+g*k,n[6]=d*E+f*C+m*R+g*O,n[10]=d*w+f*S+m*D+g*B,n[14]=d*T+f*j+m*A+g*F,n[3]=v*x+y*M+b*P+_*k,n[7]=v*E+y*C+b*R+_*O,n[11]=v*w+y*S+b*D+_*B,n[15]=v*T+y*j+b*A+_*F,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new S;return function(t){for(var i=0,r=t.count;i<r;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix4(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],s=e[5],a=e[9],l=e[13],u=e[2],c=e[6],h=e[10],p=e[14];return e[3]*(+n*a*c-r*l*c-n*s*h+i*l*h+r*s*p-i*a*p)+e[7]*(+t*a*p-t*l*h+n*o*h-r*o*p+r*l*u-n*a*u)+e[11]*(+t*l*c-t*s*p-n*o*c+i*o*p+n*s*u-i*l*u)+e[15]*(-r*s*u-t*a*c+t*s*h+r*o*c-i*o*h+i*a*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],o=r[1],s=r[2],a=r[3],l=r[4],u=r[5],c=r[6],h=r[7],p=r[8],d=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],b=r[15],_=d*y*h-v*f*h+v*c*m-u*y*m-d*c*b+u*f*b,x=g*f*h-p*y*h-g*c*m+l*y*m+p*c*b-l*f*b,E=p*v*h-g*d*h+g*u*m-l*v*m-p*u*b+l*d*b,w=g*d*c-p*v*c-g*u*f+l*v*f+p*u*y-l*d*y,T=n*_+o*x+s*E+a*w;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var C=1/T;return i[0]=_*C,i[1]=(v*f*a-d*y*a-v*s*m+o*y*m+d*s*b-o*f*b)*C,i[2]=(u*y*a-v*c*a+v*s*h-o*y*h-u*s*b+o*c*b)*C,i[3]=(d*c*a-u*f*a-d*s*h+o*f*h+u*s*m-o*c*m)*C,i[4]=x*C,i[5]=(p*y*a-g*f*a+g*s*m-n*y*m-p*s*b+n*f*b)*C,i[6]=(g*c*a-l*y*a-g*s*h+n*y*h+l*s*b-n*c*b)*C,i[7]=(l*f*a-p*c*a+p*s*h-n*f*h-l*s*m+n*c*m)*C,i[8]=E*C,i[9]=(g*d*a-p*v*a-g*o*m+n*v*m+p*o*b-n*d*b)*C,i[10]=(l*v*a-g*u*a+g*o*h-n*v*h-l*o*b+n*u*b)*C,i[11]=(p*u*a-l*d*a-p*o*h+n*d*h+l*o*m-n*u*m)*C,i[12]=w*C,i[13]=(p*v*s-g*d*s+g*o*f-n*v*f-p*o*y+n*d*y)*C,i[14]=(g*u*s-l*v*s-g*o*c+n*v*c+l*o*y-n*u*y)*C,i[15]=(l*d*s-p*u*s+p*o*c-n*d*c-l*o*f+n*u*f)*C,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,s=e.y,a=e.z,l=n*o,u=n*s;return this.set(l*o+i,l*s-r*a,l*a+r*s,0,l*s+r*a,u*s+i,u*a-r*o,0,l*a-r*s,u*a+r*o,n*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:(s=new S,a=new j,function(e,t,i){var r=this.elements,n=s.set(r[0],r[1],r[2]).length(),o=s.set(r[4],r[5],r[6]).length(),l=s.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],a.copy(this);var u=1/n,c=1/o,h=1/l;return a.elements[0]*=u,a.elements[1]*=u,a.elements[2]*=u,a.elements[4]*=c,a.elements[5]*=c,a.elements[6]*=c,a.elements[8]*=h,a.elements[9]*=h,a.elements[10]*=h,t.setFromRotationMatrix(a),i.x=n,i.y=o,i.z=l,this}),makePerspective:function(e,t,i,r,n,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,a=2*n/(t-e),l=2*n/(i-r),u=(t+e)/(t-e),c=(i+r)/(i-r),h=-(o+n)/(o-n),p=-2*o*n/(o-n);return s[0]=a,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(e,t,i,r,n,o){var s=this.elements,a=1/(t-e),l=1/(i-r),u=1/(o-n),c=(t+e)*a,h=(i+r)*l,p=(o+n)*u;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}),function(){function e(t,i){T(this,e),this.x=t||0,this.y=i||0,this.isVector2=!0}M(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(){var t=new e,i=new e;return function(e,r){return t.set(e,e),i.set(r,r),this.clamp(t,i)}()}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}},{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}}])}();var P={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},R=function(){function e(){v(this,e)}return y(e,null,[{key:"uuid",value:function(){for(var e,t=P.chars,i=P.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"checkValueEmpty",value:function(e){return null==e}},{key:"convertToVector3",value:function(e){return e.isVector3?e:new S(e[0],e[1],e[2])}},{key:"convertToQuaternion",value:function(e){return new C(e[0],e[1],e[2],e[3])}}]),e}(),D=function(){function e(t){v(this,e),this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=t.jsonData,this.objectParent=null,t.parent&&(this.objectParent=t.parent),this.createType=null,this.resourceManager=t.resourceManager}return y(e,[{key:"create",value:function(){var e=this._getCreateParams();return this.object=E.objectManager.create(e),this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.jsonData=this.jsonData,e.parent&&(this.object.parent=e.parent),R.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.jsonData.properties&&(this.object.properties=this.jsonData.properties,this.object.lowerCaseProperties=this.convertPropertiesToLowerCase(this.jsonData.properties)),this.object}},{key:"convertPropertiesToLowerCase",value:function(e){var t={};for(var i in e)t[i.toLowerCase()]=e[i].toLowerCase();return t}},{key:"parseChildren",value:function(){}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,E.createObject(e)}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),e}(),A={scale:1,defaultFloorTextureResource:null,defaultCeilingTextureResource:null,defaultRoofTextureResource:null},k={WORLD:0,BUILDING:1,FLOORPLAN:2,WALLCORNER:3,MODELWALL:4,STRAIGHTMANUALWALL:5,PLACEMENT:6,PLACEMENTGROUP:7,DOORORWINDOW:8,ROOM:9,OUTDOORS:10,FACADE:11,FACADEGROUP:12,CURVELINE:13,LEAKWATERLINE:14,ARROWLINE:15,ARROWDATALINE:16,PIPELINE:17,ROUTELINE:18,VIDEOPROBE:19,FLOOR:22,CEILING:23,ROOF:24},O=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return _(t,e),y(t,[{key:"create",value:function(){return this.jsonData.unit&&(A.scale=.01*this.jsonData.unit),b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this)}},{key:"parseChildren",value:function(){var e=this.jsonData,t=(this._parseJsonDataChild({jsonData:e,creatorType:k.BUILDING}),this._parseJsonDataChild({jsonData:{},creatorType:k.OUTDOORS}));this.object.outdoors=t}}]),t}(D),B=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return _(t,e),y(t,[{key:"parseChildren",value:function(){var e=this.jsonData;this._parseJsonDataChild({jsonData:e,creatorType:k.FLOORPLAN})}}]),t}(D),F=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.walls&&this._parseWalls(e.walls),e.rooms&&this._parseJsonDataChildren({jsonData:e.rooms,creatorType:k.ROOM}),e.doors&&this._parseJsonDataChildren({jsonData:e.doors,creatorType:k.DOORORWINDOW}),this.object.calRoomsUV2()}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];0===i.type?this._parseJsonDataChild({jsonData:i,creatorType:k.STRAIGHTMANUALWALL}):this._parseJsonDataChild({jsonData:i,creatorType:k.MODELWALL})}}}]),t}(D),L=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="WallCorner",i}return _(t,e),y(t,[{key:"create",value:function(){b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=this.jsonData[0]*A.scale,i=0,r=this.jsonData[1]*A.scale;return this.object.position=[e,i,r],this.object}}]),t}(D),I=function(e){function t(e){return v(this,t),x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _(t,e),y(t,[{key:"_parseCorners",value:function(){var e=this.jsonData,t=(this.objectParent,e.start[0]*A.scale),i=e.start[1]*A.scale,r=null,n=null;r=this._existsCorner(t,0,i)?this._getCorner(t,0,i):this._createCorner(t,0,i,e.start),t=e.end[0]*A.scale,i=e.end[1]*A.scale,n=this._existsCorner(t,0,i)?this._getCorner(t,0,i):this._createCorner(t,0,i,e.end),this.object.startCorner=r,this.object.endCorner=n}},{key:"_existsCorner",value:function(e,t,i){var r=this.objectParent.typeToChildren.WallCorner;if(r)for(var n=0,o=r.length;n<o;n++){var s=r[n].position;if(s[0]===e&&s[1]===t&&s[2]===i)return!0}return!1}},{key:"_getCorner",value:function(e,t,i){for(var r=this.objectParent.typeToChildren.WallCorner,n=0,o=r.length;n<o;n++){var s=r[n].position;if(s[0]===e&&s[1]===t&&s[2]===i)return r[n]}return null}},{key:"_createCorner",value:function(e,t,i,r){var n=new L({jsonData:r}).create();return n.parent=this.objectParent,n.jsonData=r,n}}]),t}(D),N=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ModelWall",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),R.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),R.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),R.checkValueEmpty(this.jsonData.height)?this.object.height=this.object.resource.modelSize.y:this.object.height=this.jsonData.height,R.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}}]),t}(I),U=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="StraightManualWall",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),this._parseResources(),this.jsonData.uvmultiple&&(this.object.uvMultiple=this.jsonData.uvmultiple),R.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),R.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}},{key:"_parseResources",value:function(){R.checkValueEmpty(this.jsonData.lefttexture)||(this.object.leftResource=this.resourceManager.textures[this.jsonData.lefttexture]),R.checkValueEmpty(this.jsonData.righttexture)||(this.object.rightResource=this.resourceManager.textures[this.jsonData.righttexture]),R.checkValueEmpty(this.jsonData.edgetexture)||(this.object.edgeResource=this.resourceManager.textures[this.jsonData.edgetexture])}}]),t}(I),z=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.attachWall=e.attachWall,i.createType="DoorOrWindow",i.pointInLineDeviation=.001,i}return _(t,e),y(t,[{key:"create",value:function(){b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=A.scale,i=this.jsonData,r=i.height*e,n=i.width*e,o=[i.pos[0]*e,0,i.pos[1]*e];this.attachWall=this._getPointOnWhichWall(this.objectParent,o),null===this.attachWall&&console.warn("can not find door on which wall!");var s=this.object;return i.suspendpercent&&(s.suspendPercent=i.suspendpercent),s.resource=this.resourceManager.create({id:s.id+"res",type:"EmptyModelResource"}),s.resource.size=[n,r,.15],s.position=o,this.object.attachWall=this.attachWall,this.attachWall.doorOrWindows.push(this.object),this.object}},{key:"_getPointOnWhichWall",value:function(e,t){var i=[],r=e.typeToChildren.StraightManualWall,n=e.typeToChildren.ModelWall;r&&(i=i.concat(r)),n&&(i=i.concat(n));for(var o=0;o<i.length;o++){var s=i[o];if(this._isPointOnLineAndBetweenPoints(R.convertToVector3(s.startCorner.position),R.convertToVector3(s.endCorner.position),R.convertToVector3(t)))return s}return null}},{key:"_isPointOnLine",value:function(e,t,i){var r=new S;return r.crossVectors(e.clone().sub(i),t.clone().sub(i)),r.length()<this.pointInLineDeviation}},{key:"_isPointOnLineAndBetweenPoints",value:function(e,t,i){if(!this._isPointOnLine(e,t,i))return!1;var r=t.x-e.x,n=t.z-e.z;return Math.abs(r)>=Math.abs(n)?r>0?e.x<=i.x&&i.x<=t.x:t.x<=i.x&&i.x<=e.x:n>0?e.z<=i.z&&i.z<=t.z:t.z<=i.z&&i.z<=e.z}}]),t}(D);function H(e,t){if(!(this instanceof H))return new H(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||V,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function V(e,t){return e<t?-1:e>t?1:0}function W(e,t,i){var r,n,o,s;t=t||1;for(var a=0;a<e[0].length;a++){var l=e[0][a];(!a||l[0]<r)&&(r=l[0]),(!a||l[1]<n)&&(n=l[1]),(!a||l[0]>o)&&(o=l[0]),(!a||l[1]>s)&&(s=l[1])}var u=o-r,c=s-n,h=Math.min(u,c),p=h/2,d=new H(null,G);if(0===h)return[r,n];for(var f=r;f<o;f+=h)for(var m=n;m<s;m+=h)d.push(new q(f+p,m+p,p,e));var g=J(e),v=new q(r+u/2,n+c/2,0,e);v.d>g.d&&(g=v);for(var y=d.length;d.length;){var b=d.pop();b.d>g.d&&(g=b,i&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,y)),b.max-g.d<=t||(p=b.h/2,d.push(new q(b.x-p,b.y-p,p,e)),d.push(new q(b.x+p,b.y-p,p,e)),d.push(new q(b.x-p,b.y+p,p,e)),d.push(new q(b.x+p,b.y+p,p,e)),y+=4)}return i&&(console.log("num probes: "+y),console.log("best distance: "+g.d)),[g.x,g.y]}function G(e,t){return t.max-e.max}function q(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=X(e,t,r),this.max=this.d+this.h*Math.SQRT2}function X(e,t,i){for(var r=!1,n=1/0,o=0;o<i.length;o++)for(var s=i[o],a=0,l=s.length,u=l-1;a<l;u=a++){var c=s[a],h=s[u];c[1]>t!=h[1]>t&&e<(h[0]-c[0])*(t-c[1])/(h[1]-c[1])+c[0]&&(r=!r),n=Math.min(n,Y(e,t,c,h))}return(r?1:-1)*Math.sqrt(n)}function J(e){for(var t=0,i=0,r=0,n=e[0],o=0,s=n.length,a=s-1;o<s;a=o++){var l=n[o],u=n[a],c=l[0]*u[1]-u[0]*l[1];i+=(l[0]+u[0])*c,r+=(l[1]+u[1])*c,t+=3*c}return 0===t?new q(n[0][0],n[0][1],0,e):new q(i/t,r/t,0,e)}function Y(e,t,i,r){var n=i[0],o=i[1],s=r[0]-n,a=r[1]-o;if(0!==s||0!==a){var l=((e-n)*s+(t-o)*a)/(s*s+a*a);l>1?(n=r[0],o=r[1]):l>0&&(n+=s*l,o+=a*l)}return(s=e-n)*s+(a=t-o)*a}H.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,i=this.compare,r=t[e];e>0;){var n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r},_down:function(e){for(var t=this.data,i=this.compare,r=this.length>>1,n=t[e];e<r;){var o=1+(e<<1),s=o+1,a=t[o];if(s<this.length&&i(t[s],a)<0&&(o=s,a=t[s]),i(a,n)>=0)break;t[e]=a,e=o}t[e]=n}};var Z=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return _(t,e),y(t,[{key:"create",value:function(){if(b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._createChildren(),this._parsePoints(),0!==this.object.points.length)return this._parseHolesPoints(),this._parseRoomResources(),this._parseRoomHeight(),this._parseRoomBlockSize(),this._parseRoomVisible(),this._parseRoomBlockAngle(),this.object.position=this._calRoomPosition(this.object),this._subRoomHolesPointsByPosition(this.object,this.object.position),this._subRoomPointsByPosition(this.object,this.object.position),this.object;console.error("room points is null")}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:k.FLOOR}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:k.CEILING}),this._parseJsonDataChild({jsonData:{},creatorType:k.ROOF}))}},{key:"_parsePoints",value:function(){if(this.jsonData.points){for(var e=[],t=0;t<this.jsonData.points.length;t++){var i=this.jsonData.points[t],r=[A.scale*i[0],0,A.scale*i[1]];e.push(r)}this.object.points=e}}},{key:"_parseHolesPoints",value:function(){if(this.jsonData.holes){for(var e=[],t=0;t<this.jsonData.holes.length;t++){for(var i=this.jsonData.holes[t],r=[],n=0;n<i.length;n++){var o=i[n],s=[A.scale*o[0],0,A.scale*o[1]];r.push(s)}e.push(r)}this.object.holes=e}}},{key:"_parseRoomResources",value:function(){this.object.floor.resource=A.defaultFloorTextureResource,this.object.ceiling.resource=A.defaultCeilingTextureResource,this.object.roof.resource=A.defaultRoofTextureResource,null!==this.jsonData.floortexture&&void 0!==this.jsonData.floortexture&&(this.object.floorResource=this.resourceManager.textures[this.jsonData.floortexture],this.object.floor.resource=this.object.floorResource),null!==this.jsonData.ceilingtexture&&void 0!==this.jsonData.ceilingtexture&&(this.object.ceilingResource=this.resourceManager.textures[this.jsonData.ceilingtexture],this.object.ceiling.resource=this.object.ceilingResource),null!==this.jsonData.rooftexture&&void 0!==this.jsonData.rooftexture&&(this.object.roofResource=this.resourceManager.textures[this.jsonData.rooftexture],this.object.roof.resource=this.object.roofResource)}},{key:"_parseRoomHeight",value:function(){var e=this.jsonData,t=this.object;void 0!==e.ceilingheight?t.ceiling.height=e.ceilingheight:(t.ceiling.DefaultHeight=this.objectParent.height-.1,t.ceiling.height=t.ceiling.DefaultHeight),void 0!==e.roofheight?t.roof.height=e.roofheight:(t.roof.defaultHeight=this.objectParent.height,t.roof.height=t.roof.defaultHeight),void 0!==e.floorheight&&(t.floor.height=e.floorheight)}},{key:"_parseRoomVisible",value:function(){var e=this.jsonData,t=this.object;void 0!==e.isshowfloor&&(t.floor.visible=e.isshowfloor),void 0!==e.isshowceiling&&(t.ceiling.visible=e.isshowceiling),void 0!==e.isshowroof&&(t.roof.visible=e.isshowroof)}},{key:"_parseRoomBlockSize",value:function(){var e=this.jsonData,t=this.object;if(e.floorblocksize){var i=e.floorblocksize;t.floor.blockSize=[i[0],i[1]]}if(e.ceilingblocksize){var r=e.ceilingblocksize;t.ceiling.blockSize=[r[0],r[1]]}if(e.roofblocksize){var n=e.roofblocksize;t.roof.blockSize=[n[0],n[1]]}}},{key:"_parseRoomBlockAngle",value:function(){var e=this.jsonData,t=this.object;R.checkValueEmpty(e.floorblockangle)||(t.floor.blockAngle=e.floorblockangle),R.checkValueEmpty(e.ceilingblockangle)||(t.ceiling.blockAngle=e.ceilingblockangle),R.checkValueEmpty(e.roofblockangle)||(t.roof.blockAngle=e.roofblockangle)}},{key:"_calRoomPosition",value:function(e){for(var t=e.points,i=e.holes,r=[],n=[],o=0;o<t.length;o++){var s=t[o];r.push([s[0],s[2]])}if(i.length>2&&!this._isSamePoints(i))for(o=0;o<i.length;o++){for(var a=i[o],l=[],u=0;u<a.length;u++)s=a[u],l.push([s[0],s[2]]);n.push(l)}var c=this._getLabelPosition(r,n);return c||[0,0,0]}},{key:"_isSamePoints",value:function(e){for(var t=e[0],i=1;i<e.length;i++){var r=e[i];if(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2])return!1}return!0}},{key:"_subRoomPointsByPosition",value:function(e,t){for(var i=e.points,r=0;r<i.length;r++){var n=i[r];n[0]-=t[0],n[1]-=t[1],n[2]-=t[2]}e.points=i}},{key:"_subRoomHolesPointsByPosition",value:function(e,t){for(var i=e.holes,r=0;r<i.length;r++)for(var n=i[r],o=0;o<n.length;o++){var s=n[o];s[0]-=t[0],s[1]-=t[1],s[2]-=t[2]}e.holes=i}},{key:"_getLabelPosition",value:function(e,t){if(!e||!e.length)return null;var i=[];i.push(e);var r=W(i);return[r[0],0,r[1]]}}]),t}(D),Q=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return _(t,e),t}(F),K=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Floor",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(D),$=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Roof",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(D),ee=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Ceiling",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(D),te=function(){function e(t){v(this,e),this._map={0:O,1:B,2:F,3:L,4:N,5:U,8:z,9:Z,10:Q,22:K,23:ee,24:$}}return y(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),ie=new(function(){function e(){v(this,e),this.objects=[],this._objectTypeConfig=null}return y(e,[{key:"create",value:function(e){var t=e.type;return new(0,this.objectTypeConfig[t])}},{key:"objectTypeConfig",set:function(e){this._objectTypeConfig=e},get:function(){return this._objectTypeConfig}}]),e}()),re=function(){function e(t){v(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl}return y(e,[{key:"createResource",value:function(e){var t=this.manager.create({type:e});return t.manager=this.manager,t}},{key:"loadTextures",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];t=r.localurl?this._loadLocalCustomTextureResource(r):this._loadTextureResource(r),this.manager.textures.push(t)}}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource("LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource("TextureResource");return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];if((t=r.model?this.createResource("CustomResource"):r.localurl?this.createResource("CustomModelResource"):this.createResource("ModelResource")).baseUrl=this.baseModelUrl,r.localurl){if(t.localUrl=r.localurl,t.id=r.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,r.title&&(t.modelName=r.title),t.modelID=r.id,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.color){var n=r.color;t.color=[n[0],n[1],n[2]],4===n.length&&(t.opacity=n[3])}}else if(r.id){if(t.id=r.id,t.modelID=r.id,t.version=r.version,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.model&&(t.modelID=r.model),r.title&&(t.modelName=r.title),r.color&&(n=r.color,t.color=[n[0],n[1],n[2]],4===n.length&&(t.opacity=n[3])),r.size){var o=r.size;t.size=[o[0],o[1],o[2]]}r.hasanimation&&(t.hasAnim=r.hasanimation),r.url&&(t.url=r.url)}for(var s=0;s<this.manager.ableToSupportFootAndHeadModelWalls.length;s++){var a=this.manager.ableToSupportFootAndHeadModelWalls[s];if(t.id===a){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var i=e.color;t.color=[i[0],i[1],i[2]],4===i.length&&(t.opacity=i[3])}if(e.size){var r=e.size;t.modelSize=[r[0],r[1],r[2]]}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),ne=function(){function e(t){v(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new te,t&&t.resourceLibraryUrl&&(this.resourceLibraryUrl=t.resourceLibraryUrl)}return y(e,[{key:"setObjectTypeConfig",value:function(e){ie.objectTypeConfig=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"setObjectManager",value:function(e){E.objectManager=e}},{key:"initDefaultResources",value:function(){this.createEmptyModelResource(),this.createEmptyTextureResource(),this.resourceLibraryUrl&&(this.resourceManager.baseTextureUrl=this.resourceLibraryUrl+"/texture/",this.resourceManager.baseModelUrl=this.resourceLibraryUrl+"/model/"),this.defaultFloorTextureResource=this.createResource("TextureResource"),this.defaultFloorTextureResource.id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",this.defaultFloorTextureResource.ext="jpg",this.defaultFloorTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultCeilingTextureResource=this.createResource("TextureResource"),this.defaultCeilingTextureResource.id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",this.defaultCeilingTextureResource.ext="jpg",this.defaultCeilingTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultRoofTextureResource=this.createResource("TextureResource"),this.defaultRoofTextureResource.id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",this.defaultRoofTextureResource.ext="jpg",this.defaultRoofTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultDoorResource=this.resourceManager.emptyModelResource,A.defaultFloorTextureResource=this.defaultFloorTextureResource,A.defaultCeilingTextureResource=this.defaultCeilingTextureResource,A.defaultRoofTextureResource=this.defaultRoofTextureResource,A.defaultDoorResource=this.defaultDoorResource}},{key:"createEmptyTextureResource",value:function(){var e=this.createResource("TextureResource");e.isBuilded=!0,e.texture=new THREE.Texture,e.isEmpty=!0,e.buildPromise=Promise.resolve(),this.resourceManager.emptyTextureResource=e}},{key:"createEmptyModelResource",value:function(){var e=this.createResource("ModelResource");e.isBuilded=!0,e.model=new THREE.Object3D,e.isEmpty=!0,e.buildPromise=Promise.resolve(),this.resourceManager.emptyModelResource=e}},{key:"loadLightMaps",value:function(e){var t=null,i="18091219l1g1hnjt",r="png",n="18091216vjlgtwbh";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(i=e.straightmanualwall.lightingtexture.id,r=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource("TextureResource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=i,t.ext=r,this.defaultResource.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource("TextureResource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=n,t.ext="jpg",this.defaultResource.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=this.resourceManager.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),t.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++)i+=t[r]+"/";return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,i){e.sceneJson?t(e.sceneJson):e.sceneURL?(new THREE.FileLoader).load(e.sceneURL,(function(i){e.sceneJson=JSON.parse(i),t()}),(function(){}),(function(t){i("can not load "+e.sceneURL)})):i("load scene json error")}))}},{key:"getResourceLoader",value:function(){return new re(this.resourceManager)}},{key:"parseSceneJson",value:function(){var e=this,t=this.getResourceLoader();this.loadLightMaps(e.sceneJson.materialsetting),this.initDefaultResources(),t.loadTextures(e.sceneJson.textures),t.loadModels(e.sceneJson.models),e.parseWorld(e.sceneJson)}},{key:"parseWorld",value:function(e){E.config=this.creatorTypeConfig,this.world=E.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:k.WORLD})}}]),e}(),oe=new(function(){function e(t){v(this,e),this.config=null}return y(e,[{key:"createObject",value:function(e){var t=new(this.config.getClass(e.creatorType))(e),i=t.create();return t.parseChildren(),i}}]),e}()),se=function(){function e(t){v(this,e),this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=t.jsonData,this.objectParent=null,t.parent&&(this.objectParent=t.parent),this.createType=null,this.resourceManager=t.resourceManager}return y(e,[{key:"create",value:function(){var e=this._getCreateParams();return this.object=oe.objectManager.create(e),this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.jsonData=this.jsonData,e.parent&&(this.object.parent=e.parent),R.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.object}},{key:"parseChildren",value:function(){}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,oe.createObject(e)}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),e}(),ae={scale:1,defaultFloorTextureResource:null,defaultCeilingTextureResource:null,defaultRoofTextureResource:null},le={WORLD:0,BUILDING:1,FLOORPLAN:2,WALLCORNER:3,MODELWALL:4,STRAIGHTMANUALWALL:5,PLACEMENT:6,PLACEMENTGROUP:7,DOORORWINDOW:8,ROOM:9,OUTDOORS:10,FACADE:11,FACADEGROUP:12,CURVELINE:13,LEAKWATERLINE:14,ARROWLINE:15,ARROWDATALINE:16,PIPELINE:17,ROUTELINE:18,VIDEOPROBE:19,FLOOR:22,CEILING:23,ROOF:24},ue=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return _(t,e),y(t,[{key:"create",value:function(){return this.jsonData.unit&&(ae.scale=.01*this.jsonData.unit),b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this)}},{key:"parseChildren",value:function(){var e=this.jsonData,t=(this._parseJsonDataChild({jsonData:e,creatorType:le.BUILDING}),this._parseJsonDataChild({jsonData:{},creatorType:le.OUTDOORS}));this.object.outdoors=t}}]),t}(se),ce=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return _(t,e),y(t,[{key:"parseChildren",value:function(){var e=this.jsonData;this._parseJsonDataChild({jsonData:e,creatorType:le.FLOORPLAN})}}]),t}(se),he=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.walls&&this._parseWalls(e.walls),e.rooms&&this._parseJsonDataChildren({jsonData:e.rooms,creatorType:le.ROOM}),e.doors&&this._parseJsonDataChildren({jsonData:e.doors,creatorType:le.DOORORWINDOW}),this.object.calRoomsUV2()}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];this._parseJsonDataChild({jsonData:i,creatorType:le.STRAIGHTMANUALWALL})}}}]),t}(se),pe=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="WallCorner",i}return _(t,e),y(t,[{key:"create",value:function(){b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=this.jsonData[0]*ae.scale,i=0,r=this.jsonData[1]*ae.scale;return this.object.position=[e,i,r],this.object}}]),t}(se),de=function(e){function t(e){return v(this,t),x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _(t,e),y(t,[{key:"_parseCorners",value:function(){var e=this.jsonData,t=(this.objectParent,e.start[0]*ae.scale),i=e.start[1]*ae.scale,r=null,n=null;r=this._existsCorner(t,0,i)?this._getCorner(t,0,i):this._createCorner(t,0,i,e.start),t=e.end[0]*ae.scale,i=e.end[1]*ae.scale,n=this._existsCorner(t,0,i)?this._getCorner(t,0,i):this._createCorner(t,0,i,e.end),this.object.startCorner=r,this.object.endCorner=n}},{key:"_existsCorner",value:function(e,t,i){var r=this.objectParent.typeToChildren.WallCorner;if(r)for(var n=0,o=r.length;n<o;n++){var s=r[n].position;if(s[0]===e&&s[1]===t&&s[2]===i)return!0}return!1}},{key:"_getCorner",value:function(e,t,i){for(var r=this.objectParent.typeToChildren.WallCorner,n=0,o=r.length;n<o;n++){var s=r[n].position;if(s[0]===e&&s[1]===t&&s[2]===i)return r[n]}return null}},{key:"_createCorner",value:function(e,t,i,r){var n=new pe({jsonData:r}).create();return n.parent=this.objectParent,n.jsonData=r,n}}]),t}(se),fe=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ModelWall",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),R.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),R.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),R.checkValueEmpty(this.jsonData.height)?this.object.height=this.object.resource.modelSize.y:this.object.height=this.jsonData.height,R.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}}]),t}(de),me=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="StraightManualWall",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),this._parseResources(),this.jsonData.uvmultiple&&(this.object.uvMultiple=this.jsonData.uvmultiple),R.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),R.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}},{key:"_parseResources",value:function(){this.object.leftResource=this.resourceManager.defaultWallTextureResource,this.object.rightResource=this.resourceManager.defaultWallTextureResource,this.object.edgeResource=this.resourceManager.defaultWallEdgeResource,this.object.lightMapResource=this.resourceManager.wallLightMapResource}}]),t}(de),ge=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.attachWall=e.attachWall,i.createType="DoorOrWindow",i.pointInLineDeviation=.001,i}return _(t,e),y(t,[{key:"create",value:function(){b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=ae.scale,i=this.jsonData,r=i.height*e,n=i.width*e,o=[i.pos[0]*e,0,i.pos[1]*e];this.attachWall=this._getPointOnWhichWall(this.objectParent,o),null===this.attachWall&&console.warn("can not find door on which wall!");var s=this.object;return i.suspendpercent&&(s.suspendPercent=i.suspendpercent),s.resource=this.resourceManager.create({id:s.id+"res",type:"EmptyModelResource"}),s.resource.size=[n,r,.15],s.position=o,this.object.attachWall=this.attachWall,this.attachWall.doorOrWindows.push(this.object),this.object}},{key:"_getPointOnWhichWall",value:function(e,t){var i=[],r=e.typeToChildren.StraightManualWall,n=e.typeToChildren.ModelWall;r&&(i=i.concat(r)),n&&(i=i.concat(n));for(var o=0;o<i.length;o++){var s=i[o];if(this._isPointOnLineAndBetweenPoints(R.convertToVector3(s.startCorner.position),R.convertToVector3(s.endCorner.position),R.convertToVector3(t)))return s}return null}},{key:"_isPointOnLine",value:function(e,t,i){var r=new S;return r.crossVectors(e.clone().sub(i),t.clone().sub(i)),r.length()<this.pointInLineDeviation}},{key:"_isPointOnLineAndBetweenPoints",value:function(e,t,i){if(!this._isPointOnLine(e,t,i))return!1;var r=t.x-e.x,n=t.z-e.z;return Math.abs(r)>=Math.abs(n)?r>0?e.x<=i.x&&i.x<=t.x:t.x<=i.x&&i.x<=e.x:n>0?e.z<=i.z&&i.z<=t.z:t.z<=i.z&&i.z<=e.z}}]),t}(se),ve=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return _(t,e),y(t,[{key:"create",value:function(){if(b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._createChildren(),this._parsePoints(),0!==this.object.points.length)return this._parseHolesPoints(),this._parseRoomResources(),this._parseRoomHeight(),this._parseRoomBlockSize(),this._parseRoomVisible(),this._parseRoomBlockAngle(),this.object;console.error("room points is null")}},{key:"_parsePoints",value:function(){if(this.jsonData.points){for(var e=[],t=0;t<this.jsonData.points.length;t++){var i=this.jsonData.points[t],r=[ae.scale*i[0],0,ae.scale*i[1]];e.push(r)}this.object.points=e}}},{key:"_parseHolesPoints",value:function(){if(this.jsonData.holes){for(var e=[],t=0;t<this.jsonData.holes.length;t++){for(var i=this.jsonData.holes[t],r=[],n=0;n<i.length;n++){var o=i[n],s=[ae.scale*o[0],0,ae.scale*o[1]];r.push(s)}e.push(r)}this.object.holes=e}}},{key:"_parseRoomResources",value:function(){this.object.floor.resource=ae.defaultFloorTextureResource,this.object.ceiling.resource=ae.defaultCeilingTextureResource,this.object.roof.resource=ae.defaultRoofTextureResource,null!==this.jsonData.floortexture&&void 0!==this.jsonData.floortexture&&(this.object.floorResource=this.resourceManager.textures[this.jsonData.floortexture],this.object.floor.resource=this.object.floorResource),null!==this.jsonData.ceilingtexture&&void 0!==this.jsonData.ceilingtexture&&(this.object.ceilingResource=this.resourceManager.textures[this.jsonData.ceilingtexture],this.object.ceiling.resource=this.object.ceilingResource),null!==this.jsonData.rooftexture&&void 0!==this.jsonData.rooftexture&&(this.object.roofResource=this.resourceManager.textures[this.jsonData.rooftexture],this.object.roof.resource=this.object.roofResource)}},{key:"_parseRoomHeight",value:function(){var e=this.jsonData,t=this.object;void 0!==e.ceilingheight?t.ceiling.height=e.ceilingheight:(t.ceiling.DefaultHeight=this.objectParent.height-.1,t.ceiling.height=t.ceiling.DefaultHeight),void 0!==e.roofheight?t.roof.height=e.roofheight:(t.roof.defaultHeight=this.objectParent.height,t.roof.height=t.roof.defaultHeight),void 0!==e.floorheight&&(t.floor.height=e.floorheight)}},{key:"_parseRoomVisible",value:function(){var e=this.jsonData,t=this.object;void 0!==e.isshowfloor&&(t.floor.isShow=e.isshowfloor),void 0!==e.isshowceiling&&(t.ceiling.isShow=e.isshowceiling),void 0!==e.isshowroof&&(t.roof.isShow=e.isshowroof)}},{key:"_parseRoomBlockSize",value:function(){var e=this.jsonData,t=this.object;if(e.floorblocksize){var i=e.floorblocksize;t.floor.blockSize=[i[0],i[1]]}if(e.ceilingblocksize){var r=e.ceilingblocksize;t.ceiling.blockSize=[r[0],r[1]]}if(e.roofblocksize){var n=e.roofblocksize;t.roof.blockSize=[n[0],n[1]]}}},{key:"_parseRoomBlockAngle",value:function(){var e=this.jsonData,t=this.object;R.checkValueEmpty(e.floorblockangle)||(t.floor.blockAngle=e.floorblockangle),R.checkValueEmpty(e.ceilingblockangle)||(t.ceiling.blockAngle=e.ceilingblockangle),R.checkValueEmpty(e.roofblockangle)||(t.roof.blockAngle=e.roofblockangle)}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:le.FLOOR}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:le.CEILING}),this._parseJsonDataChild({jsonData:{},creatorType:le.ROOF}))}}]),t}(se),ye=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return _(t,e),t}(he),be=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Floor",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(se),_e=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Roof",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(se),xe=function(e){function t(e){v(this,t);var i=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Ceiling",i}return _(t,e),y(t,[{key:"create",value:function(){return b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(se),Ee=function(){function e(t){v(this,e),this._map={0:ue,1:ce,2:he,3:pe,4:fe,5:me,8:ge,9:ve,10:ye,22:be,23:xe,24:_e}}return y(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),we=new(function(){function e(){v(this,e),this.objects=[],this._objectTypeConfig=null}return y(e,[{key:"create",value:function(e){var t=e.type;return new(0,this.objectTypeConfig[t])}},{key:"objectTypeConfig",set:function(e){this._objectTypeConfig=e},get:function(){return this._objectTypeConfig}}]),e}()),Te=function(){function e(t){v(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl}return y(e,[{key:"createResource",value:function(e){var t=this.manager.create({type:e});return t.manager=this.manager,t.baseUrl=this.manager.baseTextureUrl,t}},{key:"initDefaultResources",value:function(){var e=this.createResource("TextureResource");e.id="EB9ECFA1101C4A0ABB770ED3A9865441",e.ext="jpg",e.baseUrl=this.manager.baseTextureUrl,this.manager.defaultWallEdgeResource=e,this.manager.textures.push(e),(e=this.createResource("TextureResource")).id="81FDB96B43D441C5B3C650BFA2B76CD4",e.ext="jpg",e.isDefault=!0,this.manager.defaultWallTextureResource=e,this.manager.textures.push(e),(e=this.createResource("TextureResource")).id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",e.ext="jpg",this.manager.defaultFloorTextureResource=e,this.manager.textures.push(e),(e=this.createResource("TextureResource")).id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",e.ext="jpg",this.manager.defaultCeilingTextureResource=e,this.manager.textures.push(e),(e=this.createResource("TextureResource")).id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",e.ext="jpg",this.manager.defaultRoofTextureResource=e,this.manager.textures.push(e)}}]),e}(),Me=function(){function e(t){v(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new Ee,t&&t.resourceLibraryUrl&&(this.resourceLibraryUrl=t.resourceLibraryUrl)}return y(e,[{key:"setObjectTypeConfig",value:function(e){we.objectTypeConfig=e}},{key:"setObjectManager",value:function(e){oe.objectManager=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"initDefaultResources",value:function(){this.resourceLibraryUrl&&(this.resourceManager.baseTextureUrl=this.resourceLibraryUrl+"/texture/",this.resourceManager.baseModelUrl=this.resourceLibraryUrl+"/model/"),this.defaultFloorTextureResource=this.createResource("TextureResource"),this.defaultFloorTextureResource.id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",this.defaultFloorTextureResource.ext="jpg",this.defaultFloorTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultCeilingTextureResource=this.createResource("TextureResource"),this.defaultCeilingTextureResource.id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",this.defaultCeilingTextureResource.ext="jpg",this.defaultCeilingTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultRoofTextureResource=this.createResource("TextureResource"),this.defaultRoofTextureResource.id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",this.defaultRoofTextureResource.ext="jpg",this.defaultRoofTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultDoorResource=this.resourceManager.emptyModelResource,ae.defaultFloorTextureResource=this.defaultFloorTextureResource,ae.defaultCeilingTextureResource=this.defaultCeilingTextureResource,ae.defaultRoofTextureResource=this.defaultRoofTextureResource,ae.defaultDoorResource=this.defaultDoorResource}},{key:"loadLightMaps",value:function(e){var t=null,i="18091219l1g1hnjt",r="png",n="18091216vjlgtwbh";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(i=e.straightmanualwall.lightingtexture.id,r=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource("TextureResource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=i,t.ext=r,this.resourceManager.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource("TextureResource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=n,t.ext="jpg",this.resourceManager.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=this.resourceManager.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),t.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++)i+=t[r]+"/";return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,i){e.sceneJson?t(e.sceneJson):e.sceneURL?(new THREE.FileLoader).load(e.sceneURL,(function(i){e.sceneJson=JSON.parse(i),t()}),(function(){}),(function(t){i("can not load "+e.sceneURL)})):i("load scene json error")}))}},{key:"getResourceMaanagerLoader",value:function(){return new Te(this.resourceManager)}},{key:"parseSceneJson",value:function(){var e=this,t=this.getResourceMaanagerLoader();this.loadLightMaps(e.sceneJson.materialsetting),t.initDefaultResources(),this.initDefaultResources(),e.parseWorld(e.sceneJson)}},{key:"parseWorld",value:function(e){oe.config=this.creatorTypeConfig,this.world=oe.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:le.WORLD})}}]),e}(),Ce=new(function(){function e(t){v(this,e),this._map={0:new Me,2:new ne},this._versions=[0]}return y(e,[{key:"getLoaderManager",value:function(e){return null!=e?this._map[e]:this._map[this._versions.length-1]}}]),e}()),Se=function(){function e(t){v(this,e),this.resourceManager=t.resourceManager,this.defaultSetting=t.defaultSetting,this.defaultResource=t.defaultResource,this.objectManager=t.objectManager,t.version&&(this.version=t.version)}return y(e,[{key:"load",value:function(e){var t=Ce.getLoaderManager(this._getVersion(e));return t.setDefaultSetting(this.defaultSetting),t.setDefaultResource(this.defaultResource),t.setResourceManager(this.resourceManager),t.setObjectManager(this.objectManager),t.parseObjects(e)}},{key:"_getVersion",value:function(e){return null!==e.version&&void 0!==e.version?e.version:null!==e.json.version&&void 0!==e.json.version?e.json.version:void 0}}]),e}();function je(e,t){return e(t={exports:{}},t.exports),t.exports}var Pe=je((function(e){!function(t){var i,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag",u=t.regeneratorRuntime;if(u)e.exports=u;else{(u=t.regeneratorRuntime=e.exports).wrap=_;var c="suspendedStart",p="suspendedYield",d="executing",f="completed",m={},g={};g[s]=function(){return this};var v=Object.getPrototypeOf,y=v&&v(v(A([])));y&&y!==r&&n.call(y,s)&&(g=y);var b=T.prototype=E.prototype=Object.create(g);w.prototype=b.constructor=T,T.constructor=w,T[l]=w.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,T):(e.__proto__=T,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(b),e},u.awrap=function(e){return{__await:e}},M(C.prototype),C.prototype[a]=function(){return this},u.AsyncIterator=C,u.async=function(e,t,i,r){var n=new C(_(e,t,i,r));return u.isGeneratorFunction(t)?n:n.next().then((function(e){return e.done?e.value:n.next()}))},M(b),b[l]="Generator",b[s]=function(){return this},b.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var r=t.pop();if(r in e)return i.value=r,i.done=!1,i}return i.done=!0,i}},u.values=A,D.prototype={constructor:D,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=i)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=i),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var l=n.call(s,"catchLoc"),u=n.call(s,"finallyLoc");if(l&&u){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),R(i),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;R(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=i),m}}}function _(e,t,i,r){var n=t&&t.prototype instanceof E?t:E,o=Object.create(n.prototype),s=new D(r||[]);return o._invoke=S(e,i,s),o}function x(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}function E(){}function w(){}function T(){}function M(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function C(e){function t(i,r,o,s){var a=x(e[i],e,r);if("throw"!==a.type){var l=a.arg,u=l.value;return u&&"object"===(void 0===u?"undefined":h(u))&&n.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,o,s)}),(function(e){t("throw",e,o,s)})):Promise.resolve(u).then((function(e){l.value=e,o(l)}),s)}s(a.arg)}var i;function r(e,r){function n(){return new Promise((function(i,n){t(e,r,i,n)}))}return i=i?i.then(n,n):n()}this._invoke=r}function S(e,t,i){var r=c;return function(n,o){if(r===d)throw new Error("Generator is already running");if(r===f){if("throw"===n)throw o;return k()}for(i.method=n,i.arg=o;;){var s=i.delegate;if(s){var a=j(s,i);if(a){if(a===m)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===c)throw r=f,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=d;var l=x(e,t,i);if("normal"===l.type){if(r=i.done?f:p,l.arg===m)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=f,i.method="throw",i.arg=l.arg)}}}function j(e,t){var r=e.iterator[t.method];if(r===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=i,j(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var n=x(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,m;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=i),t.delegate=null,m):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function A(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=i,t.done=!0,t};return o.next=o}}return{next:k}}function k(){return{value:i,done:!0}}}(function(){return this}()||Function("return this")())})),Re=function(){return this}()||Function("return this")(),De=Re.regeneratorRuntime&&Object.getOwnPropertyNames(Re).indexOf("regeneratorRuntime")>=0,Ae=De&&Re.regeneratorRuntime;Re.regeneratorRuntime=void 0;var ke=Pe;if(De)Re.regeneratorRuntime=Ae;else try{delete Re.regeneratorRuntime}catch(e){Re.regeneratorRuntime=void 0}var Oe=ke,Be=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();function Fe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Le=function(){function e(t){Fe(this,e),this._initParams(),this.resource=t,this.objects=[],this.isBuilded=!1,this._awaitToNextBuildTime=.01,this._maxBuildTime=1e3}return Be(e,[{key:"_initParams",value:function(){this.resource=null,this.objects=null,this.isBuilded=null}},{key:"add",value:function(e){this.objects.push(e)}},{key:"build",value:function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t.isContainer?t.buildSelf():t.build()}this.isBuilded=!0}},{key:"containByClassType",value:function(e){for(var t=0;t<this.objects.length;t++)if(this.objects[t].type===e)return!0;return!1}},{key:"clear",value:function(){this._initParams()}}]),e}(),Ie=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();function Ne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Ue=function(){function e(t){Ne(this,e),this.manager=t,this._initParams(),this.resources=[],this.isBuilded=!1}return Ie(e,[{key:"_initParams",value:function(){this.resources=null,this.isBuilded=null,this._allBuildedCallback=null}},{key:"add",value:function(e){this.resources.push(e)}},{key:"build",value:function(e){this._allBuildedCallback=e;for(var t=0;t<this.resources.length;t++){var i=this.resources[t];i.registerBuildCallbackListener(this._checkAllResourceBuilded,{unit:this}),i.build()}}},{key:"_checkAllResourceBuilded",value:function(e,t){var i=t.unit;if(!i.isBuilded){for(var r=i.resources,n=0;n<r.length;n++)if(!r[n].isBuilded)return;i.isBuilded=!0,i._allBuildedCallback&&i._allBuildedCallback()}}},{key:"clear",value:function(){this._initParams()}},{key:"isFull",get:function(){return this.resources.length>this.manager.maxResourcesUnitDownloadNumber}}]),e}(),ze=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();function He(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Ve=function(){function e(t){He(this,e),this._initParams(),this.buildUnits=[]}return ze(e,[{key:"_initParams",value:function(){this.buildUnits=null,this.currentAddingBuildUnit=null}},{key:"addResourceDownloadRequest",value:function(e){this.currentAddingBuildUnit&&!this.currentAddingBuildUnit.isFull||(this.currentAddingBuildUnit=new Ue,this.buildUnits.push(this.currentAddingBuildUnit)),this.currentAddingBuildUnit.add(e)}},{key:"startToDownloadRequestResources",value:function(e){var t=this;if(0!==t.requestDownloadResources.length&&(this.downloadResProgess=(this.curDonwloadResIndex-this.currentDownloadResMap.size)/t.requestDownloadResources.length,e&&e(this.downloadResProgess)),this.isStartedDonwloadResouces){if(this.curDonwloadResIndex===this.requestDownloadResources.length-1&&0===this.currentDownloadResMap.size)return this.downloadResProgess=1,void(e&&e(this.downloadResProgess))}else t.requestDownloadResources,this.isStartedDonwloadResouces=!0,this.curDonwloadResIndex=0,this.currentDownloadResMap=new Map;if(0===this.requestDownloadResources.length)return this.downloadResProgess=1,void(e&&e(this.downloadResProgess));if(!(this.curDonwloadResIndex>this.requestDownloadResources.length-1)&&0!=this.downloadResMaxCount-this.currentDownloadResMap.size){var i=this.requestDownloadResources[this.curDonwloadResIndex];new Promise((function(e,t){i.registerBuildCallbackListener((function(){e(i)})),i.build()})).then((function(i){t.currentDownloadResMap.delete(i.id),t.startToDownloadRequestResources(e)})),this.currentDownloadResMap.set(i.id,i),this.curDonwloadResIndex++,this.startToDownloadRequestResources(e)}}},{key:"clear",value:function(){this._initParams()}}]),e}(),We=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();function Ge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var qe=new(function(){function e(t){Ge(this,e),this.id="empty",this.isBuilded=!1,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[]}return We(e,[{key:"build",value:function(e){e&&e(this),this.isBuilded=!0,this.notifyBuildCompleteListeners()}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"notifyBuildCompleteListeners",value:function(){for(var e=0;e<this.buildCompleteCallbacks.length;e++)(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e]);this._alreadyCallback=!0}}]),e}()),Xe=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();function Je(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,i){function r(n,o){try{var s=t[n](o),a=s.value}catch(e){return void i(e)}if(!s.done)return Promise.resolve(a).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(a)}return r("next")}))}}function Ye(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Ze=function(){function e(){Ye(this,e),this._initParams(),this.resourceBuildManager=new Ve,this.objectsBuildUnitMap=new Map,this.objectsBuildUnits=[],this.modelsResourcesBuildUnits=[],this.textureResourcesBuildUnits=[],this._emptyResource=qe,this.currentBuildingResourcesUnit=null,this.maxResourcesUnitDownloadNumber=200,this.awaitToNextBuildTime=12e3}return Xe(e,[{key:"_initParams",value:function(){this.resourceBuildManager=null,this.world=null,this.objectsBuildUnitMap=null,this.objectsBuildUnits=null,this.readyResourceUnits=null,this.unreadyResourceUnits=null,this._stopUpdateBuild=null,this._buildingUnits=null,this.buildingProgressCallback=null,this._awaitToNextBuildTime=0,this._resourceBuildUnitAwaitToNextBuildTime=null,this._resourceBuildUnitMaxBuildTime=null,this._emptyResource=null}},{key:"build",value:function(e){this.buildingProgressCallback=e,this.initRequestBuildUnits(),this._buildingUnits=[].concat(this.readyResourceUnits).concat(this.unreadyResourceUnits);for(var t=0;t<this._buildingUnits.length;t++){var i=this._buildingUnits[t].resource;null!==i&&this.addResourceDownloadRequest(i)}this._stopUpdateBuild=!1,this._updateBuildUnit()}},{key:"addResourceDownloadRequest",value:function(e){"TextureResource"===e.type?((0===this.textureResourcesBuildUnits.length||this.textureResourcesBuildUnits[this.textureResourcesBuildUnits.length-1].isFull)&&this.textureResourcesBuildUnits.push(new Ue(this)),this.textureResourcesBuildUnits[this.textureResourcesBuildUnits.length-1].add(e)):((0===this.modelsResourcesBuildUnits.length||this.modelsResourcesBuildUnits[this.modelsResourcesBuildUnits.length-1].isFull)&&this.modelsResourcesBuildUnits.push(new Ue(this)),this.modelsResourcesBuildUnits[this.modelsResourcesBuildUnits.length-1].add(e))}},{key:"initRequestBuildUnits",value:function(){this.sortobjectsBuildUnits(),this.readyResourceUnits=[],this.unreadyResourceUnits=[];for(var e=0;e<this.objectsBuildUnits.length;e++){var t=this.objectsBuildUnits[e],i=t.resource;i&&i.ready?this.readyResourceUnits.push(t):i&&this.unreadyResourceUnits.push(t)}}},{key:"sortobjectsBuildUnits",value:function(){for(var e=[],t=[],i=[],r=[],n=[],o=[],s=[],a=[],l=0;l<this.objectsBuildUnits.length;l++){var u=this.objectsBuildUnits[l];u.containByClassType("CombineStraightManualWall")?e.push(u):u.containByClassType("CombineRoof")?o.push(u):u.containByClassType("CombineModelWall")?i.push(u):u.containByClassType("CombinePlacementWall")?r.push(u):u.containByClassType("CombineFloor")?s.push(u):u.containByClassType("CombineCeiling")?n.push(u):u.containByClassType("CombineDoorOrWindow")?a.push(u):t.push(u)}this.objectsBuildUnits=[].concat(e).concat(o).concat(s).concat(n).concat(a).concat(i).concat(r).concat(t)}},{key:"_updateBuildUnit",value:function(){if(0!==this.textureResourcesBuildUnits.length||0!==this.modelsResourcesBuildUnits.length){var e=this;this.currentBuildingResourcesUnit||(0!==this.textureResourcesBuildUnits.length?this.currentBuildingResourcesUnit=this.textureResourcesBuildUnits.shift():0!==this.modelsResourcesBuildUnits.length&&(this.currentBuildingResourcesUnit=this.modelsResourcesBuildUnits.shift())),this.currentBuildingResourcesUnit.build((function(){e._buildResourcesUnitToObjectsUnit()}))}else this._stopUpdateBuild||this.checkBuildComplete()}},{key:"_buildResourcesUnitToObjectsUnit",value:function(){var e=Je(Oe.mark((function e(){var t,i,r,n;return Oe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=(t=this).currentBuildingResourcesUnit.resources,r=new Date;case 3:if(0!==i.length){e.next=10;break}return t.currentBuildingResourcesUnit=null,t._updateBuildUnit(),e.abrupt("return");case 10:if(n=i.shift(),t.objectsBuildUnitMap.get(n).build(),!(new Date-r>this.awaitToNextBuildTime)){e.next=16;break}return e.next=16,this.awaitToNextBuild();case 16:this.checkBuildComplete();case 17:e.next=3;break;case 19:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"checkBuildComplete",value:function(){for(var e=[],t=!0,i=0;i<this.objectsBuildUnits.length;i++){var r=this.objectsBuildUnits[i];r.isBuilded?e.push(r):t=!1}var n=null;0===this.objectsBuildUnits.length?(t=!0,n=1):n=e.length/this.objectsBuildUnits.length,t&&this._clearUpdateBuildUnit(),this.buildingProgressCallback&&this.buildingProgressCallback(n)}},{key:"_clearUpdateBuildUnit",value:function(){if(this.objectsBuildUnits)for(var e=0;e<this.objectsBuildUnits.length;e++)this.objectsBuildUnits[e].clear();if(this.unreadyResourceUnits)for(var t=0;t<this.unreadyResourceUnits.length;t++)this.unreadyResourceUnits[t].clear();if(this.readyResourceUnits)for(var i=0;i<this.readyResourceUnits.length;i++)this.readyResourceUnits[i].clear();this.objectsBuildUnits=[],this.unreadyResourceUnits=[],this.readyResourceUnits=[],this.objectsBuildUnitMap.clear(),this._stopUpdateBuild=!0}},{key:"awaitToNextBuild",value:function(){var e=this;return new Promise((function(t){setTimeout((function(){t("resolved")}),e._awaitToNextBuildTime)}))}},{key:"requestToBuild",value:function(e){var t=this.world.findObjectByID(e);null!==t&&this.addObject(t)}},{key:"disposeObject",value:function(e){var t=this.world.findObjectByID(e);t&&t.clearBuildMesh()}},{key:"addObject",value:function(e){this.addChildren(e);var t=e.resources;if(t.length>0)for(var i=0;i<t.length;i++){var r=t[i];this.addSingleResourceObject(e,r)}else this.addSingleResourceObject(e,this._emptyResource)}},{key:"addChildren",value:function(e){for(var t=e.children,i=0;i<t.length;i++){var r=t[i];this.addObject(r)}}},{key:"addSingleResourceObject",value:function(e,t){if(t||null!=(t=e.resource)){if(!this.objectsBuildUnitMap.has(t)){var i=new Le(t);this.objectsBuildUnits.push(i),this.objectsBuildUnitMap.set(t,i)}this.objectsBuildUnitMap.get(t).add(e)}}},{key:"clear",value:function(){this.resourceBuildManager.clear(),this._clearUpdateBuildUnit(),this._initParams()}}]),e}(),Qe={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),r=0;return function(){for(var n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Qe.DEG2RAD},radToDeg:function(e){return e*Qe.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},Ke=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},$e=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),et=function(){function e(t,i,r,n){Ke(this,e),this._x=t||0,this._y=i||0,this._z=r||0,this._w=void 0!==n?n:1}return $e(e,[{key:"slerp",value:function(e,t,i,r){return i.copy(e).slerp(t,r)}},{key:"slerpFlat",value:function(e,t,i,r,n,o,s){var a=i[r+0],l=i[r+1],u=i[r+2],c=i[r+3],h=n[o+0],p=n[o+1],d=n[o+2],f=n[o+3];if(c!==f||a!==h||l!==p||u!==d){var m=1-s,g=a*h+l*p+u*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,s=Math.sin(s*_)/b}var x=s*v;if(a=a*m+h*x,l=l*m+p*x,u=u*m+d*x,c=c*m+f*x,m===1-s){var E=1/Math.sqrt(a*a+l*l+u*u+c*c);a*=E,l*=E,u*=E,c*=E}}e[t]=a,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"set",value:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,r=e._y,n=e._z,o=e.order,s=Math.cos,a=Math.sin,l=s(i/2),u=s(r/2),c=s(n/2),h=a(i/2),p=a(r/2),d=a(n/2);return"XYZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"YXZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"ZXY"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"ZYX"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"YZX"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c-h*p*d):"XZY"===o&&(this._x=h*u*c-l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c+h*p*d),!1!==t&&this.onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this.onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],s=i[1],a=i[5],l=i[9],u=i[2],c=i[6],h=i[10],p=r+a+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(s-n)*t):r>a&&r>h?(t=2*Math.sqrt(1+r-a-h),this._w=(c-l)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(o+u)/t):a>h?(t=2*Math.sqrt(1+a-r-h),this._w=(o-u)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-r-a),this._w=(s-n)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var i,r=new tt,n=1e-6;return void 0===r&&(r=new tt),(i=e.dot(t)+1)<n?(i=0,Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0):r.set(0,-e.z,e.y)):r.crossVectors(e,t),this._x=r.x,this._y=r.y,this._z=r.z,this._w=i,this.normalize()}},{key:"inverse",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,s=t._x,a=t._y,l=t._z,u=t._w;return this._x=i*u+o*s+r*l-n*a,this._y=r*u+o*a+n*s-i*l,this._z=n*u+o*l+i*a-r*s,this._w=o*u-i*s-r*a-n*l,this.onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,s=o*e._w+i*e._x+r*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(r+this._y),this._z=.5*(n+this._z),this;var l=Math.atan2(a,s),u=Math.sin((1-t)*l)/a,c=Math.sin(t*l)/a;return this._w=o*u+this._w*c,this._x=i*u+this._x*c,this._y=r*u+this._y*c,this._z=n*u+this._z*c,this.onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"onChange",value:function(e){return this.onChangeCallback=e,this}},{key:"onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}]),e}(),tt=function(){function e(t,i,r){Ke(this,e),this.x=t||0,this.y=i||0,this.z=r||0,this.isVector3=!0}return $e(e,[{key:"set",value:function(e,t,i){return this.x=e,this.y=t,this.z=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(){var e=new et;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}()}},{key:"applyAxisAngle",value:function(){var e=new et;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i))}()}},{key:"applyMatrix3",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}},{key:"applyQuaternion",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*i,u=a*i+s*t-n*r,c=a*r+n*i-o*t,h=-n*t-o*i-s*r;return this.x=l*a+h*-n+u*-s-c*-o,this.y=u*a+h*-o+c*-n-l*-s,this.z=c*a+h*-s+l*-o-u*-n,this}},{key:"transformDirection",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(){var t=new e,i=new e;return function(e,r){return t.set(e,e,e),i.set(r,r,r),this.clamp(t,i)}()}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-i*e.z,this.z=i*e.y-r*e.x,this}},{key:"crossVectors",value:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this}},{key:"projectOnVector",value:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)}},{key:"projectOnPlane",value:function(){var t=new e;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}},{key:"reflect",value:function(){var t=new e;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}()}},{key:"angleTo",value:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Qe.clamp(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this}},{key:"setFromCylindrical",value:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}]),e}(),it=function(){function e(t,i){Ke(this,e),this.isBox3=!0,this.min=void 0!==t?t:new tt(1/0,1/0,1/0),this.max=void 0!==i?i:new tt(-1/0,-1/0,-1/0)}return $e(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,l=e.length;a<l;a+=3){var u=e[a],c=e[a+1],h=e[a+2];u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,i,r),this.max.set(n,o,s),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,l=e.count;a<l;a++){var u=e.getX(a),c=e.getY(a),h=e.getZ(a);u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,i,r),this.max.set(n,o,s),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var i=(new tt).copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){var t=e||new tt;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){var t=e||new tt;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=new tt,i=this;return e.updateMatrixWorld(!0),e.traverse((function(e){var r,n,o=e.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(r=0,n=s.length;r<n;r++)t.copy(s[r]),t.applyMatrix4(e.matrixWorld),i.expandByPoint(t)}else if(o.isBufferGeometry){var a=o.attributes.position;if(void 0!==a)for(r=0,n=a.count;r<n;r++)t.fromBufferAttribute(a,r).applyMatrix4(e.matrixWorld),i.expandByPoint(t)}})),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return(t||new tt).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsPlane",value:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=e.constant&&i>=e.constant}},{key:"clampPoint",value:function(e,t){return(t||new tt).copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return(new tt).copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){var t=[new tt,new tt,new tt,new tt,new tt,new tt,new tt,new tt];return this.isEmpty()||(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();function rt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(rt.prototype,{isMatrix4:!0,set:function(e,t,i,r,n,o,s,a,l,u,c,h,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new rt).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(){var e=new tt;return function(t){var i=this.elements,r=t.elements,n=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),s=1/e.setFromMatrixColumn(t,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[4]=r[4]*o,i[5]=r[5]*o,i[6]=r[6]*o,i[8]=r[8]*s,i[9]=r[9]*s,i[10]=r[10]*s,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,o=Math.cos(i),s=Math.sin(i),a=Math.cos(r),l=Math.sin(r),u=Math.cos(n),c=Math.sin(n);if("XYZ"===e.order){var h=o*u,p=o*c,d=s*u,f=s*c;t[0]=a*u,t[4]=-a*c,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-s*a,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*a}else if("YXZ"===e.order){var m=a*u,g=a*c,v=l*u,y=l*c;t[0]=m+y*s,t[4]=v*s-g,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-s,t[2]=g*s-v,t[6]=y+m*s,t[10]=o*a}else if("ZXY"===e.order)m=a*u,g=a*c,v=l*u,y=l*c,t[0]=m-y*s,t[4]=-o*c,t[8]=v+g*s,t[1]=g+v*s,t[5]=o*u,t[9]=y-m*s,t[2]=-o*l,t[6]=s,t[10]=o*a;else if("ZYX"===e.order)h=o*u,p=o*c,d=s*u,f=s*c,t[0]=a*u,t[4]=d*l-p,t[8]=h*l+f,t[1]=a*c,t[5]=f*l+h,t[9]=p*l-d,t[2]=-l,t[6]=s*a,t[10]=o*a;else if("YZX"===e.order){var b=o*a,_=o*l,x=s*a,E=s*l;t[0]=a*u,t[4]=E-b*c,t[8]=x*c+_,t[1]=c,t[5]=o*u,t[9]=-s*u,t[2]=-l*u,t[6]=_*c+x,t[10]=b-E*c}else"XZY"===e.order&&(b=o*a,_=o*l,x=s*a,E=s*l,t[0]=a*u,t[4]=-c,t[8]=l*u,t[1]=b*c+E,t[5]=o*u,t[9]=_*c-x,t[2]=x*c-_,t[6]=s*u,t[10]=E*c+b);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e._x,r=e._y,n=e._z,o=e._w,s=i+i,a=r+r,l=n+n,u=i*s,c=i*a,h=i*l,p=r*a,d=r*l,f=n*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(p+f),t[4]=c-v,t[8]=h+g,t[1]=c+v,t[5]=1-(u+f),t[9]=d-m,t[2]=h-g,t[6]=d+m,t[10]=1-(u+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new tt,t=new tt,i=new tt;return function(r,n,o){var s=this.elements;return i.subVectors(r,n),0===i.lengthSq()&&(i.z=1),i.normalize(),e.crossVectors(o,i),0===e.lengthSq()&&(1===Math.abs(o.z)?i.x+=1e-4:i.z+=1e-4,i.normalize(),e.crossVectors(o,i)),e.normalize(),t.crossVectors(i,e),s[0]=e.x,s[4]=t.x,s[8]=i.x,s[1]=e.y,s[5]=t.y,s[9]=i.y,s[2]=e.z,s[6]=t.z,s[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],u=i[1],c=i[5],h=i[9],p=i[13],d=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],_=i[15],x=r[0],E=r[4],w=r[8],T=r[12],M=r[1],C=r[5],S=r[9],j=r[13],P=r[2],R=r[6],D=r[10],A=r[14],k=r[3],O=r[7],B=r[11],F=r[15];return n[0]=o*x+s*M+a*P+l*k,n[4]=o*E+s*C+a*R+l*O,n[8]=o*w+s*S+a*D+l*B,n[12]=o*T+s*j+a*A+l*F,n[1]=u*x+c*M+h*P+p*k,n[5]=u*E+c*C+h*R+p*O,n[9]=u*w+c*S+h*D+p*B,n[13]=u*T+c*j+h*A+p*F,n[2]=d*x+f*M+m*P+g*k,n[6]=d*E+f*C+m*R+g*O,n[10]=d*w+f*S+m*D+g*B,n[14]=d*T+f*j+m*A+g*F,n[3]=v*x+y*M+b*P+_*k,n[7]=v*E+y*C+b*R+_*O,n[11]=v*w+y*S+b*D+_*B,n[15]=v*T+y*j+b*A+_*F,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new tt;return function(t){for(var i=0,r=t.count;i<r;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix4(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],s=e[5],a=e[9],l=e[13],u=e[2],c=e[6],h=e[10],p=e[14];return e[3]*(+n*a*c-r*l*c-n*s*h+i*l*h+r*s*p-i*a*p)+e[7]*(+t*a*p-t*l*h+n*o*h-r*o*p+r*l*u-n*a*u)+e[11]*(+t*l*c-t*s*p-n*o*c+i*o*p+n*s*u-i*l*u)+e[15]*(-r*s*u-t*a*c+t*s*h+r*o*c-i*o*h+i*a*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],o=r[1],s=r[2],a=r[3],l=r[4],u=r[5],c=r[6],h=r[7],p=r[8],d=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],b=r[15],_=d*y*h-v*f*h+v*c*m-u*y*m-d*c*b+u*f*b,x=g*f*h-p*y*h-g*c*m+l*y*m+p*c*b-l*f*b,E=p*v*h-g*d*h+g*u*m-l*v*m-p*u*b+l*d*b,w=g*d*c-p*v*c-g*u*f+l*v*f+p*u*y-l*d*y,T=n*_+o*x+s*E+a*w;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var C=1/T;return i[0]=_*C,i[1]=(v*f*a-d*y*a-v*s*m+o*y*m+d*s*b-o*f*b)*C,i[2]=(u*y*a-v*c*a+v*s*h-o*y*h-u*s*b+o*c*b)*C,i[3]=(d*c*a-u*f*a-d*s*h+o*f*h+u*s*m-o*c*m)*C,i[4]=x*C,i[5]=(p*y*a-g*f*a+g*s*m-n*y*m-p*s*b+n*f*b)*C,i[6]=(g*c*a-l*y*a-g*s*h+n*y*h+l*s*b-n*c*b)*C,i[7]=(l*f*a-p*c*a+p*s*h-n*f*h-l*s*m+n*c*m)*C,i[8]=E*C,i[9]=(g*d*a-p*v*a-g*o*m+n*v*m+p*o*b-n*d*b)*C,i[10]=(l*v*a-g*u*a+g*o*h-n*v*h-l*o*b+n*u*b)*C,i[11]=(p*u*a-l*d*a-p*o*h+n*d*h+l*o*m-n*u*m)*C,i[12]=w*C,i[13]=(p*v*s-g*d*s+g*o*f-n*v*f-p*o*y+n*d*y)*C,i[14]=(g*u*s-l*v*s-g*o*c+n*v*c+l*o*y-n*u*y)*C,i[15]=(l*d*s-p*u*s+p*o*c-n*d*c-l*o*f+n*u*f)*C,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,s=e.y,a=e.z,l=n*o,u=n*s;return this.set(l*o+i,l*s-r*a,l*a+r*s,0,l*s+r*a,u*s+i,u*a-r*o,0,l*a-r*s,u*a+r*o,n*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e=new tt,t=new rt;return function(i,r,n){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),i.x=o[12],i.y=o[13],i.z=o[14],t.copy(this);var u=1/s,c=1/a,h=1/l;return t.elements[0]*=u,t.elements[1]*=u,t.elements[2]*=u,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,r.setFromRotationMatrix(t),n.x=s,n.y=a,n.z=l,this}}(),makePerspective:function(e,t,i,r,n,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,a=2*n/(t-e),l=2*n/(i-r),u=(t+e)/(t-e),c=(i+r)/(i-r),h=-(o+n)/(o-n),p=-2*o*n/(o-n);return s[0]=a,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(e,t,i,r,n,o){var s=this.elements,a=1/(t-e),l=1/(i-r),u=1/(o-n),c=(t+e)*a,h=(i+r)*l,p=(o+n)*u;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}),function(){function e(t,i){Ke(this,e),this.x=t||0,this.y=i||0,this.isVector2=!0}$e(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(){var t=new e,i=new e;return function(e,r){return t.set(e,e),i.set(r,r),this.clamp(t,i)}()}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}},{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}}])}();var nt="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},ot=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},st=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),at=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},lt=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},ut=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},ct={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},ht=function(){function e(){ot(this,e)}return st(e,null,[{key:"uuid",value:function(){for(var e,t=ct.chars,i=ct.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":nt(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}},{key:"calTwoPositionLength",value:function(t,i){var r=e.subPosition(t,i);return r=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],Math.sqrt(r)}},{key:"subPosition",value:function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}},{key:"normalizeDirection",value:function(t){var i=e.calTwoPositionLength([0,0,0],t);if(1===i)return t;var r=t;return 0===i?(r[0]=0,r[1]=0,r[2]=0,r):(i=1/i,r[0]*=i,r[1]*=i,r[2]*=i,r)}}]),e}(),pt=function(){function e(){ot(this,e),this.type="BaseObject",this._initParams(),this.calculaterData={},this.objectsMap=null}return st(e,[{key:"_initParams",value:function(){this.id=ht.uuid(),this.name=null,this.userID=null,this.properties=null,this.resource=null,this._resources=null,this.position=[0,0,0],this.rotation=[0,0,0,1],this.scale=[1,1,1],this._parent=null,this.children=[],this.typeToChildren={},this.lowerCaseProperties=null,this.visible=!0,this.mesh=null,this.calculater=null,this.meshBuilder=null,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.selfBuildCompleteCallbacks=[],this.selfBuildCompleteCallbackParams=[],this._isCalculated=!1,this._isMeshBuilded=!1,this._isChildrenBuilded=!1,this._isSelfBuilded=!1,this._isBuiled=!1,this._size=null,this._box3=null,this._selfSize=null,this._center=null,this._isBuiled=!1,this._isRequestResource=!1,this._isNotifyListeners=!1,this.objectsMap=null}},{key:"_getCalculateSizeObjects",value:function(){return this.children}},{key:"_addChild",value:function(e){this.children.push(e),this.typeToChildren[e.type]||(this.typeToChildren[e.type]=[]),this.typeToChildren[e.type].push(e),e.registerBuildCallbackListener(this._childBuildCallback,{obj:this})}},{key:"_childBuildCallback",value:function(e,t){var i=t.obj;i.children.every((function(e){return e.isBuilded}))&&(i._isChildrenBuilded=!0),i.isChildrenBuilded&&i.isSelfBuilded&&(i._isBuiled=!0),i.isBuilded&&i.notifyBuildCompleteListeners()}},{key:"_getChildrenByType",value:function(e){return this.typeToChildren[e]?this.typeToChildren[e]:[]}},{key:"_removeChild",value:function(e){var t=this.children.indexOf(e);t>-1&&this.children.splice(t,1),(t=this.typeToChildren[e.type].indexOf(e))>-1&&this.typeToChildren[e.type].splice(t,1),e.removeBuildCallbackListener(this._childBuildCallback)}},{key:"build",value:function(e){e&&this.registerBuildCallbackListener(e),this.isBuilded||(this.isResourcesBuilded?(this.buildSelf(),this.buildChildren(),this.isChildrenBuilded&&this.notifyBuildCompleteListeners()):this._initResources())}},{key:"calculate",value:function(){this.calculater&&this.calculater.build(this)}},{key:"createMesh",value:function(){if(this.meshBuilder)return this.meshBuilder.build(this)}},{key:"_initResources",value:function(){if(!this._isRequestResource){for(var e=0;e<this.resources.length;e++){var t=this.resources[e];t.isBuilded||(t.registerBuildCallbackListener(this._resourceBuildedCallback,{object:this}),t.build())}this._isRequestResource=!0}}},{key:"_resourceBuildedCallback",value:function(e,t){var i=t.object;e.isBuilded&&i.build()}},{key:"buildSelf",value:function(){this._buildSelf(),this.isSelfBuilded&&this.notifySelfBuildCompleteListeners()}},{key:"_buildSelf",value:function(){this.isSelfBuilded||(this._isCalculated||(this.calculate(),this._isCalculated=!0),this._isMeshBuilded||(this.createMesh(),this._isMeshBuilded=!0),this._isSelfBuilded=!0,this.isChildrenBuilded&&(this._isBuiled=!0),this.isBuilded&&this.notifyBuildCompleteListeners())}},{key:"buildChildren",value:function(){this._buildChildren()}},{key:"_buildChildren",value:function(){if(!this.isChildrenBuilded)for(var e=0;e<this.children.length;e++)this.children[e].build()}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"registerSelfBuildCallbackListener",value:function(e,t){this.selfBuildCompleteCallbacks.push(e),this.selfBuildCompleteCallbackParams.push(t)}},{key:"removeBuildCallbackListener",value:function(){}},{key:"notifyBuildCompleteListeners",value:function(){if(!this._isNotifyListeners){for(var e=0;e<this.buildCompleteCallbacks.length;e++)(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e]);this._isNotifyListeners=!0}}},{key:"notifySelfBuildCompleteListeners",value:function(){for(var e=0;e<this.selfBuildCompleteCallbacks.length;e++)(0,this.selfBuildCompleteCallbacks[e])(this,this.selfBuildCompleteCallbackParams[e])}},{key:"findObjectByID",value:function(e){return this.objectsMap||(this.objectsMap={},this.collectObjectsToMap(this)),null!=e&&""!==e?this.objectsMap[e]:null}},{key:"collectObjectsToMap",value:function(e){this.objectsMap[e.id]=e;for(var t=0;t<e.children.length;t++){var i=e.children[t];this.collectObjectsToMap(i)}}},{key:"findObjectByUserID",value:function(e){if(!e)return null;if(this.userID===e)return this;if(this.children)for(var t=0;t<this.children.length;t++){var i=this.children[t];if(i.userID===e)return i;var r=i.findObjectByUserID(e);if(r)return r}return null}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++)this.children[e].clear();this.clearBuildMesh(),this.calculater=null,this.meshBuilder=null,this._initParams(),this.id=null}},{key:"clearBuildMesh",value:function(){this.meshBuilder&&this.meshBuilder.clear(this.mesh),this._isMeshBuilded=!1,this._isSelfBuilded=!1,this.mesh=null,this._isBuiled=!1,this._isNotifyListeners=!1}},{key:"deepClone",value:function(e){var t=Array.isArray(e)?[]:{};if(e&&"object"===(void 0===e?"undefined":nt(e)))for(var i in e)e.hasOwnProperty(i)&&(t[i]=e&&"object"===nt(e[i])?this.deepClone(e[i]):e[i]);return t}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){return null===this._selfSize?[0,0,0]:this._selfSize}},{key:"center",get:function(){if(null===this._center){if(!this.size||!this._box3)return[0,0,0];this._center=this._box3.getCenter().toArray()}return this._center}},{key:"size",set:function(e){this._size=e,0===this.children.length&&(this.selfSize=e)},get:function(){if(null===this._size)if(this.children.length>0){if(this._box3=new it,0!==this.selfSize[0]&&0!==this.selfSize[1]&&0!==this.selfSize[2]){var e=new tt(this.position[0],this.position[1],this.position[2]);e.y+=this.selfSize[1]/2,this._box3.setFromCenterAndSize(e,new tt(this.selfSize[0],this.selfSize[1],this.selfSize[2]))}for(var t=this._getCalculateSizeObjects(),i=0;i<t.length;i++){var r=t[i];r.size&&r._box3&&this._box3.union(r._box3)}this._size=this._box3.getSize().toArray()}else this._size=this.selfSize;return this._size}},{key:"parent",get:function(){return this._parent},set:function(e){this._parent!==e&&(null!==this._parent&&this._parent._removeChild(this),null!=e&&(this._parent=e,this._parent&&this._parent._addChild(this)))}},{key:"isContainer",get:function(){return this.children.length>0}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource)),this._resources}},{key:"isBuilded",get:function(){return this._isBuiled}},{key:"isSelfBuilded",get:function(){return this._isSelfBuilded}},{key:"isChildrenBuilded",get:function(){return!this.isContainer||!(this.children.length>0)||this._isChildrenBuilded}},{key:"isResourcesBuilded",get:function(){for(var e=0;e<this.resources.length;e++)if(!this.resources[e].isBuilded)return!1;return!0}}]),e}(),dt={StraightManualWall:"StraightManualWall",ModelWall:"ModelWall",WallCorner:"WallCorner",FloorPlan:"FloorPlan",Facade:"Facade",Building:"Building",Outdoors:"Outdoors",Room:"Room",CombineStraightManualWall:"CombineStraightManualWall",Floor:"Floor",Ceiling:"Ceiling",Roof:"Roof",CombineDoorOrWindow:"CombineDoorOrWindow",CombinePlacement:"CombinePlacement",CombinePlacementWall:"CombinePlacementWall",Placement:"Placement",PlacementGroup:"PlacementGroup",CombineFloor:"CombineFloor",CombineCeiling:"CombineCeiling",CombineRoof:"CombineRoof",CombineModelWall:"CombineModelWall",CombinePlacementGroup:"CombinePlacementGroup",PlacementWall:"PlacementWall",PlacementGround:"PlacementGround",VideoProbe:"VideoProbe",CurveLine:"CurveLine",LeakWaterLine:"LeakWaterLine",ArrowLine:"ArrowLine",ArrowDataLine:"ArrowDataLine",RouteLine:"RouteLine",Text3D:"Text3D"},ft=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.dataJson=e,i.type="Room",i}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.dataJson=null,this.holePaths=[],this._points=[],this._holes=[],this._uv2=[],this.offset=null,this.parentPosition=null,this._floor=null,this._roof=null,this._ceiling=null,this.floorResource=null,this.ceilingResource=null,this.roofResource=null,this.isOnlyFloor=!1}},{key:"clear",value:function(){this.floor&&this.floor.clear(),this.roof&&this.roof.clear(),this.ceiling&&this.ceiling.clear(),at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"floor",get:function(){return null===this._floor&&this.typeToChildren[dt.Floor]&&(this._floor=this.typeToChildren[dt.Floor][0]),this._floor}},{key:"ceiling",get:function(){return null===this._ceiling&&this.typeToChildren[dt.Ceiling]&&(this._ceiling=this.typeToChildren[dt.Ceiling][0]),this._ceiling}},{key:"roof",get:function(){return null===this._roof&&this.typeToChildren[dt.Roof]&&(this._roof=this.typeToChildren[dt.Roof][0]),this._roof}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource)),this._resources}},{key:"points",set:function(e){this._points=e},get:function(){return this._points}},{key:"holes",set:function(e){this._holes=e},get:function(){return this._holes}}]),t}(pt),mt=function e(){ot(this,e)};mt.StraightManualWallHeight=3,mt.StraightManualWallThick=.15,mt.enableDelayLoadMode=!0,mt.enableManaulWallLightMap=!0,mt.enableFloorLightMap=!0,mt.wallLightMapIntensity=3.8,mt.enableUseHighestVersionResource=!0,mt.enableCombine=!0,mt.ableToSupportFootAndHeadModelWalls=["C9FB3F9A29C842F79F02CECC4037FEA1"];var gt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Ceiling",e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.blockSize=[.6,.6],this.blockAngle=0,this.DefaultHeight=2.9,this.height=this.DefaultHeight}},{key:"size",get:function(){return null===this._size&&(this._size=[0,0,0]),this._size},set:function(e){this._size=e}}]),t}(pt),vt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Roof",e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.DefaultHeight=3,this.height=this.DefaultHeight,this.blockSize=[2,2],this.blockAngle=0}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}}]),t}(pt),yt=function e(){ot(this,e)};yt.wallTexture=null,yt.wallEdgeTexture=null,yt.floorTexture=null,yt.ceilingTexture=null,yt.roofTexture=null,yt.wallLigthMapTexture=null,yt.floorLightMapTexture=null,yt.wallMaterial=null,yt.wallEdgeMaterial=null,yt.floorMaterial=null,yt.ceilingMaterial=null,yt.roofMaterial=null;var bt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Floor",e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.blockSize=[.6,.6],this.blockAngle=0,this.DefaultHeight=.01,this.height=this.DefaultHeight}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}}]),t}(pt),_t=function(e){function t(){return ot(this,t),ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._startCorner=null,this._endCorner=null,this.thick=-1,this.height=-1,this._length=null,this._direction=null,this.doorOrWindows=[],this.suspend=0,this._position=null}},{key:"getWallOtherCorner",value:function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null}},{key:"startCorner",get:function(){return this._startCorner},set:function(e){this._startCorner=e,this._startCorner&&this._startCorner.addWall(this)}},{key:"endCorner",get:function(){return this._endCorner},set:function(e){this._endCorner=e,this._endCorner&&this._endCorner.addWall(this)}},{key:"position",get:function(){if(!this._position){var e=this.startCorner.position,t=this.endCorner.position;this._position=[(t[0]+e[0])/2,(t[1]+e[1])/2,(t[2]+e[2])/2]}return this._position},set:function(e){this._position=e}},{key:"length",get:function(){return null===this._length&&(this._length=ht.calTwoPositionLength(this.startCorner.position,this.endCorner.position)),this._length}},{key:"direction",get:function(){return null===this._direction&&(this._direction=ht.subPosition(this.endCorner.position,this.startCorner.position),ht.normalizeDirection(this._direction)),this._direction}}]),t}(pt),xt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="ModelWall",e}return lt(t,e),t}(_t),Et=function(e){function t(e,i,r){ot(this,t);var n=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.type="WallCorner",n}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.walls=[],this.position=null}},{key:"addWall",value:function(e){for(var t=0,i=this.walls.length;t<i;t++)if(this.walls[t]===e)return void console.error("repeat wall"+e);this.walls.push(e)}},{key:"clearMesh",value:function(){for(var e=0;e<this.walls.length;e++)this.walls[e].clearMesh();at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clearMesh",this).call(this)}}]),t}(pt),wt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Building",e.structShow=!1,e}return lt(t,e),st(t,[{key:"floorplans",get:function(){return this._getChildrenByType(dt.FloorPlan)}},{key:"facades",get:function(){return this._getChildrenByType(dt.Facade)}}]),t}(pt),Tt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="CurveLine",e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.points=[],this.resource=null,this.color=null,this.width=null,this.enableMaterialAnimation=!1,this.materialAnimationSpeed=1,this.textureTiling=[1,1],this.textureOffset=[0,0]}}]),t}(pt),Mt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="ArrowLine",e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.arrowResource=null,this.arrowWidth=null,this.arrowHeight=null,this._resources=null}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource),this.arrowResource&&this._resources.push(this.arrowResource)),this._resources}}]),t}(Tt),Ct=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="ArrowDataLine",e}return lt(t,e),t}(Mt),St=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Placement",e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.model=null,this.customColor=null,this.opacity=null,this.renderMode=null,this.customTextureResource=null,this.isPlayAnim=!1,this.animClip=null,this.belongRoomUserID=null}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource),this.customTextureResource&&this._resources.push(this.customTextureResource)),this._resources}},{key:"size",set:function(e){this._size=e},get:function(){if(null===this._size&&(this.modelSize=this.resource.size,this._size=[this.modelSize[0]*this.scale[0],this.modelSize[1]*this.scale[1],this.modelSize[2]*this.scale[2]]),null===this._box3){this._box3=new it;var e=new tt(this.position[0],this.position[1],this.position[2]);e.y+=this._size[1]/2,this._box3.setFromCenterAndSize(e,new tt(this._size[0],this._size[1],this._size[2]))}return this._size}}]),t}(pt),jt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Facade",e}return lt(t,e),t}(St),Pt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="DoorOrWindow",e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.suspendPercent=0,this.attachWall=null,this.isOpen=!1,this.openDirIndex=0,this.isWindow=!1}}]),t}(St),Rt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="PlacementGroup",e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.groups=[],this.placements=[],this.belongRoomUserID=null,this._resourcesMap={}}},{key:"_addChild",value:function(e){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_addChild",this).call(this,e),e.type===dt.Placement?this.placements.push(e):e.type===dt.PlacementGroup&&this.groups.push(e)}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){return null===this._selfSize&&(this._selfSize=[0,0,0]),this._selfSize}},{key:"belongRoomUserID",set:function(e){this._belongRoomUserID=e;for(var t=0;t<this.placements.length;t++)this.placements[t].belongRoomUserID=e;for(var i=0;i<this.groups.length;i++)this.groups[i].belongRoomUserID=e},get:function(){return this._belongRoomUserID}},{key:"resources",get:function(){if(null===this._resources){this._resources=[];for(var e=0;e<this.children.length;e++)for(var t=this.children[e],i=0;i<t.resources.length;i++){var r=t.resources[i];this._resourcesMap[r.id]||(this._resources.push(r),this._resourcesMap[r.id]=r)}}return this._resources}}]),t}(pt),Dt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="FacadeGroup",e}return lt(t,e),t}(Rt),At=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="FloorPlan",e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.height=3,this.alwaysShowInsideObjs=!1}},{key:"existsCorner",value:function(e,t,i){var r=this.typeToChildren[dt.WallCorner];if(r)for(var n=0,o=r.length;n<o;n++){var s=r[n].position;if(s.x===e&&s.y===t&&s.z===i)return!0}return!1}},{key:"addCorner",value:function(e,t,i){var r=new WallCorner(e,t,i);return r.parent=this,r}},{key:"getCorner",value:function(e,t,i){for(var r=0,n=this.corners.length;r<n;r++){var o=this.corners[r].position;if(o.x===e&&o.y===t&&o.z===i)return this.corners[r]}return null}},{key:"calRoomsUV2",value:function(){}},{key:"_fillUV2ToRooms",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=this._calFloorUV2(r,t);this._fillUV2ToFloor(r,n)}}},{key:"_calFloorUV2",value:function(e,t){var i=[],r=new THREE.Vector2;t.getSize(r);for(var n=e.floor.geometry.vertices,o=this._getFloorPosition(e),s=0;s<n.length;s++){var a=n[s].clone();a.x+=o.x,a.y+=o.z;var l=(a.x-t.min.x)/r.x,u=(a.y-t.min.y)/r.y;i.push(new THREE.Vector2(parseFloat(l.toFixed(2)),parseFloat(u.toFixed(2))))}return i}},{key:"_fillUV2ToFloor",value:function(e,t){for(var i=e.floor.geometry.faces,r=[],n=0;n<i.length;n++){var o=i[n],s=[t[o.a],t[o.b],t[o.c]];r.push(s)}e.uv2=r}},{key:"_calAllFloorBox2",value:function(e){for(var t=new THREE.Box2,i=0;i<e.rooms.length;i++){var r=e.rooms[i];null===r.floor.geometry&&r.floor.calGeometry();for(var n=this._getFloorPosition(r),o=r.floor.geometry.vertices,s=0;s<o.length;s++){var a=o[s].clone();a.x+=n.x,a.y+=n.z,t.expandByPoint(a)}}return t}},{key:"_getFloorPosition",value:function(e){var t=e.position.clone();return t.z=-t.z,t}},{key:"_getCalculateSizeObjects",value:function(){for(var e=[],t=0;t<this.children.length;t++){var i=this.children[t];-1!==i.type.indexOf("Wall")&&e.push(i)}return e}},{key:"placements",get:function(){return this._getChildrenByType(dt.Placement)}},{key:"corners",get:function(){return this._getChildrenByType(dt.WallCorner)}},{key:"walls",get:function(){return this._getChildrenByType(dt.ModelWall).concat(this._getChildrenByType(dt.StraightManualWall)).concat(this._getChildrenByType(dt.PlacementWall))}},{key:"rooms",get:function(){return this._getChildrenByType(dt.Room)}},{key:"groups",get:function(){return this._getChildrenByType(dt.PlacementGroup)}},{key:"placementGrounds",get:function(){return this._getChildrenByType(dt.PlacementGround)}},{key:"videoprobes",get:function(){return this._getChildrenByType(dt.VideoProbe)}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){return null===this._selfSize&&(this._selfSize=[0,0,0]),this._selfSize}}]),t}(pt),kt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Outdoors",e}return lt(t,e),t}(At),Ot=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="PipeLine",e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.points=[],this.resource=null,this.color=[0,0,1],this.renderMode=null,this.opacity=null,this.radius=null,this.sectionType=null,this.enableMaterialAnimation=!1,this.materialAnimationSpeed=1,this.textureTiling=[.5,.5],this.textureOffset=[0,0]}}]),t}(pt),Bt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="LeakWaterLine",e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.radius=.2,this.color=[1,1,1],this.alarmLength=null}},{key:"clear",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this,e),this.radius=.2,this.color=null,this.alarmLength=null}}]),t}(Ot),Ft=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.text=null,e.color=null,e.fontSize=null,e.opacity=null,e.mesh=null,e.type="Text3D",e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.text=null,this.color=null,this.fontSize=null,this.opacity=null,this.mesh=null}}]),t}(pt),Lt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="VideoProbe",e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.ascept=null,this.field=null,this.probeLength=null,this.pitch=null}}]),t}(St),It=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="World",e}return lt(t,e),st(t,[{key:"clear",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this,e),this.outdoors=null,this.buildings=[]}},{key:"buildings",get:function(){return this._getChildrenByType(dt.Building)}},{key:"ourdoors",get:function(){return this._getChildrenByType(dt.Outdoors)[0]}}]),t}(pt),Nt=new function e(){ot(this,e),this.isDebug=!1,this.isTesting=!1},Ut=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="RouteLine",e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.color=[0,0,1]}},{key:"clear",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this,e),this.color=null}}]),t}(Tt),zt=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="PlacementWall",i}return lt(t,e),t}(St),Ht=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="PlacementGround",e}return lt(t,e),t}(St),Vt=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=dt.StraightManualWall,i}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.leftResource=null,this.rightResource=null,this.edgeResource=null,this.uvMultiple=[1,1],this.lightUV=null,this.topOffset=null,this.suspend=0,this.thick=.25,this.height=3}},{key:"selfSize",get:function(){if(null===this._selfSize){this._box3=new it;for(var e=[this.startCorner,this.endCorner],t=0;t<e.length;t++){var i=e[t].position,r=new tt(i[0],i[1],i[2]);this._box3.expandByPoint(r),(r=r.clone()).y=this.parent.height,this._box3.expandByPoint(r)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.leftResource&&this._resources.push(this.leftResource),this.rightResource&&this._resources.push(this.rightResource),this.edgeResource&&this._resources.push(this.edgeResource)),this._resources}}]),t}(_t),Wt=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.objects=[],i}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.objects=[]}},{key:"_buildSelf",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_buildSelf",this).call(this)}},{key:"clear",value:function(){for(var e=0;e<this.objects.length;e++)this.objects[e].clear();at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(pt),Gt=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="CombineStraightManualWall",i}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.walls=[],this.leftWallResourceMap=new Map,this.rightWallResourceMap=new Map,this.corners=[],this._resourceDic={},this._resources=[]}},{key:"addObject",value:function(e){this.walls.push(e),this.leftWallResourceMap.has(e.leftResource)||this.leftWallResourceMap.set(e.leftResource,[]),this.rightWallResourceMap.has(e.rightResource)||this.rightWallResourceMap.set(e.rightResource,[]),this.leftWallResourceMap.get(e.leftResource).push(e),this.rightWallResourceMap.get(e.rightResource).push(e),this.addCorner(e.startCorner),this.addCorner(e.endCorner);for(var t=e.resources,i=0;i<t.length;i++){var r=t[i];this._resourceDic[r.id]||(this._resources.push(r),this._resourceDic[r.id]=r)}}},{key:"addCorner",value:function(e){for(var t=0;t<this.corners.length;t++)if(this.corners[t]===e)return;this.corners.push(e)}},{key:"_addResource",value:function(){}},{key:"clear",value:function(){for(var e=0;e<this.walls.length;e++)this.walls[e].clear();for(var i=0;i<this.corners.length;i++){var r=this.corners[i];0===r.walls.length&&r.clear()}at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"selfSize",get:function(){if(null===this._selfSize){this._box3=new it;for(var e=0;e<this.corners.length;e++){var t=this.corners[e].position,i=new tt(t[0],t[1],t[2]);this._box3.expandByPoint(i),(i=i.clone()).y=this.parent.height,this._box3.expandByPoint(i)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}}]),t}(Wt),qt=function(){function e(){ot(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return st(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),Xt=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=dt.CombinePlacement,i}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.objects=[],this.belongRoomUserID=null,this.transformations=[]}},{key:"addObject",value:function(e){this.objects.push(e);var t=new qt;t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),this.transformations.push(t)}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){if(null===this._selfSize){this._box3=new it;for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t.size&&this._box3.union(t._box3)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}}]),t}(Wt),Jt=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="CombineDoorOrWindow",i}return lt(t,e),t}(Xt),Yt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type=dt.CombineFloor,e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._height=.01,this.rotation=[-.7071067811865475,-0,-0,.7071067811865476],this.position[1]=this._height}},{key:"addObject",value:function(e){this.objects.push(e)}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}},{key:"height",set:function(e){this._height=e,this.position[1]=this._height},get:function(){return this._height}}]),t}(Wt),Zt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type=dt.CombineCeiling,e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._height=3,this.rotation=[.7071067811865475,-0,-0,.7071067811865476],this.position[1]=this._height}},{key:"addObject",value:function(e){this.objects.push(e)}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}},{key:"height",set:function(e){this._height=e,this.position[1]=this._height},get:function(){return this._height}}]),t}(Wt),Qt=function(e){function t(){ot(this,t);var e=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type=dt.CombineRoof,e}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._height=3,this.rotation=[-.7071067811865475,-0,-0,.7071067811865476],this.position[1]=this._height+.005}},{key:"addObject",value:function(e){this.objects.push(e)}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}},{key:"height",set:function(e){this._height=e,this.position[1]=this._height+.005},get:function(){return this._height}}]),t}(Wt),Kt=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=dt.CombineModelWall,i}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.walls=[],this.corners=[]}},{key:"addObject",value:function(e){this.walls.push(e),this.addCorner(e.startCorner),this.addCorner(e.endCorner)}},{key:"addCorner",value:function(e){this.corners.push(e)}},{key:"clear",value:function(){for(var e=0;e<this.walls.length;e++)this.walls[e].clear();for(var i=0;i<this.corners.length;i++){var r=this.corners[i];0===r.walls.length&&r.clear()}at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){if(null===this._selfSize){this._box3=new it;for(var e=0;e<this.corners.length;e++){var t=this.corners[e].position,i=new tt(t[0],t[1],t[2]);this._box3.expandByPoint(i),(i=i.clone()).y=this.parent.height,this._box3.expandByPoint(i)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}}]),t}(Wt),$t=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=dt.CombinePlacementGroup,i}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.belongRoomUserID=null,this.transformations=[],this._resourcesMap={}}},{key:"addObject",value:function(e){this.objects.push(e);var t=new qt;t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),this.transformations.push(t)}},{key:"selfSize",get:function(){if(null===this._selfSize){if(!(this.objects.length>0))return[0,0,0];this._box3=new it;for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t.size&&this._box3.union(t._box3)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}},{key:"resources",get:function(){if(null===this._resources){this._resources=[];for(var e=0;e<this.objects.length;e++)for(var t=this.objects[e],i=0;i<t.resources.length;i++){var r=t.resources[i];this._resourcesMap[r.id]||(this._resources.push(r),this._resourcesMap[r.id]=r)}}return this._resources}}]),t}(Wt),ei=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=dt.CombinePlacementWall,i}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.belongRoomUserID=null,this.transformations=[]}},{key:"addObject",value:function(e){this.objects.push(e);var t=new qt;t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),this.transformations.push(t)}},{key:"selfSize",get:function(){if(null===this._selfSize){this._box3=new it;for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t.size&&this._box3.union(t._box3)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}}]),t}(Wt),ti={World:It,Building:wt,FloorPlan:At,Room:ft,Floor:bt,Ceiling:gt,Roof:vt,StraightManualWall:Vt,ModelWall:xt,WallCorner:Et,Placement:St,PlacementGroup:Rt,DoorOrWindow:Pt,Outdoors:kt,Facade:jt,FacadeGroup:Dt,VideoProbe:Lt,CurveLine:Tt,LeakWaterLine:Bt,ArrowLine:Mt,ArrowDataLine:Ct,RouteLine:Ut,PipeLine:Ot,PlacementWall:zt,PlacementGround:Ht,CombineStraightManualWall:Gt,CombineDoorOrWindow:Jt,CombinePlacement:Xt,CombineFloor:Yt,CombineCeiling:Zt,CombineRoof:Qt,CombineModelWall:Kt,CombinePlacementGroup:$t,CombinePlacementWall:ei,Text3D:Ft},ii=function(){function e(){ot(this,e),this.objects=[],this.calculaterManager=null,this.meshBuilderManager=null,this.ClassName=dt}return st(e,[{key:"create",value:function(e){var t=e.type,i=e.parent,r=new(0,ti[t]);return r.parent=i,this.calculaterManager&&(r.calculater=this.calculaterManager.create({type:t,object:r})),this.meshBuilderManager&&(r.meshBuilder=this.meshBuilderManager.create({type:t,object:r})),r}},{key:"registerObjectClass",value:function(e,t){ti[e]=t}},{key:"unregisterObjectClass",value:function(e){ti[e]=null}},{key:"containObjectClass",value:function(e){return!!ti[e]}},{key:"clear",value:function(){this.objects=null,this.calculaterManager=null,this.meshBuilderManager=null}}]),e}(),ri=(new ii,function(){function e(t){ot(this,e),this._initParams(),this.manager=t.manager,this.type="BaseResource"}return st(e,[{key:"_initParams",value:function(){this.id=null,this.url=null,this.isBuilded=!1,this.ext=null,this.version=null,this.isDefault=!1,this.builder=null,this.manager=null,this.type=null,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.buildPromise=null,this._registerBuilders=[],this._registerBuilderMaps={},this.useStaticImage=!1,this.isResquestToBuild=!1,this._alreadyCallback=!1}},{key:"build",value:function(e){var t=this;if(this.isBuilded)e&&e(this),t.notifyBuildCompleteListeners();else{if(this.isResquestToBuild)return;this.isResquestToBuild=!0,this.builder?this.builder.build((function(){t.isBuilded=!0,e&&e(t),t.notifyBuildCompleteListeners()})):(t.isBuilded=!0,e&&e(t),t.notifyBuildCompleteListeners())}}},{key:"buildRegisterBuilder",value:function(){for(var e=0;e<this._registerBuilders.length;e++){var t=this._registerBuilders[e];t.isBuilded||t.build()}}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"notifyBuildCompleteListeners",value:function(){for(var e=0;e<this.buildCompleteCallbacks.length;e++)(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e]);this._alreadyCallback=!0}},{key:"containBuilder",value:function(e){return!!this._registerBuilderMaps[e]}},{key:"getBuilder",value:function(e){return this._registerBuilderMaps[e]?this._registerBuilderMaps[e]:null}},{key:"registerBuilder",value:function(e,t){this._registerBuilderMaps[e]?console.warn("exist builder "+e):(this._registerBuilderMaps[e]=t,this._registerBuilders.push(t),this.isBuilded=!1)}},{key:"unRegisterBuilder",value:function(e){if(this._registerBuilderMaps[e]){var t=this._registerBuilderMaps[e],i=this._registerBuilders.indexOf(t);this._registerBuilders.splice(i,1),delete this._registerBuilderMaps[e]}}},{key:"clear",value:function(){this.isBuilded&&this.builder&&this.builder.clear();for(var e=0;e<this._registerBuilders.length;e++)this._registerBuilders[e].clear();this._initParams()}}]),e}()),ni=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.baseUrl=i.manager.baseModelUrl,i.type="ModelResource",i.isModel=!0,i}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.isSupportHeadAndFootModelWall=!1,this.size=[1,1,1],this.model=null,this.animations=null,this.baseUrl=null,this.texture=null}},{key:"getModelUrl",value:function(){if(this.url)return this.url;var e=this.getDownloadResourceVersion();return this.url?this.url:this.baseUrl+this.id+"/"+e+"/gltf/"}},{key:"getDownloadResourceVersion",value:function(){var e=0;return this.manager.enableUserHighestVersionResource||(e=this.version),e}}]),t}(ri),oi=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.baseUrl=i.manager.baseTextureUrl,i.type="TextureResource",i.callback=null,i}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.material=null,this.wallMaterial=null,this.roomMaterial=null,this.texture=null,this.isDefault=!1,this.baseUrl=null,this.ext=null}},{key:"build",value:function(e){this.callback&&(this.callback=null),this.callback=e,this.isDefault&&!this.manager.isGlobalResourcesBuilded?(this.manager.registerGlobalResourcesBuildCallbackListener(this._globalResourcesBuildedCallback,{object:this,callback:e}),this.manager.initGlobalResources()):at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"build",this).call(this,e)}},{key:"_globalResourcesBuildedCallback",value:function(e,t){var i=t.object,r=t.callback;i.build(r)}},{key:"getTextureUrl",value:function(){return this.url?this.url:this.baseUrl+this.id+"."+(null===this.ext?"jpg":this.ext)}},{key:"userDefaultWallLightMap",get:function(){return this.manager.userDefaultWallLightMap}}]),t}(ri),si=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="LocalCustomTextureResource",i}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.localBaseUrl=null,this.localUrl=null,this.texture=null}},{key:"getTextureUrl",value:function(){if(this.localUrl)return this.localBaseUrl+this.localUrl;console.error("can not find url")}}]),t}(ri),ai=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="CustomResource",i}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.customTexture=null,this.color=null,this.renderMode=null,this.modelID=null}},{key:"getModelUrl",value:function(){if(this.url)return this.url;var e=this.getDownloadResourceVersion();return this.baseUrl+this.modelID+"/"+e+"/gltf/"}},{key:"clear",value:function(){this.customTexture&&this.customTexture.clear(),at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(ni),li=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="CustomModelResource",i}return lt(t,e),st(t,[{key:"_initParams",value:function(){at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.localBaseUrl=null,this.localUrl=null}},{key:"getModelUrl",value:function(){if(this.url)return this.url;var e=null;return this.localUrl&&(e=this.localBaseUrl+this.localUrl),e}}]),t}(ai),ui=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="Max2TjsResource",i}return lt(t,e),t}(li),ci=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="EmptyModelResource",i}return lt(t,e),t}(ni),hi=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="EmptyTextureResource",i}return lt(t,e),t}(oi),pi=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="Max2TjsResource",i}return lt(t,e),t}(li),di={ModelResource:ni,TextureResource:oi,LocalCustomTextureResource:si,CustomModelResource:li,CustomResource:ai,Max2TjsResource:ui,EmptyModelResource:ci,EmptyTextureResource:hi,Max2TjsKeepRootRotationResource:pi},fi={TextureResource:"TextureResource",ModelResource:"ModelResource",CustomModelResource:"CustomModelResource",CustomResource:"CustomResource",LocalCustomTextureResource:"LocalCustomTextureResource",Max2TjsResource:"Max2TjsResource",EmptyTextureResource:"EmptyTextureResource",EmptyModelResource:"EmptyModelResource"},mi=function(){function e(t){ot(this,e),this._initParams(),this.resource=t.resource,this.manager=t.manager}return st(e,[{key:"_initParams",value:function(){this.resource=null,this.manager=null,this.promise=null}},{key:"build",value:function(e){this.download((function(){e&&e()}))}},{key:"download",value:function(e){}},{key:"clear",value:function(){this._initParams()}},{key:"_dispose",value:function(e){if(e.isMesh){var t=e;if(t){var i=t.material,r=t.geometry;t.isDestory=!0,i&&(this._disposeMaterial(i),t.material=null),r&&(r.isDestory=!0,r.dispose(),t.geometry=null)}}if(e)for(var n=e.children,o=0;o<n.length;o++){var s=n[o];this._dispose(s)}}},{key:"_disposeMaterial",value:function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var i=e[t];this._disposeMaterial(i)}else e.isDestory=!0,e.map&&e.map.dispose(),e.aoMap&&e.aoMap.dispose(),e.dispose()}}]),e}(),gi=function(e){function t(e){return ot(this,t),ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return lt(t,e),st(t,[{key:"getDownloadResourceVersion",value:function(){var e=0;return this.manager.enableUserHighestVersionResource||(e=this.resource.version),e}},{key:"download",value:function(e){if(Nt.isTesting){var t=new THREE.Object3D,i=new THREE.BoxBufferGeometry(1,1,1),r=new THREE.MeshBasicMaterial({color:16776960}),n=new THREE.Mesh(i,r);return t.add(n),void this._successCallback({node:t},e)}var o=this,s=new thingjs.GLTFLoader,a=this.resource.getModelUrl();s.loadFromURL({url:a,useStaticImage:this.resource.useStaticImage,jsonCallback:function(e){o.resource.indexJson=e},modelCallback:function(t){o._successCallback(t,e)},errorCallback:function(){o._errorCallback(e)}})}},{key:"_successCallback",value:function(e,t){var i=this;i.resource.animations=e.animations,i.resource.downloadModelRoot=e,i.resource.model=e.node,i.ready=!0,t&&t(),i.debug&&console.log(i.id+" download complete")}},{key:"_errorCallback",value:function(e){var t=this;console.error("download error "+t.resource.getModelUrl()),t.ready=!0,t.resource.model=new THREE.Object3D,t.resource.isEmpty=!0,e&&e()}},{key:"clear",value:function(){this._dispose(this.resource.model),this.resource.model=null,this.resource.animations=null,this.resource.downloadModelRoot=null,at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(mi),vi=function(e){function t(e){return ot(this,t),ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return lt(t,e),st(t,[{key:"download",value:function(e){this.initMaterial();var t=this;if("bundle"===this.resource.ext)return t.ready=!0,void e();t._build(e)}},{key:"_lightMapResourceBuildCallback",value:function(e,t){t.builder._build(t.downloadCallback)}},{key:"initMaterial",value:function(){this.resource.material=new THREE.MeshStandardMaterial({metalness:.5,roughness:.5}),this.resource.wallMaterial=new THREE.MeshStandardMaterial({color:16777215,metalness:.5,roughness:.5});var e=this.resource.wallMaterial;this.resource.isDefault?this.resource.userDefaultWallLightMap&&(e.defines=e.defines||{},e.defines.WALL_AO=!0,e.metalness=.2,e.roughness=.8,e.needsUpdate=!0):(e.metalness=0,e.roughness=1);var t=new THREE.MeshLambertMaterial({color:16777215,reflectivity:.1});this.resource.roomMaterial=t,t.defines=t.defines||{},t.defines.FLOOR_AO=!0}},{key:"_downloadTexture",value:function(e,t,i){if(Nt.isTesting)t(new THREE.Texture);else{var r=new THREE.TextureLoader;r.enableStaticImage=this.resource.useStaticImage,r.setCrossOrigin("anonymous"),r.load(e,(function(e){t&&t(e)}),(function(e){}),(function(e){i&&i()}))}}},{key:"_build",value:function(e){var t=this;t._downloadTexture(t.resource.getTextureUrl(),(function(i){i.wrapS=THREE.RepeatWrapping,i.wrapT=THREE.RepeatWrapping,t.resource.texture=i,t.resource.material.map=i,t.resource.wallMaterial.map=i,t.resource.roomMaterial.map=i,t.resource.isDefault&&t.resource.manager.wallLightMapResource&&(t.resource.wallMaterial.aoMap=t.resource.manager.wallLightMapResource.texture),t.ready=!0,t.resource.material.roughness=1,t.debug&&console.log(t.id+" download complete"),e&&e()}),(function(){t.ready=!0,console.error("download error "+t.resource.getTextureUrl()),e&&e()}))}},{key:"clear",value:function(){this.resource.material&&this._disposeMaterial(this.resource.material),this.resource.wallMaterial&&this._disposeMaterial(this.resource.wallMaterial),this.resource.roomMaterial&&this._disposeMaterial(this.resource.roomMaterial),this.resource.texture&&this.resource.texture.dispose(),this.resource.texture=null,this.resource.material=null,this.resource.wallMaterial=null,this.resource.roomMaterial=null,at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(mi),yi=function(e){function t(e){ot(this,t);var i=ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.callback=null,i}return lt(t,e),st(t,[{key:"download",value:function(e){var i=this;this.callback=e,at(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"download",this).call(this,(function(){i.resource.customTexture?(i.resource.customTexture.registerBuildCallbackListener((function(){i._afterDownload()})),i.resource.customTexture.build()):i._afterDownload()}))}},{key:"_afterDownload",value:function(){this._initCustomInfo(),this.callback&&this.callback(this)}},{key:"_initCustomInfo",value:function(){var e=this;null!==e.resource.customTexture&&e._changeWithCustomTexture(e.resource.model),null!==e.resource.color&&e._changeWithCustomColor(e.resource.model),null!==e.resource.renderMode&&e._changeRenderMode(e.resource.model),e.resource.ready=!0}},{key:"_changeRenderMode",value:function(e){var t=this;e instanceof THREE.Mesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){if(null!==t.resource.renderMode)switch(t.resource.renderMode){case 1:e.transparent=!1,e.alphaTest=.5;break;case 3:case 2:e.transparent=!0;break;default:console.error("can not find renderMode "+t.renderMode)}}));for(var i=0;i<e.children.length;i++){var r=e.children[i];this._changeRenderMode(r)}}},{key:"_changeWithCustomColor",value:function(e){var t=this;e instanceof THREE.Mesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.color.r=t.resource.color[0],e.color.g=t.resource.color[1],e.color.b=t.resource.color[2],null!==t.resource.opacity&&(e.opacity=t.resource.opacity,e.transparent=!0)}));for(var i=0;i<e.children.length;i++){var r=e.children[i];this._changeWithCustomColor(r)}}},{key:"_changeWithCustomTexture",value:function(e){var t=this;e instanceof THREE.Mesh&&(t.resource.customTexture&&t.resource.customTexture.texture&&(t.resource.customTexture.texture.flipY=!1),(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.map=t.resource.customTexture.texture})));for(var i=0;i<e.children.length;i++){var r=e.children[i];this._changeWithCustomTexture(r)}}}]),t}(gi),bi=function(e){function t(e){return ot(this,t),ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return lt(t,e),t}(yi),_i=function(e){function t(e){return ot(this,t),ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return lt(t,e),t}(vi),xi=function(e){function t(e){return ot(this,t),ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return lt(t,e),st(t,[{key:"_successCallback",value:function(e,t){var i=this;i.resource.animations=e.animations,i.resource.model=e.node.children[0],i.resource.downloadModelRoot=e,this._applyRotationToChildren(this.resource.model),i.ready=!0,t&&t(),i.debug&&console.log(i.id+" download complete")}},{key:"_applyRotationToChildren",value:function(e){for(var t=e.scale,i=0;i<e.children.length;i++){var r=e.children[i],n=r.position.clone(),o=r.scale;n.applyQuaternion(e.quaternion),r.position.copy(n),r.scale.set(t.x*o.x,t.y*o.y,t.z*o.z),r.quaternion.premultiply(e.quaternion)}if(e.children.length>0){e.quaternion.set(0,0,0,1),e.scale.set(1,1,1);for(var s=0;s<e.children.length;s++){var a=e.children[s];a.isMesh||this._applyRotationToChildren(a)}}}}]),t}(bi),Ei=function(e){function t(e){return ot(this,t),ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return lt(t,e),st(t,[{key:"download",value:function(e){var t=new THREE.Object3D;this.resource.isEmpty=!0,this.resource.model=t,this._successCallback(t,e)}},{key:"_successCallback",value:function(e,t){var i=this;i.ready=!0,t&&t(),i.debug&&console.log(i.id+" download complete")}}]),t}(gi),wi=function(e){function t(e){return ot(this,t),ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return lt(t,e),st(t,[{key:"_downloadTexture",value:function(e,t,i){var r=new THREE.Texture;t&&t(r)}}]),t}(vi),Ti=function(e){function t(e){return ot(this,t),ut(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return lt(t,e),st(t,[{key:"_successCallback",value:function(e,t){var i=this;i.resource.animations=e.animations,i.resource.model=e.node.children[0],i.resource.downloadModelRoot=e,i.ready=!0,t&&t(),i.debug&&console.log(i.id+" download complete")}}]),t}(xi),Mi={ModelResource:gi,TextureResource:vi,CustomResource:yi,CustomModelResource:bi,LocalCustomTextureResource:_i,Max2TjsResource:xi,Max2TjsKeepRootRotationResource:Ti,EmptyModelResource:Ei,EmptyTextureResource:wi},Ci=new(function(){function e(t){ot(this,e),this.enableUserHighestVersionResource=!0,this.useStaticImage=!1,this.userDefaultWallLightMap=!0,this.requestDownloadResources=[],this.resourceDownloadSuccessCallback=[]}return st(e,[{key:"create",value:function(e){var t=e.type,i=Mi[t];return e.manager=this,new i(e)}},{key:"addResourceDownloadRequest",value:function(e,t){this.requestDownloadResources.push(e),this.resourceDownloadSuccessCallback.push(t)}}]),e}()),Si=function(){function e(){ot(this,e),this.textures=[],this.models=[],this.allResources=[],this.builderManager=Ci,this.ClassName=fi,this.baseTextureUrl="https://static.3dmomoda.com/textures/",this.baseModelUrl="https://model.3dmomoda.com/models/",this.ableToSupportFootAndHeadModelWalls=["C9FB3F9A29C842F79F02CECC4037FEA1"],this.wallLightMapResource=null,this.enableUserHighestVersionResource=!0,this.globalResourcesBuildCompleteCallbacks=[],this.globalResourcesBuildCompleteCallbackParams=[],this._isGlobalResourcesBuilded=!1,this.userDefaultWallLightMap=!0,this._emptyTextureResource=this.create({type:"EmptyTextureResource",id:"emptyTexture"}),this._emptyModelResource=this.create({type:"EmptyModelResource",id:"emptyModel"})}return st(e,[{key:"initGlobalResources",value:function(){var e=this;this._isGlobalResourcesBuilded||(this._isGlobalResourcesBuilded=!0,this.wallLightMapResource?this.wallLightMapResource.isBuilded?(e._isGlobalResourcesBuilded=!0,e.notifyGlobalResourcesBuildCompleteListeners()):(this.wallLightMapResource.registerBuildCallbackListener(this._wallLightResoruceBuildCallback,{manager:this}),this.wallLightMapResource.isResquestToBuild||this.wallLightMapResource.build()):this.notifyGlobalResourcesBuildCompleteListeners())}},{key:"_wallLightResoruceBuildCallback",value:function(e,t){var i=t.manager;i._isGlobalResourcesBuilded=!0,i.notifyGlobalResourcesBuildCompleteListeners()}},{key:"registerGlobalResourcesBuildCallbackListener",value:function(e,t){this.globalResourcesBuildCompleteCallbacks.push(e),this.globalResourcesBuildCompleteCallbackParams.push(t)}},{key:"notifyGlobalResourcesBuildCompleteListeners",value:function(){for(var e=0;e<this.globalResourcesBuildCompleteCallbacks.length;e++)(0,this.globalResourcesBuildCompleteCallbacks[e])(this,this.globalResourcesBuildCompleteCallbackParams[e])}},{key:"create",value:function(e){var t=e.type,i=new(0,di[t])({manager:this});return i.id=e.id,this.builderManager&&(i.builder=this.builderManager.create({type:t,resource:i})),i}},{key:"getEmptyModelResource",value:function(){return this._emptyModelResource}},{key:"getEmptyTextureResource",value:function(){return this._emptyTextureResource}},{key:"disposeModels",value:function(){for(var e=0;e<this.models.length;e++)this.models[e].clear()}},{key:"disposeTextures",value:function(){for(var e=0;e<this.textures.length;e++)this.textures[e].clear()}},{key:"clear",value:function(){this.disposeTextures(),this.disposeModels(),this.textures=[],this.models=[]}},{key:"isGlobalResourcesBuilded",get:function(){return this._isGlobalResourcesBuilded}}]),e}(),ji=(new Si,{DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),r=0;return function(){for(var n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*ji.DEG2RAD},radToDeg:function(e){return e*ji.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}}),Pi="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},Ri=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Di=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Ai=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},ki=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Oi=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},Bi=function(){function e(e,t){var i=[],r=!0,n=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Fi=function(){function e(t,i,r,n){Ri(this,e),this._x=t||0,this._y=i||0,this._z=r||0,this._w=void 0!==n?n:1}return Di(e,[{key:"slerp",value:function(e,t,i,r){return i.copy(e).slerp(t,r)}},{key:"slerpFlat",value:function(e,t,i,r,n,o,s){var a=i[r+0],l=i[r+1],u=i[r+2],c=i[r+3],h=n[o+0],p=n[o+1],d=n[o+2],f=n[o+3];if(c!==f||a!==h||l!==p||u!==d){var m=1-s,g=a*h+l*p+u*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,s=Math.sin(s*_)/b}var x=s*v;if(a=a*m+h*x,l=l*m+p*x,u=u*m+d*x,c=c*m+f*x,m===1-s){var E=1/Math.sqrt(a*a+l*l+u*u+c*c);a*=E,l*=E,u*=E,c*=E}}e[t]=a,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"set",value:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,r=e._y,n=e._z,o=e.order,s=Math.cos,a=Math.sin,l=s(i/2),u=s(r/2),c=s(n/2),h=a(i/2),p=a(r/2),d=a(n/2);return"XYZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"YXZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"ZXY"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"ZYX"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"YZX"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c-h*p*d):"XZY"===o&&(this._x=h*u*c-l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c+h*p*d),!1!==t&&this.onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this.onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],s=i[1],a=i[5],l=i[9],u=i[2],c=i[6],h=i[10],p=r+a+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(s-n)*t):r>a&&r>h?(t=2*Math.sqrt(1+r-a-h),this._w=(c-l)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(o+u)/t):a>h?(t=2*Math.sqrt(1+a-r-h),this._w=(o-u)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-r-a),this._w=(s-n)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var i,r=new Li,n=1e-6;return void 0===r&&(r=new Li),(i=e.dot(t)+1)<n?(i=0,Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0):r.set(0,-e.z,e.y)):r.crossVectors(e,t),this._x=r.x,this._y=r.y,this._z=r.z,this._w=i,this.normalize()}},{key:"inverse",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,s=t._x,a=t._y,l=t._z,u=t._w;return this._x=i*u+o*s+r*l-n*a,this._y=r*u+o*a+n*s-i*l,this._z=n*u+o*l+i*a-r*s,this._w=o*u-i*s-r*a-n*l,this.onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,s=o*e._w+i*e._x+r*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(r+this._y),this._z=.5*(n+this._z),this;var l=Math.atan2(a,s),u=Math.sin((1-t)*l)/a,c=Math.sin(t*l)/a;return this._w=o*u+this._w*c,this._x=i*u+this._x*c,this._y=r*u+this._y*c,this._z=n*u+this._z*c,this.onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"onChange",value:function(e){return this.onChangeCallback=e,this}},{key:"onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}]),e}(),Li=function(){function e(t,i,r){Ri(this,e),this.x=t||0,this.y=i||0,this.z=r||0,this.isVector3=!0}return Di(e,[{key:"set",value:function(e,t,i){return this.x=e,this.y=t,this.z=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(){var e=new Fi;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}()}},{key:"applyAxisAngle",value:function(){var e=new Fi;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i))}()}},{key:"applyMatrix3",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}},{key:"applyQuaternion",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*i,u=a*i+s*t-n*r,c=a*r+n*i-o*t,h=-n*t-o*i-s*r;return this.x=l*a+h*-n+u*-s-c*-o,this.y=u*a+h*-o+c*-n-l*-s,this.z=c*a+h*-s+l*-o-u*-n,this}},{key:"transformDirection",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(){var t=new e,i=new e;return function(e,r){return t.set(e,e,e),i.set(r,r,r),this.clamp(t,i)}()}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-i*e.z,this.z=i*e.y-r*e.x,this}},{key:"crossVectors",value:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this}},{key:"projectOnVector",value:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)}},{key:"projectOnPlane",value:function(){var t=new e;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}},{key:"reflect",value:function(){var t=new e;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}()}},{key:"angleTo",value:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(ji.clamp(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this}},{key:"setFromCylindrical",value:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}]),e}(),Ii={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},Ni=function(){function e(){Ri(this,e)}return Di(e,null,[{key:"uuid",value:function(){for(var e,t=Ii.chars,i=Ii.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Pi(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}},{key:"convertToVector3",value:function(e){return e.isVector3?e:new Li(e[0],e[1],e[2])}},{key:"convertToQuaternion",value:function(e){return new Fi(e[0],e[1],e[2],e[3])}},{key:"applyQuaternionToVector3",value:function(e,t){if(0!==e[0]||0!==e[1]||0!==e[2]||1!==e[3]){var i=t[0],r=t[1],n=t[2],o=e[0],s=e[1],a=e[2],l=e[3],u=l*i+s*n-a*r,c=l*r+a*i-o*n,h=l*n+o*r-s*i,p=-o*i-s*r-a*n;t[0]=u*l+p*-o+c*-a-h*-s,t[1]=c*l+p*-s+h*-o-u*-a,t[2]=h*l+p*-a+u*-s-c*-o}}}]),e}();Ni.wallTopFaceIndexes=[0,2,1,0,3,2],Ni.wallStartFaceIndexes=[1,4,0,1,5,4],Ni.wallEndFaceIndexes=[3,7,2,2,7,6],Ni.wallStartCornerFaceIndexes=[1,8,0],Ni.wallEndCornerFaceIndexes=[3,9,2],Ni.wallBottomFaceIndexes=[4,5,6,4,6,7];var Ui,zi,Hi=function(){function e(){Ri(this,e),this._initParams(),this.id=Ni.uuid(),this.type="BaseObject",this.calculaterData={}}return Di(e,[{key:"_initParams",value:function(){this.id=null,this.name=null,this.userID=null,this.resource=null,this.position=null,this.rotation=null,this.scale=null,this._parent=null,this.resource=null,this._resources=null}},{key:"calculate",value:function(){this.calculater&&this.calculater.build(this)}},{key:"createMesh",value:function(){if(this.meshBuilder)return this.meshBuilder.build(this)}},{key:"clear",value:function(){this.calculater&&this.calculater.clear(),this._initParams()}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource)),this._resources}}]),e}(),Vi=function(e){function t(e,i,r){Ri(this,t);var n=Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.walls=[],n.type="WallCorner",n}return ki(t,e),Di(t,[{key:"_initParams",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.walls=null}},{key:"addWall",value:function(e){for(var t=0,i=this.walls.length;t<i;t++)if(this.walls[t]===e)return void console.error("repeat wall"+e);this.walls.push(e)}}]),t}(Hi),Wi=function(){function e(t){Ri(this,e),this._init(),this.subMeshes=[],this.extraData={},this.vertices=[],this.normals=[],this.uvs=[],this.uv2s=[],this.resource=null,this.triangles=[]}return Di(e,[{key:"_init",value:function(){this.vertices=null,this.normals=null,this.uvs=null,this.uv2s=null,this.resource=null,this.triangles=null,this.subMeshes=[],this.extraData={}}},{key:"clone",value:function(){var t=new e;for(var i in t.vertices=this.vertices.slice(),t.normals=this.normals.slice(),t.uvs=this.uvs.slice(),t.uv2s=this.uv2s.slice(),t.resource=this.resource,t.triangles=this.triangles.slice(),this.extraData)t.extraData[i]=this.extraData[i].slice();for(var r=0;r<this.subMeshes.length;r++){var n=this.subMeshes[r].clone();t.subMeshes.push(n)}return t}},{key:"clear",value:function(){for(var e=0;e<this.subMeshes.length;e++)this.subMeshes[e].clear();this._init()}}]),e}(),Gi=function(){function e(t){Ri(this,e),this._initParams(),this.isBuilded=!1,this.resourceCombineManager=t.resourceCombineManager,this.objectManager=t.objectManager}return Di(e,[{key:"setObject",value:function(e){this.clear(),this.object=e}},{key:"_initParams",value:function(){this.mesh=new Wi,this.object=null,this.isBuilded=!1,this.objectManager=null}},{key:"build",value:function(e){this.setObject(e),this._calculate(),this.object.calculaterMesh=this.mesh,this.mesh=null}},{key:"_calculate",value:function(){}},{key:"clear",value:function(){this._initParams()}}]),e}();function qi(e,t){this.x=e||0,this.y=t||0}Object.defineProperties(qi.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(qi.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:(Ui=new qi,zi=new qi,function(e,t){return Ui.set(e,e),zi.set(t,t),this.clamp(Ui,zi)}),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},distanceToManhattan:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}});var Xi=function(e){function t(e){Ri(this,t);var i=Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.walls=[],i}return ki(t,e),Di(t,[{key:"_initParams",value:function(){this.walls=[],this.position=null}},{key:"_calculate",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this),this.walls=this.object.walls,this.position=Ni.convertToVector3(this.object.position);var e=this.getSameHeightWalls(this.object);for(var i in e)this.calWallsVertices(e[i])}},{key:"isFirstWallShouldNotCal",value:function(e){return!("StraightManualWall"===e.type)||"SubStraightManualWall"===e}},{key:"isSecondWallShouldNotCal",value:function(e){return null!=e&&(e.resource&&e.resource.isModel||"SubStraightManualWall"===e.type)}},{key:"checkWallsSameHeight",value:function(e){for(var t=null,i=0;i<e.walls.length;i++){var r=e.walls[i];if("StraightManualWall"===r.type)if(null===t)t=r.height;else if(t!==r.height)return!1}return!0}},{key:"containModelWall",value:function(e){for(var t=0;t<e.walls.length;t++)if("ModelWall"===e.walls[t].type)return!0;return!1}},{key:"getSameHeightWalls",value:function(e){for(var t={},i=0;i<e.walls.length;i++){var r=e.walls[i];this.isStraightManualWall(r)&&(void 0===t[r.height]&&(t[r.height]=[]),t[r.height].push(r))}return t}},{key:"isStraightManualWall",value:function(e){return"StraightManualWall"===e.type}},{key:"calWallsVertices",value:function(e){var t=new Li(0,-1,0);if(1===e.length){var i=e[0];this.isStraightManualWall(i)&&this.setDefaultCornerVertices(i)}else{this.sortWalls(e);for(var r=0;r<e.length;r++){var n=e[r];if(!this.isFirstWallShouldNotCal(n)){for(var o=null,s=r;null==o&&(s===e.length-1?s=0:s+=1,e[s]!==n);)o=e[s],this.isSecondWallShouldNotCal(o)&&(o=null);if(o){var a=Ni.convertToVector3(n.getWallOtherCorner(this.object).position),l=new Li;l.subVectors(a,this.position),a=Ni.convertToVector3(o.getWallOtherCorner(this.object).position);var u=new Li;if(u.subVectors(a,this.position),l.normalize(),u.normalize(),0!==l.length()&&0!==u.length()){var c=n.thick/2,h=new Li;h.crossVectors(t,l),h.normalize();var p=h.clone();p.multiplyScalar(c),p.add(this.position),c=o.thick/2;var d=u.clone();d.cross(t),d.normalize();var f=d.clone();if(f.multiplyScalar(c),f.add(this.position),this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1),l.normalize(),u.normalize(),this.calAngle(l,u)>30){var m;if(Ni.approximatelyNumberEqual(Math.abs(l.dot(u)),1)){var g=l.clone();g.cross(t),g.normalize(),this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!0);continue}0===(m=this.getIntersectPosition(p,l,f,u)).x&&0===m.y&&0===m.z||(m.clone().y=this.position.y+this.getWallHeight(this.object),this.setCornersVertices(n,m,!0),this.setCornersVertices(o,m,!1))}else this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1)}else this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!1)}else this.setDefaultCornerVertices(n)}}}}},{key:"sortWalls",value:function(e){if(e.length>1)for(var t,i,r=e[0],n=0,o=e.length-1;n<o;){for(i=n;i<o;++i)this.angleBetween(r,e[i])>this.angleBetween(r,e[i+1])&&(t=e[i],e[i]=e[i+1],e[i+1]=t);for(i=--o;i>n;--i)this.angleBetween(r,e[i])<this.angleBetween(r,e[i-1])&&(t=e[i],e[i]=e[i-1],e[i-1]=t);++n}}},{key:"angleBetween",value:function(e,t){var i=Ni.convertToVector3(e.getWallOtherCorner(this.object).position).clone();i.sub(this.position);var r=Ni.convertToVector3(t.getWallOtherCorner(this.object).position).clone();return r.sub(this.position),this.calAngle(i,r)}},{key:"calAngle",value:function(e,t){e.normalize(),t.normalize();var i=e.angleTo(t);i*=180/Math.PI;var r=e.clone();return r.cross(t),r.y>0&&(i=360-i),i}},{key:"getWallHeight",value:function(e){for(var t=99999,i=0;i<e.walls.length;i++){var r=e.walls[i];t>r.height&&(t=r.height)}return t}},{key:"setCornersVertices",value:function(e,t,i){var r=new Li(0,0,0),n=Ni.convertToVector3(e.position);r.x=t.x-n.x,r.y=t.y-n.y,r.z=t.z-n.z,this.object.calculaterData[e.id]||(this.object.calculaterData[e.id]=[new Li,new Li]);var o=this.object.calculaterData[e.id];i?(o[0].x=r.x,o[0].y=r.y,o[0].z=r.z):(o[1].x=r.x,o[1].y=r.y,o[1].z=r.z)}},{key:"setDefaultCornerVertices",value:function(e,t){var i=new Li(0,-1,0),r=Ni.convertToVector3(e.getWallOtherCorner(this.object).position).clone();r.sub(this.position),r.normalize();var n=e.thick/2,o=i.clone();o.cross(r),o.normalize(),o.multiplyScalar(n);var s=new Li;s.addVectors(this.position,o);var a=new Li;a.subVectors(this.position,o),void 0===t?(this.setCornersVertices(e,s,!0),this.setCornersVertices(e,a,!1)):t?this.setCornersVertices(e,s,!0):this.setCornersVertices(e,a,!1)}},{key:"getIntersectPosition",value:function(e,t,i,r){if(e.x===i.x&&e.y===i.y&&e.z===i.z)return e;var n=e.y;if(1===t.dot(r))throw"two line in same direction ,can not cal intersected position!";var o=new Li,s=new Li;o.addVectors(e,t),s.addVectors(i,r);var a=new qi(e.x,e.z),l=new qi(o.x,o.z),u=new qi(i.x,i.z),c=new qi(s.x,s.z),h=(l.y-a.y)*(c.x-u.x)-(a.x-l.x)*(u.y-c.y);if(0==h)return new Li;var p=((l.x-a.x)*(c.x-u.x)*(u.y-a.y)+(l.y-a.y)*(c.x-u.x)*a.x-(c.y-u.y)*(l.x-a.x)*u.x)/h,d=-((l.y-a.y)*(c.y-u.y)*(u.x-a.x)+(l.x-a.x)*(c.y-u.y)*a.y-(c.x-u.x)*(l.y-a.y)*u.y)/h;return new Li(p,n,d)}}]),t}(Gi),Ji=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),Di(t,[{key:"_initParams",value:function(){this.walls=[],this.position=null}},{key:"_calculate",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this),this.walls=this.object.walls,this.position=Ni.convertToVector3(this.object.position);var e=this.getSameHeightWalls(this.object);for(var i in e)this.calWallsVertices(e[i])}},{key:"isFirstWallShouldNotCal",value:function(e){return!this.isStraightManualWall(e)}},{key:"isSecondWallShouldNotCal",value:function(e){return!this.isStraightManualWall(e)}},{key:"checkWallsSameHeight",value:function(e){for(var t=null,i=0;i<e.walls.length;i++){var r=e.walls[i];if(null===t)t=r.height;else if(t!==r.height)return!1}return!0}},{key:"containModelWall",value:function(e){for(var t=0;t<e.walls.length;t++)if("ModelWall"===e.walls[t].type)return!0;return!1}},{key:"getSameHeightWalls",value:function(e){for(var t={},i=0;i<e.walls.length;i++){var r=e.walls[i];this.isStraightManualWall(r)&&(void 0===t[r.height]&&(t[r.height]=[]),t[r.height].push(r))}return t}},{key:"isStraightManualWall",value:function(e){return"SubStraightManualWall"===e.type||"SubDoorOrWindowStraightManualWall"===e.type}}]),t}(Xi),Yi=function(e){function t(){Ri(this,t);var e=Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="SubWallCorner",e.calculater=new Ji({object:e}),e}return ki(t,e),Di(t,[{key:"_initParams",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.calculater=null}},{key:"build",value:function(){this.calculate()}},{key:"isFirstWallShouldNotCal",value:function(e){return!("SubStraightManualWall"===e)}},{key:"isSecondWallShouldNotCal",value:function(e){return e&&!("SubStraightManualWall"===e.type)}}],[{key:"createSubWallCorner",value:function(e,i,r){var n=new t;return n.id=e,n.position=i,n.parent=r.parent,n}}]),t}(Vi),Zi={SubStraightManualWall:"SubStraightManualWall",SubDoorOrWindowStraightManualWall:"SubDoorOrWindowStraightManualWall",SubWallCorner:"SubWallCorner",SubModelWall:"SubModelWall"},Qi=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),Di(t,[{key:"setObject",value:function(e){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setObject",this).call(this,e),this.object=e,this.startCorner=this.object.startCorner,this.endCorner=this.object.endCorner,this.startCornerPosition=Ni.convertToVector3(this.startCorner.position),this.endCornerPosition=Ni.convertToVector3(this.endCorner.position),this.position=Ni.convertToVector3(this.object.position),this.direction=Ni.convertToVector3(this.object.direction),this.suspend=this.object.suspend,this.doorOrWindows=this.object.doorOrWindows,this.object.calculaterData.subWalls=[],this.object.calculaterData.subCorners=[],this.subWalls=this.object.calculaterData.subWalls,this.subCorners=this.object.calculaterData.subCorners}},{key:"_initParams",value:function(){this.startCorner=null,this.endCorner=null,this.startCornerPosition=null,this.endCornerPosition=null,this.position=null,this.direction=null,this.suspend=null,this.doorOrWindows=null,this.subWalls=[],this.subCorners=[]}},{key:"sortDoorOrWins",value:function(){var e=this.startCornerPosition,t=this.endCornerPosition,i=t.x-e.x>0?1:-1,r=t.z-e.z>0?1:-1,n=!0;Math.abs(t.x-e.x)<.001&&(n=!1);for(var o=[],s=0;s<this.doorOrWindows.length;s++){for(var a=this.doorOrWindows[s],l=0;l<o.length;l++){var u=o[l];if((n?(u.position[0]-a.position[0])*i:(u.position[2]-a.position[2])*r)>=0){o.splice(l,0,a);break}if(l===o.length-1){o.push(a);break}}0===o.length&&o.push(a)}return o}},{key:"getDoorOrWinStartAndEndPos",value:function(e){var t=Ni.convertToVector3(e.size),i=this.direction,r=Ni.convertToVector3(e.position);r.y=0;var n=r.clone(),o=r.clone(),s=t.x/2;return n.subVectors(n,i.clone().multiplyScalar(s)),o.addVectors(o,i.clone().multiplyScalar(s)),[n,o]}},{key:"addSubWallCorner",value:function(e){for(var t=0;t<this.subCorners.length;t++)if(this.subCorners[t]===e)return;this.subCorners.push(e)}},{key:"getWallCornerByPos",value:function(e){for(var t=null,i=-1,r=this.subCorners,n=0;n<r.length;n++){var o=e.distanceTo(r[n].position);o<.01&&(null===t?(t=r[n],i=o):o<i&&(i=o,t=r[n]))}return t}}]),t}(Gi),Ki=function(e){function t(e){Ri(this,t);var i=Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.upDirection=new Li(0,1,0),i.downDirection=new Li(0,-1,0),i.vectorUp=new Li(0,1,0),i}return ki(t,e),Di(t,[{key:"setObject",value:function(e){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setObject",this).call(this,e);var i=e.calculaterData;i.pathPoints=[],i.selfPathPoints=[],i.repeatUV=[],i.startUVPercent=[0,0,0,0],i.endUVPercent=[1,1,1,1],i.basePoints=[],this.pathPoints=i.pathPoints,this.selfPathPoints=i.selfPathPoints,this.cornersVertices=[this.object.startCorner.calculaterData[this.object.id][0],this.object.startCorner.calculaterData[this.object.id][1],this.object.endCorner.calculaterData[this.object.id][0],this.object.endCorner.calculaterData[this.object.id][1]],i.cornersVertices=this.cornersVertices,this.basePoints=i.basePoints;for(var r=0;r<12;r++)this.basePoints.push(new Li);this.repeatUV=i.repeatUV,this.startUVPercent=i.startUVPercent,this.endUVPercent=i.endUVPercent}},{key:"_initParams",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.pathPoints=null,this.cornersVertices=null,this.selfPathPoints=null,this.rightSideLength=null,this.leftSideLength=null,this.repeatUV=null,this.basePoints=null,this.startUVPercent=null,this.endUVPercent=null,this.leftMesh=null,this.rightMesh=null,this.edgeMesh=null,this.mesh=null,this.rightSideLength=null,this.leftSideLength=null,this.pathPoints=[],this.selfPathPoints=[],this.leftMesh=new Wi,this.rightMesh=new Wi,this.edgeMesh=new Wi,this.mesh=new Wi,this.repeatUV=[],this.startUVPercent=[0,0,0,0],this.endUVPercent=[1,1,1,1]}},{key:"_calculate",value:function(){if(this.object.doorOrWindows.length>0){this.baseBuild(),this.calPosInfo(),this.calEachSideLen(),this.calRepeatUV(),this.initSimpleCornersAndWalls();for(var e=0;e<this.subCorners.length;e++)this.subCorners[e].build();for(var t=0;t<this.subWalls.length;t++){var i=this.subWalls[t];i.calculate(),this.mesh.subMeshes.push(i.calculater.mesh)}}else this.initMeshInfo();this.object.calculaterMesh=this.mesh}},{key:"initMeshInfo",value:function(){this.baseBuild(),this.calPosInfo(),this.calEachSideLen(),this.calRepeatUV(),this.calBasePoints(),this.fillMesh()}},{key:"baseBuild",value:function(){this.pathPoints.push(this.startCornerPosition),this.pathPoints.push(this.endCornerPosition)}},{key:"calEachSideLen",value:function(){var e=new Li;e.subVectors(this.endCornerPosition,this.startCornerPosition),e.normalize();var t=this.object.thick/2,i=new Li;i.crossVectors(this.downDirection,e),i.normalize();var r=i.clone();r.negate();var n=i.clone();n.multiplyScalar(t);var o=r.clone();o.multiplyScalar(t);var s=new Li,a=new Li,l=new Li,u=new Li;Ni.equalVectorZero(this.cornersVertices[0])?s.addVectors(this.selfPathPoints[0],n):s.copy(this.cornersVertices[0]),Ni.equalVectorZero(this.cornersVertices[3])?a.addVectors(this.selfPathPoints[1],n):a.copy(this.cornersVertices[3]),Ni.equalVectorZero(this.cornersVertices[1])?l.addVectors(this.selfPathPoints[0],o):l.copy(this.cornersVertices[1]),Ni.equalVectorZero(this.cornersVertices[2])?u.addVectors(this.selfPathPoints[1],o):u.copy(this.cornersVertices[2]),this.rightSideLength=new Li,this.leftSideLength=new Li,this.rightSideLength.subVectors(s,a),this.leftSideLength.subVectors(l,u),this.rightSideLength=this.rightSideLength.length(),this.leftSideLength=this.leftSideLength.length(),this.object.calculaterData.rightSideLength=this.rightSideLength,this.object.calculaterData.leftSideLength=this.leftSideLength}},{key:"calRepeatUV",value:function(){var e=this.object.uvMultiple,t=this.object.height,i=this.object.parent.height;this.repeatUV[0]=e[0]*this.rightSideLength/i,this.repeatUV[1]=e[1]*t/i,this.repeatUV[2]=e[0]*this.leftSideLength/i,this.repeatUV[3]=e[1]*t/i,this.object.calculaterData.repeatUV=this.repeatUV}},{key:"calPosInfo",value:function(){var e=new Li;this.selfPathPoints.push(e.subVectors(this.startCornerPosition,this.position)),e=new Li,this.selfPathPoints.push(e.subVectors(this.endCornerPosition,this.position)),this.selfPathPoints[0].y=0,this.selfPathPoints[1].y=0}},{key:"calBasePoints",value:function(){var e=this.object.thick,t=this.object.height,i=this.direction;if(null===this.basePoints){this.basePoints=[];for(var r=0;r<12;r++)this.basePoints.push(new Li)}var n=e/2,o=new Li;o.crossVectors(this.downDirection,i),o.normalize();var s=o.clone();s.negate();var a=o.multiplyScalar(n);Ni.equalVectorZero(this.cornersVertices[0])?(this.basePoints[4].x=this.selfPathPoints[0].x+a.x,this.basePoints[4].y=0,this.basePoints[4].z=this.selfPathPoints[0].z+a.z):(this.basePoints[4].x=this.cornersVertices[0].x,this.basePoints[4].y=0,this.basePoints[4].z=this.cornersVertices[0].z),Ni.equalVectorZero(this.cornersVertices[1])?(a=s.multiplyScalar(n),this.basePoints[5].x=this.selfPathPoints[0].x+a.x,this.basePoints[5].y=0,this.basePoints[5].z=this.selfPathPoints[0].z+a.z):(this.basePoints[5].x=this.cornersVertices[1].x,this.basePoints[5].y=0,this.basePoints[5].z=this.cornersVertices[1].z);var l=i.clone();o.crossVectors(this.downDirection,l.negate()),o.normalize(),(s=o.clone()).negate(),Ni.equalVectorZero(this.cornersVertices[2])?((a=o.clone()).multiplyScalar(n),this.basePoints[6].x=this.selfPathPoints[1].x+a.x,this.basePoints[6].y=0,this.basePoints[6].z=this.selfPathPoints[1].z+a.z):(this.basePoints[6].x=this.cornersVertices[2].x,this.basePoints[6].y=0,this.basePoints[6].z=this.cornersVertices[2].z),Ni.equalVectorZero(this.cornersVertices[3])?((a=s.clone()).multiplyScalar(n),this.basePoints[7].x=this.selfPathPoints[1].x+a.x,this.basePoints[7].y=0,this.basePoints[7].z=this.selfPathPoints[1].z+a.z):(this.basePoints[7].x=this.cornersVertices[3].x,this.basePoints[7].y=0,this.basePoints[7].z=this.cornersVertices[3].z),this.basePoints[0].x=this.basePoints[4].x,this.basePoints[0].y=this.basePoints[4].y+t,this.basePoints[0].z=this.basePoints[4].z,this.basePoints[1].x=this.basePoints[5].x,this.basePoints[1].y=this.basePoints[5].y+t,this.basePoints[1].z=this.basePoints[5].z,this.basePoints[2].x=this.basePoints[6].x,this.basePoints[2].y=this.basePoints[6].y+t,this.basePoints[2].z=this.basePoints[6].z,this.basePoints[3].x=this.basePoints[7].x,this.basePoints[3].y=this.basePoints[7].y+t,this.basePoints[3].z=this.basePoints[7].z,this.basePoints[8].x=this.selfPathPoints[0].x,this.basePoints[8].y=this.selfPathPoints[0].y+t,this.basePoints[8].z=this.selfPathPoints[0].z,this.basePoints[9].x=this.selfPathPoints[1].x,this.basePoints[9].y=this.selfPathPoints[1].y+t,this.basePoints[9].z=this.selfPathPoints[1].z}},{key:"initSimpleCornersAndWalls",value:function(){this.position;var e=this.direction,t=this.object.id;(new Li).crossVectors(e,this.vectorUp);for(var i=this.sortDoorOrWins(),r=0;r<i.length;r++){var n=i[r],o=this.getDoorOrWinStartAndEndPos(n),s=(this.getDoorOrWinRectPoints(n),Yi.createSubWallCorner(t+"_"+r+"_1",o[0],this.object)),a=Yi.createSubWallCorner(t+"_"+r+"_2",o[1],this.object);if(this.addSubWallCorner(s),this.addSubWallCorner(a),0===r){var l=this.createSubStraightManualWall(this.object.startCorner,s,r,i,"start");this.object.startCorner.calculaterData[l.id]=[];for(var u=this.object.startCorner.calculaterData[this.object.id],c=0;c<u.length;c++){var h=u[c].clone();h.add(Ni.convertToVector3(this.object.position)),h.sub(l.position),this.object.startCorner.calculaterData[l.id].push(h)}}else{var p=i[r-1],d=this.getDoorOrWinStartAndEndPos(p),f=this.getWallCornerByPos(d[1]);this.createSubStraightManualWall(f,s,r,i)}if(r===i.length-1){var m=this.createSubStraightManualWall(a,this.object.endCorner,r,i,"end");this.object.endCorner.calculaterData[m.id]=[];for(var g=this.object.endCorner.calculaterData[this.object.id],v=0;v<g.length;v++){var y=g[v].clone();y.add(Ni.convertToVector3(this.object.position)),y.sub(m.position),this.object.endCorner.calculaterData[m.id].push(y)}}this.buildHeadAndFootWall(n,s,a)}}},{key:"setSubWallCornerVerrices",value:function(){}},{key:"buildHeadAndFootWall",value:function(e,t,i){this.getDoorOrWinRectPoints(e);var r=e.suspendPercent;(new Li).crossVectors(this.direction,this.vectorUp);var n=Ni.convertToVector3(e.size).y+this.object.height*r;if(0!==e.suspendPercent){var o=this.createSubDoorOrWindowStraightManualWall(t,i,e,"down"),s=new Li;s.subVectors(i.position,t.position),s.length(),o.height=this.object.height*r}if(n<this.object.height){var a=this.createSubDoorOrWindowStraightManualWall(t,i,e,"up");a.suspend=n,a.height=this.object.height-n,a.thick=this.object.thick}}},{key:"createSubStraightManualWall",value:function(e,t,i,r,n){var o=this.object,s=this.objectManager.create({type:Zi.SubStraightManualWall});return s.id=Ni.uuid(),s.startCorner=e,s.endCorner=t,s.leftResource=o.leftResource,s.rightResource=o.rightResource,s.edgeResource=o.edgeResource,s.height=o.height,s.thick=o.thick,s.parentWall=o,s.calculaterData.repeatUV=this.object.calculaterData.repeatUV,s.calculaterData.index=i,s.calculaterData.doorOrWindows=r,s.calculaterData.buildType=n,this.subWalls.push(s),s}},{key:"createSubDoorOrWindowStraightManualWall",value:function(e,t,i,r){var n=this.object,o=this.objectManager.create({type:Zi.SubDoorOrWindowStraightManualWall});return o.id=Ni.uuid(),o.startCorner=e,o.endCorner=t,o.leftResource=n.leftResource,o.rightResource=n.rightResource,o.edgeResource=n.edgeResource,o.height=n.height,o.thick=n.thick,o.parentWall=n,o.calculaterData.repeatUV=this.object.calculaterData.repeatUV,o.calculaterData.doorOrWindow=i,o.calculaterData.buildType=r,this.subWalls.push(o),o}},{key:"setCornerVertices",value:function(e,t){e.calculaterData.cornersVertices||(e.calculaterData.cornersVertices=[new Li,new Li,new Li,new Li]);var i,r,n=e.calculaterData.cornersVertices;t?((i=new Li).addVectors(this.object.calculater.cornersVertices[0],this.position),i.sub(e.position),(r=new Li).addVectors(this.object.calculater.cornersVertices[1],this.position),r.sub(e.position),n[0]=i,n[1]=r):((i=new Li).addVectors(this.object.calculater.cornersVertices[2],this.position),i.sub(e.position),(r=new Li).addVectors(this.object.calculater.cornersVertices[3],this.position),r.sub(e.position),n[2]=i,n[3]=r),e.calculater.cornersVertices=n}},{key:"getDoorOrWinRectPoints",value:function(e){var t=this.object.thick/2,i=new Li;i.crossVectors(this.vectorUp,this.direction),i.normalize();var r=i.clone();r.negate(),this.vectorUp.clone().multiplyScalar(t);var n=Ni.convertToVector3(e.size),o=this.direction,s=Ni.convertToVector3(e.position),a=n.x/2,l=new Li,u=new Li;return l.subVectors(s,o.clone().multiplyScalar(a)),u.addVectors(s,o.clone().multiplyScalar(a)),[l.clone().addVectors(l,i.clone().multiplyScalar(t)),l.clone().addVectors(l,r.clone().multiplyScalar(t)),u.clone().addVectors(u,r.clone().multiplyScalar(t)),u.clone().addVectors(u,i.clone().multiplyScalar(t))]}},{key:"fillMesh",value:function(){this.leftMesh=new Wi,this.rightMesh=new Wi,this.edgeMesh=new Wi,this.mesh=new Wi,this.fillEdgeSideMeshInfo(),this.fillLeftMeshInfo(),this.fillRightMeshInfo(),this.mesh.subMeshes=[this.rightMesh,this.leftMesh,this.edgeMesh]}},{key:"fillRightMeshInfo",value:function(){this.rightMesh.resource=this.object.rightResource,this.rightMesh.vertices=new Float32Array(12),this.rightMesh.normals=new Float32Array(12),this.rightMesh.triangles=new Uint16Array(6),this.rightMesh.triangles[0]=0,this.rightMesh.triangles[1]=2,this.rightMesh.triangles[2]=3,this.rightMesh.triangles[3]=0,this.rightMesh.triangles[4]=1,this.rightMesh.triangles[5]=2,this.rightMesh.uvs=[],this.rightMesh.uv2s=[];var e,t,i,r,n=this.basePoints,o=[n[0],n[4],n[7],n[3]],s=new Li;s.crossVectors(this.downDirection,this.direction),s.normalize(),this.object.rightResource.isDefault?(e=this.startUVPercent[0],t=this.startUVPercent[1],i=this.endUVPercent[0],r=this.endUVPercent[1]):(e=this.startUVPercent[0]*this.repeatUV[0],t=this.startUVPercent[1]*this.repeatUV[1],i=this.endUVPercent[0]*this.repeatUV[0],r=this.endUVPercent[1]*this.repeatUV[1]),this.rightMesh.uvs=new Float32Array(8),this.rightMesh.uvs[0]=e,this.rightMesh.uvs[1]=r,this.rightMesh.uvs[2]=e,this.rightMesh.uvs[3]=t,this.rightMesh.uvs[4]=i,this.rightMesh.uvs[5]=t,this.rightMesh.uvs[6]=i,this.rightMesh.uvs[7]=r,this.object.rightResource.isDefault&&(e=this.startUVPercent[0],t=this.startUVPercent[1],i=this.endUVPercent[0],r=this.endUVPercent[1],this.rightMesh.uv2s=new Float32Array(8),this.rightMesh.uv2s[0]=e,this.rightMesh.uv2s[1]=r,this.rightMesh.uv2s[2]=e,this.rightMesh.uv2s[3]=t,this.rightMesh.uv2s[4]=i,this.rightMesh.uv2s[5]=t,this.rightMesh.uv2s[6]=i,this.rightMesh.uv2s[7]=r);for(var a=0;a<o.length;a++){var l=o[a],u=3*a;this.rightMesh.vertices[u]=l.x,this.rightMesh.vertices[u+1]=l.y+this.suspend,this.rightMesh.vertices[u+2]=l.z}for(var c=0;c<o.length;c++){var h=s,p=3*c;this.rightMesh.normals[p]=h.x,this.rightMesh.normals[p+1]=h.y,this.rightMesh.normals[p+2]=h.z}}},{key:"fillLeftMeshInfo",value:function(){this.leftMesh.resource=this.object.leftResource,this.leftMesh.vertices=new Float32Array(12),this.leftMesh.normals=new Float32Array(12),this.leftMesh.uvs=[],this.leftMesh.triangles=new Uint16Array(6),this.leftMesh.triangles[0]=3,this.leftMesh.triangles[1]=1,this.leftMesh.triangles[2]=0,this.leftMesh.triangles[3]=3,this.leftMesh.triangles[4]=2,this.leftMesh.triangles[5]=1;var e,t,i,r,n=this.basePoints,o=[n[1],n[5],n[6],n[2]],s=new Li;s.crossVectors(this.direction,this.downDirection),s.normalize(),this.object.leftResource.isDefault?(e=this.startUVPercent[2],t=this.startUVPercent[3],i=this.endUVPercent[2],r=this.endUVPercent[3]):(e=this.startUVPercent[2]*this.repeatUV[2],t=this.startUVPercent[3]*this.repeatUV[3],i=this.endUVPercent[2]*this.repeatUV[2],r=this.endUVPercent[3]*this.repeatUV[3]),this.leftMesh.uvs=new Float32Array(8),this.leftMesh.uvs[0]=i,this.leftMesh.uvs[1]=r,this.leftMesh.uvs[2]=i,this.leftMesh.uvs[3]=t,this.leftMesh.uvs[4]=e,this.leftMesh.uvs[5]=t,this.leftMesh.uvs[6]=e,this.leftMesh.uvs[7]=r,this.object.leftResource.isDefault&&(e=this.startUVPercent[0],t=this.startUVPercent[1],i=this.endUVPercent[0],r=this.endUVPercent[1],this.leftMesh.uv2s=new Float32Array(8),this.leftMesh.uv2s[0]=e,this.leftMesh.uv2s[1]=r,this.leftMesh.uv2s[2]=e,this.leftMesh.uv2s[3]=t,this.leftMesh.uv2s[4]=i,this.leftMesh.uv2s[5]=t,this.leftMesh.uv2s[6]=i,this.leftMesh.uv2s[7]=r);for(var a=0;a<o.length;a++){var l=o[a],u=3*a;this.leftMesh.vertices[u]=l.x,this.leftMesh.vertices[u+1]=l.y+this.suspend,this.leftMesh.vertices[u+2]=l.z}for(var c=0;c<o.length;c++){var h=s,p=3*c;this.leftMesh.normals[p]=h.x,this.leftMesh.normals[p+1]=h.y,this.leftMesh.normals[p+2]=h.z}}},{key:"fillEdgeSideMeshInfo",value:function(){this.edgeMesh.resource=this.object.edgeResource;var e=Ni.wallTopFaceIndexes,t=Ni.wallStartFaceIndexes,i=Ni.wallEndFaceIndexes,r=Ni.wallStartCornerFaceIndexes,n=Ni.wallEndCornerFaceIndexes,o=Ni.wallBottomFaceIndexes;this.edgeMesh.triangles=new Uint16Array(this.getEdgeTrianglesCount(this.object));for(var s=e.length,a=0;a<e.length;a++)this.edgeMesh.triangles[a]=e[a];if(this.shouldAddSideIndexes(this.startCorner)){for(var l=0;l<t.length;l++)this.edgeMesh.triangles[s+l]=t[l];s+=t.length}if(this.shouldAddSideIndexes(this.endCorner)){for(var u=0;u<i.length;u++)this.edgeMesh.triangles[s+u]=i[u];s+=i.length}if(this.startCorner.walls.length>2){for(var c=0;c<r.length;c++)this.edgeMesh.triangles[s+c]=r[c];s+=r.length}if(this.endCorner.walls.length>2){for(var h=0;h<n.length;h++)this.edgeMesh.triangles[s+h]=n[h];s+=n.length}if(0!==this.object.suspend)for(var p=0;p<o.length;p++)this.edgeMesh.triangles[s+p]=o[p];this.edgeMesh.vertices=new Float32Array(30),this.edgeMesh.normals=new Float32Array(30),this.edgeMesh.uvs=new Float32Array(20);for(var d=this.basePoints,f=[d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9]],m=0;m<f.length;m++){var g=f[m],v=3*m;this.edgeMesh.vertices[v]=g.x,this.edgeMesh.vertices[v+1]=g.y+this.object.suspend,this.edgeMesh.vertices[v+2]=g.z}for(var y=0;y<f.length;y++){var b=this.upDirection,_=3*y;this.edgeMesh.normals[_]=b.x,this.edgeMesh.normals[_+1]=b.y,this.edgeMesh.normals[_+2]=b.z}}},{key:"getEdgeTrianglesCount",value:function(e){var t=Ni.wallTopFaceIndexes.length;return this.shouldAddSideIndexes(e.startCorner)&&(t+=Ni.wallStartFaceIndexes.length),this.shouldAddSideIndexes(e.endCorner)&&(t+=Ni.wallEndFaceIndexes.length),e.startCorner.walls.length>2&&(t+=Ni.wallStartCornerFaceIndexes.length),e.endCorner.walls.length>2&&(t+=Ni.wallEndCornerFaceIndexes.length),0!==this.object.suspend&&(t+=Ni.wallBottomFaceIndexes.length),t}},{key:"shouldAddSideIndexes",value:function(e){for(var t=0,i=0;i<e.walls.length;i++)"StraightManualWall"===e.walls[i].type&&t++;return 1===t||!(e.calculater.checkWallsSameHeight(e)&&!e.calculater.containModelWall(e))}},{key:"shouldAddEdgeTriangle",value:function(e){for(var t=0,i=0;i<e.walls.length;i++)"StraightManualWall"===e.walls[i].type&&t++;return t>2}},{key:"clear",value:function(){this.leftMesh.clear(),this.rightMesh.clear(),this.edgeMesh.clear(),Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(Qi),$i=function(e){function t(e){Ri(this,t);var i=Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.meshMap=new Map,i.resources=[],i}return ki(t,e),Di(t,[{key:"_calculate",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this)}},{key:"_initParams",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.meshMap=new Map,this.resources=[]}},{key:"classifyMeshesToDic",value:function(e){this.meshMap.clear();for(var t=0;t<e.length;t++){var i=e[t].calculater.mesh;this.addMeshToMap(i)}}},{key:"addMeshToMap",value:function(e){if(e.subMeshes.length>0)for(var t=0;t<e.subMeshes.length;t++){var i=e.subMeshes[t];this.addMeshToMap(i)}e.resource&&(this.meshMap.has(e.resource)||(this.resources.push(e.resource),this.meshMap.set(e.resource,[])),this.meshMap.get(e.resource).push(e))}},{key:"combineMeshes",value:function(){var e=!0,t=!1,i=void 0;try{for(var r,n=this.meshMap[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var o=r.value,s=Bi(o,2),a=s[0],l=s[1],u=this._combineSubMeshes(l);u.resource=a,this.mesh.subMeshes.push(u)}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}}},{key:"_combineSubMeshes",value:function(e){var t=new Wi,i=void 0;i=this._initCombineMesh(e,t);for(var r=0;r<e.length;r++){var n=e[r];this._combineIndexes(n,t,i),this._combinePositionsAndNormals(n,t,i),this._combineUVs(n,t,i),this._combineExtraData(n,t,i)}return t}},{key:"_initCombineMesh",value:function(e,t,i){var r=0,n=0,o=0,s=0,a=0,l={};i={index:0,vertex:0,uv:0,uv2:0};for(var u=0;u<e.length;u++){var c=e[u];for(var h in r+=c.triangles.length,n+=c.vertices.length,o+=c.uvs.length,s+=c.uv2s.length,a+=c.normals.length,c.extraData)"groups"!==h&&(void 0===l[h]&&(l[h]=0),l[h]+=c.extraData[h].length)}for(var p in t.vertices=new Float32Array(n),t.triangles=new Uint16Array(r),t.uvs=new Float32Array(o),t.uv2s=new Float32Array(s),t.normals=new Float32Array(a),l)t.extraData[p]=new Float32Array(l[p]),i[p]=0;return i}},{key:"_combineIndexes",value:function(e,t,i){for(var r=e.triangles,n=0;n<r.length;n++){var o=r[n];t.triangles[i.index+n]=i.vertex/3+o}i.index+=r.length}},{key:"_combinePositionsAndNormals",value:function(e,t,i){for(var r=e.vertices,n=e.normals,o=0;o<r.length;o++)t.vertices[i.vertex+o]=r[o],t.normals[i.vertex+o]=n[o];i.vertex+=r.length}},{key:"_combineUVs",value:function(e,t,i){for(var r=e.uvs,n=e.uv2s,o=0;o<r.length;o++){var s=r[o];t.uvs[i.uv+o]=s}i.uv+=r.length;for(var a=0;a<n.length;a++){var l=n[a];t.uv2s[i.uv2+a]=l}i.uv2+=n.length}},{key:"_combineExtraData",value:function(e,t,i){var r=e.extraData;for(var n in r)if("groups"!==n){for(var o=r[n],s=0;s<o.length;s++){var a=o[s];t.extraData[n][i[n]+s]=a}i[n]+=o.length}}}]),t}(Gi),er=function(e){function t(e){Ri(this,t);var i=Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.mesh=new Wi,i.sideVerticesCount=12,i.sideTrianglesCount=6,i.sideUvsCount=8,i.edgeVerticesCount=30,i.edgeUVsCount=20,i.resourceEachSideMeshMap=new Map,i.upDirection=new Li(0,1,0),i.downDirection=new Li(0,-1,0),i.vectorUp=new Li(0,1,0),i}return ki(t,e),Di(t,[{key:"_initParams",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.mesh=new Wi,this.resourceEachSideMeshMap=new Map}},{key:"_calculate",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this);for(var e=0;e<this.object.corners.length;e++)this.object.corners[e].calculate();for(var i=0;i<this.object.walls.length;i++){var r=this.object.walls[i];if(r.calculater)if(r.calculater.setObject(r),r.doorOrWindows.length>0){r.calculater.baseBuild(),r.calculater.calPosInfo(),r.calculater.calEachSideLen(),r.calculater.calRepeatUV(),r.calculater.initSimpleCornersAndWalls();for(var n=0;n<r.calculater.subCorners.length;n++)r.calculater.subCorners[n].calculate();for(var o=0;o<r.calculater.subWalls.length;o++){var s=r.calculater.subWalls[o];s.calculater.setObject(s),s.calculater.baseBuild(),s.calculater.calPosInfo(),s.calculater.calBasePoints(),s.calculater.calUV()}}else r.calculater.baseBuild(),r.calculater.calPosInfo(),r.calculater.calEachSideLen(),r.calculater.calRepeatUV(),r.calculater.calBasePoints()}this._initMesh();for(var a=0;a<this.object.walls.length;a++){var l=this.object.walls[a];if(l.doorOrWindows.length>0)for(var u=0;u<l.calculaterData.subWalls.length;u++){var c=l.calculaterData.subWalls[u];this._addToCombineMesh(c)}else this._addToCombineMesh(l)}}},{key:"_addToCombineMesh",value:function(e){var t=this.resourceEachSideMeshMap.get(e.rightResource).right.mesh,i=this.resourceEachSideMeshMap.get(e.rightResource).right.cursor,r=this.resourceEachSideMeshMap.get(e.leftResource).left.mesh,n=this.resourceEachSideMeshMap.get(e.leftResource).left.cursor,o=this.resourceEachSideMeshMap.get(e.edgeResource).edge.mesh,s=this.resourceEachSideMeshMap.get(e.edgeResource).edge.cursor;this.fillRightMeshInfo(t,i,e),this.fillLeftMeshInfo(r,n,e),this.fillEdgeSideMeshInfo(o,s,e)}},{key:"_initMesh",value:function(){this._initLeftMeshes(),this._initRightMeshes(),this._initEdgeMeshes()}},{key:"_initLeftMeshes",value:function(){var e=!0,t=!1,i=void 0;try{for(var r,n=this.object.leftWallResourceMap.keys()[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){for(var o=r.value,s=this.object.leftWallResourceMap.get(o),a=0,l=0,u=0,c=0;c<s.length;c++){var h=s[c],p=1;if(h.doorOrWindows.length>0){for(var d=0;d<h.doorOrWindows.length;d++){var f=h.doorOrWindows[d];p=1,f.suspendPercent>0&&(p=2),a+=this.sideVerticesCount*p,l+=this.sideTrianglesCount*p,u+=this.sideUvsCount*p}p=h.doorOrWindows.length+1,a+=this.sideVerticesCount*p,l+=this.sideTrianglesCount*p,u+=this.sideUvsCount*p}else a+=this.sideVerticesCount,l+=this.sideTrianglesCount,u+=this.sideUvsCount}var m=new Wi;m.resource=o,this.mesh.subMeshes.push(m),m.vertices=new Float32Array(a),m.normals=new Float32Array(a),m.triangles=new Uint16Array(l),m.uvs=new Float32Array(u),o.isDefault&&(m.uv2s=new Float32Array(u)),this.resourceEachSideMeshMap.has(o)||this.resourceEachSideMeshMap.set(o,{});var g=this.resourceEachSideMeshMap.get(o);g.left||(g.left={mesh:m,cursor:{index:0,vertex:0,uv:0,uv2:0}})}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}}},{key:"_initRightMeshes",value:function(){var e=!0,t=!1,i=void 0;try{for(var r,n=this.object.rightWallResourceMap.keys()[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){for(var o=r.value,s=this.object.rightWallResourceMap.get(o),a=0,l=0,u=0,c=0;c<s.length;c++){var h=s[c],p=1;if(h.doorOrWindows.length>0){for(var d=0;d<h.doorOrWindows.length;d++){var f=h.doorOrWindows[d];p=1,f.suspendPercent>0&&(p=2),a+=this.sideVerticesCount*p,l+=this.sideTrianglesCount*p,u+=this.sideUvsCount*p}p=h.doorOrWindows.length+1,a+=this.sideVerticesCount*p,l+=this.sideTrianglesCount*p,u+=this.sideUvsCount*p}else a+=this.sideVerticesCount,l+=this.sideTrianglesCount,u+=this.sideUvsCount}var m=new Wi;m.resource=o,this.mesh.subMeshes.push(m),m.vertices=new Float32Array(a),m.normals=new Float32Array(a),m.triangles=new Uint16Array(l),m.uvs=new Float32Array(u),o.isDefault&&(m.uv2s=new Float32Array(u)),this.resourceEachSideMeshMap.has(o)||this.resourceEachSideMeshMap.set(o,{});var g=this.resourceEachSideMeshMap.get(o);g.right||(g.right={mesh:m,cursor:{index:0,vertex:0,uv:0,uv2:0}})}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}}},{key:"_initEdgeMeshes",value:function(){for(var e=0,t=0,i=0,r=(Ni.wallTopFaceIndexes.length,0);r<this.object.walls.length;r++){var n=this.object.walls[r];if(n.doorOrWindows.length>0)for(var o=0;o<n.calculaterData.subWalls.length;o++){var s=n.calculaterData.subWalls[o];t+=s.calculater.getEdgeTrianglesCount(s),e+=this.edgeVerticesCount,i+=this.edgeUVsCount}else t+=n.calculater.getEdgeTrianglesCount(n),e+=this.edgeVerticesCount,i+=this.edgeUVsCount}var a=new Wi,l=this.object.walls[0].edgeResource;a.resource=l,this.mesh.subMeshes.push(a),a.vertices=new Float32Array(e),a.normals=new Float32Array(e),a.triangles=new Uint16Array(t),a.uvs=new Uint16Array(i),this.resourceEachSideMeshMap.has(l)||this.resourceEachSideMeshMap.set(l,{});var u=this.resourceEachSideMeshMap.get(l);u.edge||(u.edge={mesh:a,cursor:{index:0,vertex:0,uv:0,uv2:0}})}},{key:"changeToParentCoordinate",value:function(){for(var e=0;e<this.object.walls.length;e++){var t=this.object.walls[e],i="StraightManualWall"===t.type?t.position:t.position.toArray();this.changeMeshCoordinate(t.calculater.mesh,i)}}},{key:"changeMeshCoordinate",value:function(e,t){var i="StraightManualWall"===t.type?t.position:t.position.toArray();if(e.vertices)for(var r=0;r<e.vertices.length;){var n=e.vertices;n[r]+=i[0],n[r+1]+=i[1],n[r+2]+=i[2],r+=3}for(var o=0;o<e.subMeshes.length;o++){var s=e.subMeshes[o];this.changeMeshCoordinate(s,t)}}},{key:"fillRightMeshInfo",value:function(e,t,i){var r=t.index,n=t.uv,o=t.uv2,s=t.vertex,a=s/3,l=i.calculaterData,u=Array.isArray(i.position)?i.position:i.position.toArray();e.triangles[r+0]=0+a,e.triangles[r+1]=2+a,e.triangles[r+2]=3+a,e.triangles[r+3]=0+a,e.triangles[r+4]=1+a,e.triangles[r+5]=2+a;var c,h,p,d,f=l.basePoints,m=[f[0],f[4],f[7],f[3]],g=new Li,v=Ni.convertToVector3(i.direction);g.crossVectors(this.downDirection,v),g.normalize(),i.rightResource.isDefault?(c=l.startUVPercent[0],h=l.startUVPercent[1],p=l.endUVPercent[0],d=l.endUVPercent[1]):(c=l.startUVPercent[0]*l.repeatUV[0],h=l.startUVPercent[1]*l.repeatUV[1],p=l.endUVPercent[0]*l.repeatUV[0],d=l.endUVPercent[1]*l.repeatUV[1]),e.uvs[n+0]=c,e.uvs[n+1]=d,e.uvs[n+2]=c,e.uvs[n+3]=h,e.uvs[n+4]=p,e.uvs[n+5]=h,e.uvs[n+6]=p,e.uvs[n+7]=d,i.rightResource.isDefault&&(c=l.startUVPercent[0],h=l.startUVPercent[1],p=l.endUVPercent[0],d=l.endUVPercent[1],e.uv2s[o+0]=c,e.uv2s[o+1]=d,e.uv2s[o+2]=c,e.uv2s[o+3]=h,e.uv2s[o+4]=p,e.uv2s[o+5]=h,e.uv2s[o+6]=p,e.uv2s[o+7]=d);for(var y=0;y<m.length;y++){var b=m[y],_=3*y;e.vertices[s+_]=b.x+u[0],e.vertices[s+_+1]=b.y+i.suspend+u[1],e.vertices[s+_+2]=b.z+u[2],b=g,e.normals[s+_]=b.x,e.normals[s+_+1]=b.y,e.normals[s+_+2]=b.z}t.vertex+=this.sideVerticesCount,t.index+=this.sideTrianglesCount,t.uv+=this.sideUvsCount,i.rightResource.isDefault&&(t.uv2+=this.sideUvsCount)}},{key:"fillLeftMeshInfo",value:function(e,t,i){var r=t.index,n=t.uv,o=t.uv2,s=t.vertex,a=s/3,l=Array.isArray(i.position)?i.position:i.position.toArray();e.triangles[r+0]=3+a,e.triangles[r+1]=1+a,e.triangles[r+2]=0+a,e.triangles[r+3]=3+a,e.triangles[r+4]=2+a,e.triangles[r+5]=1+a;var u,c,h,p,d=i.calculaterData,f=d.basePoints,m=[f[1],f[5],f[6],f[2]],g=new Li,v=Ni.convertToVector3(i.direction);g.crossVectors(v,this.downDirection),g.normalize(),i.leftResource.isDefault?(u=d.startUVPercent[2],c=d.startUVPercent[3],h=d.endUVPercent[2],p=d.endUVPercent[3]):(u=d.startUVPercent[2]*d.repeatUV[2],c=d.startUVPercent[3]*d.repeatUV[3],h=d.endUVPercent[2]*d.repeatUV[2],p=d.endUVPercent[3]*d.repeatUV[3]),e.uvs[n+0]=h,e.uvs[n+1]=p,e.uvs[n+2]=h,e.uvs[n+3]=c,e.uvs[n+4]=u,e.uvs[n+5]=c,e.uvs[n+6]=u,e.uvs[n+7]=p,i.leftResource.isDefault&&(u=d.startUVPercent[0],c=d.startUVPercent[1],h=d.endUVPercent[0],p=d.endUVPercent[1],e.uv2s[o+0]=u,e.uv2s[o+1]=p,e.uv2s[o+2]=u,e.uv2s[o+3]=c,e.uv2s[o+4]=h,e.uv2s[o+5]=c,e.uv2s[o+6]=h,e.uv2s[o+7]=p);for(var y=0;y<m.length;y++){var b=m[y],_=3*y;e.vertices[s+_]=b.x+l[0],e.vertices[s+_+1]=b.y+i.suspend+l[1],e.vertices[s+_+2]=b.z+l[2],b=g,e.normals[s+_]=b.x,e.normals[s+_+1]=b.y,e.normals[s+_+2]=b.z}t.vertex+=this.sideVerticesCount,t.index+=this.sideTrianglesCount,t.uv+=this.sideUvsCount,i.leftResource.isDefault&&(t.uv2+=this.sideUvsCount)}},{key:"fillEdgeSideMeshInfo",value:function(e,t,i){for(var r=t.index,n=(t.uv,t.uv2,t.vertex),o=n/3,s=Array.isArray(i.position)?i.position:i.position.toArray(),a=Ni.wallTopFaceIndexes,l=Ni.wallStartFaceIndexes,u=Ni.wallEndFaceIndexes,c=Ni.wallStartCornerFaceIndexes,h=Ni.wallEndCornerFaceIndexes,p=Ni.wallBottomFaceIndexes,d=i.calculaterData,f=a.length,m=0;m<a.length;m++)e.triangles[r+m]=a[m]+o;if(i.calculater.shouldAddSideIndexes(i.startCorner)){for(var g=0;g<l.length;g++)e.triangles[r+f+g]=l[g]+o;f+=l.length}if(i.calculater.shouldAddSideIndexes(i.endCorner)){for(var v=0;v<u.length;v++)e.triangles[r+f+v]=u[v]+o;f+=u.length}if(i.startCorner.walls.length>2){for(var y=0;y<c.length;y++)e.triangles[r+f+y]=c[y]+o;f+=c.length}if(i.endCorner.walls.length>2){for(var b=0;b<h.length;b++)e.triangles[r+f+b]=h[b]+o;f+=h.length}if(0!==i.suspend)for(var _=0;_<p.length;_++)e.triangles[r+f+_]=p[_]+o;for(var x=d.basePoints,E=[x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9]],w=0;w<E.length;w++){var T=E[w],M=3*w;e.vertices[n+M]=T.x+s[0],e.vertices[n+M+1]=T.y+i.suspend+s[1],e.vertices[n+M+2]=T.z+s[2]}for(var C=0;C<E.length;C++){var S=this.upDirection,j=3*C;e.normals[n+j]=S.x,e.normals[n+j+1]=S.y,e.normals[n+j+2]=S.z}t.vertex+=this.edgeVerticesCount,t.index+=f,t.uv+=this.edgeUVsCount}}]),t}($i),tr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),Di(t,[{key:"build",value:function(e){}}]),t}(Gi),ir=function(e){function t(e){Ri(this,t);var i=Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.upVector3=new Li(0,1,0),i.downVector3=new Li(0,-1,0),i.backwardVector3=new Li(0,0,-1),i}return ki(t,e),Di(t,[{key:"_calculate",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this);var e=this.object.attachWall,i=new Fi;if(e){var r=Ni.convertToVector3(e.direction),n=new Li;this.isSingleOpen()||this.hasAnimation||this.hasController?n.crossVectors(this.upVector3,r):n.crossVectors(this.downVector3,r),i.setFromUnitVectors(this.backwardVector3,n),this.object.rotation=[i.x,i.y,i.z,i.w],this.object.position[1]=e.height*this.object.suspendPercent}}},{key:"isSingleOpen",value:function(){var e=this.object.resource.model.getObjectByName("Controller");return!!e&&1===e.children.length}},{key:"hasAnimation",get:function(){return!!(this.object.resource&&this.object.resource.animations&&this.object.resource.animations.length>0)}},{key:"hasController",get:function(){return!!this.object.resource&&!!this.object.resource.model.getObjectByName("Controller")}}]),t}(Gi),rr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),Di(t,[{key:"setObject",value:function(e){this.object=e,this.startCorner=this.object.startCorner,this.endCorner=this.object.endCorner,this.startCornerPosition=Ni.convertToVector3(this.startCorner.position),this.endCornerPosition=Ni.convertToVector3(this.endCorner.position),this.position=Ni.convertToVector3(this.object.position),this.direction=Ni.convertToVector3(this.object.direction),this.suspend=this.object.suspend,this.doorOrWindows=this.object.doorOrWindows,this.object.calculaterData.subWalls=[],this.object.calculaterData.subCorners=[],this.subWalls=this.object.calculaterData.subWalls,this.subCorners=this.object.calculaterData.subCorners;var t=e.calculaterData;t.pathPoints=[],t.selfPathPoints=[],t.startUVPercent=[0,0,0,0],t.endUVPercent=[1,1,1,1],t.basePoints=[],this.pathPoints=t.pathPoints,this.selfPathPoints=t.selfPathPoints,this.cornersVertices=[this.object.startCorner.calculaterData[this.object.id][0],this.object.startCorner.calculaterData[this.object.id][1],this.object.endCorner.calculaterData[this.object.id][0],this.object.endCorner.calculaterData[this.object.id][1]],t.cornersVertices=this.cornersVertices,this.basePoints=t.basePoints;for(var i=0;i<12;i++)this.basePoints.push(new Li);this.repeatUV=t.repeatUV,this.startUVPercent=t.startUVPercent,this.endUVPercent=t.endUVPercent}},{key:"build",value:function(e){this.setObject(e),this._calculate(),this.object.calculaterMesh=this.mesh}},{key:"_calculate",value:function(){this.leftMesh=new Wi,this.rightMesh=new Wi,this.edgeMesh=new Wi,this.mesh=new Wi,this.suspend=this.object.suspend,this.initMeshInfo()}},{key:"initMeshInfo",value:function(){this.baseBuild(),this.calPosInfo(),this.calBasePoints(),this.calUV(),this.fillMesh(),this.changeToParentWallLocal(this.mesh)}},{key:"calUV",value:function(){this.calPosInfo(),this.calEachSideLen();var e=this.object.parentWall.calculaterData,t=this.object.calculaterData.buildType,i=this.object.calculaterData.doorOrWindows,r=this.object.calculaterData.index,n=this.object.length,o=Ni.convertToVector3(this.object.parentWall.position);if("start"===t)this.object.calculaterData.endUVPercent[0]=this.rightSideLength/e.rightSideLength,this.object.calculaterData.startUVPercent[2]=(e.leftSideLength-this.leftSideLength)/e.leftSideLength;else if("end"===t){var s=this.getDoorOrWinRectPoints(i[r])[3].distanceTo(o.clone().addVectors(e.cornersVertices[0],o));this.object.calculaterData.startUVPercent[0]=s/e.rightSideLength,this.object.calculaterData.endUVPercent[2]=this.object.calculaterData.leftSideLength/e.leftSideLength,this.object.calculaterData.repeatUV=this.repeatUV}else{var a=i[r-1],l=this.getDoorOrWinRectPoints(a),u=(s=l[3].distanceTo(o.clone().addVectors(e.cornersVertices[0],o)),l[2].distanceTo(o.clone().addVectors(e.cornersVertices[2],o)));this.startUVPercent[0]=s/e.rightSideLength,this.startUVPercent[2]=(u-n)/e.leftSideLength,this.endUVPercent[0]=(s+n)/e.rightSideLength,this.endUVPercent[2]=u/e.leftSideLength}}},{key:"changeToParentWallLocal",value:function(e){for(var t=this.object.parentWall.position,i=0;i<e.vertices.length;)e.vertices[i]+=this.object.position.x-t[0],e.vertices[i+1]+=this.object.position.y-t[1],e.vertices[i+2]+=this.object.position.z-t[2],i+=3;for(var r=0;r<e.subMeshes.length;r++){var n=e.subMeshes[r];this.changeToParentWallLocal(n)}}},{key:"shouldAddSideIndexes",value:function(e){return"WallCorner"!==e.type||Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"shouldAddSideIndexes",this).call(this,e)}}]),t}(Ki),nr=function(){function e(t,i){Ri(this,e),this._initParams(),this.resource=t,this.modelMesh=i,this.maxCount=65534}return Di(e,[{key:"_initParams",value:function(){this.vertexCount=0,this.indexCount=0,this.resource=null,this.modelMesh=null,this.groups=null,this.transformations=null,this.maxCount=null,this.combineMesh=null}},{key:"isExceed",value:function(e){return this.vertexCount+e>this.maxCount}},{key:"clear",value:function(){this._initParams()}}]),e}(),or=function(e){function t(e,i){Ri(this,t);var r=Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.mesh=new Wi,r.mesh.resource=e,r.modelMeshVerticeLength=r.modelMesh.vertices.length/3,r.combineProgressIndexMap={},r.transformations=[],r._tempPosition=new Float32Array(3),r._tempNormal=new Float32Array(3),r.groupsCountArray=null,r}return ki(t,e),Di(t,[{key:"_initParams",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.mesh=null,this.modelMeshVerticeLength=null,this.combineProgressIndexMap=null,this.transformations=null}},{key:"add",value:function(e){this.vertexCount+=this.modelMeshVerticeLength,this.indexCount+=this.modelMesh.triangles.length,this.transformations.push(e)}},{key:"combine",value:function(){this._initMesh();for(var e=0;e<this.transformations.length;e++){var t=this.transformations[e];this._combineVertices(t),this._combineNormals(t),this._combineUVs(),this._combineTriangles(t),this._combineExtraData(),this.combineProgressIndexMap.vertices+=this.modelMesh.vertices.length,this.combineProgressIndexMap.triangles+=this.modelMesh.triangles.length,this.combineProgressIndexMap.uv+=this.modelMesh.uvs.length}}},{key:"_initMesh",value:function(){this.minusScaleCount=0,this.mesh.vertices=new Float32Array(3*this.vertexCount),this.mesh.normals=new Float32Array(3*this.vertexCount),this.mesh.uvs=new Float32Array(2*this.vertexCount),this.modelMesh.uv2s.length>0&&(this.mesh.uv2s=new Float32Array(2*this.vertexCount)),this.mesh.triangles=new Uint16Array(this.indexCount),this.combineProgressIndexMap={vertices:0,triangles:0,uv:0};var e=this.modelMesh.extraData;for(var t in e)if("groups"===t&&this.modelMesh.extraData[t].length>0){var i=this.cloneGroups(this.modelMesh.extraData[t]);this.combineProgressIndexMap.groups=[];for(var r=0;r<i.length;r++)i[r].count*=this.transformations.length,i.start*=this.transformations.length,this.combineProgressIndexMap.groups.push({currentIndex:i[r].start});this.mesh.extraData[t]=i}else{var n=this.modelMesh.extraData[t].length*this.transformations.length;this.mesh.extraData[t]=new Float32Array(n),this.combineProgressIndexMap[t]=0}}},{key:"_combineVertices",value:function(e){for(var t=this.combineProgressIndexMap.vertices,i=this.modelMesh.vertices,r=e.positions,n=e.scales,o=e.quaternions,s=this._tempPosition,a=0;a<i.length;a+=3){s[0]=i[a],s[1]=i[a+1],s[2]=i[a+2];for(var l=r.length-1;l>-1;l--){var u=r[l],c=n[l],h=o[l];1===c[0]&&1===c[1]&&1===c[2]||(s[0]*=c[0],s[1]*=c[1],s[2]*=c[2]),Ni.applyQuaternionToVector3(h,s),0!==u[0]&&(s[0]+=u[0]),0!==u[1]&&(s[1]+=u[1]),0!==u[2]&&(s[2]+=u[2])}this.mesh.vertices[t]=s[0],this.mesh.vertices[t+1]=s[1],this.mesh.vertices[t+2]=s[2],t+=3}}},{key:"_combineNormals",value:function(e){for(var t=this.combineProgressIndexMap.vertices,i=e.scales,r=this.modelMesh.normals,n=e.quaternions,o=this._tempNormal,s=0;s<r.length;s+=3){o[0]=r[s],o[1]=r[s+1],o[2]=r[s+2];for(var a=n.length-1;a>-1;a--){var l=n[a];this._changeNormalByMinusScale(i[a],o),Ni.applyQuaternionToVector3(l,o)}this.mesh.normals[t]=o[0],this.mesh.normals[t+1]=o[1],this.mesh.normals[t+2]=o[2],t+=3}}},{key:"_changeNormalByMinusScale",value:function(e,t){for(var i=0;i<e.length;i++)e[i]<0&&(t[i]=-t[i])}},{key:"_combineUVs",value:function(){for(var e=this.modelMesh.uvs,t=this.modelMesh.uv2s,i=this.combineProgressIndexMap.uv,r=0;r<e.length;r++){var n=e[r];this.mesh.uvs[i+r]=n}for(var o=0;o<t.length;o++){var s=t[o];this.mesh.uv2s[i+o]=s}}},{key:"_combineTriangles",value:function(e){for(var t=e.scales,i=0,r=0;r<t.length;r++){var n=t[r];0===i&&(i=this._calMinusScaleCount(n))}var o=this.combineProgressIndexMap.vertices/3,s=this.combineProgressIndexMap.triangles,a=this.modelMesh.triangles;if(this.combineProgressIndexMap.groups)for(var l=this.modelMesh.extraData.groups,u=0;u<l.length;u++){var c=l[u],h=c.start,p=c.count,d=this.combineProgressIndexMap.groups[u];if(1===i||3===i)for(var f=0;f<p;)this.mesh.triangles[d.currentIndex+f+2]=o+a[h+f],this.mesh.triangles[d.currentIndex+f+1]=o+a[h+f+1],this.mesh.triangles[d.currentIndex+f]=o+a[h+f+2],f+=3;else for(var m=0;m<p;m++)this.mesh.triangles[d.currentIndex+m]=o+a[h+m];d.currentIndex+=p}else if(1===i||3===i)for(var g=0;g<a.length;)this.mesh.triangles[s+g+2]=o+a[g],this.mesh.triangles[s+g+1]=o+a[g+1],this.mesh.triangles[s+g]=o+a[g+2],g+=3;else for(var v=0;v<a.length;v++){var y=a[v];this.mesh.triangles[s+v]=o+y}}},{key:"_calMinusScaleCount",value:function(e){for(var t=0,i=0;i<e.length;i++)e[i]<0&&t++;return t}},{key:"_combineExtraData",value:function(){var e=this.modelMesh.extraData;for(var t in e)if(!("groups"===t&&e[t].length>0)){for(var i=e[t],r=this.combineProgressIndexMap[t],n=0;n<i.length;n++){var o=i[n];this.mesh.extraData[t][r+n]=o}this.combineProgressIndexMap[t]+=i.length}}},{key:"cloneGroups",value:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];t.push(Ni.cloneJSObject(r))}return t}},{key:"clear",value:function(){this._initParams(),Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(nr),sr=function(){function e(t,i){Ri(this,e),this._initParams(),this.mesh=new Wi,this.resource=t,this.modelMesh=i,this.subMeshProcessors=[],this.modelMeshVerticeLength=this.modelMesh.vertices.length/3,this.currentSubMeshProcessor=this._createSubMeshProcessor()}return Di(e,[{key:"_initParams",value:function(){this.mesh=null,this.resource=null,this.modelMesh=null,this.subMeshProcessors=null,this.modelMeshVerticeLength=null,this.currentSubMeshProcessor=null}},{key:"_createSubMeshProcessor",value:function(){var e=new or(this.resource,this.modelMesh);return this.subMeshProcessors.push(e),e}},{key:"add",value:function(e){this.currentSubMeshProcessor.isExceed(this.modelMeshVerticeLength)&&(this.currentSubMeshProcessor=this._createSubMeshProcessor()),this.currentSubMeshProcessor.add(e)}},{key:"combine",value:function(){for(var e=0;e<this.subMeshProcessors.length;e++){var t=this.subMeshProcessors[e];t.combine(),this.mesh.subMeshes.push(t.mesh)}1===this.subMeshProcessors.length&&(this.mesh=this.mesh.subMeshes[0])}},{key:"clear",value:function(){this._initParams()}}]),e}(),ar=function(e){function t(e){Ri(this,t);var i=Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.isResourceVertexExceed=!1,i}return ki(t,e),Di(t,[{key:"_initParams",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.processorMap=new Map,this.processors=[],this.isResourceVertexExceed=!1}},{key:"_calculate",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this),this._initResources(),this.isResourceVertexExceed||(this._fillProcessors(),this._createMesh())}},{key:"_initResources",value:function(){for(var e=this.object.resources,t=0;t<e.length;t++){var i=e[t];if(this.resourceCombineManager.getCombineMesh(i),i.vertexIsExceed)return void(this.isResourceVertexExceed=!0)}for(var r=0;r<e.length;r++){var n=e[r];this._initProcessors(n)}}},{key:"_initProcessors",value:function(e){var t=this.resourceCombineManager.getCombineMesh(e);this._createProcessorByResourceBuilderMesh(e,t)}},{key:"_createProcessorByResourceBuilderMesh",value:function(e,t){if(this.processorMap[e.id]||(this.processorMap[e.id]=[]),t.resource){var i=new sr(t.resource,t);this.processorMap[e.id].push(i),this.processors.push(i)}for(var r=0;r<t.subMeshes.length;r++){var n=t.subMeshes[r];this._createProcessorByResourceBuilderMesh(e,n)}}},{key:"_fillProcessors",value:function(){}},{key:"_createMesh",value:function(){for(var e=0;e<this.processors.length;e++){var t=this.processors[e];t.combine(),this.mesh.subMeshes.push(t.mesh)}}},{key:"addSingleTransformationToProcessors",value:function(e){for(var t=0;t<this.processors.length;t++)this.processors[t].add(e)}}]),t}($i),lr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),Di(t,[{key:"_fillProcessors",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_fillProcessors",this).call(this),this.addTransformationToProcessor()}},{key:"addTransformationToProcessor",value:function(){for(var e=0;e<this.object.transformations.length;e++){var t=this.object.transformations[e];this.addSingleTransformationToProcessors(t)}}},{key:"clear",value:function(){for(var e=0;e<this.processors.length;e++)this.processors[e].clear();Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(ar),ur=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),t}(Gi),cr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),Di(t,[{key:"_calculate",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this)}}]),t}(Gi),hr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),t}(cr),pr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),t}(cr),dr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),Di(t,[{key:"_calculate",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this)}}]),t}($i),fr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),t}($i),mr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),t}($i),gr=function e(t){Ri(this,e)},vr=function(){function e(t){Ri(this,e),this.combineBundleObjectMaps={},this.CombineBuilderClass=gr}return Di(e,[{key:"getCombineBundleObject",value:function(e){this.combineBundleObjectMaps[e.id]}},{key:"createCombineBuilder",value:function(e){return new this.CombineBuilderClass({resource:e})}},{key:"clear",value:function(){this.combineBundleObjectMaps={},this.CombineBuilderClass=null}}]),e}(),yr=new vr,br=function(){function e(){Ri(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return Di(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),_r=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),Di(t,[{key:"_initParams",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.modelNumber=-1,this.models=[],this.objPositions=[],this.objLocalPositions=[],this.objRotations=[],this.objScales=[],this.transformations=[],this.processorMap=new Map,this.processors=[],this.wallPosition=null}},{key:"registerCombineBuilder",value:function(e){var t=yr.createCombineBuilder(e);e.containBuilder(e.id)||e.registerBuilder(e.id,t)}},{key:"_calculate",value:function(){this.mesh=new Wi;for(var e=this.object.resources,t=0;t<e.length;t++){var i=e[t];this._initProcessors(i)}if(this.object.doorOrWindows.length>0){this.initSimpleCornersAndWalls();for(var r=0;r<this.subWalls.length;r++){var n=this.subWalls[r];n.calculate(),this.mesh.subMeshes.push(n.calculater.mesh)}}else this.calObjInfo();this.addTransformationToProcessor();for(var o=0;o<this.processors.length;o++){var s=this.processors[o];s.combine(),this.mesh.subMeshes.push(s.mesh)}}},{key:"instanceModels",value:function(){if(null!==this.object.model){this.models=[];for(var e=this.modelNumber,t=0;t<e;t++){var i=this.model.clone(),r=this.objPositions[t],n=this.objRotations[t],o=this.objScales[t];i.position.set(r.x,r.y,r.z),i.quaternion.set(n.x,n.y,n.z,n.w),i.scale.set(o.x,o.y,o.z),this.mesh.add(i),this.models.push(i)}}}},{key:"calObjInfo",value:function(){this.objPositions=[],this.objRotations=[],this.objScales=[];var e=Ni.convertToVector3(this.object.startCorner.position),t=(Ni.convertToVector3(this.object.endCorner.position),Ni.convertToVector3(this.object.direction)),i=Ni.convertToVector3(this.object.position);this.wallPosition=i,this.modelSize=this.object.resource.size,-1===this.object.height?this.object.height=this.modelSize[1]:0!==this.modelSize[1]?this.heightRatio=this.object.height/this.modelSize[1]:(console.warn("model size is zero "+this.object.resource.id),this.object.height=3);var r=new Li(0,-1,0),n=this.modelSize[0],o=(this.modelSize[2],this.modelSize[1]),s=this.object.length/n,a=parseInt(s),l=Math.ceil(s);this.modelNumber=l;var u=l*n,c=new Li,h=t.clone();c.addVectors(e,h.multiplyScalar(u));var p=new Li;p.crossVectors(t,r),p.normalize();var d=new Fi;0===p.x&&0===p.y&&0===p.z||d.setFromUnitVectors(new Li(0,0,-1),p);var f=.5*n,m=new Li(f,this.object.suspend,0);m.applyQuaternion(d),d.multiply(new Fi(0,1,0,0));for(var g=0;g<l;g++){var v=g/l,y=new Li;y.lerpVectors(e,c,v);var b=new Li;b.addVectors(m,y);var _=new Li(1,this.object.height/o,1);this.objPositions.push(b),this.objRotations.push(d),this.objScales.push(_)}var x=(s-a)*n,E=x/n;if(l>0&&x>0){this.objScales[l-1]=new Li(E,this.object.height/o,1);var w=new Li(f*(1-E),0,0);w.applyQuaternion(d),this.objPositions[l-1].add(w)}for(var T=0;T<this.objPositions.length;T++){var M=this.objPositions[T],C=this.objScales[T],S=this.objRotations[T],j=new br;new Li,j.positions.push(M.toArray()),j.quaternions.push(S.toArray()),j.scales.push(C.toArray()),this.transformations.push(j)}}},{key:"initSimpleCornersAndWalls",value:function(){for(var e=this.sortDoorOrWins(),t=0;t<e.length;t++){var i=e[t],r=this.getDoorOrWinStartAndEndPos(i),n=Yi.createSubWallCorner(this.id+"_"+t+"_1",r[0],this),o=Yi.createSubWallCorner(this.id+"_"+t+"_2",r[1],this);if(this.addSubWallCorner(n),this.addSubWallCorner(o),0===t){var s=this.objectManager.create({type:Zi.SubModelWall});s.resource=this.object.resource,this.subWalls.push(s),s.startCorner=this.object.startCorner,s.endCorner=n,s.startCorner.calculate(),s.endCorner.calculate(),s.parentWall=this.object,s.height=this.object.height}else{var a=e[t-1],l=this.getDoorOrWinStartAndEndPos(a),u=this.getWallCornerByPos(l[1]),c=this.objectManager.create({type:Zi.SubModelWall});c.resource=this.object.resource,this.subWalls.push(c),c.startCorner=u,c.endCorner=n,c.startCorner.calculate(),c.endCorner.calculate(),c.parentWall=this.object,c.height=this.object.height}if(t===e.length-1){var h=this.objectManager.create({type:Zi.SubModelWall});h.resource=this.object.resource,this.subWalls.push(h),h.startCorner=o,h.endCorner=this.object.endCorner,h.startCorner.calculate(),h.parentWall=this.object,h.height=this.object.height}this.buildHeadAndFootWall(i,n,o)}}},{key:"buildSimpleCornersAndWalls",value:function(){this.wallGroup=new THREE.Object3D;for(var e=0;e<this.subCorners.length;e++)this.subCorners[e].build();for(e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.wallGroup.add(t.wallGroup)}}},{key:"buildHeadAndFootWall",value:function(e,t,i){if(!this.object.resource.isSupportHeadAndFootModelWall)return!1;var r=e.suspendPercent;if(0!==r){var n=this.objectManager.create({type:Zi.SubModelWall});this.subWalls.push(n),n.resource=this.object.resource,n.parentWall=this.object,n.startCorner=t,n.endCorner=i,n.height=this.object.height*r}e.size;var o=e.size[1]+this.object.height*r;if(o<this.object.height){var s=this.objectManager.create({type:Zi.SubModelWall});this.subWalls.push(s),s.resource=this.object.resource,s.parentWall=this.object,s.startCorner=t,s.endCorner=i,s.suspend=o,s.height=this.object.height-o}}},{key:"_initProcessors",value:function(e){e.buildRegisterBuilder();var t=e.getBuilder(e.id).mesh;this._createProcessorByResourceBuilderMesh(t)}},{key:"_createProcessorByResourceBuilderMesh",value:function(e){if(e.resource&&!this.processorMap.has(e.resource)){var t=new sr(e.resource,e);this.processorMap.set(e.resource,t),this.processors.push(t)}for(var i=0;i<e.subMeshes.length;i++){var r=e.subMeshes[i];this._createProcessorByResourceBuilderMesh(r)}}},{key:"addTransformationToProcessor",value:function(){for(var e=0;e<this.transformations.length;e++)for(var t=this.transformations[e],i=0;i<this.processors.length;i++)this.processors[i].add(t)}}]),t}(Qi),xr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),t}(_r),Er=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),Di(t,[{key:"_fillProcessors",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_fillProcessors",this).call(this);for(var e=0;e<this.object.walls.length;e++){var i=this.object.walls[e];if(i.calculater)if(i.calculater.setObject(i),i.doorOrWindows.length>0){i.calculater.initSimpleCornersAndWalls();for(var r=0;r<i.calculater.subWalls.length;r++){var n=i.calculater.subWalls[r];n.calculater.setObject(n),n.calculater.calObjInfo(),this.addTransformationToProcessor(n.calculater.transformations)}}else i.calculater.calObjInfo(),this.addTransformationToProcessor(i.calculater.transformations);else console.log("wall not have calculater")}}},{key:"changeToParentCoordinate",value:function(){for(var e=0;e<this.object.walls.length;e++){var t=this.object.walls[e];this.changeMeshCoordinate(t.calculater.mesh,t.position)}}},{key:"changeMeshCoordinate",value:function(e,t){for(var i=0;i<e.vertices.length;){var r=e.vertices;r[i]+=t[0],r[i+1]+=t[1],r[i+2]+=t[2],i+=3}for(var n=0;n<e.subMeshes.length;n++){var o=e.subMeshes[n];this.changeMeshCoordinate(o,t)}}},{key:"addTransformationToProcessor",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];this.addSingleTransformationToProcessors(i)}}}]),t}(ar),wr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),t}(Gi),Tr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),Di(t,[{key:"_initParams",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.transformationMap={}}},{key:"_fillProcessors",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_fillProcessors",this).call(this),this._initTransformationMap(),this.addTransformationToProcessor()}},{key:"_initTransformationMap",value:function(){for(var e=this.object.objects,t=0;t<e.length;t++){var i=e[t];this._calSingleObjectTransformation(i)}}},{key:"_calSingleObjectTransformation",value:function(e,t){if(t||(t=new br),t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),"PlacementGroup"!==e.type&&0===e.children.length)this.transformationMap[e.resource.id]||(this.transformationMap[e.resource.id]=[]),this.transformationMap[e.resource.id].push(t);else for(var i=0;i<e.children.length;i++){var r=e.children[i];this._calSingleObjectTransformation(r,t.clone())}}},{key:"addTransformationToProcessor",value:function(){for(var e in this.transformationMap)for(var t=this.transformationMap[e],i=this.processorMap[e],r=0;r<t.length;r++)for(var n=t[r],o=0;o<i.length;o++)i[o].add(n)}},{key:"clear",value:function(){for(var e=0;e<this.processors.length;e++)this.processors[e].clear();Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(ar),Mr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),t}(tr),Cr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),t}(tr),Sr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),t}(tr),jr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),t}(lr),Pr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),Di(t,[{key:"_fillProcessors",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_fillProcessors",this).call(this);for(var e=0;e<this.object.objects.length;e++)this.object.objects[e].calculate();this.addTransformationToProcessor()}},{key:"_classifyChangeDirectionOrOpenObject",value:function(){for(var e=[],t=[],i=0;i<this.object.objects.length;i++){var r=this.object.objects[i];r.isOpen||0!==r.openDirIndex?e.push(r):t.push(r)}this.object.objects=t,this.object.notCombineObjects=e}},{key:"addTransformationToProcessor",value:function(){for(var e=0;e<this.object.objects.length;e++){var t=this.object.objects[e],i=new br;i.positions.push(t.position),i.scales.push(t.scale),i.quaternions.push(t.rotation),this.addSingleTransformationToProcessors(i)}}},{key:"clear",value:function(){for(var e=0;e<this.processors.length;e++)this.processors[e].clear();Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(ar),Rr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),t}(Gi),Dr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),Di(t,[{key:"calUV",value:function(){this.calPosInfo(),this.calEachSideLen();var e=this.object.parentWall.calculaterData,t=Ni.convertToVector3(this.object.parentWall.position),i=this.object.length,r=this.getDoorOrWinRectPoints(this.object.calculaterData.doorOrWindow),n=r[0].distanceTo(t.clone().addVectors(e.cornersVertices[0],t)),o=r[2].distanceTo(t.clone().addVectors(e.cornersVertices[2],t)),s=this.object.calculaterData;if("down"===s.buildType)s.startUVPercent=[n/e.rightSideLength,0,o/e.leftSideLength,0],s.endUVPercent[0]=(n+i)/e.rightSideLength,s.endUVPercent[1]=this.object.height/this.object.parentWall.height,s.endUVPercent[2]=(o+i)/e.leftSideLength,s.endUVPercent[3]=this.object.height/this.object.parentWall.height,this.startUVPercent=s.startUVPercent,this.endUVPercent=s.endUVPercent;else if("up"===s.buildType){var a=this.object.calculaterData.doorOrWindow.suspendPercent,l=Ni.convertToVector3(this.object.calculaterData.doorOrWindow.size).y+this.object.parentWall.height*a;s.startUVPercent=[n/e.rightSideLength,l/this.object.parentWall.height,o/e.leftSideLength,l/this.object.parentWall.height],s.endUVPercent[0]=(n+i)/e.rightSideLength,s.endUVPercent[2]=(o+i)/e.leftSideLength,this.startUVPercent=s.startUVPercent,this.endUVPercent=s.endUVPercent}}},{key:"shouldAddSideIndexes",value:function(e){return!1}}]),t}(rr),Ar={SubWallCorner:Ji,SubStraightManualWall:rr,SubDoorOrWindowStraightManualWall:Dr,DoorOrWindow:ir,Placement:tr,StraightManualWall:Ki,WallCorner:Xi,CombineStraightManualWall:er,CombinePlacement:lr,Room:ur,Floor:cr,Ceiling:hr,Roof:pr,CombineFloor:dr,CombineCeiling:fr,CombineRoof:mr,CombineModelWall:Er,ModelWall:_r,SubModelWall:xr,PlacementGroup:wr,CombinePlacementGroup:Tr,FacadeGroup:Mr,Facade:Cr,PlacementGround:wr,PlacementWall:Sr,CombinePlacementWall:jr,CombineDoorOrWindow:Pr,FloorPlan:Rr,Outdoors:Rr},kr=function(e){function t(){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return ki(t,e),Di(t,[{key:"_initParams",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._startCorner=null,this._endCorner=null,this.thick=-1,this.height=-1,this._length=null,this.pathPoints=[],this._direction=null,this.doorOrWindows=[],this.subWalls=[],this.subCorners=[],this.suspend=0,this.mesh=null,this.isShow=!0,this.isContainer=!1,this._position=null}},{key:"getWallOtherCorner",value:function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null}},{key:"sortDoorOrWins",value:function(){var e=this.startCorner.position,t=this.endCorner.position,i=t.x-e.x>0?1:-1,r=t.z-e.z>0?1:-1,n=!0;Math.abs(t.x-e.x)<.001&&(n=!1);for(var o=[],s=0;s<this.doorOrWindows.length;s++){for(var a=this.doorOrWindows[s],l=0;l<o.length;l++){var u=o[l];if((n?(u.position.x-a.position.x)*i:(u.position.z-a.position.z)*r)>=0){o.splice(l,0,a);break}if(l==o.length-1){o.push(a);break}}0===o.length&&o.push(a)}return o}},{key:"getWallCornerByPos",value:function(e){for(var t=null,i=-1,r=this.subCorners,n=0;n<r.length;n++){var o=e.distanceTo(r[n].position);o<.01&&(null===t?(t=r[n],i=o):o<i&&(i=o,t=r[n]))}return t}},{key:"getDoorOrWinStartAndEndPos",value:function(e){var t=e.size,i=this.direction,r=e.position.clone();r.y=0;var n=r.clone(),o=r.clone(),s=t.x/2;return n.subVectors(n,i.clone().multiplyScalar(s)),o.addVectors(o,i.clone().multiplyScalar(s)),[n,o]}},{key:"addSubWallCorner",value:function(e){for(var t=0;t<this.subCorners.length;t++)if(this.subCorners[t]===e)return;this.subCorners.push(e)}},{key:"addToParentCollector",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.walls.push(this)}},{key:"clear",value:function(){for(var e=0;e<this.subWalls.length;e++)this.subWalls[e].clear();for(var i=0;i<this.subCorners.length;i++)this.subCorners[i].clear();Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"startCorner",get:function(){return this._startCorner},set:function(e){this._startCorner=e,this._startCorner&&this._startCorner.addWall(this)}},{key:"endCorner",get:function(){return this._endCorner},set:function(e){this._endCorner=e,this._endCorner&&this._endCorner.addWall(this)}},{key:"length",get:function(){if(null===this._length){var e=new Li;e.subVectors(Ni.convertToVector3(this.endCorner.position),Ni.convertToVector3(this.startCorner.position)),this._length=e.length()}return this._length}},{key:"direction",get:function(){return null===this._direction&&(this._direction=new Li,this._direction.subVectors(Ni.convertToVector3(this.endCorner.position),Ni.convertToVector3(this.startCorner.position)),this._direction.normalize()),this._direction}},{key:"size",get:function(){if(null===this._size){var e=new Li,t=this.startCorner.position,i=this.endCorner.position;e.x=Math.abs(t.x-i.x),e.z=Math.abs(t.z-i.z),e.y=this.height,0===e.x&&(e.x=this.thick),0===e.z&&(e.z=this.thick),this._size=e}return this._size}},{key:"position",get:function(){return this._position||(this.startCorner.position,this.endCorner.position,this._position=new Li,this._position.subVectors(Ni.convertToVector3(this.endCorner.position),Ni.convertToVector3(this.startCorner.position)),this._position=this._position.divideScalar(2)),this._position},set:function(e){this._position=e}}]),t}(Hi),Or=function(e){function t(){Ri(this,t);var e=Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="SubStraightManualWall",e}return ki(t,e),Di(t,[{key:"_initParams",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.parentWall=null}},{key:"build",value:function(){this.calculate()}},{key:"parent",get:function(){return this.parentWall.parent}},{key:"position",get:function(){var e=Ni.convertToVector3(this.startCorner.position),t=Ni.convertToVector3(this.endCorner.position),i=new Li;return i.addVectors(e,t),i.divideScalar(2),i},set:function(e){}}]),t}(kr),Br=function(e){function t(){Ri(this,t);var e=Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.objPositions=[],e.objLocalPositions=[],e.objRotations=[],e.objScales=[],e.heightRatio=1,e.modelNumber=-1,e.type="SubModelWall",e}return ki(t,e),Di(t,[{key:"_initParams",value:function(){Ai(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.resource=null,this.objPositions=null,this.objLocalPositions=null,this.objRotations=null,this.objScales=null,this.heightRatio=null,this.modelNumber=null}},{key:"build",value:function(){this.calculate()}}]),t}(kr),Fr=function(e){function t(){Ri(this,t);var e=Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="SubDoorOrWindowStraightManualWall",e}return ki(t,e),t}(Or),Lr={SubStraightManualWall:Or,SubModelWall:Br,SubDoorOrWindowStraightManualWall:Fr,SubWallCorner:Ji},Ir=function(){function e(){Ri(this,e),this.objects=[],this.calculaterManager=null,this.meshBuilderManager=null,this.ClassName=Zi}return Di(e,[{key:"create",value:function(e){var t=e.type,i=(e.parent,new(0,Lr[t]));return this.calculaterManager&&(i.calculater=this.calculaterManager.create({type:t,object:i})),i}}]),e}(),Nr=function(e){function t(e){return Ri(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ki(t,e),t}(Gi),Ur="function"==typeof Symbol&&"symbol"===Pi(Symbol.iterator)?function(e){return void 0===e?"undefined":Pi(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":Pi(e)},zr=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Hr=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Vr=function(){function e(t){zr(this,e),this._init()}return Hr(e,[{key:"_init",value:function(){this.vertices=[],this.normals=[],this.uvs=[],this.uv2s=[],this.resource=null,this.triangles=[],this.subMeshes=[],this.extraData={}}},{key:"clone",value:function(){var t=new e;for(var i in t.vertices=this.vertices.slice(),t.normals=this.normals.slice(),t.uvs=this.uvs.slice(),t.uv2s=this.uv2s.slice(),t.resource=this.resource,t.triangles=this.triangles.slice(),this.extraData)t.extraData[i]=this.extraData[i].slice();for(var r=0;r<this.subMeshes.length;r++){var n=this.subMeshes[r].clone();t.subMeshes.push(n)}return t}},{key:"clear",value:function(){for(var e=0;e<this.subMeshes.length;e++)this.subMeshes[e].clear();this._init()}}]),e}(),Wr=function(){function e(){zr(this,e)}return Hr(e,null,[{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Ur(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"applyQuaternionToVector3",value:function(e,t){if(0!==e[0]||0!==e[1]||0!==e[2]||1!==e[3]){var i=t[0],r=t[1],n=t[2],o=e[0],s=e[1],a=e[2],l=e[3],u=l*i+s*n-a*r,c=l*r+a*i-o*n,h=l*n+o*r-s*i,p=-o*i-s*r-a*n;t[0]=u*l+p*-o+c*-a-h*-s,t[1]=c*l+p*-s+h*-o-u*-a,t[2]=h*l+p*-a+u*-s-c*-o}}}]),e}(),Gr=function(){function e(t){zr(this,e),this._initParams(),this.positions=[],this.normals=[],this.uvs=[],this.uv2s=[],this.uv3s=[],this.indexes=[],this.colors=[],this.alphaIndexes=[],this.material=t,this.groupsArray=null,this.meshes=[],this.transformations=[],this.verticesCount=0,this.uvsCount=0,this.indexesCount=0,this.trianglesCount=0,this.colorsCount=0,this.alphaIndexsCount=0,this.uv2sCount=0,this.uv3sCount=0,this.groupsCountArray=null,this.combineCursor={vertex:0,index:0,uv:0,color:0,alphaIndex:0,uv2:0,uv3:0,groups:[]},this.maxCount=196602}return Hr(e,[{key:"_initParams",value:function(){this.positions=[],this.normals=[],this.uvs=[],this.uv2s=[],this.uv3s=[],this.indexes=[],this.colors=[],this.alphaIndexes=[],this.material=null,this.groups=null,this.meshes=[],this.transformations=[],this.verticesCount=0,this.uvsCount=0,this.indexesCount=0,this.trianglesCount=0,this.colorsCount=0,this.alphaIndexsCount=0,this.uv2sCount=0,this.uv3sCount=0,this.combineCursor=null,this.maxCount=null}},{key:"_initGroups",value:function(){var e=[],t=this.meshObj.geometry,i=0;if(t.groups.length>0){var r=this.cloneGroups(t.groups);r.forEach((function(e){e.start+=i})),e=e.concat(r)}}},{key:"cloneGroups",value:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];t.push(Wr.cloneJSObject(r))}return t}},{key:"getCalculaterMesh",value:function(){this._combine();var e=new Vr;return e.resource=this.material,this.positions.length>0&&(e.vertices=this.positions),this.normals.length&&(e.normals=this.normals),this.uvs.length&&(e.uvs=this.uvs),this.uv2s.length&&(e.uv2s=this.uv2s),this.indexes.length>0&&(e.triangles=this.indexes),this.colors.length&&(e.extraData.color=this.colors),this.uv3s.length>0&&(e.extraData.uv3=this.uv3s),this.alphaIndexes.length>0&&(e.extraData.alphaIndex=this.alphaIndexes),this.groups&&(e.extraData.groups=this.groups),e}},{key:"_combine",value:function(){if(this.indexes=new Uint16Array(this.indexesCount),this.positions=new Float32Array(this.verticesCount),this.normals=new Float32Array(this.verticesCount),this.uvs=new Float32Array(this.uvsCount),0!==this.uv2sCount&&(this.uv2s=new Float32Array(this.uv2sCount)),0!==this.uv3sCount&&(this.uv3s=new Float32Array(this.uv3sCount)),0!==this.colorsCount&&(this.colors=new Uint16Array(this.colorsCount)),0!==this.alphaIndexsCount&&(this.alphaIndexes=new Uint16Array(this.alphaIndexsCount)),this.groupsCountArray)for(var e=0;e<this.groupsCountArray.length;e++){var t=this.groupsCountArray[e];this.combineCursor.groups.push({currentIndex:t.start})}for(var i=0;i<this.transformations.length;i++){var r=this.transformations[i];this._applyTransformation(this.meshes[i],r)}this.groups=this.groupsCountArray}},{key:"_applyTransformation",value:function(e,t,i){this._combineIndexes(e,i),this._combinePositionsAndNormals(e,t),this._combineUVs(e),this._combineColors(e),this._combineAlphaIndexes(e)}},{key:"_combineIndexes",value:function(e){var t=e.geometry.index.array,i=e.geometry.groups;if(i.length>0)for(var r=0;r<i.length;r++){for(var n=i[r],o=n.start,s=n.count,a=this.combineCursor.groups[r],l=0;l<s;l++)this.indexes[a.currentIndex+l]=this.combineCursor.vertex/3+t[o+l];this.combineCursor.groups[r].currentIndex+=s}else{for(var u=0;u<t.length;u++)this.indexes[this.combineCursor.index+u]=this.combineCursor.vertex/3+t[u];this.combineCursor.index+=t.length}}},{key:"_combinePositionsAndNormals",value:function(e,t){var i=null,r=null,n=e.geometry.getAttribute("position");i=n?n.array:[];var o=e.geometry.getAttribute("normal");r=o?o.array:[];for(var s=new Float32Array(3),a=new Float32Array(3),l=0;l<i.length;){a[0]=i[l],a[1]=i[l+1],a[2]=i[l+2],s[0]=r[l],s[1]=r[l+1],s[2]=r[l+2];for(var u=t.positions.length-1;u>-1;u--){var c=t.scales[u],h=t.quaternions[u],p=t.positions[u];1!==c.x&&(a[0]*=c.x),1!==c.y&&(a[1]*=c.y),1!==c.z&&(a[2]*=c.z),Wr.applyQuaternionToVector3(h.toArray(),a),0!==p.x&&(a[0]+=p.x),0!==p.y&&(a[1]+=p.y),0!==p.z&&(a[2]+=p.z),r&&Wr.applyQuaternionToVector3(h.toArray(),s)}this.positions[this.combineCursor.vertex+l]=a[0],this.positions[this.combineCursor.vertex+l+1]=a[1],this.positions[this.combineCursor.vertex+l+2]=a[2],this.normals[this.combineCursor.vertex+l]=s[0],this.normals[this.combineCursor.vertex+l+1]=s[1],this.normals[this.combineCursor.vertex+l+2]=s[2],l+=3}this.combineCursor.vertex+=i.length}},{key:"_combineUVs",value:function(e){var t=e.geometry.getAttribute("uv"),i=null;i=t?t.array:[];for(var r=0;r<i.length;r++)this.uvs[this.combineCursor.uv+r]=i[r];this.combineCursor.uv+=i.length;var n=e.geometry.getAttribute("uv2");if(n){for(var o=n.array,s=0;s<o.length;s++)this.uv2s[this.combineCursor.uv2+s]=o[s];this.combineCursor.uv2+=o.length}var a=e.geometry.getAttribute("uv3");if(a){for(var l=a.array,u=0;u<l.length;u++)this.uv3s[this.combineCursor.uv3+u]=l[u];this.combineCursor.uv3+=l.length}}},{key:"_combineColors",value:function(e){var t=e.geometry.getAttribute("color");if(t){for(var i=t.array,r=0;r<i.length;r++)this.colors[this.combineCursor.color+r]=i[r];this.combineCursor.color+=i.length}}},{key:"_combineAlphaIndexes",value:function(e){var t=e.geometry.getAttribute("alphaIndex");if(t){for(var i=t.array,r=0;r<i.length;r++)this.alphaIndexes[this.combineCursor.alphaIndex+r]=i[r];this.combineCursor.alphaIndex+=i.length}}},{key:"add",value:function(e,t,i){if(this.meshes.push(e),this.transformations.push(t),e.geometry.groups)if(this.groupsCountArray)for(var r=e.geometry.groups,n=0;n<r.length;n++){var o=r[n];this.groupsCountArray[n].count+=o.count,n!==r.length-1&&(this.groupsCountArray[n+1].start=this.groupsCountArray[n].start+this.groupsCountArray[n].count)}else this.groupsCountArray=this.cloneGroups(e.geometry.groups);e.geometry.index&&(this.indexesCount+=e.geometry.index.array.length),e.geometry.getAttribute("position")&&(this.verticesCount+=e.geometry.getAttribute("position").array.length),e.geometry.getAttribute("uv")&&(this.uvsCount+=e.geometry.getAttribute("uv").array.length);var s=e.geometry.getAttribute("color");s&&(this.colorsCount+=s.array.length);var a=e.geometry.getAttribute("alphaIndex");a&&(this.alphaIndexsCount+=a.array.length);var l=e.geometry.getAttribute("uv2");l&&(this.uv2sCount+=l.array.length);var u=e.geometry.getAttribute("uv3");u&&(this.uv3sCount+=u.array.length)}},{key:"isExceed",value:function(e){return this.verticesCount+e>this.maxCount}},{key:"clear",value:function(){this._initParams()}}]),e}(),qr=function(){function e(t){zr(this,e),this._initParams(),this.material=t,this.mesh=new Vr,this.combineBundleSubMeshes=[],this.currentCombineBundleSubMesh=this._createCombineBundleSubMesh(),this.vertexCount=0}return Hr(e,[{key:"_initParams",value:function(){this.material=null,this.groups=null,this.mesh=null,this.combineBundleSubMeshes=[],this.currentCombineBundleSubMesh=null,this.vertexCount=0}},{key:"_createCombineBundleSubMesh",value:function(){var e=new Gr(this.material);return this.combineBundleSubMeshes.push(e),e}},{key:"add",value:function(e,t,i){var r=0;e.geometry.getAttribute("position")&&(r=e.geometry.getAttribute("position").array.length),this.currentCombineBundleSubMesh.isExceed(r)&&(this.currentCombineBundleSubMesh=this._createCombineBundleSubMesh()),this.currentCombineBundleSubMesh.add(e,t,i)}},{key:"getCalculaterMesh",value:function(){for(var e=0;e<this.combineBundleSubMeshes.length;e++){var t=this.combineBundleSubMeshes[e];this.mesh.subMeshes.push(t.getCalculaterMesh())}return this.mesh}},{key:"clear",value:function(){for(var e=0;e<this.combineBundleSubMeshes.length;e++)this.combineBundleSubMeshes[e].clear();this._initParams()}}]),e}(),Xr=function(){function e(){zr(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return Hr(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),Jr=function(){function e(t){zr(this,e),this._initParams(),this.bundeObj=t,this.materialMap=new Map}return Hr(e,[{key:"_initParams",value:function(){this.bundeObj=null,this.materialMap=null,this.combineBundleMeshs=[],this.vertexCount=0}},{key:"isExceed",value:function(){return this.vertexCount>6e4}},{key:"combine",value:function(){this._combine(this.bundeObj)}},{key:"_combine",value:function(e,t){if(void 0===t&&(t=new Xr),t.scales.push(e.scale),t.positions.push(e.position),t.quaternions.push(e.quaternion),e.isMesh){var i=0;if(e.geometry.getAttribute("position")&&(i=e.geometry.getAttribute("position").array.length),this.vertexCount+=i/3,!this.materialMap.has(e.material)){var r=new qr(e.material);this.materialMap.set(r.material,r),this.combineBundleMeshs.push(r)}this.materialMap.get(e.material).add(e,t,e.groups)}if(0!==e.children.length)for(var n=0;n<e.children.length;n++)this._combine(e.children[n],t.clone())}},{key:"clear",value:function(){for(var e=0;e<this.combineBundleMeshs.length;e++)this.combineBundleMeshs[e].clear();this._initParams()}}]),e}(),Yr=function(){function e(t){zr(this,e),this.resource=t.resource,this.mesh=null,this.builderPromise=null,this.isBuilded=!1}return Hr(e,[{key:"build",value:function(){this.isBuilded||(this.combineBundleObj=new Jr(this.resource.model),this.combineBundleObj.combine(),this.combineBundleObj.isExceed()?this.resource.vertexIsExceed=!0:(this.resource.vertexIsExceed=!1,this.changeToCalculaterMesh()),this.isBuilded=!0)}},{key:"changeToCalculaterMesh",value:function(){this.mesh=new Vr;for(var e=this.combineBundleObj.combineBundleMeshs,t=0;t<e.length;t++){var i=e[t];this.mesh.subMeshes.push(i.getCalculaterMesh())}}},{key:"clear",value:function(){this.combineBundleObj&&this.combineBundleObj.clear(),this.combineBundleObj=null}}]),e}(),Zr=function(){function e(){zr(this,e),this.map={}}return Hr(e,[{key:"getCombineMesh",value:function(e){if(!this.map[e.id]){var t=new Yr({resource:e});t.build(),this.map[e.id]=t.mesh}return this.map[e.id]}},{key:"clear",value:function(){this.map={}}}]),e}(),Qr=function(){function e(t){Ri(this,e),this.objectManager=new Ir,this.objectManager.calculaterManager=this,this.map={},this.resourcCombineManager=new Zr}return Di(e,[{key:"create",value:function(e){var t=e.type;if(this.map[t])return this.map[t];e.objectManager=this.objectManager,e.resourceCombineManager=this.resourcCombineManager;var i=Ar[t],r=void 0;return r=i?new i(e):new Nr(e),this.map[t]=r,r}},{key:"clear",value:function(){for(var e in this.map)this.map[e].clear();this.map=null,this.resourcCombineManager.clear(),this.resourcCombineManager=null}}]),e}(),Kr=new(function(){function e(t){Ri(this,e),this._versionMap={0:{0:Qr}},this._smallVersionLibs=[[0]],this._bigVersions=[0]}return Di(e,[{key:"getCalculaterManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][i.length-1]}if(null==t){var r=this._smallVersionLibs[e];return new this._versionMap[e][r.length-1]}var n=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>n[n.length-1]?new this._versionMap[e][n.length-1]:new this._versionMap[e][t];console.error("ubuilder calculater builder not support version "+e+"."+t)}}]),e}()),$r=new(function(){function e(t){Ri(this,e)}return Di(e,[{key:"create",value:function(e,t){return Kr.getCalculaterManager(e,t)}},{key:"clear",value:function(){}}]),e}()),en="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},tn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},rn=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),nn=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},on=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},sn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},an=function(){function e(t){tn(this,e),this._initParams(),this.object=t.object,this.buildPromise=null,this.manager=t.manager}return rn(e,[{key:"_initParams",value:function(){this.object=null,this.mesh=null,this.buildPromise=null,this.manager=null}},{key:"build",value:function(e){this.object=e;var t=this;this.mesh=null,t._createMesh(t.object.calculaterMesh);var i=t.object.position,r=t.object.scale,n=t.object.rotation;t.mesh.position.set(i[0],i[1],i[2]),t.mesh.scale.set(r[0],r[1],r[2]),t.mesh.quaternion.set(n[0],n[1],n[2],n[3]),t.object.mesh=t.mesh,this.mesh=null}},{key:"checkResourcesIsBuilded",value:function(){for(var e=0;e<this.object.resources.length;e++)if(!this.object.resources[e].isBuilded)return!1;return!0}},{key:"resourceDownloadCallback",value:function(e,t){}},{key:"_createMesh",value:function(e){if(this.mesh||(this.mesh=new THREE.Object3D),e){if(e.vertices.length>0){var t=e.vertices,i=e.normals,r=e.triangles,n=e.uvs,o=e.uv2s,s=new THREE.BufferGeometry;s.setIndex(new THREE.BufferAttribute(r,1)),s.setAttribute("position",new THREE.BufferAttribute(t,3)),s.setAttribute("normal",new THREE.BufferAttribute(i,3)),s.setAttribute("uv",new THREE.BufferAttribute(n,2)),o.length>0&&s.setAttribute("uv2",new THREE.BufferAttribute(o,2));var a=e.extraData;a.color&&s.setAttribute("color",new THREE.BufferAttribute(a.color,4)),a.alphaIndex&&s.setAttribute("alphaIndex",new THREE.BufferAttribute(a.alphaIndex,1)),a.groups&&(s.groups=a.groups);var l=this._getMaterial(e),u=new THREE.Mesh(s,l);this.mesh.add(u)}if(e.subMeshes.length>0)for(var c=0;c<e.subMeshes.length;c++){var h=e.subMeshes[c];this._createMesh(h)}}}},{key:"_getMaterial",value:function(e){return e.resource.material}},{key:"_dispose",value:function(e){if(e instanceof THREE.Mesh){var t=e;if(t){var i=t.material,r=t.geometry;t.isDestory=!0,i&&(this._disposeMaterial(i),t.material=null),r&&(r.isDestory=!0,r.dispose(),t.geometry=null)}}if(e)for(var n=e.children,o=0;o<n.length;o++){var s=n[o];this._dispose(s)}}},{key:"_disposeMaterial",value:function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var i=e[t];this._disposeMaterial(i)}else e.isDestory=!0,e.dispose()}},{key:"clear",value:function(e){e&&(e.parent&&e.parent.remove(e),this._dispose(e)),this._initParams()}}]),e}(),ln=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource.wallMaterial}}]),t}(an),un=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource.wallMaterial}}]),t}(an),cn={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},hn=function(){function e(){tn(this,e)}return rn(e,null,[{key:"uuid",value:function(){for(var e,t=cn.chars,i=cn.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":en(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}},{key:"calTwoPositionLength",value:function(t,i){var r=e.subPosition(t,i);return r=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],Math.sqrt(r)}},{key:"subPosition",value:function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}},{key:"normalizeDirection",value:function(t){var i=e.calTwoPositionLength([0,0,0],t);if(1===i)return t;var r=t;return 0===i?(r[0]=0,r[1]=0,r[2]=0,r):(i=1/i,r[0]*=i,r[1]*=i,r[2]*=i,r)}},{key:"getFloorUV2s",value:function(e,t,i){e.parent.parent.allRoomsBox2||e.parent.parent.meshBuilder.calAllRoomsBox2(e.parent.parent);var r=e.parent.parent.allRoomsBox2,n=e.parent.position,o=new THREE.Vector2;r.getSize(o);for(var s=t.vertices,a=[],l=0;l<s.length;l++){var u,c,h=s[l];i?(u=(h.x+n[0]-r.min.x)/o.x,c=(-h.y+n[2]-r.min.y)/o.y):(u=(h.x-r.min.x)/o.x,c=(-h.y-r.min.y)/o.y),a.push(new THREE.Vector2(parseFloat(u.toFixed(2)),1-parseFloat(c.toFixed(2))))}return a}},{key:"getShapePath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.parent,n=[0,0,0];t&&(n=r.position);for(var o=r.points,s=[],a=0;a<o.length;a++){var l=o[a];i?s.push(new THREE.Vector2(l[0]+n[0],-(l[2]+n[2]))):s.push(new THREE.Vector2(l[0]+n[0],l[2]+n[2]))}return s}},{key:"getHolesPath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.parent,n=r.holes,o=[0,0,0];t&&(o=r.position);for(var s=[],a=0;a<n.length;a++){for(var l=n[a],u=l.length,c=[],h=0;h<u;h++){var p=l[h];i?c.push(new THREE.Vector2(p[0]+o[0],-(p[2]+o[2]))):c.push(new THREE.Vector2(p[0]+o[0],p[2]+o[2]))}s.push(c)}return s}}]),e}(),pn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_createMesh",value:function(){this.instanceModel(),this.object.mesh=this.mesh}},{key:"instanceModel",value:function(){this.mesh=hn.clone(this.object.resource.model),this.hasSkin=this.mesh.hasSkin,this.mesh.name="placement",this.mesh.visible=this.object.visible,this.mesh.name="plc"+this.object.id,null!==this.object.renderMode&&this.changeRenderMode(this.mesh),this.object.customTextureResource&&this.changeWithCustomTexture(this.mesh),this.object.customColor&&this.changeWithCustomColor(this.mesh)}},{key:"changeRenderMode",value:function(e){if(e instanceof THREE.Mesh&&(e.material.color=this.object.customColor,null!==this.object.renderMode))switch(this.object.renderMode){case 1:e.material.transparent=!1,e.material.alphaTest=.5;break;case 3:case 2:e.material.transparent=!0;break;default:console.error("can not find renderMode "+this.object.renderMode)}for(var t=0;t<e.children.length;t++){var i=e.children[t];this.changeRenderMode(i)}}},{key:"changeWithCustomColor",value:function(e){e instanceof THREE.Mesh&&(e.material.color=this.object.customColor,null!==this.object.opacity&&(e.material.opacity=this.object.opacity,e.material.transparent=!0));for(var t=0;t<e.children.length;t++){var i=e.children[t];this.changeWithCustomColor(i)}}},{key:"changeWithCustomTexture",value:function(e){e instanceof THREE.Mesh&&(e.material.map=this.object.customTextureResource.texture);for(var t=0;t<e.children.length;t++){var i=e.children[t];this.changeWithCustomTexture(i)}}}]),t}(an),dn={TOP_LEFT:0,TOP_RIGHT:1,BOTTOM_LEFT:2,BOTTOM_RIGHT:3},fn={TOP:0,BOTTOM:1},mn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_createMesh",value:function(e){this.instanceModel(),this.changeOpenDirection()}},{key:"getOpenController",value:function(){return this.mesh?this.mesh.getObjectByName("Controller"):null}},{key:"isSingleOpen",value:function(){var e=this.getOpenController();return!!e&&1===e.children.length}},{key:"changeOpenDirection",value:function(){(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI);var e=this.getOpenController(),t=this.mesh.getObjectByName("RootNode");if(t)if(this.isSingleOpen()&&e)switch(this.object.openDirIndex){case dn.TOP_LEFT:break;case dn.TOP_RIGHT:e.scale.set(-1,1,1);break;case dn.BOTTOM_LEFT:t.rotateY(Math.PI),e.scale.set(-1,1,1);break;case dn.BOTTOM_RIGHT:t.rotateY(Math.PI)}else if(this.hasAnimation||e)switch(this.object.openDirIndex){case fn.TOP:break;case fn.BOTTOM:t.rotateY(Math.PI)}else switch(this.object.openDirIndex){case fn.TOP:break;case fn.BOTTOM:t.rotateY(Math.PI)}}},{key:"initModelSize",value:function(){this.object.modelSize=this.object.resource.modelSize,this.object.resource.model&&(this.object.size=[this.modelSize.x*this.scale.x,this.modelSize.y*this.scale.y,this.modelSize.z*this.scale.z])}},{key:"hasAnimation",get:function(){return!!(this.object.resource.animations&&this.object.resource.animations.length>0)}}]),t}(pn),gn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource}},{key:"_createMesh",value:function(e){if(this.object.resource.vertexIsExceed){this.mesh=new THREE.Object3D;for(var i=this.object.objects,r=0;r<i.length;r++){var n=i[r];n.meshBuilder.build(n),this.mesh.add(n.mesh)}}else nn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this,e)}}]),t}(an),vn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_createMesh",value:function(e){var t=this.object.objects,i=this.object.resource.roomMaterial.clone();i.side=THREE.DoubleSide;for(var r=new THREE.Geometry,n=0;n<t.length;n++){var o=t[n],s=this._calGeometry(o);this.setUV2s(o,s),r.merge(s)}var a=new THREE.Mesh(r,i);a.name="combine",this.combineMesh=a,this.combineMesh.name="floor",this.mesh=this.combineMesh}},{key:"_calGeometry",value:function(e){e.parent;for(var t,i=this._getPointsPath(e),r=this._getHolesPath(e),n=new THREE.Vector3,o=0;o<i.length;o++){var s=i[o];n.x+=s.x,n.z+=s.y}if(n.x/=i.length,n.z/=i.length,t=0===i.length?new THREE.Shape:new THREE.Shape(i),r)for(o=0;o<r.length;o++){var a=r[o];t.holes.push(new THREE.Path(a))}var l=new THREE.ShapeGeometry(t);for(o=0;o<l.faceVertexUvs.length;o++)for(var u=l.faceVertexUvs[o],c=0;c<u.length;c++)for(var h=u[c],p=0;p<h.length;p++){var d=h[p],f=void 0,m=void 0;f=d.x-n.x,m=d.y-n.z,e.blockSize&&(f/=e.blockSize[0],m/=e.blockSize[1]),d.set(f,m)}return l.uvsNeedUpdate=!0,this.rotateUV(e,l),l}},{key:"rotateUV",value:function(e,t){for(var i=e.blockAngle*Math.PI/180,r=new THREE.Vector2(.5,.5),n=t.faceVertexUvs[0],o=0;o<n.length;o++)for(var s=n[o],a=0;a<s.length;a++){var l=s[a];l.sub(r),(l=new THREE.Vector2(l.x*Math.cos(i)-l.y*Math.sin(i),l.x*Math.sin(i)+l.y*Math.cos(i))).add(r),s[a]=l}}},{key:"_getPointsPath",value:function(e){return hn.getShapePath(e,!0)}},{key:"_getHolesPath",value:function(e){return hn.getHolesPath(e,!0)}},{key:"setUV2s",value:function(e,t){for(var i=hn.getFloorUV2s(e,t,!1),r=t.faces,n=[],o=0;o<r.length;o++){var s=r[o],a=[i[s.a],i[s.b],i[s.c]];n.push(a)}t.faceVertexUvs[1]=n}}]),t}(an),yn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_createMesh",value:function(e){for(var t=this.object.objects,i=this.object.resource.roomMaterial,r=new THREE.Geometry,n=0;n<t.length;n++){var o=t[n],s=this._calGeometry(o);r.merge(s)}var a=new THREE.Mesh(r,i);a.name="combine",this.combineMesh=a,this.combineMesh.name="floor",this.mesh=this.combineMesh}},{key:"_getPointsPath",value:function(e){return hn.getShapePath(e,!0,!1)}},{key:"_getHolesPath",value:function(e){return hn.getHolesPath(e,!0,!1)}}]),t}(vn),bn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_createMesh",value:function(e){for(var t=this.object.objects,i=this.object.resource.roomMaterial,r=new THREE.Geometry,n=0;n<t.length;n++){var o=t[n],s=this._calGeometry(o);r.merge(s)}var a=new THREE.Mesh(r,i);a.name="combine",this.combineMesh=a,this.combineMesh.name="floor",this.mesh=this.combineMesh}}]),t}(vn),_n=function(e){function t(e){tn(this,t);var i=sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.shapePath=[],i.reverseZShapPath=[],i.holePaths=[],i.reverseZHolePaths=[],i}return on(t,e),rn(t,[{key:"_initParams",value:function(){nn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.shapePath=null,this.reverseZShapPath=null,this.holePaths=null,this.reverseZHolePaths=null}},{key:"_getMaterial",value:function(e){return e.resource.roomMaterial}},{key:"_createMesh",value:function(e){var t=this.object.parent;this._calGeometry();var i=this.geometry,r=null;null===this.object.height&&(this.object.height=this.object.DefaultHeight),(r=this.object.resource.roomMaterial).side=THREE.DoubleSide,r.defines=r.defines||{},r.defines.FLOOR_AO=!0,this.mesh=new THREE.Mesh(i,r),this.mesh.name="floor",this.mesh.position.y=this.object.height,this.mesh.rotateX(-Math.PI/2),this.mesh.visible=this.object.visible,this.mesh.roomID=t.id,this.object.rotation=this.mesh.quaternion.toArray(),this.object.position=this.mesh.position.toArray(),this.object.scale=this.mesh.scale.toArray()}},{key:"_calGeometry",value:function(){this.object.parent;for(var e,t=this._getPointsPath(this.object),i=this._getHolesPath(this.object),r=new THREE.Vector3,n=0;n<t.length;n++){var o=t[n];r.x+=o.x,r.z+=o.y}if(r.x/=t.length,r.z/=t.length,e=0===t.length?new THREE.Shape:new THREE.Shape(t),i.length>0)for(n=0;n<i.length;n++){var s=i[n];e.holes.push(new THREE.Path(s))}var a=new THREE.ShapeGeometry(e);for(n=0;n<a.faceVertexUvs.length;n++)for(var l=a.faceVertexUvs[n],u=0;u<l.length;u++)for(var c=l[u],h=0;h<c.length;h++){var p=c[h],d=void 0,f=void 0;d=p.x-r.x,f=p.y-r.z,this.object.blockSize&&(d/=this.object.blockSize[0],f/=this.object.blockSize[1]),p.set(d,f)}a.uvsNeedUpdate=!0,this.rotateUV(a),this.geometry=a,this.object.parent.parent&&this.setUV2s(a)}},{key:"setUV2s",value:function(e){for(var t=hn.getFloorUV2s(this.object,e,!0),i=e.faces,r=[],n=0;n<i.length;n++){var o=i[n],s=[t[o.a],t[o.b],t[o.c]];r.push(s)}e.faceVertexUvs[1]=r}},{key:"rotateUV",value:function(e){for(var t=this.object.blockAngle*Math.PI/180,i=new THREE.Vector2(.5,.5),r=e.faceVertexUvs[0],n=0;n<r.length;n++)for(var o=r[n],s=0;s<o.length;s++){var a=o[s];a.sub(i),(a=new THREE.Vector2(a.x*Math.cos(t)-a.y*Math.sin(t),a.x*Math.sin(t)+a.y*Math.cos(t))).add(i),o[s]=a}}},{key:"_getPointsPath",value:function(e){return hn.getShapePath(e,!1)}},{key:"_getHolesPath",value:function(e){return hn.getHolesPath(e,!1)}}]),t}(an),xn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource.roomMaterial}},{key:"_createMesh",value:function(e){var t=this.object.parent;this._calGeometry();var i=this.object.resource.roomMaterial;if(this.mesh=new THREE.Mesh(this.geometry,i),this.mesh.name="ceiling",this.mesh.rotateX(Math.PI/2),null===this.object.height){var r=2.9;t.parent&&(r=t.parent.height),this.object.height=r}this.mesh.position.y=this.object.height,this.mesh.visible=this.object.visible,this.object.rotation=this.mesh.quaternion.toArray(),this.object.position=this.mesh.position.toArray(),this.object.scale=this.mesh.scale.toArray()}},{key:"_getPointsPath",value:function(e){return hn.getShapePath(e,!1,!1)}},{key:"_getHolesPath",value:function(e){return hn.getHolesPath(e,!1,!1)}}]),t}(_n),En=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource.roomMaterial}},{key:"_createMesh",value:function(e){var t=this.object.parent;this._calGeometry();var i=null;if(i=this.object.resource.roomMaterial,this.mesh=new THREE.Mesh(this.geometry,i),null===this.object.height){var r=3;t.parent&&(r=t.parent.height),this.object.height=r}this.mesh.position.y=this.object.height+.001,this.mesh.name="roof",this.mesh.rotateX(-Math.PI/2),this.mesh.visible=this.object.visible,this.mesh.name="roof"+t.id,this.object.rotation=this.mesh.quaternion.toArray(),this.object.position=this.mesh.position.toArray(),this.object.scale=this.mesh.scale.toArray()}}]),t}(_n),wn=function(e){function t(e){tn(this,t);var i=sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.shapePath=[],i.reverseZShapPath=[],i.holePaths=[],i.reverseZHolePaths=[],i.isCalculaterPoints=!1,i}return on(t,e),rn(t,[{key:"_initParams",value:function(){nn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.shapePath=null,this.reverseZShapPath=null,this.holePaths=null,this.reverseZHolePaths=null,this.isCalculaterPoints=null}},{key:"calculaterPoints",value:function(){this._initShapePathPoints(),this._initShapeHolePoints(),this.isCalculaterPoints=!0}},{key:"_initShapePathPoints",value:function(){var e=this.object.points;this.shapePath.length=0,this.reverseZShapPath.length=0;for(var t=0;t<e.length;t++){var i=e[t];this.shapePath.push(new THREE.Vector2(i[0],i[2])),this.reverseZShapPath.push(new THREE.Vector2(i[0],-i[2]))}this.object.floor.meshBuilder.shapePath=this.reverseZShapPath,this.object.ceiling&&(this.object.ceiling.meshBuilder.shapePath=this.shapePath),this.object.roof&&(this.object.roof.meshBuilder.shapePath=this.reverseZShapPath)}},{key:"_initShapeHolePoints",value:function(){var e=this.object.holes;this.holePaths.length=0,this.reverseZHolePaths.length=0;for(var t=0;t<e.length;t++){for(var i=e[t],r=i.length,n=[],o=[],s=0;s<r;s++){var a=i[s];n.push(new THREE.Vector2(a[0],a[2])),o.push(new THREE.Vector2(a[0],-a[2]))}this.holePaths.push(n),this.reverseZHolePaths.push(o)}this.object.floor.meshBuilder.holePaths=this.reverseZHolePaths,this.object.ceiling&&(this.object.ceiling.meshBuilder.holePaths=this.holePaths),this.object.roof&&(this.object.roof.meshBuilder.holePaths=this.reverseZHolePaths)}}]),t}(an),Tn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),t}(an),Mn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource}}]),t}(an),Cn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),t}(an),Sn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource}},{key:"_createMesh",value:function(e){if(this._isVertexExceed()){this.mesh=new THREE.Object3D;for(var i=this.object.objects,r=0;r<i.length;r++){var n=i[r];n.build(),this.mesh.add(this._getObjMesh(n))}}else nn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this,e)}},{key:"_getObjMesh",value:function(e){for(var t=e.children,i=0;i<t.length;i++){var r=t[i];e.mesh.add(this._getObjMesh(r))}return e.mesh}},{key:"_isVertexExceed",value:function(){for(var e=0;e<this.object.resources.length;e++)if(this.object.resources[e].vertexIsExceed)return!0;return!1}}]),t}(an),jn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),t}(pn),Pn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),t}(Cn),Rn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),t}(pn),Dn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),t}(pn),An=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource}}]),t}(an),kn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_getMaterial",value:function(e){return e.resource}}]),t}(an),On=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_initParams",value:function(){nn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._allRoomsBox2=null}},{key:"calAllRoomsBox2",value:function(e){e.allRoomsBox2||(e.allRoomsBox2=this._calAllRoomsBox2(e))}},{key:"_calAllRoomsBox2",value:function(e){var t=new THREE.Box2,i=e.typeToChildren.Room;if(i)for(var r=0;r<i.length;r++){var n=i[r];this._addRoomToCalAllRoomsBox2(t,n)}var o=e.typeToChildren.CombineFloor;if(o)for(var s=0;s<o.length;s++)for(var a=o[s],l=0;l<a.objects.length;l++){var u=a.objects[l];this._addRoomToCalAllRoomsBox2(t,u.parent)}return t}},{key:"_addRoomToCalAllRoomsBox2",value:function(e,t){for(var i=this._getFloorPosition(t),r=t.points,n=0;n<r.length;n++){var o=new THREE.Vector2(r[n][0],r[n][2]);o.x+=i[0],o.y+=i[2],e.expandByPoint(o)}}},{key:"_getFloorPosition",value:function(e){return e.position.slice()}}]),t}(an),Bn={DoorOrWindow:mn,Placement:pn,StraightManualWall:ln,CombineStraightManualWall:un,CombinePlacement:gn,CombineCeiling:yn,CombineRoof:bn,CombineFloor:vn,CombineModelWall:Mn,FloorPlan:On,Outdoors:On,Ceiling:xn,Floor:_n,Roof:En,Room:wn,ModelWall:Tn,PlacementGroup:Cn,CombinePlacementGroup:Sn,Facade:jn,FacadeGroup:Pn,PlacementWall:Rn,PlacementGround:Dn,CombinePlacementWall:An,CombineDoorOrWindow:kn,VideoProbe:pn},Fn=function(e){function t(e){return tn(this,t),sn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return on(t,e),rn(t,[{key:"_createMesh",value:function(e){var t=this;t.mesh=new THREE.Object3D;var i=t.object.position,r=t.object.scale,n=t.object.rotation;t.mesh.position.set(i[0],i[1],i[2]),t.mesh.scale.set(r[0],r[1],r[2]),t.mesh.quaternion.set(n[0],n[1],n[2],n[3]),t.object.mesh=t.mesh}}]),t}(an),Ln=function(){function e(t){tn(this,e),this.meshBuilderMap={}}return rn(e,[{key:"create",value:function(e){var t=e.type;if(this.meshBuilderMap[t])return this.meshBuilderMap[t];var i=Bn[t];e.manager=this;var r=void 0;return r=i?new i(e):new Fn(e),this.meshBuilderMap[t]=r,r}},{key:"clear",value:function(){for(var e in this.meshBuilderMap)this.meshBuilderMap[e].clear();this.meshBuilderMap=null}}]),e}(),In=new(function(){function e(t){tn(this,e),this._versionMap={0:{0:Ln}},this._smallVersionLibs=[[0]],this._bigVersions=[0]}return rn(e,[{key:"getManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][i.length-1]}if(null==t){var r=this._smallVersionLibs[e];return new this._versionMap[e][r.length-1]}var n=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>n[n.length-1]?new this._versionMap[e][n.length-1]:new this._versionMap[e][t];console.error("ubuilder meshBuilder  not support version "+e+"."+t)}}]),e}()),Nn=new(function(){function e(t){tn(this,e)}return rn(e,[{key:"create",value:function(e,t){return In.getManager(e,t)}},{key:"clear",value:function(){}}]),e}()),Un="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},zn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Hn=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Vn=function(){function e(t){zn(this,e),this._init()}return Hn(e,[{key:"_init",value:function(){this.vertices=[],this.normals=[],this.uvs=[],this.uv2s=[],this.resource=null,this.triangles=[],this.subMeshes=[],this.extraData={}}},{key:"clone",value:function(){var t=new e;for(var i in t.vertices=this.vertices.slice(),t.normals=this.normals.slice(),t.uvs=this.uvs.slice(),t.uv2s=this.uv2s.slice(),t.resource=this.resource,t.triangles=this.triangles.slice(),this.extraData)t.extraData[i]=this.extraData[i].slice();for(var r=0;r<this.subMeshes.length;r++){var n=this.subMeshes[r].clone();t.subMeshes.push(n)}return t}},{key:"clear",value:function(){for(var e=0;e<this.subMeshes.length;e++)this.subMeshes[e].clear();this._init()}}]),e}(),Wn=function(){function e(){zn(this,e)}return Hn(e,null,[{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Un(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"applyQuaternionToVector3",value:function(e,t){if(0!==e[0]||0!==e[1]||0!==e[2]||1!==e[3]){var i=t[0],r=t[1],n=t[2],o=e[0],s=e[1],a=e[2],l=e[3],u=l*i+s*n-a*r,c=l*r+a*i-o*n,h=l*n+o*r-s*i,p=-o*i-s*r-a*n;t[0]=u*l+p*-o+c*-a-h*-s,t[1]=c*l+p*-s+h*-o-u*-a,t[2]=h*l+p*-a+u*-s-c*-o}}}]),e}(),Gn=function(){function e(t){zn(this,e),this._initParams(),this.positions=[],this.normals=[],this.uvs=[],this.uv2s=[],this.uv3s=[],this.indexes=[],this.colors=[],this.alphaIndexes=[],this.material=t,this.groupsArray=null,this.meshes=[],this.transformations=[],this.verticesCount=0,this.uvsCount=0,this.indexesCount=0,this.trianglesCount=0,this.colorsCount=0,this.alphaIndexsCount=0,this.uv2sCount=0,this.uv3sCount=0,this.groupsCountArray=null,this.combineCursor={vertex:0,index:0,uv:0,color:0,alphaIndex:0,uv2:0,uv3:0,groups:[]},this.maxCount=196602}return Hn(e,[{key:"_initParams",value:function(){this.positions=[],this.normals=[],this.uvs=[],this.uv2s=[],this.uv3s=[],this.indexes=[],this.colors=[],this.alphaIndexes=[],this.material=null,this.groups=null,this.meshes=[],this.transformations=[],this.verticesCount=0,this.uvsCount=0,this.indexesCount=0,this.trianglesCount=0,this.colorsCount=0,this.alphaIndexsCount=0,this.uv2sCount=0,this.uv3sCount=0,this.combineCursor=null,this.maxCount=null}},{key:"_initGroups",value:function(){var e=[],t=this.meshObj.geometry,i=0;if(t.groups.length>0){var r=this.cloneGroups(t.groups);r.forEach((function(e){e.start+=i})),e=e.concat(r)}}},{key:"cloneGroups",value:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];t.push(Wn.cloneJSObject(r))}return t}},{key:"getCalculaterMesh",value:function(){this._combine();var e=new Vn;return e.resource=this.material,this.positions.length>0&&(e.vertices=this.positions),this.normals.length&&(e.normals=this.normals),this.uvs.length&&(e.uvs=this.uvs),this.uv2s.length&&(e.uv2s=this.uv2s),this.indexes.length>0&&(e.triangles=this.indexes),this.colors.length&&(e.extraData.color=this.colors),this.uv3s.length>0&&(e.extraData.uv3=this.uv3s),this.alphaIndexes.length>0&&(e.extraData.alphaIndex=this.alphaIndexes),this.groups&&(e.extraData.groups=this.groups),e}},{key:"_combine",value:function(){if(this.indexes=new Uint16Array(this.indexesCount),this.positions=new Float32Array(this.verticesCount),this.normals=new Float32Array(this.verticesCount),this.uvs=new Float32Array(this.uvsCount),0!==this.uv2sCount&&(this.uv2s=new Float32Array(this.uv2sCount)),0!==this.uv3sCount&&(this.uv3s=new Float32Array(this.uv3sCount)),0!==this.colorsCount&&(this.colors=new Uint16Array(this.colorsCount)),0!==this.alphaIndexsCount&&(this.alphaIndexes=new Uint16Array(this.alphaIndexsCount)),this.groupsCountArray)for(var e=0;e<this.groupsCountArray.length;e++){var t=this.groupsCountArray[e];this.combineCursor.groups.push({currentIndex:t.start})}for(var i=0;i<this.transformations.length;i++){var r=this.transformations[i];this._applyTransformation(this.meshes[i],r)}this.groups=this.groupsCountArray}},{key:"_applyTransformation",value:function(e,t,i){this._combineIndexes(e,i),this._combinePositionsAndNormals(e,t),this._combineUVs(e),this._combineColors(e),this._combineAlphaIndexes(e)}},{key:"_combineIndexes",value:function(e){var t=e.geometry.index.array,i=e.geometry.groups;if(i.length>0)for(var r=0;r<i.length;r++){for(var n=i[r],o=n.start,s=n.count,a=this.combineCursor.groups[r],l=0;l<s;l++)this.indexes[a.currentIndex+l]=this.combineCursor.vertex/3+t[o+l];this.combineCursor.groups[r].currentIndex+=s}else{for(var u=0;u<t.length;u++)this.indexes[this.combineCursor.index+u]=this.combineCursor.vertex/3+t[u];this.combineCursor.index+=t.length}}},{key:"_combinePositionsAndNormals",value:function(e,t){var i=null,r=null,n=e.geometry.getAttribute("position");i=n?n.array:[];var o=e.geometry.getAttribute("normal");r=o?o.array:[];for(var s=new Float32Array(3),a=new Float32Array(3),l=0;l<i.length;){a[0]=i[l],a[1]=i[l+1],a[2]=i[l+2],s[0]=r[l],s[1]=r[l+1],s[2]=r[l+2];for(var u=t.positions.length-1;u>-1;u--){var c=t.scales[u],h=t.quaternions[u],p=t.positions[u];1!==c.x&&(a[0]*=c.x),1!==c.y&&(a[1]*=c.y),1!==c.z&&(a[2]*=c.z),Wn.applyQuaternionToVector3(h.toArray(),a),0!==p.x&&(a[0]+=p.x),0!==p.y&&(a[1]+=p.y),0!==p.z&&(a[2]+=p.z),r&&Wn.applyQuaternionToVector3(h.toArray(),s)}this.positions[this.combineCursor.vertex+l]=a[0],this.positions[this.combineCursor.vertex+l+1]=a[1],this.positions[this.combineCursor.vertex+l+2]=a[2],this.normals[this.combineCursor.vertex+l]=s[0],this.normals[this.combineCursor.vertex+l+1]=s[1],this.normals[this.combineCursor.vertex+l+2]=s[2],l+=3}this.combineCursor.vertex+=i.length}},{key:"_combineUVs",value:function(e){var t=e.geometry.getAttribute("uv"),i=null;i=t?t.array:[];for(var r=0;r<i.length;r++)this.uvs[this.combineCursor.uv+r]=i[r];this.combineCursor.uv+=i.length;var n=e.geometry.getAttribute("uv2");if(n){for(var o=n.array,s=0;s<o.length;s++)this.uv2s[this.combineCursor.uv2+s]=o[s];this.combineCursor.uv2+=o.length}var a=e.geometry.getAttribute("uv3");if(a){for(var l=a.array,u=0;u<l.length;u++)this.uv3s[this.combineCursor.uv3+u]=l[u];this.combineCursor.uv3+=l.length}}},{key:"_combineColors",value:function(e){var t=e.geometry.getAttribute("color");if(t){for(var i=t.array,r=0;r<i.length;r++)this.colors[this.combineCursor.color+r]=i[r];this.combineCursor.color+=i.length}}},{key:"_combineAlphaIndexes",value:function(e){var t=e.geometry.getAttribute("alphaIndex");if(t){for(var i=t.array,r=0;r<i.length;r++)this.alphaIndexes[this.combineCursor.alphaIndex+r]=i[r];this.combineCursor.alphaIndex+=i.length}}},{key:"add",value:function(e,t,i){if(this.meshes.push(e),this.transformations.push(t),e.geometry.groups)if(this.groupsCountArray)for(var r=e.geometry.groups,n=0;n<r.length;n++){var o=r[n];this.groupsCountArray[n].count+=o.count,n!==r.length-1&&(this.groupsCountArray[n+1].start=this.groupsCountArray[n].start+this.groupsCountArray[n].count)}else this.groupsCountArray=this.cloneGroups(e.geometry.groups);e.geometry.index&&(this.indexesCount+=e.geometry.index.array.length),e.geometry.getAttribute("position")&&(this.verticesCount+=e.geometry.getAttribute("position").array.length),e.geometry.getAttribute("uv")&&(this.uvsCount+=e.geometry.getAttribute("uv").array.length);var s=e.geometry.getAttribute("color");s&&(this.colorsCount+=s.array.length);var a=e.geometry.getAttribute("alphaIndex");a&&(this.alphaIndexsCount+=a.array.length);var l=e.geometry.getAttribute("uv2");l&&(this.uv2sCount+=l.array.length);var u=e.geometry.getAttribute("uv3");u&&(this.uv3sCount+=u.array.length)}},{key:"isExceed",value:function(e){return this.verticesCount+e>this.maxCount}},{key:"clear",value:function(){this._initParams()}}]),e}(),qn=function(){function e(t){zn(this,e),this._initParams(),this.material=t,this.mesh=new Vn,this.combineBundleSubMeshes=[],this.currentCombineBundleSubMesh=this._createCombineBundleSubMesh(),this.vertexCount=0}return Hn(e,[{key:"_initParams",value:function(){this.material=null,this.groups=null,this.mesh=null,this.combineBundleSubMeshes=[],this.currentCombineBundleSubMesh=null,this.vertexCount=0}},{key:"_createCombineBundleSubMesh",value:function(){var e=new Gn(this.material);return this.combineBundleSubMeshes.push(e),e}},{key:"add",value:function(e,t,i){var r=0;e.geometry.getAttribute("position")&&(r=e.geometry.getAttribute("position").array.length),this.currentCombineBundleSubMesh.isExceed(r)&&(this.currentCombineBundleSubMesh=this._createCombineBundleSubMesh()),this.currentCombineBundleSubMesh.add(e,t,i)}},{key:"getCalculaterMesh",value:function(){for(var e=0;e<this.combineBundleSubMeshes.length;e++){var t=this.combineBundleSubMeshes[e];this.mesh.subMeshes.push(t.getCalculaterMesh())}return this.mesh}},{key:"clear",value:function(){for(var e=0;e<this.combineBundleSubMeshes.length;e++)this.combineBundleSubMeshes[e].clear();this._initParams()}}]),e}(),Xn=function(){function e(){zn(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return Hn(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),Jn=function(){function e(t){zn(this,e),this._initParams(),this.bundeObj=t,this.materialMap=new Map}return Hn(e,[{key:"_initParams",value:function(){this.bundeObj=null,this.materialMap=null,this.combineBundleMeshs=[],this.vertexCount=0}},{key:"isExceed",value:function(){return this.vertexCount>6e4}},{key:"combine",value:function(){this._combine(this.bundeObj)}},{key:"_combine",value:function(e,t){if(void 0===t&&(t=new Xn),t.scales.push(e.scale),t.positions.push(e.position),t.quaternions.push(e.quaternion),e.isMesh){var i=0;if(e.geometry.getAttribute("position")&&(i=e.geometry.getAttribute("position").array.length),this.vertexCount+=i/3,!this.materialMap.has(e.material)){var r=new qn(e.material);this.materialMap.set(r.material,r),this.combineBundleMeshs.push(r)}this.materialMap.get(e.material).add(e,t,e.groups)}if(0!==e.children.length)for(var n=0;n<e.children.length;n++)this._combine(e.children[n],t.clone())}},{key:"clear",value:function(){for(var e=0;e<this.combineBundleMeshs.length;e++)this.combineBundleMeshs[e].clear();this._initParams()}}]),e}(),Yn=function(){function e(t){zn(this,e),this.resource=t.resource,this.mesh=null,this.builderPromise=null,this.isBuilded=!1}return Hn(e,[{key:"build",value:function(){this.isBuilded||(this.combineBundleObj=new Jn(this.resource.model),this.combineBundleObj.combine(),this.combineBundleObj.isExceed()?this.resource.vertexIsExceed=!0:(this.resource.vertexIsExceed=!1,this.changeToCalculaterMesh()),this.isBuilded=!0)}},{key:"changeToCalculaterMesh",value:function(){this.mesh=new Vn;for(var e=this.combineBundleObj.combineBundleMeshs,t=0;t<e.length;t++){var i=e[t];this.mesh.subMeshes.push(i.getCalculaterMesh())}}},{key:"clear",value:function(){this.combineBundleObj&&this.combineBundleObj.clear(),this.combineBundleObj=null}}]),e}(),Zn=(function(){function e(){zn(this,e),this.map={}}Hn(e,[{key:"getCombineMesh",value:function(e){if(!this.map[e.id]){var t=new Yn({resource:e});t.build(),this.map[e.id]=t.mesh}return this.map[e.id]}},{key:"clear",value:function(){this.map={}}}])}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),Qn=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Kn=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},$n=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},eo=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},to=function(){function e(t){Zn(this,e),this._initParams(),this.object=t.object,this.manager=t.manager}return Qn(e,[{key:"_initParams",value:function(){this.object=null,this.manager=null}},{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var i=e[t],r=this.manager.parserConfig[i.type];r&&new r({object:i,manager:this.manager}).parse()}}},{key:"clear",value:function(){this._initParams()}}]),e}(),io=function(e){function t(e){return Zn(this,t),eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return $n(t,e),t}(to),ro=function(e){function t(e){return Zn(this,t),eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return $n(t,e),t}(to),no=function(){function e(t){Zn(this,e),this._initParams(),this.manager=t.manager,this.parent=null}return Qn(e,[{key:"_initParams",value:function(){this.parent=null,this.manager=null}},{key:"parse",value:function(){}},{key:"isObjectShouldCombine",value:function(e){return!!(this.isNullOrUndefined(e.properties)&&this.isNullOrUndefined(e.userID)&&this.isNullOrUndefined(e.name)&&e.visible)}},{key:"isNullOrUndefined",value:function(e){return null==e}}]),e}(),oo=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineWall=null,i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineWall=null}},{key:"parse",value:function(e){"StraightManualWall"===e.type&&(e.visible&&(null===this.combineWall&&(this.combineWall=this.crerateCombineStraightManualWall()),this.combineWall.addObject(e)),e.parent=null)}},{key:"crerateCombineStraightManualWall",value:function(){var e=this.manager.objectManager.create({type:"CombineStraightManualWall"});return e.parent=this.parent,e}},{key:"initWallCorners",value:function(){for(var e=this.parent.typeToChildren.WallCorner,t=0;t<e.length;t++){var i=e[t];this.combineWall.addCorner(i)}}}]),t}(no),so=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i._combineObjectClass=i.manager.objectManager.ClassName.CombinePlacement,i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){e.type===this.manager.objectManager.ClassName.Placement&&this.isObjectShouldCombine(e)&&(this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null)}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}}]),t}(no),ao=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._combineObjectClass=i.manager.objectManager.ClassName.CombineDoorOrWindow,i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._combineObjectClass=null}},{key:"parse",value:function(e){"DoorOrWindow"===e.type&&this.isObjectShouldCombine(e)&&(this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null)}}]),t}(so),lo=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineFloorMaps={},i.combineCeilingMaps={},i.combineRoofMaps={},i.combineObjectMaps={Floor:i.combineFloorMaps,Ceiling:i.combineCeilingMaps,Roof:i.combineRoofMaps},i.typeToCombineObjectType={Floor:"CombineFloor",Ceiling:"CombineCeiling",Roof:"CombineRoof"},i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineFloorMaps=null,this.combineCeilingMaps=null,this.combineRoofMaps=null,this.combineObjectMaps=null,this.typeToCombineObjectType=null}},{key:"createCombineObject",value:function(e,t,i){var r=this.manager.objectManager.create({type:this.typeToCombineObjectType[e]});return r.parent=this.parent,r.resource=t,r.height=i,r}},{key:"parse",value:function(e){this.isObjectShouldCombine(e)&&(e.ceiling&&e.ceiling.visible&&this._addCombineObject(e.ceiling),e.roof&&e.roof.visible&&this._addCombineObject(e.roof),e.floor.visible&&this._addCombineObject(e.floor),e.parent=null)}},{key:"_addCombineObject",value:function(e){var t=e.type,i=e.height,r=e.resource,n=this.combineObjectMaps[t];n[r.id]?n[r.id].has(i)||n[r.id].set(i,this.createCombineObject(t,r,i)):(n[r.id]=new Map,n[r.id].set(i,this.createCombineObject(t,r,i))),n[r.id].get(i).addObject(e)}}]),t}(no),uo=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i._CombineObjectClass=i.manager.objectManager.ClassName.CombineModelWall,i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){e.visible&&(this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e)),e.parent=null}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._CombineObjectClass});return t.resource=e,t.parent=this.parent,t}}]),t}(no),co=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._combineObjectClass=i.manager.objectManager.ClassName.CombinePlacementGroup,i.combinePlacementGroup=null,i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){e.type===this.manager.objectManager.ClassName.PlacementGroup&&this.isObjectShouldCombine(e)&&(null===this.combinePlacementGroup&&(this.combinePlacementGroup=this.createCombineObject()),this.combinePlacementGroup.addObject(e),e.parent=null)}},{key:"createCombineObject",value:function(){var e=this.manager.objectManager.create({type:this._combineObjectClass});return e.parent=this.parent,e}}]),t}(no),ho=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i._combineObjectClass=i.manager.objectManager.ClassName.CombinePlacementWall,i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}}]),t}(no),po={StraightManualWall:oo,WallCorner:no,DoorOrWindow:ao,Placement:so,Room:lo,ModelWall:uo,PlacementGroup:co,PlacementWall:ho},fo=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combiners={},i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combiners=null}},{key:"parse",value:function(){for(var e=this.object.children.slice(),t=0;t<e.length;t++){var i=e[t];this.initCombiner(i)}this.removeCorners()}},{key:"initCombiner",value:function(e){if(!this.combiners[e.type]){var t=po[e.type];if(t){var i=new t({manager:this.manager});i.parent=this.object,this.combiners[e.type]=i}}this.combiners[e.type]&&this.combiners[e.type].parse(e)}},{key:"removeCorners",value:function(){var e=this.object.typeToChildren.WallCorner;if(e){e=e.slice();for(var t=0;t<e.length;t++)e[t].parent=null}}},{key:"clear",value:function(){for(var e in this.combiners)this.combiners[e].clear();Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(to),mo=function(e){function t(e){return Zn(this,t),eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return $n(t,e),t}(fo),go={World:io,Building:ro,FloorPlan:fo,Outdoors:mo},vo=function(){function e(){Zn(this,e),this.objectManager=null,this.parserConfig=go,this.rootParser=null}return Qn(e,[{key:"parse",value:function(e){new(0,this.parserConfig[e.type])({object:e,manager:this}).parse()}},{key:"clear",value:function(){this.rootParser&&this.rootParser.clear(),this.rootParser=null,this.objectManager=null,this.parserConfig=null}}]),e}(),yo=function(){function e(t){Zn(this,e),this._initParams(),this.object=t.object,this.manager=t.manager}return Qn(e,[{key:"_initParams",value:function(){this.object=null,this.manager=null}},{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var i=e[t],r=this.manager.parserConfig[i.type];r&&new r({object:i,manager:this.manager}).parse()}}},{key:"clear",value:function(){this._initParams()}}]),e}(),bo=function(e){function t(e){return Zn(this,t),eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return $n(t,e),t}(yo),_o=function(e){function t(e){return Zn(this,t),eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return $n(t,e),t}(yo),xo=function(){function e(t){Zn(this,e),this._initParams(),this.manager=t.manager,this.parent=null,this.styleTagKey="_styleTag_"}return Qn(e,[{key:"_initParams",value:function(){this.parent=null,this.manager=null}},{key:"parse",value:function(){}},{key:"isObjectOnlyContainStyleTagProp",value:function(e){return!this.isNullOrUndefined(e.properties)&&(this.isNullOrUndefined(e.properties[this.styleTagKey])||1!==Object.keys(e.properties).length?void 0:!!this.isNullOrUndefined(e.userID)&&!!this.isNullOrUndefined(e.name))}},{key:"isObjectShouldCombine",value:function(e){return!!(this.isNullOrUndefined(e.properties)&&this.isNullOrUndefined(e.userID)&&this.isNullOrUndefined(e.name)&&e.visible)}},{key:"isNullOrUndefined",value:function(e){return null==e}}]),e}(),Eo=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineWall=null,i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineWall=null}},{key:"parse",value:function(e){"StraightManualWall"===e.type&&(e.visible&&(null===this.combineWall&&(this.combineWall=this.crerateCombineStraightManualWall()),this.combineWall.addObject(e)),e.parent=null)}},{key:"crerateCombineStraightManualWall",value:function(){var e=this.manager.objectManager.create({type:"CombineStraightManualWall"});return e.parent=this.parent,e}},{key:"initWallCorners",value:function(){for(var e=this.parent.typeToChildren.WallCorner,t=0;t<e.length;t++){var i=e[t];this.combineWall.addCorner(i)}}}]),t}(xo),wo=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i.onlyContainStyleTagCombineObjectMap={},i._combineObjectClass=i.manager.objectManager.ClassName.CombinePlacement,i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){if(e.type===this.manager.objectManager.ClassName.Placement)if(this.isObjectShouldCombine(e))this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null;else if(this.isObjectOnlyContainStyleTagProp(e)){if(this.onlyContainStyleTagCombineObjectMap[e.resource.id]||(this.onlyContainStyleTagCombineObjectMap[e.resource.id]={}),!this.onlyContainStyleTagCombineObjectMap[e.resource.id][e.properties[this.styleTagKey]]){var t=this.createCombineObject(e.resource);t.properties={},t.properties[this.styleTagKey]=e.properties[this.styleTagKey],this.onlyContainStyleTagCombineObjectMap[e.resource.id][e.properties[this.styleTagKey]]=t}this.onlyContainStyleTagCombineObjectMap[e.resource.id][e.properties[this.styleTagKey]].addObject(e),e.parent=null}}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}}]),t}(xo),To=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._combineObjectClass=i.manager.objectManager.ClassName.CombineDoorOrWindow,i.onlyContainStyleTagCombineObjectMap={},i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._combineObjectClass=null}},{key:"parse",value:function(e){if("DoorOrWindow"===e.type)if(this.isObjectShouldCombine(e))this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null;else if(this.isObjectOnlyContainStyleTagProp(e)){if(this.onlyContainStyleTagCombineObjectMap[e.resource.id]||(this.onlyContainStyleTagCombineObjectMap[e.resource.id]={}),!this.onlyContainStyleTagCombineObjectMap[e.resource.id][e.properties[this.styleTagKey]]){var t=this.createCombineObject(e.resource);t.properties={},t.properties[this.styleTagKey]=e.properties[this.styleTagKey],this.onlyContainStyleTagCombineObjectMap[e.resource.id][e.properties[this.styleTagKey]]=t}this.onlyContainStyleTagCombineObjectMap[e.resource.id][e.properties[this.styleTagKey]].addObject(e),e.parent=null}}}]),t}(wo),Mo=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineFloorMaps={},i.combineCeilingMaps={},i.combineRoofMaps={},i.combineObjectMaps={Floor:i.combineFloorMaps,Ceiling:i.combineCeilingMaps,Roof:i.combineRoofMaps},i.typeToCombineObjectType={Floor:"CombineFloor",Ceiling:"CombineCeiling",Roof:"CombineRoof"},i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineFloorMaps=null,this.combineCeilingMaps=null,this.combineRoofMaps=null,this.combineObjectMaps=null,this.typeToCombineObjectType=null}},{key:"createCombineObject",value:function(e,t,i){var r=this.manager.objectManager.create({type:this.typeToCombineObjectType[e]});return r.parent=this.parent,r.resource=t,r.height=i,r}},{key:"parse",value:function(e){this.isObjectShouldCombine(e)&&(e.ceiling&&e.ceiling.visible&&this._addCombineObject(e.ceiling),e.roof&&e.roof.visible&&this._addCombineObject(e.roof),e.floor.visible&&this._addCombineObject(e.floor),e.parent=null)}},{key:"_addCombineObject",value:function(e){var t=e.type,i=e.height,r=e.resource,n=this.combineObjectMaps[t];n[r.id]?n[r.id].has(i)||n[r.id].set(i,this.createCombineObject(t,r,i)):(n[r.id]=new Map,n[r.id].set(i,this.createCombineObject(t,r,i))),n[r.id].get(i).addObject(e)}}]),t}(xo),Co=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i._CombineObjectClass=i.manager.objectManager.ClassName.CombineModelWall,i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){e.visible&&(this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e)),e.parent=null}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._CombineObjectClass});return t.resource=e,t.parent=this.parent,t}}]),t}(xo),So=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._combineObjectClass=i.manager.objectManager.ClassName.CombinePlacementGroup,i.combinePlacementGroup=null,i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){e.type===this.manager.objectManager.ClassName.PlacementGroup&&this.isObjectShouldCombine(e)&&(null===this.combinePlacementGroup&&(this.combinePlacementGroup=this.createCombineObject()),this.combinePlacementGroup.addObject(e),e.parent=null)}},{key:"createCombineObject",value:function(){var e=this.manager.objectManager.create({type:this._combineObjectClass});return e.parent=this.parent,e}}]),t}(xo),jo=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i._combineObjectClass=i.manager.objectManager.ClassName.CombinePlacementWall,i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}}]),t}(xo),Po={StraightManualWall:Eo,WallCorner:xo,DoorOrWindow:To,Placement:wo,Room:Mo,ModelWall:Co,PlacementGroup:So,PlacementWall:jo},Ro=function(e){function t(e){Zn(this,t);var i=eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combiners={},i}return $n(t,e),Qn(t,[{key:"_initParams",value:function(){Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combiners=null}},{key:"parse",value:function(){for(var e=this.object.children.slice(),t=0;t<e.length;t++){var i=e[t];this.initCombiner(i)}this.removeCorners()}},{key:"initCombiner",value:function(e){if(!this.combiners[e.type]){var t=Po[e.type];if(t){var i=new t({manager:this.manager});i.parent=this.object,this.combiners[e.type]=i}}this.combiners[e.type]&&this.combiners[e.type].parse(e)}},{key:"removeCorners",value:function(){var e=this.object.typeToChildren.WallCorner;if(e){e=e.slice();for(var t=0;t<e.length;t++)e[t].parent=null}}},{key:"clear",value:function(){for(var e in this.combiners)this.combiners[e].clear();Kn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(yo),Do=function(e){function t(e){return Zn(this,t),eo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return $n(t,e),t}(Ro),Ao={World:bo,Building:_o,FloorPlan:Ro,Outdoors:Do},ko=function(){function e(){Zn(this,e),this.objectManager=null,this.parserConfig=Ao,this.rootParser=null}return Qn(e,[{key:"parse",value:function(e){new(0,this.parserConfig[e.type])({object:e,manager:this}).parse()}},{key:"clear",value:function(){this.rootParser&&this.rootParser.clear(),this.rootParser=null,this.objectManager=null,this.parserConfig=null}}]),e}(),Oo=new(function(){function e(t){Zn(this,e),this._versionMap={0:{0:vo,3:ko}},this._smallVersionLibs=[[0,3]],this._bigVersions=[0]}return Qn(e,[{key:"getCombinerManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1],r=i[i.length-1];return new this._versionMap[this._bigVersions.length-1][r]}if(null==t){var n=this._smallVersionLibs[e],o=n[n.length-1];return new this._versionMap[e][o]}var s=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1])){var a=s[s.length-1];return t>a||!this._versionMap[e][t]?new this._versionMap[e][a]:new this._versionMap[e][t]}console.error("ubuildercombiner not support version "+e+"."+t)}}]),e}()),Bo=function(){function e(t){Zn(this,e),this.objectManager=t.objectManager}return Qn(e,[{key:"parse",value:function(e){var t=Oo.getCombinerManager(e.bigVersion,e.smallVersion);return t.objectManager=this.objectManager,t.parse(e)}},{key:"getCombineManager",value:function(e,t){var i=Oo.getCombinerManager(e,t);return i.objectManager=this.objectManager,i}},{key:"clear",value:function(){}}]),e}(),Fo=function(){function e(t){p(this,e),this.sceneJson=null,this.world=null;var i=new ii,r=new Si;i.meshBuilderManager=Nn.create(),i.calculaterManager=$r.create(),r.modelCombineBuilder=Yn,this.loader=new Se({objectManager:i,resourceManager:r,defaultSetting:mt,defaultResource:yt}),this.dynamicBuildManager=new Ze(this),this.combineManager=new Bo({objectManager:i}),this.resourceManager=r,this.enableRequestWorld=!0}return d(e,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"delayLoad",value:function(e){var t=this;return new Promise((function(i,r){t.loadSceneJson(e).then((function(){t.world=t.loader.load({json:t.sceneJson,version:0}),t.combineParser.parseWorld(t.world),g.compatibilityProcessWorld(t.world),t.dynamicBuildManager.world=t.world,t.dynamicBuildManager.requestToBuild(t.world.id),t.dynamicBuildManager.build((function(e){1===e&&i(t.world)}))}))}))}},{key:"loadResources",value:function(){var e=this;return new Promise((function(t,i){e.resourceManager.downloadResourcesWithQueue((function(){t(e.world)}))}))}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"load",value:function(e){var t=this;return new Promise((function(i,r){t.loadSceneJson(e).then((function(){t.world=t.loader.load({json:t.sceneJson,version:2}),t.combineManager.parse(t.world),t.dynamicBuildManager.world=t.world,t.enableRequestWorld&&t.requestToBuild(t.world.id),i(t.world)}))}))}},{key:"loadSceneJson",value:function(e){var t=this;return new Promise((function(i,r){e.jsonData?(t.sceneJson=e.jsonData,i(t.sceneJson)):e.url?(new THREE.FileLoader).load(e.url,(function(e){t.sceneJson=JSON.parse(e),i()}),(function(){}),(function(e){r("can not load "+t.sceneURL)})):r("load scene json error")}))}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),Lo=function(){function e(t){p(this,e),this.sceneJson=null,this.world=null;var i=new ii,r=new Si;i.meshBuilderManager=Nn.create(),i.calculaterManager=$r.create(),r.modelCombineBuilder=Yn,this.dynamicBuildManager=new Ze(this),this.loader=new Se({objectManager:i,resourceManager:r,defaultSetting:mt,defaultResource:yt}),this.combineManager=new Bo({objectManager:i}),this.resourceManager=r,this.enableRequestWorld=!0}return d(e,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"loadSceneJson",value:function(e){var t=this;return new Promise((function(i,r){e.json?(t.sceneJson=e.json,i(t.sceneJson)):e.url?(new THREE.FileLoader).load(e.url,(function(e){t.sceneJson=JSON.parse(e),i()}),(function(){}),(function(e){r("can not load "+t.sceneURL)})):r("load scene json error")}))}},{key:"loadResources",value:function(){var e=this;return new Promise((function(t,i){e.dynamicBuildManager.build((function(i){1===i&&t(e.world)}))}))}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"load",value:function(e){var t=this;return new Promise((function(i,r){t.loadSceneJson(e).then((function(){t.world=t.loader.load({json:t.sceneJson,version:2}),t.combineManager.parse(t.world),t.dynamicBuildManager.world=t.world,t.enableRequestWorld&&t.requestToBuild(t.world.id),i(t.world)}))}))}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),Io=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},No=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Uo=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},zo=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Ho=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},Vo=function(){function e(t){Io(this,e),this.object=t.object,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.mesh=null,this._boxMesh=null}return No(e,[{key:"build",value:function(){this._createMesh()}},{key:"_createMesh",value:function(){if(this.object.resource){var e=this.object.resource;e.isTestModel?this.object.mesh=e.model.clone():this.object.nodeName?this.createMeshByNode():this.createMeshByModelClone()}else null===this.object.mesh&&(this.object.mesh=new THREE.Object3D)}},{key:"createMeshByNode",value:function(){var e=this.object.resource.model.getObjectByName(this.object.nodeName);if(e){if(e=e.clone(),this._setTransformation(this.object,e),this.object.children.length>0)for(var t=e.children.length-1;t>-1;t--){var i=e.children[t];e.remove(i)}this.object.mesh=e}else console.warn("can not find node "+this.object.nodeName),this.object.mesh=new THREE.Object3D}},{key:"_setTransformation",value:function(e,t){var i=t.position.toArray(),r=t.scale.toArray(),n=t.quaternion.toArray();if(!this._isArrayEqual(e.position,i))if(0===e.position[0]&&0===e.position[1]&&0===e.position[2])this.object.position=i;else{var o=this.object.position;t.position.set(o[0],o[1],o[2])}if(!this._isArrayEqual(e.scale,r))if(1===e.scale[0]&&1===e.scale[1]&&1===e.scale[2])this.object.scale=r;else{var s=this.object.scale;t.scale.set(s[0],s[1],s[2])}this._isArrayEqual(e.rotation,n)||(0===e.rotation[0]&&0===e.rotation[1]&&0===e.rotation[2]&&1===e.rotation[3]?this.object.rotation=n:t.quaternion.set(n[0],n[1],n[2],n[3]))}},{key:"_isArrayEqual",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=t[i];if(void 0===n)return!1;if(r!==n)return!1}return!0}},{key:"createMeshByModelClone",value:function(){var e=this.object.resource.model.clone(),t=this.object.position,i=this.object.scale,r=this.object.rotation;e.position.set(t[0],t[1],t[2]),e.quaternion.set(r[0],r[1],r[2],r[3]),e.scale.set(i[0],i[1],i[2]),this.object.mesh=e,this.object.mesh.name=this.object.type+this.object.id}},{key:"createBoxMesh",value:function(){if(null===this._boxMesh){var e=new THREE.BoxBufferGeometry(1,1,1),t=new THREE.MeshBasicMaterial,i=new THREE.Mesh(e,t),r=this.object.size;i.scale.set(this.object.size[0],this.object.size[1],this.object.size[2]),i.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]),i.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),i.position.y=(this.object.position[1]+r[1])/2,this._boxMesh=i}return this._boxMesh}},{key:"notifyBuildCompleteListeners",value:function(){for(var e=0;e<this.buildCompleteCallbacks.length;e++)(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}},{key:"checkResourceReady",value:function(){if(this.object.resources){for(var e=0;e<this.object.resources.length;e++)if(!this.object.resources[e].ready)return!1;return!0}return!this.object.resource||!!this.object.resource.ready}},{key:"initResource",value:function(){if(this.object.resources)for(var e=0;e<this.object.resources.length;e++){var t=this.object.resources[e];this.requestResource(t)}else this.requestResource(this.object.resource)}},{key:"requestResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"resourceCallback",value:function(e){this.build()}},{key:"_dispose",value:function(e){if(e instanceof THREE.Mesh){var t=e;if(t){var i=t.material,r=t.geometry;t.isDestory=!0,i&&(this._disposeMaterial(i),t.material=null),r&&(r.isDestory=!0,r.dispose(),t.geometry=null)}}if(e)for(var n=e.children,o=0;o<n.length;o++){var s=n[o];this._dispose(s)}}},{key:"_disposeMaterial",value:function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var i=e[t];this._disposeMaterial(i)}else e.isDestory=!0,e.dispose()}},{key:"clear",value:function(e){e&&(e.parent&&e.parent.remove(e),this._dispose(e)),this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.mesh=null,this._boxMesh=null}}]),e}(),Wo=function(e){function t(e){Io(this,t);var i=Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.isRegisterObjectBuildCallback=!1,i}return zo(t,e),No(t,[{key:"_createMesh",value:function(){Uo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this)}},{key:"buildCallback",value:function(e,t){var i=t.builder;i.applyRotationToChildren(),i.object.mesh.quaternion.set(0,0,0,1);for(var r=0;r<e.children.length;r++)e.children[r].meshBuilder.applyRotationToChildren()}}]),t}(Vo),Go=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),t}(Vo),qo=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),t}(Vo),Xo=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),t}(Vo),Jo=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),No(t,[{key:"createMeshByNode",value:function(){var e=this.object.resource.model.getObjectByName(this.object.nodeName);e?(e=e.clone(),this.object.position=e.position.toArray(),this.object.scale=e.scale.toArray(),this.object.rotation=e.quaternion.toArray(),this.object.mesh=e):(console.warn("can not find node "+this.object.nodeName),this.object.mesh=new THREE.Object3D)}},{key:"_createMesh",value:function(){Uo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this);var e=new THREE.Object3D;e.name="floorMax",e.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),e.scale.set(this.object.scale[0],this.object.scale[1],this.object.scale[2]),e.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]);var i=this.object.mesh;i.position.set(0,0,0),i.scale.set(1,1,1),i.quaternion.set(0,0,0,1),e.add(i);var r=i.position.clone();r.applyQuaternion(e.quaternion),i.position.copy(r),i.quaternion.premultiply(e.quaternion),this.object.rotation=[0,0,0,1],e.quaternion.set(0,0,0,1),this.object.mesh=e,this.object.floor&&(this.object.floor.mesh=i),this.object.roof&&(this.object.roof.mesh=new THREE.Object3D),this.object.ceiling&&(this.object.ceiling.mesh=new THREE.Object3D)}}]),t}(Vo),Yo=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),t}(Vo),Zo=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),t}(Vo),Qo=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),t}(Vo),Ko=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),t}(Vo),$o=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),t}(Vo),es=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),t}(Vo),ts=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),No(t,[{key:"_createMesh",value:function(){this.object.mesh=new THREE.Object3D}}]),t}(Vo),is=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),No(t,[{key:"_createMesh",value:function(){this.object.mesh=new THREE.Object3D}}]),t}(Vo),rs=function(){function e(t){Io(this,e),this._map={Empty:is,Building:Wo,World:Go,FloorPlan:es,Outdoors:Xo,Room:Jo,Floor:qo,Placement:Yo,Facade:Ko,DoorOrWindow:$o,CombinePlacement:Zo,CombinePlacementByBatch:ts,CombineModelWall:Qo}}return No(e,[{key:"getClass",value:function(e){return this._map[e]}},{key:"setClass",value:function(e,t){this._map[e]=t}}]),e}(),ns=function(){function e(t){Io(this,e),this.builderTypeConfig=new rs}return No(e,[{key:"create",value:function(e){var t=e.type,i=this.builderTypeConfig.getClass(t);return i?new i(e):null}},{key:"registerMeshBuilder",value:function(e,t){this.builderTypeConfig.setClass(e,t)}},{key:"containMeshBuilderClass",value:function(e){return!!this.builderTypeConfig[e]}},{key:"getMeshBuilderClass",value:function(e){return this.builderTypeConfig.getClass(e)}},{key:"getEmptyMeshBuilderClass",value:function(){return this.builderTypeConfig.getClass("Empty")}}]),e}(),os=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),No(t,[{key:"createMeshByNode",value:function(){var e=this.object.resource.model.getObjectByName(this.object.nodeName);e?(e=e.clone(),this.object.position=e.position.toArray(),this.object.scale=e.scale.toArray(),this.object.rotation=e.quaternion.toArray(),this.object.mesh=e):(console.warn("can not find node "+this.object.nodeName),this.object.mesh=new THREE.Object3D)}},{key:"_createMesh",value:function(){Uo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this);var e=new THREE.Object3D;e.name="floorMax",e.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),e.scale.set(this.object.scale[0],this.object.scale[1],this.object.scale[2]),e.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]);var i=this.object.mesh;i.position.set(0,0,0),i.scale.set(1,1,1),i.quaternion.set(0,0,0,1),e.add(i);var r=i.position.clone();if(r.applyQuaternion(e.quaternion),i.position.copy(r),i.quaternion.premultiply(e.quaternion),this.object.rotation=[0,0,0,1],e.quaternion.set(0,0,0,1),this.object.mesh=e,this.object.floor.mesh=i,this.object.nodeName){var n=this.object.parent;if("Outdoors"!==n.type){var o=n.height;this.object.roof.mesh=i.clone(),this.object.ceiling.mesh=i.clone(),this.object.roof.mesh.position.set(0,o,0),this.object.ceiling.mesh.position.set(0,o-.01,0),this._changeMaterialSide(this.object.roof.mesh,0),this._changeMaterialSide(this.object.ceiling.mesh,1)}}else this.object.roof.mesh=new THREE.Object3D,this.object.ceiling.mesh=new THREE.Object3D}},{key:"_changeMaterialSide",value:function(e,t){if(e.isMesh)if(e.material instanceof Array){var i=e.material.map((function(e){return e.clone()}));i.forEach((function(e){return e.side=t})),e.material=i}else e.material=e.material.clone(),e.material.side=t;for(var r=e.children,n=0;n<r.length;n++){var o=r[n];this._changeMaterialSide(o,t)}}},{key:"_setRoomPoints",value:function(e){if(e.isMesh){for(var t=[],i=e.geometry.attributes.position.array,r=0;r<i.length;r+=3)t.push(new THREE.Vector3(i[r],i[r+1],i[r+2]));this.object.points=t}for(var n=0;n<e.children.length;n++){var o=e.children[n];this._setRoomPoints(o)}}}]),t}(Vo),ss=function(e){function t(e){Io(this,t);var i=Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map.Room=os,i}return zo(t,e),No(t,[{key:"getClass",value:function(e){return this._map[e]}}]),t}(rs),as=function(e){function t(e){Io(this,t);var i=Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.builderTypeConfig=new ss,i}return zo(t,e),t}(ns),ls=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),No(t,[{key:"_createMesh",value:function(){if(this.object.resource){var e=this.object.resource;e.isTestModel?this.object.mesh=e.model.clone():this.object.nodeName&&this.createMeshByNode()}else null===this.object.mesh&&(this.object.mesh=new THREE.Object3D)}}]),t}(Vo),us=function(e){function t(e){Io(this,t);var i=Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map.CombinePlacement=ls,i}return zo(t,e),t}(ss),cs=function(e){function t(e){Io(this,t);var i=Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.builderTypeConfig=new us,i}return zo(t,e),t}(as),hs=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),No(t,[{key:"_createMesh",value:function(){if(this.object.resource){var e=this.object.resource;e.isTestModel?this.object.mesh=e.model.clone():this.object.nodeName&&this.createMeshByNode()}else null===this.object.mesh&&(this.object.mesh=new THREE.Object3D)}}]),t}(Vo),ps=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),t}(hs),ds=function(e){function t(e){return Io(this,t),Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return zo(t,e),t}(hs),fs=function(e){function t(e){Io(this,t);var i=Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map.CombineFloor=hs,i._map.CombineRoof=ds,i._map.CombineCeiling=ps,i}return zo(t,e),t}(us),ms=function(e){function t(e){Io(this,t);var i=Ho(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.builderTypeConfig=new fs,i}return zo(t,e),t}(cs),gs=new(function(){function e(t){Io(this,e),this._versionMap={0:{0:ns,1:as,2:cs,3:ms}},this._smallVersionLibs=[[0,1,2,3]],this._bigVersions=[0]}return No(e,[{key:"getManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][i.length-1]}if(null==t){var r=this._smallVersionLibs[e];return new this._versionMap[e][r.length-1]}var n=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>n[n.length-1]?new this._versionMap[e][n.length-1]:new this._versionMap[e][t];console.error("maxmeshbuilder not support version "+e+"."+t)}}]),e}()),vs=new(function(){function e(t){Io(this,e)}return No(e,[{key:"createManager",value:function(e,t){return gs.getManager(e,t)}}]),e}()),ys="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},bs=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},_s=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),xs=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},Es=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},ws=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},Ts={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},Ms=function(){function e(){bs(this,e)}return _s(e,null,[{key:"uuid",value:function(){for(var e,t=Ts.chars,i=Ts.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":ys(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}}]),e}(),Cs=function(){function e(t){bs(this,e),this.creatorManager=t.creatorManager,this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=t.jsonData,this.objectParent=null,t.parent&&(this.objectParent=t.parent),this.createType=null,this.resourceManager=t.resourceManager,this.objectManager=t.objectManager}return _s(e,[{key:"create",value:function(){var e=this._getCreateParams();if(this.object=this.creatorManager.objectManager.create(e),this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.loadMode=0,this.jsonData.node?(this.object.nodeName=this.jsonData.node,this.object.loadMode=2):void 0!==this.jsonData.model&&null!==this.jsonData.model&&(this.object.loadMode=1),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object.resource||(this.object.resource=this.resourceManager.emptyModelResource),this.object.jsonData=this.jsonData,e.parent&&(this.object.parent=e.parent),this.jsonData.position){var t=this.jsonData.position;this.object.position=t}if(this.jsonData.scale){var i=this.jsonData.scale;0===i[0]&&(i[0]=.01),0===i[1]&&(i[1]=.01),0===i[2]&&(i[2]=.01),this.object.scale=i}if(this.jsonData.rotation){var r=this.jsonData.rotation;this.object.rotation=r}if(this.jsonData.properties&&(this.object.properties=this.jsonData.properties,this.object.lowerCaseProperties=this.convertPropertiesToLowerCase(this.jsonData.properties)),Ms.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.jsonData.caminfo){var n=this.jsonData.caminfo.eye,o=this.jsonData.caminfo.target;n[2]=-n[2],o[2]=-o[2],this.object.camInfo={eye:n,target:o}}if(this.jsonData.size){var s=this.jsonData.size;this.object.size=s}else this.object.size=[1,1,1];return this.object}},{key:"convertPropertiesToLowerCase",value:function(e){var t={};for(var i in e)t[i.toLowerCase()]=e[i].toLowerCase();return t}},{key:"parseChildren",value:function(){}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,this.creatorManager.createObject(e)}}]),e}(),Ss={WORLD:0,BUILDING:1,FLOORPLAN:2,WALLCORNER:3,MODELWALL:4,STRAIGHTMANUALWALL:5,PLACEMENT:6,PLACEMENTGROUP:7,DOORORWINDOW:8,ROOM:9,OUTDOORS:10,FACADE:11,FACADEGROUP:12,CURVELINE:13,LEAKWATERLINE:14,ARROWLINE:15,ARROWDATALINE:16,PIPELINE:17,ROUTELINE:18,VIDEOPROBE:19,PLACEMENTWALL:20,PLACEMENTGROUND:21,COMBINEPLACEMENT:22,COMBINEMODELWALL:23,FLOOR:24,CEILING:25,ROOF:26,COMBINEFLOOR:27,COMBINECEILING:28,COMBINEROOF:29},js=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return Es(t,e),_s(t,[{key:"parseChildren",value:function(){var e=this.jsonData;if(e.buildings&&this._parseJsonDataChildren({jsonData:e.buildings,creatorType:Ss.BUILDING}),e.outdoors){var t=this._parseJsonDataChild({jsonData:e.outdoors,creatorType:Ss.OUTDOORS});this.object.outdoors=t}}}]),t}(Cs),Ps=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),Ms.checkValueEmpty(this.jsonData.structshow)||(this.object.structShow=this.jsonData.structshow),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.facades&&this._parseJsonDataChildren({jsonData:e.facades,creatorType:Ss.FACADE}),e.facadegroups&&this._parseJsonDataChildren({jsonData:e.facadegroups,creatorType:Ss.FACADEGROUP}),e.plans&&this._parseJsonDataChildren({jsonData:e.plans,creatorType:Ss.FLOORPLAN})}}]),t}(Cs),Rs=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),Ms.checkValueEmpty(this.jsonData.alwaysshowinsideobjs)||(this.object.alwaysShowInsideObjs=this.jsonData.alwaysshowinsideobjs),Ms.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.corners&&this._parseCorners(e.corners),e.walls&&this._parseWalls(e.walls),e.placements&&this._parseJsonDataChildren({jsonData:e.placements,creatorType:Ss.PLACEMENT}),e.combineplacements&&this._parseJsonDataChildren({jsonData:e.combineplacements,creatorType:Ss.COMBINEPLACEMENT}),e.rooms&&this._parseJsonDataChildren({jsonData:e.rooms,creatorType:Ss.ROOM}),e.groups&&this._parseJsonDataChildren({jsonData:e.groups,creatorType:Ss.PLACEMENTGROUP}),e.curvelines&&this._parseJsonDataChildren({jsonData:e.curvelines,creatorType:Ss.CURVELINE}),e.routelines&&this._parseJsonDataChildren({jsonData:e.routelines,creatorType:Ss.ROUTELINE}),e.leakwaterlines&&this._parseJsonDataChildren({jsonData:e.leakwaterlines,creatorType:Ss.LEAKWATERLINE}),e.arrowlines&&this._parseJsonDataChildren({jsonData:e.arrowlines,creatorType:Ss.ARROWLINE}),e.arrowdatalines&&this._parseJsonDataChildren({jsonData:e.arrowdatalines,creatorType:Ss.ARROWDATALINE}),e.pipelines&&this._parseJsonDataChildren({jsonData:e.pipelines,creatorType:Ss.PIPELINE}),e.videoprobes&&this._parseJsonDataChildren({jsonData:e.videoprobes,creatorType:Ss.VIDEOPROBE}),e.grounds&&this._parseJsonDataChildren({jsonData:e.grounds,creatorType:Ss.PLACEMENTGROUND}),e.doororwindows&&this._parseDoorOrWindows(e.doororwindows)}},{key:"_parseCorners",value:function(e){for(var t=0;t<e.length;t++){var i=e[t],r=i[0],n=i[1],o=-i[2];this.object.existsCorner(r,n,o)?console.error("repeat corner"):this._parseJsonDataChild({jsonData:i,creatorType:Ss.WALLCORNER})}}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];this._parseJsonDataChild({jsonData:i,creatorType:Ss.COMBINEMODELWALL})}}},{key:"_parseDoorOrWindows",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i];this._parseJsonDataChild({jsonData:r,attachWall:t,creatorType:Ss.DOORORWINDOW})}}}]),t}(Cs),Ds=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ModelWall",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),Ms.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),this.object}}]),t}(Cs),As=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="StraightManualWall",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}}]),t}(Cs),ks=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Placement",i}return Es(t,e),_s(t,[{key:"create",value:function(){if(xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],Ms.checkValueEmpty(this.jsonData.texture)||(this.object.customTextureResource=this.resourceManager.textures[this.jsonData.texture]),this.jsonData.color){var e=this.jsonData.color;this.object.customColor=e,4===e.length&&(this.object.opacity=e[3])}return Ms.checkValueEmpty(this.jsonData.rendermode)||(this.object.renderMode=this.jsonData.rendermode),this.jsonData.animinfo&&(this.object.isPlayAnim=this.jsonData.animinfo.isplay,this.object.animClip=this.jsonData.animinfo.clip),Ms.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(Cs),Os=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementGroup",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.placements&&this._parseJsonDataChildren({jsonData:this.jsonData.placements,creatorType:Ss.PLACEMENT}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:Ss.PLACEMENTGROUP}),this.jsonData.videoprobes&&this._parseJsonDataChildren({jsonData:this.jsonData.videoprobes,creatorType:Ss.VIDEOPROBE}),Ms.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(Cs),Bs=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="DoorOrWindow",i}return Es(t,e),_s(t,[{key:"create",value:function(){if(xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],Ms.checkValueEmpty(this.jsonData.suspendpercent)||(this.object.suspendPercent=this.jsonData.suspendpercent),Ms.checkValueEmpty(this.jsonData.isopen)||(this.object.isOpen=this.jsonData.isopen),Ms.checkValueEmpty(this.jsonData.diridx)||(this.object.openDirIndex=this.jsonData.diridx),!Ms.checkValueEmpty(this.jsonData.iswindow)){var e=this.jsonData.iswindow;"string"==typeof e&&(e="false"!==e.toLocaleString()),this.object.isWindow=e}return this.object}}]),t}(Cs),Fs=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._createChildren(),this.object}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:Ss.FLOOR}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:Ss.CEILING}),this._parseJsonDataChild({jsonData:{},creatorType:Ss.ROOF}))}}]),t}(Cs),Ls=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return Es(t,e),t}(Rs),Is=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Facade",i}return Es(t,e),t}(ks),Ns=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FacadeGroup",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.facades&&this._parseJsonDataChildren({jsonData:this.jsonData.facades,creatorType:Ss.FACADE}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:Ss.FACADEGROUP}),this.object}}]),t}(Cs),Us=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombinePlacement",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(Cs),zs=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineModelWall",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(Cs),Hs=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Floor",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(Cs),Vs=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Ceiling",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(Cs),Ws=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Roof",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(Cs),Gs=function(){function e(t){bs(this,e),this._map={0:js,1:Ps,2:Rs,4:Ds,5:As,6:ks,7:Os,8:Bs,9:Fs,10:Ls,11:Is,12:Ns,22:Us,23:zs,24:Hs,25:Vs,26:Ws}}return _s(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),qs=function(){function e(t){bs(this,e),this.config=new Gs,this.objectManager=null}return _s(e,[{key:"createObject",value:function(e){var t=this.config.getClass(e.creatorType);e.objectManager=this.objectManager,e.creatorManager=this;var i=new t(e),r=i.create(),n=!0;return void 0!==e.enableCreateChildren&&null!==e.enableCreateChildren&&(n=e.enableCreateChildren),n&&i.parseChildren(),r}}]),e}(),Xs=function(){function e(t){bs(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl}return _s(e,[{key:"createResource",value:function(e){var t=this.manager.create({type:e});return t.manager=this.manager,t}},{key:"loadTextures",value:function(e){}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource("LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource("Resource");return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];if((t=this.createResource("Max2TjsResource")).baseUrl=this.baseModelUrl,r.localurl){if(t.localUrl=r.localurl,t.id=r.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,r.title&&(t.modelName=r.title),t.modelID=r.id,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.color){var n=r.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}}else if(r.id){if(t.id=r.id,t.modelID=r.id,t.version=r.version,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.model&&(t.modelID=r.model),r.title&&(t.modelName=r.title),r.color&&(n=r.color,t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])),r.size){var o=r.size;t.modelSize=new THREE.Vector3(o[0],o[1],o[2])}r.hasanimation&&(t.hasAnim=r.hasanimation),r.url&&(t.url=r.url)}for(var s=0;s<this.manager.ableToSupportFootAndHeadModelWalls.length;s++){var a=this.manager.ableToSupportFootAndHeadModelWalls[s];if(t.id===a){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var i=e.color;t.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(t.opacity=i[3])}if(e.size){var r=e.size;t.modelSize=new THREE.Vector3(r[0],r[1],r[2])}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),Js=function(){function e(){bs(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorManager=new qs}return _s(e,[{key:"setObjectTypeConfig",value:function(e){objectManager.objectTypeConfig=e}},{key:"setObjectManager",value:function(e){this.creatorManager.objectManager=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"parseObjects",value:function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),t.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++)i+=t[r]+"/";return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,i){e.sceneJson?t(e.sceneJson):e.sceneURL?(new THREE.FileLoader).load(e.sceneURL,(function(i){e.sceneJson=JSON.parse(i),t()}),(function(){}),(function(t){i("can not load "+e.sceneURL)})):i("load scene json error")}))}},{key:"getResourceLoader",value:function(){var e=new Xs(this.resourceManager);return e.resourceManager=this.resourceManager,e}},{key:"parseSceneJson",value:function(){this.parseResources(this.sceneJson,this.resourceManager),this.parseWorld(this.sceneJson)}},{key:"parseResources",value:function(e,t){var i=new Xs(t);i.loadTextures(e.textures),i.loadModels(e.models)}},{key:"parseWorld",value:function(e){this.world=this.creatorManager.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:Ss.WORLD})}},{key:"getCreatorManager",value:function(){return this.creatorManager}}]),e}(),Ys=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),Ms.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),this.object}}]),t}(Rs),Zs=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map[Ss.FLOORPLAN]=Ys,i}return Es(t,e),t}(Gs),Qs=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.config=new Zs,i}return Es(t,e),t}(qs),Ks=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.creatorManager=new Qs,i.creatorTypeConfig=new Zs,i}return Es(t,e),t}(Js),$s=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineFloor",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object.position=[0,0,0],this.object.rotation=[0,0,0,1],this.object}}]),t}(Cs),ea=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineCeiling",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object.position=[0,0,0],this.object.rotation=[0,0,0,1],this.object}}]),t}(Cs),ta=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineRoof",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object.position=[0,0,0],this.object.rotation=[0,0,0,1],this.object}}]),t}(Cs),ia=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return Es(t,e),_s(t,[{key:"create",value:function(){return xs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.combinefloors&&this._parseJsonDataChildren({jsonData:this.jsonData.combinefloors,creatorType:Ss.COMBINEFLOOR}),this.jsonData.combineroofs&&this._parseJsonDataChildren({jsonData:this.jsonData.combineroofs,creatorType:Ss.COMBINEROOF}),this.jsonData.combineceilings&&this._parseJsonDataChildren({jsonData:this.jsonData.combineceilings,creatorType:Ss.COMBINECEILING}),this.object}}]),t}(Ys),ra=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return Es(t,e),t}(ia),na=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map[Ss.COMBINEFLOOR]=$s,i._map[Ss.COMBINECEILING]=ea,i._map[Ss.COMBINEROOF]=ta,i._map[Ss.FLOORPLAN]=ia,i._map[Ss.OUTDOORS]=ra,i}return Es(t,e),t}(Zs),oa=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.config=new na,i}return Es(t,e),t}(Qs),sa=function(e){function t(e){return bs(this,t),ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Es(t,e),_s(t,[{key:"loadModels",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];if((t=r.keeprootrotation?this.createResource("Max2TjsKeepRootRotationResource"):this.createResource("Max2TjsResource")).baseUrl=this.baseModelUrl,r.localurl){if(t.localUrl=r.localurl,t.id=r.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,r.title&&(t.modelName=r.title),t.modelID=r.id,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.color){var n=r.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}}else if(r.id){if(t.id=r.id,t.modelID=r.id,t.version=r.version,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.model&&(t.modelID=r.model),r.title&&(t.modelName=r.title),r.color&&(n=r.color,t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])),r.size){var o=r.size;t.modelSize=new THREE.Vector3(o[0],o[1],o[2])}r.hasanimation&&(t.hasAnim=r.hasanimation),r.url&&(t.url=r.url)}for(var s=0;s<this.manager.ableToSupportFootAndHeadModelWalls.length;s++){var a=this.manager.ableToSupportFootAndHeadModelWalls[s];if(t.id===a){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}}]),t}(Xs),aa=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.creatorManager=new oa,i.creatorTypeConfig=new na,i}return Es(t,e),_s(t,[{key:"parseResources",value:function(e,t){var i=new sa(t);i.loadTextures(e.textures),i.loadModels(e.models)}}]),t}(Ks),la=function(e){function t(e){return bs(this,t),ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Es(t,e),_s(t,[{key:"parseChildren",value:function(){var e=this.jsonData;e.placements&&this._parseJsonDataChildren({jsonData:e.placements,creatorType:Ss.PLACEMENT}),e.combineplacements&&this._parseJsonDataChildren({jsonData:e.combineplacements,creatorType:Ss.COMBINEPLACEMENT}),e.groups&&this._parseJsonDataChildren({jsonData:e.groups,creatorType:Ss.PLACEMENTGROUP}),e.videoprobes&&this._parseJsonDataChildren({jsonData:e.videoprobes,creatorType:Ss.VIDEOPROBE})}}]),t}(Fs),ua=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map[Ss.ROOM]=la,i}return Es(t,e),t}(na),ca=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.config=new ua,i}return Es(t,e),t}(oa),ha=function(e){function t(e){bs(this,t);var i=ws(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.creatorManager=new ca,i.creatorTypeConfig=new ua,i}return Es(t,e),t}(aa),pa=new(function(){function e(t){bs(this,e),this._versionMap={0:{0:Js,1:Ks,2:Ks,3:aa,4:ha}},this._smallVersionLibs=[[0,1,3,4]],this._bigVersions=[0]}return _s(e,[{key:"getLoaderManager",value:function(e,t){if(null==e){e=this._bigVersions[this._bigVersions.length-1];var i=this._smallVersionLibs[e];return t=i[i.length-1],new this._versionMap[e][t]}if(null==t){var r=this._smallVersionLibs[e];return t=r[r.length-1],new this._versionMap[e][t]}var n=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>n[n.length-1]?new this._versionMap[e][n.length-1]:new this._versionMap[e][t];console.error("maxLoader not support version "+e+"."+t)}}]),e}()),da=function(){function e(t){bs(this,e),this.resourceManager=t.resourceManager,this.defaultSetting=t.defaultSetting,this.defaultResource=t.defaultResource,this.objectManager=t.objectManager}return _s(e,[{key:"load",value:function(e){return this.getLoaderManager(e.bigVersion,e.smallVersion).parseObjects(e)}},{key:"getLoaderManager",value:function(e,t){var i=pa.getLoaderManager(e,t);return i.setDefaultSetting(this.defaultSetting),i.setDefaultResource(this.defaultResource),i.setResourceManager(this.resourceManager),i.setObjectManager(this.objectManager),i}}]),e}();mt.enableCombinePlacementsByRoom=!1,mt.enableCombinePlacementToBuildMesh=!0;var fa="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},ma=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ga=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),va=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},ya=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},ba=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},_a=function(){function e(t){ma(this,e),this._initParams(),this.object=t.object,this.manager=t.manager}return ga(e,[{key:"_initParams",value:function(){this.object=null,this.manager=null}},{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var i=e[t],r=this.manager.parserConfig[i.type];r&&new r({object:i,manager:this.manager}).parse()}}},{key:"clear",value:function(){this._initParams()}}]),e}(),xa=function(e){function t(e){return ma(this,t),ba(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ya(t,e),t}(_a),Ea=function(e){function t(e){return ma(this,t),ba(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ya(t,e),t}(_a),wa=function(){function e(t){ma(this,e),this._initParams(),this.manager=t.manager,this.parent=null}return ga(e,[{key:"_initParams",value:function(){this.parent=null,this.manager=null}},{key:"parse",value:function(){}},{key:"isNullOrUndefined",value:function(e){return null==e}}]),e}(),Ta=function(e){function t(e){ma(this,t);var i=ba(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i._combineObjectClass="BatchCombinePlacement",i}return ya(t,e),ga(t,[{key:"_initParams",value:function(){va(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){if(e.type===this.manager.objectManager.ClassName.CombinePlacement&&this.isObjectShouldCombine(e)){this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource));var t=this.combineObjectMaps[e.resource.id];this._addPropertiesToCombinePlacement(e.properties,t),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null}}},{key:"_addPropertiesToCombinePlacement",value:function(e,t){for(var i in t.properties||(t.properties={}),e)t.properties[i]=e[i]}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}},{key:"isObjectShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.nodeName)}}]),t}(wa),Ma=function(e){function t(e){ma(this,t);var i=ba(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combineObjectMaps={},i._combineObjectClass="BatchPlacement",i}return ya(t,e),ga(t,[{key:"_initParams",value:function(){va(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){if(e.type===this.manager.objectManager.ClassName.Placement&&this.isObjectShouldCombine(e)){this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource));var t=this.combineObjectMaps[e.resource.id];this._addPropertiesToCombinePlacement(e.properties,t),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null}}},{key:"_addPropertiesToCombinePlacement",value:function(e,t){for(var i in t.properties||(t.properties={}),e)t.properties[i]=e[i]}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}},{key:"isObjectShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.nodeName)}}]),t}(wa),Ca={WallCorner:wa,CombinePlacement:Ta,Placement:Ma},Sa={WallCorner:wa,CombinePlacement:Ta},ja=new(function(){function e(t){ma(this,e),this.enableBatchPlacement=!0}return ga(e,[{key:"getCombiner",value:function(e){return this.enableBatchPlacement?Ca[e]:Sa[e]}}]),e}()),Pa=function(e){function t(e){ma(this,t);var i=ba(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.combiners={},i}return ya(t,e),ga(t,[{key:"_initParams",value:function(){va(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combiners=null}},{key:"parse",value:function(){for(var e=this.object.children.slice(),t=0;t<e.length;t++){var i=e[t];this.initCombiner(i)}this.removeCorners()}},{key:"initCombiner",value:function(e){if(!this.combiners[e.type]){var t=ja.getCombiner(e.type);if(t){var i=new t({manager:this.manager});i.parent=this.object,this.combiners[e.type]=i}}this.combiners[e.type]&&this.combiners[e.type].parse(e)}},{key:"removeCorners",value:function(){var e=this.object.typeToChildren.WallCorner;if(e){e=e.slice();for(var t=0;t<e.length;t++)e[t].parent=null}}},{key:"clear",value:function(){for(var e in this.combiners)this.combiners[e].clear();va(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(_a),Ra=function(e){function t(e){return ma(this,t),ba(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ya(t,e),t}(Pa),Da={World:xa,Building:Ea,FloorPlan:Pa,Outdoors:Ra},Aa={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),r=0;return function(){for(var n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Aa.DEG2RAD},radToDeg:function(e){return e*Aa.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},ka=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Oa=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Ba=function(){function e(t,i,r,n){ka(this,e),this._x=t||0,this._y=i||0,this._z=r||0,this._w=void 0!==n?n:1}return Oa(e,[{key:"slerp",value:function(e,t,i,r){return i.copy(e).slerp(t,r)}},{key:"slerpFlat",value:function(e,t,i,r,n,o,s){var a=i[r+0],l=i[r+1],u=i[r+2],c=i[r+3],h=n[o+0],p=n[o+1],d=n[o+2],f=n[o+3];if(c!==f||a!==h||l!==p||u!==d){var m=1-s,g=a*h+l*p+u*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,s=Math.sin(s*_)/b}var x=s*v;if(a=a*m+h*x,l=l*m+p*x,u=u*m+d*x,c=c*m+f*x,m===1-s){var E=1/Math.sqrt(a*a+l*l+u*u+c*c);a*=E,l*=E,u*=E,c*=E}}e[t]=a,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"set",value:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,r=e._y,n=e._z,o=e.order,s=Math.cos,a=Math.sin,l=s(i/2),u=s(r/2),c=s(n/2),h=a(i/2),p=a(r/2),d=a(n/2);return"XYZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"YXZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"ZXY"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"ZYX"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"YZX"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c-h*p*d):"XZY"===o&&(this._x=h*u*c-l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c+h*p*d),!1!==t&&this.onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this.onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],s=i[1],a=i[5],l=i[9],u=i[2],c=i[6],h=i[10],p=r+a+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(s-n)*t):r>a&&r>h?(t=2*Math.sqrt(1+r-a-h),this._w=(c-l)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(o+u)/t):a>h?(t=2*Math.sqrt(1+a-r-h),this._w=(o-u)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-r-a),this._w=(s-n)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var i,r=new Fa,n=1e-6;return void 0===r&&(r=new Fa),(i=e.dot(t)+1)<n?(i=0,Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0):r.set(0,-e.z,e.y)):r.crossVectors(e,t),this._x=r.x,this._y=r.y,this._z=r.z,this._w=i,this.normalize()}},{key:"inverse",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,s=t._x,a=t._y,l=t._z,u=t._w;return this._x=i*u+o*s+r*l-n*a,this._y=r*u+o*a+n*s-i*l,this._z=n*u+o*l+i*a-r*s,this._w=o*u-i*s-r*a-n*l,this.onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,s=o*e._w+i*e._x+r*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(r+this._y),this._z=.5*(n+this._z),this;var l=Math.atan2(a,s),u=Math.sin((1-t)*l)/a,c=Math.sin(t*l)/a;return this._w=o*u+this._w*c,this._x=i*u+this._x*c,this._y=r*u+this._y*c,this._z=n*u+this._z*c,this.onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"onChange",value:function(e){return this.onChangeCallback=e,this}},{key:"onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}]),e}(),Fa=function(){function e(t,i,r){ka(this,e),this.x=t||0,this.y=i||0,this.z=r||0,this.isVector3=!0}return Oa(e,[{key:"set",value:function(e,t,i){return this.x=e,this.y=t,this.z=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(){var e=new Ba;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}()}},{key:"applyAxisAngle",value:function(){var e=new Ba;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i))}()}},{key:"applyMatrix3",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}},{key:"applyQuaternion",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*i,u=a*i+s*t-n*r,c=a*r+n*i-o*t,h=-n*t-o*i-s*r;return this.x=l*a+h*-n+u*-s-c*-o,this.y=u*a+h*-o+c*-n-l*-s,this.z=c*a+h*-s+l*-o-u*-n,this}},{key:"transformDirection",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(){var t=new e,i=new e;return function(e,r){return t.set(e,e,e),i.set(r,r,r),this.clamp(t,i)}()}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-i*e.z,this.z=i*e.y-r*e.x,this}},{key:"crossVectors",value:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this}},{key:"projectOnVector",value:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)}},{key:"projectOnPlane",value:function(){var t=new e;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}},{key:"reflect",value:function(){var t=new e;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}()}},{key:"angleTo",value:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Aa.clamp(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this}},{key:"setFromCylindrical",value:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}]),e}(),La=function(){function e(t,i){ka(this,e),this.isBox3=!0,this.min=void 0!==t?t:new Fa(1/0,1/0,1/0),this.max=void 0!==i?i:new Fa(-1/0,-1/0,-1/0)}return Oa(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,l=e.length;a<l;a+=3){var u=e[a],c=e[a+1],h=e[a+2];u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,i,r),this.max.set(n,o,s),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,l=e.count;a<l;a++){var u=e.getX(a),c=e.getY(a),h=e.getZ(a);u<t&&(t=u),c<i&&(i=c),h<r&&(r=h),u>n&&(n=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,i,r),this.max.set(n,o,s),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var i=(new Fa).copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){var t=e||new Fa;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){var t=e||new Fa;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=new Fa,i=this;return e.updateMatrixWorld(!0),e.traverse((function(e){var r,n,o=e.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(r=0,n=s.length;r<n;r++)t.copy(s[r]),t.applyMatrix4(e.matrixWorld),i.expandByPoint(t)}else if(o.isBufferGeometry){var a=o.attributes.position;if(void 0!==a)for(r=0,n=a.count;r<n;r++)t.fromBufferAttribute(a,r).applyMatrix4(e.matrixWorld),i.expandByPoint(t)}})),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return(t||new Fa).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsPlane",value:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=e.constant&&i>=e.constant}},{key:"clampPoint",value:function(e,t){return(t||new Fa).copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return(new Fa).copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){var t=[new Fa,new Fa,new Fa,new Fa,new Fa,new Fa,new Fa,new Fa];return this.isEmpty()||(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();function Ia(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Ia.prototype,{isMatrix4:!0,set:function(e,t,i,r,n,o,s,a,l,u,c,h,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Ia).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(){var e=new Fa;return function(t){var i=this.elements,r=t.elements,n=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),s=1/e.setFromMatrixColumn(t,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[4]=r[4]*o,i[5]=r[5]*o,i[6]=r[6]*o,i[8]=r[8]*s,i[9]=r[9]*s,i[10]=r[10]*s,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,o=Math.cos(i),s=Math.sin(i),a=Math.cos(r),l=Math.sin(r),u=Math.cos(n),c=Math.sin(n);if("XYZ"===e.order){var h=o*u,p=o*c,d=s*u,f=s*c;t[0]=a*u,t[4]=-a*c,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-s*a,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*a}else if("YXZ"===e.order){var m=a*u,g=a*c,v=l*u,y=l*c;t[0]=m+y*s,t[4]=v*s-g,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-s,t[2]=g*s-v,t[6]=y+m*s,t[10]=o*a}else if("ZXY"===e.order)m=a*u,g=a*c,v=l*u,y=l*c,t[0]=m-y*s,t[4]=-o*c,t[8]=v+g*s,t[1]=g+v*s,t[5]=o*u,t[9]=y-m*s,t[2]=-o*l,t[6]=s,t[10]=o*a;else if("ZYX"===e.order)h=o*u,p=o*c,d=s*u,f=s*c,t[0]=a*u,t[4]=d*l-p,t[8]=h*l+f,t[1]=a*c,t[5]=f*l+h,t[9]=p*l-d,t[2]=-l,t[6]=s*a,t[10]=o*a;else if("YZX"===e.order){var b=o*a,_=o*l,x=s*a,E=s*l;t[0]=a*u,t[4]=E-b*c,t[8]=x*c+_,t[1]=c,t[5]=o*u,t[9]=-s*u,t[2]=-l*u,t[6]=_*c+x,t[10]=b-E*c}else"XZY"===e.order&&(b=o*a,_=o*l,x=s*a,E=s*l,t[0]=a*u,t[4]=-c,t[8]=l*u,t[1]=b*c+E,t[5]=o*u,t[9]=_*c-x,t[2]=x*c-_,t[6]=s*u,t[10]=E*c+b);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e._x,r=e._y,n=e._z,o=e._w,s=i+i,a=r+r,l=n+n,u=i*s,c=i*a,h=i*l,p=r*a,d=r*l,f=n*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(p+f),t[4]=c-v,t[8]=h+g,t[1]=c+v,t[5]=1-(u+f),t[9]=d-m,t[2]=h-g,t[6]=d+m,t[10]=1-(u+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new Fa,t=new Fa,i=new Fa;return function(r,n,o){var s=this.elements;return i.subVectors(r,n),0===i.lengthSq()&&(i.z=1),i.normalize(),e.crossVectors(o,i),0===e.lengthSq()&&(1===Math.abs(o.z)?i.x+=1e-4:i.z+=1e-4,i.normalize(),e.crossVectors(o,i)),e.normalize(),t.crossVectors(i,e),s[0]=e.x,s[4]=t.x,s[8]=i.x,s[1]=e.y,s[5]=t.y,s[9]=i.y,s[2]=e.z,s[6]=t.z,s[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],u=i[1],c=i[5],h=i[9],p=i[13],d=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],_=i[15],x=r[0],E=r[4],w=r[8],T=r[12],M=r[1],C=r[5],S=r[9],j=r[13],P=r[2],R=r[6],D=r[10],A=r[14],k=r[3],O=r[7],B=r[11],F=r[15];return n[0]=o*x+s*M+a*P+l*k,n[4]=o*E+s*C+a*R+l*O,n[8]=o*w+s*S+a*D+l*B,n[12]=o*T+s*j+a*A+l*F,n[1]=u*x+c*M+h*P+p*k,n[5]=u*E+c*C+h*R+p*O,n[9]=u*w+c*S+h*D+p*B,n[13]=u*T+c*j+h*A+p*F,n[2]=d*x+f*M+m*P+g*k,n[6]=d*E+f*C+m*R+g*O,n[10]=d*w+f*S+m*D+g*B,n[14]=d*T+f*j+m*A+g*F,n[3]=v*x+y*M+b*P+_*k,n[7]=v*E+y*C+b*R+_*O,n[11]=v*w+y*S+b*D+_*B,n[15]=v*T+y*j+b*A+_*F,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new Fa;return function(t){for(var i=0,r=t.count;i<r;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix4(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],s=e[5],a=e[9],l=e[13],u=e[2],c=e[6],h=e[10],p=e[14];return e[3]*(+n*a*c-r*l*c-n*s*h+i*l*h+r*s*p-i*a*p)+e[7]*(+t*a*p-t*l*h+n*o*h-r*o*p+r*l*u-n*a*u)+e[11]*(+t*l*c-t*s*p-n*o*c+i*o*p+n*s*u-i*l*u)+e[15]*(-r*s*u-t*a*c+t*s*h+r*o*c-i*o*h+i*a*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],o=r[1],s=r[2],a=r[3],l=r[4],u=r[5],c=r[6],h=r[7],p=r[8],d=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],b=r[15],_=d*y*h-v*f*h+v*c*m-u*y*m-d*c*b+u*f*b,x=g*f*h-p*y*h-g*c*m+l*y*m+p*c*b-l*f*b,E=p*v*h-g*d*h+g*u*m-l*v*m-p*u*b+l*d*b,w=g*d*c-p*v*c-g*u*f+l*v*f+p*u*y-l*d*y,T=n*_+o*x+s*E+a*w;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var C=1/T;return i[0]=_*C,i[1]=(v*f*a-d*y*a-v*s*m+o*y*m+d*s*b-o*f*b)*C,i[2]=(u*y*a-v*c*a+v*s*h-o*y*h-u*s*b+o*c*b)*C,i[3]=(d*c*a-u*f*a-d*s*h+o*f*h+u*s*m-o*c*m)*C,i[4]=x*C,i[5]=(p*y*a-g*f*a+g*s*m-n*y*m-p*s*b+n*f*b)*C,i[6]=(g*c*a-l*y*a-g*s*h+n*y*h+l*s*b-n*c*b)*C,i[7]=(l*f*a-p*c*a+p*s*h-n*f*h-l*s*m+n*c*m)*C,i[8]=E*C,i[9]=(g*d*a-p*v*a-g*o*m+n*v*m+p*o*b-n*d*b)*C,i[10]=(l*v*a-g*u*a+g*o*h-n*v*h-l*o*b+n*u*b)*C,i[11]=(p*u*a-l*d*a-p*o*h+n*d*h+l*o*m-n*u*m)*C,i[12]=w*C,i[13]=(p*v*s-g*d*s+g*o*f-n*v*f-p*o*y+n*d*y)*C,i[14]=(g*u*s-l*v*s-g*o*c+n*v*c+l*o*y-n*u*y)*C,i[15]=(l*d*s-p*u*s+p*o*c-n*d*c-l*o*f+n*u*f)*C,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,s=e.y,a=e.z,l=n*o,u=n*s;return this.set(l*o+i,l*s-r*a,l*a+r*s,0,l*s+r*a,u*s+i,u*a-r*o,0,l*a-r*s,u*a+r*o,n*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e=new Fa,t=new Ia;return function(i,r,n){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),i.x=o[12],i.y=o[13],i.z=o[14],t.copy(this);var u=1/s,c=1/a,h=1/l;return t.elements[0]*=u,t.elements[1]*=u,t.elements[2]*=u,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,r.setFromRotationMatrix(t),n.x=s,n.y=a,n.z=l,this}}(),makePerspective:function(e,t,i,r,n,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,a=2*n/(t-e),l=2*n/(i-r),u=(t+e)/(t-e),c=(i+r)/(i-r),h=-(o+n)/(o-n),p=-2*o*n/(o-n);return s[0]=a,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(e,t,i,r,n,o){var s=this.elements,a=1/(t-e),l=1/(i-r),u=1/(o-n),c=(t+e)*a,h=(i+r)*l,p=(o+n)*u;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}),function(){function e(t,i){ka(this,e),this.x=t||0,this.y=i||0,this.isVector2=!0}Oa(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(){var t=new e,i=new e;return function(e,r){return t.set(e,e),i.set(r,r),this.clamp(t,i)}()}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}},{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}}])}();var Na={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},Ua=function(){function e(){ma(this,e)}return ga(e,null,[{key:"uuid",value:function(){for(var e,t=Na.chars,i=Na.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":fa(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}},{key:"calTwoPositionLength",value:function(t,i){var r=e.subPosition(t,i);return r=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],Math.sqrt(r)}},{key:"subPosition",value:function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}},{key:"normalizeDirection",value:function(t){var i=e.calTwoPositionLength([0,0,0],t);if(1===i)return t;var r=t;return 0===i?(r[0]=0,r[1]=0,r[2]=0,r):(i=1/i,r[0]*=i,r[1]*=i,r[2]*=i,r)}}]),e}(),za=function(e){function t(e){ma(this,t);var i=ba(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.objects=[],i}return ya(t,e),ga(t,[{key:"_initParams",value:function(){va(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.objects=[]}},{key:"_buildSelf",value:function(){va(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_buildSelf",this).call(this)}},{key:"clear",value:function(){for(var e=0;e<this.objects.length;e++)this.objects[e].clear();va(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(function(){function e(){ma(this,e),this.type="BaseObject",this._initParams(),this.calculaterData={},this.objectsMap=null}return ga(e,[{key:"_initParams",value:function(){this.id=Ua.uuid(),this.name=null,this.userID=null,this.properties=null,this.resource=null,this._resources=null,this.position=[0,0,0],this.rotation=[0,0,0,1],this.scale=[1,1,1],this._parent=null,this.children=[],this.typeToChildren={},this.lowerCaseProperties=null,this.visible=!0,this.mesh=null,this.calculater=null,this.meshBuilder=null,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.selfBuildCompleteCallbacks=[],this.selfBuildCompleteCallbackParams=[],this._isCalculated=!1,this._isMeshBuilded=!1,this._isChildrenBuilded=!1,this._isSelfBuilded=!1,this._isBuiled=!1,this._size=null,this._box3=null,this._selfSize=null,this._center=null,this._isBuiled=!1,this._isRequestResource=!1,this._isNotifyListeners=!1,this.objectsMap=null}},{key:"_getCalculateSizeObjects",value:function(){return this.children}},{key:"_addChild",value:function(e){this.children.push(e),this.typeToChildren[e.type]||(this.typeToChildren[e.type]=[]),this.typeToChildren[e.type].push(e),e.registerBuildCallbackListener(this._childBuildCallback,{obj:this})}},{key:"_childBuildCallback",value:function(e,t){var i=t.obj;i.children.every((function(e){return e.isBuilded}))&&(i._isChildrenBuilded=!0),i.isChildrenBuilded&&i.isSelfBuilded&&(i._isBuiled=!0),i.isBuilded&&i.notifyBuildCompleteListeners()}},{key:"_getChildrenByType",value:function(e){return this.typeToChildren[e]?this.typeToChildren[e]:[]}},{key:"_removeChild",value:function(e){var t=this.children.indexOf(e);t>-1&&this.children.splice(t,1),(t=this.typeToChildren[e.type].indexOf(e))>-1&&this.typeToChildren[e.type].splice(t,1),e.removeBuildCallbackListener(this._childBuildCallback)}},{key:"build",value:function(e){e&&this.registerBuildCallbackListener(e),this.isBuilded||(this.isResourcesBuilded?(this.buildSelf(),this.buildChildren(),this.isChildrenBuilded&&this.notifyBuildCompleteListeners()):this._initResources())}},{key:"calculate",value:function(){this.calculater&&this.calculater.build(this)}},{key:"createMesh",value:function(){if(this.meshBuilder)return this.meshBuilder.build(this)}},{key:"_initResources",value:function(){if(!this._isRequestResource){for(var e=0;e<this.resources.length;e++){var t=this.resources[e];t.isBuilded||(t.registerBuildCallbackListener(this._resourceBuildedCallback,{object:this}),t.build())}this._isRequestResource=!0}}},{key:"_resourceBuildedCallback",value:function(e,t){var i=t.object;e.isBuilded&&i.build()}},{key:"buildSelf",value:function(){this._buildSelf(),this.isSelfBuilded&&this.notifySelfBuildCompleteListeners()}},{key:"_buildSelf",value:function(){this.isSelfBuilded||(this._isCalculated||(this.calculate(),this._isCalculated=!0),this._isMeshBuilded||(this.createMesh(),this._isMeshBuilded=!0),this._isSelfBuilded=!0,this.isChildrenBuilded&&(this._isBuiled=!0),this.isBuilded&&this.notifyBuildCompleteListeners())}},{key:"buildChildren",value:function(){this._buildChildren()}},{key:"_buildChildren",value:function(){if(!this.isChildrenBuilded)for(var e=0;e<this.children.length;e++)this.children[e].build()}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"registerSelfBuildCallbackListener",value:function(e,t){this.selfBuildCompleteCallbacks.push(e),this.selfBuildCompleteCallbackParams.push(t)}},{key:"removeBuildCallbackListener",value:function(){}},{key:"notifyBuildCompleteListeners",value:function(){if(!this._isNotifyListeners){for(var e=0;e<this.buildCompleteCallbacks.length;e++)(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e]);this._isNotifyListeners=!0}}},{key:"notifySelfBuildCompleteListeners",value:function(){for(var e=0;e<this.selfBuildCompleteCallbacks.length;e++)(0,this.selfBuildCompleteCallbacks[e])(this,this.selfBuildCompleteCallbackParams[e])}},{key:"findObjectByID",value:function(e){return this.objectsMap||(this.objectsMap={},this.collectObjectsToMap(this)),null!=e&&""!==e?this.objectsMap[e]:null}},{key:"collectObjectsToMap",value:function(e){this.objectsMap[e.id]=e;for(var t=0;t<e.children.length;t++){var i=e.children[t];this.collectObjectsToMap(i)}}},{key:"findObjectByUserID",value:function(e){if(!e)return null;if(this.userID===e)return this;if(this.children)for(var t=0;t<this.children.length;t++){var i=this.children[t];if(i.userID===e)return i;var r=i.findObjectByUserID(e);if(r)return r}return null}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++)this.children[e].clear();this.clearBuildMesh(),this.calculater=null,this.meshBuilder=null,this._initParams(),this.id=null}},{key:"clearBuildMesh",value:function(){this.meshBuilder&&this.meshBuilder.clear(this.mesh),this._isMeshBuilded=!1,this._isSelfBuilded=!1,this.mesh=null,this._isBuiled=!1,this._isNotifyListeners=!1}},{key:"deepClone",value:function(e){var t=Array.isArray(e)?[]:{};if(e&&"object"===(void 0===e?"undefined":fa(e)))for(var i in e)e.hasOwnProperty(i)&&(t[i]=e&&"object"===fa(e[i])?this.deepClone(e[i]):e[i]);return t}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){return null===this._selfSize?[0,0,0]:this._selfSize}},{key:"center",get:function(){if(null===this._center){if(!this.size||!this._box3)return[0,0,0];this._center=this._box3.getCenter().toArray()}return this._center}},{key:"size",set:function(e){this._size=e,0===this.children.length&&(this.selfSize=e)},get:function(){if(null===this._size)if(this.children.length>0){if(this._box3=new La,0!==this.selfSize[0]&&0!==this.selfSize[1]&&0!==this.selfSize[2]){var e=new Fa(this.position[0],this.position[1],this.position[2]);e.y+=this.selfSize[1]/2,this._box3.setFromCenterAndSize(e,new Fa(this.selfSize[0],this.selfSize[1],this.selfSize[2]))}for(var t=this._getCalculateSizeObjects(),i=0;i<t.length;i++){var r=t[i];r.size&&r._box3&&this._box3.union(r._box3)}this._size=this._box3.getSize().toArray()}else this._size=this.selfSize;return this._size}},{key:"parent",get:function(){return this._parent},set:function(e){this._parent!==e&&(null!==this._parent&&this._parent._removeChild(this),null!=e&&(this._parent=e,this._parent&&this._parent._addChild(this)))}},{key:"isContainer",get:function(){return this.children.length>0}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource)),this._resources}},{key:"isBuilded",get:function(){return this._isBuiled}},{key:"isSelfBuilded",get:function(){return this._isSelfBuilded}},{key:"isChildrenBuilded",get:function(){return!this.isContainer||!(this.children.length>0)||this._isChildrenBuilded}},{key:"isResourcesBuilded",get:function(){for(var e=0;e<this.resources.length;e++)if(!this.resources[e].isBuilded)return!1;return!0}}]),e}()),Ha=function(){function e(){ma(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return ga(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),Va=function(e){function t(e){ma(this,t);var i=ba(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="BatchCombinePlacement",i}return ya(t,e),ga(t,[{key:"_initParams",value:function(){va(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.objects=[],this.belongRoomUserID=null,this.transformations=[]}},{key:"addObject",value:function(e){this.objects.push(e);var t=new Ha;t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),this.transformations.push(t)}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){if(null===this._selfSize){this._box3=new La;for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t.size&&this._box3.union(t._box3)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}}]),t}(za),Wa=function(){function e(t){ma(this,e),this.object=t.object,this.mesh=null}return ga(e,[{key:"build",value:function(){this.object.mesh=new THREE.Object3D}},{key:"clear",value:function(){}}]),e}(),Ga=function(e){function t(e){ma(this,t);var i=ba(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type="BatchPlacement",i}return ya(t,e),t}(Va),qa=function(){function e(){ma(this,e),this.objectManager=null,this.parserConfig=Da,this.rootParser=null,this.enableBatchPlacement=!0}return ga(e,[{key:"parse",value:function(e){this.registerObjects(),this.registerMeshBuilder(),new(0,this.parserConfig[e.type])({object:e,manager:this}).parse()}},{key:"registerObjects",value:function(){this.objectManager.containObjectClass("BatchCombinePlacement")||this.objectManager.registerObjectClass("BatchCombinePlacement",Va),this.objectManager.containObjectClass("BatchPlacement")||this.objectManager.registerObjectClass("BatchPlacement",Ga)}},{key:"registerMeshBuilder",value:function(){if(this.objectManager.meshBuilderManager){var e=this.objectManager.meshBuilderManager;e.containMeshBuilderClass("BatchCombinePlacement")||e.registerMeshBuilder("BatchCombinePlacement",Wa),e.containMeshBuilderClass("BatchPlacement")||e.registerMeshBuilder("BatchPlacement",Wa)}}},{key:"clear",value:function(){this.rootParser&&this.rootParser.clear(),this.rootParser=null,this.objectManager=null,this.parserConfig=null}}]),e}(),Xa=new(function(){function e(t){ma(this,e),this._versionMap={0:{0:qa,1:qa,2:qa}},this._smallVersionLibs=[[0,1,2]],this._bigVersions=[0]}return ga(e,[{key:"getCombinerManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][i.length-1]}if(null==t){var r=this._smallVersionLibs[e];return new this._versionMap[e][r.length-1]}var n=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>n[n.length-1]?new this._versionMap[e][n.length-1]:new this._versionMap[e][t];console.error("max combiner not support version "+e+"."+t)}}]),e}()),Ja=function(){function e(t){ma(this,e),this.objectManager=t.objectManager,this.enableBatchPlacement=!0,void 0!==t.enableBatchPlacement&&(this.enableBatchPlacement=t.enableBatchPlacement)}return ga(e,[{key:"parse",value:function(e,t,i){var r=Xa.getCombinerManager(t,i);return r.enableBatchPlacement=this.enableBatchPlacement,ja.enableBatchPlacement=this.enableBatchPlacement,r?(r.objectManager=this.objectManager,r.parse(e)):null}},{key:"getCombineManager",value:function(e,t){var i=Xa.getCombinerManager(e,t);return i.objectManager=this.objectManager,i}},{key:"clear",value:function(){}}]),e}(),Ya=function e(t){p(this,e),this.objectsMap={}},Za=function(e){function t(e){p(this,t);var i=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.sceneJson=null,i.world=null,i.resourceManager=new Si,i.debugManager=Nt,i.objectManager=new ii,i.loader=new da({objectManager:i.objectManager,resourceManager:i.resourceManager}),i.loadVersion=null,i.enableRequestWorld=!0,i.dynamicBuildManager=new Ze(i),i.enableBatchPlacement=!0,i}return f(t,e),d(t,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"clearAllResources",value:function(){this.resourceManager.disposeModels(),this.resourceManager.disposeTextures()}},{key:"clearAllObjects",value:function(){this.world.clear()}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"disposeObject",value:function(e){this.dynamicBuildManager.disposeObject(e)}},{key:"findObjectByID",value:function(e){return this.world.findObjectByID(e)}},{key:"load",value:function(e){var t=this,i=e.bigVersion,r=e.smallVersion;return 0===i&&r>1&&(mt.enableBatchObject=!0,void 0!==this.enableBatchPlacement&&(this.enableBatchPlacement=e.enableBatchPlacement)),this.objectManager.meshBuilderManager=vs.createManager(i,r),mt.enableBatchObject&&(this.combineManager=new Ja({objectManager:this.objectManager,enableBatchPlacement:this.enableBatchPlacement})),this.world=this.loader.load(e),this.combineManager&&this.combineManager.parse(t.world,i,r),t.dynamicBuildManager.world=t.world,t.enableRequestWorld&&t.requestToBuild(t.world.id),t.world}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),t}(Ya),Qa=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ka=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),$a=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},el=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},tl=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},il=function(){function e(t){Qa(this,e),this.object=t.object,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.mesh=null,this._boxMesh=null}return Ka(e,[{key:"build",value:function(){this._createMesh()}},{key:"_createMesh",value:function(){if(this.object.resource){var e=this.object.resource;e.isTestModel?this.object.mesh=e.model.clone():this.object.nodeName?this.createMeshByNode():this.createMeshByModelClone()}else null===this.object.mesh&&(this.object.mesh=new THREE.Object3D)}},{key:"createMeshByNode",value:function(){var e=this.object.resource.model.getObjectByName(this.object.nodeName);if(e){if(e=e.clone(),this.object.position=e.position.toArray(),this.object.scale=e.scale.toArray(),this.object.rotation=e.quaternion.toArray(),this.object.children.length>0)for(var t=e.children.length-1;t>-1;t--){var i=e.children[t];e.remove(i)}this.object.mesh=e}else console.warn("can not find node "+this.object.nodeName),this.object.mesh=new THREE.Object3D}},{key:"_setTransformation",value:function(e,t){e.position.equals(t.position)||(0===e.position.x&&0===e.position.y&&0===e.position.z?this.object.position=t.position.clone():t.position.copy(this.object.position)),e.scale.equals(t.scale)||(1===e.scale.x&&1===e.scale.y&&1===e.scale.z?this.object.scale=t.scale.clone():t.scale.copy(t.scale)),e.rotation.equals(t.quaternion)||(0===e.rotation.x&&0===e.rotation.y&&0===e.rotation.z&&1===e.rotation.w?this.object.rotation=t.quaternion.clone():t.quaternion.copy(this.object.rotation))}},{key:"createMeshByModelClone",value:function(){var e=this.object.resource.model.clone(),t=this.object.position,i=this.object.scale,r=this.object.rotation;e.position.set(t[0],t[1],t[2]),e.quaternion.set(r[0],r[1],r[2],r[3]),e.scale.set(i[0],i[1],i[2]),this.object.mesh=e,this.object.mesh.name=this.object.type+this.object.id}},{key:"createBoxMesh",value:function(){if(null===this._boxMesh){var e=new THREE.BoxBufferGeometry(1,1,1),t=new THREE.MeshBasicMaterial,i=new THREE.Mesh(e,t),r=this.object.size;i.scale.set(this.object.size[0],this.object.size[1],this.object.size[2]),i.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]),i.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),i.position.y=(this.object.position[1]+r[1])/2,this._boxMesh=i}return this._boxMesh}},{key:"notifyBuildCompleteListeners",value:function(){for(var e=0;e<this.buildCompleteCallbacks.length;e++)(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}},{key:"checkResourceReady",value:function(){if(this.object.resources){for(var e=0;e<this.object.resources.length;e++)if(!this.object.resources[e].ready)return!1;return!0}return!this.object.resource||!!this.object.resource.ready}},{key:"initResource",value:function(){if(this.object.resources)for(var e=0;e<this.object.resources.length;e++){var t=this.object.resources[e];this.requestResource(t)}else this.requestResource(this.object.resource)}},{key:"requestResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"resourceCallback",value:function(e){this.build()}},{key:"_dispose",value:function(e){if(e instanceof THREE.Mesh){var t=e;if(t){var i=t.material,r=t.geometry;t.isDestory=!0,i&&(this._disposeMaterial(i),t.material=null),r&&(r.isDestory=!0,r.dispose(),t.geometry=null)}}if(e)for(var n=e.children,o=0;o<n.length;o++){var s=n[o];this._dispose(s)}}},{key:"_disposeMaterial",value:function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var i=e[t];this._disposeMaterial(i)}else e.isDestory=!0,e.dispose()}},{key:"clear",value:function(e){e&&(e.parent&&e.parent.remove(e),this._dispose(e)),this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.mesh=null,this._boxMesh=null}}]),e}(),rl=function(e){function t(e){Qa(this,t);var i=tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.isRegisterObjectBuildCallback=!1,i}return el(t,e),Ka(t,[{key:"_createMesh",value:function(){$a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this)}},{key:"buildCallback",value:function(e,t){var i=t.builder;i.applyRotationToChildren(),i.object.mesh.quaternion.set(0,0,0,1);for(var r=0;r<e.children.length;r++)e.children[r].meshBuilder.applyRotationToChildren()}}]),t}(il),nl=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),t}(il),ol=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),t}(il),sl=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),t}(il),al=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),Ka(t,[{key:"_createMesh",value:function(){$a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this);var e=new THREE.Object3D;e.name="floorMax",e.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),e.scale.set(this.object.scale[0],this.object.scale[1],this.object.scale[2]),e.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]);var i=this.object.mesh;i.position.set(0,0,0),i.scale.set(1,1,1),i.quaternion.set(0,0,0,1),e.add(i);var r=i.position.clone();r.applyQuaternion(e.quaternion),i.position.copy(r),i.quaternion.premultiply(e.quaternion),this.object.rotation=[0,0,0,1],e.quaternion.set(0,0,0,1),this.object.mesh=e,this.object.floor&&(this.object.floor.mesh=i),this.object.roof&&(this.object.roof.mesh=new THREE.Object3D),this.object.ceiling&&(this.object.ceiling.mesh=new THREE.Object3D)}}]),t}(il),ll=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),t}(il),ul=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),t}(il),cl=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),t}(il),hl=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),t}(il),pl=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),t}(il),dl=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),t}(il),fl=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),Ka(t,[{key:"_createMesh",value:function(){this.object.mesh=new THREE.Object3D}}]),t}(il),ml=function(){function e(t){Qa(this,e),this._map={Building:rl,World:nl,FloorPlan:dl,Outdoors:sl,Room:al,Floor:ol,Placement:ll,Facade:hl,DoorOrWindow:pl,CombinePlacement:ul,CombinePlacementByBatch:fl,CombineModelWall:cl}}return Ka(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),gl=function(){function e(t){Qa(this,e),this.builderTypeConfig=new ml}return Ka(e,[{key:"create",value:function(e){var t=e.type,i=this.builderTypeConfig.getClass(t);return i?new i(e):null}}]),e}(),vl=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),t}(il),yl=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),t}(il),bl=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),Ka(t,[{key:"_createMesh",value:function(){$a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this);var e=new THREE.Object3D;e.name="floorMax",e.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),e.scale.set(this.object.scale[0],this.object.scale[1],this.object.scale[2]),e.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]);var i=this.object.mesh;i.position.set(0,0,0),i.scale.set(1,1,1),i.quaternion.set(0,0,0,1),e.add(i);var r=i.position.clone();r.applyQuaternion(e.quaternion),i.position.copy(r),i.quaternion.premultiply(e.quaternion),this.object.rotation=[0,0,0,1],e.quaternion.set(0,0,0,1),this.object.mesh=e,this.object.floor&&null===this.object.floor.mesh&&(this.object.floor.mesh=i),this.object.roof&&null===this.object.roof.mesh&&(this.object.roof.mesh=new THREE.Object3D),this.object.ceiling&&null===this.object.ceiling.mesh&&(this.object.ceiling.mesh=new THREE.Object3D)}}]),t}(il),_l=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),Ka(t,[{key:"_createMesh",value:function(){if(this.object.resource){var e=this.object.resource;e.isTestModel?this.object.mesh=e.model.clone():this.object.nodeName?this.createMeshByNode():this.createMeshByModelClone()}else null===this.object.mesh&&(this.object.mesh=new THREE.Object3D)}}]),t}(il),xl=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),t}(_l),El=function(e){function t(e){return Qa(this,t),tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return el(t,e),t}(_l),wl=function(e){function t(e){Qa(this,t);var i=tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map.Roof=vl,i._map.Ceiling=yl,i._map.Room=bl,i._map.CombineFloor=_l,i._map.CombineRoof=xl,i._map.CombineCeiling=El,i}return el(t,e),t}(ml),Tl=function(e){function t(e){Qa(this,t);var i=tl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.builderTypeConfig=new wl,i}return el(t,e),t}(gl),Ml=new(function(){function e(t){Qa(this,e),this._versionMap={0:{0:gl,1:Tl}},this._smallVersionLibs=[[0,1]],this._bigVersions=[0]}return Ka(e,[{key:"getManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][i.length-1]}if(null==t){var r=this._smallVersionLibs[e];return new this._versionMap[e][r.length-1]}var n=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>n[n.length-1]?new this._versionMap[e][n.length-1]:new this._versionMap[e][t];console.error("maxmeshbuilder not support version "+e+"."+t)}}]),e}()),Cl=new(function(){function e(t){Qa(this,e)}return Ka(e,[{key:"createManager",value:function(e){return Ml.getManager(e.bigVersion,e.smallVersion)}}]),e}()),Sl="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},jl=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Pl=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Rl=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},Dl=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Al=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},kl=new(function(){function e(t){jl(this,e),this.config=null,this.objectManager=null}return Pl(e,[{key:"createObject",value:function(e){var t=this.config.getClass(e.creatorType);e.objectManager=this.objectManager;var i=new t(e),r=i.create();return i.parseChildren(),r}}]),e}()),Ol={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},Bl=function(){function e(){jl(this,e)}return Pl(e,null,[{key:"uuid",value:function(){for(var e,t=Ol.chars,i=Ol.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Sl(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}}]),e}(),Fl=function(){function e(t){jl(this,e),this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=t.jsonData,this.objectParent=null,t.parent&&(this.objectParent=t.parent),this.createType=null,this.resourceManager=t.resourceManager,this.objectManager=t.objectManager}return Pl(e,[{key:"create",value:function(){var e=this._getCreateParams();if(this.object=kl.objectManager.create(e),this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.loadMode=0,this.jsonData.node?(this.object.nodeName=this.jsonData.node,this.object.loadMode=2):void 0!==this.jsonData.model&&null!==this.jsonData.model&&(this.object.loadMode=1),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object.resource||(this.object.resource=this.resourceManager.emptyModelResource),this.object.jsonData=this.jsonData,e.parent&&(this.object.parent=e.parent),this.jsonData.position){var t=this.jsonData.position;this.object.position=t}if(this.jsonData.scale){var i=this.jsonData.scale;0===i[0]&&(i[0]=.01),0===i[1]&&(i[1]=.01),0===i[2]&&(i[2]=.01),this.object.scale=i}if(this.jsonData.rotation){var r=this.jsonData.rotation;this.object.rotation=r}if(this.jsonData.properties&&(this.object.properties=this.jsonData.properties,this.object.lowerCaseProperties=this.convertPropertiesToLowerCase(this.jsonData.properties)),Bl.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.jsonData.caminfo){var n=this.jsonData.caminfo.eye,o=this.jsonData.caminfo.target;n[2]=-n[2],o[2]=-o[2],this.object.camInfo={eye:n,target:o}}if(this.jsonData.size){var s=this.jsonData.size;this.object.size=s}else this.object.size=[1,1,1];return this.object}},{key:"convertPropertiesToLowerCase",value:function(e){var t={};for(var i in e)t[i.toLowerCase()]=e[i].toLowerCase();return t}},{key:"parseChildren",value:function(){}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,kl.createObject(e)}}]),e}(),Ll={WORLD:0,BUILDING:1,FLOORPLAN:2,WALLCORNER:3,MODELWALL:4,STRAIGHTMANUALWALL:5,PLACEMENT:6,PLACEMENTGROUP:7,DOORORWINDOW:8,ROOM:9,OUTDOORS:10,FACADE:11,FACADEGROUP:12,CURVELINE:13,LEAKWATERLINE:14,ARROWLINE:15,ARROWDATALINE:16,PIPELINE:17,ROUTELINE:18,VIDEOPROBE:19,PLACEMENTWALL:20,PLACEMENTGROUND:21,COMBINEPLACEMENT:22,COMBINEMODELWALL:23,FLOOR:24,CEILING:25,ROOF:26,COMBINEFLOOR:27,COMBINECEILING:28,COMBINEROOF:29},Il=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return Dl(t,e),Pl(t,[{key:"parseChildren",value:function(){var e=this.jsonData;if(e.buildings&&this._parseJsonDataChildren({jsonData:e.buildings,creatorType:Ll.BUILDING}),e.outdoors){var t=this._parseJsonDataChild({jsonData:e.outdoors,creatorType:Ll.OUTDOORS});this.object.outdoors=t}}}]),t}(Fl),Nl=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),Bl.checkValueEmpty(this.jsonData.structshow)||(this.object.structShow=this.jsonData.structshow),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.facades&&this._parseJsonDataChildren({jsonData:e.facades,creatorType:Ll.FACADE}),e.facadegroups&&this._parseJsonDataChildren({jsonData:e.facadegroups,creatorType:Ll.FACADEGROUP}),e.plans&&this._parseJsonDataChildren({jsonData:e.plans,creatorType:Ll.FLOORPLAN})}}]),t}(Fl),Ul=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),Bl.checkValueEmpty(this.jsonData.alwaysshowinsideobjs)||(this.object.alwaysShowInsideObjs=this.jsonData.alwaysshowinsideobjs),Bl.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.corners&&this._parseCorners(e.corners),e.walls&&this._parseWalls(e.walls),e.placements&&this._parseJsonDataChildren({jsonData:e.placements,creatorType:Ll.PLACEMENT}),e.combineplacements&&this._parseJsonDataChildren({jsonData:e.combineplacements,creatorType:Ll.COMBINEPLACEMENT}),e.rooms&&this._parseJsonDataChildren({jsonData:e.rooms,creatorType:Ll.ROOM}),e.groups&&this._parseJsonDataChildren({jsonData:e.groups,creatorType:Ll.PLACEMENTGROUP}),e.curvelines&&this._parseJsonDataChildren({jsonData:e.curvelines,creatorType:Ll.CURVELINE}),e.routelines&&this._parseJsonDataChildren({jsonData:e.routelines,creatorType:Ll.ROUTELINE}),e.leakwaterlines&&this._parseJsonDataChildren({jsonData:e.leakwaterlines,creatorType:Ll.LEAKWATERLINE}),e.arrowlines&&this._parseJsonDataChildren({jsonData:e.arrowlines,creatorType:Ll.ARROWLINE}),e.arrowdatalines&&this._parseJsonDataChildren({jsonData:e.arrowdatalines,creatorType:Ll.ARROWDATALINE}),e.pipelines&&this._parseJsonDataChildren({jsonData:e.pipelines,creatorType:Ll.PIPELINE}),e.videoprobes&&this._parseJsonDataChildren({jsonData:e.videoprobes,creatorType:Ll.VIDEOPROBE}),e.grounds&&this._parseJsonDataChildren({jsonData:e.grounds,creatorType:Ll.PLACEMENTGROUND}),e.doororwindows&&this._parseDoorOrWindows(e.doororwindows)}},{key:"_parseCorners",value:function(e){for(var t=0;t<e.length;t++){var i=e[t],r=i[0],n=i[1],o=-i[2];this.object.existsCorner(r,n,o)?console.error("repeat corner"):this._parseJsonDataChild({jsonData:i,creatorType:Ll.WALLCORNER})}}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];this._parseJsonDataChild({jsonData:i,creatorType:Ll.COMBINEMODELWALL})}}},{key:"_parseDoorOrWindows",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i];this._parseJsonDataChild({jsonData:r,attachWall:t,creatorType:Ll.DOORORWINDOW})}}}]),t}(Fl),zl=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ModelWall",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),Bl.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),this.object}}]),t}(Fl),Hl=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="StraightManualWall",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}}]),t}(Fl),Vl=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Placement",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){if(Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],Bl.checkValueEmpty(this.jsonData.texture)||(this.object.customTextureResource=this.resourceManager.textures[this.jsonData.texture]),this.jsonData.color){var e=this.jsonData.color;this.object.customColor=e,4===e.length&&(this.object.opacity=e[3])}return Bl.checkValueEmpty(this.jsonData.rendermode)||(this.object.renderMode=this.jsonData.rendermode),this.jsonData.animinfo&&(this.object.isPlayAnim=this.jsonData.animinfo.isplay,this.object.animClip=this.jsonData.animinfo.clip),Bl.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(Fl),Wl=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementGroup",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.placements&&this._parseJsonDataChildren({jsonData:this.jsonData.placements,creatorType:Ll.PLACEMENT}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:Ll.PLACEMENTGROUP}),this.jsonData.videoprobes&&this._parseJsonDataChildren({jsonData:this.jsonData.videoprobes,creatorType:Ll.VIDEOPROBE}),Bl.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(Fl),Gl=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="DoorOrWindow",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){if(Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],Bl.checkValueEmpty(this.jsonData.suspendpercent)||(this.object.suspendPercent=this.jsonData.suspendpercent),Bl.checkValueEmpty(this.jsonData.isopen)||(this.object.isOpen=this.jsonData.isopen),Bl.checkValueEmpty(this.jsonData.diridx)||(this.object.openDirIndex=this.jsonData.diridx),!Bl.checkValueEmpty(this.jsonData.iswindow)){var e=this.jsonData.iswindow;"string"==typeof e&&(e="false"!==e.toLocaleString()),this.object.isWindow=e}return this.object}}]),t}(Fl),ql=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._createChildren(),this.object}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:Ll.FLOOR}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:Ll.CEILING}),this._parseJsonDataChild({jsonData:{},creatorType:Ll.ROOF}))}}]),t}(Fl),Xl=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return Dl(t,e),t}(Ul),Jl=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Facade",i}return Dl(t,e),t}(Vl),Yl=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FacadeGroup",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.facades&&this._parseJsonDataChildren({jsonData:this.jsonData.facades,creatorType:Ll.FACADE}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:Ll.FACADEGROUP}),this.object}}]),t}(Fl),Zl=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombinePlacement",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(Fl),Ql=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineModelWall",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(Fl),Kl=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Floor",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(Fl),$l=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Ceiling",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(Fl),eu=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Roof",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(Fl),tu=function(){function e(t){jl(this,e),this._map={0:Il,1:Nl,2:Ul,4:zl,5:Hl,6:Vl,7:Wl,8:Gl,9:ql,10:Xl,11:Jl,12:Yl,22:Zl,23:Ql,24:Kl,25:$l,26:eu}}return Pl(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),iu=function(){function e(t){jl(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl}return Pl(e,[{key:"createResource",value:function(e){var t=this.manager.create({type:e});return t.manager=this.manager,t}},{key:"loadTextures",value:function(e){}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource("LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource("Resource");return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];if((t=this.createResource("Max2TjsResource")).baseUrl=this.baseModelUrl,r.localurl){if(t.localUrl=r.localurl,t.id=r.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,r.title&&(t.modelName=r.title),t.modelID=r.id,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.color){var n=r.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}}else if(r.id){if(t.id=r.id,t.modelID=r.id,t.version=r.version,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.model&&(t.modelID=r.model),r.title&&(t.modelName=r.title),r.color&&(n=r.color,t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])),r.size){var o=r.size;t.modelSize=new THREE.Vector3(o[0],o[1],o[2])}r.hasanimation&&(t.hasAnim=r.hasanimation),r.url&&(t.url=r.url)}for(var s=0;s<this.manager.ableToSupportFootAndHeadModelWalls.length;s++){var a=this.manager.ableToSupportFootAndHeadModelWalls[s];if(t.id===a){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var i=e.color;t.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(t.opacity=i[3])}if(e.size){var r=e.size;t.modelSize=new THREE.Vector3(r[0],r[1],r[2])}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),ru=function(){function e(){jl(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new tu}return Pl(e,[{key:"setObjectTypeConfig",value:function(e){objectManager.objectTypeConfig=e}},{key:"setObjectManager",value:function(e){kl.objectManager=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"loadLightMaps",value:function(e){var t=null,i="18091219l1g1hnjt",r="png",n="18091216vjlgtwbh";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(i=e.straightmanualwall.lightingtexture.id,r=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource("Resource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=i,t.ext=r,this.defaultResource.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource("Resource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=n,t.ext="jpg",this.defaultResource.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=objectManager.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),t.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++)i+=t[r]+"/";return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,i){e.sceneJson?t(e.sceneJson):e.sceneURL?(new THREE.FileLoader).load(e.sceneURL,(function(i){e.sceneJson=JSON.parse(i),t()}),(function(){}),(function(t){i("can not load "+e.sceneURL)})):i("load scene json error")}))}},{key:"getResourceLoader",value:function(){var e=new iu(this.resourceManager);return e.resourceManager=this.resourceManager,e}},{key:"parseSceneJson",value:function(){var e=this,t=this.getResourceLoader();t.loadTextures(e.sceneJson.textures),t.loadModels(e.sceneJson.models),e.parseWorld(e.sceneJson)}},{key:"parseWorld",value:function(e){kl.config=this.creatorTypeConfig,this.world=kl.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:Ll.WORLD})}}]),e}(),nu=(new ru,function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.floor&&this._parseJsonDataChild({jsonData:e.floor,creatorType:Ll.FLOOR}),"FloorPlan"===this.object.parent.type&&(e.ceiling&&this._parseJsonDataChild({jsonData:e.ceiling,creatorType:Ll.CEILING}),e.roof&&this._parseJsonDataChild({jsonData:e.roof,creatorType:Ll.ROOF}))}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:Ll.FLOOR}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:Ll.CEILING}),this._parseJsonDataChild({jsonData:{},creatorType:Ll.ROOF}))}}]),t}(Fl)),ou=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineFloor",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(Fl),su=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineRoof",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(Fl),au=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CombineCeiling",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(Fl),lu=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return Dl(t,e),Pl(t,[{key:"create",value:function(){return Rl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.combinefloors&&this._parseJsonDataChildren({jsonData:this.jsonData.combinefloors,creatorType:Ll.COMBINEFLOOR}),this.jsonData.combineroofs&&this._parseJsonDataChildren({jsonData:this.jsonData.combineroofs,creatorType:Ll.COMBINEROOF}),this.jsonData.combineceilings&&this._parseJsonDataChildren({jsonData:this.jsonData.combineceilings,creatorType:Ll.COMBINECEILING}),this.object}}]),t}(Ul),uu=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return Dl(t,e),t}(lu),cu=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._map[Ll.ROOM]=nu,i._map[Ll.COMBINEFLOOR]=ou,i._map[Ll.COMBINECEILING]=au,i._map[Ll.COMBINEROOF]=su,i._map[Ll.FLOORPLAN]=lu,i._map[Ll.OUTDOORS]=uu,i}return Dl(t,e),t}(tu),hu=function(e){function t(e){jl(this,t);var i=Al(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.creatorTypeConfig=new cu,i}return Dl(t,e),t}(ru),pu=new(function(){function e(t){jl(this,e),this._versionMap={0:{0:ru,1:hu}},this._smallVersionLibs=[[0,1]],this._bigVersions=[0]}return Pl(e,[{key:"getLoaderManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1],r=i[i.length-1];return new this._versionMap[this._bigVersions.length-1][r]}if(null==t){var n=this._smallVersionLibs[e],o=n[n.length-1];return new this._versionMap[e][o]}var s=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1])){var a=s[s.length-1];return t>a||!this._versionMap[e][t]?new this._versionMap[e][a]:new this._versionMap[e][t]}console.error("bimLoader not support version "+e+"."+t)}}]),e}()),du=function(){function e(t){jl(this,e),this.resourceManager=t.resourceManager,this.defaultSetting=t.defaultSetting,this.defaultResource=t.defaultResource,this.objectManager=t.objectManager}return Pl(e,[{key:"load",value:function(e){var t=pu.getLoaderManager(e.bigVersion,e.smallVersion);return t.setDefaultSetting(this.defaultSetting),t.setDefaultResource(this.defaultResource),t.setResourceManager(this.resourceManager),t.setObjectManager(this.objectManager),t.parseObjects(e)}}]),e}(),fu=function(e){function t(e){p(this,t);var i=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.sceneJson=null,i.world=null,i.resourceManager=new Si,i.objectManager=new ii,i.debugManager=Nt,i.loader=new du({objectManager:i.objectManager,resourceManager:i.resourceManager}),i.loadVersion=null,i.enableRequestWorld=!0,i.dynamicBuildManager=new Ze(i),mt.enableBatchObject&&(i.objectManager.meshBuilderManager.registerMeshBuilder(dt.CombinePlacement,fl),i.combineManager=new Ja({objectManager:i.objectManager})),i}return f(t,e),d(t,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"clearAllResources",value:function(){this.resourceManager.disposeModels(),this.resourceManager.disposeTextures()}},{key:"clearAllObjects",value:function(){this.world.clear()}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"disposeObject",value:function(e){this.dynamicBuildManager.disposeObject(e)}},{key:"findObjectByID",value:function(e){return this.world.findObjectByID(e)}},{key:"load",value:function(e){var t=this;return this.objectManager.meshBuilderManager=Cl.createManager(e),this.world=this.loader.load(e),this.combineManager&&this.combineManager.parse(t.world),t.dynamicBuildManager.world=t.world,t.enableRequestWorld&&t.requestToBuild(t.world.id),t.world}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),t}(Ya),mu="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},gu=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},vu=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),yu=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},bu=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},_u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},xu={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid:new Array(36)},Eu=function(){function e(){gu(this,e)}return vu(e,null,[{key:"uuid",value:function(){for(var e,t=xu.chars,i=xu.uuid,r=0,n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-4;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse((function(e){e.isSkinnedMesh&&(i[e.name]=e)}));var r={},n={};t.traverse((function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)}));var o=!1;for(var s in i){o=!0;for(var a=i[s].skeleton,l=n[s],u=[],c=0;c<a.bones.length;++c){var h=r[a.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,a.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":mu(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}}]),e}(),wu=function(){function e(t){gu(this,e),this.creatorManager=t.creatorManager}return vu(e,[{key:"initData",value:function(e){this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=e.jsonData,this.objectParent=null,e.parent&&(this.objectParent=e.parent),this.resourceManager=e.resourceManager}},{key:"create",value:function(e){this.initData(e);var t=this._getCreateParams();return this.object=this.creatorManager.objectManager.create(t),t.parent&&(this.object.parent=t.parent),this._loadBaseData(),this.object}},{key:"_loadBaseData",value:function(){if(this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.jsonData=this.jsonData,this.jsonData.position){var e=this.jsonData.position.slice();e[2]=-e[2],this.object.position=e}if(this.jsonData.scale){var t=this.jsonData.scale.slice();0===t[0]&&(t[0]=.01),0===t[1]&&(t[1]=.01),0===t[2]&&(t[2]=.01),this.object.scale=t}if(this.jsonData.rotation){var i=this.jsonData.rotation.slice();i[2]=-i[2],i[3]=-i[3],this.object.rotation=i}if(this.jsonData.properties&&(this.object.properties=this.jsonData.properties,this.object.lowerCaseProperties=this.convertPropertiesToLowerCase(this.jsonData.properties)),Eu.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.jsonData.caminfo){var r=this.jsonData.caminfo.eye,n=this.jsonData.caminfo.target;r[2]=-r[2],n[2]=-n[2],this.object.camInfo={eye:r,target:n}}}},{key:"convertPropertiesToLowerCase",value:function(e){var t={};for(var i in e)t[i.toLowerCase()]=e[i].toLowerCase();return t}},{key:"parseChildren",value:function(){}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,this.creatorManager.createObject(e)}}]),e}(),Tu={WORLD:0,BUILDING:1,FLOORPLAN:2,WALLCORNER:3,MODELWALL:4,STRAIGHTMANUALWALL:5,PLACEMENT:6,PLACEMENTGROUP:7,DOORORWINDOW:8,ROOM:9,OUTDOORS:10,FACADE:11,FACADEGROUP:12,CURVELINE:13,LEAKWATERLINE:14,ARROWLINE:15,ARROWDATALINE:16,PIPELINE:17,ROUTELINE:18,VIDEOPROBE:19,PLACEMENTWALL:20,PLACEMENTGROUND:21,FLOOR:22,CEILING:23,ROOF:24},Mu=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return bu(t,e),vu(t,[{key:"parseChildren",value:function(){var e=this.jsonData;if(e.outdoors){var t=this._parseJsonDataChild({jsonData:e.outdoors,creatorType:Tu.OUTDOORS});this.object.outdoors=t}e.buildings&&this._parseJsonDataChildren({jsonData:e.buildings,creatorType:Tu.BUILDING})}}]),t}(wu),Cu=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),Eu.checkValueEmpty(this.jsonData.structshow)||(this.object.structShow=this.jsonData.structshow),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.facades&&this._parseJsonDataChildren({jsonData:e.facades,creatorType:Tu.FACADE}),e.facadegroups&&this._parseJsonDataChildren({jsonData:e.facadegroups,creatorType:Tu.FACADEGROUP}),e.plans&&this._parseJsonDataChildren({jsonData:e.plans,creatorType:Tu.FLOORPLAN})}}]),t}(wu),Su=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),Eu.checkValueEmpty(this.jsonData.alwaysshowinsideobjs)||(this.object.alwaysShowInsideObjs=this.jsonData.alwaysshowinsideobjs),Eu.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.corners&&this._parseCorners(e.corners),e.walls&&this._parseWalls(e.walls),e.rooms&&(this._parseJsonDataChildren({jsonData:e.rooms,creatorType:Tu.ROOM}),this.object.calRoomsUV2()),e.placements&&this._parseJsonDataChildren({jsonData:e.placements,creatorType:Tu.PLACEMENT}),e.groups&&this._parseJsonDataChildren({jsonData:e.groups,creatorType:Tu.PLACEMENTGROUP}),e.curvelines&&this._parseJsonDataChildren({jsonData:e.curvelines,creatorType:Tu.CURVELINE}),e.routelines&&this._parseJsonDataChildren({jsonData:e.routelines,creatorType:Tu.ROUTELINE}),e.leakwaterlines&&this._parseJsonDataChildren({jsonData:e.leakwaterlines,creatorType:Tu.LEAKWATERLINE}),e.arrowlines&&this._parseJsonDataChildren({jsonData:e.arrowlines,creatorType:Tu.ARROWLINE}),e.arrowdatalines&&this._parseJsonDataChildren({jsonData:e.arrowdatalines,creatorType:Tu.ARROWDATALINE}),e.pipelines&&this._parseJsonDataChildren({jsonData:e.pipelines,creatorType:Tu.PIPELINE}),e.videoprobes&&this._parseJsonDataChildren({jsonData:e.videoprobes,creatorType:Tu.VIDEOPROBE}),e.grounds&&this._parseJsonDataChildren({jsonData:e.grounds,creatorType:Tu.PLACEMENTGROUND})}},{key:"_parseCorners",value:function(e){for(var t=0;t<e.length;t++){var i=e[t],r=i[0],n=i[1],o=-i[2];this.object.existsCorner(r,n,o)?console.error("repeat corner"):this._parseJsonDataChild({jsonData:i,creatorType:Tu.WALLCORNER})}}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var i=e[t],r=null;0===i.type?r=this._parseJsonDataChild({jsonData:i,creatorType:Tu.STRAIGHTMANUALWALL}):1===i.type?r=this._parseJsonDataChild({jsonData:i,creatorType:Tu.MODELWALL}):2===i.type&&(r=this._parseJsonDataChild({jsonData:i,creatorType:Tu.PLACEMENTWALL})),i.doororwindows&&this._parseDoorOrWindows(i.doororwindows,r)}}},{key:"_parseDoorOrWindows",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i];this._parseJsonDataChild({jsonData:r,attachWall:t,creatorType:Tu.DOORORWINDOW})}}}]),t}(wu),ju=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="WallCorner",i}return bu(t,e),vu(t,[{key:"create",value:function(e){yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.jsonData[0],r=this.jsonData[1],n=-this.jsonData[2];return this.object.position=[i,r,n],this.object}}]),t}(wu),Pu=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ModelWall",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this._parseCorners(),Eu.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),Eu.checkValueEmpty(this.jsonData.height)?this.object.height=this.object.resource.size[1]:this.object.height=this.jsonData.height,Eu.checkValueEmpty(this.jsonData.thick)||(this.object.thick=this.jsonData.thick),this.object}},{key:"_parseCorners",value:function(){var e=this.jsonData.corners,t=this.objectParent.typeToChildren.WallCorner;this.object.startCorner=t[e[0]],this.object.endCorner=t[e[1]]}}]),t}(wu),Ru=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="StraightManualWall",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this._parseCorners(),this._parseResources(),this.jsonData.uvmultiple&&(this.object.uvMultiple=this.jsonData.uvmultiple),Eu.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),Eu.checkValueEmpty(this.jsonData.thick)||(this.object.thick=this.jsonData.thick),this.object}},{key:"_parseCorners",value:function(){var e=this.jsonData.corners,t=this.objectParent.typeToChildren.WallCorner;this.object.startCorner=t[e[0]],this.object.endCorner=t[e[1]]}},{key:"_parseResources",value:function(){Eu.checkValueEmpty(this.jsonData.lefttexture)||(this.object.leftResource=this.resourceManager.textures[this.jsonData.lefttexture]),Eu.checkValueEmpty(this.jsonData.righttexture)||(this.object.rightResource=this.resourceManager.textures[this.jsonData.righttexture]),Eu.checkValueEmpty(this.jsonData.edgetexture)||(this.object.edgeResource=this.resourceManager.textures[this.jsonData.edgetexture]),this.resourceManager.wallLightMapResource&&(this.object.lightMapResource=this.resourceManager.wallLightMapResource)}}]),t}(wu),Du=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Placement",i}return bu(t,e),vu(t,[{key:"create",value:function(e){if(yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object.resource=this.resourceManager.models[this.jsonData.model],Eu.checkValueEmpty(this.jsonData.texture)||(this.object.customTextureResource=this.resourceManager.textures[this.jsonData.texture]),this.jsonData.color){var i=this.jsonData.color;this.object.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(this.object.opacity=i[3])}return Eu.checkValueEmpty(this.jsonData.rendermode)||(this.object.renderMode=this.jsonData.rendermode),this.jsonData.animinfo&&(this.object.isPlayAnim=this.jsonData.animinfo.isplay,this.object.animClip=this.jsonData.animinfo.clip),Eu.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(wu),Au=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementGroup",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.jsonData.placements&&this._parseJsonDataChildren({jsonData:this.jsonData.placements,creatorType:Tu.PLACEMENT}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:Tu.PLACEMENTGROUP}),this.jsonData.videoprobes&&this._parseJsonDataChildren({jsonData:this.jsonData.videoprobes,creatorType:Tu.VIDEOPROBE}),Eu.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(wu),ku=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="DoorOrWindow",i}return bu(t,e),vu(t,[{key:"initData",value:function(e){yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initData",this).call(this,e),this.attachWall=e.attachWall}},{key:"create",value:function(e){if(yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object.resource=this.resourceManager.models[this.jsonData.model],Eu.checkValueEmpty(this.jsonData.suspendpercent)||(this.object.suspendPercent=this.jsonData.suspendpercent),Eu.checkValueEmpty(this.jsonData.isopen)||(this.object.isOpen=this.jsonData.isopen),Eu.checkValueEmpty(this.jsonData.diridx)||(this.object.openDirIndex=this.jsonData.diridx),!Eu.checkValueEmpty(this.jsonData.iswindow)){var i=this.jsonData.iswindow;"string"==typeof i&&(i="false"!==i.toLocaleString()),this.object.isWindow=i}return this.object.attachWall=this.attachWall,this.attachWall.doorOrWindows.push(this.object),this.object}}]),t}(wu);function Ou(e,t){if(!(this instanceof Ou))return new Ou(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||Bu,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function Bu(e,t){return e<t?-1:e>t?1:0}function Fu(e,t,i){var r,n,o,s;t=t||1;for(var a=0;a<e[0].length;a++){var l=e[0][a];(!a||l[0]<r)&&(r=l[0]),(!a||l[1]<n)&&(n=l[1]),(!a||l[0]>o)&&(o=l[0]),(!a||l[1]>s)&&(s=l[1])}var u=o-r,c=s-n,h=Math.min(u,c),p=h/2,d=new Ou(null,Lu);if(0===h)return[r,n];for(var f=r;f<o;f+=h)for(var m=n;m<s;m+=h)d.push(new Iu(f+p,m+p,p,e));var g=Uu(e),v=new Iu(r+u/2,n+c/2,0,e);v.d>g.d&&(g=v);for(var y=d.length;d.length;){var b=d.pop();b.d>g.d&&(g=b,i&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,y)),b.max-g.d<=t||(p=b.h/2,d.push(new Iu(b.x-p,b.y-p,p,e)),d.push(new Iu(b.x+p,b.y-p,p,e)),d.push(new Iu(b.x-p,b.y+p,p,e)),d.push(new Iu(b.x+p,b.y+p,p,e)),y+=4)}return i&&(console.log("num probes: "+y),console.log("best distance: "+g.d)),[g.x,g.y]}function Lu(e,t){return t.max-e.max}function Iu(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=Nu(e,t,r),this.max=this.d+this.h*Math.SQRT2}function Nu(e,t,i){for(var r=!1,n=1/0,o=0;o<i.length;o++)for(var s=i[o],a=0,l=s.length,u=l-1;a<l;u=a++){var c=s[a],h=s[u];c[1]>t!=h[1]>t&&e<(h[0]-c[0])*(t-c[1])/(h[1]-c[1])+c[0]&&(r=!r),n=Math.min(n,zu(e,t,c,h))}return(r?1:-1)*Math.sqrt(n)}function Uu(e){for(var t=0,i=0,r=0,n=e[0],o=0,s=n.length,a=s-1;o<s;a=o++){var l=n[o],u=n[a],c=l[0]*u[1]-u[0]*l[1];i+=(l[0]+u[0])*c,r+=(l[1]+u[1])*c,t+=3*c}return 0===t?new Iu(n[0][0],n[0][1],0,e):new Iu(i/t,r/t,0,e)}function zu(e,t,i,r){var n=i[0],o=i[1],s=r[0]-n,a=r[1]-o;if(0!==s||0!==a){var l=((e-n)*s+(t-o)*a)/(s*s+a*a);l>1?(n=r[0],o=r[1]):l>0&&(n+=s*l,o+=a*l)}return(s=e-n)*s+(a=t-o)*a}Ou.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,i=this.compare,r=t[e];e>0;){var n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r},_down:function(e){for(var t=this.data,i=this.compare,r=this.length>>1,n=t[e];e<r;){var o=1+(e<<1),s=o+1,a=t[o];if(s<this.length&&i(t[s],a)<0&&(o=s,a=t[s]),i(a,n)>=0)break;t[e]=a,e=o}t[e]=n}};var Hu=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this._createChildren(),this._parseCorners(),this._parsePoints(),0===this.object.points.length&&console.warn("room points is null"),this._parseHolesCorners(),this._parseHolesPoints(),this._parseRoomResources(),this._parseRoomHeight(),this._parseRoomBlockSize(),this._parseRoomVisible(),this._parseRoomBlockAngle(),this._setOutdoorFloorHeight(),this.object.position=this._calRoomPosition(this.object),this._subRoomHolesPointsByPosition(this.object,this.object.position),this._subRoomPointsByPosition(this.object,this.object.position),this.object}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:Tu.FLOOR}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:Tu.CEILING}),this._parseJsonDataChild({jsonData:{},creatorType:Tu.ROOF}))}},{key:"_parseCorners",value:function(){if(this.jsonData.corners){for(var e=[],t=this.objectParent.typeToChildren.WallCorner,i=0;i<this.jsonData.corners.length;i++){var r=t[this.jsonData.corners[i]].position.slice();e.push(r)}this.object.points=e}}},{key:"_parsePoints",value:function(){if(this.jsonData.points){for(var e=[],t=0;t<this.jsonData.points.length;t++){var i=this.jsonData.points[t],r=[i[0],i[1],-i[2]];e.push(r)}this.object.points=e}}},{key:"_parseHolesCorners",value:function(){if(this.jsonData.holescorners){for(var e=[],t=this.objectParent.typeToChildren.WallCorner,i=0;i<this.jsonData.holescorners.length;i++){for(var r=this.jsonData.holescorners[i],n=[],o=0;o<r.length;o++){var s=r[o];n.push(t[s].position.slice())}e.push(n)}this.object.holes=e}}},{key:"_parseHolesPoints",value:function(){if(this.jsonData.holespoints){for(var e=[],t=0;t<this.jsonData.holespoints.length;t++){for(var i=this.jsonData.holespoints[t],r=[],n=0;n<i.length;n++){var o=i[n],s=[o[0],o[1],-o[2]];r.push(s)}e.push(r)}this.object.holes=e}}},{key:"_parseRoomResources",value:function(){null!==this.jsonData.floortexture&&void 0!==this.jsonData.floortexture&&(this.object.floorResource=this.resourceManager.textures[this.jsonData.floortexture],this.object.floor.resource=this.object.floorResource),this.object.ceiling&&null!==this.jsonData.ceilingtexture&&void 0!==this.jsonData.ceilingtexture&&(this.object.ceilingResource=this.resourceManager.textures[this.jsonData.ceilingtexture],this.object.ceiling.resource=this.object.ceilingResource),this.object.roof&&null!==this.jsonData.rooftexture&&void 0!==this.jsonData.rooftexture&&(this.object.roofResource=this.resourceManager.textures[this.jsonData.rooftexture],this.object.roof.resource=this.object.roofResource)}},{key:"_parseRoomHeight",value:function(){var e=this.jsonData,t=this.object;t.ceiling&&(void 0!==e.ceilingheight?t.ceiling.height=e.ceilingheight:(t.ceiling.DefaultHeight=this.objectParent.height-.1,t.ceiling.height=t.ceiling.DefaultHeight)),t.roof&&(void 0!==e.roofheight?t.roof.height=e.roofheight:(t.roof.defaultHeight=this.objectParent.height,t.roof.height=t.roof.defaultHeight)),void 0!==e.floorheight&&(t.floor.height=e.floorheight)}},{key:"_parseRoomVisible",value:function(){var e=this.jsonData,t=this.object;t.floor&&void 0!==e.isshowfloor&&(t.floor.visible=e.isshowfloor),t.ceiling&&void 0!==e.isshowceiling&&(t.ceiling.visible=e.isshowceiling),t.roof&&void 0!==e.isshowroof&&(t.roof.visible=e.isshowroof)}},{key:"_parseRoomBlockSize",value:function(){var e=this.jsonData,t=this.object;if(t.floor&&e.floorblocksize){var i=e.floorblocksize;t.floor.blockSize=[i[0],i[1]]}t.ceiling&&e.ceilingblocksize&&(i=e.ceilingblocksize,t.ceiling.blockSize=[i[0],i[1]]),t.roof&&e.roofblocksize&&(i=e.roofblocksize,t.roof.blockSize=[i[0],i[1]])}},{key:"_parseRoomBlockAngle",value:function(){var e=this.jsonData,t=this.object;t.floor&&e.floorblockangle&&(t.floor.blockAngle=e.floorblockangle),t.ceiling&&e.ceilingblockangle&&(t.ceiling.blockAngle=e.ceilingblockangle),t.roof&&e.roofblockangle&&(t.roof.blockAngle=e.roofblockangle)}},{key:"_setOutdoorFloorHeight",value:function(){var e=this.objectParent,t=this.object;"Outdoors"===e.type&&t.floor.height===t.floor.DefaultHeight&&(t.floor.height=0,t.floor.DefaultHeight=0)}},{key:"_calRoomPosition",value:function(e){for(var t=e.points,i=e.holes,r=[],n=[],o=0;o<t.length;o++){var s=t[o];r.push([s[0],s[2]])}if(i.length>2&&!this._isSamePoints(i))for(o=0;o<i.length;o++){for(var a=i[o],l=[],u=0;u<a.length;u++)s=a[u],l.push([s[0],s[2]]);n.push(l)}var c=this._getLabelPosition(r,n);return c||[0,0,0]}},{key:"_isSamePoints",value:function(e){for(var t=e[0],i=1;i<e.length;i++){var r=e[i];if(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2])return!1}return!0}},{key:"_getLabelPosition",value:function(e,t){if(!e||!e.length)return null;var i=[];i.push(e);var r=Fu(i);return[r[0],0,r[1]]}},{key:"_subRoomPointsByPosition",value:function(e,t){for(var i=e.points,r=0;r<i.length;r++){var n=i[r];n[0]-=t[0],n[1]-=t[1],n[2]-=t[2]}e.points=i}},{key:"_subRoomHolesPointsByPosition",value:function(e,t){for(var i=e.holes,r=0;r<i.length;r++)for(var n=i[r],o=0;o<n.length;o++){var s=n[o];s[0]-=t[0],s[1]-=t[1],s[2]-=t[2]}e.holes=i}}]),t}(wu),Vu=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return bu(t,e),t}(Su),Wu=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Facade",i}return bu(t,e),t}(Du),Gu=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FacadeGroup",i}return bu(t,e),vu(t,[{key:"create",value:function(e){this.initData(e);var t=this._getCreateParams();return this.object=this.creatorManager.objectManager.create(t),t.parent&&(this.object.parent=t.parent),this._loadBaseData(),this.jsonData.facades&&this._parseJsonDataChildren({jsonData:this.jsonData.facades,creatorType:Tu.FACADE}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:Tu.FACADEGROUP}),Eu.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(Au),qu=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CurveLine",i}return bu(t,e),vu(t,[{key:"create",value:function(e){yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.jsonData;if(Eu.checkValueEmpty(this.jsonData.texture)?this.object.resource=this.resourceManager.emptyTextureResource:this.object.resource=this.resourceManager.textures[this.jsonData.texture],this.jsonData.color){var r=this.jsonData.color;this.object.color=r,4===r.length&&(this.object.opacity=r[3])}if(void 0!==i.textiling){var n=i.textiling;this.object.textureTiling=n}if(void 0!==i.texoffset){var o=i.texoffset;this.object.textureOffset=o}!Eu.checkValueEmpty(this.jsonData.width)&&(this.object.width=this.jsonData.width),this.jsonData.enableanim&&(this.object.enableMaterialAnimation=this.jsonData.enableanim),!Eu.checkValueEmpty(this.jsonData.matanimspeed)&&(this.object.materialAnimationSpeed=this.jsonData.matanimspeed);for(var s=this.jsonData.path,a=0;a<s.length;a++){var l=s[a];l[2]=-l[2],this.object.points.push(l)}return this.object}}]),t}(wu),Xu=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PipeLine",i}return bu(t,e),vu(t,[{key:"create",value:function(e){if(yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),Eu.checkValueEmpty(this.jsonData.texture)?this.object.resource=this.resourceManager.emptyTextureResource:this.object.resource=this.resourceManager.textures[this.jsonData.texture],this.jsonData.color){var i=this.jsonData.color;this.object.color=i,4===i.length&&(this.object.opacity=i[3])}this.jsonData.sectionType&&(this.object.sectionType=this.jsonData.sectionType),!Eu.checkValueEmpty(this.jsonData.rendermode)&&(this.object.renderMode=this.jsonData.rendermode),!Eu.checkValueEmpty(this.jsonData.radius)&&(this.object.radius=this.jsonData.radius),this.jsonData.enableanim&&(this.object.enableMaterialAnimation=this.jsonData.enableanim),!Eu.checkValueEmpty(this.jsonData.matanimspeed)&&(this.object.materialAnimationSpeed=this.jsonData.matanimspeed);for(var r=this.jsonData.path,n=0;n<r.length;n++){var o=r[n];o[2]=-o[2],this.object.points.push(o)}return this.object}}]),t}(wu),Ju=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="LeakWaterLine",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.jsonData.alarmlength&&(this.object.alarmLength=this.jsonData.alarmlength),this.object}}]),t}(Xu),Yu=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ArrowLine",i}return bu(t,e),vu(t,[{key:"create",value:function(e){yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.object,r=this.jsonData;return null!==i.width&&(i.arrowWidth=3*i.width,i.arrowHeight=2*i.width),r.arrow?(Eu.checkValueEmpty(r.arrow.texture)?i.arrowResource=this.resourceManager.emptyTextureResource:i.arrowResource=this.resourceManager.textures[r.arrow.texture],r.arrow.width&&(i.arrowWidth=r.arrow.width),r.arrow.height&&(i.arrowHeight=r.arrow.height)):i.arrowResource=this.resourceManager.emptyTextureResource,this.object}}]),t}(qu),Zu=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ArrowDataLine",i}return bu(t,e),vu(t,[{key:"create",value:function(e){yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.object,r=this.jsonData;if(r.pointuserids){var n=r.pointuserids;i.pointUserIDs=n}if(r.pointproperteis){var o=r.pointproperteis;i.pointProperteis=o}return this.object}}]),t}(Yu),Qu=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="RouteLine",i}return bu(t,e),t}(qu),Ku=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="VideoProbe",i}return bu(t,e),t}(Du),$u=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementWall",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}}]),t}(Du),ec=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementGround",i}return bu(t,e),t}(Du),tc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Ceiling",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(wu),ic=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Roof",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(wu),rc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Floor",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(wu),nc=function(){function e(t){gu(this,e),this._map={0:Mu,1:Cu,2:Su,3:ju,4:Pu,5:Ru,6:Du,7:Au,8:ku,9:Hu,10:Vu,11:Wu,12:Gu,13:qu,14:Ju,15:Yu,16:Zu,17:Xu,18:Qu,19:Ku,20:$u,21:ec,22:rc,23:tc,24:ic}}return vu(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),oc=function(){function e(t){gu(this,e),this.config=new nc,this.objectManager=null,this.creatorMap={},this.creatorTypePlaceholderMap={}}return vu(e,[{key:"createObject",value:function(e){var t=e.creatorType,i=null;this.creatorMap[t]&&!this.creatorTypePlaceholderMap[t]?i=this.creatorMap[t]:(i=new(this.config.getClass(t))({creatorManager:this}),this.creatorMap[t]=i),this.creatorTypePlaceholderMap[t]||(this.creatorTypePlaceholderMap[t]=e.jsonData.id);var r=i.create(e),n=!0;return void 0!==e.enableCreateChildren&&null!==e.enableCreateChildren&&(n=e.enableCreateChildren),n&&i.parseChildren(),this.creatorTypePlaceholderMap[t]===r.id&&(this.creatorTypePlaceholderMap[t]=null),r}}]),e}(),sc=function(){function e(t){gu(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl,this.userDefaultWallLightMap=!0}return vu(e,[{key:"createResource",value:function(e,t){var i=this.manager.create({id:e,type:t});return i.manager=this.manager,i}},{key:"loadLightMaps",value:function(e){var t=null,i="18091219l1g1hnjt",r="png";e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(i=e.straightmanualwall.lightingtexture.id,r=e.straightmanualwall.lightingtexture.ext,this.manager.userDefaultWallLightMap=!1),(t=this.createResource(i,this.manager.ClassName.TextureResource)).baseUrl=this.manager.baseTextureUrl,t.id=i,t.ext=r,this.manager.wallLightMapResource=t,this.manager.textures.push(t)}},{key:"loadTextures",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];t=r.localurl?this._loadLocalCustomTextureResource(r):this._loadTextureResource(r),this.manager.textures.push(t)}}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource(e.id,"LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource(e.id,this.manager.ClassName.TextureResource);return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];if((t=r.model?this.createResource(r.id,"CustomResource"):r.localurl?this.createResource(r.id,"CustomModelResource"):this.createResource(r.id,this.manager.ClassName.ModelResource)).baseUrl=this.baseModelUrl,r.localurl){if(t.localUrl=r.localurl,t.id=r.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,r.title&&(t.modelName=r.title),t.modelID=r.id,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.color){var n=r.color;t.color=[n[0],n[1],n[2]],4===n.length&&(t.opacity=n[3])}}else if(r.id){if(t.id=r.id,t.modelID=r.id,t.version=r.version,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.model&&(t.modelID=r.model),r.title&&(t.modelName=r.title),r.color&&(n=r.color,t.color=[n[0],n[1],n[2]],4===n.length&&(t.opacity=n[3])),r.size){var o=r.size;t.size=o}r.hasanimation&&(t.hasAnim=r.hasanimation),r.url&&(t.url=r.url)}for(var s=0;s<this.manager.ableToSupportFootAndHeadModelWalls.length;s++){var a=this.manager.ableToSupportFootAndHeadModelWalls[s];if(t.id===a){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var i=e.color;t.color=[i[0],i[1],i[2]],4===i.length&&(t.opacity=i[3])}if(e.size){var r=e.size;t.modelSize=[r[0],r[1],r[2]]}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),ac=function(){function e(){gu(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new nc,this.creatorManager=new oc}return vu(e,[{key:"setObjectTypeConfig",value:function(e){objectManager.objectTypeConfig=e}},{key:"setObjectManager",value:function(e){this.creatorManager.objectManager=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"loadLightMaps",value:function(e){var t=null,i="18091219l1g1hnjt",r="png",n="18091216vjlgtwbh";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(i=e.straightmanualwall.lightingtexture.id,r=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource(this.resourceManager.ClassName.TextureResource)).baseUrl=this.resourceManager.baseTextureUrl,t.id=i,t.ext=r,this.defaultResource.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource(this.resourceManager.ClassName.TextureResource)).baseUrl=this.resourceManager.baseTextureUrl,t.id=n,t.ext="jpg",this.defaultResource.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=this.resourceManager.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),t.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++)i+=t[r]+"/";return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,i){e.sceneJson?t(e.sceneJson):e.sceneURL?(new THREE.FileLoader).load(e.sceneURL,(function(i){e.sceneJson=JSON.parse(i),t()}),(function(){}),(function(t){i("can not load "+e.sceneURL)})):i("load scene json error")}))}},{key:"getResourceLoader",value:function(){return new sc(this.resourceManager)}},{key:"parseSceneJson",value:function(){this.parseResources(this.sceneJson,this.resourceManager),this.parseWorld(this.sceneJson)}},{key:"parseResources",value:function(e,t){var i=new sc(t);i.loadTextures(e.textures),i.loadModels(e.models),i.loadLightMaps(e.materialsetting)}},{key:"parseWorld",value:function(e){this.world=this.creatorManager.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:Tu.WORLD})}},{key:"getCreatorManager",value:function(){return this.creatorManager}},{key:"getCreatorConfig",value:function(){return new nc}}]),e}(),lc=function(){function e(t){gu(this,e),this.creatorManager=t.creatorManager}return vu(e,[{key:"initData",value:function(e){this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=e.jsonData,this.objectParent=null,e.parent&&(this.objectParent=e.parent),this.resourceManager=e.resourceManager}},{key:"create",value:function(e){this.initData(e);var t=this._getCreateParams();return this.object=this.creatorManager.objectManager.create(t),t.parent&&(this.object.parent=t.parent),this._loadBaseData(),this.object}},{key:"_loadBaseData",value:function(){if(this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.jsonData=this.jsonData,this._initIDOnesPlaceNumber(),this.jsonData.position){var e=this.jsonData.position.slice();this._decodePosition(e),e[2]=-e[2],this.object.position=e}if(this.jsonData.scale){var t=this.jsonData.scale.slice();this._decodeScale(t),0===t[0]&&(t[0]=.01),0===t[1]&&(t[1]=.01),0===t[2]&&(t[2]=.01),this.object.scale=t}if(this.jsonData.rotation){var i=this.jsonData.rotation.slice();this._decodeRotation(i),i[2]=-i[2],i[3]=-i[3],this.object.rotation=i}if(this.jsonData.properties&&(this.object.properties=this.jsonData.properties,this.object.lowerCaseProperties=this.convertPropertiesToLowerCase(this.jsonData.properties)),Eu.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.jsonData.caminfo){var r=this.jsonData.caminfo.eye,n=this.jsonData.caminfo.target;r[2]=-r[2],n[2]=-n[2],this.object.camInfo={eye:r,target:n}}}},{key:"_initIDOnesPlaceNumber",value:function(){var e=this.object.id,t=-1,i=Number(e);if(isNaN(i)){if(t=0,this._isUUID(e)){var r=e.slice(e.length-2);if(r){var n=parseInt(r,16);isNaN(n)||(t=n)}}}else t=(i=parseInt(e.substring(e.length-1)))%10;this.decodeIDOnesPlace=1^t}},{key:"_decodePosition",value:function(e){0!==e[0]&&(e[0]=this._decodeNumber(e[0])),0!==e[1]&&(e[1]=this._decodeNumber(e[1])),0!==e[2]&&(e[2]=this._decodeNumber(e[2]))}},{key:"_decodeScale",value:function(e){1!==e[0]&&(e[0]=this._decodeNumber(e[0])),1!==e[1]&&(e[1]=this._decodeNumber(e[1])),1!==e[2]&&(e[2]=this._decodeNumber(e[2]))}},{key:"_decodeRotation",value:function(e){0!==e[0]&&(e[0]=this._decodeNumber(e[0])),0!==e[1]&&(e[1]=this._decodeNumber(e[1])),0!==e[2]&&(e[2]=this._decodeNumber(e[2]))}},{key:"_decodeNumber",value:function(e){return e>0?e-this.decodeIDOnesPlace:e+this.decodeIDOnesPlace}},{key:"_decodeArray",value:function(e){for(var t=0;t<e.length;t++)e[t],0!==e[t]&&(e[t]=e[t]>0?e[t]-this.decodeIDOnesPlace:e[t]+this.decodeIDOnesPlace)}},{key:"convertPropertiesToLowerCase",value:function(e){var t={};for(var i in e)t[i.toLowerCase()]=e[i].toLowerCase();return t}},{key:"parseChildren",value:function(){}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,this.creatorManager.createObject(e)}},{key:"_isUUID",value:function(e){var t=""+e;return null!==(t=t.match("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"))}}]),e}(),uc={WORLD:0,BUILDING:1,FLOORPLAN:2,WALLCORNER:3,MODELWALL:4,STRAIGHTMANUALWALL:5,PLACEMENT:6,PLACEMENTGROUP:7,DOORORWINDOW:8,ROOM:9,OUTDOORS:10,FACADE:11,FACADEGROUP:12,CURVELINE:13,LEAKWATERLINE:14,ARROWLINE:15,ARROWDATALINE:16,PIPELINE:17,ROUTELINE:18,VIDEOPROBE:19,PLACEMENTWALL:20,PLACEMENTGROUND:21,FLOOR:22,CEILING:23,ROOF:24},cc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return bu(t,e),vu(t,[{key:"parseChildren",value:function(){var e=this.jsonData;if(e.outdoors){var t=this._parseJsonDataChild({jsonData:e.outdoors,creatorType:uc.OUTDOORS});this.object.outdoors=t}e.buildings&&this._parseJsonDataChildren({jsonData:e.buildings,creatorType:uc.BUILDING})}}]),t}(lc),hc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),Eu.checkValueEmpty(this.jsonData.structshow)||(this.object.structShow=this.jsonData.structshow),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.facades&&this._parseJsonDataChildren({jsonData:e.facades,creatorType:uc.FACADE}),e.facadegroups&&this._parseJsonDataChildren({jsonData:e.facadegroups,creatorType:uc.FACADEGROUP}),e.plans&&this._parseJsonDataChildren({jsonData:e.plans,creatorType:uc.FLOORPLAN})}}]),t}(lc),pc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),Eu.checkValueEmpty(this.jsonData.alwaysshowinsideobjs)||(this.object.alwaysShowInsideObjs=this.jsonData.alwaysshowinsideobjs),Eu.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.corners&&this._parseCorners(e.corners),e.walls&&this._parseWalls(e.walls),e.rooms&&(this._parseJsonDataChildren({jsonData:e.rooms,creatorType:uc.ROOM}),this.object.calRoomsUV2()),e.placements&&this._parseJsonDataChildren({jsonData:e.placements,creatorType:uc.PLACEMENT}),e.groups&&this._parseJsonDataChildren({jsonData:e.groups,creatorType:uc.PLACEMENTGROUP}),e.curvelines&&this._parseJsonDataChildren({jsonData:e.curvelines,creatorType:uc.CURVELINE}),e.routelines&&this._parseJsonDataChildren({jsonData:e.routelines,creatorType:uc.ROUTELINE}),e.leakwaterlines&&this._parseJsonDataChildren({jsonData:e.leakwaterlines,creatorType:uc.LEAKWATERLINE}),e.arrowlines&&this._parseJsonDataChildren({jsonData:e.arrowlines,creatorType:uc.ARROWLINE}),e.arrowdatalines&&this._parseJsonDataChildren({jsonData:e.arrowdatalines,creatorType:uc.ARROWDATALINE}),e.pipelines&&this._parseJsonDataChildren({jsonData:e.pipelines,creatorType:uc.PIPELINE}),e.videoprobes&&this._parseJsonDataChildren({jsonData:e.videoprobes,creatorType:uc.VIDEOPROBE}),e.grounds&&this._parseJsonDataChildren({jsonData:e.grounds,creatorType:uc.PLACEMENTGROUND})}},{key:"_parseCorners",value:function(e){for(var t=0;t<e.length;t++){var i=e[t],r=i[0],n=i[1],o=-i[2];this.object.existsCorner(r,n,o)?console.error("repeat corner"):this._parseJsonDataChild({jsonData:i,creatorType:uc.WALLCORNER})}}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var i=e[t],r=null;0===i.type?r=this._parseJsonDataChild({jsonData:i,creatorType:uc.STRAIGHTMANUALWALL}):1===i.type?r=this._parseJsonDataChild({jsonData:i,creatorType:uc.MODELWALL}):2===i.type&&(r=this._parseJsonDataChild({jsonData:i,creatorType:uc.PLACEMENTWALL})),i.doororwindows&&this._parseDoorOrWindows(i.doororwindows,r)}}},{key:"_parseDoorOrWindows",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i];this._parseJsonDataChild({jsonData:r,attachWall:t,creatorType:uc.DOORORWINDOW})}}}]),t}(lc),dc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="WallCorner",i}return bu(t,e),vu(t,[{key:"create",value:function(e){yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.jsonData.slice();this._decodeArray(i);var r=i[0],n=i[1],o=-i[2];return this.object.position=[r,n,o],this.object}},{key:"_initIDOnesPlaceNumber",value:function(){var e=this.object.parent.id;"Outdoors"===this.object.parent.type&&(e="3");var t=-1,i=Number(e);if(isNaN(i)){if(t=0,this._isUUID(e)){var r=e.slice(e.length-2);if(r){var n=parseInt(r,16);isNaN(n)||(t=n)}}}else t=(i=parseInt(e.substring(e.length-1)))%10;this.decodeIDOnesPlace=1^t}}]),t}(lc),fc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ModelWall",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this._parseCorners(),Eu.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),Eu.checkValueEmpty(this.jsonData.height)?this.object.height=this.object.resource.size[1]:this.object.height=this.jsonData.height,Eu.checkValueEmpty(this.jsonData.thick)||(this.object.thick=this.jsonData.thick),this.object}},{key:"_parseCorners",value:function(){var e=this.jsonData.corners,t=this.objectParent.typeToChildren.WallCorner;this.object.startCorner=t[e[0]],this.object.endCorner=t[e[1]]}}]),t}(lc),mc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="StraightManualWall",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this._parseCorners(),this._parseResources(),this.jsonData.uvmultiple&&(this.object.uvMultiple=this.jsonData.uvmultiple),Eu.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),Eu.checkValueEmpty(this.jsonData.thick)||(this.object.thick=this.jsonData.thick),this.object}},{key:"_parseCorners",value:function(){var e=this.jsonData.corners,t=this.objectParent.typeToChildren.WallCorner;this.object.startCorner=t[e[0]],this.object.endCorner=t[e[1]]}},{key:"_parseResources",value:function(){Eu.checkValueEmpty(this.jsonData.lefttexture)||(this.object.leftResource=this.resourceManager.textures[this.jsonData.lefttexture]),Eu.checkValueEmpty(this.jsonData.righttexture)||(this.object.rightResource=this.resourceManager.textures[this.jsonData.righttexture]),Eu.checkValueEmpty(this.jsonData.edgetexture)||(this.object.edgeResource=this.resourceManager.textures[this.jsonData.edgetexture]),this.resourceManager.wallLightMapResource&&(this.object.lightMapResource=this.resourceManager.wallLightMapResource)}}]),t}(lc),gc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Placement",i}return bu(t,e),vu(t,[{key:"create",value:function(e){if(yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object.resource=this.resourceManager.models[this.jsonData.model],Eu.checkValueEmpty(this.jsonData.texture)||(this.object.customTextureResource=this.resourceManager.textures[this.jsonData.texture]),this.jsonData.color){var i=this.jsonData.color;this.object.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(this.object.opacity=i[3])}return Eu.checkValueEmpty(this.jsonData.rendermode)||(this.object.renderMode=this.jsonData.rendermode),this.jsonData.animinfo&&(this.object.isPlayAnim=this.jsonData.animinfo.isplay,this.object.animClip=this.jsonData.animinfo.clip),Eu.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(lc),vc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementGroup",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.jsonData.placements&&this._parseJsonDataChildren({jsonData:this.jsonData.placements,creatorType:uc.PLACEMENT}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:uc.PLACEMENTGROUP}),this.jsonData.videoprobes&&this._parseJsonDataChildren({jsonData:this.jsonData.videoprobes,creatorType:uc.VIDEOPROBE}),Eu.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(lc),yc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="DoorOrWindow",i}return bu(t,e),vu(t,[{key:"initData",value:function(e){yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initData",this).call(this,e),this.attachWall=e.attachWall}},{key:"create",value:function(e){if(yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object.resource=this.resourceManager.models[this.jsonData.model],Eu.checkValueEmpty(this.jsonData.suspendpercent)||(this.object.suspendPercent=this.jsonData.suspendpercent),Eu.checkValueEmpty(this.jsonData.isopen)||(this.object.isOpen=this.jsonData.isopen),Eu.checkValueEmpty(this.jsonData.diridx)||(this.object.openDirIndex=this.jsonData.diridx),!Eu.checkValueEmpty(this.jsonData.iswindow)){var i=this.jsonData.iswindow;"string"==typeof i&&(i="false"!==i.toLocaleString()),this.object.isWindow=i}return this.object.attachWall=this.attachWall,this.attachWall.doorOrWindows.push(this.object),this.object}}]),t}(lc),bc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Room",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this._createChildren(),this._parseCorners(),this._parsePoints(),0===this.object.points.length&&console.warn("room points is null"),this._parseHolesCorners(),this._parseHolesPoints(),this._parseRoomResources(),this._parseRoomHeight(),this._parseRoomBlockSize(),this._parseRoomVisible(),this._parseRoomBlockAngle(),this._setOutdoorFloorHeight(),this.object.position=this._calRoomPosition(this.object),this._subRoomHolesPointsByPosition(this.object,this.object.position),this._subRoomPointsByPosition(this.object,this.object.position),this.object}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:uc.FLOOR}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:uc.CEILING}),this._parseJsonDataChild({jsonData:{},creatorType:uc.ROOF}))}},{key:"_parseCorners",value:function(){if(this.jsonData.corners){for(var e=[],t=this.objectParent.typeToChildren.WallCorner,i=0;i<this.jsonData.corners.length;i++){var r=t[this.jsonData.corners[i]].position.slice();e.push(r)}this.object.points=e}}},{key:"_parsePoints",value:function(){if(this.jsonData.points){for(var e=[],t=0;t<this.jsonData.points.length;t++){var i=this.jsonData.points[t],r=[i[0],i[1],-i[2]];e.push(r)}this.object.points=e}}},{key:"_parseHolesCorners",value:function(){if(this.jsonData.holescorners){for(var e=[],t=this.objectParent.typeToChildren.WallCorner,i=0;i<this.jsonData.holescorners.length;i++){for(var r=this.jsonData.holescorners[i],n=[],o=0;o<r.length;o++){var s=r[o];n.push(t[s].position.slice())}e.push(n)}this.object.holes=e}}},{key:"_parseHolesPoints",value:function(){if(this.jsonData.holespoints){for(var e=[],t=0;t<this.jsonData.holespoints.length;t++){for(var i=this.jsonData.holespoints[t],r=[],n=0;n<i.length;n++){var o=i[n],s=[o[0],o[1],-o[2]];r.push(s)}e.push(r)}this.object.holes=e}}},{key:"_parseRoomResources",value:function(){null!==this.jsonData.floortexture&&void 0!==this.jsonData.floortexture&&(this.object.floorResource=this.resourceManager.textures[this.jsonData.floortexture],this.object.floor.resource=this.object.floorResource),this.object.ceiling&&null!==this.jsonData.ceilingtexture&&void 0!==this.jsonData.ceilingtexture&&(this.object.ceilingResource=this.resourceManager.textures[this.jsonData.ceilingtexture],this.object.ceiling.resource=this.object.ceilingResource),this.object.roof&&null!==this.jsonData.rooftexture&&void 0!==this.jsonData.rooftexture&&(this.object.roofResource=this.resourceManager.textures[this.jsonData.rooftexture],this.object.roof.resource=this.object.roofResource)}},{key:"_parseRoomHeight",value:function(){var e=this.jsonData,t=this.object;t.ceiling&&(void 0!==e.ceilingheight?t.ceiling.height=e.ceilingheight:(t.ceiling.DefaultHeight=this.objectParent.height-.1,t.ceiling.height=t.ceiling.DefaultHeight)),t.roof&&(void 0!==e.roofheight?t.roof.height=e.roofheight:(t.roof.defaultHeight=this.objectParent.height,t.roof.height=t.roof.defaultHeight)),void 0!==e.floorheight&&(t.floor.height=e.floorheight)}},{key:"_parseRoomVisible",value:function(){var e=this.jsonData,t=this.object;t.floor&&void 0!==e.isshowfloor&&(t.floor.visible=e.isshowfloor),t.ceiling&&void 0!==e.isshowceiling&&(t.ceiling.visible=e.isshowceiling),t.roof&&void 0!==e.isshowroof&&(t.roof.visible=e.isshowroof)}},{key:"_parseRoomBlockSize",value:function(){var e=this.jsonData,t=this.object;if(t.floor&&e.floorblocksize){var i=e.floorblocksize;t.floor.blockSize=[i[0],i[1]]}t.ceiling&&e.ceilingblocksize&&(i=e.ceilingblocksize,t.ceiling.blockSize=[i[0],i[1]]),t.roof&&e.roofblocksize&&(i=e.roofblocksize,t.roof.blockSize=[i[0],i[1]])}},{key:"_parseRoomBlockAngle",value:function(){var e=this.jsonData,t=this.object;t.floor&&e.floorblockangle&&(t.floor.blockAngle=e.floorblockangle),t.ceiling&&e.ceilingblockangle&&(t.ceiling.blockAngle=e.ceilingblockangle),t.roof&&e.roofblockangle&&(t.roof.blockAngle=e.roofblockangle)}},{key:"_setOutdoorFloorHeight",value:function(){var e=this.objectParent,t=this.object;"Outdoors"===e.type&&t.floor.height===t.floor.DefaultHeight&&(t.floor.height=0,t.floor.DefaultHeight=0)}},{key:"_calRoomPosition",value:function(e){for(var t=e.points,i=e.holes,r=[],n=[],o=0;o<t.length;o++){var s=t[o];r.push([s[0],s[2]])}if(i.length>2&&!this._isSamePoints(i))for(o=0;o<i.length;o++){for(var a=i[o],l=[],u=0;u<a.length;u++)s=a[u],l.push([s[0],s[2]]);n.push(l)}var c=this._getLabelPosition(r,n);return c||[0,0,0]}},{key:"_isSamePoints",value:function(e){for(var t=e[0],i=1;i<e.length;i++){var r=e[i];if(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2])return!1}return!0}},{key:"_getLabelPosition",value:function(e,t){if(!e||!e.length)return null;var i=[];i.push(e);var r=Fu(i);return[r[0],0,r[1]]}},{key:"_subRoomPointsByPosition",value:function(e,t){for(var i=e.points,r=0;r<i.length;r++){var n=i[r];n[0]-=t[0],n[1]-=t[1],n[2]-=t[2]}e.points=i}},{key:"_subRoomHolesPointsByPosition",value:function(e,t){for(var i=e.holes,r=0;r<i.length;r++)for(var n=i[r],o=0;o<n.length;o++){var s=n[o];s[0]-=t[0],s[1]-=t[1],s[2]-=t[2]}e.holes=i}}]),t}(lc),_c=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return bu(t,e),t}(pc),xc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Facade",i}return bu(t,e),t}(gc),Ec=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FacadeGroup",i}return bu(t,e),vu(t,[{key:"create",value:function(e){this.initData(e);var t=this._getCreateParams();return this.object=this.creatorManager.objectManager.create(t),t.parent&&(this.object.parent=t.parent),this._loadBaseData(),this.jsonData.facades&&this._parseJsonDataChildren({jsonData:this.jsonData.facades,creatorType:uc.FACADE}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:uc.FACADEGROUP}),Eu.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(vc),wc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="CurveLine",i}return bu(t,e),vu(t,[{key:"create",value:function(e){yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.jsonData;if(Eu.checkValueEmpty(this.jsonData.texture)?this.object.resource=this.resourceManager.emptyTextureResource:this.object.resource=this.resourceManager.textures[this.jsonData.texture],this.jsonData.color){var r=this.jsonData.color;this.object.color=r,4===r.length&&(this.object.opacity=r[3])}if(void 0!==i.textiling){var n=i.textiling;this.object.textureTiling=n}if(void 0!==i.texoffset){var o=i.texoffset;this.object.textureOffset=o}!Eu.checkValueEmpty(this.jsonData.width)&&(this.object.width=this.jsonData.width),this.jsonData.enableanim&&(this.object.enableMaterialAnimation=this.jsonData.enableanim),!Eu.checkValueEmpty(this.jsonData.matanimspeed)&&(this.object.materialAnimationSpeed=this.jsonData.matanimspeed);for(var s=this.jsonData.path,a=0;a<s.length;a++){var l=s[a];l[2]=-l[2],this.object.points.push(l)}return this.object}}]),t}(lc),Tc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PipeLine",i}return bu(t,e),vu(t,[{key:"create",value:function(e){if(yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),Eu.checkValueEmpty(this.jsonData.texture)?this.object.resource=this.resourceManager.emptyTextureResource:this.object.resource=this.resourceManager.textures[this.jsonData.texture],this.jsonData.color){var i=this.jsonData.color;this.object.color=i,4===i.length&&(this.object.opacity=i[3])}this.jsonData.sectionType&&(this.object.sectionType=this.jsonData.sectionType),!Eu.checkValueEmpty(this.jsonData.rendermode)&&(this.object.renderMode=this.jsonData.rendermode),!Eu.checkValueEmpty(this.jsonData.radius)&&(this.object.radius=this.jsonData.radius),this.jsonData.enableanim&&(this.object.enableMaterialAnimation=this.jsonData.enableanim),!Eu.checkValueEmpty(this.jsonData.matanimspeed)&&(this.object.materialAnimationSpeed=this.jsonData.matanimspeed);for(var r=this.jsonData.path,n=0;n<r.length;n++){var o=r[n];o[2]=-o[2],this.object.points.push(o)}return this.object}}]),t}(lc),Mc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="LeakWaterLine",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.jsonData.alarmlength&&(this.object.alarmLength=this.jsonData.alarmlength),this.object}}]),t}(Tc),Cc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ArrowLine",i}return bu(t,e),vu(t,[{key:"create",value:function(e){yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.object,r=this.jsonData;return null!==i.width&&(i.arrowWidth=3*i.width,i.arrowHeight=2*i.width),r.arrow?(Eu.checkValueEmpty(r.arrow.texture)?i.arrowResource=this.resourceManager.emptyTextureResource:i.arrowResource=this.resourceManager.textures[r.arrow.texture],r.arrow.width&&(i.arrowWidth=r.arrow.width),r.arrow.height&&(i.arrowHeight=r.arrow.height)):i.arrowResource=this.resourceManager.emptyTextureResource,this.object}}]),t}(wc),Sc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="ArrowDataLine",i}return bu(t,e),vu(t,[{key:"create",value:function(e){yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var i=this.object,r=this.jsonData;if(r.pointuserids){var n=r.pointuserids;i.pointUserIDs=n}if(r.pointproperteis){var o=r.pointproperteis;i.pointProperteis=o}return this.object}}]),t}(Cc),jc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="RouteLine",i}return bu(t,e),t}(wc),Pc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="VideoProbe",i}return bu(t,e),t}(gc),Rc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementWall",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}}]),t}(gc),Dc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="PlacementGround",i}return bu(t,e),t}(gc),Ac=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Ceiling",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(lc),kc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Roof",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(lc),Oc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Floor",i}return bu(t,e),vu(t,[{key:"create",value:function(e){return yu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(lc),Bc=function(){function e(t){gu(this,e),this._map={0:cc,1:hc,2:pc,3:dc,4:fc,5:mc,6:gc,7:vc,8:yc,9:bc,10:_c,11:xc,12:Ec,13:wc,14:Mc,15:Cc,16:Sc,17:Tc,18:jc,19:Pc,20:Rc,21:Dc,22:Oc,23:Ac,24:kc}}return vu(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),Fc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.config=new Bc,i}return bu(t,e),t}(oc),Lc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.creatorManager=new Fc,i}return bu(t,e),t}(ac),Ic=function(e){function t(e){return gu(this,t),_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return bu(t,e),vu(t,[{key:"parseObjects",value:function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl?this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl:this.resourceManager.localCustomModelBaseUrl="https://www.thingjs.com/",t.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}}]),t}(ac),Nc=function(e){function t(e){return gu(this,t),_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return bu(t,e),t}(Fc),Uc=function(e){function t(e){gu(this,t);var i=_u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.creatorManager=new Nc,i}return bu(t,e),t}(Ic),zc=new(function(){function e(t){gu(this,e),this._versionMap={0:{0:ac,1:ac,2:Lc},1:{0:Ic,2:Uc}},this._smallVersionLibs=[[0,1,2],[0,2]],this._bigVersions=[0,1]}return vu(e,[{key:"getLoaderManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1],r=i[i.length-1];return new this._versionMap[this._bigVersions.length-1][r]}if(null==t){var n=this._smallVersionLibs[e],o=n[n.length-1];return new this._versionMap[e][o]}var s=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1])){var a=s[s.length-1];return t>a||!this._versionMap[e][t]?new this._versionMap[e][a]:new this._versionMap[e][t]}console.error("ubuilderLoader not support version "+e+"."+t)}}]),e}()),Hc=function(){function e(t){gu(this,e),this.resourceManager=t.resourceManager,this.defaultSetting=t.defaultSetting,this.defaultResource=t.defaultResource,this.objectManager=t.objectManager}return vu(e,[{key:"load",value:function(e){return this.getLoaderManager(e.bigVersion,e.smallVersion).parseObjects(e)}},{key:"getLoaderManager",value:function(e,t){var i=zc.getLoaderManager(e,t);return i.setDefaultSetting(this.defaultSetting),i.setDefaultResource(this.defaultResource),i.setResourceManager(this.resourceManager),i.setObjectManager(this.objectManager),i}},{key:"clear",value:function(){this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.objectManager=null}}]),e}(),Vc=function(e){function t(e){p(this,t);var i=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));i.sceneJson=null,i.world=null,i.debugManager=Nt;var r=new ii,n=new Si;return r.meshBuilderManager=Nn.create(),r.calculaterManager=$r.create(),r.calculaterManager.testInfo=e,n.modelCombineBuilder=Yn,i.objectManager=r,i.loader=new Hc({objectManager:r,resourceManager:n,defaultSetting:mt,defaultResource:yt}),i.combineManager=new Bo({objectManager:r}),i.dynamicBuildManager=new Ze(i),i.dynamicBuildManager.testInfo=e,i.objectsMap={},i.enableRequestWorld=!0,i.loadVersion=null,i.resourceManager=n,i}return f(t,e),d(t,[{key:"setResourcesUnitDownloadNumber",value:function(e){this.dynamicBuildManager.maxResourcesUnitDownloadNumber=e}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"clearAllResources",value:function(){this.resourceManager.clear(),this.objectManager.meshBuilderManager.clear(),this.objectManager.calculaterManager.clear(),this.dynamicBuildManager.clear()}},{key:"clearAllObjects",value:function(){this.world.clear()}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"disposeObject",value:function(e){var t=this.world.findObjectByID(e);t&&t.clearBuildMesh()}},{key:"findObjectByID",value:function(e){return this.world.findObjectByID(e)}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this;return i.world=i.loader.load(e),i.combineManager.parse(i.world),i.dynamicBuildManager.world=i.world,i.enableRequestWorld&&i.requestToBuild(i.world.id),t?i.world:new Promise((function(e,t){e(i.world)}))}},{key:"downloadResourceProgress",get:function(){return meshBuilderManager.downloadResProgess}}]),t}(Ya),Wc=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Gc=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),qc=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},Xc=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Jc=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},Yc=new(function(){function e(t){Wc(this,e),this.config=null,this.objectManager=null,this.creatorMap={},this.creatorTypePlaceholderMap={},this.loadModeConfig={}}return Gc(e,[{key:"addLoadDataType",value:function(e,t){this.loadModeConfig[e]=t}},{key:"createObject",value:function(e){var t=e.creatorType,i=null;this.creatorMap[t]&&!this.creatorTypePlaceholderMap[t]?i=this.creatorMap[t]:(i=new(this.config.getClass(t)),this.creatorMap[t]=i),this.creatorTypePlaceholderMap[t]||(this.creatorTypePlaceholderMap[t]=e.jsonData.id);var r=i.create(e);return i.parseChildren(),this.creatorTypePlaceholderMap[t]===r.id&&(this.creatorTypePlaceholderMap[t]=null),r}}]),e}()),Zc=function(){function e(t,i){Wc(this,e);var r=t.loadversion;if(this.mode=3,this.bigVersion=null,this.smallVersion=null,r)if(isNaN(r)){var n=r.split(".");this.mode=parseInt(n[0]),n[1]&&(this.bigVersion=parseInt(n[1])),n[2]&&(this.smallVersion=parseInt(n[2]))}else this.mode=r;else i&&i.dataVersion&&(this.mode=i.dataVersion.getMode())}return Gc(e,[{key:"getMode",value:function(){return this.mode}},{key:"getBigVersion",value:function(){return this.bigVersion}},{key:"getSmallVersion",value:function(){return this.smallVersion}}]),e}(),Qc=function(){function e(t){Wc(this,e)}return Gc(e,[{key:"initData",value:function(e){this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=e.jsonData,this.objectParent=null,e.parent&&(this.objectParent=e.parent),this.resourceManager=e.resourceManager}},{key:"create",value:function(e){this.initData(e);var t=new Zc(this.jsonData,this.objectParent),i=Yc.loadModeConfig[t.getMode()].getLoaderManager(t.getBigVersion(),t.getSmallVersion()).getCreatorManager();return this.object=i.createObject(this._initCreateParams(e)),this.object.dataVersion=t,this.object.children.forEach((function(e){return e.dataVersion=t})),this.object}},{key:"parseChildren",value:function(){}},{key:"_initCreateParams",value:function(e){return e.enableCreateChildren=!1,e}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,i=e.creatorType,r=0;r<t.length;r++)this._parseJsonDataChild({jsonData:t[r],creatorType:i})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,Yc.createObject(e)}}]),e}(),Kc={WORLD:0,BUILDING:1,FLOORPLAN:2,WALLCORNER:3,MODELWALL:4,STRAIGHTMANUALWALL:5,PLACEMENT:6,PLACEMENTGROUP:7,DOORORWINDOW:8,ROOM:9,OUTDOORS:10,FACADE:11,FACADEGROUP:12,CURVELINE:13,LEAKWATERLINE:14,ARROWLINE:15,ARROWDATALINE:16,PIPELINE:17,ROUTELINE:18,VIDEOPROBE:19,PLACEMENTWALL:20,PLACEMENTGROUND:21,FLOOR:22,CEILING:23,ROOF:24},$c=function(e){function t(e){Wc(this,t);var i=Jc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="World",i}return Xc(t,e),Gc(t,[{key:"parseChildren",value:function(){var e=this.jsonData;if(e.outdoors){var t=this._parseJsonDataChild({jsonData:e.outdoors,creatorType:Kc.OUTDOORS});this.object.outdoors=t}e.buildings&&this._parseJsonDataChildren({jsonData:e.buildings,creatorType:Kc.BUILDING})}}]),t}(Qc),eh=function(e){function t(e){Wc(this,t);var i=Jc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Building",i}return Xc(t,e),Gc(t,[{key:"create",value:function(e){return qc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.facades&&this._parseJsonDataChildren({jsonData:e.facades,creatorType:Kc.FACADE}),e.facadegroups&&this._parseJsonDataChildren({jsonData:e.facadegroups,creatorType:Kc.FACADEGROUP}),e.plans&&this._parseJsonDataChildren({jsonData:e.plans,creatorType:Kc.FLOORPLAN})}}]),t}(Qc),th=function(e){function t(e){Wc(this,t);var i=Jc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FloorPlan",i}return Xc(t,e),Gc(t,[{key:"_initCreateParams",value:function(e){return e.enableCreateChildren=!0,e}},{key:"create",value:function(e){return qc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}}]),t}(Qc),ih=function(e){function t(e){Wc(this,t);var i=Jc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Outdoors",i}return Xc(t,e),t}(th),rh=function(e){function t(e){Wc(this,t);var i=Jc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="Facade",i}return Xc(t,e),t}(Qc),nh=function(e){function t(e){Wc(this,t);var i=Jc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createType="FacadeGroup",i}return Xc(t,e),Gc(t,[{key:"_initCreateParams",value:function(e){return e.enableCreateChildren=!0,e}}]),t}(Qc),oh=function(){function e(t){Wc(this,e),this._map={0:$c,1:eh,2:th,10:ih,11:rh,12:nh}}return Gc(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),sh=function(){function e(t){Wc(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl,this.userDefaultWallLightMap=!0}return Gc(e,[{key:"createResource",value:function(e,t){var i=this.manager.create({id:e,type:t});return i.manager=this.manager,i}},{key:"loadLightMaps",value:function(e){var t=null,i="18091219l1g1hnjt",r="png";e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(i=e.straightmanualwall.lightingtexture.id,r=e.straightmanualwall.lightingtexture.ext,this.userDefaultWallLightMap=!1),(t=this.createResource(i,this.manager.ClassName.TextureResource)).baseUrl=this.manager.baseTextureUrl,t.id=i,t.ext=r,this.manager.wallLightMapResource=t,this.manager.textures.push(t)}},{key:"loadTextures",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];t=r.localurl?this._loadLocalCustomTextureResource(r):this._loadTextureResource(r),this.manager.textures.push(t)}}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource(e.id,"LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource(e.id,this.manager.ClassName.TextureResource);return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i],n=new Zc(r);if(r.model)t=this.createResource(r.id,"CustomResource");else if(r.localurl){var o="CustomModelResource";5===n.getMode()&&(o="Max2TjsResource"),t=this.createResource(r.id,o)}else t=this.createResource(r.id,this.manager.ClassName.ModelResource);if(t.baseUrl=this.baseModelUrl,r.localurl){if(t.localUrl=r.localurl,t.id=r.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,r.title&&(t.modelName=r.title),t.modelID=r.id,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.color){var s=r.color;t.color=[s[0],s[1],s[2]],4===s.length&&(t.opacity=s[3])}}else if(r.id){if(t.id=r.id,t.modelID=r.id,t.version=r.version,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.manager.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.model&&(t.modelID=r.model),r.title&&(t.modelName=r.title),r.color&&(s=r.color,t.color=[s[0],s[1],s[2]],4===s.length&&(t.opacity=s[3])),r.size){var a=r.size;t.size=a}r.hasanimation&&(t.hasAnim=r.hasanimation),r.url&&(t.url=r.url)}for(var l=0;l<this.manager.ableToSupportFootAndHeadModelWalls.length;l++){var u=this.manager.ableToSupportFootAndHeadModelWalls[l];if(t.id===u){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var i=e.color;t.color=[i[0],i[1],i[2]],4===i.length&&(t.opacity=i[3])}if(e.size){var r=e.size;t.modelSize=[r[0],r[1],r[2]]}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),ah=function(){function e(){Wc(this,e),this.sceneJson=null,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new oh}return Gc(e,[{key:"setObjectManager",value:function(e){Yc.objectManager=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"addLoadDataType",value:function(e,t){Yc.addLoadDataType(e,t)}},{key:"parseDataTypeVersion",value:function(e){if(e.loaderVersions){var t=e.loaderVersions;for(var i in t)this.addLoadDataType(i,t[i])}}},{key:"parseObjects",value:function(e){var t=this;return this.resourceManager=e.resourceManager,e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseDataTypeVersion(e),t.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"parseSceneJson",value:function(){this.parseResources(this.sceneJson,this.resourceManager),this.parseWorld(this.sceneJson)}},{key:"parseResources",value:function(e,t){var i=new sh(t);i.loadTextures(e.textures),i.loadModels(e.models),i.loadLightMaps(e.materialsetting)}},{key:"parseWorld",value:function(e){Yc.config=this.creatorTypeConfig,this.world=Yc.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:Kc.WORLD})}}]),e}(),lh=(new ah,new(function(){function e(t){Wc(this,e),this._versionMap={0:{0:ah}},this._smallVersionLibs=[[0]],this._bigVersions=[0]}return Gc(e,[{key:"getLoaderManager",value:function(e,t){if(null==e){var i=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][i.length-1]}if(null==t){var r=this._smallVersionLibs[e];return new this._versionMap[e][r.length-1]}return new this._versionMap[e][t]}}]),e}())),uh=function(){function e(t){Wc(this,e)}return Gc(e,[{key:"load",value:function(e){return lh.getLoaderManager(e.bigVersion,e.smallVersion).parseObjects(e)}},{key:"clear",value:function(){}}]),e}(),ch=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},hh=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),ph=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},dh=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},fh=function(){function e(t){ch(this,e),this._initParams(),this.object=t.object,this.manager=t.manager}return hh(e,[{key:"_initParams",value:function(){this.object=null,this.manager=null}},{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var i=e[t],r=this.manager.parserConfig[i.type];r&&new r({object:i,manager:this.manager}).parse()}}},{key:"parseInMode",value:function(e){var t=e.dataVersion,i=t.getMode(),r=t.getBigVersion(),n=t.getSmallVersion();this.manager.getCombineManager(i,r,n).parse(e)}},{key:"clear",value:function(){this._initParams()}}]),e}(),mh=function(e){function t(e){return ch(this,t),dh(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ph(t,e),hh(t,[{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var i=e[t];if("Outdoors"===i.type)this.parseInMode(i);else{var r=this.manager.parserConfig[i.type];r&&new r({object:i,manager:this.manager}).parse()}}}}]),t}(fh),gh=function(e){function t(e){return ch(this,t),dh(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ph(t,e),hh(t,[{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var i=e[t];"FloorPlan"===i.type&&this.parseInMode(i)}}}]),t}(fh),vh={World:mh,Building:gh},yh=function(){function e(){ch(this,e),this.objectManager=null,this.parserConfig=vh,this.rootParser=null,this.combineModeConfig={},this.objectManagerModeConfig={}}return hh(e,[{key:"addCombineMode",value:function(e,t,i){this.combineModeConfig[e]=t,this.objectManagerModeConfig[e]=i}},{key:"parse",value:function(e){this.initCombineManagerVersions(e);var t=e.object;new(0,this.parserConfig[t.type])({object:t,manager:this}).parse()}},{key:"initCombineManagerVersions",value:function(e){var t=e.combineManagerVersions;for(var i in t)this.combineModeConfig[i]=t[i]}},{key:"initObjectManagerVersions",value:function(e){var t=e.objectManagerVersions;for(var i in t)this.objectManagerModeConfig[i]=t[i]}},{key:"getCombineManager",value:function(e,t,i){return this.combineModeConfig[e].getCombineManager(t,i)}},{key:"clear",value:function(){this.rootParser&&this.rootParser.clear(),this.rootParser=null,this.objectManager=null,this.parserConfig=null,this.combineModeConfig={}}}]),e}(),bh=new(function(){function e(t){ch(this,e),this._versionMap={0:{0:yh}},this._smallVersionLibs=[[0]],this._bigVersions=[0]}return hh(e,[{key:"getCombinerManager",value:function(e,t){if(null==e){e=this._bigVersions[this._bigVersions.length-1];var i=this._smallVersionLibs[e];return t=i[i.length-1],new this._versionMap[e][t]}if(null==t){var r=this._smallVersionLibs[e];return t=r[r.length-1],new this._versionMap[e][t]}return this._versionMap[e]&&this._versionMap[e][t]?new this._versionMap[e][t]:null}}]),e}()),_h=function(){function e(t){ch(this,e)}return hh(e,[{key:"parse",value:function(e){var t=bh.getCombinerManager(e.bigVersion,e.smallVersion);return t?t.parse(e):null}},{key:"clear",value:function(){}}]),e}(),xh=function(e){function t(e){p(this,t);var i=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.sceneJson=null,i.world=null,i.debugManager=Nt,i.resourceManager=new Si,i.builderObjectManager=new ii,i.maxObjectManager=new ii,i.loader=new uh,i.dynamicBuildManager=new Ze(i),i.combineManager=new _h,i.objectsMap={},i.enableRequestWorld=!0,i.loadVersion=null,i}return f(t,e),d(t,[{key:"getMaxLoaderManager",value:function(){return this.maxObjectManager.meshBuilderManager=vs.createManager(),new da({objectManager:this.maxObjectManager,resourceManager:this.resourceManager})}},{key:"getUbuilderLoaderManager",value:function(){return this.builderObjectManager.meshBuilderManager=Nn.create(),this.builderObjectManager.calculaterManager=$r.create(),new Hc({objectManager:this.builderObjectManager,resourceManager:this.resourceManager,defaultSetting:mt,defaultResource:yt})}},{key:"setResourcesUnitDownloadNumber",value:function(e){this.dynamicBuildManager.maxResourcesUnitDownloadNumber=e}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"clearAllResources",value:function(){this.resourceManager.clear()}},{key:"clearAllObjects",value:function(){this.world.clear(),this.builderObjectManager.meshBuilderManager.clear(),this.builderObjectManager.calculaterManager.clear(),this.maxObjectManager.meshBuilderManager.clear(),this.maxObjectManager.calculaterManager.clear()}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"disposeObject",value:function(e){this.dynamicBuildManager.disposeObject(e)}},{key:"findObjectByID",value:function(e){return this.world.findObjectByID(e)}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this;return this.initLoaderParams(e),i.world=i.loader.load(e),i.combineManager.parse({object:i.world,bigVersion:0,smallVersion:0,combineManagerVersions:{3:new Bo({objectManager:this.builderObjectManager}),5:new Ja({objectManager:this.maxObjectManager})}}),i.dynamicBuildManager.world=i.world,i.enableRequestWorld&&i.requestToBuild(i.world.id),t?i.world:new Promise((function(e,t){e(i.world)}))}},{key:"initLoaderParams",value:function(e){e.resourceManager=this.resourceManager,e.loaderVersions={3:this.getUbuilderLoaderManager(),5:this.getMaxLoaderManager()}}},{key:"downloadResourceProgress",get:function(){return meshBuilderManager.downloadResProgess}}]),t}(Ya);e.Bim2TjsLoader=fu,e.Building=wt,e.CurveLine=Tt,e.DefaultSetting=mt,e.DoorOrWindow=Pt,e.Max2TjsLoader=Za,e.MixTjsLoader=xh,e.Outdoors=kt,e.PipeLine=Ot,e.Placement=St,e.PlacementGroup=Rt,e.Room=ft,e.ThingjsEditorSceneLoader=Fo,e.ThingjsEditorSceneLoader_2_0=Lo,e.UBuilderSceneLoader=Vc,e.VideoProbe=Lt,e.debugManager=Nt,Object.defineProperty(e,"__esModule",{value:!0})}(t)}));(Js=da)&&Js.__esModule&&Object.prototype.hasOwnProperty.call(Js,"default")&&Js.default;!function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.app=i.app,r}s(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){var i=e.thingjsObject,r=e.json2meshObject;t.event;if("CombineDoorOrWindow"===r.type){i._removeNodeBySceneLoad(r.mesh);var n=r.objects;r.transformations,r.resource.modelID;r.resource.model.updateMatrixWorld();for(var o=e.app.create({type:"BatchObject",nodeOverride:!1,node:r.resource.model,initBatchNum:n.length,parent:i}),s=0;s<n.length;s++){var a=n[s],l=a.rotation,u=new THREE.Quaternion(l[0],l[1],l[2],l[3]),c=a.position,h=a.scale,p=new THREE.Euler;p.setFromQuaternion(u);var d=p.toArray();d[0]*=180/Math.PI,d[1]*=180/Math.PI,d[2]*=180/Math.PI;o.createSubObject({parent:i,id:a.id,localPosition:c,scale:h,angles:d})}ls.addThingJsObjectSfStyle(o,"Outdoors"===r.parent.type?is:as)}},t.prototype.calMatrixs=function(e){for(var t=new THREE.Matrix4,i=e.positions.length-1;i>-1;i--){var r=e.positions[i],n=e.quaternions[i],o=e.scales[i],s=new THREE.Vector3(r[0],r[1],r[2]),a=new THREE.Quaternion(n[0],n[1],n[2],n[3]),l=new THREE.Vector3(o[0],o[1],o[2]),u=new THREE.Matrix4;u.compose(s,a,l),t.premultiply(u)}return t}}(na);var fa=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.thingjsParent=r.thingjsParent.misc,r.thingjsParent.loaded=!1,r}return s(t,e),t}(bs),ma=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t}(ds),ga=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i),i.thingjsObject.setupTextureAnimations()},t}(Ms),va=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype._callback=function(t,i){e.prototype._callback.call(this,t,i),i.thingjsObject.setupTextureAnimations()},t}(ws),ya=function(e){function t(){n(this,t);var i=a(this,e.call(this));return i._map.BatchCombinePlacement=fa,i._map.BatchPlacement=ma,i._map.CombinePlacement=ga,i._map.CombineFloor=va,i}return s(t,e),t}(Zs),ba=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.createType="Room",r}return s(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this),i=this.app.objectManager.create({node:new THREE.Object3D,parent:this._getParent(t,"CombinedObject"),type:"CombinedObject"});return i.userData.type="CombineMiscParent",i.userData.isCombineParent=!0,this.thingjsObject},t}(Ss),_a=function(e){function t(){n(this,t);var i=a(this,e.call(this));return i._map.Room=ba,i}return s(t,e),t}(ya),xa=new(function(){function e(t){n(this,e),this._versionMap={0:{0:ya,1:ya,2:ya,3:ya,4:_a}},this._smallVersionLibs=[[0,1,2,3,4]],this._bigVersions=[0]}return e.prototype.getConfig=function(e,t){if(null==e){e=this._bigVersions[this._bigVersions.length-1];var i=this._smallVersionLibs[e];return t=i[i.length-1],this._versionMap[e][t]}if(null==t){var r=this._smallVersionLibs[e];return t=r[r.length-1],this._versionMap[e][t]}var n=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>n[n.length-1]?this._versionMap[e][n.length-1]():this._versionMap[e][t];console.error("maxLoader not support version "+e+"."+t)},e}()),Ea=function(){function e(t){n(this,e),this.campus=null,this.app=t,this.enableProxima=!1,this.enableDynamicLoad=!1,this.creatorManager=null,this.enableBatchObject=!1,this.resourceManager=null,this.events=[]}return e.prototype.setCampus=function(e){this.campus=e},e.prototype.parseWorld=function(e,t){this.resourceManager=t,this.initEvents(),this.initCreatorManager(e);var i=this.parseJson2meshObject(e);return this.processHideObjects(i),i},e.prototype.initCreatorManager=function(e){var t=null;t=this.enableProxima?new ra(this.app):new Zs(this.app),null!==this.campus&&t.addCreatedThingjsObject(e,this.campus),this.creatorManager=new ps({app:this.app,config:t,events:this.events})},e.prototype.initEvents=function(){var e=this.events;this.enableDynamicLoad&&e.push(new oa),this.enableBatchObject&&e.push(new sa({app:this.app})),this.enableProxima&&e.push(new ha(this.app)),e.push(new aa),e.push(new la),e.push(new pa),e.push(new ca({app:this.app,resourceManager:this.resourceManager})),e.push(new ua({app:this.app,resourceManager:this.resourceManager}))},e.prototype.parseJson2meshObject=function(e,t){var i=this.creatorManager.createTjsObject(e,t);if("Building"===e.type&&this.parseFacades(e,i),this.shouldParseChildren(e)){var r=e.children;if(r)for(var n=0;n<r.length;n++){var o=r[n];"Facade"!==o.type&&"FacadeGroup"!==o.type&&"Floor"!==o.type&&"Ceiling"!==o.type&&"Roof"!==o.type&&this.parseJson2meshObject(o,i)}}return i},e.prototype.shouldParseChildren=function(e){return!!e.isContainer},e.prototype.parseFacades=function(e,t){var i=e.typeToChildren.Facade,r=e.typeToChildren.FacadeGroup;(i||r)&&this.creatorManager.createTjsFacadeObject(e,t)},e.prototype.processHideObjects=function(e){for(var t=e.buildings,i=0;i<t.length;i++){var r=t[i],n=r.floors;if(r.facade&&!r.structShow)for(var o=0;o<n.length;o++){n[o].visible=!1}else for(var s=0;s<n.length;s++){var a=n[s];this.hidePlanObjs(a)}}},e.prototype.hidePlanObjs=function(e){if(!e.showObjectsInParentLevels){for(var t=e.query(".CombinedObject",!1),i=0;i<t.length;i++){var r=t[i];if("CombineMiscParent"===r.userData.type)for(var n=r.query(".CombinedObject",!1),o=0;o<n.length;o++){var s=n[o];"CombinePlacement"!==s.userData.json2meshType&&"CombinePlacementGroup"!==s.userData.json2meshType||(s.visible=!1)}}for(var a=0;a<e.children.length;a++){var l=e.children[a];l.isDoor||"Room"===l.type||("Thing"===l.type&&l.isWindow||(l.visible=!1))}}},e.prototype.clear=function(){this.creatorManager.clear(),this.campus=null,this.app=null,this.enableProxima=!1,this.enableDynamicLoad=!1,this.creatorManager=null,this.enableBatchObject=!1,this.resourceManager=null,this.events=[]},e}(),wa=(function(){function e(t){n(this,e),this.app=t.app,this.sceneUrl=t.sceneUrl,this.configJson=null}e.prototype.load=function(e){e.effectsetting&&(this.configJson=e.effectsetting,this.loadSkybox())},e.prototype.loadSkybox=function(){if("string"==typeof this.app.skyBox&&this.configJson.skybox){var e=this.configJson.skybox,t={negx:e.left,negy:e.down,negz:e.back,posx:e.right,posy:e.up,posz:e.front};this.app.skyBox=t}}}(),function(){function e(t,i,r){n(this,e),this.app=t,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=i,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.enableDownloadSceneJsonCache=!0,this.enableDynamicLoad=!1,this.enableProxima=!1,this.enableBatchObject=!1,this._json2meshLoadedCallbacks=[],this.effectSettingLoader=null,this.app.options._json2meshObjectLoaded&&this.registerJson2meshLoadedListener(this.app.options._json2meshObjectLoaded);this.worldNode;if(i&&(i.position&&(this.campusPosition=i.position),i.rotation&&(this.campusRotation=i.rotation),void 0!==i.isCamFitScene&&null!==i.isCamFitScene&&(this.isCamFitScene=i.isCamFitScene),i.scale&&(this.campusScale=i.scale),void 0!==i.outdoorsVisible&&(this.outdoorsVisible=i.outdoorsVisible),void 0!==i.campusVisible&&(this.campusVisible=i.campusVisible),i.campus&&(this.campus=i.campus),i.enableDynamicLoadScene&&(this.enableDynamicLoad=i.enableDynamicLoadScene),i.enableProxima&&(this.enableProxima=i.enableProxima),i.enableBatchObject&&(this.enableBatchObject=i.enableBatchObject),void 0!==i.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=i.enableUseHighestVersionResource),void 0!==i.enableDownloadSceneJsonCache&&(this.enableDownloadSceneJsonCache=i.enableDownloadSceneJsonCache),i.startDownloadResourcesCallback&&(this.startDownloadResourcesCallback=i.startDownloadResourcesCallback)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),i.default){var o=i.default;o.sceneJson&&(this.sceneJson="export.json"),o.wallTexture&&(this.defaultWallTextureUri=o.wallTexture),o.wallEdgeTexture&&(this.defaultWallEdgeTextureUri=o.wallEdgeTexture),o.floorTexture&&(this.defaultFloorTextureUri=o.floorTexture),o.ceilingTexture&&(this.defaultCeilingTextureUri=o.ceilingTexture),o.roofTexture&&(this.defaultRoofTextureUri=o.roofTexture)}r.loaderResourceUrl&&(this.resourceUrl=r.loaderResourceUrl),void 0!==this.app.options.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=this.app.options.enableUseHighestVersionResource),void 0!==this.app.options.enableBatchObject&&this.app.options.enableBatchObject&&(json2mesh.DefaultSetting.enableCombinePlacementToBuildMesh=!1,this.enableBatchObject=this.app.options.enableBatchObject),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary),this.enableDownloadSceneJsonCache||(this.sceneJsonUri+="?_t="+(new Date).getTime()),this.json2meshToThingjsParser=null}return e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var s=[Number(n[0]),Number(n[1]),Number(n[2])];s[2]=-s[2],this.app.camera.position=o,this.app.camera.target=s},e.prototype.load=function(e){var t=this;if(t.json2meshToThingjsParser=new Ea(t.app),t.enableProxima&&(t.json2meshToThingjsParser.enableProxima=!0,json2mesh.DefaultSetting.enableCombinePlacementsByRoom=!0),t.enableBatchObject&&(t.json2meshToThingjsParser.enableBatchObject=t.enableBatchObject),"String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node,this.json2meshToThingjsParser.setCampus(this.campus)),i.json&&(this.sceneJson=i.json)}return this.relativeResourceUrl&&(0===this.relativeResourceUrl.indexOf("./")?this.resourceUrl=this.sceneURL+this.relativeResourceUrl.replace("./","/"):this.resourceUrl=this.relativeResourceUrl),new Promise((function(e,i){t.updateProgress(.1),t.loadSceneJson().then((function(i){t.sceneJsonString=i,t.sceneJson=JSON.parse(i),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.1);var r=new json2mesh.UBuilderSceneLoader;void 0!==t.app.options.loadingSceneMaxResourcesUnitDownloadNumber&&r.setResourcesUnitDownloadNumber(t.app.options.loadingSceneMaxResourcesUnitDownloadNumber),void 0!==t.app.options.loadingSceneAwaitToNextBuildTime&&(r.dynamicBuildManager.awaitToNextBuildTime=t.app.options.loadingSceneAwaitToNextBuildTime),t.enableDynamicLoad&&(r.enableRequestWorld=!1,t.json2meshToThingjsParser.enableDynamicLoad=!0),t.resourceUrl&&(r.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",r.resourceManager.baseModelUrl=t.resourceUrl+"/model/"),r.resourceManager.enableUserHighestVersionResource=t.enableUseHighestVersionResource,t.loader=r,r.load({json:t.sceneJson,customModeBaseUrl:t.sceneURL+"/",bigVersion:t.indexJson.bigVersion,smallVersion:t.indexJson.smallVersion}).then((function(i){t._notifyJson2meshLoadedListeners(i);var n=new hs;n.parseWorld(i),n.clear(),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.campus.visible=t.campusVisible,t.campusRotation&&t.campus.node.quaternion.set(t.campusRotation.x,t.campusRotation.y,t.campusRotation.z,t.campusRotation.w),t.campusPosition&&(t.campus.position=t.campusPosition),t.campusScale&&(t.campus.scale=t.campusScale),t.startDownloadResourcesCallback&&t.startDownloadResourcesCallback(r.resourceManager.models,r.resourceManager.textures),t.campus=t.json2meshToThingjsParser.parseWorld(i,r.resourceManager),t.enableDynamicLoad?(t.loadExtraData(t.campus),t.updateProgress(1),e(t.campus)):r.startToBuild((function(i){t.updateProgress(.1+.9*i),1===i&&(t.updateProgress(1),t.loadExtraData(t.campus),e(t.campus))}))}))}))}))},e.prototype.loadExtraData=function(e){this.sceneJson.extraData&&(e.extraData=this.sceneJson.extraData)},e.prototype.loadSceneJson=function(e){var t=this;return e&&(t.sceneURL=e),new Promise((function(e,i){t.sceneJson?e(t.sceneJson):new THREE.FileLoader(t.app.loadingManager).load(t.sceneURL.appendURL(t.sceneJsonUri),(function(t){e(t)}))}))},e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.startToDownloadRequestResources=function(e){this.loader.resourceManager.startToDownloadRequestResources(e)},e.prototype.addResourceDownloadRequest=function(e){this.loader.resourceManager.addResourceDownloadRequest(e)},e.prototype.clearAllResources=function(){this.clear()},e.prototype.clearAllObjects=function(){this.loader.clearAllObjects(),this.world=null},e.prototype.clear=function(){this.loader.clearAllResources(),this.json2meshToThingjsParser.clear(),this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=null,this.sceneJsonUri=null,this.defaultWallTextureUri=null,this.defaultWallEdgeTextureUri=null,this.defaultFloorTextureUri=null,this.defaultCeilingTextureUri=null,this.defaultRoofTextureUri=null,this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.enableDownloadSceneJsonCache=!0,this.enableDynamicLoad=!1,this.enableProxima=!1,this.enableBatchObject=!1},e.prototype.requestToBuild=function(e){this.loader.requestToBuild(e)},e.prototype.startToBuild=function(e){return this.loader.startToBuild(e)},e.prototype.disposeObject=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.loader.disposeObject(e,t)},e.prototype.findObjectByID=function(e){return this.world.findObjectByID(e)},e.prototype.registerJson2meshLoadedListener=function(e){this._json2meshLoadedCallbacks.push(e)},e.prototype._notifyJson2meshLoadedListeners=function(e){for(var t=0;t<this._json2meshLoadedCallbacks.length;t++){(0,this._json2meshLoadedCallbacks[t])(e)}},e}()),Ta=function(){function e(t){n(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.rootNode=null,this.campus=null,this.sceneURL=null,this.sceneJsonData=null,this.loadedSceneGLTF=null,this.worldNode=new THREE.Object3D,this.fitCamInfo=null}return e.prototype.parse=function(e){if(this.parseWorld(e),e.camInfo){var t=e.camInfo;this.fitCamInfo=t}},e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var s=[Number(n[0]),Number(n[1]),Number(n[2])];s[2]=-s[2],this.app.camera.position=o,this.app.camera.target=s},e.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.campus.node.name="campus",this.app.scene.add(this.campus.node)),e.outdoors&&this.parseOutdoors(e.outdoors),e.buildings){var i=e.buildings;this.parseBuildings(i)}},e.prototype.parseOutdoors=function(e){var t=e,i=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:i});var r=this.outdoors;this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors);var n=t.gltfid;if(n&&this.nodes[n]){var o=this.nodes[n];THREE.SceneUtils.detach(o,o.parent,this.app.scene),THREE.SceneUtils.attach(o,this.app.scene,r.node),r.node.updateMatrixWorld()}this.parseFloorPlan(t,r)},e.prototype.parseBuildings=function(e){for(var t in e){var i=e[t],r=t;i.name&&(r=i.name);var n=null;if(i.gltfid){var o=i.gltfid;this.nodes[o]&&(n=this.nodes[o])}var s=this.app.objectManager.create({type:"Building",name:r,parent:this.campus,node:n});i.plans&&this.parseFloorPlans(i.plans,s),i.facades&&this.parseFacades(i.facades,s)}},e.prototype.parseFloorPlans=function(e,t){for(var i in e){var r=null,n=e[i],o=i;n.name&&(o=n.name);var s=n.gltfid;s&&this.nodes[s]&&(r=this.nodes[s]);var a=this.app.objectManager.create({type:"Floor",name:o,node:r,parent:t});this.parseFloorPlan(n,a)}},e.prototype.parseFloorPlan=function(e,t){e.placements&&this.parseThings(e.placements,t),e.videoprobes&&this.parseThings(e.videoprobes,t),e.doororwindows&&this.parseDoorWins(e.doororwindows,t),e.routes&&this.parseThings(e.routes,t),e.pipelines&&this.parseThings(e.pipelines,t),e.curvelines&&this.parseThings(e.curvelines,t),e.arrowlines&&this.parseThings(e.arrowlines,t),e.arrowdatalines&&this.parseThings(e.arrowdatalines,t),e.leakwaterlines&&this.parseThings(e.leakwaterlines,t),e.rooms&&this.parseRooms(e.rooms,t),this.parseStructure(e,t);var i=e.groups;i&&this.parseGroup(i,t)},e.prototype.parseRooms=function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=null;r.name&&(n=r.name);var o=null,s=r.gltfid;s&&this.nodes[s]&&(o=this.nodes[s]);var a=null,l=r.properties;if(l)for(var u in a={},l){var c=l[u];a[u]=c}var h=null,p=null,d=null;r.floor&&(s=r.floor.gltfid,this.nodes[s]&&(d=this.nodes[s])),r.ceiling&&(s=r.ceiling.gltfid,this.nodes[s]&&(h=this.nodes[s])),r.roof&&(s=r.roof.gltfid,this.nodes[s]&&(p=this.nodes[s]));var f=null,m=null,g=null,v={};if(r.area&&(m=r.area,v.area=m),r.circumference&&(g=r.circumference,v.circumference=g),r.center){var y=r.center;(f=new THREE.Vector3).set(y[0],y[1],-y[2]),v.center=f}var b=r.isShown;if(b){var _="false"!==(b=b.toLowerCase());o.visible=_}this.app.objectManager.create({type:"Room",name:n,node:o,ceilingNode:h,roofNode:p,floorNode:d,parent:t,properties:a,auxiliaryInfo:v})}},e.prototype.parseStructure=function(e,t){if(e.structure){var i=(e=e.structure).placements;if(i)for(var r in i){var n=i[r].gltfid,o=this.nodes[n];if(o){t.miscNode=o.parent;break}}var s=e.walls;if(s)for(var r in s){n=s[r].gltfid;var a=this.nodes[n];if(a){t.wallNode=a.parent;break}}var l=e.roofs;if(l)for(var r in l){n=l[r].gltfid;var u=this.nodes[n];if(u){t.roofNode=u.parent;break}}var c=e.ceilings;if(c)for(var r in c){n=c[r].gltfid;var h=this.nodes[n];if(h){t.ceilingNode=h.parent;break}}if(p=e.floors)for(var r in p){var p;if(n=(p=p[r]).gltfid){var d=this.nodes[n];if(d){t.floorNode=d.parent;break}}}}},e.prototype.parseGroup=function(e,t){for(var i in e){var r=e[i],n=i;r.name&&(n=r.name);var o=null,s=r.gltfid;s&&this.nodes[s]&&(o=this.nodes[s]);var a=null,l=r.properties;if(l)for(var u in a={},l){var c=l[u];a[u]=c}this.app.objectManager.create({type:"Thing",name:n,node:o,parent:t,properties:a}),r.placements&&this.parseThings(r.placements,t)}},e.prototype.parseFacades=function(e,t){for(var i in e){var r=e[i],n=i;r.name&&(n=r.name);var o=null,s=r.gltfid;s&&this.nodes[s]&&(o=this.nodes[s]);var a=null,l=r.properties;if(l)for(var u in a={},l){var c=l[u];a[u]=c}var h=r.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Facade",name:n,node:o,parent:t,properties:a});t.node.add(o)}},e.prototype.parseThings=function(e,t){for(var i in e){var r=e[i],n=r.name||i,o=r.type||"Thing",s=null,a=r.gltfid;a&&this.nodes[a]&&(s=this.nodes[a]);var l=null,u=r.properties;if(u)for(var c in l={},u){var h=u[c];l[c]=h}var p=r.isShown;if(p){var d="false"!==(p=p.toLowerCase());s.visible=d}this.app.objectManager.create({type:o,name:n,node:s,parent:t,properties:l})}},e.prototype.parseDoorWins=function(e,t){for(var i in e){var r=e[i],n=i;r.name&&(n=r.name);var o=null;if(r.gltfid){var s=r.gltfid;this.nodes[s]&&(o=this.nodes[s])}var a=null;if(r.properties){var l=r.properties;for(var u in a={},l){var c=l[u];a[u]=c}}this.app.objectManager.create({type:"Door",name:n,node:o,parent:t,properties:a})}},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node)}return new Promise((function(e,i){t.loadGLTF().then((function(e){return t.loadedSceneGLTF=e,e.scene.traverse((function(e){t.nodes[e.name]=e})),t.parseSceneJson()})).then((function(i){t.fitCamInfo?t.parseCamInfo(t.fitCamInfo):t.campus.node&&t.app.camera.fit(t.campus),e(t.campus)})).catch((function(){t.campus.node.add(t.loadedSceneGLTF.scene.children[0]),t.campus&&t.app.camera.fit(t.campus),e(t.campus)}))}))},e.prototype.loadGLTF=function(){var e=this;return new Promise((function(t,i){var r=new THREE.GLTFLoader(e.app.loadingManager);r.setCrossOrigin("anonymous"),r.load(e.sceneURL+"/Unity2GLTF.gltf",(function(e){t(e)}))}))},e.prototype.parseSceneJson=function(){var e=this;return new Promise((function(t,i){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/scene.json",(function(i){var r=JSON.parse(i);e.sceneJsonData=r,e.parseWorld(r),t(r)}),(function(){}),(function(){THING.Utils.error("not find file scene.json "),i()}))}))},e}(),Ma=function(e){function t(i,r,o){return n(this,t),a(this,e.call(this,i,r,o))}return s(t,e),t.prototype.load=function(e){var t=this;if(t.json2meshToThingjsParser=new Ea(t.app),t.enableProxima&&(t.json2meshToThingjsParser.enableProxima=!0,json2mesh.DefaultSetting.enableCombinePlacementsByRoom=!0),t.enableBatchObject&&(t.json2meshToThingjsParser.enableBatchObject=t.enableBatchObject),"String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node,this.json2meshToThingjsParser.setCampus(this.campus)),i.json&&(this.sceneJson=i.json)}return this.relativeResourceUrl&&(0===this.relativeResourceUrl.indexOf("./")?this.resourceUrl=this.sceneURL+this.relativeResourceUrl.replace("./","/"):this.resourceUrl=this.relativeResourceUrl),new Promise((function(e,i){t.updateProgress(.1),t.loadSceneJson().then((function(i){t.sceneJsonString=i,t.sceneJson=JSON.parse(i),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.1);var r=new json2mesh.UBuilderSceneLoader;void 0!==t.app.options.loadingSceneMaxResourcesUnitDownloadNumber&&r.setResourcesUnitDownloadNumber(t.app.options.loadingSceneMaxResourcesUnitDownloadNumber),void 0!==t.app.options.loadingSceneAwaitToNextBuildTime&&(r.dynamicBuildManager.awaitToNextBuildTime=t.app.options.loadingSceneAwaitToNextBuildTime),t.enableDynamicLoad&&(r.enableRequestWorld=!1,t.json2meshToThingjsParser.enableDynamicLoad=!0);var n="https://www.thingjs.com/";t.resourceUrl&&(r.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",r.resourceManager.baseModelUrl=t.resourceUrl+"/model/",n=t.resourceUrl+"/"),t.loader=r,r.load({json:t.sceneJson,bigVersion:t.indexJson.bigVersion,smallVersion:t.indexJson.smallVersion,customModeBaseUrl:n}).then((function(i){t._notifyJson2meshLoadedListeners(i),(new hs).parseWorld(i),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.campus.visible=t.campusVisible,t.campusRotation&&t.campus.node.quaternion.set(t.campusRotation.x,t.campusRotation.y,t.campusRotation.z,t.campusRotation.w),t.campusPosition&&(t.campus.position=t.campusPosition),t.campusScale&&(t.campus.scale=t.campusScale),t.startDownloadResourcesCallback&&t.startDownloadResourcesCallback(r.resourceManager.models,r.resourceManager.textures),t.campus=t.json2meshToThingjsParser.parseWorld(i,r.resourceManager),t.enableDynamicLoad?(t.loadExtraData(t.campus),t.updateProgress(1),e(t.campus)):r.startToBuild((function(i){t.updateProgress(.1+.9*i),1===i&&(t.updateProgress(1),t.loadExtraData(t.campus),e(t.campus))}))}))}))}))},t}(wa),Ca=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this._buildCallback,{event:this})},t.prototype._buildCallback=function(e,t){var i=e.thingjsObject,r=e.json2meshObject;"Facade"!==i.type&&(i.localPosition=r.position,i.scale=r.scale,r.rotation&&i.node.quaternion.set(r.rotation[0],r.rotation[1],r.rotation[2],r.rotation[3]))},t}(na),Sa=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.app=i.app,r}return s(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){var i=e.thingjsObject,r=e.json2meshObject,n=t.event;if("BatchCombinePlacement"===r.type){var o=r.objects;if(0===o.length)return;i.node.remove(r.mesh);var s=r.transformations,a=r.resource.modelID;r.resource.model.updateMatrixWorld();for(var l=e.app.create({type:"BatchObject",nodeOverride:!1,node:r.resource.model,initBatchNum:o.length,parent:i}),u=0;u<o.length;u++){var c=o[u],h=n.calMatrixs(s[u]),p=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Quaternion;h.decompose(p,f,d);var m=p.toArray(),g=d.toArray(),v=new THREE.Euler;v.setFromQuaternion(f);var y=v.toArray();y[0]*=180/Math.PI,y[1]*=180/Math.PI,y[2]*=180/Math.PI;var b=n.getSubObjectParams(c);b.localPosition=m,b.scale=g,b.angles=y,b.parent=i;l.createSubObject(b)}ls.addBatchCombinePlacementStyle(l,r,a)}},t.prototype.getSubObjectParams=function(e){var t={uuid:e.id};return null!==e.userID&&(t.id=e.userID),null!==e.name&&(t.name=e.name),null!==e.properties&&(t.properties=e.properties),t},t.prototype.calMatrixs=function(e){for(var t=new THREE.Matrix4,i=e.positions.length-1;i>-1;i--){var r=e.positions[i],n=e.quaternions[i],o=e.scales[i],s=new THREE.Vector3(r[0],r[1],r[2]),a=new THREE.Quaternion(n[0],n[1],n[2],n[3]),l=new THREE.Vector3(o[0],o[1],o[2]),u=new THREE.Matrix4;u.compose(s,a,l),t.premultiply(u)}return t},t}(na),ja=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.app=i.app,r}return s(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){var i=e.thingjsObject,r=e.json2meshObject,n=t.event;if("BatchPlacement"===r.type){var o=r.objects;if(0===o.length)return;i.node.remove(r.mesh);var s=r.transformations,a=r.resource.modelID;r.resource.model.updateMatrixWorld();for(var l=e.app.create({type:"BatchObject",nodeOverride:!1,node:r.resource.model,initBatchNum:o.length,parent:i}),u=0;u<o.length;u++){var c=o[u],h=n.calMatrixs(s[u]),p=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Quaternion;h.decompose(p,f,d);var m=p.toArray(),g=d.toArray(),v=new THREE.Euler;v.setFromQuaternion(f);var y=v.toArray();y[0]*=180/Math.PI,y[1]*=180/Math.PI,y[2]*=180/Math.PI;var b=n.getSubObjectParams(c);b.localPosition=m,b.scale=g,b.angles=y,b.parent=i;l.createSubObject(b)}ls.addBatchPlacementStyle(l,r,a)}},t.prototype.getSubObjectParams=function(e){var t={uuid:e.id};return null!==e.userID&&(t.id=e.userID),null!==e.name&&(t.name=e.name),null!==e.properties&&(t.properties=e.properties),t},t.prototype.getMeshes=function(e){var t=[];return e.traverse((function(e){e.isMesh&&t.push(e)})),t},t.prototype.addSfStyle=function(e,t){var i=this.getMeshes(e);if(i&&i.length>0)for(var r=0;r<i.length;r++){i[r]._sfStyle=t}},t.prototype.isTree=function(e){return!!treeModels[e]},t.prototype.calMatrixs=function(e){for(var t=new THREE.Matrix4,i=e.positions.length-1;i>-1;i--){var r=e.positions[i],n=e.quaternions[i],o=e.scales[i],s=new THREE.Vector3(r[0],r[1],r[2]),a=new THREE.Quaternion(n[0],n[1],n[2],n[3]),l=new THREE.Vector3(o[0],o[1],o[2]),u=new THREE.Matrix4;u.compose(s,a,l),t.premultiply(u)}return t},t}(na),Pa=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerCreatedCallbackListener(this._createdCallback,{event:this})},t.prototype._createdCallback=function(e,t){var i=e.thingjsObject,r=e.json2meshObject,n=t.event;r.resource&&r.resource.registerBuildCallbackListener(n._resourceBuildedCallback,{event:this,tjsObject:i})},t.prototype._resourceBuildedCallback=function(e,t){var i=t.tjsObject;e.indexJson&&(i._extensionsFile=e.indexJson.extensionsfile||null)},t}(na),Ra=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.enableBuildMaxPlacemenetBatch=!0,r}return s(t,e),t.prototype.parseWorld=function(e,t,i,r){this.resourceManager=t,this.initEvents(),this.initCreatorManager(e,i,r);var n=this.parseJson2meshObject(e);return this.processHideObjects(n),n},t.prototype.initCreatorManager=function(e,t,i){var r=new(xa.getConfig(t,i))(this.app);null!==this.campus&&r.addCreatedThingjsObject(e,this.campus),this.creatorManager=new ps({app:this.app,config:r,events:this.events})},t.prototype.initEvents=function(){var e=this.events;this.enableDynamicLoad&&e.push(new oa),e.push(new ja({app:this.app})),e.push(new Sa({app:this.app})),e.push(new aa),e.push(new la),e.push(new ca({app:this.app,resourceManager:this.resourceManager})),e.push(new ua({app:this.app,resourceManager:this.resourceManager})),e.push(new Pa)},t}(Ea),Da=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerCreatedCallbackListener(this._createdCallback,{event:this})},t.prototype._createdCallback=function(e,t){var i=e.thingjsObject,r=e.json2meshObject;i.loadMode=r.loadMode},t}(na),Aa=function(){function e(t,i,r){n(this,e),this.app=t,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=i,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.enableDownloadSceneJsonCache=!0,this.enableDynamicLoad=!1,this.enableProxima=!1,this.enableBatchObject=!1,this._jsonloadedCallbacks=[];this.worldNode;(i&&(i.position&&(this.campusPosition=i.position),i.rotation&&(this.campusRotation=i.rotation),void 0!==i.isCamFitScene&&null!==i.isCamFitScene&&(this.isCamFitScene=i.isCamFitScene),i.scale&&(this.campusScale=i.scale),void 0!==i.outdoorsVisible&&(this.outdoorsVisible=i.outdoorsVisible),void 0!==i.campusVisible&&(this.campusVisible=i.campusVisible),i.campus&&(this.campus=i.campus),void 0!==i.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=i.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),void 0!==i.enableDownloadSceneJsonCache&&(this.enableDownloadSceneJsonCache=i.enableDownloadSceneJsonCache),i.enableDynamicLoadScene&&(this.enableDynamicLoad=i.enableDynamicLoadScene),i.enableProxima&&(this.enableProxima=i.enableProxima),i.startDownloadResourcesCallback&&(this.startDownloadResourcesCallback=i.startDownloadResourcesCallback)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),i.default)&&(i.default.sceneJson&&(this.sceneJson="export.json"));void 0!==this.app.options.enableBatchObject&&this.app.options.enableBatchObject&&(json2mesh.DefaultSetting.enableBatchObject=!0,this.enableBatchObject=this.app.options.enableBatchObject),r.loaderResourceUrl&&(this.resourceUrl=r.loaderResourceUrl),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary),this.enableDownloadSceneJsonCache||(this.sceneJsonUri+="?_t="+(new Date).getTime()),this.json2meshToThingjsParser=null,this.LoaderClass=json2mesh.Max2TjsLoader,this.app.level.options={autoBakeFloor:!1},this.app.options._sceneloaded&&this.registerSceneJsonLoadedListener(this.app.options._sceneloaded),this.enableBatchMaxPlacement=!0,void 0!==this.app.options.enableBatchMaxPlacement&&(this.enableBatchMaxPlacement=this.app.options.enableBatchMaxPlacement)}return e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var s=[Number(n[0]),Number(n[1]),Number(n[2])];s[2]=-s[2],this.app.camera.position=o,this.app.camera.target=s},e.prototype.load=function(e){var t=this;if(t.json2meshToThingjsParser=new Ra(t.app),t.enableProxima&&(t.json2meshToThingjsParser.enableProxima=!0,json2mesh.DefaultSetting.enableCombinePlacementsByRoom=!0),t.json2meshToThingjsParser.events.push(new Ca),t.json2meshToThingjsParser.events.push(new Da),"String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node,this.json2meshToThingjsParser.setCampus(this.campus)),i.json&&(this.sceneJson=i.json)}return this.relativeResourceUrl&&(0===this.relativeResourceUrl.indexOf("./")?this.resourceUrl=this.sceneURL+this.relativeResourceUrl.replace("./","/"):this.resourceUrl=this.relativeResourceUrl),new Promise((function(e,i){t.updateProgress(.1),t.loadSceneJson().then((function(i){t.sceneJsonString=i,t.sceneJson=JSON.parse(i),t._notifySceneJsonLoadedListeners(t.sceneJson),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.1);var r=new t.LoaderClass;t.enableDynamicLoad&&(r.enableRequestWorld=!1,t.json2meshToThingjsParser.enableDynamicLoad=!0),t.resourceUrl&&(r.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",r.resourceManager.baseModelUrl=t.resourceUrl+"/model/"),t.loader=r,t.world=r.load({enableBatchPlacement:t.enableBatchMaxPlacement,json:t.sceneJson,customModeBaseUrl:t.sceneURL+"/",bigVersion:t.indexJson.bigVersion,smallVersion:t.indexJson.smallVersion});var n=t.world;(new hs).parseWorld(n),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.campus&&(t.campus.visible=t.campusVisible),t.campusRotation&&t.campus.node.quaternion.set(t.campusRotation.x,t.campusRotation.y,t.campusRotation.z,t.campusRotation.w),t.campusPosition&&(t.campus.position=t.campusPosition),t.campusScale&&(t.campus.scale=t.campusScale),t.startDownloadResourcesCallback&&t.startDownloadResourcesCallback(r.resourceManager.models,r.resourceManager.textures),t.campus=t.json2meshToThingjsParser.parseWorld(n,r.resourceManager,t.indexJson.bigVersion,t.indexJson.smallVersion),t.enableDynamicLoad?(t.loadExtraData(t.campus),t.updateProgress(1),e(t.campus)):r.startToBuild((function(i){t.updateProgress(.1+.9*i),1===i&&(t.updateProgress(1),t.loadExtraData(t.campus),e(t.campus))}))}))}))},e.prototype.setTransformInfo=function(e){},e.prototype.loadExtraData=function(e){this.sceneJson.extraData&&(e.extraData=this.sceneJson.extraData)},e.prototype.loadSceneJson=function(e){var t=this;return e&&(t.sceneURL=e),new Promise((function(e,i){t.sceneJson?e(t.sceneJson):new THREE.FileLoader(t.app.loadingManager).load(t.sceneURL.appendURL(t.sceneJsonUri),(function(t){e(t)}))}))},e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.startToDownloadRequestResources=function(e){this.loader.startToDownloadRequestResources(e)},e.prototype.addResourceDownloadRequest=function(e){this.loader.resourceManager.addResourceDownloadRequest(e)},e.prototype.clearAllResources=function(){this.loader.resourceManager.disposeModels(),this.loader.resourceManager.disposeTextures()},e.prototype.clearAllObjects=function(){this.world.clear()},e.prototype.requestToBuild=function(e){this.loader.requestToBuild(e)},e.prototype.startToBuild=function(e){return this.loader.startToBuild(e)},e.prototype.disposeObject=function(e){this.loader.disposeObject(e)},e.prototype.findObjectByID=function(e){return this.world.findObjectByID(e)},e.prototype.registerSceneJsonLoadedListener=function(e){this._jsonloadedCallbacks.push(e)},e.prototype._notifySceneJsonLoadedListeners=function(e){for(var t=0;t<this._jsonloadedCallbacks.length;t++){(0,this._jsonloadedCallbacks[t])(e)}},e}(),ka=function(e){function t(i,r,o){n(this,t);var s=a(this,e.call(this,i,r,o));return s.LoaderClass=json2mesh.Bim2TjsLoader,s}return s(t,e),t}(Aa),Oa=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this._buildCallback,{event:this})},t.prototype._buildCallback=function(e,t){var i=e.thingjsObject,r=e.json2meshObject;"Facade"!==i.type&&r.dataVersion&&5===r.dataVersion.mode&&(i.localPosition=r.position,i.scale=r.scale,r.rotation&&i.node.quaternion.set(r.rotation[0],r.rotation[1],r.rotation[2],r.rotation[3]))},t}(na),Ba=function(){function e(t){n(this,e),this.app=t,this.ubuilderToThingjsParser=new Ea(this.app),this.maxToThingjsParser=new Ra(this.app),this.campus=null,this.app=t,this.enableProxima=!1,this.enableDynamicLoad=!1,this.creatorManager=null,this.enableBatchObject=!1,this.resourceManager=null}return e.prototype.parseWorld=function(e,t){this.resourceManager=t,this.ubuilderToThingjsParser.resourceManager=t,this.maxToThingjsParser.resourceManager=t,this.ubuilderToThingjsParser.enableProxima=this.enableProxima,this.maxToThingjsParser.enableProxima=this.enableProxima,this.ubuilderToThingjsParser.enableBatchObject=this.enableBatchObject,this.maxToThingjsParser.enableBatchObject=this.enableBatchObject,this.ubuilderToThingjsParser.enableDynamicLoad=this.enableDynamicLoad,this.maxToThingjsParser.enableDynamicLoad=this.enableDynamicLoad,this.ubuilderToThingjsParser.initEvents(),this.maxToThingjsParser.initEvents(),this.maxToThingjsParser.events.push(new Oa),this.ubuilderToThingjsParser.initCreatorManager(e),this.maxToThingjsParser.initCreatorManager(e);var i=this.parseJson2meshObject(e);return this.processHideObjects(i),i},e.prototype.parseJson2meshObject=function(e,t){var i=null;3===e.dataVersion.mode?i=this.ubuilderToThingjsParser:5===e.dataVersion.mode?i=this.maxToThingjsParser:console.error("not support mode");var r=i.creatorManager.createTjsObject(e,t);if("Building"===e.type&&i.parseFacades(e,r),i.shouldParseChildren(e)){var n=e.children;if(n)for(var o=0;o<n.length;o++){var s=n[o];"Facade"!==s.type&&"FacadeGroup"!==s.type&&"Floor"!==s.type&&"Ceiling"!==s.type&&"Roof"!==s.type&&("FloorPlan"===e.type||"Outdoors"===e.type?i.parseJson2meshObject(s,r):this.parseJson2meshObject(s,r))}}return r},e.prototype.setCampus=function(e){this.ubuilderToThingjsParser.setCampus(e),this.maxToThingjsParser.setCampus(e)},e.prototype.processHideObjects=function(e){for(var t=e.buildings,i=0;i<t.length;i++){var r=t[i],n=r.floors;if(r.facade&&!r.structShow)for(var o=0;o<n.length;o++){n[o].visible=!1}else for(var s=0;s<n.length;s++){var a=n[s];this.hidePlanObjs(a)}}},e.prototype.hidePlanObjs=function(e){if(!e.showObjectsInParentLevels){for(var t=e.query(".CombinedObject",!1),i=0;i<t.length;i++){var r=t[i];if("CombineMiscParent"===r.userData.type)for(var n=r.query(".CombinedObject",!1),o=0;o<n.length;o++){var s=n[o];"CombinePlacement"!==s.userData.json2meshType&&"CombinePlacementGroup"!==s.userData.json2meshType||(s.visible=!1)}}for(var a=0;a<e.children.length;a++){var l=e.children[a];l.isDoor||"Room"===l.type||("Thing"===l.type&&l.isWindow||(l.visible=!1))}}},e.prototype.clear=function(){this.ubuilderToThingjsParser.clear(),this.maxToThingjsParser.clear(),this.app=null,this.enableProxima=!1,this.enableDynamicLoad=!1,this.creatorManager=null,this.enableBatchObject=!1,this.resourceManager=null},e}(),Fa=function(){function e(t,i,r){n(this,e),this.app=t,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=i,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.enableDownloadSceneJsonCache=!0,this.enableDynamicLoad=!1,this.enableProxima=!1,this.enableBatchObject=!1,this.effectSettingLoader=null;this.worldNode;if(i&&(i.position&&(this.campusPosition=i.position),i.rotation&&(this.campusRotation=i.rotation),void 0!==i.isCamFitScene&&null!==i.isCamFitScene&&(this.isCamFitScene=i.isCamFitScene),i.scale&&(this.campusScale=i.scale),void 0!==i.outdoorsVisible&&(this.outdoorsVisible=i.outdoorsVisible),void 0!==i.campusVisible&&(this.campusVisible=i.campusVisible),i.campus&&(this.campus=i.campus),i.enableDynamicLoadScene&&(this.enableDynamicLoad=i.enableDynamicLoadScene),i.enableProxima&&(this.enableProxima=i.enableProxima),i.enableBatchObject&&(this.enableBatchObject=i.enableBatchObject),void 0!==i.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=i.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),void 0!==i.enableDownloadSceneJsonCache&&(this.enableDownloadSceneJsonCache=i.enableDownloadSceneJsonCache),i.startDownloadResourcesCallback&&(this.startDownloadResourcesCallback=i.startDownloadResourcesCallback)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),i.default){var o=i.default;o.sceneJson&&(this.sceneJson="export.json"),o.wallTexture&&(this.defaultWallTextureUri=o.wallTexture),o.wallEdgeTexture&&(this.defaultWallEdgeTextureUri=o.wallEdgeTexture),o.floorTexture&&(this.defaultFloorTextureUri=o.floorTexture),o.ceilingTexture&&(this.defaultCeilingTextureUri=o.ceilingTexture),o.roofTexture&&(this.defaultRoofTextureUri=o.roofTexture)}r.loaderResourceUrl&&(this.resourceUrl=r.loaderResourceUrl),void 0!==this.app.options.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=this.app.options.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),void 0!==this.app.options.enableBatchObject&&this.app.options.enableBatchObject&&(json2mesh.DefaultSetting.enableCombinePlacementToBuildMesh=!1,this.enableBatchObject=this.app.options.enableBatchObject),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary),this.enableDownloadSceneJsonCache||(this.sceneJsonUri+="?_t="+(new Date).getTime()),this.json2meshToThingjsParser=null}return e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var s=[Number(n[0]),Number(n[1]),Number(n[2])];s[2]=-s[2],this.app.camera.position=o,this.app.camera.target=s},e.prototype.load=function(e){var t=this;if(t.json2meshToThingjsParser=new Ba(t.app),t.enableProxima&&(t.json2meshToThingjsParser.enableProxima=!0,json2mesh.DefaultSetting.enableCombinePlacementsByRoom=!0),t.enableBatchObject&&(t.json2meshToThingjsParser.enableBatchObject=t.enableBatchObject),"String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node,this.json2meshToThingjsParser.setCampus(this.campus)),i.json&&(this.sceneJson=i.json)}return this.relativeResourceUrl&&(0===this.relativeResourceUrl.indexOf("./")?this.resourceUrl=this.sceneURL+this.relativeResourceUrl.replace("./","/"):this.resourceUrl=this.relativeResourceUrl),new Promise((function(e,i){t.updateProgress(.1),t.loadSceneJson().then((function(i){t.sceneJsonString=i,t.sceneJson=JSON.parse(i),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.1);var r=new json2mesh.MixTjsLoader;void 0!==t.app.options.loadingSceneMaxResourcesUnitDownloadNumber&&r.setResourcesUnitDownloadNumber(t.app.options.loadingSceneMaxResourcesUnitDownloadNumber),void 0!==t.app.options.loadingSceneAwaitToNextBuildTime&&(r.dynamicBuildManager.awaitToNextBuildTime=t.app.options.loadingSceneAwaitToNextBuildTime),t.enableDynamicLoad&&(r.enableRequestWorld=!1,t.json2meshToThingjsParser.enableDynamicLoad=!0),t.resourceUrl&&(r.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",r.resourceManager.baseModelUrl=t.resourceUrl+"/model/"),t.loader=r,r.load({json:t.sceneJson,customModeBaseUrl:t.sceneURL+"/",version:0}).then((function(i){var n=new hs;n.parseWorld(i),n.clear(),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.campus.visible=t.campusVisible,t.campusRotation&&t.campus.node.quaternion.set(t.campusRotation.x,t.campusRotation.y,t.campusRotation.z,t.campusRotation.w),t.campusPosition&&(t.campus.position=t.campusPosition),t.campusScale&&(t.campus.scale=t.campusScale),t.startDownloadResourcesCallback&&t.startDownloadResourcesCallback(r.resourceManager.models,r.resourceManager.textures),t.campus=t.json2meshToThingjsParser.parseWorld(i,r.resourceManager),t.enableDynamicLoad?(t.loadExtraData(t.campus),t.updateProgress(1),e(t.campus)):r.startToBuild((function(i){t.updateProgress(.1+.9*i),1===i&&(t.updateProgress(1),t.loadExtraData(t.campus),e(t.campus))}))}))}))}))},e.prototype.loadExtraData=function(e){this.sceneJson.extraData&&(e.extraData=this.sceneJson.extraData)},e.prototype.loadSceneJson=function(e){var t=this;return e&&(t.sceneURL=e),new Promise((function(e,i){t.sceneJson?e(t.sceneJson):new THREE.FileLoader(t.app.loadingManager).load(t.sceneURL.appendURL(t.sceneJsonUri),(function(t){e(t)}))}))},e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.startToDownloadRequestResources=function(e){this.loader.resourceManager.startToDownloadRequestResources(e)},e.prototype.addResourceDownloadRequest=function(e){this.loader.resourceManager.addResourceDownloadRequest(e)},e.prototype.clearAllResources=function(){this.clear()},e.prototype.clearAllObjects=function(){this.world.clear(),this.world=null},e.prototype.clear=function(){this.loader.clearAllResources(),this.json2meshToThingjsParser.clear(),this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=null,this.sceneJsonUri=null,this.defaultWallTextureUri=null,this.defaultWallEdgeTextureUri=null,this.defaultFloorTextureUri=null,this.defaultCeilingTextureUri=null,this.defaultRoofTextureUri=null,this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.enableDownloadSceneJsonCache=!0,this.enableDynamicLoad=!1,this.enableProxima=!1,this.enableBatchObject=!1},e.prototype.requestToBuild=function(e){this.loader.requestToBuild(e)},e.prototype.startToBuild=function(e){return this.loader.startToBuild(e)},e.prototype.disposeObject=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.loader.disposeObject(e,t)},e.prototype.findObjectByID=function(e){return this.world.findObjectByID(e)},e}(),La=function(){function e(t){n(this,e),this.app=t,this.supportVersion={1:1,2:1,3:0},this.versionLib={1:{0:{0:Qo},1:{0:Ta}},2:{0:{0:Jo},1:{0:Yo,1:Zo}},3:{0:{0:wa,1:wa,2:wa,3:wa},1:{0:Ma,2:Ma,3:Ma}},5:{0:{0:Aa,1:Aa,2:Aa,3:Aa,4:Aa}},6:{0:{0:ka,1:ka}},7:{0:{0:Fa}}}}return e.prototype.getLoader=function(e,t){if(e){var i=e.version,r=0,n=0,o=0;if(i){var s=i.split(".");r=parseInt(s[0]),n=parseInt(s[1]),o=parseInt(s[2])}var a=this._getFitVersion(r,n,o);if(!a)return void THING.Utils.error("can not load "+i+" data,please check data or update thingjs!");a.bigVersion===n&&a.smallVersion===o||THING.Utils.warn("can not load "+i+" data,try to use "+r+"."+a.bigVersion+"."+a.smallVersion+" to load data or update thingjs to load "+i+" data");var l=this.versionLib[r][a.bigVersion][a.smallVersion];if(e.bigVersion=a.bigVersion,e.smallVersion=a.smallVersion,1===r)h=new l(this.app);else if(2===r)switch(n){case 1:var u={},c=e.position;c&&(u.position=c),e.rotation&&(u.rotation=e.rotation),e.campus&&(u.campus=e.campus),u.isCamFitScene=Et.parseValue(e.isCamFitScene,!0),u.isDelayLoadFloorPlan=Et.parseValue(e.isDelayLoadFloorPlan,!1),h=new l(this.app,u);break;default:h=new l(this.app)}else h=new l(this.app,e,t);return h}var h=new Qo(this.app);return h},e.prototype._getFitVersion=function(e,t,i){if(!this.versionLib[e])return null;var r=this.versionLib[e],n=r[t];return n||(n=r[t=this._getClosestVersion(t,r)])?(n[i]||(i=this._getClosestVersion(i,n)),n[i]?{bigVersion:t,smallVersion:i}:null):null},e.prototype._getClosestVersion=function(e,t){for(var i=null;null==i;){if(e<0)return;t[--e]&&(i=e)}return i},e}(),Ia=function(){function e(){n(this,e)}return e._processUrl=function(e,t){var i=[];if(Et.isArray(t))for(var r=0;r<t.length;r++){var n=t[r];0==n.indexOf("/")&&e?i.push(e+n):-1===n.indexOf("http://")&&-1===n.indexOf("https://")||i.push(n)}else Et.isString(t)&&(e&&t.indexOf("/")?i=e+t:-1===t.indexOf("http://")&&-1===t.indexOf("https://")||(i=t));return i},e.generateEnvMapUrl=function(t,i){var r=void 0;if(Et.isArray(i)||Et.isString(i)){var n=t.confirmURL(Et.parseCubeTextureUrls_v2(i));r=(Et.isArray(n)&&n.length,n)}else if(Et.isObject(i)){var o=t.confirmURL(Et.parseCubeTextureUrls_v2(i)),s=!1;if(Et.isArray(o)?s=!!o.filter((function(e){return-1!==e.indexOf("http://")||-1!==e.indexOf("https://")})).length:Et.isString(o)&&(s=!(-1===o.indexOf("http://")&&-1===o.indexOf("https://"))),!s){var a=t.query(".Campus")[0];Et.isObject(a)&&(o=e._processUrl(a.url,o))}r=o}return r},e._generateSkyBoxUrl=function(t,i){var r=void 0;if(Et.isArray(i)||Et.isString(i))r=t.confirmURL(Et.parseCubeTextureUrls_v2(i));else if(Et.isObject(i)){var n=t.confirmURL(Et.parseCubeTextureUrls_v2(i)),o=!1;if(Et.isArray(n)?o=!!n.filter((function(e){return-1!==e.indexOf("http://")||-1!==e.indexOf("https://")})).length:Et.isString(n)&&(o=!(-1===n.indexOf("http://")&&-1===n.indexOf("https://"))),!o){var s=t.query(".Campus")[0];Et.isObject(s)&&(n=e._processUrl(s.url,n))}r=n}return r},e.parseLight=function(e,t){Et.isObject(e)&&Et.isObject(t)&&(e.lighting=t,t.shadowObjectMaxSize&&(e.query(".LightGroup")[0].shadowObjectMaxSize=t.shadowObjectMaxSize))},e.parsePostEffect=function(e,t){if(Et.isObject(e)&&Et.isObject(t)){var i={postEffect:t};e.postEffect=i}},e.parseSkyBox=function(t,i){if(Et.isObject(t)&&i){var r=e._generateSkyBoxUrl(t,i);r&&(t.skyBox=r)}},e.parseEnvMapBeforeLoadCampus=function(e,t,i){if(Et.isObject(e)&&t&&Et.isObject(i)){var r=e.query(".Campus")[0];if(Et.isObject(r)){var n=new ji(e);r._envMapResources=n.load(t,i.resourceLibrary)}}},e.parseEnvMapAfterLoadCampus=function(e,t){if(Et.isObject(e)){if(!t)t=e.query(".Campus")[0];if(Et.isObject(t))(t._envMapResources||t.getEnvMapResources())&&t.query("*").forEach((function(e){e.visible&&e.setupEnvMap(e.isFacade)}))}},e.parseCameraConfig=function(e,t){if(Et.isObject(e)&&Et.isObject(t))for(var i in t)t[i]&&(e.camera[i]=t[i])},e.getOutdoorsEnv=function(t,i){return t.options&&(t.options.env||null===t.options.env)?t.options.env:e.isSkyBoxSetted(t)?t.options.userParameters.skyBox:t.skyBox&&"Dark"!==t.skyBox?t.skyBox:i.environment?i.environment:null},e.getIndoorsEnv=function(e,t){return t.environmentInside?t.environmentInside:null},e.getSkyBox=function(t,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.isSkyBoxSetted(t)){var n=t.options.userParameters;return n.skyBox}return"Dark"===t.skyBox&&i.skybox||r?i.skybox:null},e.isSkyBoxSetted=function(e){return!!(e.options&&e.options.userParameters&&e.options.userParameters.skyBox)},e}(),Na=function(){function e(){n(this,e)}return e.parse=function(t,i,r){if(Et.isObject(t)&&Et.isObject(i)&&Et.isObject(r)){e.config=Et.cloneObject(i,!1),e.indexJson=Et.cloneObject(r,!1),Ia.parseLight(t,i.light),Ia.parsePostEffect(t,i.post);var n=[],o=Ia.getOutdoorsEnv(t,i);if(o){var s=Ia.generateEnvMapUrl(t,o);Et.isArray(s)&&s.length<=2?n=s:n[0]=s}if(!e.skipInDoorEnvMap&&n.length<2){var a=Ia.getIndoorsEnv(t,i);if(a){var l=Ia.generateEnvMapUrl(t,a);n[1]=l}}null!==o&&Ia.parseEnvMapBeforeLoadCampus(t,n,r),e.enableCameraParse&&Ia.parseCameraConfig(t,i.camera)}},e.parseAfterLoad=function(t){var i=t.app,r=(t.loadSkyBox,t.target),n=e.config,o=e.indexJson;Et.isObject(i)&&Et.isObject(n)&&Et.isObject(o)&&Ia.parseEnvMapAfterLoadCampus(i,r)},e}();Na.KEY=3,Na.enableCameraParse=!0,Na.skipInDoorEnvMap=!0;var Ua=function(){function e(){n(this,e)}return e.parse=function(t,i,r){if(Et.isObject(t)&&Et.isObject(i)&&Et.isObject(r)){e.config=Et.cloneObject(i,!1),e.indexJson=Et.cloneObject(r,!1),Ia.parseLight(t,i.light),Ia.parsePostEffect(t,i.effectConfig);var n=[],o=Ia.getOutdoorsEnv(t,i);if(o){var s=Ia.generateEnvMapUrl(t,o);Et.isArray(s)&&s.length<=2?n=s:n[0]=s}if(!e.skipInDoorEnvMap&&n.length<2){var a=Ia.getIndoorsEnv(t,i);if(a){var l=Ia.generateEnvMapUrl(t,a);n[1]=l}}null!==o&&Ia.parseEnvMapBeforeLoadCampus(t,n,r);var u=Ia.getSkyBox(t,i);Ia.parseSkyBox(t,u),e.enableCameraParse&&Ia.parseCameraConfig(t,i.camera)}},e.parseAfterLoad=function(t){var i=t.app,r=t.loadSkyBox,n=void 0!==r&&r,o=t.target,s=e.config,a=e.indexJson;if(Et.isObject(i)&&Et.isObject(s)&&Et.isObject(a)){Ia.parseEnvMapAfterLoadCampus(i,o);var l=Ia.getSkyBox(i,s,n);Ia.parseSkyBox(i,l)}},e}();Ua.enableCameraParse=!0,Ua.skipInDoorEnvMap=!1;var za=function(){function e(){n(this,e)}return e.parse=function(e,t,i){var r=i?i.version:null;if(r){var n=r.split("."),o=parseInt(n[0]);5===o||6===o||7===o?Ua.parse(e,t,i):o===Na.KEY&&Na.parse(e,t,i)}},e.parseAfterLoad=function(e){var t=e.app,i=e.loadSkyBox,r=void 0!==i&&i,n=e.target,o=Na.indexJson||Ua.indexJson,s=o?o.version:null;if(s){var a=s.split("."),l=parseInt(a[0]);5===l||6===l||7===l?Ua.parseAfterLoad({app:t,loadSkyBox:r,target:n}):l===Na.KEY&&Na.parseAfterLoad({app:t,loadSkyBox:r,target:n})}},e}(),Ha=!1,Va=void 0,Wa=function(){function e(t){n(this,e),this.app=t,this.waitingLoadCampuses=[],this.loadingCampus=!1}return e.prototype._loadViewPointFile=function(e){var t=this.app.sceneManager,i=Et.parseValue(e.enableDeafultViewPointFile,t.enableDeafultViewPointFile),r=e.defaultViewPointFileName||t.defaultViewPointFileName;if(i&&r){var n=e.url.appendURL(r),o=this;(new THREE.FileLoader).load(n,(function(e){o.app.viewPointManger.loadJSON(e)}))}},e.prototype._runScript=function(e){var t;(t=Et.isString(e)?e:function(e){return N?N.decodeString(e):""}(e))&&rt(t)},e.prototype.loadFromUBuilder=function(e,t,i,r,n){var o=this,s=r.position,a=r.rotation||r.angles,l=r.scale,u=Et.parseValue(r.outdoorsVisible||r.visible,!0),c=Et.parseValue(r.campusVisible||r.visible,!0),h=Et.parseValue(r.isCamFitScene,!0),p=Et.parseValue(r.isDelayLoadFloorPlan,!1),d=r.splitLoadSpeed,f=Et.parseValue(r.disableCache,!1),m=Et.parseValue(r.dynamic,!1),g=Et.parseValue(r.enableProxima,!1),v=Et.parseValue(r.enableBatchObject,!1);s&&(i.position=s),a&&(i.rotation=Et.parseQuaternion(a)),l&&(i.scale=l),void 0!==u&&(i.outdoorsVisible=u),void 0!==c&&(i.campusVisible=c),i.isCamFitScene=h,i.isDelayLoadFloorPlan=p,i.enableDownloadSceneJsonCache=!f,i.isDynamicLoadScene=Et.parseValue(m,i.isDynamicLoadScene),i.enableDynamicLoadScene=i.isDynamicLoadScene,i.enableProxima=Et.parseValue(g,i.enableProxima),i.enableBatchObject=Et.parseValue(v,i.enableBatchObject);var y=new La(this.app).getLoader(i,r);e._builder=y,y.loadSpeed=d;var b=i.camInfo;b&&(y.fitCamInfo=b),this.app.root._staticEnableFlag.lock(!1,"loadFromUBuilder"),e.trigger("beforeloadcampus"),y.loadSceneJson(t).then((function(r){var l=JSON.parse(r).thingjsconfig||{};za.parse(y.app,l,i),y.load({campus:e,json:r,url:t}).then((function(e){var t=y.sceneJson?y.sceneJson:i,r=y.sceneJsonString;e.setSceneJSONData(t,r),e.position=e.position||s,e.angles=e.angles||a,n&&n(),o.app.root._staticEnableFlag.unlock("loadFromUBuilder")}))}))},e.prototype.loadFromCampusBuildier=function(e,t,i,r,n){CampusBuilderOnlineLoader.init({app:this.app}),CampusBuilderOnlineLoader.getLoader().load(e,t,i,r,n)},e.prototype._loadCampusFinished=function(e,t){e._processModel(),this._loadViewPointFile(t),this.app._lightGroup.setConfig({}),this._removeTypeMap(t),THING.Utils.log("ThingJS: "+THING.VERSION)},e.prototype._convertOutdoorsToGround=function(e){if(e.outdoors){var t=e.outdoors.node;t.userData={},t.removeBySelf();var i=e.outdoors.id,r=e.outdoors.uuid,n=this.app.create({type:"Ground",id:i,uuid:r,node:t,visible:e.outdoors.visible,parent:e.outdoors.parent});e.outdoors.query("*",!1).not(".CombinedObject").forEach((function(t){e.add(t)})),e.outdoors.query(".CombinedObject",!1).forEach((function(e){n.add(e)})),e.outdoors.node=new THREE.Group,e.outdoors._children.clear(),e.outdoors.destroy(),e.outdoors=n}},e.prototype._loadFinished=function(e,t){var i=this,r=t.complete;if(t.complete=function(e){e.object._synEffectRefCounts(),i._loadCampusFinished(e.object,t),r&&r.call(e.object,e)},i._convertOutdoorsToGround(e),e.setupID(t),e instanceof Ri?(t.parent=t.parent||this.app.root,e._setup(t)):e instanceof Buliding&&e._setup(t),e._originalSceneString){var n=Et._getStringMD5Code(e._originalSceneString);(Va=function(e){var t=U.a;if(t){var i=t.sd5;if(i&&-1===i.indexOf(e))return!1}return!0}(n))||e.destroy()}},e.prototype.load=function(e,t){var i=this,r=this.app.confirmURL(t.url),n=r.appendURL("index.json");Et.parseValue(t.disableCache,!1)&&(n=n.appendRandomSuffix()),(t.fileloader||new THREE.FileLoader).load(n,(function(n){var o=JSON.parse(n);if(q){var s=new Pi(o.version);s.major<4||s.major>4?i.waitingLoadCampuses.push({owner:e,url:r,indexJson:o,params:t}):i.loadCampus(e,r,o,t)}else i.waitingLoadCampuses.push({owner:e,url:r,indexJson:o,params:t})}),(function(){}),(function(){var n=t.error||t.errorCallback;n&&n({url:r}),new La(i.app).getLoader().load({campus:e,url:r}).then((function(e){i._loadFinished(e,t)}))})),e.setupParent(t),t.skipSetupParent=!0},e.prototype._setupTypeMap=function(e){var t=e.typeMap;if(t)for(var i=0;i<t.length;i++){var r=t[i];Et.addCastType(r.type,r.condition,r.params)}},e.prototype._removeTypeMap=function(e){var t=e.typeMap;if(t)for(var i=0;i<t.length;i++){var r=t[i];Et.removeCastType(r.type,r.condition,r.params)}},e.prototype.loadCampus=function(e,t,i,r){var n=this,o=function(e,t){e.trigger("afterload"),n._loadFinished(e,t),n.loadingCampus=!1,e.loaded=!0,setTimeout((function(){n.app.trigger("campusready",{object:e})}),500)};i.resourceLibrary=r.loadResourceUrl||i.resourceLibrary,i.enableUseHighestVersionResource=r.enableUseHighestVersionResource,i.startDownloadResourcesCallback=function(e,t){var i=n.app.onLoadModelResourceCallback;i&&i(e,t)},this.loadingCampus=!0,json2mesh.DefaultSetting.enableFloorLightMap=Et.parseValue(r.enableFloorLightMap,!1),r.indexJson=i,e.trigger(F.BeforeLoad,r),this.app.loadingProgressBar.prepare(),this._setupTypeMap(r),e.loading=!0;var s=new Pi(i.version);e._version=s,s.major<4||s.major>4?this.loadFromUBuilder(e,t,i,r,(function(){o(e,r)})):this.loadFromCampusBuildier(e,t,i,r,(function(){o(e,r)}))},e.prototype.update=function(){if(q&&!this.loadingCampus)if(ue=ue||h.toStr([96,201,170,234,66,62,13,241,82,4,65,42,195,156,129,103,23,224,109,153,106]),THING[ue]||ee){for(var e=0;e<this.waitingLoadCampuses.length;e++){var t=this.waitingLoadCampuses[e];this.loadCampus(t.owner,t.url,t.indexJson,t.params),this.waitingLoadCampuses.splice(e,1)}void 0!==Va&&(Va?this.app.trigger("sceneMD5CheckSuccessed"):this.app.trigger("sceneMD5CheckFailed"),Va=void 0)}else if(!Ha){var i={t:(new Date).toUTCString(),v:Math.random()},r=JSON.stringify(i),n={"Content-type":"application/x-www-form-urlencoded"},o=h.toStr([96,201,174,231,66,51,32,235,92,3,108,33,253,138,129,102,17,202,118,180,116,65,157,101,253,161]),s=THING[o]||{};for(var a in s)n[a]=s[a];oe(r,n),Ha=!0}},e.prototype._buildCampusStructure=function(e,t){t.app=this.app,t.type=e.type,t.name=e.name?e.name:e.id,t.id=e.id?e.id:e.uuid,t.uuid=e.uuid,t.userData=e.userData,t.children=[],t.getAttribute=function(e){return Et.getAttribute(this,e)},t.getPath=function(){for(var e=this.id,t=this.parent;t&&t.parent&&t.parent.parent;)e=t.id+"/"+e,t=t.parent;return e},t._traverseObjects=function(e,t){for(var i=0;i<this.children.length;i++){var r=this.children[i];Et.isFunction(e)?e(r):Et.isArray(e)&&e.push(r),t&&r._traverseObjects(e,t)}},t.query=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[];this._traverseObjects(i,t);var r=new $t(this.app,i);return r.select(e),r};var i=0;e instanceof THING.Floor&&(i=1);for(var r=i;r<e.children.length;r++){var n=e.children[r],o={id:n.id,parent:t};t.children.push(o),this._buildCampusStructure(n,o)}},e.prototype._peekJSONBySimpleLoader=function(e,t,i){var r=i.complete,n=i.errorCallback||i.error,o=this;t.load(e).then((function(t){var i={url:e,id:t.id,children:[]};o._buildCampusStructure(t,i),t.destroy(),r&&r(i)})).catch((function(e){THING.Utils.error(e),n&&n()}))},e.prototype.peekJSON=function(e,t){t=t||{};var i=(e=this.app.confirmURL(e)).appendURL("index.json");Et.parseValue(t.disableCache,!1)&&(i=i.appendRandomSuffix());var r=t.fileloader||new THREE.FileLoader,n=this;r.load(i,(function(i){var r=JSON.parse(i),o=new Pi(r.version);4==o.major||(3==o.major?n._peekJSONBySimpleLoader(e,new Bo(n.app),t):n._peekJSONBySimpleLoader(e,new Oo(n.app),t))}),(function(){}),(function(){n._peekJSONBySimpleLoader(e,new Oo(n.app),t)}))},e.prototype.onUpdate=function(e){this.update(e)},e}(),Ga=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._graph=null,r._expanded=!1,r._structShow=!1,r}return s(t,e),t.prototype._canAcceptMouseEvent=function(e){var t=e.type;return!!w[t]},t.prototype.canAcceptEvent=function(t){if(e.prototype.canAcceptEvent.call(this,t))return this;var i=t.object;if(i&&i.isChildOf(this)){if(i.isFloor&&this._canAcceptMouseEvent(t))return this;if(i.isFacade&&this._canAcceptMouseEvent(t))return this;if(i.parent){if(i.parent.isFloor&&this._canAcceptMouseEvent(t))return this;if(i.parent.isFacade&&this._canAcceptMouseEvent(t))return this}}return null},t.prototype._addFromCampus=function(e){if(e.buildings.length){this.floors.destroy();var t=e.buildings[0].floors,i=this;t.forEach((function(e){i.add(e)}))}},t.prototype.loadResource=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?e.prototype.loadResource.call(this,t):this.floors.forEach((function(e){e.loadResource(!1)}))},t.prototype.unloadResource=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?e.prototype.unloadResource.call(this,t):this.floors.forEach((function(e){e.unloadResource()}))},t.prototype.setupElevators=function(){var e={};for(var t in this.query(".ElevatorDoor").forEach((function(t){var i=t.userData._ELEVATOR_;e[i]||(e[i]=[]),e[i].push(t)})),e){var i=e[t];this.app.create({type:"Elevator",name:t,parent:this,doors:i})}},t.prototype.setupStairs=function(){this.query("[type=stairway]").forEach((function(e){e.floorNode.visible=!1}));var e={};for(var t in this.query(".StairDoor").forEach((function(t){var i=t.userData._STAIR_;e[i]=e[i]||[],e[i].push(t)})),e){var i=e[t];this.app.create({type:"Stair",name:t,parent:this,doors:i})}},t.prototype.canNavigation=function(){return!0},t.prototype.customSetup=function(e){this._structShow=Et.parseValue(e.structShow,this._structShow)},t.prototype.setupNavigationObjects=function(){this.setupElevators(),this.setupStairs()},t.prototype.setupGraph=function(){if(this._graph)return this._graph;var e={};return this.floors.forEach((function(t){t._setupNavigationGraph(e,1e4)})),this._graph=new Graph(e),this._graph},t.prototype.destroy=function(){this._graph=null,e.prototype.destroy.call(this)},t.prototype.hasAnyFacadesVisible=function(){for(var e=this.facades,t=0;t<e.length;t++)if(e[t].visible)return!0;return!1},t.prototype.hasFacades=function(){return 0!==this.facades.length},t.prototype.showAllRoofs=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.floors.forEach((function(t){t.showAllRoofs(e)}))},t.prototype.expandFloors=function(e){e=e||{},this.expandCmd||(this.expandCmd=this.app.commandManager.create({type:"ExpandObjects"})),e.objects=this.floors.objects,e.hideRoof=Et.parseValue(e.hideRoof,!0),this.expandCmd.setParam(e),this.expandCmd.execute(),this._expanded=!0},t.prototype.unexpandFloors=function(e){e=e||{},this.expandCmd&&(e.hideRoof&&(e.hideRoof=!e.hideRoof),this.expandCmd.setParam(e),this.expandCmd.undo(),this._expanded=!1)},t.prototype.showFacades=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];THING.Utils.warn("[Building] Please use '.facades.visible=true/false' to replace '.showFacades()'"),this.facades.visible=e},t.prototype.showFloors=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];THING.Utils.warn("[Building] Please use '.floors.visible=true/false' to replace '.showFloors()'"),this.floors.visible=e},t.prototype.showRoof=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];THING.Utils.warn("[Building] Please use '.showAllRoofs()' to replace '.showRoof()'"),this.showAllRoofs(e)},o(t,[{key:"isBuilding",get:function(){return!0}},{key:"structShow",get:function(){return this._structShow}},{key:"expanded",get:function(){return this._expanded}},{key:"facade",get:function(){return this.query(".Facade",!1)[0]}},{key:"facades",get:function(){return this.query(".Facade",!1)}},{key:"elevators",get:function(){return this.query(".Elevator",!1)}},{key:"stairs",get:function(){return this.query(".Stair",!1)}},{key:"floors",get:function(){return this.query(".Floor",!1)}},{key:"things",get:function(){return this.query(".Thing",!1)}}]),t}(Si),qa=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._ceilingNode=null,r._ceilingObject=null,r._roofNode=null,r._roofObject=null,r._floorNode=null,r._floorObject=null,r._auxiliaryInfo=null,r._textRegion=null,r._holes=[],r._points=[],r}return s(t,e),t.prototype._toPoints=function(e){return e.map((function(e){return e.isVector3?e.toArray():e}))},t.prototype._toHoles=function(e){return e.map((function(e){return e.map((function(e){return e.isVector3?e.toArray():e}))}))},t.prototype.setup=function(t){var i;(e.prototype.setup.call(this,t),this._holes=t.holes||[],this._points=t.points||[],this._holes=this._toHoles(this._holes),this._points=this._toPoints(this._points),this._ceilingNode=t.ceilingNode||this._ceilingNode,this._roofNode=t.roofNode||this._roofNode,this._auxiliaryInfo=t.auxiliaryInfo||this._auxiliaryInfo,this._floorNode=t.floorNode||this._floorNode,t.floorHideByScene&&this._floorNode)&&((i=this._floorNode.parent)&&(this.app.resourceManager.remove(this._floorNode),this._floorNode=new THREE.Group,i.add(this._floorNode)));t.roofHideByScene&&this._roofNode&&((i=this._roofNode.parent)&&(this.app.resourceManager.remove(this._roofNode),this._roofNode=new THREE.Group,i.add(this._roofNode)))},t.prototype.setupResources=function(t){e.prototype.setupResources.call(this,t),this._ceilingNode=t.ceilingNode||this._ceilingNode,this._roofNode=t.roofNode||this._roofNode,this._floorNode=t.floorNode||this._floorNode,this._ceilingNode&&this.ceiling&&(this._ceilingNode.visible=this.ceiling.visible,this.ceiling.node=this._ceilingNode),this._roofNode&&this.roof&&(this._roofNode.visible=this.roof.visible,this.roof.node=this._roofNode),this._floorNode&&this.plan&&(this._floorNode.visible=this.plan.visible,this.plan.node=this._floorNode)},t.prototype.getFloorMesh=function(){var e=this._floorNode;if(!e)return null;var t=e.getMeshes();return t.length?t[0]:null},t.prototype.getRoomHeight=function(){return 3},t.prototype.showGrid=function(t,i,r,n,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;e.prototype.showGrid.call(this,t,i,r,n,o,s);var a=Et.parseVector3(this.labelPosition);this._grid._setWorldPosition(a,this.static)},t.prototype.getLabelPosition=function(e){var t=this.getFloorMesh();if(!t)return null;var i=t.getLabelPosition(e,"xz")||t.getLabelPosition(e,"xy");return i?i.toArray():null},t.prototype.getAvaliablePositions=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!Et.isNumber(e))return null;var r=[];if(Et.isArray(t[0]))for(var n=0;n<e;n++){var o=t[n];r.push(o)}else for(n=0;n<e;n++)r.push(t);var s=this.getFloorMesh();if(!s)return null;var a=s.getAvaliableLabelPosition(r,"xz",i);if(!a||a.length<e){var l=s.getAvaliableLabelPosition(r,"xy",i);l&&l.length>a.length&&(a=l)}for(n=0;n<a.length;n++)a[n]=a[n].toArray();return a},t.prototype.getRayCastPosition=function(e){if(!(e=Et.parseVector3(e)))return null;var t=this.getFloorMesh();if(!t)return null;var i=t.getRayCastPosition(e);return i?i.toArray():null},t.prototype.getPoints=function(e){},t.prototype._synTextRegion=function(){if(this._textRegion){var e=this._textRegion.position;if(this.style._volumeNode){var t=new THREE.Vector3;this.style._volumeNode.getWorldPosition(t),e[1]=t.y}else e[1]=this.position[1];e[1]+=.01,this._textRegion.position=e}},t.prototype.getNavigationMesh=function(){var e=this._floorNode;if(!e)return null;if(!this.area)return null;var t=e.getMeshes();return t.length?t[0]:null},t.prototype._getChildVisibles=function(){var e=this.children.concat([this.roof,this.ceiling,this.plan]),t=[];return e.forEach((function(e){e&&t.push(e.visible)})),t},t.prototype._onGetChild=function(){return this.children.concat([this.roof,this.ceiling,this.plan])},t.prototype.setRelativePoints=function(e){e&&(this._points=e.slice(0))},t.prototype._getLinkableDoors=function(){var t=e.prototype._getLinkableDoors.call(this);return t.add(this.doors),t},t.prototype.showCeiling=function(e){THING.Utils.warn("[Room] Please use '.ceiling.visible=true/false' to replace '.showCeiling()'"),this.ceiling.visible=e},t.prototype.showRoof=function(e){THING.Utils.warn("[Room] Please use '.roof.visible=true/false' to replace '.showRoof()'"),this.roof.visible=e},t.prototype.showFloor=function(e){THING.Utils.warn("[Room] Please use '.floorNode.visible=true/false' to replace '.showFloor()'"),this.floorNode.visible=e},t.prototype.showRoof=function(e){THING.Utils.warn("[Room] Please use '.roof.visible=true/false' to replace '.showRoof()'"),this.roof.visible=e},t.prototype.setFloor=function(e){THING.Utils.warn("[Room] Please use '.floorNode.style.' to replace '.setFloor()'"),e=e||{};var t=this.floorNode.style,i=e.color;i&&(t.color=i);var r=e.opacity;r&&(t.opacity=r)},t.prototype.getAvaliableFloorPos=function(e,t){return THING.Utils.warn("[Room] Please use '.floor.getAvaliablePositions()' to replace '.getAvaliableFloorPos()'"),this.getAvaliablePositions(e,t)},o(t,[{key:"isRoom",get:function(){return!0}},{key:"labelPosition",get:function(){var e=this.getLabelPosition(null);if(e)return e;var t=this._auxiliaryInfo;return t&&t.center?t.center.toArray():null}},{key:"perimeter",get:function(){var e=this.points;return THING.Math.getPerimeter(e)}},{key:"area",get:function(){var e=this.points;return THING.Math.getArea(e)}},{key:"ceiling",get:function(){return!this._ceilingObject&&this._ceilingNode&&(this._ceilingObject=new Ro(this.app)._init(this._ceilingNode),this._ceilingObject._parent=this),this._ceilingObject}},{key:"roof",get:function(){return!this._roofObject&&this._roofNode&&(this._roofObject=new Ro(this.app)._init(this._roofNode),this._roofObject._parent=this),this._roofObject}},{key:"plan",get:function(){this._floorObject||this.getFloorMesh()&&(this._floorObject=new Ro(this.app)._init(this.getFloorMesh()),this._floorObject._parent=this);return this._floorObject}},{key:"misc",get:function(){return this.miscObject||(this.miscObject=this.query(".CombinedObject").query("[userData/type=CombineMiscParent]")[0]),this.miscObject}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}},{key:"points",get:function(){var e,t=this;if(this._points.length)e=this._points.map((function(e){return t.selfToWorld(e)}));else{var i=this.getFloorMesh();if(!i)return null;e=i.getPoints(),this.holes.forEach((function(t){t.forEach((function(t){for(var i=0;i<e.length;i++){var r=e[i];THING.Math.equalsVector(t,r)&&e.splice(i--,1)}}))}))}for(var r=0;r<e.length-1;r++)THING.Math.equalsVector(e[r],e[r+1])&&e.splice(r--,1);return e}},{key:"things",get:function(){var e=this.parent;if(!e)return new $t(this.app,[]);for(var t=[],i=e.things,r=0;r<i.length;r++){var n=i[r];this.getRayCastPosition(n.position)&&t.push(n)}return this._children.forEach((function(e){e.isBatchSubObject&&t.push(e)})),new $t(this.app,t,!0).buildReturnObject(t).add(this.query(".Thing"))}},{key:"doors",get:function(){for(var e=this.floor.doors,t=[],i=0;i<e.length;i++)for(var r=e[i],n=new THREE.Vector3,o=Et.parseVector3(r.position),s=[Et.parseVector3(r.forward)],a=0;a<s.length;a++){var l=s[a];if(l.multiplyScalar(1),n.addVectors(o,l),this.getRayCastPosition(n)||(l.multiplyScalar(-1),n.addVectors(o,l),this.getRayCastPosition(n))){t.push(r);break}}return new $t(this.app,t).buildReturnObject(t)}},{key:"textRegion",get:function(){return this._textRegion||(this._textRegion=this.app.create({type:"TextRegion",text:this.name,parent:this,position:this.labelPosition,angles:[-90,0,0]}),this._textRegion.translateY(.1),this._textRegion.renderOrder=1),this._synTextRegion(),this._textRegion},set:function(e){e?(this._textRegion=e,this._synTextRegion()):(this._textRegion.destroy(),this._textRegion=null)}},{key:"holes",get:function(){var e=[];if(this._holes){var t=this;this._holes.forEach((function(i){var r=[];i.forEach((function(e){r.push(t.selfToWorld(e))})),e.push(r)}))}return e}},{key:"floorIndex",get:function(){return THING.Utils.warn("[Room] Please use '.floor.indexOfParent()' to replace '.floorIndex()'"),this.floor.indexOfParent()}},{key:"center",get:function(){return THING.Utils.warn("[Room] Please use '.labelPosition' to replace '.center' or if you want to use .boundingBox.center to get center of boundingBox?"),this.labelPosition}},{key:"floorNode",get:function(){return THING.Utils.warn("[Room] Please use '.plan' to replace '.floorNode'"),this.plan}}]),t}(Si),Xa=document.createElement("canvas");Xa.width=256,Xa.height=1;var Ja=Xa.getContext("2d");function Ya(e,t){var i=Ja.createLinearGradient(0,0,256,0);for(var r in e)i.addColorStop(+r,e[r]);Ja.fillStyle=i,Ja.fillRect(0,0,256,1);var n=new Uint8Array(Ja.getImageData(0,0,256,1).data.buffer);return void 0!==t?t.image={data:n,width:256,height:1}:t=new THREE.DataTexture(n,256,1),t.magFilter=t.minFilter=THREE.LinearFilter,t.needsUpdate=!0,t}var Za=new Map,Qa=new Map,Ka=new Map,$a=new Map,el=!1,tl=function(){function e(){n(this,e)}return e.start=function(e){el||(e.on("update",(function(){$a.forEach((function(e){e.forEach((function(e){return e.matrix.elements[7]-=e.speed}))}))})),el=!0)},e.register=function(e,t){Za.set(e,t),Qa.set(e,function(e){var t={};for(var i in e){var r=i.split("-"),n=r[0];t[n]||(t[n]={});var o=r[1];void 0===o||t[n][o]||(t[n][o]={});var s=r[2];void 0!==s&&(t[n][o][s]={})}return t}(t.class)),Ka.set(e,function(e){var t=new Map;for(var i in e){var r=e[i].colormap;if(r){var n=void 0;t.has(i)&&(n=t.get(i)),t.set(i,Ya(r,n))}}return t}(t.class)),$a.set(e,function(e){var t=new Map;for(var i in e){if(e[i].useScrollTex){var r=e[i].scrollSpeed||.003;t.set(i,{matrix:new THREE.Matrix3,speed:r})}}return t}(t.class))},e.findStyle=function(e,t,i){if(!Za.has(e)||!Qa.has(e))return THING.Utils.warn("StyleManager: style '"+e+"' not registed."),null;if(i&&i._sfStyle){var r=i._sfStyle;return{style:Za.get(e).class[r],colormap:Ka.get(e).get(r),scroll:$a.get(e).has(r)?$a.get(e).get(r).matrix:null}}if(t&&i){var n=function(e,t,i){var r=t.type,n="";if(!e[r])for(var o in e)THING.Utils.instanceOf(t,o)&&(r=o);if(!e[r])return"";for(var s in e[r]){var a=t.tags;if("Facade"===r&&t.building&&(a=t.building.tags),a.indexOf(s)>-1&&""!==s){n=s;break}}if(!e[r][n])return r;for(var l in e[r][n])if(i.name===l)return r+"-"+n+"-"+i.name;return r+(""!==n?"-"+n:"")}(Qa.get(e),t,i);return{style:Za.get(e).class[n],colormap:Ka.get(e).get(n),scroll:$a.get(e).has(n)?$a.get(e).get(n).matrix:null}}return Za.get(e)},e}();function il(e,t){var i=e.getMatrixFromRoot(t),r=e.geometry;if(r&&r.isBufferGeometry&&!r.getAttribute("uv3")){for(var n=r.getAttribute("position"),o=new THREE.BufferAttribute(new Float32Array(2*n.count),2),s=new THREE.Vector3,a=-1/0,l=1/0,u=0;u<n.count;u++)s.fromArray(n.array,3*u).applyMatrix4(i),o.array[2*u+0]=.5,o.array[2*u+1]=s.y,a=Math.max(a,s.y),l=Math.min(l,s.y);for(var c=a-l,h=0;h<n.count;h++)o.array[2*h+1]=o.array[2*h+1]/c;r.addAttribute("uv3",o)}}var rl=function(){function e(t){n(this,e),this.obj=t,this._opacity=null,this._color=null,this._wireframe=!1,this._image="",this._doubleSide=!1,this._uvAnimationParams=null,this._emissive=null,this._emissiveScrollImage=null,this._environmentImage=null,this._highlight=null,this._highlightIntensity=null,this._inheritThemeName=null,this._themeName=null,this._alwaysOnTop=!1,this._renderOrder=0,this._defaultOutlineColor=null,this._outlineColor=null,this._glow=!1,this._innerGlow=!1,this._focusRegion=!1,this._edgeColor=null,this._edgeIncludeChildren=!0,this._edgeWireframes=new Map,this._boundingBoxNode=null,this._orientedBoundingBoxNode=null,this._axisNode=null,this._vertexNormalNode=null,this._synStyle=null}return e.prototype._syn=function(){var e=this._synStyle;e&&(delete this._synStyle,e.execute(this.obj))},e.prototype._setSynValue=function(e,t){if(!this.obj||!this.obj.app)return!1;var i=this.obj.dataToRecover;return i&&(i.style[e]=t),!this.obj.loaded&&(this._synStyle||(this._synStyle=this.obj.app.commandManager.create({type:"SetObjectStyle",object:this.obj})),this._synStyle.setAttribute(e,t),!0)},e.prototype._getSynValue=function(e){return this._synStyle?this.obj.loaded?null:this._synStyle.getAttribute(e):null},e.prototype._traverse=function(e){var t=[];this.obj.children.forEach((function(e){t.push(e.node)})),this.obj.node.traverseBranch((function(i){if(-1!==t.indexOf(i))return!1;i.userData.skipStyle||e(i)}))},e.prototype._onEnter=function(){},e.prototype._onLeave=function(){},e.prototype._changeMaterial=function(e){this._traverse((function(t){if(t.material){var i=t.material;Et.isArray(i)?t.material=i.map((function(i){return e(i,t)})):t.material=e(i,t)}}))},e.prototype._cloneAndModifyMaterial=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments[2];i=i||function(e){return!t||!(!e._isCloned()||!e._getOriginal())},this._changeMaterial((function(t,r){if(i(t))return e&&e(t._getPrevMaterial(),t,r),t;var n=t._pushAndCloneSelf();return e&&e(n._getPrevMaterial(),n,r),n}))},e.prototype.revertMaterial=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._changeMaterial((function(i){var r=t?i._getOriginal():i._getPrevMaterial();return r?(Et.parseValue(THING.needDisposeMaterial,!0)&&e.obj.app.materialDisposeManager.push(i),r):(Et.revertValue(i,"opacity"),Et.revertValue(i,"color"),Et.revertValue(i,"depthTest"),Et.revertValue(i,"depthWrite"),Et.revertValue(i,"onBeforeRender"),Et.revertValue(i,"wireframe"),Et.revertValue(i,"wireframeMap"),Et.revertValue(i,"map"),i)}))},e.prototype._applyMaterial=function(e,t,i){var r=this._getThemeName(),n=void 0,o=void 0;if(r){var s=tl.findStyle(r,this.obj,i);s&&s.style&&(void 0===s.style.enable||s.style.enable)&&(n=s,o=tl.findStyle(r))}if(n&&n.style.reflection&&n.style.reflection.enable){var a=n.style.reflection;t.metalness=a.metalness,t.roughness=a.roughness,t.specularFactor=void 0!==a.specularFactor?a.specularFactor:1}else t.metalness=e.metalness,t.roughness=e.roughness,t.specularFactor=1;n&&n.style.fresnel?(t.fresnelPower=n.style.fresnel.power,t.fresnelInverse=n.style.fresnel.inverse):(t.fresnelPower=0,t.fresnelInverse=!1),(this._emissiveScrollImage||n&&n.style.useScrollTex)&&il(i,this.obj.node),this._applyMaterialOpacity(e,t,n),this._applyMaterialColor(e,t,n),this._applyMaterialEmissive(e,t,n),this._applyMaterialEmissiveScrollImage(e,t,n,o),this._applyMaterialImage(e,t,n,o),this._applyMaterialEnvironmentImage(e,t,n,o)},e.prototype._applyMaterialOpacity=function(e,t,i){var r=void 0;r=e.isShaderMaterial&&e.uniforms.opacity?e.uniforms.opacity.value:e.opacity,null!==this._opacity&&void 0!==this._opacity&&(r*=this._opacity),i&&void 0!==i.style.opacity&&(r*=i.style.opacity),t.isShaderMaterial&&t.uniforms.opacity?t.uniforms.opacity.value=r:t.opacity=r,e.alphaTest&&(t.alphaTest=r*e.alphaTest);var n=t.transparent;t.transparent=e.transparent||r<1,t.transparent!=n&&(t.needsUpdate=!0)},e.prototype._applyMaterialColor=function(e,t,i){null!==this._color&&void 0!==this._color?(t.color&&t.color.copy(this._color),t.colorMapping&&(t.needsUpdate=!0),t.colorMapping=null,t.colorMappingIntensity=1):(t.color&&e.color&&(i&&i.style.color&&i.style.color.enable?t.color.set(i.style.color.value):t.color.copy(e.color)),i&&(void 0===i.style.useColormap||i.style.useColormap)?(t.colorMapping||(t.needsUpdate=!0),t.colorMapping=i.colormap,t.colorMappingIntensity=void 0!==i.style.colormapIntensity?i.style.colormapIntensity:1):(t.colorMapping&&(t.needsUpdate=!0),t.colorMapping=null,t.colorMappingIntensity=1))},e.prototype._applyMaterialEmissive=function(e,t,i){null!==this._emissive&&void 0!==this._emissive?t.emissive&&(t.emissive.copy(this._emissive),t.emissiveIntensity=1):t.emissive&&e.emissive&&(i&&i.style.useScrollTex?(t.emissive.set(i.style.scrollColor),t.emissiveIntensity=1):(t.emissive.copy(e.emissive),t.emissiveIntensity=e.emissiveIntensity||0)),i&&i.style.colorImage&&i.style.colorImage.enable&&!i.style.useScrollTex&&(t.emissiveIntensity=0)},e.prototype._applyMaterialEmissiveScrollImage=function(e,t,i,r){var n=this.obj.app;if(null!==this._emissiveScrollImage&&void 0!==this._emissiveScrollImage)void 0!==t.emissiveMap&&(t.emissiveMap||(t.needsUpdate=!0),t.emissiveMap=n.resourceManager.loadTexture(this._emissiveScrollImage,(function(){}),{repeat:!0,premultiplyAlpha:!0}),t.defines=t.defines||{},t.defines.USE_ALPHA_UV3=!0,t.defines.USE_EMISSIVETRANSFORM=!0,t.defines.USE_SIDE_EMISSIVE=!0,t.uvTransform2=function(e){ol||(e.on("update",sl),ol=!0);return nl}(n),n.rendererManager.autoDirty=!0,t.needsUpdate=!0);else if(void 0!==t.emissiveMap&&void 0!==e.emissiveMap)if(i&&i.style.useScrollTex){t.emissiveMap||(t.needsUpdate=!0);var o=i.style.scrollTex;r&&r.resourcePrefix&&(o=r.resourcePrefix.appendURL(i.style.scrollTex)),t.emissiveMap=n.resourceManager.loadTexture(o,(function(){}),{repeat:!0,premultiplyAlpha:!0}),t.defines=t.defines||{},t.defines.USE_ALPHA_UV3=!0,t.defines.USE_EMISSIVETRANSFORM=!0,t.defines.USE_SIDE_EMISSIVE=!0,t.uvTransform2=i.scroll,n.rendererManager.autoDirty=!0,t.needsUpdate=!0}else!!t.emissiveMap!=!!e.emissiveMap&&(t.needsUpdate=!0),t.emissiveMap=e.emissiveMap,t.uvTransform2=null,t.defines&&(t.defines.USE_ALPHA_UV3&&(delete t.defines.USE_ALPHA_UV3,t.needsUpdate=!0),t.defines.USE_EMISSIVETRANSFORM&&(delete t.defines.USE_EMISSIVETRANSFORM,t.needsUpdate=!0),t.defines.USE_SIDE_EMISSIVE&&(delete t.defines.USE_SIDE_EMISSIVE,t.needsUpdate=!0))},e.prototype._applyMaterialImage=function(e,t,i,r){var n=this,o=this.obj.app;if(this._image)void 0!==t.map&&(t.map||(t.needsUpdate=!0),t.map=this.obj.app.resourceManager.loadTexture(this._image,(function(){n.obj&&(o.needUpdate=!0)}),{repeat:!0,flipY:!e.map||e.map.flipY}));else if(void 0!==t.map&&void 0!==e.map)if(i&&i.style.image){t.map||(t.needsUpdate=!0);var s=i.style.image;r&&r.resourcePrefix&&(s=r.resourcePrefix.appendURL(i.style.image)),t.map=this.obj.app.resourceManager.loadTexture(s,(function(){n.obj&&(o.needUpdate=!0)}),{repeat:!0})}else i&&i.style.colorImage&&i.style.colorImage.enable?(t.map||(t.needsUpdate=!0),t.map=this.obj.app.resourceManager.textureLoader.loadTextureFromColor(i.style.colorImage.color)):(!!t.map!=!!e.map&&(t.needsUpdate=!0),t.map=e.map)},e.prototype._applyMaterialEnvironmentImage=function(e,t,i,r){var n=this,o=this.obj.app;if(this._environmentImage)void 0!==t.envMap&&(t.needsUpdate=!0,Array.isArray(this._environmentImage)?t.envMap=this.obj.app.resourceManager.loadCubeTexture(this._environmentImage,(function(){t.envMapIntensity=1.3,n.obj&&(o.needUpdate=!0)})):t.envMap=this.obj.app.resourceManager.loadTexture(this._environmentImage,(function(){t.envMapIntensity=1.3,n.obj&&(o.needUpdate=!0)}),{mapping:THREE.EquirectangularReflectionMapping}));else if(void 0!==t.envMap&&void 0!==e.envMap)if(i&&i.style.reflection&&i.style.reflection.enable){t.needsUpdate=!0;var s=void 0,a=void 0;r&&void 0!==r.resourcePrefix&&void 0!==r.enviroment?r.enviroment.type&&"image"===r.enviroment.type?s=r.resourcePrefix?r.resourcePrefix.appendURL(r.enviroment.value):r.enviroment.value:a=r.enviroment.type&&"skybox"===r.enviroment.type?r.enviroment.value.map((function(e){return r.resourcePrefix?r.resourcePrefix.appendURL(e):e})):[s=r.resourcePrefix?r.resourcePrefix.appendURL(r.enviroment):r.enviroment,s,s,s,s,s]:a=[s=o.baseURL.appendURL("/images/reflect1.jpg"),s,s,s,s,s],t.envMap=a?this.obj.app.resourceManager.loadCubeTexture(a,(function(){t.envMapIntensity=1.5,n.obj&&(o.needUpdate=!0)})):this.obj.app.resourceManager.loadTexture(s,(function(){t.envMapIntensity=1.5,n.obj&&(o.needUpdate=!0)}),{mapping:THREE.EquirectangularReflectionMapping})}else t.needsUpdate=!0,t.envMapIntensity=e.envMapIntensity,t.envMap=e.envMap},e.prototype._applyTheme=function(e,t){var i=this;if(!this._skipApplyTheme){var r=this.obj.app;(t||this._themeName!==e)&&(this._themeName=e||null,this.isNeedRevertMaterials()?this.revertMaterial():this._cloneAndModifyMaterial((function(e,t,r){i._applyMaterial(e,t,r)})),this.removeEdgeWireframe(),null==this._themeName?(this._setEffectRefCounts("smallGlow",!1),this._setEffectRefCounts("middleGlow",!1)):this._traverse((function(e){if(e.geometry){var t=tl.findStyle(i._themeName,i.obj,e);if(t){var n=t.style;if(n&&(void 0===n.enable||n.enable)){n.glow?2==n.glow?(r.effectManager.removeEffect(e,"smallGlow"),e._cachedTechnique&&e._cachedTechnique.middleGlow?r.effectManager.setEffect(e,"middleGlow",1,"skip"==e._cachedTechnique.middleGlow):r.effectManager.removeEffect(e,"middleGlow")):(r.effectManager.setEffect(e,"smallGlow"),r.effectManager.removeEffect(e,"middleGlow")):(r.effectManager.removeEffect(e,"smallGlow"),r.effectManager.removeEffect(e,"middleGlow"));var o=n.wireframe.enable,s=n.wireframe.color,a=n.wireframe.glow,l=void 0!==n.wireframe.opacity?n.wireframe.opacity:.99;o&&i._setEdgeWireframe(e,a,s,l)}}}})),this.obj.static&&this.obj.node._synMatrixWorld(),r.needUpdate=!0)}},e.prototype._getThemeName=function(){if(this.obj.isCombinedObject){for(var e=this.obj;e&&e.isCombinedObject;)e=e.parent;return e.style._themeName}return this._themeName},e.prototype.isNeedRevertMaterials=function(){return!this.isNeedCloneMaterials()},e.prototype.isNeedCloneMaterials=function(){return!Et.isNull(this._opacity)||(!Et.isNull(this._color)||(!Et.isNull(this._emissive)||(!Et.isNull(this._highlight)||(!!this._emissiveScrollImage||(!!this._alwaysOnTop||(!!this._wireframe||(!!this._image||(!!this._environmentImage||(!!this._uvAnimationParams||!!this._getThemeName())))))))))},e.prototype.setOpacity=function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Et.isNumber(e)&&(e=THING.Math.clamp(e,0,1)),Et.isNull(this._opacity)&&Et.isNull(e)||e!=this._opacity&&(1==e&&Et.isNull(this._opacity)||(this._opacity=e,this.isNeedRevertMaterials()?this.revertMaterial():this._cloneAndModifyMaterial((function(e,i,r){var n=t._getThemeName(),o=void 0;if(n){var s=tl.findStyle(n,t.obj,r);s&&s.style&&(void 0===s.style.enable||s.style.enable)&&(o=s)}t._applyMaterialOpacity(e,i,o)}),i),this.obj.isCombinedObject?this.obj.node.traverse((function(e){e.isEdgeWireframe&&e.parent&&(null!==t._opacity&&void 0!==t._opacity?e.material.opacity=e.material._initOpacity*t._opacity:e.material.opacity=e.material._initOpacity)})):this._edgeWireframes.forEach((function(e){e.isObject3D&&(null!==t._opacity&&void 0!==t._opacity?e.material.opacity=e.material._initOpacity*t._opacity:e.material.opacity=e.material._initOpacity,e.material.transparent=e.material.opacity<1)}))))},e.prototype.setColor=function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){if(!(e=Et.parseColor(e)))return;this._color=e}else{if(!this.color)return;this._color=null}this.isNeedRevertMaterials()?this.revertMaterial():this._cloneAndModifyMaterial((function(e,i,r){var n=t._getThemeName(),o=void 0;if(n){var s=tl.findStyle(n,t.obj,r);s&&s.style&&(void 0===s.style.enable||s.style.enable)&&(o=s)}t._applyMaterialColor(e,i,o)}),i),this.obj.isCombinedObject?this.obj.node.traverse((function(e){e.isEdgeWireframe&&e.parent&&(null!==t._color&&void 0!==t._color?e.material.color.copy(t._color):e.material.color.set(e.material._initColor))})):this._edgeWireframes.forEach((function(e){e.isObject3D&&(null!==t._color&&void 0!==t._color?e.material.color.copy(t._color):e.material.color.set(e.material._initColor))}))},e.prototype.setEmissive=function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){if(!(e=Et.parseColor(e)))return;this._emissive=e}else{if(!this.emissive)return;this._emissive=null}this.isNeedRevertMaterials()?this.revertMaterial():this._cloneAndModifyMaterial((function(e,i,r){var n=t._getThemeName(),o=void 0;if(n){var s=tl.findStyle(n,t.obj,r);s&&s.style&&(void 0===s.style.enable||s.style.enable)&&(o=s)}t._applyMaterialEmissive(e,i,o)}),i)},e.prototype.setHighlight=function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){if(!(e=Et.parseColor(e)))return;this._highlight=e}else{if(!this.highlight)return;this._highlight=null}this.isNeedRevertMaterials()?this.revertMaterial():this._cloneAndModifyMaterial((function(e,i,r){i.highlightColor&&(null!==t._highlight?(i.highlightColor.copy(t._highlight),i.highlightIntensity=Et.isNull(t._highlightIntensity)?.5:t._highlightIntensity):(e.highlightColor?i.highlightColor.copy(e.highlightColor):i.highlightColor.setRGB(0,0,0),i.highlightIntensity=0))}),i)},e.prototype.setHighlightIntensity=function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Et.isNumber(e)&&(e=THING.Math.clamp(e,0,1)),Et.isNull(this._highlightIntensity)&&Et.isNull(e)||e!=this._highlightIntensity&&(.5==e&&Et.isNull(this._highlightIntensity)||(this._highlightIntensity=e,this._highlight&&this._cloneAndModifyMaterial((function(e,i,r){void 0!==i.highlightIntensity&&(i.highlightIntensity=Et.isNull(t._highlightIntensity)?.5:t._highlightIntensity)}),i)))},e.prototype.setEmissiveScrollImage=function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){if(e=this.obj.app.confirmURL(e),this._emissiveScrollImage==e)return;this._emissiveScrollImage=e}else{if(!this._emissiveScrollImage)return;this._emissiveScrollImage=null}this.isNeedRevertMaterials()?this.revertMaterial():this._cloneAndModifyMaterial((function(e,i,r){var n=t._getThemeName(),o=void 0,s=void 0;if(n){var a=tl.findStyle(n,t.obj,r);a&&a.style&&(void 0===a.style.enable||a.style.enable)&&(o=a,s=tl.findStyle(n))}il(r,t.obj.node),t._applyMaterialEmissiveScrollImage(e,i,o,s)}),i)},e.prototype.setEnvironmentImage=function(e){var t=this;if(Et.isString(e)&&(e.indexOf(".png")>-1||e.indexOf(".jpg")>-1)){if(e=this.obj.app.confirmURL(e),this._environmentImage===e)return;this._environmentImage=e}else{var i=this.obj.app.confirmURL(Et.parseCubeTextureUrls(e));if(i){if(Array.isArray(this._environmentImage)&&this._environmentImage[0]===i[0]&&this._environmentImage[1]===i[1]&&this._environmentImage[2]===i[2]&&this._environmentImage[3]===i[3]&&this._environmentImage[4]===i[4]&&this._environmentImage[5]===i[5])return;this._environmentImage=i}else{if(!this._environmentImage)return;this._environmentImage=null}}this.isNeedRevertMaterials()?this.revertMaterial():this._cloneAndModifyMaterial((function(e,i,r){var n=t._getThemeName(),o=void 0,s=void 0;if(n){var a=tl.findStyle(n,t.obj,r);a&&a.style&&(void 0===a.style.enable||a.style.enable)&&(o=a,s=tl.findStyle(n))}t._applyMaterialEnvironmentImage(e,i,o,s)}))},e.prototype.setOutlineColor=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Et.isNull(e))this._outlineColor&&(this._setEffectRefCounts("outline_0x"+this._outlineColor.getHexString(),!1),this.obj.node.traverse((function(e){e.layers.disable(1),delete e.userData.forceOutline})),this._outlineColor=null),this._defaultOutlineColor&&this._setEffectRefCounts("outline_0x"+this._defaultOutlineColor.getHexString(),!0);else{this._outlineColor&&this._setEffectRefCounts("outline_0x"+this._outlineColor.getHexString(),!1);e=Et.parseColor(e);this._outlineColor=e,this._setEffectRefCounts("outline_0x"+e.getHexString(),!0),t&&(this.obj.node.ensureParentsVisible(!0),this.obj.node.visible=!0),this.obj.node.traverse((function(e){(t||e.ensureVisible())&&(e.isSprite||(e.layers.enable(1),t&&(e.visible=!0,e.userData.forceOutline=!0)))}))}this.obj.app.needEffectUpdate=!0},e.prototype.setDefaultOutlineColor=function(e){var t=Et.parseColor(e);t?(this._defaultOutlineColor=t,this.outlineColor||this._setEffectRefCounts("outline_0x"+t.getHexString(),!0),this.obj.app.needEffectUpdate=!0):(this._defaultOutlineColor=null,this._clearAllOutlineColor(),this._outlineColor&&(this.outlineColor=this._outlineColor))},e.prototype.setSkipBoundingBox=function(e){this.obj.dirty=!0,this.obj.node.skipBoundingBox(e),this.obj.parents.forEach((function(e){e.boundingBoxControl.dirty=!0})),this.obj.dirty=!0},e.prototype._setNodesAttribute=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._traverse((function(r){!r.isRenderable()&&i||(r.userData[e]=t)}))},e.prototype._setAlwaysOnTop=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((this.alwaysOnTop!=e||t)&&this.obj.node.parent)if(this._alwaysOnTop=e,e){this._cloneAndModifyMaterial((function(e,t,i){t.transparent=!0})),Et.backupValue(this.obj.node,"parent");var i=new THREE.MeshStandardMaterial({transparent:!0,opacity:1e-4}),r=new THREE.Mesh(new THREE.Geometry,i);r.name="AlwaysOnTopRootMesh",r.frustumCulled=!1,r.renderOrder=THING.BaseStyle.cRenderOrderValueMask-1,r.onAfterRender=function(e){e.clearDepth()},this.obj.node.parent.add(r),this.obj.node.attachToParent(r,this.obj.app.scene,!0),this._traverse((function(e){e.renderOrder+=THING.BaseStyle.cRenderOrderValueMask}))}else{this.isNeedRevertMaterials()?this.revertMaterial():this._changeMaterial((function(e,t){return Et.revertValue(e,"transparent"),e}));var n=Et.getValue(this.obj.node,"parent",!0);if(n){var o=this.obj.node.parent;o.removeBySelf(),n.add(this.obj.node),this._traverse((function(e){e.renderOrder-=THING.BaseStyle.cRenderOrderValueMask}))}}},e.prototype.setAlwaysOnTop=function(e){this._setSynValue("alwaysOnTop",e)||this._setAlwaysOnTop(e)},e.prototype.setBoundingBox=function(e,t){if(e){if(!this._boundingBoxNode){this.obj.dirty=!0;var i=this.obj.getLocalBoundingBox().toBox();this._boundingBoxNode=new THREE.Box3Helper(i,16777215),this._boundingBoxNode.frustumCulled=!1,this._boundingBoxNode.name=this.obj.name+"_BoundingBox",this._boundingBoxNode.skipBoundingBox(!0)}this._boundingBoxNode.material.color=Et.parseColor(t),this.obj.node.add(this._boundingBoxNode),this._boundingBoxNode.updateMatrixWorld(),this.obj.tickable=!0}else this.obj.app.resourceManager.remove(this._boundingBoxNode),this._boundingBoxNode=null;this._boundingBoxNode&&(this._boundingBoxNode.visible=e)},e.prototype.setOrientedBoundingBox=function(e,t){if(e){if(!this._orientedBoundingBoxNode){this.obj.dirty=!0;var i=this.obj.getLocalBoundingBox().toBox();this._orientedBoundingBoxNode=new THREE.Box3Helper(i,16777215),this._orientedBoundingBoxNode.frustumCulled=!1,this._orientedBoundingBoxNode.name=this.obj.name+"_OrientedBoundingBox",this._orientedBoundingBoxNode.skipBoundingBox(!0)}var r=this._orientedBoundingBoxNode.material;r.color=Et.parseColor(t,r.color),this.obj.node.add(this._orientedBoundingBoxNode),this._orientedBoundingBoxNode.updateMatrixWorld(),this.obj.tickable=!0}else this.obj.app.resourceManager.remove(this._orientedBoundingBoxNode),this._orientedBoundingBoxNode=null;this._orientedBoundingBoxNode&&(this._orientedBoundingBoxNode.visible=e)},e.prototype.setVertexNormalHelper=function(e){if(e){this.obj.node.updateMatrixWorld();var t=new THREE.Matrix4;t.getInverse(this.obj.node.matrixWorld),this._vertexNormalNode=new THREE.Group,this._vertexNormalNode.name=this.obj.name+"_VertexNormal",this._vertexNormalNode.applyMatrix4(t);var i=this;this.obj.node.traverse((function(e){if(e.isMesh&&e.geometry){var t=new THREE.VertexNormalsHelper(e,1,16711680);i._vertexNormalNode.add(t)}})),this.obj.node.add(this._vertexNormalNode)}else this.obj.app.resourceManager.remove(this._vertexNormalNode),this._vertexNormalNode=null},e.prototype.setAxisHelper=function(e){if(e){this._axisNode=new THREE.AxesHelper(this.obj.boundingBox.radius),this._axisNode.name=this.obj.name+"_Axis";var t=this._axisNode.material;t.depthTest=!1,t.transparent=!0;var i=new THREE.Vector3;this.obj.node.getWorldScale(i),this._axisNode.scale.set(1/i.x,1/i.y,1/i.z),this.obj.node.add(this._axisNode)}else this.obj.app.resourceManager.remove(this._axisNode),this._axisNode=null},e.prototype._setEffectRefCounts=function(e,t,i){var r=this.obj.app.effectManager;t?this._traverse((function(t){t.userData&&t.userData.skipOutline&&e.indexOf("outline")>-1||t.isLineSegments||r.setEffect(t,e)})):this._traverse((function(t){!i&&t._cachedTechnique&&t._cachedTechnique[e]?r.setEffect(t,e,1,"skip"==t._cachedTechnique[e]):r.removeEffect(t,e)}))},e.prototype._clearAllOutlineColor=function(){var e=this.obj.app.effectManager;this._traverse((function(t){if(t.technique)for(var i in t.technique)t.technique[i]&&i.indexOf("outline")>-1&&e.removeEffect(t,i)}))},e.prototype.setGlow=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._glow=e,this._setEffectRefCounts("middleGlow",e,t)},e.prototype.setInnerGlow=function(e,t){this._innerGlow=e,this._setEffectRefCounts("innerGlow",e,t)},e.prototype.setLineBloom=function(e){this._lineBloom=e,this._setEffectRefCounts("lineBloom",e)},e.prototype.setRadialBlur=function(e){this._lineBloom=e,this._setEffectRefCounts("radialBlur",e)},e.prototype.setRadialBlur2=function(e){this._lineBloom=e,this._setEffectRefCounts("radialBlur2",e)},e.prototype.setRadialOffset=function(e){this._lineBloom=e,this._setEffectRefCounts("radialOffset",e)},e.prototype.setFocusRegion=function(e){this._focusRegion=e,this._setEffectRefCounts("focusRegion",e)},e.prototype.setEdgeWireframe=function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments[2];this._edgeColor=Et.parseColor(e),this.removeEdgeWireframe(),null!=e&&this._traverse((function(e){t._setEdgeWireframe(e,i,t._edgeColor,r)}))},e.prototype._setEdgeWireframe=function(e,t,i){var r=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e.updateMatrixWorld();var o=this.obj.app.edgesGeometriesManager.getByObject(e,this.obj);if(null!==o)if(o.isBufferGeometry)this._createEdgeWireframe(o,i,t,n,e);else{var s=o.then((function(o){s._break||r._createEdgeWireframe(o,i,t,n,e)}));s.catch((function(e){1===e.code?THING.Utils.warn(e.msg):0!==e.code&&THING.Utils.warn(e)})),this._edgeWireframes.set(e,s)}},e.prototype._createEdgeWireframe=function(e,t,i,r,n){var o=new THREE.LineSegments(e);return e.isInstancedBufferGeometry&&(o.material=new THREE.MeshBasicMaterial({}),o.material.defines=o.material.defines||{},o.material.defines.INSTANCED="",o.frustumCulled=!1),o.name="wireframeNode"+t+i,o.userData.skipStyle=!0,o.renderOrder=n.renderOrder+.01,o.isEdgeWireframe=!0,o.scope=this.obj,this._edgeWireframes.set(n,o),n.add(o),this.obj.static&&this.obj.node._synMatrixWorld(),o.material._initColor=t,null!==this._color&&void 0!==this._color?o.material.color.copy(this._color):o.material.color.set(t),o.material._initOpacity=r,null!==this._opacity&&void 0!==this._opacity?o.material.opacity=r*this._opacity:o.material.opacity=r,o.material.transparent=o.material.opacity<1,i?this.obj.app.effectManager.setEffect(o,"smallGlow"):this.obj.app.effectManager.removeEffect(o,"smallGlow"),o},e.prototype.removeEdgeWireframe=function(){var e=this;this._edgeWireframes.forEach((function(t){t.isObject3D?(e.obj.app.effectManager.clearAllEffects(t),e.obj.app.resourceManager.remove(t)):t._break=!0})),this._edgeWireframes.clear()},e.prototype.setImage=function(e){var t=this;if(e){if(Et.isString(e)){var i=this.obj.app.confirmURL(e);if(this.image==i)return;this._image=i}else if(e.width&&e.height){if(this.image==e)return;this._image=e}if(!this._image)return}else{if(!this.image)return;this._image=""}this.isNeedRevertMaterials()?this.revertMaterial():this._cloneAndModifyMaterial((function(e,i,r){var n=t._getThemeName(),o=void 0,s=void 0;if(n){var a=tl.findStyle(n,t.obj,r);a&&a.style&&(void 0===a.style.enable||a.style.enable)&&(o=a,s=tl.findStyle(n))}t._applyMaterialImage(e,i,o,s),t._applyMaterialEmissive(e,i,o)}))},e.prototype.flipOutlineColor=function(e){e=Et.parseColor(e).getHex();var t=this.outlineColor;this.outlineColor=t&&t==e?null:e},e.prototype.setLightMap=function(e){var t=(e=e||{}).intensity||0,i=Et.parseColor(e.color,new THREE.Color),r=e.image;r&&(r=this.obj.app.resourceManager.loadTexture(this.obj.app.confirmURL(r),void 0,{anisotropy:16})),this._changeMaterial((function(e,n){e.lightMap=r,e.lightMapIntensity=t,e.color.copy(i),e.needsUpdate=!0}))},e.prototype.setMaterial=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this;if(e){var r=function(){e.completeWaitNumber>0&&--e.completeWaitNumber||(e.complete&&e.complete({object:i.obj}),i.obj&&(i.obj.app.needUpdate=!0))},n=function(t,n,o){o=o||{};var s=Et.isString(o)?o:o.url;if(s){e.completeWaitNumber++;var a=(new THREE.TextureLoader).load(i.obj.app.confirmURL(s),(function(){r()}));if(a.anisotropy=16,u=Et.parseWrapType(o.wrap||o.wrapType))a.wrapT=u,a.wrapS=u;else{var l=t[n];l&&(a.wrapT=l.wrapT,a.wrapS=l.wrapS)}"emissiveMap"===n&&(a.premultiplyAlpha=!0),t[n]=a}else null===s&&(t[n]=null);var u,c=o.texture;c?(t[n]=c,(u=Et.parseWrapType(o.wrap||o.wrapType))&&(c.wrapT=u,c.wrapS=u)):null===c&&(t[n]=null)},o=function(e,t){var o=Et.parseColor(t.color);o&&e.color.copy(o);var s=t.image;if(s){t.completeWaitNumber++;var a=new THREE.TextureLoader;a.setCrossOrigin("anonymous"),(s=a.load(i.obj.app.confirmURL(s),(function(){r()}))).anisotropy=16;var l=Et.parseWrapType(t.wrap||t.wrapType);if(l)s.wrapT=l,s.wrapS=l;else{var u=e.map;u&&(s.wrapT=u.wrapT,s.wrapS=u.wrapS)}e.map=s}else null===s&&(e.map=null);var c=t.map;c?e.map=c:null===c&&(e.map=null),n(e,"map",t.diffuseMap),n(e,"emissiveMap",t.emissiveMap),n(e,"roughnessMap",t.roughnessMap),n(e,"roughnessMap",t.roughnessMap),n(e,"roughnessMap",t.roughnessMap),n(e,"lightMap",t.lightMap),n(e,"bumpMap",t.bumpMap),n(e,"aoMap",t.aoMap),n(e,"alphaMap",t.alphaMap),n(e,"displacementMap",t.displacementMap);var h=t.envMap;h?e.envMap=i.obj.app.resourceManager.loadCubeTexture(h,(function(){i.obj&&(i.obj.app.needUpdate=!0)})):null===h&&(e.envMap=null),e.envMapIntensity=Et.parseValue(t.envMapIntensity,e.envMapIntensity);var p=t.doubleSide;void 0!==p&&(e.side=p?THREE.DoubleSide:THREE.FrontSide),e.blending=Et.parseBlendingType(t.blending,e.blending),e.transparent=Et.parseValue(t.transparent,e.transparent),e.opacity=Et.parseValue(t.opacity,e.opacity);var d=Et.parseColor(t.emissive);e.emissive&&d&&e.emissive.copy(d),e.metalness=Et.parseValue(t.metalness,e.metalness),e.roughness=Et.parseValue(t.roughness,e.roughness),e.depthWrite=Et.parseValue(t.depthWrite,e.depthWrite),e.depthTest=Et.parseValue(t.depthTest,e.depthTest),e.needsUpdate=!0};e.completeWaitNumber=0;var s=e.index;this._cloneAndModifyMaterial((function(t,i,r){s&&Et.isArray(r.material)&&r.material.indexOf(i)!==s||o(i,e)}),t),this._processWithChildFunction("setMaterial",e)}else this.revertMaterial()},e.prototype.setPolygonOffset=function(e){e=e||{};var t=Et.parseValue(e.polygonOffset,!1),i=Et.parseValue(e.polygonOffsetFactor,0),r=Et.parseValue(e.polygonOffsetUnits,0);this._changeMaterial((function(e,n){return e.polygonOffset=t,e.polygonOffsetFactor=i,e.polygonOffsetUnits=r,e}))},e.prototype.setWireframe=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wireframe=e,e?this._cloneAndModifyMaterial((function(e,t,i){Et.backupValue(t,"wireframe"),Et.backupValue(t,"map"),t.wireframe=!0,t.map=null,t.needsUpdate=!0}),t):this.isNeedRevertMaterials()?this.revertMaterial():this._changeMaterial((function(e,t){return Et.revertValue(e,"wireframe"),Et.revertValue(e,"map"),e.needsUpdate=!0,e}))},e.prototype.setRenderOrder=function(t){var i=this;this._renderOrder=t||0,this.beforeSetRenderOrder&&this.beforeSetRenderOrder(t),this.obj._traverseSelfNodes((function(r){r.isGroup||(i._alwaysOnTop?r.renderOrder=e.cRenderOrderValueMask+t:"model-wall"===r._cls?r.renderOrder=t+1e-5:r.isEdgeWireframe?r.renderOrder=t+.01:r.renderOrder=t)})),this.obj.children.forEach((function(e){e.skipStyle||e.inheritStyle&&(e.style.renderOrder=t)}))},e.prototype._setTextureUVAnimation=function(e){var t=this;Et.setValue(e,"updateMatrix",(function(){var i=t._uvAnimationParams,r=i.repeat||[1,1],n=i.center||[0,0],o=i.offset||[0,0],s=Et.parseValue(i.rotation,0);e.matrix.setUvTransform(o[0],o[1],r[0],r[1],s,n[0],n[1])}),!0)},e.prototype.setUVAnimation=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._uvAnimationParams=e,this._uvAnimationParams){t&&this._cloneAndModifyMaterial((function(){}));var i=this._uvAnimationParams;i.wrapType=Et.parseWrapType(i.wrapType),i.offset=i.offset||[0,0],i.baseOffset=i.offset.concat();var r=Et.parseValue(i.rotation,0);i.baseRotation=r,i.rotation=0,i.offsetSpeed=i.speed||i.offsetSpeed,Et.isNumber(i.offsetSpeed)&&(i.offsetSpeed=[i.offsetSpeed,i.offsetSpeed]);var n=i.rotationSpeed||i.rotateSpeed;n&&(i.rotationSpeed=n),(r||n)&&(i.center=[.5,.5]),i.animation=Et.parseValue(i.animation,!0);var o=this,s=this.obj.getControl("texAnimControl");this.obj.node.traverseTextures((function(e,t,r){"envMap"!=t&&"colorMapping"!=t&&(s&&s.$hasAnimation(r)||(r.__cloned||((r=r.clone()).__cloned=!0,e[t]=r,r.needsUpdate=!0),i.wrapType&&(Et.setValue(r,"wrapS",i.wrapType),Et.setValue(r,"wrapT",i.wrapType)),o._setTextureUVAnimation(r)))})),this.obj.tickable=!0}else this.obj.node.traverseTextures((function(e,t,i){Et.revertValue(i,"wrapS"),Et.revertValue(i,"wrapT"),Et.revertValue(i,"updateMatrix")})),this.revertMaterial()},e.prototype.getUVAnimation=function(){return this._uvAnimationParams},e.prototype.hasUVAnimation=function(){return!!this._uvAnimationParams},e.prototype.update=function(e){var t=this._uvAnimationParams;if(t){if(!t.animation)return!1;var i=t.baseOffset,r=t.offsetSpeed;i&&r&&(t.offset[0]+=i[0]+e*r[0],t.offset[1]+=i[1]+e*r[1]);var n=t.baseRotation,o=t.rotationSpeed;return o&&(t.rotation+=n+e*o),!0}return!1},e.prototype._getStyleValue=function(e){var t=this._getSynValue(e);return t||this["_"+e]},e.prototype._getStyleColorValue=function(e){var t=this._getStyleValue(e);return t?Et.parseColor(t).toHexString():null},e.prototype._processAppUpdate=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.obj.visible){var t=this.obj.app;e?t.needUpdate=!0:t.rendererManager&&(t.rendererManager.needUpdate=!0)}},e.prototype._processWithValue=function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e.call(this,i);var n=this.obj.onReplaceObejcts&&this.obj.onReplaceObejcts(t,i);if(n&&n.length>0)for(var o=0,s=n.length;o<s;o++){var a=n[o];if(a.onProcessStyleValue&&!a.onProcessStyleValue(t,i))return;a.style[t]=i}else this.obj.children.forEach((function(e){if(e.inheritStyle){if(e.onProcessStyleValue&&!e.onProcessStyleValue(t,i))return;e.style[t]=i}}));this._processAppUpdate(r)},e.prototype._processWithChildFunction=function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.obj.children.forEach((function(i){if(i.inheritStyle){var r=i.style[e];Et.isFunction(r)&&r.call(i.style,t)}})),this._processAppUpdate(i)},e.prototype.isBaseStyle=function(){return!0},o(e,[{key:"renderOrder",set:function(e){this._setSynValue("renderOrder",e)||this._processWithValue(this.setRenderOrder,"renderOrder",e)},get:function(){return this._getStyleValue("renderOrder")}},{key:"wireframe",set:function(e){this._setSynValue("wireframe",e)||this._processWithValue(this.setWireframe,"wireframe",e,!1)},get:function(){return this._getStyleValue("wireframe")}},{key:"opacity",set:function(e){this._setSynValue("opacity",e)||this._processWithValue(this.setOpacity,"opacity",e)},get:function(){var e=this._getStyleValue("opacity");return Et.isNull(e)?1:e}},{key:"color",set:function(e){this._setSynValue("color",e)||this._processWithValue(this.setColor,"color",e,!1)},get:function(){return this._getStyleColorValue("color")}},{key:"emissive",set:function(e){this._setSynValue("emissive",e)||this._processWithValue(this.setEmissive,"emissive",e,!1)},get:function(){return this._getStyleColorValue("emissive")}},{key:"highlight",set:function(e){this._setSynValue("highlight",e)||this._processWithValue(this.setHighlight,"highlight",e,!1)},get:function(){return this._getStyleColorValue("highlight")}},{key:"highlightIntensity",set:function(e){this._setSynValue("highlightIntensity",e)||this._processWithValue(this.setHighlightIntensity,"highlightIntensity",e)},get:function(){var e=this._getStyleValue("highlightIntensity");return Et.isNull(e)?.5:e}},{key:"emissiveScrollImage",set:function(e){this._setSynValue("emissiveScrollImage",e)||this._processWithValue(this.setEmissiveScrollImage,"emissiveScrollImage",e,!1)},get:function(){return this._getStyleValue("emissiveScrollImage")}},{key:"environmentImage",set:function(e){this._setSynValue("environmentImage",e)||this._processWithValue(this.setEnvironmentImage,"environmentImage",e,!1)},get:function(){return this._getStyleValue("environmentImage")}},{key:"roughness",set:function(e){this.setMaterial({roughness:e})}},{key:"metalness",set:function(e){this.setMaterial({metalness:e})}},{key:"outlineColor",set:function(e){this._setSynValue("outlineColor",e)||this._processWithValue(this.setOutlineColor,"outlineColor",e,!1)},get:function(){return this._getStyleColorValue("outlineColor")}},{key:"defaultOutlineColor",set:function(e){this._processWithValue(this.setDefaultOutlineColor,"defaultOutlineColor",e,!1)},get:function(){return this._getStyleColorValue("defaultOutlineColor")}},{key:"skipBoundingBox",set:function(e){this.setSkipBoundingBox(e)}},{key:"skipOutline",set:function(e){this._setNodesAttribute("skipOutline",e,!0),e&&(this._outlineColor=null,this._defaultOutlineColor=null,this._clearAllOutlineColor())}},{key:"skipStyle",set:function(e){this.obj.node.traverse((function(t){t.isRenderable()&&(t.userData.skipStyle=e)}))}},{key:"skipEnvMap",set:function(e){this._setNodesAttribute("skipEnvMap",e)}},{key:"glow",set:function(e){this._processWithValue(this.setGlow,"glow",e,!1)},get:function(){return this._getStyleValue("glow")}},{key:"innerGlow",set:function(e){this._processWithValue(this.setInnerGlow,"innerGlow",e,!1)},get:function(){return this._getStyleValue("innerGlow")}},{key:"lineBloom",set:function(e){this._processWithValue(this.setLineBloom,"lineBloom",e,!1)},get:function(){return this._getStyleValue("lineBloom")}},{key:"radialBlur",set:function(e){this._processWithValue(this.setRadialBlur,"radialBlur",e,!1)},get:function(){return this._getStyleValue("radialBlur")}},{key:"radialBlur2",set:function(e){this._processWithValue(this.setRadialBlur2,"radialBlur2",e,!1)},get:function(){return this._getStyleValue("radialBlur2")}},{key:"radialOffset",set:function(e){this._processWithValue(this.setRadialOffset,"radialOffset",e,!1)},get:function(){return this._getStyleValue("radialOffset")}},{key:"focusRegion",set:function(e){this._processWithValue(this.setFocusRegion,"focusRegion",e,!1)},get:function(){return this._getStyleValue("focusRegion")}},{key:"vertexNormalHelper",set:function(e){this._processWithValue(this.setVertexNormalHelper,"vertexNormalHelper",e)},get:function(){return this._getStyleValue("vertexNormalHelper")}},{key:"axisHelper",set:function(e){this._processWithValue(this.setAxisHelper,"axisHelper",e)},get:function(){return!!this._axisNode&&this._axisNode.visible}},{key:"edgeColor",set:function(e){this._processWithValue(this.setEdgeWireframe,"edgeColor",e,!1)},get:function(){return this._getStyleColorValue("edgeColor")}},{key:"boundingBox",set:function(e){this.setBoundingBox(e,16777215)},get:function(){return!!this._boundingBoxNode&&this._boundingBoxNode.visible}},{key:"boundingBoxColor",set:function(e){this.setBoundingBox(!0,e)},get:function(){return this._boundingBoxNode?this._boundingBoxNode.material.color.toHexString():0}},{key:"orientedBoundingBox",set:function(e){this.setOrientedBoundingBox(e)},get:function(){return!!this._orientedBoundingBoxNode&&this._orientedBoundingBoxNode.visible}},{key:"orientedBoundingBoxColor",set:function(e){this.setOrientedBoundingBox(!0,e)},get:function(){return this._orientedBoundingBoxNode?this._orientedBoundingBoxNode.material.color.toHexString():0}},{key:"alwaysOnTop",set:function(e){this.setAlwaysOnTop(e)},get:function(){return!!this._getStyleValue("alwaysOnTop")}},{key:"image",set:function(e){this.setImage(e)},get:function(){return this._getStyleValue("image")}},{key:"doubleSide",set:function(e){this._doubleSide=e,this.setMaterial({doubleSide:e})},get:function(){return this._getStyleValue("doubleSide")}}]),e}();rl.cRenderOrderValueMask=1e6;var nl=new THREE.Matrix3,ol=!1;function sl(){nl.elements[7]-=.003}var al=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t}(rl),ll=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._textColor=Et.parseColor("#1e90ff"),r._textSize=26,r._textLineWidth=65536,r._textLineHeight=20,r._textType="Arial",r._textAlign="center",r._dropShadow=!0,r._dropShadowAlpha=1,r._dropShadowAngle=45,r._dropShadowBlur=1,r._dropShadowColor=Et.parseColor("#000000"),r._dropShadowDistance=2,r._strokeMode=!1,r._skipApplyTheme=!0,r}return s(t,e),o(t,[{key:"scale",get:function(){return this._scale}},{key:"fontColor",set:function(e){var t=Et.parseColor(e);t.equals(this._textColor)||(this._textColor=t,this.obj.refreshTextMesh())},get:function(){return this._textColor.toHexString()}},{key:"fontSize",set:function(e){e&&this._textSize!=e&&(this._scale=e/26,this._textSize=e,this.obj.refreshTextMesh())},get:function(){return this._textSize}},{key:"fontType",set:function(e){this._textType!=e&&(this._textType=e,this.obj.refreshTextMesh())},get:function(){return this._textType}},{key:"fontAlign",set:function(e){this._textAlign!=e&&(this._textAlign=e,this.obj.refreshTextMesh())},get:function(){return this._textAlign}},{key:"dropShadow",set:function(e){this._dropShadow!=e&&(this._dropShadow=e,this.obj.refreshTextMesh())},get:function(){return this._dropShadow}},{key:"dropShadowAlpha",set:function(e){this._dropShadowAlpha!=e&&(this._dropShadowAlpha=e,this.obj.refreshTextMesh())},get:function(){return this._dropShadowAlpha}},{key:"dropShadowAngle",set:function(e){this._dropShadowAngle!=e&&(this._dropShadowAngle=e,this.obj.refreshTextMesh())},get:function(){return this._dropShadowAngle}},{key:"dropShadowBlur",set:function(e){this._dropShadowBlur!=e&&(this._dropShadowBlur=e,this.obj.refreshTextMesh())},get:function(){return this._dropShadowBlur}},{key:"dropShadowColor",set:function(e){var t=Et.parseColor(e);t.equals(this._dropShadowBlur)||(this._dropShadowColor=t,this.obj.refreshTextMesh())},get:function(){return this._dropShadowColor.toHexString()}},{key:"dropShadowDistance",set:function(e){this._dropShadowDistance!=e&&(this._dropShadowDistance=e,this.obj.refreshTextMesh())},get:function(){return this._dropShadowDistance}},{key:"textLineWidth",set:function(e){this._textLineWidth!=e&&(this._textLineWidth=e,this.obj.refreshTextMesh())},get:function(){return this._textLineWidth}},{key:"textLineHeight",set:function(e){this._textLineHeight!=e&&(this._textLineHeight=e,this.obj.refreshTextMesh())},get:function(){return this._textLineHeight}},{key:"strokeMode",set:function(e){this._strokeMode!=e&&(this._strokeMode=e,this.obj.refreshTextMesh())},get:function(){return this._strokeMode}}]),t}(al),ul=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._canvasText=new ge,r._text="",r._factor=16/26*.1,r._keepSize=!1,r._useSpriteMaterial=!1,r._sizeAttenuation=!0,r._width=0,r._height=0,r._mesh=null,r._disableRefresh=!1,r}return s(t,e),t.prototype.isTextRegion=function(){return!0},t.prototype.createTextMesh=function(){var e=this._getCanvas(),t=new THREE.Texture(e);t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.generateMipmaps=!0,t.needsUpdate=!0;var i,r=this._getPlanSize(e);if(this._useSpriteMaterial){var n=new THREE.SpriteMaterial({map:t,transparent:!0,side:THREE.DoubleSide,depthWrite:!1});(i=new THREE.Sprite(n)).scale.set(r,r,1)}else{var o=new THREE.PlaneGeometry(r,r);n=new THREE.MeshBasicMaterial({map:t,transparent:!0,side:THREE.DoubleSide,depthWrite:!1});i=new THREE.Mesh(o,n)}return i.userData.skipBoundingBox=!0,i.userData.skipOutline=!0,i.userData.skipEnvMap=!0,i.userData.noBlending=!0,i.technique=i.technique||{},i.technique.glow="skip",i},t.prototype._getPlanSize=function(e){return Math.max(e.width,e.height)*this._factor},t.prototype._getCanvas=function(){var e=this.style;return this._canvasText.createCanvas(this._text,{fontType:e.fontType,alignMode:e.fontAlign,fontSize:e.fontSize,fontColor:e.fontColor,textLineWidth:e.textLineWidth,textLineHeight:e.textLineHeight,strokeMode:e.strokeMode,dropShadow:e.dropShadow,dropShadowColor:e.dropShadowColor,dropShadowAngle:e.dropShadowAngle,dropShadowDistance:e.dropShadowDistance,scale:e.scale,dropShadowBlur:e.dropShadowBlur,dropShadowAlpha:e.dropShadowAlpha})},t.prototype.refreshTextMesh=function(){if(!this._disableRefresh){var e=0;this._mesh&&(e=this._mesh.renderOrder),this.app.resourceManager.remove(this._mesh),this._mesh=this.createTextMesh(),this._mesh.renderOrder=e,this.node.add(this._mesh),this.static&&this.node._synMatrixWorld();var t=this.getControl("TextRegionSizeAdjustmentControl");t&&(t.node=this._mesh),this.synSize()}},t.prototype._beforeSetupStyle=function(e){(e.style||{}).opacity||(this._disableRefresh=!0)},t.prototype._afterSetupStyle=function(e){this._disableRefresh&&(this._disableRefresh=!1,this.refreshTextMesh())},t.prototype.setupStyle=function(t){this._sizeAttenuation=Et.parseValue(t.sizeAttenuation,!0),this.loaded=!1,this._disableRefresh=!0,t.style=t.style||{};var i=t.style;i.fontColor=Et.parseColor(t.textColor||t.fontColor||i.fontColor),i.fontSize=t.textSize||t.fontSize||i.fontSize,i.fontType=t.textType||t.fontType||i.fontType,i.textLineWidth=t.textLineWidth||t.fontLineWidth||i.textLineWidth,i.textLineHeight=t.textLineHeight||t.fontLineHeight||i.textLineHeight,i.strokeMode=t.storkeMode||i.strokeMode,this._text=t.text||t.fontText||this._text,this._factor=t.factor||this._factor,this._useSpriteMaterial=Et.parseValue(t.useSpriteMaterial,!1),this._width=Et.parseValue(t.width,this._width),this._height=Et.parseValue(t.height,this._height),this.node.skipBoundingBox(!0),e.prototype.setupStyle.call(this,t),this.loaded=!0},t.prototype.synSize=function(){var e=this._mesh;e&&this._width&&this._height&&(e.scale.set(this._width,this._height,1),this.synIndependentWorldScale())},o(t,[{key:"sizeAttenuation",get:function(){return this._sizeAttenuation}},{key:"text",set:function(e){this._text=e,this.refreshTextMesh()},get:function(){return this._text}},{key:"keepSize",set:function(e){if(this._keepSize!=e)if(this._keepSize=e,e){var t=Et.parseVector3(this.app.camera.position),i=60/this._mesh.getDistanceFromCamera(t);this._useSpriteMaterial&&(i*=this._mesh.scale.x);var r=this._sizeAttenuation?60:960,n=this._sizeAttenuation?[i,i]:[this._width,this._height];this.addControl(new ci(n,this._mesh,r),"TextRegionSizeAdjustmentControl"),this.synSize()}else this.removeControl("TextRegionSizeAdjustmentControl")},get:function(){return this._keepSize}},{key:"width",set:function(e){this._width=e,this.synSize()},get:function(){return this._width}},{key:"height",set:function(e){this._height=e,this.synSize()},get:function(){return this._height}},{key:"style",get:function(){return e.prototype._getStyle.call(this)},set:function(t){e.prototype._setStyle.call(this,t)}},{key:"textColor",set:function(e){THING.Utils.warn('[TextRegion]Please use ".style.fontColor" to replace ".fontColor"'),this.style.fontColor=e},get:function(){return THING.Utils.warn('[TextRegion]Please use ".style.fontColor" to replace ".fontColor"'),this.style.fontColor}},{key:"dropShadow",set:function(e){THING.Utils.warn('[TextRegion]Please use ".style.dropShadow" to replace ".dropShadow"'),this.style.dropShadow=e},get:function(){return THING.Utils.warn('[TextRegion]Please use ".style.dropShadow" to replace ".dropShadow"'),this.style.dropShadow}},{key:"dropShadowAlpha",set:function(e){THING.Utils.warn('[TextRegion]Please use ".style.dropShadowAlpha" to replace ".dropShadowAlpha"'),this.style.dropShadowAlpha=e},get:function(){return THING.Utils.warn('[TextRegion]Please use ".style.dropShadowAlpha" to replace ".dropShadowAlpha"'),this.style.dropShadowAlpha}},{key:"dropShadowAngle",set:function(e){THING.Utils.warn('[TextRegion]Please use ".style.dropShadowAngle" to replace ".dropShadowAngle"'),this.style.dropShadowAngle=e},get:function(){return THING.Utils.warn('[TextRegion]Please use ".style.dropShadowAngle" to replace ".dropShadowAngle"'),this.style.dropShadowAngle}},{key:"dropShadowBlur",set:function(e){THING.Utils.warn('[TextRegion]Please use ".style.dropShadowBlur" to replace ".dropShadowBlur"'),this.style.dropShadowBlur=e},get:function(){return THING.Utils.warn('[TextRegion]Please use ".style.dropShadowBlur" to replace ".dropShadowBlur"'),this.style.dropShadowBlur}},{key:"dropShadowColor",set:function(e){THING.Utils.warn('[TextRegion]Please use ".style.dropShadowColor" to replace ".dropShadowColor"'),this.style.dropShadowColor=e},get:function(){return THING.Utils.warn('[TextRegion]Please use ".style.dropShadowColor" to replace ".dropShadowColor"'),this.style.dropShadowColor}},{key:"dropShadowDistance",set:function(e){THING.Utils.warn('[TextRegion]Please use ".style.dropShadowDistance" to replace ".dropShadowDistance"'),this.style.dropShadowDistance=e},get:function(){return THING.Utils.warn('[TextRegion]Please use ".style.dropShadowDistance" to replace ".dropShadowDistance"'),this.style.dropShadowDistance}},{key:"textSize",set:function(e){THING.Utils.warn('[TextRegion]Please use ".style.fontSize" to replace ".fontSize"'),this.style.fontSize=e},get:function(){return THING.Utils.warn('[TextRegion]Please use ".style.fontSize" to replace ".fontSize"'),this.style.fontSize}},{key:"textLineWidth",set:function(e){THING.Utils.warn('[TextRegion]Please use ".style.textLineWidth" to replace ".textLineWidth"'),this.style.textLineWidth=e},get:function(){return THING.Utils.warn('[TextRegion]Please use ".style.textLineWidth" to replace ".textLineWidth"'),this.style.textLineWidth}},{key:"textLineHeight",set:function(e){THING.Utils.warn('[TextRegion]Please use ".style.textLineHeight" to replace ".textLineHeight"'),this.style.textLineHeight=e},get:function(){return THING.Utils.warn('[TextRegion]Please use ".style.textLineHeight" to replace ".textLineHeight"'),this.style.textLineHeight}},{key:"strokeMode",set:function(e){THING.Utils.warn('[TextRegion]Please use ".style.strokeMode" to replace ".strokeMode"'),this.style.strokeMode=e},get:function(){return THING.Utils.warn('[TextRegion]Please use ".style.strokeMode" to replace ".strokeMode"'),this.style.strokeMode}}]),t}(Si),cl=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._points=[],r}return s(t,e),t.prototype._updateByPoints=function(){},t.prototype._createPolygonVertices=function(e){for(var t=[],i=0;i<this._points.length;i++){var r=this._points[i];t.push(new THREE.Vector3(r[0],r[2],r[1]))}THREE.ShapeUtils.isClockWise(t)||(t=t.reverse());var n=[],o=THREE.ShapeUtils.triangulateShape(t,[]);for(i=0;i<o.length;i++)n.push(new THREE.Face3(o[i][0],o[i][1],o[i][2]));for(i=0;i<t.length;i++){var s=t[i];if(!e){var a=s.z;s.z=s.y,s.y=a}}return{vertices:t,faces:n}},t.prototype._createPolygonGeometry=function(e,t){var i=new THREE.Geometry;return i.vertices=e,i.faces=t,i.genFaceVertexUVs(),i},t.prototype.clearPoints=function(){this._points=[],this._updateByPoints()},t.prototype.insertPoint=function(e,t){this._points.splice(e,0,this.worldToSelf(t)),this._updateByPoints()},t.prototype.setPoint=function(e,t){return!(e>=this._points.length)&&(!!t&&(this._points[e]=this.worldToSelf(t),this._updateByPoints(),!0))},t.prototype.getPoint=function(e){if(e>=this._points.length)return null;var t=this._points[e];return this.selfToWorld(t)},t.prototype.addPoint=function(e){return this._points.push(this.worldToSelf(e)),this._updateByPoints(),this._points.length-1},t.prototype._getPoints=function(e,t){this.node.updateWorldMatrix(!0,!1);for(var i=[],r=0;r<e.length;r++){var n=e[r];t==P.Local?n=this.localToSelf(n):t==P.World&&(n=this.worldToSelf(n,!this.inheritScale)),i.push(n)}return i},t.prototype.getPointsCenterPos=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"world",i=this._getPoints(e,t);if(i.length<2)return[0,0,0];for(var r=0,n=[!0,!0,!0],o=i[0].concat(),s=1;s<i.length;s++)for(var a=i[s],l=0;l<3;l++)if(!THING.Math.isFloatEquals(o[l],a[l])){n[l]=!1;break}var u=0,c=1,h=2;n[0]?(u=1,c=0,h=2):n[1]?(u=0,c=1,h=2):n[2]&&(u=0,c=2,h=1);var p=[];for(s=0;s<i.length;s++){r+=(a=i[s])[c],p.push([a[u],a[h]])}var d=new polylabel([p]);return n[0]?[r/i.length,d[0],d[1]]:n[1]?[d[0],r/i.length,d[1]]:n[2]?[d[0],d[1],r/i.length]:[0,0,0]},t.prototype.getCenterPointPos=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"world",i=this._getPoints(e,t);if(i.length<2)return[0,0,0];var r=Math.floor(i.length/2)-1;if(i.length%2)return i[r+1];var n=i[r].map((function(e,t){return(e+i[r+1][t])/2}));return n},t.prototype.addPoints=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.World,i=this._getPoints(e,t);this._points=this._points.concat(i),this._updateByPoints()},t.prototype.removePoints=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._points.splice(e,t),this._updateByPoints()},t.prototype.inside=function(e){for(var t=this.planePoints,i=e[0],r=e[1],n=!1,o=0,s=t.length,a=s-1;o<s;a=o,o++){var l=t[o][0],u=t[o][1],c=t[a][0],h=t[a][1];if((l===i&&u===r||c===i&&h===r)&&(n=!n),u<r&&h>=r||u>=r&&h<r){var p=l+(r-u)*(c-l)/(h-u);p===i&&(n=!n),p>i&&(n=!n)}}return!!n},t.prototype.clearPathPoints=function(){THING.Utils.warn("[PointsBase] Please use '.clearPoints()' to replace 'clearPathPoints()'"),this.clearPoints()},t.prototype.removePoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;THING.Utils.warn("[LineBase] Please use '.removePoints' to replace '.removePoint'"),this.removePoints(e,t)},o(t,[{key:"points",get:function(){for(var e=[],t=0;t<this._points.length;t++){var i=this.selfToWorld(this._points[t]);e.push(i)}return e}},{key:"planePoints",get:function(){for(var e=[],t=0;t<this._points.length;t++){var i=this.selfToWorld(this._points[t]);e.push([i[0],i[2]])}return e}},{key:"area",get:function(){for(var e=[],t=0;t<this._points.length;t++){var i=this.selfToWorld(this._points[t]);e.push(new THREE.Vector2(i[0],i[2]))}var r=THREE.ShapeUtils.area(e);return Math.abs(r)}},{key:"centerPos",get:function(){return new polylabel([this.planePoints])}},{key:"avgHeight",get:function(){if(!this._points.length)return 0;for(var e=0,t=0;t<this._points.length;t++){e+=this._points[t][1]}return e/this._points.length}}]),t}(Si),hl=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._lineMesh=null,r._areaMesh=null,r._textRegion=null,r}return s(t,e),t.prototype._updateTextPosition=function(){if(this._textRegion){var e=this.centerPos;this._textRegion.position=[e[0],this.position.y,e[1]],this._textRegion.translateY(.01)}},t.prototype._updateByPoints=function(){if(!(this._points.length<3)){var e=new THREE.MeshBasicMaterial({color:this.style.regionColor,opacity:this.style.regionOpacity,transparent:!0,side:THREE.DoubleSide,depthWrite:!1}),t=this._createPolygonVertices(),i=this._createPolygonGeometry(t.vertices,t.faces);this.app.resourceManager.remove(this._areaMesh),this._areaMesh=new THREE.Mesh(i,e),this.node.add(this._areaMesh);var r=new THREE.LineBasicMaterial({color:this.style.lineColor,opacity:this.style.lineOpacity,transparent:!0});this.app.resourceManager.remove(this._lineMesh),(i=new THREE.Geometry).vertices=t.vertices,i.vertices.push(t.vertices[0]),this._lineMesh=new THREE.Line(i,r),this._lineMesh.userData.skipPick=!0,this.node.add(this._lineMesh)}},t.prototype._beforeSetupComplete=function(e){var t=e.points||e.vertices;if(t){if(!e.position&&!e.localPosition){var i=this.getPointsCenterPos(t);this.position=this.selfToWorld(i)}this.addPoints(t)}var r=e.fontText||e.text;r&&(this.text=r),Et.parseValue(e.alwaysOnTop,!0)&&(this.style.alwaysOnTop=!0);var n=this.style;n.lineOpacity=Et.parseValue(e.lineOpacity,n.lineOpacity),n.lineColor=Et.parseColor(e.lineColor,n.lineColor),n.regionOpacity=Et.parseValue(e.regionOpacity||e.opacity,n.regionOpacity),n.regionColor=Et.parseColor(e.regionColor,n.regionColor)},o(t,[{key:"textRegion",get:function(){if(!this._textRegion){var e={type:"TextRegion",parent:this};this._textRegion=this.app.create(e),this._textRegion._mesh.renderOrder=1,this._textRegion.angleX=-90,this._textRegion.translateY(.1)}return this._textRegion}},{key:"text",set:function(e){this.textRegion.text=e,this._updateTextPosition()},get:function(){return this.textRegion.text}},{key:"style",get:function(){return e.prototype._getStyle.call(this)},set:function(t){e.prototype._setStyle.call(this,t)}},{key:"lineColor",set:function(e){THING.Utils.warn('[PolygonRegion]Please use ".style.lineColor" to replace ".lineColor"'),this.style.lineColor=e},get:function(){return THING.Utils.warn('[PolygonRegion]Please use ".style.lineColor" to replace ".lineColor"'),this.style.lineColor}},{key:"regionColor",set:function(e){THING.Utils.warn('[PolygonRegion]Please use ".style.regionColor" to replace ".regionColor"'),this.style.regionColor=e},get:function(){return THING.Utils.warn('[PolygonRegion]Please use ".style.regionColor" to replace ".regionColor"'),this.style.regionColor}},{key:"regionOpacity",set:function(e){THING.Utils.warn('[PolygonRegion]Please use ".style.regionOpacity" to replace ".regionOpacity"'),this.style.regionOpacity=e},get:function(){return this.style.regionOpacity}}]),t}(cl),pl=null;function dl(){return pl||(pl=new THREE.Texture(SimpleHeatmap.getInstance().canvas())),pl}var fl=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.node=new THREE.Object3D,r._map=null,r._tex=null,r._params={},r}return s(t,e),t.prototype._getMap=function(){return SimpleHeatmap.getInstance()},t.prototype._beforeSetup=function(e){this._map=this._getMap();var t=this._tex=new THREE.Texture(this._map.canvas()),i=void 0!==e.opacity?e.opacity:1,r=e.width||10,n=e.height||10,o=void 0;if(e.clipShape){var s=e.clipShape.shape.map((function(e){return(new THREE.Vector2).fromArray(e)})),a=new THREE.Shape(s);a.autoClose=!0,e.clipShape.holes&&(a.holes=e.clipShape.holes.map((function(e){return new THREE.Shape(e.map((function(e){return(new THREE.Vector2).fromArray(e)})))})));for(var l=(o=new THREE.ShapeBufferGeometry(a)).getAttribute("uv"),u=0,c=l.array.length;u<c;u+=2){var h=l.array[u+0],p=l.array[u+1];l.array[u+0]=(h+r/2)/r,l.array[u+1]=(p+n/2)/n}}else if(e.meshShape){var d=e.meshShape,f=d.node.getMeshes();if(f.length>=1){if(f.length>1){o=new THREE.BufferGeometry;var m=f.map((function(e){return ml(e,d.node.parent)}));(o=THREE.BufferGeometryUtils.mergeBufferGeometries(m)).computeBoundingBox()}else o=ml(f[0],d.node.parent);var g=o.boundingBox.getSize(new THREE.Vector3),v=o.boundingBox.min,y=o.getAttribute("position"),b=o.getAttribute("uv");b||(b=new THREE.BufferAttribute(new Float32Array(2*y.count),2),o.setAttribute("uv",b));for(var _=0,x=b.array.length/2;_<x;_++){var E=y.array[3*_+0],w=y.array[3*_+2];b.array[2*_+0]=(E-v.x)/g.x,b.array[2*_+1]=(w-v.z)/g.z}e.width=g.x,e.height=g.z}else console.warn("Heatmap: can not find mesh of object shape.")}else o=new THREE.PlaneGeometry(r,n);var T=void 0;e.mosaic?((T=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(gl.uniforms),vertexShader:gl.vertexShader,fragmentShader:gl.fragmentShader,transparent:!0,side:THREE.DoubleSide})).uniforms.opacity.value=i,T.uniforms.tDiffuse.value=t):T=new THREE.MeshBasicMaterial({map:t,side:THREE.DoubleSide,transparent:!0,opacity:i}),this._material=T;var M=new THREE.Mesh(o,T);M.userData.skipEnvMap=!0,this.node.add(M),this._initParameter(e),this._refresh()},t.prototype._initParameter=function(e){var t=this._params;t.areaWidth=e.width||10,t.areaHeight=e.height||10,t.mapSize=e.mapSize||256,t.alpha=!!e.alpha,t.gradient=e.gradient||{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},t.minValue=void 0!==e.minValue?e.minValue:10,t.maxValue=void 0!==e.maxValue?e.maxValue:50,t.radius=e.radius||.8,t.blur=e.blur||.8,t.data=e.data||[],t.mosaicSize=e.mosaicSize||t.mapSize/64},t.prototype.setParameter=function(e){var t=this._params;t.mapSize=e.mapSize||t.mapSize,t.alpha=void 0!==e.alpha?e.alpha:t.alpha,t.gradient=e.gradient||t.gradient,t.minValue=e.minValue||t.minValue,t.maxValue=e.maxValue||t.maxValue,t.radius=e.radius||t.radius,t.blur=e.blur||t.blur,t.data=e.data||t.data,t.mosaicSize=e.mosaicSize||t.mosaicSize,this._refresh()},t.prototype.addData=function(e){this._params.data.push(e),this._refresh()},t.prototype.setData=function(e){this._params.data=e,this._refresh()},t.prototype.setAlpha=function(e){this._params.alpha=e,this._refresh()},t.prototype.setRadius=function(e,t){this._params.radius=e,void 0!==t&&(this._params.blur=t),this._refresh()},t.prototype.setGradient=function(e){this._params.gradient=e,this._refresh()},t.prototype.randomData=function(){for(var e=this._params,t=[],i=0;i<Math.round(e.areaWidth*e.areaHeight);i++)t.push([(Math.random()-.5)*e.areaWidth,(Math.random()-.5)*e.areaHeight,Math.pow(Math.random(),3)*(e.maxValue-e.minValue)+e.minValue]);this.setData(t)},t.prototype._refresh=function(){var e=this._params,t=1,i=1,r=e.mapSize/e.areaWidth;e.areaWidth!=e.areaHeight&&(e.areaWidth>e.areaHeight?(t=1,i=e.areaHeight/e.areaWidth):(t=e.areaWidth/e.areaHeight,i=1,r=e.mapSize/e.areaHeight));var n=e.data.map((function(e){return[1*e[0],1*e[1],e[2]]})),o=Math.floor(e.mapSize*t),s=Math.floor(e.mapSize*i);this._map.setCanvasSize(o,s).setAreaSize(1*e.areaWidth,1*e.areaHeight).min(e.minValue).max(e.maxValue).alpha(e.alpha).gradient(e.gradient).radius(Math.floor(e.radius*r*1),Math.floor(e.blur*r*1)).data(n).draw(),this._tex.needsUpdate=!0,dl().needsUpdate=!0,this.app.renderer.copyTextureToTexture(new THREE.Vector2,dl(),this._tex),this._material.isShaderMaterial&&(this._material.uniforms.texSize.value.set(o,s),this._material.uniforms.mosaicSize.value.set(e.mosaicSize,e.mosaicSize))},o(t,[{key:"isHeatmap",get:function(){return THING.Utils.warn("[Heatmap] Please use 'instanceof THING.Heatmap' to replace '.isHeatmap'"),this instanceof THING.Heatmap}}]),t}(Si);function ml(e,t){var i=e.geometry.isBufferGeometry?e.geometry.clone():(new THREE.BufferGeometry).fromGeometry(e.geometry);return i.applyMatrix4(e.getMatrixFromRoot(t)),i.computeBoundingBox(),i}var gl={uniforms:{opacity:{value:1},tDiffuse:{value:null},texSize:{value:new THREE.Vector2(640,640)},mosaicSize:{value:new THREE.Vector2(16,16)}},vertexShader:"\n\t\t#include <common>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\tvarying vec2 vUV;\n        void main() {\n\t\t\tvUV = uv;\n\t\t\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\t\t\tgl_Position = projectionMatrix * mvPosition;\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <fog_vertex>\n        }\n    ",fragmentShader:"\n\t\tuniform\tfloat opacity;\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\n        uniform sampler2D tDiffuse;\n\n        uniform vec2 texSize;\n        uniform vec2 mosaicSize;\n\n        varying vec2 vUV;\n\n        void main(void) {\n\t\t\tvec4 originColor = texture2D(tDiffuse, vUV);\n\n\t\t\tif (originColor.a < 0.0001) discard;\n\n\t\t\t#include <logdepthbuf_fragment>\n\n            vec2 xy = vec2(vUV.x * texSize.x, vUV.y * texSize.y);\n            \n            vec2 xyMosaic = vec2(floor(xy.x / mosaicSize.x) * mosaicSize.x, \n                    floor(xy.y / mosaicSize.y) * mosaicSize.y )\n                    + .5*mosaicSize;\n            \n            vec2 delXY = xyMosaic - xy;\n            float delL = length(delXY);\n            \n            vec2 uvMosaic = vec2(xyMosaic.x / texSize.x, xyMosaic.y / texSize.y);\n\n            float percent = smoothstep(0., 1., 1. - delL * 2.4 / mosaicSize.x) * 0.7 + 0.3;\n\n            vec4 centerColor = texture2D(tDiffuse, uvMosaic);\n            \n            vec4 resultColor = vec4(mix(originColor.rgb, centerColor.rgb, percent), centerColor.a * percent * opacity);\n            \n\t\t\tgl_FragColor = resultColor;\n\t\t\t\n\t\t\t#include <fog_fragment>\n        }\n    "};fl.PointMosaicShader=gl;var vl=null;function yl(){return vl||(vl=new THREE.Texture(SimpleIDW.getInstance().canvas())),vl}var bl=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype._getMap=function(){return SimpleIDW.getInstance()},t.prototype._initParameter=function(e){var t=this._params;t.areaWidth=e.width||10,t.areaHeight=e.height||10,t.mapSize=e.mapSize||256,t.alpha=!!e.alpha,t.gradient=e.gradient||{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},t.minValue=e.minValue||0,t.maxValue=e.maxValue||50,t.radius=e.radius||10,t.blur=e.blur||.8,t.data=e.data||[],t.exp=e.exp||3,t.cellSize=e.cellSize||10,t.opacity=e.opacity||1,t.mosaicSize=e.mosaicSize||t.mapSize/64},t.prototype._refresh=function(){var e=this._params,t=1,i=1,r=e.mapSize/e.areaWidth;e.areaWidth!=e.areaHeight&&(e.areaWidth>e.areaHeight?(t=1,i=e.areaHeight/e.areaWidth):(t=e.areaWidth/e.areaHeight,i=1,r=e.mapSize/e.areaHeight));var n=1;e.radius*r<1&&(n=1/e.radius*r+1e-4);var o=e.data.map((function(e){return[e[0]*n,e[1]*n,e[2]]})),s=Math.floor(e.mapSize*t),a=Math.floor(e.mapSize*i);this._map.setCanvasSize(s,a).setAreaSize(e.areaWidth*n,e.areaHeight*n).min(e.minValue).max(e.maxValue).alpha(e.alpha).gradient(e.gradient).opacity(e.opacity).cellSize(e.cellSize).exp(e.exp).radius(e.radius).data(o)._redraw(),this._tex.needsUpdate=!0,yl().needsUpdate=!0,this.app.renderer.copyTextureToTexture(new THREE.Vector2,yl(),this._tex),this._material.isShaderMaterial&&(this._material.uniforms.texSize.value.set(s,a),this._material.uniforms.mosaicSize.value.set(e.mosaicSize,e.mosaicSize))},t}(fl),_l=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.pathTexture=null,r.pathWidth=1,r.pathCornerRadius=.3,r.pathCornerSplit=10,r.pathScrollUV=!1,r.pathScrollSpeed=1,r.pathPlayingTween=null,r.pathUp=new THREE.Vector3(0,1,0),r.pathPointList=null,r.pathGeometry=null,r.pathLine=null,r.pathMaterial=new THREE.MeshBasicMaterial({transparent:!0}),r._uvRepeat=[1,1],r._uvOffset=[0,0],r._uvRotation=0,r}return s(t,e),t.prototype.synPathTexture=function(e){this.pathTexture=e,this.pathLine&&(this.pathLine.material.map=this.pathTexture,this.pathLine.material.needsUpdate=!0)},t.prototype._synUvTransform=function(){this.pathMaterial.uvTransform||(this.pathMaterial.uvTransform=new THREE.Matrix3),this.pathMaterial.uvTransform.setUvTransform(this._uvOffset[0],this._uvOffset[1],this._uvRepeat[0],this._uvRepeat[1],this._uvRotation,0,0)},t.prototype._setupPoints=function(e){var t=e.points;if(t){var i=e.spaceType,r=e.local;if(!i&&r&&(i=P.Local),t.forEach((function(e,i){e.isVector3&&(t[i]=e.toArray())})),!e.position&&!e.localPosition){var n=this.getCenterPointPos(t,i);this.position=this.selfToWorld(n)}this.addPoints(t,i)}},t.prototype._setupPathLine=function(e){var t=this;this.scrollUV=Et.parseValue(e.scrollUV,!1),this.uvRatio=e.uvRatio||1,this.width=Et.parseValue(e.width,this.width),this.side=Et.parseValue(e.side,"both"),this.close=Et.parseValue(e.close,!1);var i=Et.parseValue(e.doubleSide,!0);this.pathMaterial.side=i?THREE.DoubleSide:THREE.FrontSide,this.pathLine=new THREE.Mesh(this.pathGeometry,this.pathMaterial),this.pathLine.addBeforeRenderFunction("pathUpdate",(function(e,i,r,n,o,s){o.uvTransform||(o.uvTransform=new THREE.Matrix3),o.uvTransform.setUvTransform(t._uvOffset[0],t._uvOffset[1],t._uvRepeat[0],t._uvRepeat[1],t._uvRotation,0,0)}));var r=e.image;r&&(this.style.image=r)},t.prototype._addPathLine=function(){this.node.add(this.pathLine)},t.prototype._beforeSetupComplete=function(e){this._setupPathLine(e),this._setupPoints(e),this._addPathLine()},t.prototype._updateByPoints=function(){this.node.updateWorldMatrix(!0,!1),this._points.length>=2&&this.pathPointList.set(this._points.map((function(e){return(new THREE.Vector3).fromArray(e)})),this.pathCornerRadius,this.pathCornerSplit,this.pathUp,this.close),this.pathGeometry&&(this.pathGeometry.boundingBox=null,this.pathGeometry.boundingSphere=null)},t.prototype.updatePath=function(e){if(this.pathScrollUV&&this.pathMaterial){var t=this.pathScrollSpeed*e;return this.rotateScrollDirection?this._uvOffset[1]-=t:this._uvOffset[0]-=t,!0}return!1},t.prototype.update=function(t){var i=e.prototype.update.call(this,t);return i|=this.updatePath(t)},t.prototype.play=function(e){var t=(e=e||{}).time||1e3,i=Et.parseValue(e.startProgress,0),r=Et.parseValue(e.endProgress,1),n=e.lerpType||S.Linear.None,o=e.complete,s=this,a={progress:i},l={progress:r};this.pathPlayingTween=new TWEEN.Tween(a).to(l,t).easing(n).onUpdate((function(){s.pathGeometry.update(s.pathPointList,{width:s.pathWidth,radius:s.pathWidth,arrow:!!s.arrowFlag,progress:this._object.progress}),s.app&&s.app.rendererManager._mainRenderer.dirty()})).onComplete((function(){o&&o.call(s)})).start()},t.prototype.stop=function(){this.pathPlayingTween&&(this.pathPlayingTween.stop(),this.pathPlayingTween=null)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.image=this.image,t.scrollUV=this.scrollUV,t.points=this.points,t},t.prototype._setupResources=function(e){this.pathLine&&(this.pathLine.material=this.pathMaterial,this._addPathLine())},t.prototype.unloadResource=function(){e.prototype.unloadResource.call(this),this.clearPoints()},o(t,[{key:"rotateScrollDirection",set:function(e){this._uvRotation=e?Math.PI/2:0,this._synUvTransform()},get:function(){return 0!==this._uvRotation}},{key:"imageRepeat",set:function(e){this._uvRepeat[0]=e[0],this._uvRepeat[1]=e[1],this._synUvTransform()},get:function(){return this._uvRepeat.slice(0)}},{key:"imageScroll",set:function(e){this.pathScrollUV=e,this.tickable=!0},get:function(){return this.pathScrollUV}},{key:"imageScrollSpeed",set:function(e){this.pathScrollSpeed=THING.Math.clamp(e,-99,99)},get:function(){return this.pathScrollSpeed}},{key:"isOutdoors",get:function(){for(var e=this._parent;e;e=e._parent)if(e.isBuilding)return!1;return!0}},{key:"useTexture",set:function(e){var t=this.pathLine.material;t.map=e?this.pathTexture:null,t.needsUpdate=!0},get:function(){return null!==this.pathLine.material.map}},{key:"width",set:function(e){this.pathWidth=e,this._updateByPoints()},get:function(){return this.pathWidth}},{key:"cornerRadius",set:function(e){this.pathCornerRadius=e,this._updateByPoints()},get:function(){return this.pathCornerRadius}},{key:"cornerSegments",set:function(e){this.pathCornerSplit=e,this._updateByPoints()},get:function(){return this.pathCornerSplit}},{key:"length",get:function(){if(this._points.length<=1)return 0;for(var e=0,t=this._points[0],i=1;i<this._points.length;i++){var r=this._points[i];e+=THING.Math.getDistance(r,t),t=r}return e}},{key:"cornerSplit",set:function(e){THING.Utils.warn("[LineBase] Please use '.cornerSegments' to replace '.cornerSplit'"),this.cornerSegments=e},get:function(){return THING.Utils.warn("[LineBase] Please use '.cornerSegments' to replace '.cornerSplit'"),this.cornerSegments}},{key:"uvRatio",set:function(e){this._uvRepeat[0]=1/e}},{key:"scrollUV",set:function(e){this.pathScrollUV=e,this.tickable=!0},get:function(){return this.pathScrollUV}},{key:"scrollSpeed",set:function(e){this.pathScrollSpeed=THING.Math.clamp(e/10,-99,99)},get:function(){return 10*this.pathScrollSpeed}}]),t}(cl),xl=function(){function e(t){n(this,e),this.app=t,this._points=[]}return e.prototype.set=function(e,t,i,r){this._points=e},o(e,[{key:"vertices",get:function(){for(var e=[],t=0;t<this._points.length;t++)e.push(Et.parseVector3(this._points[t]));return e}}]),e}(),El=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.dotNode=null,r.pathGeometry=new THREE.BufferGeometry,r.pathGeometry.update=function(e,t){},r.dotGeometry=null,r.dotMaterial=null,r.pathPointList=new xl,r}return s(t,e),t.prototype._updateByPoints=function(){e.prototype._updateByPoints.call(this);var t=this.pathPointList.vertices;t.length&&(this.pathGeometry.setFromPoints(t),this.pathLine.computeLineDistances(),this.dotGeometry&&this.dotGeometry.setFromPoints(t),this.node.setFrustumCulled(!1))},t.prototype._setupPathLine=function(e){var t,i=e.style||{},r=e.lineOpacity||1,n=Et.parseValue(e.lineDashSize||i.lineDashSize,0),o=Et.parseValue(e.lineGapSize||i.lineGapSize,0),s=e.lineWidth||1,a=e.color||255,l=this.pathPointList.vertices;t=n||o?new THREE.LineDashedMaterial({color:a,opacity:r,dashSize:n,gapSize:o,linewidth:s,transparent:!0}):new THREE.LineBasicMaterial({color:a,opacity:r,linewidth:s,transparent:!0}),this.pathGeometry.setFromPoints(l),this.pathLine=new THREE.Line(this.pathGeometry,t),this.pathLine.computeLineDistances();var u=e.dotColor||16777215,c=e.dotSize;c&&(this.dotGeometry=(new THREE.BufferGeometry).setFromPoints(l),this.dotMaterial=new THREE.PointsMaterial({color:u,size:c,sizeAttenuation:!1}),this.dotNode=new THREE.Points(this.dotGeometry,this.dotMaterial),this.node.add(this.dotNode))},t.prototype.showLines=function(e){this.pathLine.visible=e},t.prototype.showPoints=function(e){this.dotNode.visible=e},o(t,[{key:"isLine",get:function(){return THING.Utils.warn("[Line] Please use 'instanceof THING.Line' to replace '.isLine'"),this instanceof THING.Line}}]),t}(_l),wl=function(){function e(){n(this,e),this.pos=new THREE.Vector3,this.dir=new THREE.Vector3,this.right=new THREE.Vector3,this.up=new THREE.Vector3,this.dist=0,this.widthScale=1,this.sharp=!1}return e.prototype.lerpPathPoints=function(e,t,i){this.pos.lerpVectors(e.pos,t.pos,i),this.dir.lerpVectors(e.dir,t.dir,i),this.up.lerpVectors(e.up,t.up,i),this.right.lerpVectors(e.right,t.right,i),this.dist=(t.dist-e.dist)*i+e.dist,this.widthScale=(t.widthScale-e.widthScale)*i+e.widthScale},e.prototype.copy=function(e){this.pos.copy(e.pos),this.dir.copy(e.dir),this.up.copy(e.up),this.right.copy(e.right),this.dist=e.dist,this.widthScale=e.widthScale},e}(),Tl=new THREE.Vector3,Ml=new THREE.Vector3,Cl=new THREE.Vector3,Sl=new THREE.Matrix4,jl=new THREE.QuadraticBezierCurve3;var Pl=function(){function e(){n(this,e),this.array=[],this.count=0}return e.prototype.set=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((e=e.slice(0)).length<2)return console.warn("PathPointList: points length less than 2."),void(this.count=0);n&&!e[0].equals(e[e.length-1])&&e.push((new THREE.Vector3).copy(e[0]));for(var o=0,s=e.length;o<s;o++)if(0===o)this._start(e[o],e[o+1],r);else if(o===s-1)if(n){this._corner(e[o],e[1],t,i,r);var a=this.array[0].dist;this.array[0].copy(this.array[this.count-1]),this.array[0].dist=a}else this._end(e[o]);else this._corner(e[o],e[o+1],t,i,r)},e.prototype.distance=function(){return this.count>0?this.array[this.count-1].dist:0},e.prototype._getByIndex=function(e){return this.array[e]||(this.array[e]=new wl),this.array[e]},e.prototype._start=function(e,t,i){this.count=0;var r=this._getByIndex(this.count);if(r.pos.copy(e),r.dir.subVectors(t,e),i)r.up.copy(i);else{var n=Number.MAX_VALUE,o=Math.abs(r.dir.x),s=Math.abs(r.dir.y),a=Math.abs(r.dir.z);o<n&&(n=o,r.up.set(1,0,0)),s<n&&(n=s,r.up.set(0,1,0)),a<n&&r.up.set(0,0,1)}r.right.crossVectors(r.dir,r.up).normalize(),r.up.crossVectors(r.right,r.dir).normalize(),r.dist=0,r.widthScale=1,r.sharp=!1,r.dir.normalize(),this.count++},e.prototype._end=function(e){var t=this.array[this.count-1],i=this._getByIndex(this.count);i.pos.copy(e),i.dir.subVectors(e,t.pos);var r=i.dir.length();i.dir.normalize(),i.up.copy(t.up);var n=Tl.crossVectors(t.dir,i.dir);if(n.length()>Number.EPSILON){n.normalize();var o=Math.acos(Math.min(Math.max(t.dir.dot(i.dir),-1),1));i.up.applyMatrix4(Sl.makeRotationAxis(n,o))}i.right.crossVectors(i.dir,i.up).normalize(),i.dist=t.dist+r,i.widthScale=1,i.sharp=!1,this.count++},e.prototype._corner=function(e,t,i,r,n){if(i>0&&r>0){for(var o=function(e,t,i,r,n,o){var s=Tl.subVectors(t,e),a=Ml.subVectors(i,t),l=s.length(),u=a.length();s.normalize(),a.normalize();var c=Math.min(.999999*(n?l/2:l),r);o.v0.copy(t).sub(s.multiplyScalar(c)),o.v1.copy(t);var h=Math.min(u/2*.999999,r);return o.v2.copy(t).add(a.multiplyScalar(h)),o}(this.array[this.count-1].pos,e,t,i,this.count-1==0,jl).getPoints(r),s=0;s<r;s++)this._sharpCorner(o[s],o[s+1],n,0===s?1:0);o[r].equals(t)||this._sharpCorner(o[r],t,n,2)}else this._sharpCorner(e,t,n,0,!0)},e.prototype._sharpCorner=function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.array[this.count-1],s=this._getByIndex(this.count),a=Tl.subVectors(e,o.pos),l=Ml.subVectors(t,e),u=a.length();if(a.normalize(),l.normalize(),s.pos.copy(e),1===r?s.dir.copy(a):2===r?s.dir.copy(l):(s.dir.addVectors(a,l),s.dir.normalize()),i)1===s.dir.dot(i)?s.right.crossVectors(l,i).normalize():s.right.crossVectors(s.dir,i).normalize(),s.up.crossVectors(s.right,s.dir).normalize();else{s.up.copy(o.up);var c=Cl.crossVectors(o.dir,s.dir);if(c.length()>Number.EPSILON){c.normalize();var h=Math.acos(Math.min(Math.max(o.dir.dot(s.dir),-1),1));s.up.applyMatrix4(Sl.makeRotationAxis(c,h))}s.right.crossVectors(s.dir,s.up).normalize()}s.dist=o.dist+u;var p=a.dot(l);s.widthScale=Math.min(1/Math.sqrt((1+p)/2),1.415)||1,s.sharp=Math.abs(p-1)>.05&&n,this.count++},e}(),Rl=function(e){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n(this,t);var o=a(this,e.call(this));return isNaN(i)?o._initByData(i.pathPointList,i.options,i.usage,r):o._initByMaxVertex(i,r),o}return s(t,e),t.prototype._initByMaxVertex=function(e,t){this.setAttribute("position",new THREE.BufferAttribute(new Float32Array(3*e),3).setUsage(THREE.DynamicDrawUsage)),this.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*e),3).setUsage(THREE.DynamicDrawUsage)),this.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(2*e),2).setUsage(THREE.DynamicDrawUsage)),t&&this.setAttribute("uv2",new THREE.BufferAttribute(new Float32Array(2*e),2).setUsage(THREE.DynamicDrawUsage)),this.drawRange.start=0,this.drawRange.count=0,this.setIndex(new Array(3*e))},t.prototype._initByData=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments[2],r=arguments[3],n=Dl(e,t,r);n&&0!==n.count?(this.setAttribute("position",new THREE.BufferAttribute(new Float32Array(n.position),3).setUsage(i||THREE.StaticDrawUsage)),this.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(n.normal),3).setUsage(i||THREE.StaticDrawUsage)),this.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(n.uv),2).setUsage(i||THREE.StaticDrawUsage)),r&&this.setAttribute("uv2",new THREE.BufferAttribute(new Float32Array(n.uv2),2).setUsage(i||THREE.StaticDrawUsage)),this.setIndex(n.indices)):this._initByMaxVertex(2,r)},t.prototype.update=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!!this.getAttribute("uv2"),r=Dl(e,t,i);r?(this._updateAttributes(r.position,r.normal,r.uv,i?r.uv2:null,r.indices),this.drawRange.count=r.count):this.drawRange.count=0},t.prototype._resizeAttribute=function(e,t){for(var i=this.getAttribute(e);i.array.length<t;){var r=i.array.length,n=new THREE.BufferAttribute(new Float32Array(2*r),i.itemSize,i.normalized);n.name=i.name,n.usage=i.usage,this.setAttribute(e,n),i=n}},t.prototype._resizeIndex=function(e){for(var t=this.getIndex();t.array.length<e;){var i=t.array.length,r=new THREE.BufferAttribute(2*i>65535?new Uint32Array(2*i):new Uint16Array(2*i),1);r.name=t.name,r.usage=t.usage,this.setIndex(r),t=r}},t.prototype._updateAttributes=function(e,t,i,r,n){this._resizeAttribute("position",e.length);var o=this.getAttribute("position");o.array.set(e,0),o.updateRange.count=e.length,o.needsUpdate=!0,this._resizeAttribute("normal",t.length);var s=this.getAttribute("normal");s.array.set(t,0),s.updateRange.count=t.length,s.needsUpdate=!0,this._resizeAttribute("uv",i.length);var a=this.getAttribute("uv");if(a.array.set(i,0),a.updateRange.count=i.length,a.needsUpdate=!0,r){this._resizeAttribute("uv2",r.length);var l=this.getAttribute("uv2");l.array.set(r,0),l.updateRange.count=r.length,l.needsUpdate=!0}this._resizeIndex(n.length);var u=this.getIndex();u.set(n,0),u.updateRange.count=n.length,u.needsUpdate=!0},t}(THREE.BufferGeometry);function Dl(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.width||.1,n=void 0!==t.progress?t.progress:1,o=void 0===t.arrow||t.arrow,s=void 0!==t.side?t.side:"both",a=r/2,l="both"!==s?r/2:r,u=e.distance(),c=n*u;if(0==u)return null;var h=a/l,p=a/u,d=0,f=[],m=[],g=[],v=[],y=[],b=0,_=new THREE.Vector3,x=new THREE.Vector3,E=new THREE.Vector3,w=new THREE.Vector3,T=new THREE.Vector3,M=new THREE.Vector3;function C(e){var t=0===f.length,r=e.sharp&&!t,n=e.dist/l,o=e.dist/u,c=e.dir,C=e.up,S=e.right;if("left"!==s?_.copy(S).multiplyScalar(a*e.widthScale):_.set(0,0,0),"right"!==s?x.copy(S).multiplyScalar(-a*e.widthScale):x.set(0,0,0),_.add(e.pos),x.add(e.pos),r){E.fromArray(f,f.length-6).sub(x),w.fromArray(f,f.length-3).sub(_);var j=E.length()-w.length(),P=void 0,R=void 0;j>0?(P=E,R=x):(P=w,R=_),T.copy(P).setLength(Math.abs(j)).add(R);var D=M.copy(R).sub(T).normalize().dot(c)*M.copy(R).sub(T).length()*2;M.copy(c).setLength(D).add(T),j>0?(f.push(T.x,T.y,T.z,_.x,_.y,_.z,x.x,x.y,x.z,_.x,_.y,_.z,M.x,M.y,M.z,_.x,_.y,_.z),b+=6,y.push(b-6,b-8,b-7,b-6,b-7,b-5,b-4,b-6,b-5,b-2,b-4,b-1),d+=12):(f.push(x.x,x.y,x.z,T.x,T.y,T.z,x.x,x.y,x.z,_.x,_.y,_.z,x.x,x.y,x.z,M.x,M.y,M.z),b+=6,y.push(b-6,b-8,b-7,b-6,b-7,b-5,b-6,b-5,b-3,b-2,b-3,b-1),d+=12),m.push(C.x,C.y,C.z,C.x,C.y,C.z,C.x,C.y,C.z,C.x,C.y,C.z,C.x,C.y,C.z,C.x,C.y,C.z),g.push(n-h,0,n-h,1,n,0,n,1,n+h,0,n+h,1),i&&v.push(o-p,0,o-p,1,o,0,o,1,o+p,0,o+p,1)}else f.push(x.x,x.y,x.z,_.x,_.y,_.z),m.push(C.x,C.y,C.z,C.x,C.y,C.z),g.push(n,0,n,1),i&&v.push(o,0,o,1),b+=2,t||(y.push(b-2,b-4,b-3,b-2,b-3,b-1),d+=6)}var S=new THREE.Vector3;function j(e){var t=e.dir,n=e.up,o=e.right,c=e.dist/l,h=e.dist/u;"left"!==s?_.copy(o).multiplyScalar(2*a):_.set(0,0,0),"right"!==s?x.copy(o).multiplyScalar(2*-a):x.set(0,0,0),S.copy(t).setLength(3*a),_.add(e.pos),x.add(e.pos),S.add(e.pos),f.push(x.x,x.y,x.z,_.x,_.y,_.z,S.x,S.y,S.z),m.push(n.x,n.y,n.z,n.x,n.y,n.z,n.x,n.y,n.z),g.push(c,"both"!==s?"right"!==s?-2:0:-.5,c,"both"!==s?"left"!==s?2:0:1.5,c+1.5,"both"!==s?0:.5),i&&v.push(h,"both"!==s?"right"!==s?-2:0:-.5,h,"both"!==s?"left"!==s?2:0:1.5,h+1.5*r/u,"both"!==s?0:.5),b+=3,y.push(b-1,b-3,b-2),d+=3}var P=void 0;if(c>0)for(var R=0;R<e.count;R++){var D=e.array[R];if(D.dist>c){var A=e.array[R-1];P=new wl;var k=(c-A.dist)/(D.dist-A.dist);P.lerpPathPoints(A,D,k),C(P);break}C(D)}else P=e.array[0];return o&&j(P=P||e.array[e.count-1]),{position:f,normal:m,uv:g,uv2:v,indices:y,count:d}}var Al=function(e){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n(this,t),a(this,e.call(this,i,r))}return s(t,e),t.prototype._initByData=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments[2],r=arguments[3],n=kl(e,t,r);n&&0!==n.count?(this.setAttribute("position",new THREE.BufferAttribute(new Float32Array(n.position),3).setUsage(i||THREE.StaticDrawUsage)),this.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(n.normal),3).setUsage(i||THREE.StaticDrawUsage)),this.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(n.uv),2).setUsage(i||THREE.StaticDrawUsage)),r&&this.setAttribute("uv2",new THREE.BufferAttribute(new Float32Array(n.uv2),2).setUsage(i||THREE.StaticDrawUsage)),this.setIndex(n.indices)):this._initByMaxVertex(2,r)},t.prototype.update=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!!this.getAttribute("uv2"),r=kl(e,t,i);r?(this._updateAttributes(r.position,r.normal,r.uv,i?r.uv2:null,r.indices),this.drawRange.count=r.count):this.drawRange.count=0},t}(Rl);function kl(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.radius||.1,n=void 0!==t.progress?t.progress:1,o=Math.max(2,t.radialSegments||8),s=t.startRad||0,a=2*r*Math.PI,l=e.distance(),u=n*l;if(0==u)return null;var c=0,h=[],p=[],d=[],f=[],m=[],g=0,v=new THREE.Vector3;function y(e,t,r){for(var n=0===h.length,o=e.dist/a,u=e.dist/l,y=0;y<=r;y++){var b=y;b==r&&(b=0),v.copy(e.up).applyAxisAngle(e.dir,s+2*Math.PI*b/r).normalize(),h.push(e.pos.x+v.x*t*e.widthScale,e.pos.y+v.y*t*e.widthScale,e.pos.z+v.z*t*e.widthScale),p.push(v.x,v.y,v.z),d.push(o,y/r),i&&f.push(u,y/r),g++}if(!n)for(var _=g-2*(r+1),x=g-(r+1),E=0;E<r;E++)m.push(x+E,_+E,_+E+1,x+E,_+E+1,x+E+1),c+=6}if(u>0)for(var b=0;b<e.count;b++){var _=e.array[b];if(_.dist>u){var x=e.array[b-1],E=new wl,w=(u-x.dist)/(_.dist-x.dist);E.lerpPathPoints(x,_,w),y(E,r,o);break}y(_,r,o)}return{position:h,normal:p,uv:d,uv2:f,indices:m,count:c}}var Ol=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.arrowFlag=!0,r.side="both",r.pathGeometry=new Rl,r.pathPointList=new Pl,r}return s(t,e),t.prototype._updateByPoints=function(){e.prototype._updateByPoints.call(this),this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,side:this.side,arrow:this.arrowFlag}),this.pathGeometry.computeBoundingSphere()},t.prototype.setup=function(t){var i=Et.parseValue(t.arrowFlag,t.arrowCap);this.arrowFlag=Et.parseValue(i,!0),e.prototype.setup.call(this,t)},o(t,[{key:"progress",set:function(e){this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,arrow:this.arrowFlag,side:this.side,progress:THING.Math.clamp(e,0,1)})}},{key:"scrollUVRange",set:function(e){var t=this.length/this.pathWidth;this.uvRatio=t*e}},{key:"arrowCap",set:function(e){this.arrowFlag=e,this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,arrow:this.arrowFlag,side:this.side})},get:function(){return this.arrowFlag}},{key:"isRouteLine",get:function(){return!0}}]),t}(_l),Bl=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.pathWidth=.2,r.pathRadialSegments=8,r.pathStartRad=0,r.pathGeometry=new Al,r.pathPointList=new Pl,r.pathUp=void 0,r.pathMaterial=new THREE.MeshStandardMaterial({transparent:!0,roughness:.5,metalness:.5}),r}return s(t,e),t.prototype._setupPathLine=function(t){t=t||{},e.prototype._setupPathLine.call(this,t)},t.prototype._updateByPoints=function(){e.prototype._updateByPoints.call(this),this.pathGeometry.update(this.pathPointList,{radius:this.pathWidth,radialSegments:this.pathRadialSegments,startRad:this.pathStartRad}),this.pathGeometry.computeBoundingSphere()},o(t,[{key:"progress",set:function(e){this.pathGeometry.update(this.pathPointList,{radius:this.pathWidth,radialSegments:this.pathRadialSegments,progress:THING.Math.clamp(e,0,1),startRad:this.pathStartRad})}},{key:"scrollUVRange",set:function(e){var t=this.length/(2*this.pathWidth*Math.PI);this.uvRatio=t*e}},{key:"isPolygonLine",get:function(){return!0}}]),t}(_l),Fl=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._pointSize=1,r._pointsMesh=null,r}return s(t,e),t.prototype._updateByPoints=function(){this.app.resourceManager.remove(this._pointsMesh);var e=(new THREE.BufferGeometry).setFromPoints(this._points),t=new THREE.PointsMaterial({size:this._pointSize,sizeAttenuation:!1});this._pointsMesh=new THREE.Points(e,t),this.node.add(this._pointsMesh)},t.prototype._beforeSetupComplete=function(e){this._pointSize=e.pointSize||this._pointSize;var t=e.points;t&&this.addPoints(t)},t}(cl),Ll=function e(){n(this,e),this.strId="",this.fPPAfterImageValue=0,this.listGroups=new Array;var t=new Il;this.listGroups[0]=t,this._attr="ParticleData"};Ll.prototype={getAttr:function(){return this._attr}};var Il=function e(){n(this,e),this.strId="",this.texture=new Ul,this.fFixedTimeStep=.33,this.strUseMesh="false",this.strMeshUrl="BuildIn/Box",this.arrayMeshParams=new Array,this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.strHasPerspective="true",this.strIsColorize="true",this.iBlendingMode=1,this.strIsTransparent="true",this.fAlphaTest=0,this.strIsDepthWrite="false",this.strIsDepthTest="false",this.strIsFog="false",this.strEnableTrail="false",this.textureTrail=new Ul,this.fTrailLife=.5,this.fTrailWidthStart=1,this.fTrailWidthEnd=1,this.fScale=window.innerHeight/2,this.iMaxParticleCount=500,this.vec4Quaternion=new THREE.Vector4(0,0,0,1),this.listEmitters=new Array;var t=new Nl;this.listEmitters[0]=t},Nl=function e(){n(this,e),this.strId="",this.iDistribution=1,this.iParticleCount=100,this.fDuration=-1,this.strIsStatic="false",this.strIsLookAtCamera="false",this.strIsLookAtCameraOnlyY="false",this.fActiveMultiplier=1,this.iDirection=1,this.maxAge=new zl,this.position=new Hl,this.velocity=new Vl,this.acceleration=new Wl,this.drag=new Gl,this.wiggle=new ql,this.rotation=new Jl,this.trail=new Xl,this.listColor=new Array;var t=new Yl;this.listColor[0]=t,this.listOpacity=new Array;var i=new Zl;this.listOpacity[0]=i,this.listSize=new Array;var r=new Ql;this.listSize[0]=r,this.listAngle=new Array;var o=new Kl;this.listAngle[0]=o},Ul=function e(){n(this,e),this.name="32x32_star.png",this.url="http://static.3dmomoda.com/textures/18092617nyspq5moaka1i2fhvs1hh66s.png",this.vec2Frames=new THREE.Vector2(1,1),this.iFrameCount=1,this.iLoop=1},zl=function e(){n(this,e),this.fValue=1,this.fSpread=1},Hl=function e(){n(this,e),this.vec3Value=new THREE.Vector3(0,0,0),this.vec3Spread=new THREE.Vector3(0,0,0),this.vec3SpreadClamp=new THREE.Vector3(0,0,0),this.fRadius=0,this.vec3RadiusScale=new THREE.Vector3(1,1,1),this.iDistribution=1,this.strIsRandomise="false"},Vl=function e(){n(this,e),this.vec3Value=new THREE.Vector3(0,10,0),this.vec3Spread=new THREE.Vector3(10,0,10),this.iDistribution=1,this.strIsRandomise="false"},Wl=function e(){n(this,e),this.vec3Value=new THREE.Vector3(0,0,0),this.vec3Spread=new THREE.Vector3(0,0,0),this.iDistribution=1,this.strIsRandomise="false"},Gl=function e(){n(this,e),this.fValue=0,this.fSpread=0,this.strIsRandomise="false"},ql=function e(){n(this,e),this.fValue=0,this.fSpread=0},Xl=function e(){n(this,e),this.fValue=0,this.fSpread=0,this.fStep=0,this.fStepSpread=0},Jl=function e(){n(this,e),this.vec3Axis=new THREE.Vector3(0,0,0),this.vec3AxisSpread=new THREE.Vector3(0,0,0),this.fAngle=0,this.fAngleSpread=0,this.strIsStatic="false",this.vec3Center=new THREE.Vector3(0,0,0),this.strIsRandomise="false"},Yl=function e(){n(this,e),this.vec3Value=new THREE.Vector3(1,1,1),this.vec3Spread=new THREE.Vector3(0,0,0),this.strIsRandomise="false"},Zl=function e(){n(this,e),this.fValue=1,this.fSpread=0,this.strIsRandomise="false"},Ql=function e(){n(this,e),this.fValue=1,this.fSpread=0,this.strIsRandomise="false"},Kl=function e(){n(this,e),this.fValue=0,this.fSpread=0,this.strIsRandomise="false"},$l=function(){var e="[BufferGeometryHelper.js] : ";this.bEnableLog=!0,this.bufferGeometry=null,this.jsonLoader=new THREE.BufferGeometryLoader,this.objLoader=new THREE.OBJLoader,this.strMeshUrl=null;var t=this;this.init=function(i,n){if(t.bEnableLog&&THING.Utils.log(e+"[init];"),null!=n&&null!=n){if(null==i||null==i||"object"!=(void 0===i?"undefined":r(i)))return THING.Utils.error(e+"[init] : options == null;"),void n(null);if(null==i.strMeshUrl||null==i.strMeshUrl||"string"!=typeof i.strMeshUrl)return THING.Utils.error(e+"[init] : options.strMeshUrl == null;"),void n(null);t.strMeshUrl=i.strMeshUrl,null!=t.bufferGeometry&&null!=t.bufferGeometry&&(t.bufferGeometry.dispose(),t.bufferGeometry=null);if(i.strMeshUrl.indexOf("BuildIn")>=0){var o=!1;return i.strMeshUrl.indexOf("Box")>=0&&(t.bEnableLog&&THING.Utils.log(e+"[init] : it's a BoxBufferGeometry;"),o=!t.checkParams(i.params,3),t.bufferGeometry=o?new THREE.BoxBufferGeometry(1,1,1):new THREE.BoxBufferGeometry(i.params[0],i.params[1],i.params[2])),i.strMeshUrl.indexOf("Cylinder")>=0&&(t.bEnableLog&&THING.Utils.log(e+"[init] : it's a CylinderBufferGeometry;"),o=!t.checkParams(i.params,4),t.bufferGeometry=o?new THREE.CylinderBufferGeometry(1,1,1,6):new THREE.CylinderBufferGeometry(i.params[0],i.params[1],i.params[2],i.params[3]<=12?i.params[3]:12)),i.strMeshUrl.indexOf("Cone")>=0&&(t.bEnableLog&&THING.Utils.log(e+"[init] : it's a ConeBufferGeometry;"),o=!t.checkParams(i.params,3),t.bufferGeometry=o?new THREE.ConeBufferGeometry(1,1,6):new THREE.ConeBufferGeometry(i.params[0],i.params[1],i.params[2]<=12?i.params[2]:12)),i.strMeshUrl.indexOf("Circle")>=0&&(t.bEnableLog&&THING.Utils.log(e+"[init] : it's a CircleBufferGeometry;"),o=!t.checkParams(i.params,2),t.bufferGeometry=o?new THREE.CircleBufferGeometry(1,6):new THREE.CircleBufferGeometry(i.params[0],i.params[1]<=12?i.params[1]:12)),i.strMeshUrl.indexOf("Dodecahedron")>=0&&(t.bEnableLog&&THING.Utils.log(e+"[init] : it's a DodecahedronBufferGeometry;"),o=!t.checkParams(i.params,2),t.bufferGeometry=o?new THREE.DodecahedronBufferGeometry(1,0):new THREE.DodecahedronBufferGeometry(i.params[0],i.params[1]<=1?i.params[1]:1)),i.strMeshUrl.indexOf("Icosahedron")>=0&&(t.bEnableLog&&THING.Utils.log(e+"[init] : it's a IcosahedronBufferGeometry;"),o=!t.checkParams(i.params,2),t.bufferGeometry=o?new THREE.IcosahedronBufferGeometry(1,0):new THREE.IcosahedronBufferGeometry(i.params[0],i.params[1]<=1?i.params[1]:1)),i.strMeshUrl.indexOf("Octahedron")>=0&&(t.bEnableLog&&THING.Utils.log(e+"[init] : it's a OctahedronBufferGeometry;"),o=!t.checkParams(i.params,2),t.bufferGeometry=o?new THREE.OctahedronBufferGeometry(1,0):new THREE.OctahedronBufferGeometry(i.params[0],i.params[1]<=2?i.params[1]:1)),i.strMeshUrl.indexOf("Plane")>=0&&(t.bEnableLog&&THING.Utils.log(e+"[init] : it's a PlaneBufferGeometry;"),o=!t.checkParams(i.params,2),t.bufferGeometry=o?new THREE.PlaneBufferGeometry(1,0):new THREE.PlaneBufferGeometry(i.params[0],i.params[1])),i.strMeshUrl.indexOf("Ring")>=0&&(t.bEnableLog&&THING.Utils.log(e+"[init] : it's a RingBufferGeometry;"),o=!t.checkParams(i.params,3),t.bufferGeometry=o?new THREE.RingBufferGeometry(1,2,12,1):new THREE.RingBufferGeometry(i.params[0],i.params[1],i.params[2]<=12?i.params[2]:12,1)),i.strMeshUrl.indexOf("Sphere")>=0&&(t.bEnableLog&&THING.Utils.log(e+"[init] : it's a SphereBufferGeometry;"),o=!t.checkParams(i.params,3),t.bufferGeometry=o?new THREE.SphereBufferGeometry(1,8,8):new THREE.SphereBufferGeometry(i.params[0],i.params[1]<=12?i.params[1]:12,i.params[2]<=12?i.params[2]:12)),i.strMeshUrl.indexOf("Tetrahedron")>=0&&(t.bEnableLog&&THING.Utils.log(e+"[init] : it's a TetrahedronBufferGeometry;"),o=!t.checkParams(i.params,2),t.bufferGeometry=o?new THREE.TetrahedronBufferGeometry(1,0):new THREE.TetrahedronBufferGeometry(i.params[0],i.params[1]<=2?i.params[1]:2)),i.strMeshUrl.indexOf("Torus")>=0&&i.strMeshUrl.indexOf("TorusKnot")<0&&(t.bEnableLog&&THING.Utils.log(e+"[init] : it's a TorusBufferGeometry;"),o=!t.checkParams(i.params,4),t.bufferGeometry=o?new THREE.TorusBufferGeometry(1,1,8,8):new THREE.TorusBufferGeometry(i.params[0],i.params[1],i.params[2]<=12?i.params[2]:12,i.params[3]<=12?i.params[3]:12)),i.strMeshUrl.indexOf("TorusKnot")>=0&&(t.bEnableLog&&THING.Utils.log(e+"[init] : it's a TorusKnotBufferGeometry;"),o=!t.checkParams(i.params,6),t.bufferGeometry=o?new THREE.TorusKnotBufferGeometry(1,1,32,8,2,3):new THREE.TorusKnotBufferGeometry(i.params[0],i.params[1],i.params[2]<=32?i.params[2]:32,i.params[3]<=12?i.params[3]:12,i.params[4]<=12?i.params[4]:12,i.params[5]<=12?i.params[5]:12)),void n(t.bufferGeometry)}var s=i.strMeshUrl.indexOf(".json");s>=0&&s+".json".length==i.strMeshUrl.length&&(t.bEnableLog&&THING.Utils.log(e+"[init] : it's a .json file to BufferGeometry;"),t.jsonLoader.load(Globals.strParticleMeshRootPath+i.strMeshUrl,(function(r){return null!=r&&null!=r?(t.bufferGeometry=r,void n(t.bufferGeometry)):(THING.Utils.error(e+"[init] : failed load the .json file to BufferGeometry; strMeshUrl = "+i.strMeshUrl),void n(null))})));var a=i.strMeshUrl.indexOf(".obj");a>=0&&a+".obj".length==i.strMeshUrl.length&&(t.bEnableLog&&THING.Utils.log(e+"[init] : it's a .obj file to BufferGeometry;"),t.objLoader.load(Globals.strParticleMeshRootPath+i.strMeshUrl,(function(r){if(null!=r&&null!=r&&null!=r.children){for(var o=null,s=0,a=r.children.length;s<a;s++)if(r.children[s]instanceof THREE.Mesh){o=r.children[s];break}if(null!=o){var l=(new THREE.BufferGeometry).fromGeometry(o.geometry);return null!=l&&null!=l?(t.bufferGeometry=l,void n(t.bufferGeometry)):(THING.Utils.error(e+"[init] : failed transform the .obj file to BufferGeometry; strMeshUrl = "+i.strMeshUrl),void n(null))}return THING.Utils.error(e+"[init] : failed load the .obj file to BufferGeometry; can not find a mesh; strMeshUrl = "+i.strMeshUrl),void n(null)}}),(function(e){}),(function(t){THING.Utils.error(e+"[init] : failed load the .obj file to BufferGeometry; strMeshUrl = "+i.strMeshUrl+"; error = "+t),n(null)})))}else THING.Utils.error(e+"[init] : onFinished == null;")},this.checkParams=function(t,i){if(null==t||null==t||"object"!=(void 0===t?"undefined":r(t)))return THING.Utils.warn(e+"[checkParams] : params == null;"),!1;if(t.length<i)return THING.Utils.warn(e+"[checkParams] : params.length < "+i),!1;for(var n=0;n<i;n++)if(null==t[n]||null==t[n]||"number"!=typeof t[n])return THING.Utils.warn(e+"[checkParams] : error params["+n+"];"),!1;return!0}},eu=function(){function e(t,i,r){n(this,e),this._options=t,this._emitter=i,this._particleGroup=r,this._emitter||this.refresh()}return e.prototype.cloneOptions=function(){return Et.cloneObject(this._options,!1,null,(function(e,t){if(Et.isFunction(e.clone))return e.clone()}))},e.prototype.refresh=function(){this._emitter&&(this._particleGroup._group.removeEmitter(this._emitter),this._emitter=null);var e=this.cloneOptions();this._particleGroup._options.useMesh?this._emitter=new MSPE.Emitter(e):this._emitter=new SPE.Emitter(e),this._particleGroup._group.addEmitter(this._emitter);var t=this._particleGroup._particleSystem.node,i=Et.parseValue(t.userData.skipBoundingBox,!1);t.traverse((function(e){e.userData.skipBoundingBox=i}))},e.prototype.setAttributeOptions=function(e,t){Et.isUndefined(t)||"{}"===JSON.stringify(t)||Et.isUndefined(this.options[e])||(Et.isObject(this.options[e])?Et.mergeObject(this.options[e],t,!0):this.options[e]=t,this.refresh())},o(e,[{key:"options",set:function(e){e&&(Et.mergeObject(this._options,e,!0),this.refresh())},get:function(){return this._options}},{key:"maxAge",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setAttributeOptions("maxAge",e)}},{key:"position",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setAttributeOptions("position",e)}},{key:"radius",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setAttributeOptions("radius",e)}},{key:"velocity",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setAttributeOptions("velocity",e)}},{key:"acceleration",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setAttributeOptions("acceleration",e)}},{key:"drag",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setAttributeOptions("drag",e)}},{key:"wiggle",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setAttributeOptions("wiggle",e)}},{key:"rotation",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setAttributeOptions("rotation",e)}},{key:"color",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setAttributeOptions("color",e)}},{key:"opacity",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setAttributeOptions("opacity",e)}},{key:"size",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setAttributeOptions("size",e)}},{key:"angle",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setAttributeOptions("angle",e)}},{key:"type",set:function(e){this.setAttributeOptions("type",e)}},{key:"particleCount",set:function(e){this.setAttributeOptions("particleCount",e)}},{key:"duration",set:function(e){this.setAttributeOptions("duration",e)}},{key:"isStatic",set:function(e){this.setAttributeOptions("isStatic",e)}},{key:"isLookAtCamera",set:function(e){this.setAttributeOptions("isLookAtCamera",e)}},{key:"isLookAtCameraOnlyY",set:function(e){this.setAttributeOptions("isLookAtCameraOnlyY",e)}},{key:"activeMultiplier",set:function(e){this.setAttributeOptions("activeMultiplier",e)}},{key:"direction",set:function(e){this.setAttributeOptions("direction",e)}}]),e}(),tu=function(){function e(t,i,r){n(this,e),this._options=t,this._group=i,this._particleSystem=r,this._emitters=[],this._group||this.refresh()}return e.prototype.setAttributeOptions=function(e,t){Et.isUndefined(t)||"{}"===JSON.stringify(t)||Et.isUndefined(this.options[e])||(Et.isObject(this.options[e])?Et.mergeObject(this.options[e],t,!0):this.options[e]=t,this.refresh())},e.prototype.cloneOptions=function(){var e=Et.cloneObject(this._options,!1,(function(e){return"texture"!=e&&"bufferGeometry"!=e}),(function(e,t){if(Et.isFunction(e.clone))return e.clone()})),t=this._options.vec4Quaternion;return t&&(e.vec4Quaternion=t.clone()),e},e.prototype.refresh=function(){-1===this._particleSystem._groups.indexOf(this)&&this._particleSystem._groups.push(this),this._group&&this._group.mesh&&this._particleSystem.node.remove(this._group.mesh);for(var e=0;e<this._emitters.length;e++){var t=this._emitters[e];this._group.removeEmitter(t._emitter)}var i=this.cloneOptions();i.useMesh?this._group=new MSPE.Group(i):this._group=new SPE.Group(i);for(e=0;e<this._emitters.length;e++){var r=this._emitters[e],n=r.cloneOptions();for(var o in this._particleSystem._particleOptions){var s=this._particleSystem._particleOptions[o];Et.isNull(s)||(n[o]=s)}i.useMesh?r._emitter=new MSPE.Emitter(n):r._emitter=new SPE.Emitter(n),this._group.addEmitter(r._emitter)}var a=this._group.mesh;a&&(this._particleSystem.node.add(a),a.setFrustumCulled(!1))},e.prototype.tick=function(e,t){this._group.tick(e,t)},e.prototype.addEmitter=function(e){return new eu(e,null,this)},e.prototype.removeEmitter=function(e){for(var t=0;t<this._emitters.length;t++)if(e==this._emitters[t]){this._emitters.splice(t,1),this._group.removeEmitter(e._emitter);break}},o(e,[{key:"options",set:function(e){e&&(Et.mergeObject(this._options,e,!0),this.refresh())},get:function(){return this._options}},{key:"emitters",get:function(){return this._emitters}},{key:"texture",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setAttributeOptions("texture",e)}},{key:"fixedTimeStep",set:function(e){this.setAttributeOptions("fixedTimeStep",e)}},{key:"hasPerspective",set:function(e){this.setAttributeOptions("hasPerspective",e)}},{key:"colorize",set:function(e){this.setAttributeOptions("colorize",e)}},{key:"blending",set:function(e){this.setAttributeOptions("blending",e)}},{key:"transparent",set:function(e){this.setAttributeOptions("transparent",e)}},{key:"alphaTest",set:function(e){this.setAttributeOptions("alphaTest",e)}},{key:"depthWrite",set:function(e){this.setAttributeOptions("depthWrite",e)}},{key:"depthTest",set:function(e){this.setAttributeOptions("depthTest",e)}},{key:"fog",set:function(e){this.setAttributeOptions("fog",e)}},{key:"scale",set:function(e){this.setAttributeOptions("scale",e)}},{key:"maxParticleCount",set:function(e){this.setAttributeOptions("maxParticleCount",e)}},{key:"useMesh",set:function(e){this.setAttributeOptions("useMesh",e)}},{key:"vec4Quaternion",set:function(e){this.setAttributeOptions("vec4Quaternion",e)}}]),e}(),iu=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._groups=[],r._particleOptions={},r._groupOptions={},r._speed=1,r}return s(t,e),t.prototype._beforeSetupComplete=function(){var e=this;this.style.beforeSetRenderOrder=function(t){e.node.renderOrder=t}},t.prototype.loadFromURL=function(e,t){var i=this;e.node||(e.node=new THREE.Group);var r=e.url,n=this.app.particleResource.get(r);n?this.loadComplete(n,e,t):this.app.particleResource.download(r,(function(r){i.loadComplete(r,e,t)}))},t.prototype.setupFromData=function(t){var i=this,r=t.data;this.loadComplete(r,t,(function(){e.prototype.setupFromData.call(i,t)}))},t.prototype.loadComplete=function(e,t,i){this.setupParticleData(e,t,i),this.setupUserData(t)},t.prototype.customSetup=function(e){this.tickable=!0},t.prototype.update=function(t){t*=this._speed,e.prototype.update.call(this,t);for(var i=0;i<this._groups.length;i++){this._groups[i].tick(t,this.app.renderCamera)}return!0},t.prototype.parseEmitterOptions=function(e,t){var i=new THREE.Vector3(e.position.vec3Value.x,e.position.vec3Value.y,e.position.vec3Value.z),r=new THREE.Vector3(e.position.vec3Spread.x,e.position.vec3Spread.y,e.position.vec3Spread.z),n=new THREE.Vector3(e.position.vec3SpreadClamp.x,e.position.vec3SpreadClamp.y,e.position.vec3SpreadClamp.z),o=!1;o="true"==e.position.strIsRandomise.valueOf();var s=new THREE.Vector3(e.velocity.vec3Value.x,e.velocity.vec3Value.y,e.velocity.vec3Value.z),a=new THREE.Vector3(e.velocity.vec3Spread.x,e.velocity.vec3Spread.y,e.velocity.vec3Spread.z);e.velocity.strIsRandomise.valueOf();var l=new THREE.Vector3(e.acceleration.vec3Value.x,e.acceleration.vec3Value.y,e.acceleration.vec3Value.z),u=new THREE.Vector3(e.acceleration.vec3Spread.x,e.acceleration.vec3Spread.y,e.acceleration.vec3Spread.z),c=!1;c="true"==e.acceleration.strIsRandomise.valueOf();var h=!1;h="true"==e.strIsStatic.valueOf();var p=new THREE.Vector3(e.rotation.vec3Axis.x,e.rotation.vec3Axis.y,e.rotation.vec3Axis.z),d=new THREE.Vector3(e.rotation.vec3AxisSpread.x,e.rotation.vec3AxisSpread.y,e.rotation.vec3AxisSpread.z),f=new THREE.Vector3(e.rotation.vec3Center.x,e.rotation.vec3Center.y,e.rotation.vec3Center.z),m=!1;m="true"==e.rotation.strIsStatic.valueOf();var g=!1;g="true"==e.rotation.strIsRandomise.valueOf();var v=new Array,y=new Array,b=new Array;if(e.listColor.length>0)for(var _=0,x=e.listColor.length;_<x;_++)v.push(new THREE.Color(e.listColor[_].vec3Value.x,e.listColor[_].vec3Value.y,e.listColor[_].vec3Value.z)),y.push(new THREE.Vector3(e.listColor[_].vec3Spread.x,e.listColor[_].vec3Spread.y,e.listColor[_].vec3Spread.z)),"true"==e.listColor[_].strIsRandomise.valueOf()?b.push(!0):b.push(!1);else v.push(new THREE.Color("white")),y.push(new THREE.Vector3(0,0,0)),b.push(!1);var E=new Array,w=new Array,T=new Array;if(e.listOpacity.length>0)for(_=0,x=e.listOpacity.length;_<x;_++)E.push(e.listOpacity[_].fValue),w.push(e.listOpacity[_].fSpread),"true"==e.listOpacity[_].strIsRandomise.valueOf()?T.push(!0):T.push(!1);else E.push(1),w.push(0),T.push(!1);var M=new Array,C=new Array,S=new Array;if(e.listSize.length>0)for(_=0,x=e.listSize.length;_<x;_++)M.push(e.listSize[_].fValue),C.push(e.listSize[_].fSpread),"true"==e.listSize[_].strIsRandomise.valueOf()?S.push(!0):S.push(!1);else M.push(1),C.push(0),S.push(!1);var j=new Array,P=new Array,R=new Array;if(e.listAngle.length>0)for(_=0,x=e.listAngle.length;_<x;_++)j.push(e.listAngle[_].fValue),P.push(e.listAngle[_].fSpread),"true"==e.listAngle[_].strIsRandomise.valueOf()?S.push(!0):R.push(!1);else j.push(0),P.push(0),R.push(!1);var D={type:e.iDistribution,particleCount:e.iParticleCount,duration:e.fDuration<=0?void 0:e.fDuration,isStatic:h,isLookAtCamera:"true"==e.strIsLookAtCamera,isLookAtCameraOnlyY:"true"==e.strIsLookAtCameraOnlyY,activeMultiplier:e.fActiveMultiplier,direction:e.iDirection,maxAge:{value:e.maxAge.fValue,spread:e.maxAge.fSpread},position:{value:i,spread:r,spreadClamp:n,radius:e.position.fRadius,radiusScale:new THREE.Vector3(1,1,1),randomise:o},radius:{value:5,spread:0,scale:new THREE.Vector3(1,1,1),spreadClamp:new THREE.Vector3(2,2,2)},velocity:{value:s,spread:a,randomise:!1},acceleration:{value:l,spread:u,randomise:c},drag:{value:e.drag.fValue,spread:e.drag.fSpread},wiggle:{value:e.wiggle.fValue,spread:e.wiggle.fSpread},rotation:{axis:p,axisSpread:d,angle:e.rotation.fAngle,angleSpread:e.rotation.fAngleSpread,static:m,center:f,randomise:g},color:{value:v,spread:y,randomise:b},opacity:{value:E,spread:w,randomise:T},size:{value:M,spread:C,randomise:S},angle:{value:j,spread:P,randomise:R}},A=this.app.renderer.capabilities.maxVaryings;for(var k in A>15&&(D.trail={value:e.trail.fValue,spread:e.trail.fSpread,step:e.trail.fStep,stepSpread:e.trail.fStepSpread}),this._particleOptions){var O=this._particleOptions[k];Et.isNull(O)||(D[k]=O)}return D},t.prototype.parseGroupOptions=function(e,t){var i=this.app.calcRect(),r={texture:{value:t,frames:e.texture.vec2Frames,frameCount:e.texture.iFrameCount,loop:e.texture.iLoop},fixedTimeStep:e.fFixedTimeStep,hasPerspective:"true"==e.strHasPerspective,colorize:"true"==e.strIsColorize,blending:e.iBlendingMode,transparent:"true"==e.strIsTransparent,alphaTest:e.fAlphaTest,depthWrite:"true"==e.strIsDepthWrite,depthTest:"true"==e.strIsDepthTest,fog:"true"==e.strIsFog,scale:i.height/2,maxParticleCount:e.iMaxParticleCount,useMesh:"true"==e.strUseMesh},n=e.vec4Quaternion;for(var o in n&&(r.vec4Quaternion=new THREE.Quaternion(n.x,n.y,n.z,n.w)),this._groupOptions){var s=this._groupOptions[o];Et.isNull(s)||(r[o]=s)}return r},t.prototype.setupParticleEmitter=function(e,t,i){var r=this.parseEmitterOptions(e,t),n=new eu(r,null,i);i._emitters.push(n)},t.prototype.setupParticleEmitters=function(e,t){for(var i=0;i<e.listEmitters.length;i++){var r=e.listEmitters[i];this.setupParticleEmitter(r,e,t)}this.static&&this.node._synMatrixWorld()},t.prototype.createParticleGroup=function(e){return new tu(e,null,this)},t.prototype.setupParticleGroup=function(e,t){var i=this,r=new THREE.TextureLoader;r.setCrossOrigin("anonymous");var n=e.texture.url;return n.startsWith("http://")||n.startsWith("https://")||(n.startsWith(".")||(n="."+n),t&&(t.startsWith("http://")||t.startsWith("https://")||t.startsWith(".")||(t="."+t),n.startsWith(t)||(n=t.appendPath(n)))),new Promise((function(t,o){r.load(n,(function(r){var n=i.parseGroupOptions(e,r);if(n.useMesh){var o=new $l;o.bEnableLog=!1,o.init({strMeshUrl:e.strMeshUrl,params:e.arrayMeshParams},(function(t){n.bufferGeometry=t;var r=i.createParticleGroup(n);i.setupParticleEmitters(e,r)}))}else{var s=i.createParticleGroup(n);i.setupParticleEmitters(e,s)}t()}))}))},t.prototype.setupParticleData=function(e,t,i){var r=this,n=new Ll;(n=e).__proto__=Ll.prototype;for(var o=t.url||t.rootPath,s=[],a=0;a<n.listGroups.length;a++){var l=n.listGroups[a];s.push(this.setupParticleGroup(l,o))}Promise.all(s).then((function(){null!=i&&i(),r.refresh()}))},t.prototype.refresh=function(){for(var e=0;e<this._groups.length;e++){this._groups[e].refresh()}},t.prototype.setParticleAttribute=function(e,t){this._particleOptions[e]=t,this.refresh()},t.prototype.setGroupAttribute=function(e,t){this._groupOptions[e]=t,this.refresh()},o(t,[{key:"gravityPosition",set:function(e){var t=Et.parseVector3(e),i=Et.parseVector3(this.position),r=new THREE.Vector3;r.subVectors(t,i).normalize();var n=new THREE.Quaternion;n.setFromUnitVectors(new THREE.Vector3(0,-1,0),r);for(var o=0;o<this._groups.length;o++){var s=this._groups[o];s.options.vec4Quaternion=new THREE.Vector4(n.x,n.y,n.z,n.w),s.refresh()}}},{key:"speed",set:function(e){this._speed=e},get:function(){return this._speed}},{key:"groups",get:function(){return this._groups}}]),t}(Si),ru=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._scale=4,r._color="#FFFFFF",r._flowDirection=new THREE.Vector2(1,1),r._textureWidth=1024,r._textureHeight=1024,r._normalMaps=[],r._normalMapsURL=[],r.water=null,r}return s(t,e),t.prototype._updateByPoints=function(){if(this._points.length){this.app.resourceManager.remove(this.water);var e=this._createPolygonVertices(!0),t=this._createPolygonGeometry(e.vertices,e.faces),i=0;if(e.vertices.length){for(var r=0;r<e.vertices.length;r++)i+=e.vertices[r].z;i/=e.vertices.length}this.water=new THREE.Water(t,{color:this._color,scale:this._scale,flowDirection:this._flowDirection,textureWidth:this._textureWidth,textureHeight:this._textureHeight,normalMap0:this._normalMaps[0],normalMap1:this._normalMaps[1]}),this.water.position.y=i,this.water.scale.y*=-1,this.water.rotation.x=-.5*Math.PI,this.node.add(this.water)}},t.prototype._createByGeometry=function(){if(this.geometryInParam){this.app.resourceManager.remove(this.water);var e=this.geometryInParam;this.water=new THREE.Water(e,{color:this._color,scale:this._scale,flowDirection:this._flowDirection,textureWidth:this._textureWidth,textureHeight:this._textureHeight,normalMap0:this._normalMaps[0],normalMap1:this._normalMaps[1]}),this.node.add(this.water)}},t.prototype._setupTextures=function(e){for(var t=new THREE.TextureLoader,i=[e.normalMap0||"images/water/Water_1_M_Normal.jpg",e.normalMap1||"images/water/Water_2_M_Normal.jpg"],r=0;r<i.length;r++){var n=i[r];n&&(this._normalMapsURL.push(n),this._normalMaps.push(t.load(this.app.confirmURL(n))))}this._textureWidth=1024,this._textureHeight=1024},t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t),this._scale=Et.parseValue(t.waterScale,4),this._color=Et.parseColor(t.waterColor,"#FFFFFF"),this._flowDirection=Et.parseVector2(t.flowDirection,new THREE.Vector2(1,1)),this._setupTextures(t),t.geometry&&(this.geometryInParam=t.geometry,this._createByGeometry());var i=t.points;i&&this.addPoints(i)},t.prototype._afterSetupComplete=function(e){e.position||e.localPosition||this.useBottomCenterOfBoundingBoxAsPosition()},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);t.waterScale=this._scale,t.waterColor=this._color,t.flowDirection=this._flowDirection,t.points=this.points;for(var i=0;i<this._normalMapsURL.length;i++)t["normalMap"+i]=this._normalMapsURL[i];return t},t.prototype.setEffect=function(e){THING.Utils.warn("[Water] Please use '.style.setEffect()' to replace '.setEffect()'"),this.style.setEffect(e)},o(t,[{key:"isWater",get:function(){return!0}}]),t}(cl),nu=new THREE.Vector3,ou=new THREE.Vector3,su=new THREE.Matrix4,au=new THREE.Raycaster;au.params.Line.threshold=0;var lu=function(e){function t(i){n(this,t);var r=a(this,e.call(this));return r.geometry.addAttribute("position",new THREE.Float32BufferAttribute(new Array(24).fill(0),3)),r.geometry.addAttribute("color",new THREE.Float32BufferAttribute(new Array(24).fill(1),3)),r._camera=i,r}return s(t,e),t.prototype.update=function(e,t){var i=this;e.forEach((function(e,r){nu.set(e.x,e.y,1).applyMatrix4(su.getInverse(i._camera.projectionMatrix)),nu.setLength(Math.min(nu.length(),t[r])),i.geometry.getAttribute("position").setXYZ(2*r+1,nu.x,nu.y,nu.z)})),this.geometry.getAttribute("position").needsUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()},t}(THREE.LineSegments),uu=function(e){function t(i,r){n(this,t);var o=new THREE.BufferGeometry,s=new THREE.MeshBasicMaterial({color:61183,opacity:.1,transparent:!0,side:THREE.DoubleSide}),l=a(this,e.call(this,o,s));o.addAttribute("position",new THREE.Float32BufferAttribute(new Array(3*r).fill(0),3));for(var u=[],c=0;c<r-2;c++)u.push(0,c+1,c+2);return o.setIndex(u),l._camera=i,l}return s(t,e),t.prototype.update=function(e,t){var i=this;e.forEach((function(e,r){nu.set(e.x,e.y,1).applyMatrix4(su.getInverse(i._camera.projectionMatrix)),nu.setLength(Math.min(nu.length(),t[r])),i.geometry.getAttribute("position").setXYZ(r+1,nu.x,nu.y,nu.z)})),this.geometry.getAttribute("position").needsUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()},t}(THREE.Mesh),cu=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.tickable=!0,r._camera=new THREE.PerspectiveCamera(30,16/9,1,20),r._camera.matrixAutoUpdate=!1,r._cameraFrustum=new THREE.Frustum,r._cameraHelper=new THREE.CameraHelper(r._camera),r._cameraHelper.visible=!1,r._cameraHelper.matrix=new THREE.Matrix4,r._outMesh=new lu(r._camera),r._outMesh.material.color.setHex(16777215),r._outMesh.visible=!1,r._horizontalScanningNum=15,r._verticalScanningNum=20,r._innerPlanes=[],r.node.add(r._cameraHelper),r.node.add(r._outMesh),r._innerScanning=!1,r._innerCounter=0,r._scanning=!1,r._scanningObject=null,r._cache={outer:[],inner:[]},r._useCache=!1,r}return s(t,e),t.prototype._updateCameraMatrixAndFrustum=function(){var e=this._camera;e.matrixWorld.copy(this.node.matrixWorld),e.matrixWorldInverse.getInverse(this.node.matrixWorld),su.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._cameraFrustum.setFromProjectionMatrix(su)},t.prototype.customSetup=function(e){void 0!==e.fov&&(this._camera.fov=e.fov),void 0!==e.aspect&&(this._camera.aspect=e.aspect),void 0!==e.near&&(this._camera.near=e.near),void 0!==e.far&&(this._camera.far=e.far),void 0!==e.debug&&(this._cameraHelper.visible=e.debug),void 0!==e.outerColor&&this._outMesh.material.color.set(Et.parseColor(e.outerColor)),void 0!==e.innerScanning&&(this._innerScanning=!!e.innerScanning),void 0!==e.scanningNum&&(this._horizontalScanningNum=e.scanningNum[0],this._verticalScanningNum=e.scanningNum[1]),this._camera.updateProjectionMatrix(),this.node.updateMatrixWorld(!0),this._updateCameraMatrixAndFrustum()},t.prototype.update=function(t){return e.prototype.update.call(this,t),!this.visible||(this._updateCameraMatrixAndFrustum(),this._cameraHelper.visible&&this._cameraHelper.update(),this._scanning&&(this._innerCounter>this._verticalScanningNum?(this._scanning=!1,this._innerCounter=0,this._scanningObject=null,this._saveCache&&localStorage.setItem(this.name+"_scanning_data",JSON.stringify(this._cache))):(this._updateInnerPlane(this._innerCounter,this._scanningObject),this._innerCounter++)),this.static&&this.node._synMatrixWorld(),!0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.stop()},t.prototype.start=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t&&(this.node.updateMatrixWorld(!0),this._updateCameraMatrixAndFrustum()),this._useCache=r,this._saveCache=n,r){var o=localStorage.getItem(this.name+"_scanning_data");o&&(this._cache=JSON.parse(o,(function(e,t){return null===t?1/0:t})))}var s=[new THREE.Vector2(-1,1),new THREE.Vector2(-1,-1),new THREE.Vector2(1,-1),new THREE.Vector2(1,1)],a=void 0;return this._useCache&&this._cache.outer.length>0?a=this._cache.outer:(a=s.map((function(t){au.setFromCamera(t,i._camera);var r=au.intersectObjects(e.getNodes(),!0);return r[0]?r[0].distance:1/0})),this._cache.outer=a,this._saveCache&&localStorage.setItem(this.name+"_scanning_data",JSON.stringify(this._cache))),this._outMesh.update(s,a),this._outMesh.visible=!0,this._innerScanning&&(this._innerCounter=0,this._scanning=!0,this._scanningObject=e||this.app.query(".Ground")),a},t.prototype.pause=function(){this._scanning&&(this._scanning=!1,this._innerCounter=0,this._scanningObject=null)},t.prototype.stop=function(){this._outMesh.visible=!1;for(var e=0;e<=this._verticalScanningNum;e++)this._innerPlanes[e]&&(this._innerPlanes[e].visible=!1);this._scanning=!1,this._innerCounter=0,this._scanningObject=null},t.prototype._updateInnerPlane=function(e,t){for(var i=this,r=2*e/this._verticalScanningNum-1,n=[],o=0;o<=this._horizontalScanningNum;o++){var s=2*o/this._horizontalScanningNum-1;n.push(new THREE.Vector2(s,r))}var a=void 0;this._useCache&&this._cache.inner[e]?a=this._cache.inner[e]:(a=n.map((function(e){au.setFromCamera(e,i._camera);var r=au.intersectObjects(t.getNodes(),!0);return r[0]?r[0].distance:1/0})),this._cache.inner[e]=a),this._innerPlanes[e]||(this._innerPlanes[e]=new uu(this._camera,this._horizontalScanningNum+2),this.node.add(this._innerPlanes[e]),this._innerPlanes[e].visible=!1),this._innerPlanes[e].update(n,a),this._innerPlanes[e].visible=!0},t.prototype.test=function(e){var t=this,i=e.objects.filter((function(e){return t._cameraFrustum.intersectsBox(e.boundingBox.toBox())}));return i.filter((function(e){var r=nu.setFromMatrixPosition(t._camera.matrixWorld),n=e.boundingBox.toBox().getCenter(ou);au.set(r,n.sub(r).normalize());var o=au.intersectObjects(i.map((function(e){return e.node})),!0);return!!(o.length>0&&o[0].object.isChildOf(e.node))}))},t.prototype.testObject=function(e,i){var r=this,n=nu.setFromMatrixPosition(this._camera.matrixWorld),o=e.boundingBox.toBox().getCenter(ou);au.set(n,o.sub(n).normalize());var s=i.objects.filter((function(e){return r._cameraFrustum.intersectsBox(e.boundingBox.toBox())})),a=au.intersectObjects(s.map((function(e){return e.node})),!0);return a.length>0?a[0].object.isChildOf(e.node)?{state:t.VISIBLE,distance:a[0].distance,point:a[0].point}:{state:t.OBSCURED,distance:a[0].distance,point:a[0].point}:{state:t.OUT,distance:-1,point:null}},t.prototype._setNodeVisible=function(e){this.node.ensureVisible(e,this._autoSynVisible)},o(t,[{key:"fov",set:function(e){this._camera.fov=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.fov}},{key:"aspect",set:function(e){this._camera.aspect=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.aspect}},{key:"near",set:function(e){this._camera.near=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.near}},{key:"far",set:function(e){this._camera.far=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.far}}]),t}(Si);cu.OUT=0,cu.VISIBLE=1,cu.OBSCURED=2;var hu={showHelper:!1,ambientLight:{intensity:.4,color:16777215},hemisphereLight:{intensity:0,color:16777215,groundColor:2236962},mainLight:{shadow:!1,shadowQuality:"high",shadowBias:0,intensity:.5,color:16777215,alpha:30,beta:30,distance:0},secondaryLight:{shadow:!1,shadowQuality:"high",shadowBias:0,intensity:0,color:16777215,alpha:138,beta:0,distance:0},tertiaryLight:{shadow:!1,shadowQuality:"high",shadowBias:0,intensity:0,color:16777215,alpha:0,beta:0,distance:0}},pu={showHelper:!1,ambientLight:{intensity:0},hemisphereLight:{intensity:0},mainLight:{intensity:0},secondaryLight:{intensity:0},tertiaryLight:{intensity:0}},du=new THREE.Sphere,fu=new THREE.Vector3,mu=new THREE.Vector3,gu=new THREE.Matrix4,vu=new THREE.Matrix4;function yu(e,t){if(t==1/0)return e.getLocalBoundingBox().toBox();var i=e.query("*").filter((function(e){return!(e.getBoundingBox(!1,!0).radius>t)})),r=new THREE.Box3;i.forEach((function(e){r.union(e.getBoundingBox(!1,!0).toBox())}));var n=new THREE.Matrix4;return e.node.updateWorldMatrix(!0,!1),n.getInverse(e.node.matrixWorld),r.applyMatrix4(n),r}var bu=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.ambientLight=new THREE.AmbientLight,r.ambientLight.name="ambient_light",r.node.add(r.ambientLight),r.hemisphereLight=new THREE.HemisphereLight(16777215,2236962,1),r.hemisphereLight.name="hemisphere_light",r.node.add(r.hemisphereLight),r.mainLight=new THREE.DirectionalLight,r.mainLight.name="main_light",r.mainLight.helper=new THREE.DirectionalLightHelper(r.mainLight),r.mainLight.helper.matrix=r.mainLight.matrix,r.node.add(r.mainLight),r.node.add(r.mainLight.target),r.node.add(r.mainLight.helper),r.secondaryLight=new THREE.DirectionalLight,r.secondaryLight.name="secondary_light",r.secondaryLight.helper=new THREE.DirectionalLightHelper(r.secondaryLight),r.secondaryLight.helper.matrix=r.secondaryLight.matrix,r.node.add(r.secondaryLight),r.node.add(r.secondaryLight.target),r.node.add(r.secondaryLight.helper),r.tertiaryLight=new THREE.DirectionalLight,r.tertiaryLight.name="tertiary_light",r.tertiaryLight.helper=new THREE.DirectionalLightHelper(r.tertiaryLight),r.tertiaryLight.helper.matrix=r.tertiaryLight.matrix,r.node.add(r.tertiaryLight),r.node.add(r.tertiaryLight.target),r.node.add(r.tertiaryLight.helper),r._config=JSON.parse(JSON.stringify(hu)),r._shadowObjectMaxSize=500,r}return s(t,e),t.prototype.customSetup=function(e){var t={};for(var i in hu)e.hasOwnProperty(i)&&(t[i]=e[i]);this.setConfig(t),this.mainLight.helper.skipBoundingBox(!0),this.secondaryLight.helper.skipBoundingBox(!0),this.tertiaryLight.helper.skipBoundingBox(!0)},t.prototype.setConfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:JSON.parse(JSON.stringify(hu)),t=arguments[1];Et.mergeObject(this._config,e,!0);var i=this._config;this.node.updateMatrixWorld(!0);var r=fu.set(0,1,0).transformDirection(this.node.matrixWorld).normalize();if(this.ambientLight.intensity=i.ambientLight.intensity,this.ambientLight.color.set(Et.parseColor(i.ambientLight.color)),this.hemisphereLight.intensity=i.hemisphereLight.intensity,this.hemisphereLight.color.set(Et.parseColor(i.hemisphereLight.color)),this.hemisphereLight.groundColor.set(Et.parseColor(i.hemisphereLight.groundColor)),this.hemisphereLight.position.copy(r),this.app.isMobileDevice&&(i.mainLight.castShadow=!1,i.secondaryLight.castShadow=!1,i.tertiaryLight.castShadow=!1),!t){var n=this.parent?this.parent:this.app.root;t=i.mainLight.shadow||i.secondaryLight.shadow||i.tertiaryLight.shadow?yu(n,this._shadowObjectMaxSize):yu(n,1/0)}var o=t.getBoundingSphere(du);this._setDirectLight(this.mainLight,i.mainLight,o,i.showHelper,r),this._setDirectLight(this.secondaryLight,i.secondaryLight,o,i.showHelper,r),this._setDirectLight(this.tertiaryLight,i.tertiaryLight,o,i.showHelper,r),(this._config.mainLight.distance>0||this._config.secondaryLight.distance>0||this._config.tertiaryLight.distance>0)&&(this.tickable=!0),this.app.root.static&&this.node._synMatrixWorld(),this.app.needUpdate=!0},t.prototype.getConfig=function(){return this._config},t.prototype.setDistance=function(e,t,i){this._config.mainLight.distance=e||0,this._config.secondaryLight.distance=t||0,this._config.tertiaryLight.distance=i||0,(this._config.mainLight.distance>0||this._config.secondaryLight.distance>0||this._config.tertiaryLight.distance>0)&&(this.tickable=!0)},t.prototype.update=function(e){var t=this._config.mainLight.distance>0&&this._config.mainLight.intensity>0&&this._config.mainLight.shadow,i=this._config.secondaryLight.distance>0&&this._config.secondaryLight.intensity>0&&this._config.secondaryLight.shadow,r=this._config.tertiaryLight.distance>0&&this._config.tertiaryLight.intensity>0&&this._config.tertiaryLight.shadow;if(t||i||r){var n=this.app.renderCamera,o=fu.set(0,1,0).transformDirection(this.node.matrixWorld).normalize(),s=gu.multiplyMatrices(vu.getInverse(this.node.matrixWorld),n.matrixWorld);return t&&(Eu.setFromProjectionMatrix(n.projectionMatrix,this._config.mainLight.distance),Eu.getBoundingSphere(du,s),this._setDirectLight(this.mainLight,this._config.mainLight,du,this._config.showHelper,o)),i&&(Eu.setFromProjectionMatrix(n.projectionMatrix,this._config.secondaryLight.distance),Eu.getBoundingSphere(du,s),this._setDirectLight(this.secondaryLight,this._config.secondaryLight,du,this._config.showHelper,o)),r&&(Eu.setFromProjectionMatrix(n.projectionMatrix,this._config.tertiaryLight.distance),Eu.getBoundingSphere(du,s),this._setDirectLight(this.tertiaryLight,this._config.tertiaryLight,du,this._config.showHelper,o)),this.app.root.static&&this.node._synMatrixWorld(),!0}return!1},t.prototype._setDirectLight=function(e,t,i,r,n){if(e.intensity=t.intensity,e.visible=t.intensity>0,e.color.set(Et.parseColor(t.color)),e.position.copy(Et.parseVector3(THING.Math.directionFromAlphaBeta(t.alpha,t.beta))),e.position.normalize().multiplyScalar(i.radius||1).add(i.center),e.target.position.copy(i.center),e.helper.visible=e.visible&&r,e.helper.visible&&this._updateHelper(e),e.castShadow=t.shadow&&!this.app.isMobileDevice,e.castShadow){var o=i.radius,s=e.shadow.camera;s.top=s.right=o,s.bottom=s.left=-o,s.near=.1,s.far=2*o,s.updateProjectionMatrix(),s.up.copy(n);var a={low:512,medium:1024,high:2048,ultra:4096}[t.shadowQuality]||1024;e.shadow.bias=t.shadowBias,e.shadow.radius=.1,e.shadow.mapSize.x===a&&e.shadow.mapSize.y===a||(e.shadow.map&&(e.shadow.map.dispose(),e.shadow.map=null),e.shadow.mapSize.set(a,a))}},t.prototype._updateHelper=function(e){var t=e.helper;void 0!==t.color?(t.lightPlane.material.color.set(t.color),t.targetLine.material.color.set(t.color)):(t.lightPlane.material.color.copy(t.light.color),t.targetLine.material.color.copy(t.light.color)),gu.lookAt(mu.subVectors(e.target.position,e.position),new THREE.Vector3,new THREE.Vector3(0,1,0)),t.lightPlane.quaternion.setFromRotationMatrix(gu),t.targetLine.quaternion.setFromRotationMatrix(gu),t.targetLine.scale.z=mu.length()},t.prototype._setNodeVisible=function(e){this.node.ensureVisible(e,this._autoSynVisible)},o(t,[{key:"shadowObjectMaxSize",set:function(e){this._shadowObjectMaxSize!==e&&(this._shadowObjectMaxSize=e,this.setConfig({}))},get:function(){return this._shadowObjectMaxSize}}]),t}(Si),_u=new THREE.Matrix4,xu=new THREE.Box3,Eu=new(function(){function e(t){n(this,e),t=t||{},this.vertices={near:[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],far:[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]},void 0!==t.projectionMatrix&&this.setFromProjectionMatrix(t.projectionMatrix,t.maxFar||1e4)}return e.prototype.setFromProjectionMatrix=function(e,t){var i=0===e.elements[11];return _u.getInverse(e),this.vertices.near[0].set(1,1,-1),this.vertices.near[1].set(1,-1,-1),this.vertices.near[2].set(-1,-1,-1),this.vertices.near[3].set(-1,1,-1),this.vertices.near.forEach((function(e){e.applyMatrix4(_u)})),this.vertices.far[0].set(1,1,1),this.vertices.far[1].set(1,-1,1),this.vertices.far[2].set(-1,-1,1),this.vertices.far[3].set(-1,1,1),this.vertices.far.forEach((function(e){e.applyMatrix4(_u);var r=Math.abs(e.z);i?e.z*=Math.min(t/r,1):e.multiplyScalar(Math.min(t/r,1))})),this.vertices},e.prototype.getBoundingSphere=function(e,t){return xu.makeEmpty(),this.vertices.near.forEach((function(e){xu.expandByPoint(e)})),this.vertices.far.forEach((function(e){xu.expandByPoint(e)})),xu.getBoundingSphere(e),t&&e.applyMatrix4(t),e},e}()),wu=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._intensity=1,r._castShadow=!1,r._light=null,r}return s(t,e),t.prototype._syn=function(){},t.prototype.customSetup=function(e){this._intensity=e.intensity||1,this._castShadow=e.castShadow||!1},t.prototype.toJSON=function(){return e.prototype.toJSON.call(this)},o(t,[{key:"intensity",set:function(e){this._intensity=e,this._syn()},get:function(){return this._intensity}},{key:"castShadow",set:function(e){this._castShadow=e,this._syn()},get:function(){return this._castShadow}},{key:"lightColor",set:function(e){var t=Et.parseColor(e);t&&(this._light.color=t)},get:function(){return this._light.color.toHexString()}},{key:"shadowBias",set:function(e){this._light.shadow.bias=e},get:function(){return this._light.shadow.bias}}]),t}(Si),Tu=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._lightAngle=30,r._distance=5,r._penumbra=.5,r._helper=null,r}return s(t,e),t.prototype.destroy=function(){this._helper&&this._helper.dispose(),e.prototype.destroy.call(this)},t.prototype._syn=function(){this._light.angle=THING.Math.degToRad(this._lightAngle),this._light.intensity=this.intensity,this._light.penumbra=this.penumbra,this._light.castShadow=this.castShadow,this._light.distance=this.distance},t.prototype._afterSetupComplete=function(e){var t=e.centerNodeName;t&&(this.centerNodeName=t),this._lightAngle=e.lightAngle||this._lightAngle,this._distance=e.distance||this._distance,this._penumbra=e.penumbra||this._penumbra;var i=e.projectTexture;this._light=i?new THREE.ProjectSpotLight:new THREE.SpotLight("#FFFFFF"),this._light.position.set(0,0,0),this._light.target.position.set(0,0,1),this.node.add(this._light),this.node.add(this._light.target);var r=e.target;r&&this.lookAt(r);var n=e.helper;n&&(this.helper=n),this._syn()},t.prototype._updateLightHelper=function(){var e=this._light.distance?this._light.distance:1e3,t=e*Math.tan(this._light.angle);this._helper.cone.scale.set(t,t,e),this._helper.cone.material.color.copy(this._light.color)},t.prototype.update=function(t){var i=e.prototype.update.call(this,t);return this._helper?(this._updateLightHelper(),!0):i},o(t,[{key:"lightAngle",set:function(e){this._lightAngle=e,this._syn()},get:function(){return this._lightAngle}},{key:"distance",set:function(e){this._distance=e,this._syn()},get:function(){return this._distance}},{key:"penumbra",set:function(e){this._penumbra=e,this._syn()},get:function(){return this._penumbra}},{key:"helper",set:function(e){e&&!this._helper?(this._helper=new THREE.SpotLightHelper(this._light),this._helper.matrix=this._light.matrix,this._helper.cone.quaternion.set(0,0,0,1),this.node.add(this._helper),this.tickable=!0):!e&&this._helper&&(this.node.remove(this._helper),this._helper.dispose(),this._helper=null)},get:function(){return!!this._helper}}]),t}(wu),Mu=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._distance=0,r._decay=2,r._helper=null,r}return s(t,e),t.prototype.destroy=function(){this._helper&&this._helper.dispose(),e.prototype.destroy.call(this)},t.prototype._syn=function(){this._light.intensity=this.intensity,this._light.castShadow=this.castShadow,this._light.distance=this.distance,this._light.shadow.camera.far=this.distance,this._light.decay=this._decay},t.prototype._afterSetupComplete=function(e){this._distance=e.distance||this._distance,this._decay=e.decay||this._decay,this._light=new THREE.PointLight("#FFFFFF"),this._light.position.set(0,0,0),this.node.add(this._light);var t=e.helper;t&&(this.helper=t),this._syn()},t.prototype._updateLightHelper=function(){this._helper.update()},t.prototype.update=function(t){var i=e.prototype.update.call(this,t);return this._helper?(this._updateLightHelper(),!0):i},o(t,[{key:"distance",set:function(e){this._distance=e,this._syn()},get:function(){return this._distance}},{key:"decay",set:function(e){this._decay=e,this._syn()},get:function(){return this._decay}},{key:"helper",set:function(e){e&&!this._helper?(this._helper=new THREE.PointLightHelper(this._light,1),this._helper.matrix=this._light.matrix,this.node.add(this._helper),this.tickable=!0):!e&&this._helper&&(this.node.remove(this._helper),this._helper.dispose(),this._helper=null)},get:function(){return!!this._helper}}]),t}(wu),Cu=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._image="",r._texture=null,r._width=10,r._scrollSpeed=0,r._uStep=0,r._resolution=new THREE.Vector2,r._updateResolutionFunc=r._updateResolution.bind(r),r._helpGeometry=new THREE.Geometry,r._meshline=new THREE.MeshLine,r._material=null,r._repeatX=1,r._offsetX=0,r._uvTransform=new THREE.Matrix3,r._synUvTransform(),r}return s(t,e),t.prototype._synUvTransform=function(){this._uvTransform.setUvTransform(this._offsetX,0,this._repeatX,1,0,0,0)},t.prototype._updateResolution=function(e){this._resolution.set(e.size[0],e.size[1])},t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t);var i=t.image;i&&(i.isTexture?(this._image=i.name,this._texture=i):(this._image=i,this._texture=this.app.resourceManager.loadTexture(i,void 0,{repeat:!0,anisotropy:16}))),this._uStep=t.uStep||this._uStep;var r=t.points;r&&this.addPoints(r),this._width=t.width||this._width,this.uvRatio=t.uvRatio||1,this.scrollSpeed=t.scrollSpeed||this._scrollSpeed;var n=this.app.calcRect();this._resolution.set(n.width,n.height),this._material=new THREE.MeshLineMaterial({map:this._texture,useMap:!!this._texture,color:new THREE.Color(1,1,1),opacity:1,resolution:this._resolution,sizeAttenuation:!1,lineWidth:this._width,near:this.app.renderCamera.near,far:this.app.renderCamera.far,side:THREE.DoubleSide}),this._material.extensions.derivatives=!this.app.renderer.capabilities.isWebGL2,this._material.uniforms.uvTransform={type:"m3",value:this._uvTransform},this.app.on("resize",this._updateResolutionFunc);var o=new THREE.Mesh(this._meshline.geometry,this._material);this.node.add(o)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.app.off("resize",this._updateResolutionFunc)},t.prototype.update=function(t){var i=e.prototype.update.call(this,t);return this._material?(0!==this._scrollSpeed&&(this._offsetX+=this._scrollSpeed*t,this._synUvTransform()),!0):i},t.prototype._updateByPoints=function(){this._helpGeometry.vertices=this._points.map((function(e){return(new THREE.Vector3).fromArray(e)})),this._meshline.setGeometry(this._helpGeometry,void 0,this._uStep)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.image=this._image,t.scrollSpeed=this._scrollSpeed,t.points=this.points,t},o(t,[{key:"uvRatio",set:function(e){this._repeatX=e,this._synUvTransform()}},{key:"width",set:function(e){this._width=e,this._material&&(this._material.uniforms.lineWidth.value=e)},get:function(){return this._width}},{key:"scrollSpeed",set:function(e){this._scrollSpeed=THING.Math.clamp(e,-99,99),this.tickable=0!==this._scrollSpeed},get:function(){return this._scrollSpeed}}]),t}(cl);var Su=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._height=10,r._geometry=new THREE.Geometry,r._material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0}),r._material.uvTransform=new THREE.Matrix3,r._scrollSpeed=[0,0],r._uvRepeat=[1,1],r._uvOffset=[0,0],r._uvRotation=0,r}return s(t,e),t.prototype.setScroll=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._scrollSpeed=[e,t],this.tickable=!0},t.prototype._synUvTransform=function(){this._material.uvTransform||(this._material.uvTransform=new THREE.Matrix3),this._material.uvTransform.setUvTransform(this._uvOffset[0],this._uvOffset[1],this._uvRepeat[0],this._uvRepeat[1],this._uvRotation,0,0)},t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t),this._height=t.height||this._height;var i=t.points;i&&this.addPoints(i),this.color=t.color||16777215,this.scroll=t.scroll||!1;var r=new THREE.Mesh(this._geometry,this._material);this.node.add(r),t.image?this._material.map=this.app.resourceManager.loadTexture(t.image,void 0,{repeat:!0}):this._material.map=function(){for(var e=new Uint8Array(512),t=0;t<128;t++)e[4*t+0]=255,e[4*t+1]=255,e[4*t+2]=255,e[4*t+3]=255*(1-t/128);var i=new THREE.DataTexture(e,1,128,THREE.RGBAFormat);return i.needsUpdate=!0,i}()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.app.off("resize",this._updateResolutionFunc)},t.prototype.update=function(t){var i=e.prototype.update.call(this,t);return 0!==this._scrollSpeed[0]||0!==this._scrollSpeed[1]?(this._uvOffset[0]+=this._scrollSpeed[0]*t,this._uvOffset[1]+=this._scrollSpeed[1]*t,this._synUvTransform(),!0):i},t.prototype._updateByPoints=function(){var e=this,t=[],i=[],r=[],n=[],o=void 0,s=void 0,a=new THREE.Vector3,l=0;this._points.forEach((function(r,n){o=(new THREE.Vector3).fromArray(r),(s=(new THREE.Vector3).fromArray(r)).y+=e._height,i.push(o,s),n>0&&(l+=o.distanceTo(a)),t.push(new THREE.Vector2(l/e._height,0),new THREE.Vector2(l/e._height,1)),a.copy(o)}));for(var u=0;u<i.length-2;u+=2)r.push(new THREE.Face3(u+1,u+0,u+2)),r.push(new THREE.Face3(u+2,u+3,u+1)),n.push([t[u+1],t[u+0],t[u+2]]),n.push([t[u+2],t[u+3],t[u+1]]);this._geometry.vertices=i,this._geometry.faces=r,this._geometry.faceVertexUvs=[n],this._geometry.verticesNeedUpdate=!0,this._geometry.uvsNeedUpdate=!0,this._geometry.elementsNeedUpdate=!0,this._geometry.computeBoundingSphere(),this._geometry.computeFaceNormals()},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.height=this._height,t.points=this.points,t},o(t,[{key:"height",set:function(e){this._height=e,this._updateByPoints()},get:function(){return this._height}},{key:"color",set:function(e){this._material.color.setHex(e)},get:function(){return this._material.color.getHex()}},{key:"imageRepeat",set:function(e){this._uvRepeat[0]=e[0],this._uvRepeat[1]=e[1],this._synUvTransform()},get:function(){return this._uvRepeat.slice(0)}}]),t}(cl),ju=new THREE.Vector3,Pu=function(){function e(t,i,r){n(this,e),this.object=null,this.useSpriteMaterial=t,this.node=i,this.domElement=r,this.cssObject=null,this.pivotObject=null}return e.fixCSS3DOffset=function(e,t){return[Math.round(1.5*e),Math.round(1.5*t)]},e.prototype.onUpdate=function(t){var i=this.node,r=this.cssObject;i.updateMatrixWorld();var n=new THREE.Vector3,o=new THREE.Vector3,s=new THREE.Quaternion;i.matrixWorld.decompose(n,s,o),this.pivotObject.position.copy(n);var a=new THREE.Vector3;this.object._independentWorldScale?a=this.object._independentWorldScale.clone():this.object.node.getWorldScale(a);var l=i.userData.cssFactor||1;this.cssObject.scale.copy(a),this.cssObject.scale.multiplyScalar(l/30);var u=this.object.pivot;if(u){var c=this.domElement.scrollWidth;this.domElement.threeDHeight&&this.domElement.onAppended&&this.domElement.scrollHeight!=this.domElement.threeDHeight.slice(0,-2)-0&&this.domElement.onAppended(),this.domElement.threeDHeight=this.domElement.scrollHeight+"px";var h,p,d=this.domElement.threeDHeight.slice(0,-2)-0,f=c*this.cssObject.scale.x,m=d*this.cssObject.scale.y,g=Math.round((.5-u[0])*f),v=Math.round((u[1]-.5)*m),y=e.fixCSS3DOffset(g,v);y?(h=y[0],p=y[1]):(h=g,p=v),this.object._useSpriteMaterial?(r.quaternion.copy(s),this.domElement.cacheLeft!=h&&(this.domElement.cacheLeft=h,this.domElement.style.left=h+"px"),this.domElement.cacheTop!=p&&(this.domElement.cacheTop=p,this.domElement.style.top=p+"px")):(this.pivotObject.quaternion.copy(s),r.position.x=h,r.position.y=p,r.position.z=0),f&&m&&(this.scaledWidth==f&&this.scaledHeight==m||(this.scaledWidth=f,this.scaledHeight=m,this.node.getWorldScale(ju),this.node.userData.boundingBoxSize=[f/ju.x,m/ju.y,1],this.object.dirty=!0),this.pivotLeft==h&&this.pivotTop==p||(this.pivotLeft=h,this.pivotTop=p,this.node.userData.boundingBoxPivot=[.5+h/f,.5+p/m,0],this.object.dirty=!0))}return this.onVisible(this.object.node.ensureVisible()),!0},e.prototype.onAdd=function(e){this.object=e,this.pivotObject=new THREE.Object3D,this.useSpriteMaterial?this.cssObject=new THREE.CSS3DSprite(this.domElement):this.cssObject=new THREE.CSS3DObject(this.domElement),this.pivotObject.add(this.cssObject),this.object.app.cssScene.add(this.pivotObject),this.onUpdate(),this.object.tickable=!0},e.prototype.onRemove=function(){this.pivotObject&&(this.object.app.cssScene.remove(this.pivotObject),this.cssObject&&(this.pivotObject.remove(this.cssObject),this.cssObject=null),this.pivotObject=null),this.object=null},e.prototype.onVisible=function(e){this.cssObject.visible=e;var t=this.domElement.style;e?"visible"!=t.visibility&&(t.visibility="visible"):"hidden"!=t.visibility&&(t.visibility="hidden")},e}(),Ru=new THREE.Vector3,Du=new THREE.Vector3,Au=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._useShadow=!1,r._line=null,r._lineOffset=[0,0,0],r._factor=.01,r._initialSize=[1,1],r._size=[1,1],r._pivot=[.5,.5],r._useScaleMode=!1,r._useSpriteMaterial=!0,r._sizeAttenuation=!0,r._element=null,r._planeSprite=null,r._sprite=null,r._canvas=null,r._url="",r}return s(t,e),t.prototype.updateConnectionLine=function(){if(!this._line)return!1;if(!this.parent)return!1;var e=THING.Math.addVector(this._lineOffset,this.position),t=this._lineToObject?this._lineToObject.position:this._lineToPosition;return this._line.setPoint(0,e),this._line.setPoint(1,t),!0},t.prototype._setupMaterial=function(e){var t=e.canvas,i=e.image,r=e.url;t?this.setCanvas(t):i?this.setImage(i):void 0!==r&&(this._url=r)},t.prototype._setupSprite=function(e){var t=this;this.loaded=!1,this._useSpriteMaterial=Et.parseValue(e.useSpriteMaterial,this._useSpriteMaterial);var i=e.element;if(i){var r=i.cloneNode(!0),n=Et.parseSize(e),o=this.app.events,s={};Object.defineProperties(s,{pickedObj:{get:function(){return this.object}}});var a=function(e,t){e.button=t.button,e.buttons=t.buttons,e.altKey=t.altKey,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey},l={picked:!1,x:0,y:0};this._element=r,this._element.onmousedown=function(e){!1!==t.app.picker.setPickedObject(t,s)&&Et.timer.setTimeout((function(){o.skipFrameCount=t.app.currentFrameCount,l.picked=!0,l.x=e.x,l.y=e.y}))},this._element.onmouseup=function(e){!1!==t.app.picker.setPickedObject(t,s)&&l.picked&&(l.picked=!1,Et.timer.setTimeout((function(){THING.Math.getDistance([l.x,l.y],[e.x,e.y])>1||(o.skipFrameCount=t.app.currentFrameCount+1,a(s,e),s.object.trigger("singleclick",s),t.app.trigger("singleclick",s),t.app.events.clearSingleClickTimer())})))},this._element.onclick=function(e){!1!==t.app.picker.setPickedObject(t,s)&&Et.timer.setTimeout((function(){o.skipFrameCount=t.app.currentFrameCount,a(s,e),s.object.trigger("click",s),t.app.trigger("click",s)}))},this._element.ondblclick=function(e){!1!==t.app.picker.setPickedObject(t,s)&&Et.timer.setTimeout((function(){o.skipFrameCount=t.app.currentFrameCount,a(s,e),s.object.trigger("dblclick",s),t.app.trigger("dblclick",s)}))},this._element.onmousemove=function(e){0==e.buttons&&e.stopPropagation(),t.app.picker.setPickedObject(t,s)&&Et.timer.setTimeout((function(){o.skipFrameCount=t.app.currentFrameCount,a(s,e),s.object.trigger("mousemove",s),t.app.trigger("mousemove",s)}))},this._element.onmouseenter=function(e){t.app.setCurrentHTMLMarker(t),t.app.picker.setPickedObject(t,s)&&Et.timer.setTimeout((function(){o.skipFrameCount=t.app.currentFrameCount,a(s,e),s.object.trigger("mouseenter",s),t.app.trigger("mouseenter",s)}))},this._element.onmouseleave=function(e){t.app.setCurrentHTMLMarker(null);var i=s.object;i&&Et.timer.setTimeout((function(){o.skipFrameCount=t.app.currentFrameCount,a(s,e),i.trigger("mouseleave",s),t.app.trigger("mouseleave",s)}))},this._element.style.pointerEvents="auto",this._element.style.cursor="default";var u=new THREE.SpriteMaterial({colorWrite:!1,depthWrite:!1,transparent:!0});this._planeSprite=new THREE.Sprite(u),this._planeSprite.userData.cssFactor=n[0],this._planeSprite.userData.skipOutline=!0,this._planeSprite.userData.skipStyle=!0,this._planeSprite.userData.skipPick=!0,this.node.add(this._planeSprite),this.element3DObjectControl=new Pu(this._useSpriteMaterial,this._planeSprite,r),this.addControl(this.element3DObjectControl),this.loaded=!0}else{var c=void 0;this.bindParams=e,e.loadTextureComplete=function(t){var i=t.material,r=(i._userData||{}).bindMarkers;r&&r.forEach((function(t){t._updateSpriteTexture(i.map),t.synSize(e),t.node.getMaterials().forEach((function(e){e.visible=!0})),t.loaded=!0,t.calledComplete||(t.update(),t._callComplete(t.bindParams)),c&&c(t),delete t.bindParams})),i._userData={}};var h=this.app.spriteResource.getMaterial(e);if((u=h.material)._userData=u._userData||{},u._userData.bindMarkers=u._userData.bindMarkers||[],u._userData.bindMarkers.push(this),u.isSpriteMaterial)this._sprite=new THREE.Sprite(u);else{var p=new THREE.PlaneGeometry(this._size[0],this._size[1]);this._sprite=new THREE.Mesh(p,u)}if(h.needLoadTexture){var d=Et.parseValue(e.visible,!0);d&&(this._sprite.setLayerVisible(!1),c=function(e){Et.timer.setTimeout((function(){e._sprite.setLayerVisible(d),e.dirty=!0}),10)})}this._sprite.renderOrder=1,this._sprite.userData.skipOutline=!0,this._setupMaterial(e),this.node.add(this._sprite),this.synSize(e)}this.dirty=!0},t.prototype._setupLineNode=function(e){if(this._lineToPosition=e.lineToPosition,this._lineToObject=e.lineToObject,void 0!==this._lineToPosition||void 0!==this._lineToObject){var t=e.lineColor,i=this._lineToObject?this._lineToObject.position:this._lineToPosition;this._line=this.app.create({type:"Line",parent:this,points:[this.position,i],color:t,style:{lineOpacity:e.lineOpacity,lineDashSize:e.lineDashSize,lineGapSize:e.lineGapSize,lineWidth:e.lineWidth}}),this.tickable=!0}},t.prototype._setupLocalPosition=function(e){var t=this.parent;if(t){var i=(e.offset||e.localPosition||[0,0,0]).concat();if(!Et.parseValue(e.ignoreParentBoundingBox,!1)){var r=t.getOrientedBox(!1),n=this.worldToLocal(r.center);i[0]+=n[0],i[1]+=n[1]+r.size[1]/2,i[2]+=n[2]}var o=Et.parseValue(e.ignoreParentScale,!1);this.setLocalPosition(i,o)}},t.prototype.customSetup=function(e){var t=this;this._sizeAttenuation=Et.parseValue(e.sizeAttenuation,!0),this.setupTranslation(e),e.skipSetupTranslation=!0,this._setupSprite(e),this._setupLineNode(e),e.width&&e.height?this._useScaleMode=!1:this._useScaleMode=!0,this._factor=e.factor||this._factor,this._initialSize=Et.parseSize(e),this._size=this._initialSize.concat();var i=e.pivot;i&&(this.pivot=i),this.one("load",(function(i){var r=e.pivotPixel;r&&(t.pivotPixel=r),t._useSpriteMaterial||t.node.getMaterials().forEach((function(e){e.envMap=null,e.needsUpdate=!0})),t.node.traverse((function(e){e.userData.skipEnvMap=!0}))})),this.synSize(e),this._sizeAttenuation||this._sprite.skipBoundingBox(!0)},t.prototype._updatePivot=function(e){if(this._sprite&&!this._sprite.isSprite){Du.set(.5-e[0],e[1]-.5,0);var t=this.node.userData.boundingBoxSize;this.node.userData.boundingBoxSize=null,this.node.userData.boundingBoxPivot=null;var i=this.getLocalBoundingBox(!1,!1),r=i.toBox(),n=r.min,o=r.max,s=i.size;t&&(s[0]==t[0]&&s[1]==t[1]&&s[2]==t[2]||(this.dirty=!0)),this.node.userData.boundingBoxSize=s,this.node.userData.boundingBoxPivot=[e[0],e[1],.5],Ru.x=(o.x-n.x)*Du.x,Ru.y=(o.y-n.y)*Du.y,Ru.z=0,this.node.localToWorld(Ru),this._sprite._setWorldPosition(Ru)}},t.prototype._afterSetupComplete=function(e){var t=e.alwaysOnTop;t&&(this.style.alwaysOnTop=t)},t.prototype._notifyCompleteEvent=function(e){var t=this;Et.timer.setTimeout((function(){t.trigger("load",{object:t}),t.trigger("complete",{object:t})}),1)},t.prototype._callComplete=function(t){var i=this.pivot;.5==i[0]&&.5==i[1]||this._updatePivot(i),""!==this._url?this.image||this.canvas?(this.calledComplete=!0,e.prototype._callComplete.call(this,t)):this.loaded=!1:(this.calledComplete=!0,e.prototype._callComplete.call(this,t))},t.prototype._updateSpriteTexture=function(e,t){return t&&(this._sprite.material=this._sprite.material.clone()),this.app.picker.removePickingResources(this._sprite),this._sprite.material.map=e,this._sprite.material.needsUpdate=!0,this.loaded=!0,this.dirty=!0,this._sprite.material},t.prototype.destroy=function(){if(this.app.getCurrentHTMLMarker()==this&&this.app.setCurrentHTMLMarker(null),this.app.spriteResource.unload(this.url),this._sprite){var t=this._sprite.material;if(t&&t._userData){var i=t._userData.bindMarkers;if(i){var r=i.indexOf(this);-1!==r&&i.splice(r,1)}}}e.prototype.destroy.call(this)},t.prototype.update=function(t){var i=e.prototype.update.call(this,t);return i|=this.updateConnectionLine()},t.prototype.synSize=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._sprite){if(this._useScaleMode){var t=e.texture||this._sprite.material.map;if(t){var i=t.image;i&&(this._size[0]=this._factor*i.width*this._initialSize[0],this._size[1]=this._factor*i.height*this._initialSize[1])}}}else this._planeSprite&&(this._planeSprite.userData.cssFactor=this._size[0]);if(this._keepSize){var r=this.getControl("SizeAdjustmentControl");r&&(r.size=this._size)}else this._sprite&&(this._sprite.scale.set(this._size[0],this._size[1],1),this.synIndependentWorldScale(!0,e.inheritScale));this.static&&this.node._synMatrixWorld()},t.prototype._getIndependentControlRenderNode=function(){return this._sprite?this._sprite:e.prototype._getIndependentControlRenderNode.call(this)},t.prototype.cloneSelf=function(e){return e.localPosition=this.localPosition,e.size=this.size,this.url?e.url=this.url:this.canvas?e.canvas=this.canvas.clone():this.image&&(e.image=this.image.clone()),this.app.create(e)},t.prototype._updateCanvas=function(e){if(!e)return!1;var t=this._sprite;if(!t)return!1;var i=t.material;if(!i)return!1;var r=i.map;return!!r&&(r.image=e,r.needsUpdate=!0,this._canvas=e,this.synSize(),!0)},t.prototype.setCanvas=function(e){if(e&&this._sprite){this._url="",this._canvas=e;var t=new THREE.Texture(e);t.needsUpdate=!0,this._updateSpriteTexture(t)}},t.prototype.setUrl=function(e){if(e){this.url&&this.app.spriteResource.unload(this.url),this._canvas=null,this._url=e;var t=this,i={url:e,alwaysOnTop:this.style.alwaysOnTop,useSpriteMaterial:this._useSpriteMaterial,loadTextureComplete:function(e){t.synSize({texture:e.material.map})},loadComplete:function(e){t._updateSpriteTexture(e.material.map,!0).visible=!0,t.trigger("urlchange",{image:e.material.map.image})}},r=this.app.spriteResource.getMaterial(i);if(r){var n=this._updateSpriteTexture(r.material.map,!0);r.needLoadTexture&&(n.visible=!1),this.synSize()}}},t.prototype.setImage=function(e){e&&(e.width&&e.height?(this._url="",this._updateSpriteTexture(this.app.resourceManager.loadTexture(e),!0),this.synSize()):THING.Utils.error("[Marker] set image failed, please make sure image has width and height attribute"))},t.prototype._setScale=function(t){var i=THING.Math.scaleVector(t,[this._size[0],this._size[1],1]);i=THING.Math.divideVector(i,this.node.scale.toArray()),e.prototype._setScale.call(this,i)},t.prototype._getScale=function(){var t=e.prototype._getScale.call(this),i=THING.Math.divideVector(t,[this._size[0],this._size[1],1]);return i=THING.Math.scaleVector(this.node.scale.toArray(),i)},t.prototype.setPivot=function(e){if(e&&(Et.isNull(e[0])||Et.isNull(e[1])))THING.Utils.error("set pivot failed, due to value is not a number array");else{this._pivot=e;var t=this._sprite;if(t&&t.isSprite)e?t.center.set(e[0],1-e[1]):t.center.set(.5,.5);else if(!this.domElement)if(e){var i=this;this.on("update",(function(){i._updatePivot(e)}),"Update-Marker-Pivot"),this._updatePivot(e),this.tickable=!0}else this.off("update",null,"Update-Marker-Pivot"),this.tickable=!1,this._sprite&&this._sprite.position.set(0,0,0);this.dirty=!0}},t.prototype.getPivot=function(){return this._pivot},t.prototype._updateKeepSize=function(t,i){var r=this._sizeAttenuation?60:960;e.prototype._updateKeepSize.call(this,t,this._sprite,this._size,r)&&this.synSize()},o(t,[{key:"isMarker",get:function(){return!0}},{key:"canvas",set:function(e){this.setCanvas(e)},get:function(){return this._canvas}},{key:"url",set:function(e){this._url!=e&&this.setUrl(e)},get:function(){return this._url}},{key:"image",set:function(e){this.setImage(e)},get:function(){var e=this._sprite;if(!e)return null;var t=e.material;if(!t)return null;var i=t.map;return i?i.image:null}},{key:"texture",set:function(e){e&&(e.isTexture?(this._updateSpriteTexture(e,!0),this.synSize()):THING.Utils.error("[Marker] set texture failed, please make sure provide THREE.Texture as value"))}},{key:"sizeAttenuation",get:function(){return this._sizeAttenuation}},{key:"size",set:function(e){Et.isNumber(e)?(this._size[0]=e,this._size[1]=e):this._size=e,this._initialSize=this._size.concat(),this.synSize()},get:function(){return this._size}},{key:"width",set:function(e){this._initialSize[0]=e,this._size[0]=e,this._useScaleMode=!1,this.synSize()},get:function(){return this._size[0]}},{key:"height",set:function(e){this._initialSize[1]=e,this._size[1]=e,this._useScaleMode=!1,this.synSize()},get:function(){return this._size[1]}},{key:"loaded",get:function(){return!!(this.image||this.canvas||this.element)&&e.prototype.loaded},set:function(t){e.prototype.loaded=t,t&&(this.style._syn(),this.style.hasUVAnimation()&&this.style.setUVAnimation(this.style.getUVAnimation()))}},{key:"factor",set:function(e){this._factor=e,this.synSize()},get:function(){return this._factor}},{key:"element",get:function(){return this._element}},{key:"line",get:function(){return this._line}},{key:"lineOffset",set:function(e){var t=Et.parseValue(e,[0,0,0]);this._lineOffset=t.concat()},get:function(){return this._lineOffset.concat()}},{key:"pivot",set:function(e){this.setPivot(e)},get:function(){return this.getPivot()}},{key:"pivotPixel",set:function(e){var t=this,i=0,r=0,n=this.image,o=this.element;n?(i=n.width,r=n.height):o&&(i=o.scrollWidth,r=o.scrollHeight),i&&r?this.pivot=[e[0]/i,e[1]/r]:o&&(o.onAppended=function(){t.pivotPixel=e})},get:function(){var e=this.pivot;if(!e)return null;var t=0,i=0,r=this.image,n=this.element;return r?(t=r.width,i=r.height):n&&(t=n.scrollWidth,i=n.scrollHeight),t&&i?[Math.floor(e[0]*t),Math.floor(e[1]*i)]:null}},{key:"domElement",get:function(){return this.element}}]),t}(Si),ku=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r.mixerPlane=null,r.domWidth=0,r.domHeight=0,r}return s(t,e),t.prototype._setupFromElement=function(e){var t=e.domElement;if(t){var i=e.position||[0,0,0],r=Et.parseSize(e),n=Et.parseQuaternion(e.angles),o=e.domWidth||t.offsetWidth,s=e.domHeight||t.offsetHeight,a={};return o&&s&&(a.elementW=o,a.planeW=1,a.planeH=s/o),this.mixerPlane=new THREEx.HtmlMixer.Plane(this.app.webViewManager.mixerContext,t,a),this.mixerPlane.setDomElement(t),this.node=this.mixerPlane.object3d,this.node.scale.multiply(new THREE.Vector3(r[0],r[1],1)),this.node.position.x=i[0],this.node.position.y=i[1],this.node.position.z=i[2],n&&this.node.quaternion.copy(n),this.node.updateMatrix(),!0}return!1},t.prototype.setupFromURL=function(e){var t=e.url;if(t){var i=e.domWidth,r=e.domHeight;i=i||e.width?100*e.width:0,r=r||e.height?100*e.height:0,e.domWidth=e.domWidth||i,e.domHeight=e.domHeight||r,this.domWidth=e.domWidth,this.domHeight=e.domHeight,i=i?i+"px":"",r=r?r+"px":"";var n=document.createElement("iframe");n.src=t,n.style.border="none",n.style.width=i,n.style.height=r,e.domElement=n,this._setupFromElement(e)}this._setup(e)},t.prototype.setupFromDom=function(e){this._setupFromElement(e),this._setup(e)},t.prototype._setNodeVisible=function(t){if(e.prototype._setNodeVisible.call(this,t),this.mixerPlane){var i=this.mixerPlane.domElement;i&&(i.style.visibility=t?"visible":"hidden")}},o(t,[{key:"isWebView",get:function(){return!0}},{key:"url",set:function(e){var t=this.position,i=this.scale,r=this.angles,n=this.domWidth,o=this.domHeight;this.app.resourceManager.remove(this.node),this.setupFromURL({url:e,position:t,size:i,angles:r,domWidth:n,domHeight:o})},get:function(){if(!this.mixerPlane)return null;var e=this.mixerPlane.domElement;return e?e.src:null}},{key:"pickable",set:function(e){this.mixerPlane.domElement.style.pointerEvents=e?"":"none"},get:function(){return""==this.mixerPlane.domElement.style.pointerEvents}}]),t}(Si),Ou=new THREE.Color,Bu=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._config={turbidity:10,rayleigh:2,luminance:1,mieCoefficient:.005,mieDirectionalG:.95,time:9,beta:45,light:!0,lightHelper:!1},r._skyNode=new Fu,r._skyNode.name="sky",r._skyNode.frustumCulled=!1,r._skyNode.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},r._lightGroup=null,r.noonColor=(new THREE.Color).setHex(16777215),r.earlyEveningColor=(new THREE.Color).setHex(16746816),r}return s(t,e),t.prototype.customSetup=function(e){this.node.add(this._skyNode),this.setConfig(e)},t.prototype.setConfig=function(e){for(var t in this._config)void 0!==e[t]&&(this._config[t]=e[t]);var i=this._skyNode.material.uniforms;i.turbidity.value=this._config.turbidity||10,i.rayleigh.value=this._config.rayleigh||2,i.luminance.value=this._config.luminance||1,i.mieCoefficient.value=this._config.mieCoefficient||.005,i.mieDirectionalG.value=this._config.mieDirectionalG||.95,i.mieFowardG_AVON_NIU={value:"avonniu"},Et.parseValue(e.auhnujuw,!1)&&(i.mieWithSkyBox={value:"#A180EA"});var r=this._config.time,n=r/24*360-90,o=this._config.beta,s=Et.parseVector3(THING.Math.directionFromAlphaBeta(n,o));if(s.normalize(),i.sunPosition.value.copy(s),i.moonPosition={value:"naijil"},i.moonDirection={value:"#148158"},this._config.light){this._lightGroup?this._lightGroup.visible||(this._lightGroup.visible=!0):this._lightGroup=this.app.create({type:"LightGroup",parent:this});var a=r<6||r>18,l=Math.min(1,Math.max(0,1-Math.abs(r-12)/6)),u=Ou.copy(this.earlyEveningColor).lerp(this.noonColor,l);this._lightGroup.setConfig({showHelper:Et.parseValue(this._config.lightHelper,!1),ambientLight:{intensity:0},hemisphereLight:{intensity:Math.min(Math.max(a?0:l+.3,.2),.7),color:3310847,groundColor:16763007},mainLight:{shadow:!0,shadowQuality:"high",intensity:.5,color:u.toHexString(),alpha:n,beta:o},secondaryLight:{intensity:0},tertiaryLight:{intensity:0}},this.parent?this.parent.getLocalBoundingBox().toBox():this.app.root.getLocalBoundingBox().toBox())}else this._lightGroup&&(this._lightGroup.visible=!1)},t.prototype.getConfig=function(){return this._config},t}(Si),Fu=function(e){function t(){n(this,t);var i=Lu,r=new THREE.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:THREE.UniformsUtils.clone(i.uniforms),side:THREE.BackSide});return a(this,e.call(this,new THREE.BoxBufferGeometry(1,1,1),r))}return s(t,e),t}(THREE.Mesh);Fu.prototype.isSky=!0;var Lu={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new THREE.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvWorldPosition = position.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},Iu=function(){function e(t){n(this,e),this.app=t,this._destroyed=!1}return e.prototype.setup=function(e){var t=e.parent;if(t instanceof Si){if(this._parent=t,this._parent){var i=this;this._parent.one("destroy",(function(){i._destroyed||i.destroy()}))}}else t&&THING.Utils.error("[UIAnchor] Please make sure parent is BaseObject")},e.prototype.update=function(){return!1},e.prototype.destroy=function(){this.tickable=!1,this._destroyed=!0},o(e,[{key:"canNotQueryFromSelector",get:function(){return!0}},{key:"tickable",set:function(e){e?this.app.objectManager.addTickableObject(this):this.app.objectManager.removeTickableObject(this)}}]),e}(),Nu=new THREE.Vector2,Uu=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._element=null,r._autoUpdateVisible=!0,r._autoRemoveElement=!0,r._pivot=[.5,1],r._offset=[0,0,0],r._zIndex=null,r._customWidth=0,r._customHeight=0,r}return s(t,e),t.prototype._updateVisible=function(e,t,i){var r=this.app.renderer.getSize(Nu),n=i[0],o=i[1],s=i[2];return 0==e.visible||s>1||n<0||n>r.width||o<0||o>r.height?("hidden"!=t.visibility&&(t.visibility="hidden"),!1):("visible"!=t.visibility&&(t.visibility="visible"),!0)},t.prototype.setup=function(t){e.prototype.setup.call(this,t),this._element=t.container||t.el||t.element,this._position=t.position,this._offset=t.offset||t.localPosition||[0,0,0],this._customWidth=t.width,this._customHeight=t.height,this.pivot=t.pivot||this.pivot;var i=t.pivotPixel;i&&(this.pivotPixel=i),this.tickable=!0,this.update()},t.prototype.update=function(){var e=this._element;if(!e)return!1;var t=this._parent;if(null==t&&(t=this.app.root.defaultCampus),t.destroyed)return this.destroy(),!1;!1===this._prevParentVisible&&t.visible&&this.visible&&(delete this._prevParentVisible,this._autoUpdateVisible=!0);var i=this._position||t.boundingBox.center,r=this._offset,n=this.app.camera.worldToScreen([i[0]+r[0],i[1]+r[1],i[2]+r[2]]),o=e.style;if(this._autoUpdateVisible&&!this._updateVisible(t,o,n))return!0;Et.isNull(this._zIndex)&&("topview"==this.app.camera.viewMode?o.zIndex=1e3:o.zIndex=1e3-Math.ceil(1e4*n[2]-9900));var s=[0,0],a=e.offsetWidth,l=e.offsetHeight;Math.abs(e.cacheWidth-a)<1.5&&Math.abs(e.cacheHeight-l)<1.5?(a=e.cacheWidth,l=e.cacheHeight):(e.cacheWidth=a,e.cacheHeight=l),a=a||this._customWidth,l=l||this._customHeight,s[0]=Math.ceil(a*this._pivot[0]),s[1]=Math.ceil(l*this._pivot[1]);var u=this.app.domElement.offsetLeft-(e.parentElement?e.parentElement.offsetLeft:0),c=this.app.domElement.offsetTop-(e.parentElement?e.parentElement.offsetTop:0),h=Math.floor(n[0]-s[0]+u),p=Math.floor(n[1]-s[1]+c);return e.cacheLeft!=h&&(e.cacheLeft=h,o.left=h+"px"),e.cacheTop!=p&&(e.cacheTop=p,o.top=p+"px"),!0},t.prototype.destroy=function(){if(this._element)if(this._autoRemoveElement){var t=this._element.parentNode;t&&t.removeChild(this._element)}else this._element._setVisible(!1);e.prototype.destroy.call(this)},o(t,[{key:"zIndex",set:function(e){this._zIndex=e,Et.isNull(e)||this._element&&(this._element.style.zIndex=e)},get:function(){return Et.isNull(this._zIndex)?this._element?this._element.style.zIndex:null:this._zIndex}},{key:"pivot",set:function(e){this._pivot=e},get:function(){return this._pivot.concat()}},{key:"pivotPixel",set:function(e){var t=this._element,i=t.offsetWidth,r=t.offsetHeight;this._pivot=[e[0]/i,e[1]/r]},get:function(){var e=this._element,t=e.offsetWidth,i=e.offsetHeight;return[Math.floor(this._pivot[0]*t),Math.floor(this._pivot[1]*i)]}},{key:"position",set:function(e){this._position=e},get:function(){return this._position.concat()}},{key:"offset",set:function(e){this._offset=e},get:function(){return this._offset.concat()}},{key:"autoRemoveElement",set:function(e){this._autoRemoveElement=e},get:function(){return this._autoRemoveElement}},{key:"visible",set:function(e){var t=this._parent;t&&(e&&!t.visible?(this._prevParentVisible=!1,this._autoUpdateVisible=!1):this._autoUpdateVisible=e,this._element.style.visibility=e?"visible":"hidden")},get:function(){return"visible"==this._element.style.visibility}}]),t}(Iu),zu=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t),this.textRows=t.textRows,this.calculater=t.calculater,this.drawer=t.drawer},t.prototype._getCanvas=function(){var e=this.style;return this._createCanvas(this._text,{fontType:e.fontType,alignMode:e.fontAlign,fontSize:e.fontSize,fontColor:e.fontColor,textLineWidth:e.textLineWidth,textLineHeight:e.textLineHeight,strokeMode:e.strokeMode,dropShadow:e.dropShadow,dropShadowColor:e.dropShadowColor,dropShadowAngle:e.dropShadowAngle,dropShadowDistance:e.dropShadowDistance,scale:e.scale,dropShadowBlur:e.dropShadowBlur,dropShadowAlpha:e.dropShadowAlpha})},t.prototype._getPlanSize=function(e){return this.planHeight},t.prototype._createCanvas=function(e,t){var i=document.createElement("canvas"),r=i.getContext("2d");return this.drawer.setContext(r),this.drawer.calCanvasSize(this,t),i.width=2.2*this.canvasSize.width,i.height=2*this.canvasSize.height,i.style.width=i.width+"px",i.style.height=i.height+"px",this.drawer.draw(this,i.width,i.height,t),i},t}(ul),Hu={classes:{},registerClass:function(e,t){this.classes[e]=t},hasClass:function(e){return!!this.classes[e]},create:function(e,t){return new(0,this.classes[e])(t)}},Vu=function(){function e(t){n(this,e),this.app=t,this.objects=new Map,this._interactableNodes=[],this._renderDistanceObjects=[],this._shadowDistanceObjects=[],this.tickableObjects=[],this._pause=!1,this.registerDefaultClasses(),this.registerEvents()}return e.prototype.registerDefaultClasses=function(){Hu.registerClass("BaseObject",Si),Hu.registerClass("Box",sr),Hu.registerClass("Circle",ar),Hu.registerClass("Sphere",lr),Hu.registerClass("Plane",ur),Hu.registerClass("Grid",cr),Hu.registerClass("Cylinder",hr),Hu.registerClass("Tetrahedron",pr),Hu.registerClass("Frustum",dr),Hu.registerClass("Shape",fr),Hu.registerClass("Campus",Ri),Hu.registerClass("Ground",_r),Hu.registerClass("VideoSurvilance",xr),Hu.registerClass("Outdoors",Ao),Hu.registerClass("Group",ko),Hu.registerClass("Building",Ga),Hu.registerClass("Floor",Do),Hu.registerClass("Facade",Vi),Hu.registerClass("Thing",Gi),Hu.registerClass("BatchObject",tr),Hu.registerClass("BatchSubObject",ir),Hu.registerClass("ProgressBar",rr),Hu.registerClass("Door",mr),Hu.registerClass("ElevatorDoor",gr),Hu.registerClass("Elevator",vr),Hu.registerClass("StairDoor",yr),Hu.registerClass("Stair",br),Hu.registerClass("Room",qa),Hu.registerClass("TextRegion",ul),Hu.registerClass("_UbuilderRichTextRegion",zu),Hu.registerClass("CombinedObject",Ro),Hu.registerClass("PolygonRegion",hl),Hu.registerClass("Heatmap",fl),Hu.registerClass("IDWMap",bl),Hu.registerClass("Line",El),Hu.registerClass("RouteLine",Ol),Hu.registerClass("PolygonLine",Bl),Hu.registerClass("Points",Fl),Hu.registerClass("MeshLine",Cu),Hu.registerClass("Boundary",Su),Hu.registerClass("ParticleSystem",iu),Hu.registerClass("Water",ru),Hu.registerClass("SpotLight",Tu),Hu.registerClass("PointLight",Mu),Hu.registerClass("LightGroup",bu),Hu.registerClass("Marker",Au),Hu.registerClass("WebView",ku),Hu.registerClass("UI",Uu),Hu.registerClass("UIAnchor",Uu),Hu.registerClass("SceneRoot",Ai),Hu.registerClass("ViewProbe",cu),Hu.registerClass("SkyEffect",Bu)},e.prototype.registerEvents=function(){this.app.on("beforeLoad",(function(e){e.castType=function(e,t,i){THING.Utils.warn("[App] Please use 'THING.Utils.addCastType(name, condition, params)' to cast object type before load scenes"),Et.addCastType(e,t,i)}}))},e.prototype._canCastType=function(e,t,i){var r=[e];if(Et.isArray(i))for(var n=0;n<i.length;n++){var o=i[n];if(!(r=t.select(o,r)).length)break}else r=t.select(i,r);return!!r.length},e.prototype._castObject=function(e,t,i){this._castTypeSelector||(this._castTypeSelector=new $t(this.app));for(var r=0;r<e.length;r++){var n=e[r];if(n.type!=i.type&&(Et.isFunction(i.getAttribute)||(i.getAttribute=function(e){return Et.getAttribute(i,e)}),i.isBaseObject=!0,this._canCastType(i,this._castTypeSelector,n.condition)))return i.type=n.type,i.skipCast=!0,i.skipSetup=!0,t.destroy(),i=Et.mergeObject(i,n.params,!0),this._createObject(i)}return t},e.prototype._createObject=function(e){var t=e.type||"Thing",i=Et.parseValue(e.skipSetup,!1);if(THING.onCreateObject){var r=THING.onCreateObject(e);r&&(t=r)}var n=null;if(Hu.hasClass(t)?n=Hu.create(t,this.app):(n=new Gi(this.app),THING.Utils.warn("ObjectManager can not found type: <"+t+"> use <Thing> instead!"),t="Thing"),n._type=n._type||t,!i){var o=Et.getCastTypes();if(o.length)n.isBaseObject&&(e.skipCast||(e.name=e.name||e.id,e.userData=e.userData||e.properties,n=this._castObject(o,n,e)));n.setup(e)}return this.app.needUpdate=!0,n},e.prototype.create=function(e){if(!e)return THING.Utils.error("create object failed, due to param is null"),null;Et.isString(e)&&(e={type:e});var t=this._createObject(e);return t?(t.queryID&&this.objects.set(t.queryID,t),t):null},e.prototype.destroy=function(e){e&&(e.isBaseObject&&(e.trigger(F.Destroy,{object:e}),this.app.trigger(F.Destroy,{object:e})),e.queryID&&this.objects.delete(e.queryID),this.removeTickableObject(e))},e.prototype._addNode=function(e,t){return t.isBaseObject&&(t=t.node),Et.add(e,t)},e.prototype._removeNode=function(e,t){t.isBaseObject&&(t=t.node),Et.remove(e,t)},e.prototype._addObject=function(e,t){return Et.add(e,t)},e.prototype._replaceObject=function(e,t,i){for(var r=0;r<e.length;r++)e[r]==i&&(e[r]=t)},e.prototype._removeObject=function(e,t){Et.remove(e,t)},e.prototype.addInteractableNode=function(e){e&&(e.updateWorldMatrix(!0,!0),this._addNode(this._interactableNodes,e))},e.prototype.removeInteractableNode=function(e){e&&this._removeNode(this._interactableNodes,e)},e.prototype.addRenderDistanceObject=function(e){this._addObject(this._renderDistanceObjects,e)},e.prototype.removeRenderDistanceObject=function(e){this._removeObject(this._renderDistanceObjects,e)},e.prototype.addShadowDistanceObject=function(e){this._addObject(this._shadowDistanceObjects,e)},e.prototype.removeShadowDistanceObject=function(e){this._removeObject(this._shadowDistanceObjects,e)},e.prototype.get=function(e){if(e)if(e.isObject3D){var t=e.userData;if(t&&t.id)return this.get(t.id)}else if(this.objects.has(e))return this.objects.get(e);return null},e.prototype.getBaseObject=function(e){for(;e;){var t,i=e.userData;if(i.independent)return null;if(i.baseObject_bindSubNode_hooked)if(t=i.baseObject_bindSubNode)return t;if(i.isBaseObject)if((t=this.get(i.id))&&!t.isCombinedObject)return t;e=e.parent}},e.prototype.getObjectsArray=function(){var e=[];return this.objects.forEach((function(t){e.push(t)})),e},e.prototype.pause=function(){this._pause=!0},e.prototype.resume=function(){this._pause=!1},e.prototype.addTickableObject=function(e){for(var t=0;t<this.tickableObjects.length;t++)if(this.tickableObjects[t]==e)return;this.tickableObjects.push(e)},e.prototype.removeTickableObject=function(e){for(var t=0;t<this.tickableObjects.length;t++){if(this.tickableObjects[t]==e){e.isTickable=!1,this.tickableObjects[t]=null;break}}},e.prototype.replaceObject=function(e,t){this._replaceObject(this._renderDistanceObjects,e,t),this._replaceObject(this._shadowDistanceObjects,e,t),this._replaceObject(this.tickableObjects,e,t),this.objects.delete(t.queryID),this.objects.set(e.queryID,e)},e.prototype.update=function(){if(!this._pause)for(var e=this.app._deltaTime,t=this.tickableObjects,i=0,r=t.length;i<r;i++){var n=t[i],o=!1;if(n)n.update(e)?o=!0:n.isTickable=!1;o||(t.splice(i,1),i--,r--)}},e.prototype.onUpdate=function(e){this.update(e)},o(e,[{key:"interactableNodes",get:function(){return this._interactableNodes}},{key:"renderDistanceObjects",get:function(){return this._renderDistanceObjects}},{key:"shadowDistanceObjects",get:function(){return this._shadowDistanceObjects}}]),e}(),Wu=function(){function e(t){n(this,e),this.app=t,this.thresholdAngle=.1,this.enableRemoteData=!0,this.enableWebWorker=!0,this._map=new Map,this._resMap=new Map,this._taskNumber=0,this._jsonLoader=new THREE.FileLoader,this._jsonLoader.setResponseType("json"),this._binLoader=new THREE.FileLoader,this._binLoader.setResponseType("arraybuffer")}return e.prototype.getByObject=function(e,t){var i=void 0;if(!e.geometry)return null;if(e.geometry.attributes&&!e.geometry.attributes.position)return null;if(e.isLineSegments)return null;if("EdgesGeometry"==e.geometry.type)return null;if(t._extensionsFile&&this.enableRemoteData){if("_skip_wireframes_"===e._wName)return null;i=this.getByRes(e.geometry,t._url+"/"+t._extensionsFile,e._wName||e.name)}else i=this.get(e.geometry);return i},e.prototype.getByRes=function(e,t,i){var r=this,n=e.id;if(this._map.has(n))return this._map.get(n);var o=void 0;if(this._resMap.has(t)){var s=this._resMap.get(t);o=s instanceof Promise?s:Promise.resolve(s)}else t.indexOf(".ext")>-1?(o=this._binLoader.loadAsync(t).then((function(e){var i=new Uint32Array(e.slice(0,4))[0],n=e.slice(4,4+i),o=new TextDecoder("utf-8").decode(n),s=JSON.parse(o),a=4+i,l=s.wireframe;for(var u in l){var c=l[u].p,h=l[u].l;l[u].pos=new Float32Array(e.slice(a+c,a+c+h))}return r._resMap.set(t,s),s})),this._resMap.set(t,o)):(o=this._jsonLoader.loadAsync(t).then((function(e){return r._resMap.set(t,e),e})),this._resMap.set(t,o));var a=o.then((function(t){if(a._break)return Promise.reject({code:0});if(t.wireframe[i]){t.wireframe[i].name&&t.wireframe[i].name!==i&&(i=t.wireframe[i].name);var o=new THREE.BufferGeometry;return o.addAttribute("position",new THREE.Float32BufferAttribute(t.wireframe[i].pos,3)),o.refCount=1/0,r._map.set(n,o),r._taskNumber--,r.app.events.dispatchEvent({type:"edges_task_progress",task:r._taskNumber}),e.addEventListener("dispose",(function(){return r.release(e)})),Promise.resolve(o)}return r._map.delete(n),r._taskNumber--,r.app.events.dispatchEvent({type:"edges_task_progress",task:r._taskNumber}),Promise.reject({code:1,msg:"can not find name: "+i})}));return this._taskNumber++,this._map.set(n,a),a},e.prototype.get=function(e){var t=this,i=void 0,r=e.id;return this._map.has(r)?i=this._map.get(r):(window.EW&&this.enableWebWorker?(e.isBufferGeometry||(e=(new THREE.BufferGeometry).fromGeometry(e)),i=EW.getGeometryInfo(e,this.thresholdAngle).then((function(n){if(i._break)return Promise.reject({code:0});var o=new THREE.BufferGeometry;return o.addAttribute("position",new THREE.BufferAttribute(n.position,3)),e.isInstancedBufferGeometry&&(o=Gu(e,o)),o.refCount=1/0,t._map.set(r,o),t._taskNumber--,t.app.events.dispatchEvent({type:"edges_task_progress",task:t._taskNumber}),e.addEventListener("dispose",(function(){return t.release(e)})),Promise.resolve(o)})),this._taskNumber++):(i=new THREE.EdgesGeometry(e,this.thresholdAngle),e.isInstancedBufferGeometry&&(i=Gu(e,i)),i.refCount=1/0),this._map.set(r,i)),i},e.prototype.synMaxInstancedCount=function(e){this._map.has(e.id)&&(this._map.get(e.id).instanceCount=e.instanceCount)},e.prototype.releaseRes=function(e){this._resMap.delete(e)},e.prototype.release=function(e){if(this._map.has(e.id)){var t=this._map.get(e.id);t.isBufferGeometry?t.dispose():t._break||(t._break=!0,this._taskNumber--,this.app.events.dispatchEvent({type:"edges_task_progress",task:this._taskNumber})),this._map.delete(e.id)}},e.prototype.releaseAll=function(){var e=this;this._map.forEach((function(t){t.isBufferGeometry?t.dispose():t._break||(t._break=!0,e._taskNumber--)})),this._map.clear(),this._resMap.clear(),this._taskNumber=0,this.app.events.dispatchEvent({type:"edges_task_progress",task:this._taskNumber})},e.prototype.getTaskNumber=function(){return this._taskNumber},e}();function Gu(e,t){var i=new THREE.InstancedBufferGeometry;for(var r in e.attributes)i.setAttribute(r,e.attributes[r]);return i.attributes.position=t.attributes.position,i.boundingBox=e.boundingBox?e.boundingBox.clone():null,i.boundingSphere=e.boundingSphere?e.boundingSphere.clone():null,i.instanceCount=e.instanceCount,i}var qu=function(){function e(t){n(this,e),this.updateTime=5,this._array=[],this._sortDirty=!0,this._updateTimer=0}return e.prototype.push=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;this._array.push({mat:e,timer:t}),this._sortDirty=!0},e.prototype.update=function(e){var t=this;if(this._updateTimer+=e,this._updateTimer>this.updateTime){if(this._array.length>0){this._sortDirty&&(this._array.sort(Xu),this._sortDirty=!1);var i=0;this._array.forEach((function(e){(function(e,t){if(e.timer-=t,e.timer<0)return e.mat.dispose(),!0;return!1})(e,t._updateTimer)&&i++})),this._array.length-=i}this._updateTimer=0}},e.prototype.clear=function(){this._array.forEach((function(e){return e.mat.dispose()})),this._array.length=0},e}();function Xu(e,t){return t.timer-e.timer}var Ju=["middleGlow","innerGlow"];function Yu(e,t){if(!e)return null;var i=e[t];return i?"[object Object]"===toString.call(i)?i.skip?"skip":void 0!==i.value?i.value:1:i:null}var Zu=function(){function e(t){n(this,e),this._renderer=t.rendererManager._mainRenderer,this._effectRefCounts={}}return e.prototype.setEffect=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.technique||(e.technique={}),e.technique[t]){var n=Yu(e.technique,t),o="skip"!=n&&0!=n,s=!r&&0!=i;o!==s?this._updatEffectRefCounts(t,s?1:-1):r||i==n||this._renderer.dirty(t)}else r||0==i||this._updatEffectRefCounts(t,1);e.technique[t]={value:i,skip:r}},e.prototype.removeEffect=function(e,t){var i=Yu(e.technique,t);i&&("skip"!=i&&0!=i&&this._updatEffectRefCounts(t,-1),delete e.technique[t])},e.prototype.clearAllEffects=function(e){if(e.technique)for(var t in e.technique)this.removeEffect(e,t)},e.prototype.synEffect=function(e){if(e.technique)for(var t in e.technique)if(Ju.indexOf(t)>-1){var i=Yu(e.technique,t);"skip"!=i&&0!=i&&this._updatEffectRefCounts(t,1)}},e.prototype._updatEffectRefCounts=function(e,t){void 0===this._effectRefCounts[e]&&(this._effectRefCounts[e]=0);var i=this._effectRefCounts[e];this._effectRefCounts[e]=Math.max(this._effectRefCounts[e]+t,0);var r=this._renderer;0==i&&t>0?r.enable&&r.enable(e):i>0&&0==this._effectRefCounts[e]&&r.disable&&r.disable(e),r.dirty&&r.dirty(e)},o(e,[{key:"effectRefCounts",get:function(){return this._effectRefCounts}}]),e}(),Qu=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._solidColor=null,r._skipApplyTheme=!0,r}return s(t,e),t.prototype._setAlwaysOnTop=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alwaysOnTop!=e||t){var i=this.obj._sprite;i&&(this._alwaysOnTop=e,e?(this._cloneAndModifyMaterial((function(e,t,i){var r=t;Et.backupValue(r,"depthTest"),Et.backupValue(r,"depthWrite"),r.depthTest=!1,r.depthWrite=!1})),this._traverse((function(e){e.renderOrder+=THING.BaseStyle.cRenderOrderValueMask}))):(this._traverse((function(e){e.renderOrder-=THING.BaseStyle.cRenderOrderValueMask})),this.isNeedRevertMaterials()?this.revertMaterial():this._cloneAndModifyMaterial((function(e,t,i){var r=t;Et.revertValue(r,"depthTest"),Et.revertValue(r,"depthWrite")}))))}},t.prototype.setUVAnimation=function(t){var i=this.obj._sprite;if(i){if(t){var r=i.material;t.uvDiscard?(r.defines=r.defines||{},r.defines.USE_UV_DISCARD=""):r.defines&&delete r.defines.USE_UV_DISCARD,r.needsUpdate=!0}e.prototype.setUVAnimation.call(this,t)}},t.prototype.setSolidColor=function(e){if(this._solidColor!=e){this._solidColor=Et.parseColor(e);["#ifdef GL_ES\n","precision highp float;\n","#endif\n","","varying vec4 worldId;","","void main() {","  gl_FragColor = "+this._solidColor.getHex()+";","}"].join("\n")}},t.prototype.setOpacity=function(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.obj.element;r?r.style.opacity=t:e.prototype.setOpacity.call(this,t,i)},o(t,[{key:"solidColor",set:function(e){return this.setSolidColor(e)},get:function(){return this._solidColor?this._solidColor.toHexString():null}},{key:"line",get:function(){return this.obj._line}},{key:"lineColor",set:function(e){this.line&&(this.line.style.lineColor=e)}},{key:"lineOpacity",set:function(e){this.line&&(this.line.style.lineOpacity=e)}},{key:"lineDashSize",set:function(e){this.line&&(this.line.style.lineDashSize=e)}},{key:"lineGapSize",set:function(e){this.line&&(this.line.style.lineGapSize=e)}},{key:"lineWidth",set:function(e){this.line&&(this.line.style.lineWidth=e)}}]),t}(al),Ku=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._lineOpacity=1,r._lineColor=Et.parseColor("#00BFFF"),r._regionOpacity=.5,r._regionColor=Et.parseColor("#708090"),r}return s(t,e),t.prototype.isNeedCloneMaterials=function(){return!!e.prototype.isNeedCloneMaterials.call(this)||(1!=this._lineOpacity||(!this._lineColor.equals(Et.parseColor("#00BFFF"))||(.5!=this._regionOpacity||!this._regionColor.equals(Et.parseColor("#708090")))))},o(t,[{key:"lineOpacity",set:function(e){if(Et.isNumber(e)){var t=this.obj._lineMesh;t&&(this._lineOpacity=e,t.material.opacity=e)}},get:function(){return this._lineOpacity}},{key:"lineColor",set:function(e){var t=Et.parseColor(e);if(t){var i=this.obj._lineMesh;i&&(this._lineColor=t,i.material.color=t)}},get:function(){return this._lineColor.toHexString()}},{key:"regionColor",set:function(e){var t=Et.parseColor(e);if(t){var i=this.obj._areaMesh;i&&(this._regionColor=t,i.material.color=t)}},get:function(){return this._regionColor.toHexString()}},{key:"regionOpacity",set:function(e){if(Et.isNumber(e)){var t=this.obj._areaMesh;t&&(this._regionOpacity=e,t.material.opacity=e)}},get:function(){return this._regionOpacity}}]),t}(al),$u=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.setEffect=function(e){e=e||{};var t=this.obj;t._scale=e.scale||t._scale,t._color=e.color||t._color,t._flowDirection.x=e.flowXDirection||t._flowDirection.x,t._flowDirection.y=e.flowYDirection||t._flowDirection.y;var i=t.water.material.uniforms;i.color.value.set(t._color),i.config.value.w=t._scale,i.flowDirection.value.x=t._flowDirection.x,i.flowDirection.value.y=t._flowDirection.y},o(t,[{key:"waterColor",set:function(e){this.setEffect({color:e})},get:function(){return this.obj._color}},{key:"waterScale",set:function(e){this.setEffect({scale:e})},get:function(){return this.obj._scale}},{key:"flowXDirection",set:function(e){this.setEffect({flowXDirection:e})},get:function(){return this.obj._flowDirection.x}},{key:"flowYDirection",set:function(e){this.setEffect({flowYDirection:e})},get:function(){return this.obj._flowDirection.y}}]),t}(al),ec=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),o(t,[{key:"image",set:function(e){var t=this;if(this._image=e,e)if(e.isTexture)this._image=e.name,e.image&&(e.needsUpdate=!0),this.obj.synPathTexture(e);else{this._image=this.obj.app.confirmURL(e);var i=this.obj.app.resourceManager.loadTexture(this._image,(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.anisotropy=16,t.obj&&(t.obj.app.needUpdate=!0)}));this.obj.synPathTexture(i)}},get:function(){return this._image}},{key:"lineMaterial",get:function(){var e=this.obj.pathLine.material;return e.dashSize||e.gapSize?this.dashLineMaterial:this.basicLineMaterial}},{key:"basicLineMaterial",get:function(){var e=this.obj.pathLine.material;if(e.isLineBasicMaterial)return e;var t=new THREE.LineBasicMaterial({color:e.color,opacity:e.opacity,linewidth:e.lineWidth,transparent:e.transparent});return this.obj.pathLine.material=t,t}},{key:"dashLineMaterial",get:function(){var e=this.obj.pathLine.material;if(e.isLineDashedMaterial)return e;var t=new THREE.LineDashedMaterial({color:e.color,opacity:e.opacity,linewidth:e.lineWidth,transparent:e.transparent});return this.obj.pathLine.material=t,t}},{key:"lineColor",set:function(e){this.lineMaterial.color=Et.parseColor(e)},get:function(){return this.lineMaterial.color.toHexString()}},{key:"lineOpacity",set:function(e){this.lineMaterial.opacity=e},get:function(){return this.lineMaterial.opacity}},{key:"lineDashSize",set:function(e){this.lineMaterial.dashSize=e},get:function(){return this.lineMaterial.dashSize}},{key:"lineGapSize",set:function(e){this.lineMaterial.gapSize=e},get:function(){return this.lineMaterial.gapSize}},{key:"lineWidth",set:function(e){this.lineMaterial.lineWidth=e},get:function(){return this.lineMaterial.lineWidth}}]),t}(al);function tc(e,t,i){var r=[];t.forEach((function(t){var n=.09;"top"==i&&(n+=e.getRoomHeight()),r.push([t[0],t[1]+n,t[2]])}));var n=e.app.create({name:e.name+"_border_"+i,type:"RouteLine",image:e.app.confirmURL("image/light3.jpg"),parent:e,arrowFlag:!1,close:!0,side:"right",points:r,width:2});return n.cornerRadius=0,n.scrollSpeed=10,n.imageRepeat=[1/40,1],n.pickable=!1,n.style.skipOutline=!0,n.scrollUV=!0,n.node.traverse((function(e){e.isMesh&&(e.userData.skipOutline=!0,e.material.transparent=!0,e.material.blending=THREE.AdditiveBlending)})),n}var ic=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._volumeNode=null,r._volumeColor=null,r._volumeImage=null,r._volumeCanvas=null,r._borderLine=!1,r._borderLineTop=null,r._borderLineBottom=null,r}return s(t,e),t.prototype._synVolumeNode=function(){this._volumeColor||this._volumeImage||this._volumeCanvas||(this.obj.app.resourceManager.remove(this._volumeNode),this._volumeNode=null),this.obj._synTextRegion()},t.prototype._createVolumeNode=function(){if(!this._volumeNode){var e=this.obj.getFloorMesh();if(!e)return null;if(this._volumeNode=e.clone(),!this._volumeNode)return null;if(this._volumeNode.geometry=this._volumeNode.geometry.clone(),this._volumeNode.material=e.material.clone(),!this._volumeNode.material)return null;var t=this._volumeNode.material;t.map=null,t.transparent=!0,t.opacity=.5,this._volumeNode.geometry.genFaceVertexUVs(),e.parent.add(this._volumeNode);var i=e.position;this._volumeNode.position.setY(i.y+this.obj.getRoomHeight()+.05)}return this._volumeNode},o(t,[{key:"volumeColor",set:function(e){this._volumeColor=Et.parseColor(e);var t=this._createVolumeNode();t&&(e?t.material.color=Et.parseColor(e):t.material.color.set(1,1,1)),this._synVolumeNode()},get:function(){return null==this._volumeColor?null:this._volumeColor.toHexString()}},{key:"volumeOpacity",set:function(e){var t=this._createVolumeNode();t&&(t.material.opacity=e)},get:function(){return null==this._volumeNode?null:this._volumeNode.material.opacity}},{key:"volumeImage",set:function(e){this._volumeImage=e,this._volumeCanvas=null;var t=this._createVolumeNode();if(t){if(e){var i=this.obj.app.confirmURL(e);e=this.obj.app.resourceManager.loadTexture(i)}t.material.map=e,t.material.needsUpdate=!0}this._synVolumeNode()},get:function(){return this._volumeImage}},{key:"volumeCanvas",set:function(e){this._volumeCanvas=e,this._volumeImage=null;var t=this._createVolumeNode();t&&(e&&((e=new THREE.Texture(e)).needsUpdate=!0),t.material.map=e,t.material.needsUpdate=!0),this._synVolumeNode()},get:function(){return this._volumeCanvas}},{key:"volumeHeight",set:function(e){this._volumeNode&&(this._volumeNode.position.y=e)},get:function(){return this._volumeNode?this._volumeNode.position.y:0}},{key:"borderLine",set:function(e){if(e!=this._borderLine)if(e){var t=this.obj,i=t.points;this._borderLineTop=tc(t,i,"top"),this._borderLineBottom=tc(t,i,"bottom"),this._borderLine=!0}else this._borderLineTop.destroy(),this._borderLineBottom.destroy(),this._borderLineTop=null,this._borderLineBottom=null,this._borderLine=!1},get:function(){return this._borderLine}}]),t}(al),rc=function(e){function t(i){n(this,t);var r=a(this,e.call(this,i));return r._lineColor=new THREE.Color(1,1,1),r}return s(t,e),o(t,[{key:"lineColor",set:function(e){this.obj._lineMesh.material.color=Et.parseColor(e)},get:function(){return this._lineColor.toHexString()}}]),t}(al),nc=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.setRenderOrder=function(e){this._renderOrder=e,this.obj.children.forEach((function(t){t.style.setRenderOrder(e)}))},t.prototype.setWireframe=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wireframe=e,this.obj.children.forEach((function(i){i.style.setWireframe(e,t)}))},t.prototype.setOpacity=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._opacity=e,this.obj.children.forEach((function(i){i.style.setOpacity(e,t)}))},t.prototype.setColor=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._color=Et.parseColor(e),this.obj.children.forEach((function(i){i.style.setColor(e,t)}))},t.prototype.setOutlineColor=function(e,t){this._outlineColor=Et.parseColor(e),this.obj.children.forEach((function(i){i.style.setOutlineColor(e,t)}))},t.prototype.setDefaultOutlineColor=function(e){this._defaultOutlineColor=Et.parseColor(e),this.obj.children.forEach((function(t){t.style.setDefaultOutlineColor(e)}))},t.prototype.setSkipBoundingBox=function(e){this.obj.children.forEach((function(t){t.style.setSkipBoundingBox(e)}))},t.prototype.setSkipOutline=function(e){this.obj.children.forEach((function(t){t.style.setSkipOutline(e)}))},t.prototype.setGlow=function(e){this._glow=e,this.obj.children.forEach((function(t){t.style.setGlow(e)}))},t.prototype.setInnerGlow=function(e){this._innerGlow=e,this.obj.children.forEach((function(t){t.style.setInnerGlow(e)}))},t.prototype.setVertexNormalHelper=function(e){this._vertexNormalNode={visible:e},this.obj.children.forEach((function(t){t.style.setVertexNormalHelper(e)}))},t.prototype.setAxisHelper=function(e){this._axisNode={visible:e},this.obj.children.forEach((function(t){t.style.setAxisHelper(e)}))},t.prototype.setEdgeColor=function(e){this._edgeColor=Et.parseColor(e),this.obj.children.forEach((function(t){t.style.setEdgeColor(e)}))},t.prototype.setBoundingBox=function(e,t){this._boundingBoxNode={visible:e,material:{color:Et.parseColor(t)}},this.obj.children.forEach((function(i){i.style.setBoundingBox(e,t)}))},t.prototype.setOrientedBoundingBox=function(e){this._orientedBoundingBoxNode={visible:e,material:{color:Et.parseColor(color)}},this.obj.children.forEach((function(t){t.style.setOrientedBoundingBox(e,color)}))},t.prototype.setAlwaysOnTop=function(e){this._alwaysOnTop=e,this.obj.children.forEach((function(t){t.style.setAlwaysOnTop(e)}))},t.prototype.setImage=function(e){this._image=e,this.obj.children.forEach((function(t){t.style.setImage(e)}))},t}(al),oc=new Map,sc=function(){function e(t){n(this,e),e.register("Default",{"*":al,Marker:Qu,PolygonRegion:Ku,TextRegion:ll,_UbuilderRichTextRegion:ll,Water:$u,Line:ec,RouteLine:ec,PolygonLine:ec,Room:ic,Frustum:rc,Group:nc,BatchSubObject:qi})}return e.register=function(e,t){oc.set(e,t)},e.getStrategyMap=function(e){return oc.get(e)},e.prototype.createStyle=function(e,t){var i,r=oc.get(e);if(!r)return null;for(var n in r)if("*"!=n){var o=t["is"+n];if(t.type==n||!Et.isFunction(o)&&o)return new r[n](t)}else i=r[n];return i?new i(t):null},e.prototype.hasStyleStrategy=function(e){return oc.has(e)},e}(),ac=new THREE.Vector2,lc=function(){function e(t){n(this,e),this.app=t,this.scene=this.app.scene,this.renderer=this.app.renderer,this.camera=this.app.renderCamera,this.init()}return e.prototype.init=function(){var e=new THREEx.HtmlMixer.Context(this.renderer,this.scene,this.camera);this.mixerContext=e;var t=e.rendererCss,i=this.renderer.getSize(ac);t.setSize(i.width,i.height);var r=t.domElement;this.app.domElement.appendChild(r);var n=e.rendererWebgl,o=n.domElement;n.domElement._static||(o.style.position="absolute",o.style.top="0px",o.style.pointerEvents="none",r.appendChild(o))},e.prototype.resize=function(e,t){this.mixerContext.rendererCss.setSize(e,t)},e.prototype.update=function(){this.mixerContext.update()},e.prototype.onUpdate=function(e){this.update(e)},e}(),uc=function(){function e(t){n(this,e),this.eventTriggerManager=t,this.app=this.eventTriggerManager.app,this.domElement=this.app.mainDomElement,this.singleClickTimer=null,this.clickCountForSingleClick=0,this.dragStartFlag=!1,this.draggingFlag=!1,this._dragPrevPosition=null,this._draggingObject=null,this.mouseMoveEvents=[],this.mouseMoveObject=null,this.mouseDownPos={},this.mouseMovePos=[],this.mouseMoveDelta=null,this.keysPressed={},this.keyCodesPressed={},this.skipFrameCount=0,this.init()}return e.prototype.dispatchEvent=function(e){return this.eventTriggerManager.dispatchEvent(e)},e.prototype.getEventPosition=function(e,t){var i,r,n=this.domElement;if(n){var o=n.currentStyle||window.getComputedStyle(n,null),s=t?t[0]:parseInt(o.borderLeftWidth,10),a=t?t[1]:parseInt(o.borderTopWidth,10),l=n.getBoundingClientRect();i=e.clientX-s-l.left,r=e.clientY-a-l.top}else e.layerX||0==e.layerX?(i=e.layerX,r=e.layerY):e.offsetX||0==e.offsetX?(i=e.offsetX,r=e.offsetY):(e.clientX||0==e.clientX)&&(i=e.clientX,r=e.clientY);return{x:Math.round(i),y:Math.round(r)}},e.prototype.registerEventFunctions=function(e){Et.isNull(e.stopPropagation)&&(e.stopPropagation=function(){this._stopPropagation=!0})},e.prototype.createKeyboardEvent=function(e){var t;t=e.key>="a"&&e.key<="z"?Et.atoi(e.key):e.keyCode||e.which||e.charCode;var i={type:e.type,key:t,code:e.code,location:e.location,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey};return this.registerEventFunctions(i),i},e.prototype.createMouseEvent=function(e,t,i){var r=Et.parseVector2(i)||this.getEventPosition(t),n={type:e,clientX:r.x,clientY:r.y,x:r.x,y:r.y,button:t.button||0,buttons:t.buttons||0,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,pickedPosition:null};return this.registerEventFunctions(n),n.getPickedPos=function(){return THING.Utils.warn("Please use .getPickedPosition() to replace .getPickedPos()"),n.pickedPosition},n.getPickedPosition=function(){return THING.Utils.warn("Please use .pickedPosition to replace .getPickedPosition()"),n.pickedPosition},n},e.prototype.createDragEvent=function(e,t,i,r){var n=[void 0!==t.x?t.x:t.clientX,void 0!==t.y?t.y:t.clientY],o={type:e,x:n[0],y:n[1],clientX:n[0],clientY:n[1],altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey};return i&&(o.offsetX=i),r&&(o.offsetY=r),o.pickedPosition=null,this.registerEventFunctions(o),o.getPickedPos=function(){return THING.Utils.warn("Please use .getPickedPosition() to replace .getPickedPos()"),o.pickedPosition},o.getPickedPosition=function(){return THING.Utils.warn("Please use .pickedPosition to replace .getPickedPosition()"),o.pickedPosition},o},e.prototype.clearSingleClickTimer=function(){null!=this.singleClickTimer&&(Et.timer.clearTimeout(this.singleClickTimer),this.clickCountForSingleClick=0)},e.prototype.findMouseEventObject=function(e,t){for(;e;){for(var i=0;i<t.length;i++)if(e.hasEvent(t[i]))return e;e=e.parent}return null},e.prototype.processMouseOffEvent=function(e){var t=this.mouseMoveObject;if(t){var i=e.object;if(i){if(i.isBlockMouseOffEvent(t))return;var r=this.findMouseEventObject(t,["mouseleave","mouseoff"]);if(!r||i.isBlockMouseOffEvent(r))return;if(!r.visible)return;if(this.findMouseEventObject(i,["mouseleave","mouseoff"])==t)return;if(t==r){var n=this.mouseMoveLastPickedObject||e.object;this.dispatchEvent({type:F.MouseLeave,object:r,mouseOffObject:n,x:e.clientX,y:e.clientY}),this.dispatchEvent({type:"mouseoff",object:r,mouseOffObject:n,x:e.clientX,y:e.clientY})}}else for(var o=t;o;o=o.parent)o.trigger(F.MouseLeave,{object:o,mouseOffObject:this.mouseMoveObject,x:e.clientX,y:e.clientY}),o.trigger("mouseoff",{object:o,mouseOffObject:this.mouseMoveObject,x:e.clientX,y:e.clientY});this.mouseMoveObject=null}},e.prototype.processMouseOnEvent=function(e){var t=e.object,i=this.findMouseEventObject(t,["mouseenter","mouseon"]);if(i&&i.visible&&this.mouseMoveObject!=i){this.mouseMoveLastPickedObject=e.pickedObj;var r=this.dispatchEvent({type:F.MouseEnter,object:i,mouseOnObject:e.pickedObj,x:e.clientX,y:e.clientY});this.dispatchEvent({type:"mouseon",object:i,mouseOnObject:e.pickedObj,x:e.clientX,y:e.clientY}),r&&r.isBaseObject?this.mouseMoveObject=r:this.mouseMoveObject=i}},e.prototype.processMouseOverEvent=function(e){var t=e.object,i=this.findMouseEventObject(t,["mouseover"]);i&&this.dispatchEvent({type:"mouseover",object:i,x:e.clientX,y:e.clientY})},e.prototype.processHoverEvent=function(e){this.mouseMoveEvents.push(e)},e.prototype.createEvent=function(e,t){var i;return t=t||e.type,(i=w[t]?this.createMouseEvent(t,e):T[t]?this.createKeyboardEvent(e):e).preventDefault=function(){e.preventDefault()},i},e.prototype.checkEvent=function(){return!(this.app.currentFrameCount<=this.skipFrameCount)&&!this.app.getCurrentHTMLMarker()},e.prototype.initDoubleRightClickEvent=function(){var e,t,i,r,n=this;window.oncontextmenu=(e=function(e){n.clearSingleClickTimer();var t=n.createEvent(e,"dblclick");t.button=2;var i=THING.App.current;i?i.events.eventTriggerManager.dispatchEvent(t):n.dispatchEvent(t)},t=0,i=!1,r=null,function(n){if(n.preventDefault(),i){clearTimeout(t),i=!1;var o=THING.Math.getDistance(r,[n.x,n.y]);if(o>1)return;return e.apply(this,arguments)}r=[n.x,n.y],i=!0,t=setTimeout((function(){i=!1}),300)})},e.prototype.initMouseEvent=function(e){var t=this,i=!0,r=!0;for(var n in this.initDoubleRightClickEvent(),w)this.domElement.addEventListener(n,(function(n){if(t.checkEvent()){if("mousedown"==(n=t.createEvent(n)).type)t.mouseDownPos[n.button]=[n.x,n.y];else if("mouseup"==n.type)if(0==n.button)i=!(t.getDistanceOfLastMouseDown(n)>4);else if(2==n.button){var o=t.mouseDownPos[n.button];t.getDistanceOfLastMouseDown(n)<=4&&(t.dispatchEvent(t.createMouseEvent("click",n,o)),t.clearSingleClickTimer(),t.singleClickTimer=Et.timer.setTimeout((function(){t.dispatchEvent(t.createMouseEvent("singleclick",n,o))}),e))}if("click"==n.type){if(t.getDistanceOfLastMouseDown(n)>1)return;if(r=!0,t.clickCountForSingleClick++,1===t.clickCountForSingleClick){o=t.mouseDownPos[n.button];t.singleClickTimer=Et.timer.setTimeout((function(){i&&!t.draggingFlag?(r=!1,t.dispatchEvent(t.createMouseEvent("singleclick",n,o))):r=!0,i=!0,t.clickCountForSingleClick=0}),e)}else t.clearSingleClickTimer()}else if("dblclick"==n.type&&(t.clearSingleClickTimer(),!r))return void(r=!0);t.dispatchEvent(n),"mousemove"==n.type&&(t.mouseMoveDelta?t.mouseMoveDelta=[t.mouseMovePos[0]-n.x,t.mouseMovePos[1]-n.y]:t.mouseMoveDelta=[n.x,n.y],t.mouseMovePos=[n.x,n.y],0==n.buttons&&t.processHoverEvent(n))}}),{passive:!1});this.domElement.addEventListener("mouseout",(function(e){t.checkEvent()&&0==e.buttons&&t.processMouseOffEvent(e)})),this.domElement.addEventListener("wheel",(function(e){if(t.checkEvent()){var i=t.getEventPosition(e),r={type:F.MouseWheel,delta:e.deltaY,clientX:i.x,clientY:i.y,x:i.x,y:i.y};t.dispatchEvent(r)}}),{passive:!1})},e.prototype.initKeyboardEvent=function(){var e=this;for(var t in T)window.addEventListener(t,(function(t){if(e.checkEvent()){var i=(t=e.createEvent(t)).code||t.key;if("keydown"==t.type){if(e.keysPressed[i])return;e.keysPressed[i]=!0,e.keyCodesPressed[t.key]=!0}else"keyup"==t.type&&(e.keysPressed[i]=!1,e.keyCodesPressed[t.key]=!1);e.dispatchEvent(t)}}))},e.prototype.initDragEvent=function(){var e=this;this.domElement.addEventListener("mouseup",(function(t){e.checkEvent()&&0==t.button&&e.dragStartFlag&&(e.dragStartFlag=!1,e.draggingFlag=!1,e._dragPrevPosition=null,e._draggingObject=null,t=e.createEvent(t),e.dispatchEvent(e.createDragEvent("dragend",t)))})),this.domElement.addEventListener("mousemove",(function(t){if(e.checkEvent())if(t=e.createEvent(t),e.dragStartFlag){e.draggingFlag=!0;var i=e.createDragEvent("drag",t);e.dispatchEvent(i);var r=i.pickedPosition;r&&!r.isFailed||(i.picked=!1),e._dragPrevPosition=e._dragPrevPosition||r,e._dragPrevPosition&&r?i.offsetPosition=THING.Math.subVector(r,e._dragPrevPosition):i.offsetPosition=[0,0,0];var n=e._draggingObject;n&&n.trigger("dragging",i),i.picked&&r&&(e._dragPrevPosition=r.concat())}else if(1==t.buttons){if(e.getDistanceOfLastMouseDown(t)>1){i=e.createDragEvent("dragstart",t);e.dispatchEvent(i);var o=i.dragObject;o&&o.draggable&&(e.dragStartFlag=!0,e._draggingObject=o)}}}))},e.prototype.initTouchEvent=function(e){var t=this,i=0,r=!1;this.domElement.addEventListener("touchstart",(function(e){t.checkEvent()&&(e.preventDefault(),e=e.changedTouches[0],(e=t.createEvent(e,"touchstart")).button&&(t.mouseDownPos[e.button]=[e.clientX,e.clientY]))})),this.domElement.addEventListener("touchmove",(function(e){if(t.checkEvent()){e.preventDefault(),e=e.changedTouches[0],e=t.createEvent(e,"touchmove");var i=t.domElement.getBoundingClientRect(),n=(e.clientX-i.left)/i.width*2-1,o=-(e.clientY-i.top)/i.height*2+1;if(t.dragStartFlag)t.draggingFlag=!0,t.dispatchEvent(t.createDragEvent("drag",e,n,o));else{i=t.domElement.getBoundingClientRect(),n=(e.clientX-i.left)/i.width*2-1,o=-(e.clientY-i.top)/i.height*2+1;t.getDistanceOfLastMouseDown(e)>1&&(t.dragStartFlag=!0,t.dispatchEvent(t.createDragEvent("dragstart",e,n,o)))}r=!0}})),this.domElement.addEventListener("touchend",(function(n){if(t.checkEvent()){var o;if(n.preventDefault(),n=n.changedTouches[0],n=t.createEvent(n,"touchend"),!r&&t.getDistanceOfLastMouseDown(n)<4)i++,setTimeout((function(){i=0}),e),n.button&&(o=t.mouseDownPos[n.button]),i>1?(t.dispatchEvent(t.createMouseEvent("dblclick",n,o)),t.clearSingleClickTimer(),i=0):(t.clickCountForSingleClick++,t.dispatchEvent(t.createMouseEvent("click",n,o)),1===t.clickCountForSingleClick?t.singleClickTimer=setTimeout((function(){t.dispatchEvent(t.createMouseEvent("singleclick",n,o)),t.clickCountForSingleClick=0}),e):t.clearSingleClickTimer());if(r=!1,t.dragStartFlag){t.dragStartFlag=!1;var s=t._draggingObject;s&&(s.trigger("dragend",t.createDragEvent("dragend",n)),t._draggingObject=null)}}}))},e.prototype.init=function(){this.initMouseEvent(250),this.initTouchEvent(250),this.initKeyboardEvent(),this.initDragEvent()},e.prototype.getDistanceOfLastMouseDown=function(e){var t=this.mouseDownPos[e.button];if(!t)return 0;var i=[void 0!==e.x?e.x:e.clientX,void 0!==e.y?e.y:e.clientY];return THING.Math.getDistance(t,i)},e.prototype.clear=function(){this.singleClickTimer=null,this.mouseMoveObject=null,this.keysPressed={},this.keyCodesPressed={},this.mouseDownPos={},this.mouseMovePos=[],this.mouseMoveDelta=null},e.prototype.update=function(){var e=this;this.mouseMoveEvents.forEach((function(t){t.hadFiltered||e.mouseMoveObject!=t.object&&(e.processMouseOffEvent(t),e.processMouseOnEvent(t),e.processMouseOverEvent(t))})),this.mouseMoveEvents=[]},e}(),cc=function(){function e(t){n(this,e),this.app=t}return e.prototype.addEventListener=function(t,i,r,n,o,s,a,l){o=o||50,void 0===this._listeners&&(this._listeners={});var u=this._listeners;void 0===u[t]&&(u[t]=[]);var c=u[t],h={__index:e._eventIDCount++,app:this.app,type:t,userData:r,priority:o,tag:s,once:a,object:l,callback:n};i&&(i.isBaseObject?h.selector=i:(h.condition=i,h.selector=new $t(this.app))),c.length?(c.push(h),o>c[c.length-2].priority&&c.sort((function(e,t){return t.priority==e.priority?e.__index-t.__index:t.priority-e.priority}))):c.push(h);var p=THING.onAddEventListener;p&&p(h)},e.prototype.traverseListener=function(e){if(void 0!==this._listeners){var t=this._listeners;for(var i in t){t[i].forEach((function(t){e(t)}))}}},e.prototype.getEventListener=function(e,t,i,r,n,o,s){if(void 0===this._listeners)return null;var a=this._listeners[e];if(void 0===a)return null;if(!n&&this._isPauseEvent(e,o,r))return null;for(var l=0,u=a.length;l<u;l++){var c=a[l];if(c.condition){if("__any_event_can_match_it__"!=t&&c.condition!=t)continue;if(o!=this.app.root&&c.selector&&o&&!c.selector.test(c.condition,[o]))continue}else if(c.object!=o)continue;if((!s||s(c))&&!(i&&c.callback!=i||r&&r!=c.tag))return{listener:c,listenerArray:a,index:l}}return null},e.prototype.getEventListeners=function(e,t,i,r,n){if(void 0===this._listeners)return[];var o=function(e,t){var i=e.selector;if(i){if(i.isBaseObject){if(i!=t)return!1}else if(!i.test(e.condition,[t]))return!1}else if(e.object!=t)return!1;return!0},s=[],a=this._listeners;if(e){if(void 0===(h=a[e]))return[];if(!r&&this._isPauseEvent(e,n,i))return[];for(var l=0;l<h.length;l++){var u=h[l];t&&u.callback!=t||(i||u.tag)&&(i&&u.tag!=i||o(u,n)&&s.push(u))}}else for(var c in a){var h=a[c];if(r||!this._isPauseEvent(c,n,i))for(l=0;l<h.length;l++){o(u=h[l],n)&&s.push(u)}}return s},e.prototype.removeEventListener=function(e,t,i,r,n){if(void 0!==this._listeners){var o=this._listeners[e];if(void 0!==o)for(var s=0;s<o.length;s++){if((i=o[s]).object==n){if(i.selector)if(i.selector.isBaseObject){if(t!=i.selector)continue}else if(i.condition!=t)continue;if(!r||i.tag==r){var a=THING.onRemoveEventListener;a&&a(i),i.removed=!0,o.splice(s--,1)}}}}},e.prototype.removeAllListeners=function(){var e=THING.onRemoveEventListener;if(e)for(var t in this._listeners)this._listeners[t].forEach((function(t){e(t)}));this._listeners=void 0},e.prototype.checkObject=function(e,t){if(t.object){if(t.object!=e.object&&!t.object.canAcceptEvent(e))return!1;if(this._getStopPropagation(e)){if(e.object&&e.object.isChildOf(t.object))return!1;var i=e.intersect;if(i&&i.node.isChildOf(e.object.node))return!1}}return!0},e.prototype._getStopPropagation=function(e){var t;if(!(t=Et.isFunction(e.stopPropagation)?e._stopPropagation:e.stopPropagation)){var i=e.type;-1!==["levelchange","enterlevel","leavelevel","levelflyend","load","complete","mouseenter","mouseleave"].indexOf(i)&&(t=!0)}return t=Et.parseValue(THING.__stopEventPropagation__,t)},e.prototype.getBindingObjectBySelector=function(e,t,i){var r=this._getStopPropagation(e);if(i.isBaseObject){if(i!=e.object&&!r&&i.isChildOf(e.object))return e.object}else if(e.object){if(i.test(t.condition,[e.object]))return e.object;if(!r){var n=e.object.parents,o=i.queryResult(t.condition,n);if(o.length)return o[0]}}return null},e.prototype.getBindingObject=function(e,t,i){var r,n=t.selector,o=t.once;if(n){if(i)return null;if(!(r=this.getBindingObjectBySelector(e,t,n)))return null}else if(!this.checkObject(e,t))return null;var s=r||e.object||t.object||window;return o&&n&&s._ignoreEvents&&s._ignoreEvents.has(t)?null:s},e.prototype.dispatchEvent=function(e,t){if(void 0!==this._listeners){var i,r=this._listeners[e.type];if(void 0!==r)for(var n=r.slice(0),o=0;o<n.length;o++){var s=n[o],a=s.selector,l=s.userData,u=s.once,c=s.tag;if(!s.removed&&!this._isPauseEvent(e.type,e.object,c)){var h=this.getBindingObject(e,s,t);if(h&&!h.destroyed&&!this._isPauseEvent(e.type,h,c)){var p,d,f=e.data;l&&(e.data=l),a?h.isBaseObject&&(p=e.object,e.object=h):s.object&&(p=e.object,e.object=s.object),e.object&&(d=e.pickedObject,e.pickedObject=e.object);var m=e.beforeTrigger;m&&m(e);var g=THING.onBeforeCallEventListener;g&&g(s,e),h.isBaseObject&&(e.__lastObject__=h);var v=s.callback.call(h,e,s.tag);Et.isNull(v)||(i=v);var y=THING.onAfterCallEventListener;y&&y(s,e);var b=e.afterTrigger;if(b&&b(e),a?e.object==h&&(e.object=p):e.object==s.object&&(e.object=p),d?e.pickedObject=d:delete e.pickedObject,e.data=f,u)if(a)h._ignoreEvents=h._ignoreEvents||new Set,h._ignoreEvents.add(s);else{var _=r.indexOf(s);-1!==_&&r.splice(_,1)}}}}return i}},e}();cc._eventIDCount=1;var hc=function(){function e(t){n(this,e),this.app=t,this._pauseSelector=null,this._pauseEvents=new Map,this._resumeEvents=new Map}return e.prototype._isEvent=function(e,t,i,r,n){var o=e.get(t);if(!o)return!1;if(r&&o._tag_names&&!o._tag_names.has(r))return!1;for(var s=0,a=o.length;s<a;s++){var l=o[s],u=l.selector;if(i){if(Et.isString(i)){if(i!=u)continue}else if(u)if(u.isBaseObject){if(u!=i)continue}else if("*"!=u&&!this._pauseSelector.test(u,[i]))continue}else if(u)continue;if((!n||n(r,l.tag))&&(!l.parent||!i||i.isChildOf(l.parent)))return!0}return!1},e.prototype.isPauseEvent=function(e,t,i){function r(e,t){return!t||e==t}return e=Et.toLowerCase(e),!!this._isEvent(this._pauseEvents,e,t,i,r)&&!this._isEvent(this._resumeEvents,e,t,i,r)},e.prototype.isSameSelector=function(e,t){return e&&t&&e.isSelector&&t.isSelector?e.equals(t):e==t},e.prototype.update=function(){this._pauseEvents.forEach((function(e){for(var t=0;t<e.length;t++){e[t].justInFrame&&e.splice(t--,1)}}))},e.prototype.hasPauseEvent=function(e,t,i,r,n){var o=this._pauseEvents.get(e);if(!o)return!1;for(var s=0;s<o.length;s++){var a=o[s];if(this.isSameSelector(a.selector,t)&&(a.tag==i&&a.justInFrame==r&&a.parent==n))return!0}return!1},e.prototype.pauseEvent=function(e,t,i,r,n){if(e=Et.toLowerCase(e)){if(this._pauseSelector||(this._pauseSelector=new $t(this.app)),!this.hasPauseEvent(e,t,i,r,n)){var o={eventType:e,selector:t,tag:i,justInFrame:r,parent:n},s=this._pauseEvents.get(e);s||(s=[],this._pauseEvents.set(e,s)),i&&(s._tag_names=s._tag_names||new Set,s._tag_names.add(i)),s.push(o)}}else THING.Utils.error("event type is invalid, please check it")},e.prototype.removeResumeEvents=function(e,t,i,r){var n=this._resumeEvents.get(e);if(n)for(var o=0;o<n.length;o++){var s=n[o];s.selector==t&&(s.parent==r&&(i&&i!=s.tag||n.splice(o--,1)))}},e.prototype.resumeEvent=function(e,t,i,r){if(e=Et.toLowerCase(e)){var n=this._pauseEvents.get(e);if(n){t||(r=null);for(var o=0;o<n.length;o++){var s=n[o];if(this.isSameSelector(s.selector,t)&&s.parent==r){if(s.tag){if(s.tag!=i)continue}else if(i){var a=this._resumeEvents.get(e);a||(a=[],this._resumeEvents.set(e,a)),a.push({eventType:e,selector:t,tag:i,parent:r});continue}return this.removeResumeEvents(e,t,i,r),n.splice(o,1),!0}}return!1}}else THING.Utils.error("event type is invalid, please check it")},e.prototype.clear=function(){this._pauseSelector=null,this._pauseEvents=new Map,this._resumeEvents=new Map},e}(),pc=function(){function e(t){n(this,e),this.app=t,this._eventSelectors={residentEvents:{name:"residentEvents"},app:{name:"app"},objectEvents:{name:"objectEvents"}};var i=this;this._eventSelectors.forEach=function(e){e(i._eventSelectors.residentEvents),e(i._eventSelectors.app),e(i._eventSelectors.objectEvents)},this._eventSelectors.hasEvent=function(e,t,r,n,o){for(var s=[i._eventSelectors.residentEvents,i._eventSelectors.app,i._eventSelectors.objectEvents],a=0;a<s.length;a++)if(s[a].hasEvent(e,t,r,n,o))return!0;return!1},this._eventSelectors.forEach((function(e){i._initEventSelector(e)})),this._eventPauser=new hc(this.app),this._eventIDCount=0}return e.prototype._initEventSelector=function(e){var t=this,i=new cc(this.app);e._trigger=i,e._trigger._isPauseEvent=function(e,i,r){return t.isPauseEvent(e,i,r)},e.traverse=function(e){for(var t in i._listeners){if(!1===e(t,i._listeners[t]))return}},e.hasEvent=function(e,t,r,n,o){return!!i.getEventListener(e,"__any_event_can_match_it__",t,r,n,o)},e.getEvents=function(e,t,r,n,o){return i.getEventListeners(e,t,r,n,o)},e.traverseListener=function(e){i.traverseListener(e)},e.replaceObjectEvent=function(e,t){for(var r in i._listeners)i._listeners[r].forEach((function(i){i.selector==t&&(i.selector=e),i.object==t&&(i.object=e)}))},e.removeObjectEvent=function(e,t,r,n,o){i.removeEventListener(e,t,r,n,o)},e.bindObjectEvent=function(e,t,r,n,o,s,a,l){var u=i.getEventListener(e,t,null,s,!1,l,(function(e){return!!s&&(!e.tag||e.tag==s)}));u&&u.listenerArray.splice(u.index,1),i.addEventListener(e,t,r,n,o,s,a,l)},e.trigger=function(e,t){if(e.type=Et.toLowerCase(e.type),e.type)return i.dispatchEvent(e,t);THING.Utils.error("event type is invalid, please check it")}},e.prototype.isPauseEvent=function(e,t,i){return this._eventPauser.isPauseEvent(e,t,i)},e.prototype.hasPauseEvent=function(e,t,i,r,n){return this._eventPauser.hasPauseEvent(e,t,i,r,n)},e.prototype.pauseEvent=function(e,t,i,r,n){this._eventPauser.pauseEvent(e,t,i,r,n)},e.prototype.resumeEvent=function(e,t,i,r){return this._eventPauser.resumeEvent(e,t,i,r)},e.prototype.hasEvent=function(e,t,i,r,n){return!!this._eventSelectors.hasEvent(e,t,i,r,n)},e.prototype.getEvents=function(e,t,i,r,n){var o=[];return this._eventSelectors.forEach((function(s){var a=s.getEvents(e,t,i,r,n);a&&a.forEach((function(e){o.push(e)}))})),o},e.prototype.traverseListener=function(e){this._eventSelectors.forEach((function(t){t.traverseListener(e)}))},e.prototype.replaceObjectEvent=function(e,t){this._eventSelectors.forEach((function(i){i.replaceObjectEvent(e,t)}))},e.prototype.removeObjectEvent=function(e,t,i,r,n){this._eventSelectors.forEach((function(o){o.removeObjectEvent(e,t,i,r,n)}))},e.prototype.addEventListener=function(e,t,i){return this.bindCall(e,null,null,t,null,!1,i)},e.prototype.removeEventListener=function(e,t){return this.unbindCall(e,null,t)},e.prototype.bindCall=function(e,t,i,r,n,o,s){if(!(e=Et.toLowerCase(e)))return THING.Utils.error("event type is invalid, please check it"),null;var a=Et.parseEvent(t,i,r,n,null,s);return a?(a.selector?this._eventSelectors.objectEvents.bindObjectEvent(e,a.selector,a.userData,a.callback,a.priority,a.tag,o,this.app.root):this._eventSelectors.app.bindObjectEvent(e,a.selector,a.userData,a.callback,a.priority,a.tag,o,null),a):null},e.prototype.unbindCall=function(e,t,i){if(!(e=Et.toLowerCase(e)))return THING.Utils.error("event type is invalid, please check it"),null;var r=Et.parseEvent(t,null,i);return r?(r.selector?this._eventSelectors.objectEvents.removeObjectEvent(e,r.selector,r.callback,r.tag,this.app.root):this._eventSelectors.app.removeObjectEvent(e,r.selector,r.callback,r.tag),r):null},e.prototype.triggerCall=function(e){return this._eventSelectors.app.trigger(e,!0)},e.prototype.bindCallObj=function(e,t,i,r,n,o,s,a){if(!(e=Et.toLowerCase(e)))return THING.Utils.error("event type is invalid, please check it"),null;var l=Et.parseEvent(t,i,r,o,a);if(!l)return null;var u=this;return n.forEach((function(t){u._eventSelectors.objectEvents.bindObjectEvent(e,l.selector,l.userData,l.callback,l.priority,l.tag,s,t)})),l},e.prototype.unbindCallObj=function(e,t,i,r){e=Et.toLowerCase(e);var n=Et.parseEvent(t,null,i);if(!n)return null;var o=this;return r.forEach((function(t){o._eventSelectors.objectEvents.removeObjectEvent(e,n.selector,n.callback,n.tag,t)})),n},e.prototype.hasAnyCallObjects=function(e,t){var i=this._eventSelectors.objectEvents,r=!1,n=this;return i.traverse((function(i,o){if(o.object&&e.indexOf(o.object)){if(t&&n._isPauseEvent(i,o.object,o.tag))return;return r=!0,!1}})),r},e.prototype.dispatchBindCallObj=function(e,t,i,r){if(t=t||{},e=Et.toLowerCase(e)){if(Et.isString(t)&&!r&&(r=t,t={}),!r||Et.isString(r)){var n;Et.isNull(t.stopPropagation)&&(t.stopPropagation=function(){this._stopPropagation=!0});var o=this;return i.forEach((function(i){var s=t.object,a=t.type,l=t.tag;t.object=i,t.type=e,t.tag=r,n=o._eventSelectors.objectEvents.trigger(t),t.object=s,t.type=a,t.tag=l})),n}THING.Utils.error('Trigger "'+e+'" failed, due to tag is not string type')}else THING.Utils.error("event type is invalid, please check it")},e.prototype.addResidentEventListener=function(e,t){(e=Et.toLowerCase(e))?this._eventSelectors.residentEvents._trigger.addEventListener(e,null,null,t):THING.Utils.error("event type is invalid, please check it")},e.prototype.removeResidentEventListener=function(e,t){(e=Et.toLowerCase(e))?this._eventSelectors.residentEvents._trigger.removeEventListener(e,null,t):THING.Utils.error("event type is invalid, please check it")},e.prototype.update=function(){this._eventSelectors.forEach((function(e){e.trigger({type:"update"})})),this._eventPauser.update()},e.prototype.clear=function(){this._eventSelectors.forEach((function(e){e._trigger.removeAllListeners()})),this._eventPauser.clear()},e.prototype.unbindAppEvents=function(e){this._eventSelectors.forEach((function(t){for(var i in t._listeners)for(var r=t._listeners[i],n=0;n<r.length;n++){r[n].app.uuid==e&&r.splice(n--,1)}}))},e.prototype._isAppEvent=function(e){return-1!==["dragstart","drag","dragging","dragend","keydown","keypress","keyup"].indexOf(e)},e.prototype.dispatchEvent=function(e){var t=[this._eventSelectors.residentEvents,this._eventSelectors.app],i=[];if(t.forEach((function(t){var r=t.trigger(e);Et.isNull(r)||i.push(r)})),e.object){var r=e.object.trigger(e.type,e);if(Et.isNull(r)||i.push(r),!e._stopPropagation)for(var n=e.object.parent;n;n=n.parent){var o=n.canAcceptEvent(e);if(o){!0===o?o=n:n=o;var s=e.object;e.object=o;r=o._eventTrigger.dispatchEvent(e.type,o,e);Et.isNull(r)||i.push(r),e.object=s}}}if(this._isAppEvent(e.type)){r=this._eventSelectors.objectEvents.trigger(e);Et.isNull(r)||i.push(r)}if(i.length)return i[0]},e}(),dc=function(){function e(t){n(this,e),this.app=t,this.eventTriggerManager=new pc(this.app),this.eventProcessor=new uc(this.eventTriggerManager)}return e.prototype.addResidentEventListener=function(e,t){this.eventTriggerManager.addResidentEventListener(e,t)},e.prototype.removeResidentEventListener=function(e,t){this.eventTriggerManager.removeResidentEventListener(e,t)},e.prototype.addEventListener=function(e,t,i){this.eventTriggerManager.addEventListener(e,t,i)},e.prototype.removeEventListener=function(e,t){this.eventTriggerManager.removeEventListener(e,t)},e.prototype.dispatchEvent=function(e){return this.eventTriggerManager.dispatchEvent(e)},e.prototype.update=function(){this.eventProcessor.update(),this.eventTriggerManager.update()},e.prototype.bindCall=function(e,t,i,r,n,o,s){return this.eventTriggerManager.bindCall(e,t,i,r,n,o,s)},e.prototype.unbindCall=function(e,t,i){return"singleclick"==e&&this.eventProcessor.clearSingleClickTimer(),this.eventTriggerManager.unbindCall(e,t,i)},e.prototype.triggerCall=function(e){return this.eventTriggerManager.triggerCall(e)},e.prototype.bindCallObj=function(e,t,i,r,n,o,s,a){return this.eventTriggerManager.bindCallObj(e,t,i,r,n,o,s,a)},e.prototype.unbindCallObj=function(e,t,i,r){return this.eventTriggerManager.unbindCallObj(e,t,i,r)},e.prototype.hasAnyCallObjects=function(e,t){return this.eventTriggerManager.hasAnyCallObjects(e,t)},e.prototype.dispatchBindCallObj=function(e,t,i,r){return this.eventTriggerManager.dispatchBindCallObj(e,t,i,r)},e.prototype.isPauseEvent=function(e,t,i){return this.eventTriggerManager.isPauseEvent(e,t,i)},e.prototype.pauseEvent=function(e,t,i,r,n){this.eventTriggerManager.pauseEvent(e,t,i,r,n)},e.prototype.resumeEvent=function(e,t,i,r){return this.eventTriggerManager.resumeEvent(e,t,i,r)},e.prototype.hasEvent=function(e,t,i,r){return this.eventTriggerManager.hasEvent(e,null,i,r,t)},e.prototype.getEvents=function(e,t,i,r){return this.eventTriggerManager.getEvents(e,null,i,r,t)},e.prototype.traverseListener=function(e){return this.eventTriggerManager.traverseListener(e)},e.prototype.replaceObjectEvent=function(e,t){return this.eventTriggerManager.replaceObjectEvent(e,t)},e.prototype.canClick=function(e){return!(this.eventProcessor.getDistanceOfLastMouseDown(e)>4)},e.prototype.isKeyPressed=function(e){return Et.isNumber(e)?!!this.eventProcessor.keyCodesPressed[e]:!!this.eventProcessor.keysPressed[e]},e.prototype.clear=function(){this.eventTriggerManager.clear(),this.eventProcessor.clear()},e.prototype.clearSingleClickTimer=function(){this.eventProcessor.clearSingleClickTimer()},e.prototype.unbindAppEvents=function(e){this.eventTriggerManager.unbindAppEvents(e)},o(e,[{key:"mousePosition",get:function(){return this.eventProcessor.mouseMovePos}},{key:"skipFrameCount",set:function(e){this.eventProcessor.skipFrameCount=e},get:function(){return this.eventProcessor.skipFrameCount}}]),e}(),fc=function(){function e(t,i,r){for(var o in n(this,e),this.app=t,this.name=i,this.defaultKeyName="name",this.initialState=null,this.runningState=null,this.states=new Map,r)this.addState(o,r[o])}return e.prototype.getFromState=function(e,t){var i=e[t.stateType];if(void 0!==i&&Et.isFunction(i)){var r=e[t.stateType](t);if(null!==r)return r}return null},e.prototype.dispatchEventToState=function(e,t){var i=e[t.stateType];void 0!==i&&Et.isFunction(i)&&e[t.stateType](t,t.params)},e.prototype.findState=function(e){return this.states.get(e)},e.prototype.prevState=function(){this.dispatchEvent({stateType:"onPrevState"})},e.prototype.nextState=function(){this.dispatchEvent({stateType:"onNextState"})},e.prototype.clone=function(t){var i={},r=this.app.stateManager.stateFactory,n=this.states.keys(),o=Array.isArray(n),s=0;for(n=o?n:n[Symbol.iterator]();;){var a;if(o){if(s>=n.length)break;a=n[s++]}else{if((s=n.next()).done)break;a=s.value}var l=a,u=r.get(l);if(!u)return null;i[l]=new u(this.app)}return new e(this.app,t,i)},e.prototype.get=function(e){if(this.runningState)return this.getFromState(this.runningState,e);if(this.states.length>1){var t=this.states,i=Array.isArray(t),r=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(r>=t.length)break;n=t[r++]}else{if((r=t.next()).done)break;n=r.value}var o=n,s=this.getFromState(o,e);if(null!==s)return s}}return null},e.prototype.dispatchEvent=function(e){var t=this;this.runningState?this.dispatchEventToState(this.runningState,e):this.states.length>1&&this.states.forEach((function(i){t.dispatchEventToState(i,e)}))},e.prototype.enter=function(e,t){t=t||{};var i=this.findState(e);if(!i)return null;this.initialState||(this.initialState=i);var r=this.runningState;return this.leave(),this.app.trigger("beforeEnterState",{state:r,nextState:i}),r&&(t.prevState=r),this.runningState=i,this.dispatchEventToState(this.runningState,{stateType:"onEnter",params:t}),this.app.trigger("afterEnterState",{state:i,prevState:t.prevState}),delete t.prevState,this.runningState},e.prototype.leave=function(){if(this.runningState){var e={};this.runningState&&(e.state=this.runningState,e.stateName=this.runningState[this.defaultKeyName]),this.app.trigger("beforeLeaveState",e),this.dispatchEventToState(this.runningState,{stateType:"onLeave"}),this.runningState=null,this.app.trigger("afterLeaveState",e)}},e.prototype.addState=function(e,t){void 0===t[this.defaultKeyName]&&(t[this.defaultKeyName]=e),t.isState=!0,t.stateGroup=this,this.states.set(e,t)},e.prototype.isInitialState=function(){return this.runningState==this.initialState},e.prototype.isRunningState=function(e){var t=this.findState(e);return!!t&&t==this.runningState},e.prototype.getRunningStateName=function(){if(this.runningState){var e=this.states.keys(),t=Array.isArray(e),i=0;for(e=t?e:e[Symbol.iterator]();;){var r;if(t){if(i>=e.length)break;r=e[i++]}else{if((i=e.next()).done)break;r=i.value}var n=r;if(this.runningState==this.states.get(n))return n}}return""},e.prototype.hasState=function(e){if(Et.isString(e))return this.states.has(e);var t=this.states.keys(),i=Array.isArray(t),r=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(r>=t.length)break;n=t[r++]}else{if((r=t.next()).done)break;n=r.value}var o=n;if(e==this.states.get(o))return!0}return!1},e.prototype.clear=function(){this.leave();for(var e=[].concat(this.states.values()),t=0;t<e.length;t++)delete e[t];delete this.states},e}(),mc=function(){function e(t){n(this,e),this.app=t,this.eventManager=t.events,this.stateFactory=new Map,this.stateGroupID=1,this.stateGroups=new Array,this.init()}return e.prototype.init=function(){var e={click:"onClick",dblclick:"onDoubleClick",singleclick:"onSingleClick",mouseover:"onMouseOver",mouseout:"onMouseOut",mouseup:"onMouseUp",mousedown:"onMouseDown",mousemove:"onMouseMove",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",keydown:"onKeyDown",keypress:"onKeyPress",keyup:"onKeyUp"},t=this;for(var i in e)this.eventManager.addResidentEventListener(i,(function(i){i.stateType=e[i.type],t.dispatchEvent(i),delete i.stateType}))},e.prototype.clear=function(){this.stateFactory.clear(),this.stateGroupID=1,this.stateGroups=[]},e.prototype.findState=function(e){var t=this.stateGroups,i=Array.isArray(t),r=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(r>=t.length)break;n=t[r++]}else{if((r=t.next()).done)break;n=r.value}var o=n.findState(e);if(o)return o}return null},e.prototype.findStateGroup=function(e){var t=this.stateGroups,i=Array.isArray(t),r=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(r>=t.length)break;n=t[r++]}else{if((r=t.next()).done)break;n=r.value}var o=n;if(o.name==e||o.hasState(e))return o}return null},e.prototype.get=function(e){for(var t=0;t<this.stateGroups.length;t++){var i=this.stateGroups[t].get(e);if(i)return i}return null},e.prototype.dispatchEvent=function(e){Et.isString(e)?this.dispatchEvent({type:e}):this.stateGroups.forEach((function(t){t.dispatchEvent(e)}))},e.prototype._genGroupName=function(){var e="StateManagerInternal_"+this.stateGroupID.toString();return this.stateGroupID++,e},e.prototype.clone=function(e){var t=this.findStateGroup(e);if(!t)return null;e=this._genGroupName();var i=t.clone(e);return this.stateGroups.push(i),i},e.prototype.remove=function(e){for(var t=0;t<this.stateGroups.length;t++)if(this.stateGroups[t]==e)return e.leave(),this.stateGroups[t].clear(),this.stateGroups.splice(t,1),!0;return!1},e.prototype.register=function(e,t){if(Et.isNull(e))return null;if(Et.isArray(e))return THING.Utils.error("states should not be array type, use {} instead"),null;var i=Object.keys(e);1==i.length&&void 0===t&&(t=i[0]),Et.isBlank(t)&&(t=this._genGroupName());var r=this.findStateGroup(t);if(r)for(var n in e)r.addState(n,e[n]);else r=new fc(this.app,t,e),this.stateGroups.push(r);return r},e.prototype.registerEx=function(e,t){for(var i in e)this.stateFactory.set(i,e[i]),e[i]=new e[i](this.app);return this.register(e,t)},e.prototype.unregister=function(e){for(var t=0;t<this.stateGroups.length;t++)if(this.stateGroups[t].name==e)return this.stateGroups[t].clear(),this.stateGroups.splice(t,1),!0;return!1},e.prototype.change=function(e,t){var i=this.findStateGroup(e);if(!i)return THING.Utils.error("state group not found: "+e),null;var r=i.enter(e,t);return r||null},e.prototype.leave=function(e){var t=this.findStateGroup(e);return t?!!t.isRunningState(e)&&(t.leave(),!0):(THING.Utils.error("state group not found: "+e),!1)},e.prototype.getRunningState=function(e){var t=this.findStateGroup(e);return t?t.runningState:(THING.Utils.error("state group not found: "+name),null)},e.prototype.getRunningStateName=function(e){var t=this.findStateGroup(e);return t?t.getRunningStateName():(THING.Utils.error("state group not found: "+name),null)},e.prototype.hasRunningState=function(e){var t=this.findStateGroup(e);return!!t&&!!t.runningState},e.prototype.update=function(){this.dispatchEvent({stateType:"onUpdate"})},e.prototype.onUpdate=function(e){this.update(e)},e}(),gc=function(){function e(t,i){n(this,e),this.app=t,this.reverseMode=i,this.commands=[]}return e.prototype.execute=function(){for(var e=0;e<this.commands.length;e++){this.commands[e].execute()}this.app.events.dispatchEvent({type:"executeCommand",cmd:this}),this.reverseMode&&this.commands.reverse()},e.prototype.undo=function(){for(var e=0;e<this.commands.length;e++){this.commands[e].undo()}this.reverseMode&&this.commands.reverse()},e.prototype.add=function(e){e&&this.commands.push(e)},e.prototype.remove=function(e){if(e){var t=this.commands.indexOf(e);t>-1&&this.commands.slice(t,1)}},e.prototype.clear=function(){this.commands.clear()},e}(),vc=function(){function e(t){n(this,e),this.app=t,this.registerTypes={},this.undoList=[],this.redoList=[],this._doing=!1}return e.prototype.register=function(e,t){this.registerTypes[e]=t},e.prototype.unregister=function(e){delete this.registerTypes[e]},e.prototype._create=function(e){var t=e.type,i=this.registerTypes[t];if(i){e.app=this.app;var r=new i(e);return r.type=t,r}THING.Utils.error("command not found: "+t)},e.prototype.create=function(e,t){if(Et.isArray(e)){for(var i=new gc(this.app,t),r=0;r<e.length;r++){var n=this._create(e[r]);i.add(n)}if(i.commands.length)return i}else{if(Et.isObject(e))return n=this._create(e);Et.isString(e)}return null},e.prototype.execute=function(e,t){var i=this.create(e,t);return i?(i.execute(),this._push(i),this.app.events.dispatchEvent({type:"executeCommand",cmd:i}),i):null},e.prototype._push=function(e){this._doing||(this.undoList.push(e),this.redoList.splice(0,this.redoList.length),this.app.events.dispatchEvent({type:"push"}))},e.prototype.push=function(e){this._push(e)},e.prototype.redo=function(){if(0!=this.redoList.length){this._doing=!0;var e=this.redoList.pop();e.execute(),this.undoList.push(e),this.app.events.dispatchEvent({type:"executeCommand",cmd:e}),this.app.events.dispatchEvent({type:"redo",cmd:e}),this._doing=!1}},e.prototype.undo=function(){if(0!=this.undoList.length){this._doing=!0;var e=this.undoList.pop();e.undo(),this.redoList.push(e),this.app.events.dispatchEvent({type:"executeCommand",cmd:e}),this.app.events.dispatchEvent({type:"undo",cmd:e}),this._doing=!1}},e.prototype.getRedoCount=function(){return this.redoList.length},e.prototype.getUndoCount=function(){return this.undoList.length},e.prototype.toJson=function(){for(var e=0;e<this.undoList.length;e++)this.undoList[e];return"not impl~"},e}(),yc=new THREE.Vector2,bc=function(){function e(t){n(this,e),this.app=t,this.events=t.events,this.baseURL=t.baseURL,this.scene=t.scene,this.renderer=t.renderer,this.objectManager=t.objectManager,this.resourceManager=t.resourceManager,this._background=null,this._backgroundResource=null,this._backgroundAdditiveColor=new THREE.Color(0,0,0),this._backgroundColorScaleFactor=new THREE.Vector3(1,1,1),this._skyBox=null,this._skyBoxResource=null,this._fogEnable=!1,this._fogConfig={},this._fogLinear=null,this._fogExp2=null,this._enableDeafultViewPointFile=!1,this._defaultViewPointFileName="viewpoint.json",this.init()}return e.prototype.init=function(){this.initRenderControl()},e.prototype.initRenderControl=function(){var e=new THREE.Vector3,t=new THREE.Vector3;function i(i,r){i.node.traverse((function(n){if(n.material){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(n.matrixWorld);var o=e.distanceTo(t);i.renderDistance>0&&(n.visible=o<i.renderDistance),i.shadowDistance>0&&(n.castShadow=o<i.shadowDistance)}}))}var r=this;this.app.scene.onBeforeRender=function(){var e=r.app.renderCamera;r.objectManager.renderDistanceObjects.forEach((function(t){i(t,e)})),r.objectManager.shadowDistanceObjects.forEach((function(t){i(t,e)}))}},e.prototype.synBackgroundColor=function(){var e=this._skyBoxResource;if(e&&e.isCubeTexture){e.colorMatrix=e.colorMatrix||new THREE.Matrix4;var t=this._backgroundAdditiveColor;if(t){var i=new THREE.Vector3(t.r,t.g,t.b);e.colorMatrix.setPosition(i)}var r=this._backgroundColorScaleFactor;if(r){var n=new THREE.Vector3(r.x,r.y,r.z);e.colorMatrix.setScale(n)}}},e.prototype._keepBackgroundAspect=function(){if(this._backgroundResource&&this._backgroundResource.isTexture){var e=this._backgroundResource,t=this.app.renderer.getSize(yc),i=t.width/t.height,r=e.image.width/e.image.height;i>r?(e.offset.set(0,.5-r/i*.5),e.repeat.set(1,r/i)):(e.offset.set(.5-i/r*.5,0),e.repeat.set(i/r,1))}},e.prototype._resetBackgroundAspect=function(){if(this._backgroundResource&&this._backgroundResource.isTexture){var e=this._backgroundResource;e.offset.set(0,0),e.repeat.set(1,1)}},e.prototype.closeSkyEffect=function(){this.setSkyEffect(null)},e.prototype.setSkyEffect=function(e){e?(this._skyEffect||(this._skyEffect=this.app.create({type:"SkyEffect",parent:this.app.root})),this._skyEffect.setConfig(e),this._skyEffect.visible=!0,this.app._lightGroup&&(this.app._lightGroup.visible=!this._skyEffect.getConfig().light)):(this._skyEffect&&(this._skyEffect.visible=!1),this.app._lightGroup&&(this.app._lightGroup.visible=!0))},e.prototype.setFogLinear=function(e,t,i){e=Et.parseColor(e),this._fogLinear?(this._fogLinear.color.set(e),this._fogLinear.near=t,this._fogLinear.far=i):this._fogLinear=new THREE.Fog(e,t,i),this.app.scene.fog=this._fogLinear},e.prototype.clearFogLinear=function(){this._fogLinear&&(this._fogLinear=null,this.app.scene.fog=null)},e.prototype.setFogExp2=function(e,t){e=Et.parseColor(e),this._fogExp2?(this._fogExp2.color.set(e),this._fogExp2.density=t):this._fogExp2=new THREE.FogExp2(e,t),this.app.scene.fog=this._fogExp2},e.prototype.clearFogExp2=function(){this._fogExp2&&(this._fogExp2=null,this.app.scene.fog=null)},e.prototype.closeFog=function(){this.clearFogLinear(),this.clearFogExp2(),this._fogEnable=!1},e.prototype.setFog=function(e){e=e||{},this._fogConfig=Et.mergeObject(this._fogConfig,e,!0);var t=e.type,i=e.color||8421504;if("Exp2"==t){var r=e.density||.1;this.setFogExp2(i,r)}else{var n=e.near||10,o=e.far||100;this.setFogLinear(i,n,o)}this._fogEnable=!0,this.app.needUpdate=!0},e.prototype.onResize=function(e,t){if(this._backgroundResource&&this._backgroundResource.isCanvasTexture){var i=this._backgroundResource,r=e/t,n=i.image.width/i.image.height;r<n?(i.offset.set(0,.5-n/r*.5),i.repeat.set(1,n/r)):(i.offset.set(.5-r/n*.5,0),i.repeat.set(r/n,1))}},e.prototype.onUpdate=function(e){this._backgroundResource&&this._backgroundResource.isCanvasTexture&&(this._backgroundResource.needsUpdate=!0)},e.prototype.showLightHelper=function(e){THING.Utils.warn("[SceneManager] Please use app.lighting={ showHelper: "+e+" } instead"),this.app._lightGroup.setConfig({showHelper:e})},e.prototype.closeSceneLights=function(){THING.Utils.warn("[SceneManager] Please use app.lighting=null instead"),this.app._lightGroup.setConfig(pu)},o(e,[{key:"background",set:function(e){var t=this;if(this.background!=e){if(this._skyBox=null,this._backgroundResource&&this._backgroundResource.name!=e&&(this._backgroundResource.isTexture&&this._backgroundResource.dispose(),this._backgroundResource=null),this._background=e,e){var i=Et.parseColor(e,null);if(i)this.scene.background=i,this._backgroundResource=i;else if(Et.isString(e))if(this._backgroundResource)this.scene.background=this._backgroundResource;else{var r=this.app.confirmURL(e);this.app.resourceManager.loadTexture(r,(function(i){t._background==e&&(t.scene.background=i,t._backgroundResource=i,t._backgroundResource.name=e,t.app.keepBackgroundAspect?t._keepBackgroundAspect():t._resetBackgroundAspect())}))}else"CANVAS"==e.tagName?(this._backgroundResource=new THREE.CanvasTexture(e),this._backgroundResource.needsUpdate=!0,this.scene.background=this._backgroundResource,this.app.keepBackgroundAspect?this._keepBackgroundAspect():this._resetBackgroundAspect()):"VIDEO"==e.tagName&&(this._backgroundResource=new THREE.VideoTexture(e),this._backgroundResource.needsUpdate=!0,this.scene.background=this._backgroundResource,this.app.keepBackgroundAspect?this._keepBackgroundAspect():this._resetBackgroundAspect())}else this.scene.background=Et.parseColor(this.app._bgColor);this.app.trigger("backgroundChanged",{background:e})}},get:function(){return this._background}},{key:"backgroundAdditiveColor",set:function(e){this._backgroundAdditiveColor=Et.parseColor(e),this.synBackgroundColor()},get:function(){return this._backgroundAdditiveColor.toHexString()}},{key:"backgroundColorScaleFactor",set:function(e){this._backgroundColorScaleFactor=Et.parseVector3(e),this.synBackgroundColor()},get:function(){return this._backgroundColorScaleFactor.toArray()}},{key:"skyBox",set:function(e){if(this.skyBox!=e){this._background=null,this._skyBox=e,this.app.trigger("skyboxchange",{skyBox:e});var t=void 0;if(this._skyBoxResource){if(this._skyBoxResource.name==e)return void(this.scene.background=this._skyBoxResource);t=this._skyBoxResource}var i=this;if(Et.isString(e)&&(e.indexOf(".png")>-1||e.indexOf(".jpg")>-1))this.app.resourceManager.loadTexture(this.app.confirmURL(e),(function(r){i._skyBox==e&&(i.scene.background=r,i._skyBoxResource=r,i._skyBoxResource.name=e,i.synBackgroundColor(),t&&t.dispose())}),{mapping:THREE.EquirectangularReflectionMapping});else{var r=this.app.confirmURL(Et.parseCubeTextureUrls(e));r?this.app.resourceManager.loadCubeTexture(r,(function(r){i._skyBox==e&&(r.format=THREE.RGBFormat,i.scene.background=r,i._skyBoxResource=r,i._skyBoxResource.name=e,i.synBackgroundColor(),t&&t.dispose())})):this.scene.background=Et.parseColor(this.app._bgColor)}}},get:function(){return this._skyBox}},{key:"enableDeafultViewPointFile",set:function(e){this._enableDeafultViewPointFile=e},get:function(){return this._enableDeafultViewPointFile}},{key:"defaultViewPointFileName",set:function(e){this._defaultViewPointFileName=e},get:function(){return this._defaultViewPointFileName}},{key:"fogEnable",get:function(){return this._fogEnable}},{key:"skyEffectEnable",get:function(){return!!this.sky}}]),e}();function _c(e,t){var i=e.get(t.key);if(i){if(i.refCount&&i.refCount--,i.refCount)return!1;t.dispose(),e.delete(t.key)}return!0}var xc=new THREE.Color,Ec=new THREE.Vector3;function wc(e,t){xc.setStyle(e),Ec.set(xc.r,xc.g,xc.b).multiplyScalar(255),void 0===t&&((t=new THREE.DataTexture(new Uint8Array(16),2,2)).magFilter=t.minFilter=THREE.NearestFilter);var i=Ec.x,r=Ec.y,n=Ec.z;return t.image.data.set([i,r,n,255,i,r,n,255,i,r,n,255,i,r,n,255]),t.needsUpdate=!0,t}var Tc=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n(this,e),this.app=t,this._textures=new Map,this._cubeTextures=new Map,this._enableFileNameAsKey=i,this._textureLoader=new THREE.TextureLoader(this.app.loadingManager),this._cubeTextureLoader=new THREE.CubeTextureLoader,this._imageLoader=new THREE.ImageLoader}return e.prototype.loadTexture=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments[3],n=this,o=arguments[4],s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=e.getNormalize(),l=void 0;l=this._enableFileNameAsKey&&!s?a.getFileName(!1):a,i.repeat&&(l+="_repeat"),i.anisotropy&&(l+="_a"+i.anisotropy),i.mapping&&(l+="_m"+i.mapping),!1===i.flipY&&(l+="_y"+i.flipY),i.premultiplyAlpha&&(l+="_premultAlpha");var u=this._textures.get(l);return u?(u.refCount++,t&&(u.image?Et.timer.setTimeout((function(){return t(u)}),10):(u.delayLoadCallbacks=u.delayLoadCallbacks||[],u.delayLoadCallbacks.push(t)))):((u=this._textureLoader.load(a,(function(e){var r=e.image;i.repeat&&(e.wrapS=e.wrapT=THREE.RepeatWrapping),i.anisotropy&&(e.anisotropy=i.anisotropy),i.mapping&&(e.mapping=i.mapping),!1===i.flipY&&(e.flipY=i.flipY),i.premultiplyAlpha&&(e.premultiplyAlpha=i.premultiplyAlpha),t&&t(e);var o=e.delayLoadCallbacks;o&&(o.forEach((function(t){return t(e)})),e.delayLoadCallbacks=[]);var s=n.app.options.maxTextureSize;(r.width>s||r.height>s)&&THING.Utils.warn("The '"+r.src+"' texture is too big("+r.width+"x"+r.height+"), max size: ("+s+"x"+s+")")}),r,o)).key=l,u.refCount=u.refCount||1,this._textures.set(l,u)),u},e.prototype.loadCubeTexture=function(e,t){var i=this.app.confirmURL(Et.parseCubeTextureUrls(e));if(!i)return null;var r=i.toString(),n=this._cubeTextures.get(r);if(n)n.refCount++,t&&(n.version>0?Et.timer.setTimeout((function(){return t(n)}),10):(n.delayLoadCallbacks=n.delayLoadCallbacks||[],n.delayLoadCallbacks.push(t)));else{var o=function(e){var i=e.image;if(i&&6===i.length){for(var r=i[0].width,n=i[0].height,o=1;o<i.length;o++){var s=i[o];if(s.width!=r||s.height!=n)return void THING.Utils.error("Load cube texture failed, due to image size is invalid, please make sure all size of images must be the same")}t&&t(e);var a=e.delayLoadCallbacks;a&&(a.forEach((function(t){return t(e)})),e.delayLoadCallbacks=[])}};!function(e){return e[1]===e[0]&&e[2]===e[0]&&e[3]===e[0]&&e[4]===e[0]&&e[5]===e[0]}(i)?n=this._cubeTextureLoader.load(i,o):(n=new THREE.CubeTexture,this._imageLoader.load(i[0],(function(e){n.images=[e,e,e,e,e,e],n.needsUpdate=!0,o(n)}))),n.key=r,n.refCount=n.refCount||1,this._cubeTextures.set(r,n)}return n},e.prototype.loadTextureFromImage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this._textures.get(e);return i?i.refCount++:((i=new THREE.Texture).image=e,i.needsUpdate=!0,i.key=e,i.refCount=1,this._textures.set(e,i)),t.repeat&&(i.wrapS=i.wrapT=THREE.RepeatWrapping),t.anisotropy&&(i.anisotropy=t.anisotropy),t.mapping&&(i.mapping=t.mapping),!1===t.flipY&&(i.flipY=t.flipY),t.premultiplyAlpha&&(i.premultiplyAlpha=t.premultiplyAlpha),i},e.prototype.loadTextureFromColor=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this._textures.get(e);return i?i.refCount++:((i=wc(e)).key=e,i.refCount=1,this._textures.set(e,i)),t.repeat&&(i.wrapS=i.wrapT=THREE.RepeatWrapping),t.anisotropy&&(i.anisotropy=t.anisotropy),t.mapping&&(i.mapping=t.mapping),!1===t.flipY&&(i.flipY=t.flipY),t.premultiplyAlpha&&(i.premultiplyAlpha=t.premultiplyAlpha),i},e.prototype.load=function(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.loadTexture(e,t,{},i,r,n)},e.prototype.removeTexture=function(e){return!!_c(this._textures,e)&&(!!_c(this._cubeTextures,e)&&((void 0===e.refCount||!e.refCount||(e.refCount--,!e.refCount))&&(e.dispose(),!0)))},e.prototype.setCrossOrigin=function(e){return this._textureLoader.setCrossOrigin(e),this._cubeTextureLoader.setCrossOrigin(e),this},e.prototype.destroyTextureWithUrl=function(e,t){t=t||{},e=(e=this.app.confirmURL(e)).getNormalize(),(t.repeat||void 0===t.repeat)&&(e+="_repeat"),t.anisotropy&&(e+="_a"+t.anisotropy),t.mapping&&(e+="_m"+t.mapping),!1===t.flipY&&(e+="_y"+t.flipY),t.premultiplyAlpha&&(e+="_premultAlpha");var i=this._textures.get(e);i&&(i.dispose(),this._textures.delete(e))},o(e,[{key:"enableFileNameAsKey",set:function(e){this._enableFileNameAsKey=e},get:function(){return this._enableFileNameAsKey}},{key:"repetitionRate",get:function(){if(!this._textures.size)return 0;var e=0;return this._textures.forEach((function(t){e+=t.refCount})),e/this._textures.size-1}}]),e}(),Mc=function(){function e(t){n(this,e),this.app=t,this._deadObjects=[],this.init(),THING.DisposeObjectNumberInFrame=THING.DisposeObjectNumberInFrame||100}return e.prototype.init=function(){this.textureLoader=new Tc(this.app,this.app.options.enableTextureFileNameAsKey),this.textureLoader.setCrossOrigin("anonymous"),this.app.loadingManager.loadingManager.addHandler(/.*(.jpg|.png)$/,this.textureLoader)},e.prototype.disposeMaterial=function(e,t){return(void 0===e.refCount||(e.refCount--,!e.refCount))&&(e.dispose(),t||this.disposeTextures(e),!0)},e.prototype.disposeTextures=function(e){if(e)for(var t in e){var i=e[t];i&&i.isTexture&&this.textureLoader.removeTexture(i)&&(e[t]=null)}},e.prototype.disposeGeometry=function(e){if(void 0!==e.refCount){if(e.refCount--,e.refCount)return!1;e.dispose()}else{if(this.app.scene.hasGeometry(e))return!1;e.dispose(),e._hasDisposed=!0}return!0},e.prototype.doDispose=function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(null!==e){if(i&&!1===i(e))return!1;if(e._skipDispose)return this.app.picker.removePickingResources(e),!1;if(r&&e.children)for(var n=e.children.concat(),o=0;o<n.length;o++){var s=this.doDispose(n[o],t,i);s&&e.remove(n[o])}var a=e.geometry;if(a&&!e.isSprite&&this.disposeGeometry(a),e.material){var l=!1;if(Et.isArray(e.material)){var u=e.material.concat();e.material=[];for(o=0;o<u.length;o++){var c=u[o];l=this.disposeMaterial(c,t)}}else l=this.disposeMaterial(e.material,t);l&&this.app.picker.removePickingResources(e)}e.isSkinnedMesh&&(t||this.disposeTextures(e.skeleton))}return!0},e.prototype.remove=function(e,t){e&&(e.removeBySelf(),this.unload(e,t))},e.prototype.unload=function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e&&(e.isObject3D?r?this._deadObjects.push({node:e,keepTexture:t,filterFunc:i,recursive:n}):this.doDispose(e,t,i,n):THING.Utils.error("must provide Object3D to unload"))},e.prototype.loadCubeTexture=function(e,t){return this.textureLoader.loadCubeTexture(e,t)},e.prototype.loadTexture=function(e,t,i){var r=null;return Et.isString(e)?r=this.textureLoader.loadTexture(e,t,i):(r=this.textureLoader.loadTextureFromImage(e),t&&t(r)),r},e.prototype.onUpdate=function(){if(this._deadObjects.length)for(var e=Math.min(this._deadObjects.length,THING.DisposeObjectNumberInFrame||1),t=0;t<e;t++){var i=this._deadObjects[0];this.doDispose(i.node,i.keepTexture,i.filterFunc,i.recursive),this._deadObjects.splice(0,1)}},e}(),Cc=function(){function e(t){n(this,e),this.app=t;var i=this;this.loadingManager=new THREE.LoadingManager((function(){}),(function(e,t,r){0!=r&&i.app.mainUI.updateDownloadingProgress(t/r)}),(function(e){THING.Utils.error("[onError] url: "+e)})),thingjs.GLTFLoader.defaultManager=this.loadingManager}return e.prototype.itemStart=function(e){this.loadingManager.itemStart(e)},e.prototype.itemEnd=function(e){this.loadingManager.itemEnd(e)},e.prototype.itemError=function(e){this.loadingManager.itemError(e)},e.prototype.resolveURL=function(e){return this.loadingManager.resolveURL(e)},e.prototype.setURLModifier=function(e){return this.loadingManager.setURLModifier(e)},e.prototype.getHandler=function(e){return this.loadingManager.getHandler(e)},e}(),Sc={temporalSuperSampling:{enable:!1,size:30},postEffect:{enable:!0,bloom:{enable:!1,strength:.14,radius:.4,threshold:.7},screenSpaceAmbientOcclusion:{enable:!1,radius:.2,quality:"medium",intensity:.8,temporalFilter:!0,ignoreTransparent:!1},screenSpaceReflection:{enable:!1,maxRayDistance:200,pixelStride:16,pixelStrideZCutoff:50,screenEdgeFadeStart:.9,eyeFadeStart:.4,eyeFadeEnd:.8,minGlossiness:.2},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1.1,saturation:1.1,gamma:1},dof:{enable:!1,focalDepth:1,focalLength:24,fstop:.9,maxblur:1,threshold:.9,gain:1,bias:.5,dithering:1e-4},vignette:{enable:!1,type:"blur",color:0,offset:1.5},film:{enable:!1,grayscale:!1,noiseIntensity:.35,scanlinesIntensity:0,scanlinesCount:2048},RBSplit:{enable:!1,offsetX:2,offsetY:2,power:2},chromaticAberration:{enable:!1,chromaFactor:.025},blur:{enable:!1,radius:5,bounds:[[0,0,.5,.5],[.5,.5,1,1]]},FXAA:{enable:!1},MSAA:{enable:!0}}},jc=function(){function e(t,i){n(this,e),this._manager=t,this._defaultConfig=Et.cloneObject(i,!1),this._config=Et.cloneObject(i,!1)}return e.prototype.setConfig=function(e){return this._config=Et.cloneObject(e,!1),this},e.prototype.getConfig=function(){return this._config},e.prototype.save=function(){return this._defaultConfig=Et.cloneObject(this._config,!1),this},e.prototype.mergeConfig=function(e){return e=Et.cloneObject(e,!1),Et.mergeObject(e,this._config),this._config=e,this},e.prototype.mergeWithSavedConfig=function(e){return e=Et.cloneObject(e,!1),Et.mergeObject(e,this._defaultConfig),this._config=e,this},e.prototype.lock=function(){return this._manager.lock(this),this},e.prototype.unlock=function(){return this._manager.unlock(this),this},e.prototype.update=function(e){return this._manager._update(this,e),this},e.prototype.active=function(e){return this._manager._active(this,e),this},e.prototype.destroy=function(){this._manager=null,this._config=null,this._defaultConfig=null},e}(),Pc=function(){function e(){n(this,e),this._lockedControl=null,this._control=null}return e.prototype.createControl=function(e){return new jc(this,e)},e.prototype.lock=function(e){this._lockedControl=e},e.prototype.unlock=function(e){this._lockedControl===e&&(this._lockedControl=null)},e.prototype.getActiveControl=function(){return this._control},e.prototype.getCurrentControl=function(){return this._lockedControl||this._control},e.prototype._active=function(e,t){return this._lockedControl!==e&&(this._control=e),this._lockedControl||this._control},e.prototype._update=function(e,t){var i=this.getCurrentControl();return i===e?i:null},e.prototype.destroy=function(){this._lockedControl=null,this._control=null},e}();var Rc=new THREE.Vector2,Dc=function(e){function t(i,r){n(this,t);var o=a(this,e.call(this));o.app=i,i.renderer.localClippingEnabled=!0;var s=i.renderer.getDrawingBufferSize(Rc),l=s.width,u=s.height;return o._mainRenderer=new Eo(l,u,{stencil:r,maxSamples:i.renderer.capabilities.maxSamples}),o._mainRenderer.combineGlow=!0,o._captureRenderTarget=new THREE.WebGLRenderTarget(l,u,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),o._captureBuffer=new Uint8Array(4*l*u),o.autoDirty=!1,o}return s(t,e),t.prototype.createControl=function(e){return new Ac(this,e)},t.prototype._active=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.app.root.box;t=e.prototype._active.call(this,t),this._mainRenderer.setConfig(t._config,i)},t.prototype._update=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.app.root.box,r=e.prototype._update.call(this,t);r&&this._mainRenderer.setConfig(r._config,i)},t.prototype.update=function(){this.autoDirty&&this._mainRenderer.dirty(),this._mainRenderer.render(this.app.renderer,this.app.scene,this.app.renderCamera);var e=this.app.cssScene;e.children.length&&this.app.cssRenderer.render(e,this.app.renderCamera),this.app.picker.render(this.app.renderer)},t.prototype.resize=function(e,t){this.app.renderer.setSize(e,t),this.app.cssRenderer.setSize(e,t);var i=this.app.renderer.getDrawingBufferSize(Rc);this._mainRenderer.setSize(i.width,i.height),this._resizeCaptureBuffer(e,t)},t.prototype._resizeCaptureBuffer=function(e,t){this._captureRenderTarget.setSize(e,t);var i=4*e*t;this._captureBuffer.length!==i&&(this._captureBuffer=new Uint8Array(i))},t.prototype.capture=function(e,t){var i=this.app.renderer.getSize(Rc);e=e||i.width,t=t||i.height,this._mainRenderer.setSize(e,t),this.app.renderCamera.setSize(e,t),this._resizeCaptureBuffer(e,t);var r=this.app.renderEffects.getConfig().postEffect.blur.enable;return this.app.postEffect={postEffect:{blur:{enable:!1}}},this._mainRenderer.render(this.app.renderer,this.app.scene,this.app.renderCamera,this._captureRenderTarget),this.app.renderer.readRenderTargetPixels(this._captureRenderTarget,0,0,this._captureRenderTarget.width,this._captureRenderTarget.height,this._captureBuffer),function e(t,i,r,n){if(Array.isArray(t)){for(var o=e(new Float64Array(t),i,r,n),s=0;s<t.length;s++)t[s]=o[s];return t}if(!i||!r)throw Error("Bad dimensions");n||(n=t.length/(i*r));for(var a=r>>1,l=i*n,u=new(0,t.constructor)(i*n),c=0;c<a;++c){var h=c*l,p=(r-c-1)*l;u.set(t.subarray(h,h+l)),t.copyWithin(h,p,p+l),t.set(u,p)}return t}(this._captureBuffer,this._captureRenderTarget.width,this._captureRenderTarget.height),this._mainRenderer.setSize(i.width,i.height),this.app.renderCamera.setSize(i.width,i.height),this.app.postEffect={postEffect:{blur:{enable:r}}},this._captureBuffer},t.prototype.captureToDataURL=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpeg",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.app.renderer.getSize(Rc);e=e||o.width,t=t||o.height;var s=this.capture(e,t),a=new Uint8ClampedArray(s.buffer),l=document.createElement("canvas"),u=l.getContext("2d");l.width=e,l.height=t;var c=u.createImageData(e,t);c.data.set(a),u.putImageData(c,0,0),"jpg"==i&&(i="jpeg");var h="image/"+(i.isBlank()?"jpeg":i),p=l.toDataURL(h,r);return n&&(p=p.replace(h,"image/octet-stream")),p},t.prototype.replaceRenderer=function(e){THING.Utils.warn("[RendererManager] replaceRenderer has been DEPRECATED!"),this._mainRenderer=e,this._mainRenderer.setConfig(this.getCurrentControl()._config)},t.prototype.closePostEffect=function(){THING.Utils.warn("[RendererManager] Please use app.postEffect={} instead"),this.app.renderEffects.mergeConfig({postEffect:{enable:!1}}).update()},o(t,[{key:"needUpdate",set:function(e){e&&this._mainRenderer.dirty()}},{key:"mainRenderer",get:function(){return this._mainRenderer}},{key:"renderOutline",set:function(e){THING.Utils.warn("[RendererManager] renderOutline has been DEPRECATED!")}},{key:"temporalSuperSampling",set:function(e){THING.Utils.warn("[RendererManager] Please use app.postEffect={} instead"),this.app.renderEffects.mergeConfig({temporalSuperSampling:{enable:e}}).update()},get:function(){return THING.Utils.warn("[RendererManager] Please use app.postEffect instead"),this.app.renderEffects.getConfig().temporalSuperSampling.enable}},{key:"SSAO",set:function(e){THING.Utils.warn("[RendererManager] Please use app.postEffect={} instead"),this.app.renderEffects.mergeConfig({postEffect:{screenSpaceAmbientOcclusion:{enable:e}}}).update()},get:function(){return THING.Utils.warn("[RendererManager] Please use app.postEffect instead"),this.app.renderEffects.getConfig().postEffect.screenSpaceAmbientOcclusion.enable}},{key:"postEffectEnable",get:function(){return THING.Utils.warn("[RendererManager] Please use app.postEffect instead"),this.app.renderEffects.getConfig().postEffect.enable}}]),t}(Pc),Ac=function(e){function t(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Sc;return n(this,t),a(this,e.call(this,i,r))}return s(t,e),t}(jc),kc=function(){function e(t){n(this,e),this.app=t,this.xmlhttp=null,this.time=1500,this.simulate=!0,this.url="",this.cache=!0,this._stop=!1,this._curInterval=null,this.callback=null}return e.prototype.start=function(e){if(this._stop=!1,this.url=null,null!=e&&(null!=e.interval&&(this.time=e.interval),null!=e.url&&(this.url=e.url),null!=e.simulate&&(this.simulate=e.simulate),null!=e.cache&&(this.cache=e.cache),null!=e.callback&&(this.callback=e.callback)),null==this.url||1==this.simulate){var t=parent.getUserPath();if(!t)return void THING.Utils.log("Service Data Path Error");this.url=t}this._ajax(),THING.Utils.log("Service startup complete")},e.prototype.stop=function(){this._stop=!0,null!=this._curInterval&&window.clearTimeout(this._curInterval),THING.Utils.log("Service stop complete")},e.prototype._ajax=function(){var e,t=this;function i(){4==t.xmlhttp.readyState&&(200==t.xmlhttp.status?(!function(e){var i=null;i=1==Array.isArray(e)?e[0]:e;for(var r in i){var n=t.app.query(r);if(n.length>0){var o=i[r];for(var s in o)n[0].attr(s,o[s])}}}(JSON.parse(t.xmlhttp.responseText)),null!=t.callback&&t.callback(t.xmlhttp.getResponseHeader("last-modified"))):THING.Utils.log("Problem retrieving XML data:"+t.xmlhttp.statusText),0==t._stop&&(t._curInterval=window.setTimeout((function(){t._ajax()}),t.time)))}e=t.url,t.xmlhttp=null,window.XMLHttpRequest&&(t.xmlhttp=new XMLHttpRequest),null!=t.xmlhttp?(t.xmlhttp.onreadystatechange=i,0==t.cache&&(e=-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime()),t.xmlhttp.open("GET",e,!0),t.xmlhttp.send(null)):THING.Utils.error("Your browser does not support XMLHTTP.")},e}(),Oc=function(){function e(t){n(this,e),this.app=t,this.viewPointList=[],this.timeoutNumer=null,this._flyCallback=null,this._playIndex=0,this.playLoop=!1,this._pickedObjects=new Set}return e.prototype.start=function(){var e=this;this.app.on(F.Pick,(function(t){e._pickedObjects.add(t.object)}))},e.prototype.create=function(e,t){null==e&&(e={name:"newViewPoint"}),null==e.flyTime?e.flyTime=1e3:"string"==typeof e.flyTime&&(e.flyTime=Number(e.flyTime)),null==e.waitTime?e.waitTime=0:"string"==typeof e.waitTime&&(e.waitTime=Number(e.waitTime));var i=this._take(e);null==t?this.viewPointList.push(i):this.viewPointList.splice(t,0,i)},e.prototype.delete=function(e){e>=0&&e<this.viewPointList.length&&this.viewPointList.splice(e,1)},e.prototype.recover=function(e){try{var t=this,i=this.viewPointList[e],r=null;null!=i.events&&(r=function(){for(var e=i.events,r=0;r<e.length;r++){var n=e[r],o=t.app.query("#"+n.id);if(o.length>0)for(var s=0;s<n.event.length;s++)o[0].dispatch(n.event[s])}}),0!=i.waitTime?(null!=t.timeoutNumer&&clearTimeout(t.timeoutNumer),this.timeoutNumer=setTimeout((function(){t._fly(i,r),t.timeoutNumer=null}),i.waitTime)):this._fly(i,r)}catch(e){THING.Utils.log(e)}},e.prototype.update=function(e,t,i){if(null!=e){null==t&&(t={}),"string"==typeof t.flyTime&&(t.flyTime=Number(t.flyTime)),"string"==typeof t.waitTime&&(t.waitTime=Number(t.waitTime));var r={};return i?r=this._take(t,e):(r=this.viewPointList[e],null!=t.flyTime&&(r.flyTime=t.flyTime),null!=t.waitTime&&(r.waitTime=t.waitTime),null!=t.flyTime&&(r.name=t.name)),this.viewPointList[e]=r,r}},e.prototype.play=function(e){null!=e&&(this.playLoop=e),this._playIndex=0,this._flyCallback=null,this.viewPointList.length>0&&this._next()},e.prototype.pause=function(e){void 0===e&&(e=!0),e?(null!=this.timeoutNumer&&clearTimeout(this.timeoutNumer),this.app.camera.flying&&this.app.camera.stopFlying()):this.viewPointList.length>0&&this._next()},e.prototype.swap=function(e,t){var i=this.viewPointList[e][e];return this.viewPointList[e][e]=this.viewPointList[e][t],this.viewPointList[e][t]=i,this.viewPointList[e]},e.prototype.stop=function(){null!=this.timeoutNumer&&clearTimeout(this.timeoutNumer),this.app.camera.flying&&this.app.camera.stopFlying(),this._flyCallback=null,this._pickedObjects.clear()},e.prototype.saveJSON=function(){var e={name:"viewPointAnimation",pointList:this.viewPointList};return JSON.stringify(e)},e.prototype.loadJSON=function(e){var t=e;"string"==typeof e&&(t=JSON.parse(e)),null!=t.pointList&&(this.viewPointList=t.pointList)},e.prototype.clearAll=function(){stop(),this.viewPointList=[]},e.prototype._take=function(e,t){var i={};null!=t&&(i=this.viewPointList[t]),null!=e.flyTime&&(i.flyTime=e.flyTime),null!=e.waitTime&&(i.waitTime=e.waitTime),null!=e.name&&(i.name=e.name),i.position=this.app.camera.position,i.target=this.app.camera.target,i.up=this.app.camera.up,i.image=this.app.captureScreenshotToImage(140,118,"jpeg",.1);var r=this._getPickedEvents();return r.length>0&&(i.events=r),i},e.prototype._getPickedEvents=function(){for(var e=[],t=this._pickedObjects,i=0,r=t.length;i<r;i++){var n=t[i];if(n){var o={id:n.id,event:[]};n.hasEvent("click")&&o.event.push("click"),n.hasEvent("singleclick")&&o.event.push("singleclick"),0!=o.event.length&&e.push(o)}}return this._pickedObjects.clear(),e},e.prototype._fly=function(e,t){var i=this,r={position:e.position,target:e.target,time:e.flyTime,complete:function(e){null!=t&&t(),null!=i._flyCallback&&i._flyCallback()}};e.up&&(r.up=e.up),i.app.camera.flyTo(r)},e.prototype._next=function(){var e=this;if(this._playIndex>this.viewPointList.length-1){if(0==this.playLoop)return void(this._flyCallback=null);this.play()}this._flyCallback=function(){e._playIndex+=1,e._next()},this.recover(this._playIndex)},e}(),Bc=function(){function e(t){n(this,e),this.app=t,this._modelBaseURL="https://model.3dmomoda.com/models/"}return e.prototype.initOptions=function(e){this.app.resourceManager.textureLoader},e.prototype.parseDoorOrWindow=function(e,t,i){var r=this;function n(e,t){var i=r.app.objectManager.create({type:"Door",id:t.id,name:t.name,node:t.mesh,parent:e,animations:t.resource.animations,properties:t.properties});if(t.isOpen&&i.open(),i.animationClips)for(var n=0;n<i.animationClips.length;n++){var o=i.animationClips[n];if("_defaultAnim_"===o.name){i.playAnimation({name:o.name,loop:!0,speed:.15});break}}return i}t.mesh?n():t.registerBuildCallbackListener((function(t){var i=n(e,t);e.miscNode.add(i.node)}))},e.prototype.parseWall=function(e,t,i){for(var r=0;r<t.doorOrWindows.length;r++){var n=t.doorOrWindows[r];this.parseDoorOrWindow(e,n,i)}},e.prototype.parseGroups=function(e,t,i){var r=t.typeToChildren.PlacementGroup;r||(r=[]);for(var n=0;n<r.length;n++){var o=r[n],s="Thing";o.jsonData&&o.jsonData.type&&(s=o.jsonData.type);this.app.objectManager.create({id:o.id,name:o.name,node:o.mesh,type:s,parent:e,properties:o.properties})}},e.prototype.parsePlacements=function(e,t,i){var r=t.typeToChildren.Placement;r||(r=[]);for(var n=0;n<r.length;n++){var o=r[n],s="Thing";if(o.jsonData&&o.jsonData.type&&(s=o.jsonData.type),o.mesh){var a=this.app.objectManager.create({id:o.id,type:s,name:o.name,node:o.mesh,parent:e,url:o.resource.getModelUrl(),animations:o.resource.animations,properties:o.properties});if(a.bundleID=o.resource.modelID,a.bundleName=o.resource.modelName,o.isPlayAnim&&a.containAnimation(o.animClip)){var l={name:o.animClip,loop:!1,speed:.15};o.hasSkin&&(l.loop=!0),a.playAnimation(l)}}}},e.prototype.parseRooms=function(e,t,i){var r=t.typeToChildren.Room;r||(r=[]);for(var n=0;n<r.length;n++){var o=r[n];o.ceiling.mesh&&o.mesh.add(o.ceiling.mesh),o.roof.mesh&&o.mesh.add(o.roof.mesh),o.floor.mesh&&o.mesh.add(o.floor.mesh),this.app.objectManager.create({type:"Room",name:o.name,node:o.mesh,id:o.userID,ceilingNode:o.ceiling.mesh,roofNode:o.roof.mesh,floorNode:o.floor.mesh,parent:e,properties:o.properties})}},e.prototype.createCombinedObject=function(e,t,i){var r=new THREE.Object3D(t),n=this.app.create({type:"CombinedObject",visible:!0,node:r,parent:e});return n.node.visible=!1,n.userData.type=i,n},e.prototype.parsePlan=function(e,t,i){for(var r=this.createCombinedObject(e,"combineFloor","CombineFloorParent").node,n=this._getTypeChildren(t,"CombineFloor"),o=0;o<n.length;o++){var s=n[o];r.add(s.mesh)}var a=this.createCombinedObject(e,"combineCeiling","CombineCeilingParent").node,l=this._getTypeChildren(t,"CombineCeiling");for(o=0;o<l.length;o++){var u=l[o];a.add(u.mesh)}var c=this.createCombinedObject(e,"combineRoof","CombineRoofParent").node,h=this._getTypeChildren(t,"CombineRoof");for(o=0;o<h.length;o++){var p=h[o];c.add(p.mesh)}var d=this.createCombinedObject(e,"combinePlacement","CombineMiscParent").node,f=this._getTypeChildren(t,"CombinePlacement");for(o=0;o<f.length;o++){var m=f[o];d.add(m.mesh)}for(var g=this.createCombinedObject(e,"combineWall","CombineWallParent").node,v=this._getTypeChildren(t,"CombineStraightManualWall"),y=0;y<v.length;y++){var b=v[y];g.add(b.mesh)}var _=this._getTypeChildren(t,"CombineModelWall");for(y=0;y<_.length;y++){b=_[y];g.add(b.mesh)}var x=this._getTypeChildren(t,"CombineDoorOrWindow");for(y=0;y<x.length;y++){m=x[y];g.add(m.mesh)}},e.prototype.parseFloor=function(e,t,i){var r=this._getTypeChildren(t,"Building")[0],n=this._getTypeChildren(r,"FloorPlan")[0];this.parsePlan(e,n,i),this.parseGroups(e,n,i),this.parsePlacements(e,n,i),this.parseRooms(e,n,i);for(var o=this._getTypeChildren(n,"DoorOrWindow"),s=0;s<o.length;s++){var a=o[s];this.parseDoorOrWindow(e,a,i)}},e.prototype._generateWindow=function(e,t){var i=void 0!==e.typeId?e.typeId:"15DA293545E84A3680F93CF7D4227BD9";this.app.create({type:"Door",name:e.key,url:this._modelBaseURL+i+"/0/gltf/",localPosition:[.01*e.pos[0],e.suspendpercent*(e._wallHeight||3),.01*e.pos[1]],parent:t,complete:function(){this.scale=[.01*e.width/this.boundingBox.initSize[0],.01*e.height/this.boundingBox.initSize[1],1],this.angles=[0,180-e.rotation,0],scope._settingDoorOpenDirection(this,e.diridx)}})},e.prototype._generateDoor=function(e,t){var i=this,r=void 0!==e.typeId?e.typeId:"d8ff0aaa4e87439bbededc8c6590491c";this.app.create({type:"Door",name:e.key,url:this._modelBaseURL+r+"/0/gltf/",localPosition:[.01*e.pos[0],e.suspendpercent*(e._wallHeight||3),.01*e.pos[1]],parent:t,complete:function(){this.scale=[.01*e.width/this.boundingBox.initSize[0],.01*e.height/this.boundingBox.initSize[1],1],this.angles=[0,180-e.rotation,0],i._settingDoorOpenDirection(this,e.diridx)}})},e.prototype.parseDoorsAndWindows=function(e,t,i){var r=this;t.doors.forEach((function(t){var i=t.key.split("_");i.length&&("window"==i[0]?r._generateWindow(t,e):r._generateDoor(t,e))}))},e.prototype.load=function(e,t,i){t=this.app.confirmURL(t);var r=this;new THREE.FileLoader(this.app.loadingManager).load(t+"/scene.json",(function(t){var n=JSON.parse(t);r.loadFromData(e,n,i)}))},e.prototype.loadFromData=function(e,t,i){var r=this;i=i||{},this.initOptions(i);var n=function(e,t){var i={version:"2",unit:t=t||1,walls:[],rooms:[],doors:[],textures:[],models:[]},r=e.structure;return i.textures=e.textures,i.models=e.models,i.walls=r.walls.map((function(e){var t=e.textureSize;if(void 0===e.sourceType){var i={weight:e.thickness,start:[100*e.points[0],100*e.points[1]],end:[100*e.points[2],100*e.points[3]],height:e.height,type:0,lefttexture:0,righttexture:0,edgetexture:1};return t&&(i.uvmultiple=t),i}var r={weight:e.thickness,start:[100*e.points[0],100*e.points[1]],end:[100*e.points[2],100*e.points[3]],height:e.height,type:e.sourceType,lefttexture:e.lefttexture,righttexture:e.righttexture,edgetexture:e.edgetexture};return t&&(r.uvmultiple=t),!1===e.visible&&(r.isshow=!1),0!=e.sourceType&&(r.model=e.model),r})),i.rooms=r.rooms.map((function(e){var t=[100*e.textLoc[0],100*e.textLoc[1]],i={id:e.key,name:e.name,points:[],holes:[],center:t,floortexture:e.floorTexture,floorblocksize:e.floorBlockSize,floorheight:e.floorHeight,floorblockangle:e.floorBlockAngle,rooftexture:e.roofTexture,roofblocksize:e.roofBlockSize,roofheight:e.roofHeight,roofblockangle:e.roofBlockAngle,ceilingtexture:e.ceilingTexture,ceilingblocksize:e.ceilingBlockSize,ceilingheight:e.ceilingHeight,ceilingblockangle:e.ceilingBlockAngle};e.userData&&(Object.keys(e.userData).length&&(i.properties=e.userData));return void 0!==e.userId&&(i.userid=e.userId),!1===e.floorVisible&&(i.isshowfloor=!1),!1===e.ceilingVisible&&(i.isshowceiling=!1),void 0===e.roofVisible&&(i.isshowroof=!1),e.polygons.forEach((function(e,t){for(var r=0===t?i.points:[],n=0;n<e.length/2;n++)r.push([100*e[2*n+0],100*e[2*n+1]]);0!==t&&i.holes.push(r)})),i})),r.doors.forEach((function(e){var t=r.walls[e.wallIndex];e.loc;var n=[t.points[0],t.points[1]],o=[t.points[2],t.points[3]],s=[100*(n[0]+(o[0]-n[0])*e.loc),100*(n[1]+(o[1]-n[1])*e.loc)],a=i.models[e.typeIndex],l=e.openingDirection||0,u={key:"door_"+e.key,typeId:a.id,width:100*e.size[0],height:100*e.size[2],suspendpercent:null==e.locV?.4:e.locV,pos:s,rotation:Lc(t),diridx:l};u._wallHeight=t.height,i.doors.push(u)})),r.windows.forEach((function(e){var t=r.walls[e.wallIndex],n=[t.points[0],t.points[1]],o=[t.points[2],t.points[3]],s=[100*(n[0]+(o[0]-n[0])*e.loc),100*(n[1]+(o[1]-n[1])*e.loc)],a=i.models[e.typeIndex],l=e.openingDirection||0,u={key:"window"+e.key,typeId:a.id,width:100*e.size[0],height:100*e.size[2],suspendpercent:null==e.locV?.4:e.locV,pos:s,rotation:Lc(t),diridx:l};u._wallHeight=t.height,i.doors.push(u)})),i}(t,1),o=i.complete,s=i.startLoadResource;json2mesh.DefaultSetting.enableFloorLightMap=Et.parseValue(i.enableFloorLightMap,!1);var a=this._createLoader(n.version),l=void 0;a.load({json:n}).then((function(e){l=e,s&&s(a.resourceManager.models,a.resourceManager.textures)})).then((function(){return a.loadResources()})).then((function(){r.parseFloor(e,l,i),r.parseDoorsAndWindows(e,n,i)})).then((function(){o&&o(e)})).catch((function(e){return THING.Utils.warn(e)}))},e.prototype._createLoader=function(e){if(e&&new Pi(e).major>=2)return new json2mesh.ThingjsEditorSceneLoader_2_0(this.app.options);return new json2mesh.ThingjsEditorSceneLoader},e.prototype._getTypeChildren=function(e,t){var i=e.typeToChildren[t];return i||(i=[]),i},e.prototype._settingDoorOpenDirection=function(e,t){var i=e.node.getObjectByName("Controller"),r=e.node.getObjectByName("RootNode");i&&1===i.children.length?1==t?i.scale.set(-1,1,1):2==t?(r.rotateY(Math.PI),i.scale.set(-1,1,1)):3==t&&r.rotateY(Math.PI):1==t&&r.rotateY(Math.PI)},e}(),Fc=new THREE.Vector2;function Lc(e){return Fc.set(e.points[0]-e.points[2],e.points[1]-e.points[3]),Fc.angle()/Math.PI*180}var Ic=function(){function e(t){n(this,e),this.app=t,this._loading=!1,this._updateTime=0,this._loadingFloors=[],this._initEvents()}return e.prototype._initEvents=function(){var e=this;this.app.on("levelchange",(function(t){var i=t.current;if(i instanceof Ga){e._loadingFloors.sort((function(e,t){return e.owner.parent!=i?1:t.owner.parent!=i?-1:e.owner.indexOfBuilding-t.owner.indexOfBuilding}))}else if(i instanceof Do){e._loadingFloors.sort((function(e,t){return e.owner==i?-1:t.owner==i?1:e.owner.node.id-t.owner.node.id}))}}))},e.prototype.update=function(){if(this._loadingFloors.length&&!(this._loading||(this._updateTime+=this.app._deltaTime,this._updateTime<.25))){this._updateTime=0;var e=this._loadingFloors[0],t=e.owner,i=e.url,r=e.jsonData,n=e.options,o=this,s=n.complete;n.complete=function(e){s&&s(e),o._loading=!1},this._loading=!0;var a=new Bc(this.app);i?a.load(t,i,n):a.loadFromData(t,r,n),this._loadingFloors.splice(0,1)}},e.prototype.load=function(e,t,i){this._loadingFloors.push({owner:e,url:t,options:i})},e.prototype.loadFromData=function(e,t,i){this._loadingFloors.push({owner:e,jsonData:t,options:i})},e.prototype.onUpdate=function(e){this.update(e)},e}(),Nc=function(e){THREE.ShaderMaterial.call(this,{uniforms:{baseId:{type:"f",value:0},size:{type:"f",value:.01},scale:{type:"f",value:400}},vertexShader:e?"\n\t#include <common>\n\t#include <logdepthbuf_pars_vertex>\n\t#include <skinning_pars_vertex>\n\t\n\tuniform float size;\n\tuniform float scale;\n\tuniform float baseId;\n\t\n\tvarying vec4 worldId;\n\n\t#ifdef USE_CARTESIAN3\n\t\tvec3 czm_converPosition(vec3 origin) {\n\t\t\tvec3 res = vec3(0.0);\n\t\t\tres.x = -origin.x;\n\t\t\tres.y = origin.z;\n\t\t\tres.z = origin.y;\n\t\t\treturn res;\n\t\t}\n\t#endif\n\n\t#ifdef INSTANCED\n\t\tattribute float instanceId;\n\t#endif\n\t\n\t#ifdef USE_ID_ATTRIBUTES\n\t\tattribute float id;\n\t#endif\n\n\tvoid main() {\n\t\t#include <skinbase_vertex>\n\t\t#include <begin_vertex>\n\t\t#ifdef USE_CARTESIAN3\n\t\t\ttransformed = czm_converPosition(transformed);\n\t\t#endif\n\t\t// position instanced\n\t\t#ifdef INSTANCED\n\t\t\tmat4 instanceMat = compose(instancePosition, instanceQuaternion, instanceScale);\n\t\t\ttransformed.xyz = (instanceMat * vec4(transformed, 1.0)).xyz;\n\t\t#endif\n\t\t#include <skinning_vertex>\n\t\t#include <project_vertex>\n\t\t#include <logdepthbuf_vertex>\n\t\t#ifdef USE_ID_ATTRIBUTES\n\t\t\tfloat pickId = id;\n\t\t#else\n\t\t\t#ifdef INSTANCED\n\t\t\t\tfloat pickId = instanceId;\n\t\t\t#else\n\t\t\t\tfloat pickId = baseId;\n\t\t\t#endif\n\t\t#endif\n\n\t\tvec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * pickId);\n\t\ta -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);\n\t\tworldId = vec4(a,1);\n\t}\n":"\n\t#include <common>\n\t#include <logdepthbuf_pars_vertex>\n\n\tuniform float size;\n\tuniform float scale;\n\tuniform float baseId;\n\n\tvarying vec4 worldId;\n\n\t#ifdef USE_CARTESIAN3\n\t\tvec3 czm_converPosition(vec3 origin) {\n\t\t\tvec3 res = vec3(0.0);\n\t\t\tres.x = -origin.x;\n\t\t\tres.y = origin.z;\n\t\t\tres.z = origin.y;\n\t\t\treturn res;\n\t\t}\n\t#endif\n\n\t#ifdef INSTANCED\n\t\tattribute float instanceId;\n\t#endif\n\t\n\t#ifdef USE_ID_ATTRIBUTES\n\t\tattribute float id;\n\t#endif\n\n\tvoid main() {\n\t\t#ifdef USE_ID_ATTRIBUTES\n\t\t\tfloat pickId = id;\n\t\t#else\n\t\t\t#ifdef INSTANCED\n\t\t\t\tfloat pickId = instanceId;\n\t\t\t#else\n\t\t\t\tfloat pickId = baseId;\n\t\t\t#endif\n\t\t#endif\n\t\t\n\t\tvec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * pickId);\n\t  \ta -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);\n\t\tworldId = vec4(a,1);\n\t\tvec3 transformed = position;\n\t\t#ifdef USE_CARTESIAN3\n\t\t\ttransformed = czm_converPosition(transformed);\n\t\t#endif\n\t\t#ifdef INSTANCED\n\t\t\tmat4 instanceMat = compose(instancePosition, instanceQuaternion, instanceScale);\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * instanceMat * vec4( transformed, 1.0 );\n\t\t#else\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 );\n\t\t#endif\n\n\t\t#include <logdepthbuf_vertex>\n\t}\n",fragmentShader:"\n\t#include <logdepthbuf_pars_fragment>\n\t#ifdef GL_ES\n\t\tprecision highp float;\n\t#endif\n\tvarying vec4 worldId;\n\tvoid main() {\n\t\t#include <logdepthbuf_fragment>\n\t\tgl_FragColor = worldId;\n\t}\n"})};(Nc.prototype=Object.create(THREE.ShaderMaterial.prototype)).constructor=Nc,Nc.prototype.setBaseID=function(e){this.uniforms.baseId.value=e},Nc.prototype.setPointSize=function(e){this.uniforms.size.value=e},Nc.prototype.setPointScale=function(e){this.uniforms.scale.value=e};var Uc=new THREE.Vector2,zc=new THREE.Vector3;zc.isFailed=!0;var Hc,Vc,Wc=function(){function e(t,i){n(this,e),i=i||{},this.app=t,this.renderer=t.renderer,this.scene=t.scene,this._needUpdate=!0,this._updateTime=0,this._updateIntervalTime=.25,this._pickHooker=null,this.debugScene=null,this.sprite=null,this.camera2D=null,this.pickingTexture=new THREE.WebGLRenderTarget,this.pickingTexture.texture.minFilter=THREE.LinearFilter,this.pickingTexture.texture.generateMipmaps=!1,this.pickNodes=new Map,this.pickMaterials=new Map,this.lineShell=Et.parseValue(i.lineShell,10),this.pointShell=Et.parseValue(i.pointShell,.1),this.debug=Et.parseValue(i.debug,!1),this.init();var r=this;this.app.renderer.materialManager.addStrategy("gpuPicker",(function(e,t,i,n,o,s){var a=this.id;if(this.geometry._hasDisposed)return null;if(this.userData.skipPick)return null;if(!o.visible||!o.opacity)return null;if("BackgroundCubeMaterial"==o.name||"BackgroundMaterial"==o.name)return null;if(this.isSky)return null;r.pickNodes.has(a)||r.pickNodes.set(a,this);var l=r.pickMaterials.get(a);return l||(l=r.createPickingMaterial(this,o))&&r.pickMaterials.set(a,l),l}))}return e.prototype.init=function(){var e=this.renderer.getSize(Uc);this.resizeTexture(e.width,e.height)},e.prototype.resizeTexture=function(e,t){this.pickingTexture.setSize(e,t),this.pixelBuffer=new Uint8Array(4*e*t),this.sprite&&this.sprite.scale.set(2*e,2*t,1),this.camera2D&&(this.camera2D.left=-e/2,this.camera2D.right=e/2,this.camera2D.top=t/2,this.camera2D.bottom=-t/2,this.camera2D.updateProjectionMatrix()),this._needUpdate=!0},e.prototype._needUpdatePickingTexture=function(e){return this._updateTime+=e,!(this._updateTime<this._updateIntervalTime)&&(this._updateTime=0,!!this._needUpdate&&(this._needUpdate=!1,!0))},e.prototype.update=function(e){this._needUpdatePickingTexture(e)&&this.updatePickingTexture()},e.prototype.markPickingNode=function(e){this.pickNodes.set(e.id,e)},e.prototype.removePickingResources=function(e){var t=this;if(e.isObject3D)e.traverse((function(e){return t.removePickingResources(e.id)}));else{var i=this.pickMaterials.get(e);i&&(Array.isArray(i)?i.forEach((function(e){return e.dispose()})):i.dispose(),this.pickMaterials.delete(e));var r=this.pickNodes.get(e);r&&(this.pickNodes.delete(e),r.isEdgeWireframe||(this.forceUpdate=!0))}},e.prototype._createPickingMaterial=function(e,t){var i=e.userData,r=t.size||.01,n=t.linewidth||1,o=function(e){for(var t=e;t;){if(t.userData.withGeometryIDAttributes)return!0;t=t.parent}return!1};if(t.isSpriteMaterial)t.map&&t.map.image&&((a=t.clone()).alphaTest=.001,a.blending=THREE.NoBlending,a.lights=!1,a.fog=!1,a.opacity=1,a.visible=!(!t.visible||i.skipPick),a.baseId=e.id,a.defines=a.defines||{},a.defines.USE_GPUPICKER="");else if(i.noBlending||t.isShaderMaterial&&t.vertexShader.indexOf("USE_GPUPICKER")>-1){(a=t.clone()).alphaTest=.001,a.blending=THREE.NoBlending,a.lights=!1,a.fog=!1,a.visible=!(!t.visible||i.skipPick),a.baseId=e.id,a.defines=a.defines||{},a.defines.USE_GPUPICKER="";var s=a.uniforms;s&&s.lineWidth&&(s.lineWidth.value+=this.lineShell),o(e)&&(a.defines.USE_ID_ATTRIBUTES="")}else{var a;if(o(e))(a=new Nc(t.skinning)).map=null,a.color=new THREE.Color,a.uniforms.config={value:{x:0,y:0}},a.linewidth=n+this.lineShell,a.depthTest=t.depthTest,a.depthWrite=Et.parseValue(t.depthWrite,t._pickable),a.colorWrite=t.colorWrite,a.transparent=t.transparent,a.opacity=1,a.side=t.side,a.skinning=t.skinning,a.visible=!(!t.visible||i.skipPick),a.polygonOffset=t.polygonOffset,a.polygonOffsetFactor=t.polygonOffsetFactor,a.polygonOffsetUnits=t.polygonOffsetUnits,a.baseId=e.id,t.defines&&void 0!==t.defines.INSTANCED&&!1!==t.defines.INSTANCED&&(a.defines.INSTANCED=""),i.USE_CARTESIAN3&&(a.defines.USE_CARTESIAN3=""),a.defines.USE_ID_ATTRIBUTES="",a.setPointSize(r+this.pointShell),a.setPointScale(this.renderer.getSize(Uc).height*this.renderer.getPixelRatio()/2);else(a=new Nc(t.skinning)).map=null,a.color=new THREE.Color,a.uniforms.config={value:{x:0,y:0}},a.linewidth=n+this.lineShell,a.depthTest=t.depthTest,a.depthWrite=Et.parseValue(t.depthWrite,t._pickable),a.colorWrite=!!i.skipPickColorWrite||t.colorWrite,a.transparent=t.transparent,a.opacity=1,a.side=t.side,a.skinning=t.skinning,a.visible=!(!t.visible||i.skipPick),a.polygonOffset=t.polygonOffset,a.polygonOffsetFactor=t.polygonOffsetFactor,a.polygonOffsetUnits=t.polygonOffsetUnits,a.baseId=e.id,t.defines&&void 0!==t.defines.INSTANCED&&!1!==t.defines.INSTANCED&&(a.defines.INSTANCED=""),i.USE_CARTESIAN3&&(a.defines.USE_CARTESIAN3=""),a.setPointSize(r+this.pointShell),a.setPointScale(this.renderer.getSize(Uc).height*this.renderer.getPixelRatio()/2)}return a},e.prototype.createPickingMaterial=function(e,t){if(t.length){for(var i=[],r=0;r<t.length;r++)i.push(this._createPickingMaterial(e,t[r]));return i}return this._createPickingMaterial(e,t)},e.prototype.updatePickingTexture=function(){var e=this.app.renderer.materialManager,t=e.getMode();e.setMode("gpuPicker");var i=this.scene,r=i.autoUpdate;i.autoUpdate=!1;var n=this.renderer.shadowMap.enable;this.renderer.initRenderList=!1,this.renderer.setRenderTarget(this.pickingTexture),this.renderer.clear(),this.renderer.render(i,this.app.renderCamera),this.renderer.render(this.app.mainUI.scene2D,this.app.mainUI.camera2D),i.autoUpdate=r,this.renderer.shadowMap.enable=n,this.renderer.initRenderList=!0,this.renderer.readRenderTargetPixels(this.pickingTexture,0,0,this.pickingTexture.width,this.pickingTexture.height,this.pixelBuffer),e.setMode(t)},e.prototype.pick=function(e,t,i,r){var n=this.pickingTexture.width,o=this.pickingTexture.height;if(t=Math.round(t),i=Math.round(i),t<0||t>=n)return null;if(i<0||i>=o)return null;var s=t+(o-i-1)*n,a=255*this.pixelBuffer[4*s+2]*255+255*this.pixelBuffer[4*s+1]+this.pixelBuffer[4*s+0];if(isNaN(a))return null;var l=this.pickNodes.get(a);if(!l){var u=this.app.picker.onPickNodeID;u&&(l=u(a))}if(!l)return null;var c=r.clone();c._camera=r._camera||r.camera,c.camera=r.camera||r._camera;var h=this,p={x:t,y:i,id:a,pickedNode:l,node:l,object:l,raycaster:c,getPickedPosition:function(e){e=e||{};var t=this.pickedNode,i=h._pickHooker;if(i){var r=i(this.raycaster,t);if(r){if(Et.isArray(r))return Et.parseVector3(r);if(r.isVector3)return r}}var n=this.raycaster.intersectObject(t,!1);if(n.length)return n[0].point;var o=function(e,t){if(!t)return null;for(var i=e.intersectObject(t,!0),r=0;r<i.length;r++){var n=i[r];if(!n.object.userData.skipPick)return n.point}return null},s=o(this.raycaster,t.parent);if(s)return s;if(!e.skipOtherPick){if(!e.skipParentPick&&t.parent&&(s=o(this.raycaster,t.parent)))return s;if(!e.skipObjectPick){var a=h.app.objectManager.getBaseObject(t);if(a&&(s=o(this.raycaster,a.node)))return s}if(!e.skipScenePick&&(s=o(this.raycaster,h.app.scene)))return s}return zc}};return Object.defineProperties(p,{pickedPosition:{get:function(){if(void 0===p._pickedPosition){var e=p.getPickedPosition();e?(p._pickedPosition=e.toArray(),e.isFailed&&(p._pickedPosition.isFailed=!0)):p._pickedPosition=null}return p._pickedPosition}},distance:{get:function(){if(void 0===p._distance){var t=p.pickedPosition;if(t){var i=new THREE.Vector3(t[0],t[1],t[2]);p._distance=i.distanceTo(e.position)}else{var r=new THREE.Vector3;l.getWorldPosition(r);var n=new THREE.Vector3;e.getWorldPosition(n),p._distance=n.distanceTo(r)}}return p._distance}}}),p},e.prototype.show=function(e){if(e||void 0===e){if(!this.sprite){var t=new THREE.SpriteMaterial({map:this.pickingTexture.texture});this.sprite=new THREE.Sprite(t),this.sprite.scale.set(this.pickingTexture.width,this.pickingTexture.height,1),this.sprite.position.set(0,0,-10),this.debugScene=new THREE.Scene,this.debugScene.add(this.sprite);var i=this.renderer.getSize(Uc);this.camera2D=new THREE.OrthographicCamera(-i.width/2,i.width/2,i.height/2,-i.height/2,.1,100)}}else this.debugScene&&this.sprite&&(this.debugScene.remove(this.sprite),this.sprite=null,this.debugScene=null,this.camera2D=null)},e.prototype.render=function(e){this.debugScene&&(e.setRenderTarget(null),e.clear(),e.render(this.debugScene,this.camera2D))},o(e,[{key:"updateIntervalTime",set:function(e){this._updateIntervalTime=e},get:function(){return this._updateIntervalTime}},{key:"forceUpdate",set:function(e){e&&(this._needUpdate=!0,this._updateTime=.25)}},{key:"needUpdate",set:function(e){this._needUpdate=e}}]),e}(),Gc=function(){function e(t){n(this,e),this.app=t;var i=new THREE.PlaneGeometry(1e4,1e4,1,1),r=new THREE.MeshStandardMaterial({color:2200782,side:THREE.DoubleSide,transparent:!0,opacity:.25});this._vertGround=new THREE.Mesh(i,r),this._vertGround.visible=!1,this._vertGround.setAngles([90,0,0]),this._vertGround.scale.set(1e3,100,100),this._vertGround.updateMatrixWorld();var o=new THREE.PlaneGeometry(1e4,1e4,1,1),s=new THREE.MeshStandardMaterial({color:13538337,side:THREE.DoubleSide,transparent:!0,opacity:.25});this._horzGround=new THREE.Mesh(o,s),this._horzGround.visible=!1,this._horzGround.setAngles([90,0,0]),this._horzGround.scale.set(1e3,100,100),this._horzGround.updateMatrixWorld(),this.pickingScene=new THREE.Scene,this.pickingScene.add(this._vertGround),this.pickingScene.add(this._horzGround)}return e.prototype.destroy=function(){this.app.resourceManager.remove(this.pickingScene)},e.prototype.update=function(e,t){this._vertGround.lookAt(Et.parseVector3(e)),this._vertGround.position.copy(Et.parseVector3(t)),this._vertGround.updateMatrixWorld()},e.prototype.isMeshOf=function(e){return this._vertGround==e||this._horzGround==e},e.prototype.intersect=function(e,t){var i=this.app.calcRect(),r=this.app.renderCamera.getRaycaster(e,t,i);return this.intersectByRaycaster(r)},e.prototype.intersectByRaycaster=function(e){var t=e.intersectObjectForcible(this._horzGround),i=e.intersectObjectForcible(this._vertGround);return t.length&&i.length?t[0].distance<i[0].distance?t[0]:i[0]:t.length?t[0]:i.length?i[0]:null},o(e,[{key:"visible",set:function(e){e?this.app.scene.add(this.pickingScene):this.app.scene.remove(this.pickingScene),this._vertGround.visible=e,this._horzGround.visible=e}}]),e}(),qc=function(){function e(t){n(this,e),this.app=t,this.picker=t.picker,this.pickDownPosition=[0,0],this._mouseMoveInterval=null,e.instance=this}return e.prototype.processPicking=function(e){this.picker.processPicking(e)},e.prototype.processAreaPicking=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.picker,r=i.pickingArea,n=new $t(this.app);t?n.buildReturnObject(r.processPicking(i.areaCandidates)):(this.processPicking(e),i.areaCandidates.has(e.object)?n.buildReturnObject([e.object]):n.buildReturnObject([])),this.picker.setPickedObject(n),this.app.trigger(F.AreaPicking,{objects:n})},e.prototype.startPicking=function(e){var t=this.picker;t.forceUpdate=!0,t._enable(!0,"startPicking",1e4),e.ignoreFrameCheck=!0},e.prototype.endPicking=function(){this.picker._enable(!1,"startPicking",0)},e.prototype.processClickEvents=function(e){this.startPicking(e),this.processPicking(e),this.endPicking()},e.prototype.tryToDrag=function(e){var t=this.picker.processPicking(e);if(null==t)return null;var i=t.object;return i?i.draggable?t:(e.object=null,null):null},e.prototype.onEnter=function(e){},e.prototype.onUpdate=function(e){var t=this.picker;if(!t.areaPicking){var i=t.pickingArea;i.started&&i.end()}t.update(this.app._deltaTime),this._mouseMoveInterval&&(this._mouseMoveInterval.deltaTime+=this.app._deltaTime)},e.prototype.onMouseMove=function(e){if(this._mouseMoveInterval){if(this._mouseMoveInterval.deltaTime-this._mouseMoveInterval.curTime<this._mouseMoveInterval.interval)return;this._mouseMoveInterval.curTime=this._mouseMoveInterval.deltaTime}var t=this.picker;if(t.areaPicking){var i=t.pickingArea;i.started&&(i.move(e.clientX,e.clientY),i.realTimePicking&&(e.areaPicking=!0,this.processAreaPicking(e)))}else this.processPicking(e),!1===this.picker.setPickedObject(e.object,null,e.ignoreFilter)&&(e.hadFiltered=!0)},e.prototype.onMouseUp=function(e){var t=this.picker;if(this.startPicking(e),t.areaPicking){if(0==e.button){var i=THING.Math.getDistance(this.pickDownPosition,[e.x,e.y])>4;e.finishedAreaPicking=!0,this.processAreaPicking(e,i),t.pickingArea.end()}}else e.ignoreFrameCheck=!0,t.processPicking(e);this.endPicking()},e.prototype.onMouseDown=function(e){var t=this.picker;t.forceUpdate=!0,this.pickDownPosition=[e.clientX,e.clientY],t.areaPicking?0==e.button&&t.pickingArea.start(e.clientX,e.clientY):(e.ignoreFrameCheck=!0,t.processPicking(e))},e.prototype.onDoubleClick=function(e){this.processClickEvents(e)},e.prototype.onSingleClick=function(e){this.processClickEvents(e)},e.prototype.onClick=function(e){this.processClickEvents(e)},e.prototype.onDragStart=function(e){this.startPicking(e);var t=this.tryToDrag(e);if(t){var i=t.object,r=this.picker;i._dragState=R.Dragging,i.internalUserData.prevPickable=i.pickable,i.pickable=!1,e.ignoreFrameCheck=!0,e.forceUpdateTexture=!0;var n=r.processPicking(e);r.dragIntersect=n||t,r.dragIntersect.dragObject=i,e.dragObject=i,delete e.ignoreFrameCheck,delete e.forceUpdateTexture,this.app.camera.disable({rotate:!0})}else this.endPicking()},e.prototype.onDrag=function(e){var t=this.picker;null!=t.dragIntersect&&(e.disableGPUPicker=!0,t.processPicking(e),delete e.disableGPUPicker,this.app.needUpdate=!0)},e.prototype.onDragEnd=function(e){var t=this.picker;if(t.forceUpdate=!0,null!=t.dragIntersect){e.disableGPUPicker=!0,t.processPicking(e),delete e.disableGPUPicker;var i=t.dragIntersect.dragObject;i&&(i._dragState=R.DragEnd);var r=i.internalUserData.prevPickable;r&&(i.pickable=r),delete i.internalUserData.prevPickable,e.object=i,t.dragIntersect=null,this.app.camera.resume({rotate:!0}),this.endPicking()}},o(e,[{key:"mouseMoveInterval",set:function(e){this._mouseMoveInterval=e,this._mouseMoveInterval&&(this._mouseMoveInterval={interval:e,curTime:this.app._deltaTime,deltaTime:this.app._deltaTime})},get:function(){return this._mouseMoveInterval}}]),e}(),Xc=void 0,Jc=0,Yc=!1;var Zc=function(){function e(t){n(this,e),this.app=t;var i=this.app.calcRect();this.resize(i.width,i.height),Hc=this}return e.prototype.updateProgress=function(e){return this.loadingProgressBar.updateProgress(e)},e.prototype.updateDownloadingProgress=function(e){},e.prototype.updateLoadingProcess=function(e){e=e||{},Et.isNumber(e)&&(e={object:this.app.root.campuses[0],progress:e});var t=e.object||e.campus,i=e.progress;this.updateProgress(i)&&this.app.events.dispatchEvent({type:"progress",object:t,progress:i})},e.prototype._createLSM=function(e,t,i){var r=document.createElement("canvas");r.width=512,r.height=512;var n=r.getContext("2d");n.font="24px Verdana",n.fillStyle="white",n.textAlign="center",n.textBaseline="middle";var o=[0,0,0],s=THING.Math.degToRad(30);n.shadowColor="rgba("+255*o[0]+","+255*o[1]+","+255*o[2]+",1)",n.shadowBlur=1,n.shadowOffsetX=2*Math.cos(s),n.shadowOffsetY=2*Math.sin(s),function(e,t,i,r,n){for(var o=t.split("\n"),s=0;s<o.length;s++){var a=o[s];e.fillText(a,i,r),r+=n}}(n,e,256,256,40);var a=new THREE.Texture(r);return a.needsUpdate=!0,new THREE.SpriteMaterial({opacity:t,color:16777215,transparent:!0,depthWrite:!1,map:a,rotation:THING.Math.degToRad(i)})},e.prototype._createLS=function(e,t,i){for(var r=this.app.calcRect(),n=2*r.width,o=2*r.height,s=[],a=-o;a<o;a+=i)for(var l=-n;l<n;l+=t){var u=new THREE.Sprite(e);u.userData.skipPick=!0,u.scale.set(512,512,1),u.position.set(l,a,-10),s.push(u)}return s},e.prototype._setupSprite=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:480,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:320;Xc&&this.app.resourceManager.remove(Xc);var r=this._createLSM(e,.04,30),n=this._createLS(r,t,i);Xc=new THREE.Group;for(var o=0;o<n.length;o++)Xc.add(n[o]),n[o].material.opacity=0;Yc=!0,this.scene2D.add(Xc)},e.prototype._setup=function(){for(var e=h.update(this.app.appKey),t=[12,164,143,166,114,16,17,182,16,94,29,114,216,195,208,81,35,181,52,132,113,112,175,32,228,201,230,97,106,44,100,73,110,54,247,25],i=0;i<e.length;i++)if(e[i]!=t[i]){this._setupL();break}this.overlayRootNode=new THREE.Group,this.scene2D.add(this.overlayRootNode)},e.prototype._setupL=function(){if((new _).eb()){if([32].toString()!=[32].toString()){var e=function(e){e=e||window;var t=h,i=t.toStr([76,243,170,237,85,62]),r=t.toStr([83,249,168,254,66,63,61,235]),n=t.toStr([79,247,191,247,88,55,63,224]);n=t.update(e[r][n]);var o=t.toStr([80,230,174,241]),s=t.toStr([87,226,191,239,12,121,125,242,74,24,10,48,244,135,138,115,8,255,55,165,90,89,198]),a=t.update(e[r][i]),l=[107,254,162,241,81,28,1,165,95,22,4,17,213,160,171],u=[0,248,170,242,83,107,125];0==a.toString().indexOf(u.toString())&&(l=[107,254,162,241,81,28,1,165,95,22,4,17,213,160,171,30,74,202,107,163,80,20,159,104,208,141,185,54,51,54]);var c=[0,0];return 1==Et.r(0,1)&&(0==Et.r(0,1)?c[1]=Et.r(10,230):c[0]=Et.r(50,400)),{b1:o,c1:s,d1:c,e1:i,pp1:n,gg1:[[16,230,228]],f1:u,gs:[[0,248,170,242,83,107,125,240,77,3,75,37,248,157,203,100,3,239,114,167,82,81],[0,248,170,242,83,107,125,245,18],[0,251,246,176,70,121]],h1:a,t1:t.toStr(l)}}(this.l);if(e){var t=e.gs;if(t)for(var i=e.h1.toString(),r=0;r<t.length;r++)if(0==i.indexOf(t[r].toString()))return;if(t=e.gg1)for(i=e.pp1.toString(),r=0;r<t.length;r++)if(0==i.indexOf(t[r].toString()))return;var n=e.t1;this._setupSprite(n)}}}},e.prototype.onResize=function(e,t){this.resize(e,t);var i=i||h.toStr([96,201,148,250,88,55,48,233,88,48,80,33,228,154,187,127,7,245,70,163,91,87,134,105,199,140,143,6,2]);if(THING[i]){var r=h.toStr([96,226,174,231,66,29,55,252,120,1,71,43,248,139,150]);THING[r]=h,delete THING[i]}},e.prototype.onUpdate=function(){var e=ce();if(!0===e?this.checkAuthRet=!0:!1===e&&(this.checkAuthRet=!1,void 0===Vc&&(Vc=!0,THREE.ShaderChunk.map_fragment=["","#ifdef USE_MAP","#ifdef USE_DIFFUSE_UV2","vec4 texelColor = texture2D( map, vUv2 );","#else","vec4 texelColor = texture2D( map, vUv );","#endif","texelColor = mapTexelToLinear( texelColor );","diffuseColor *= texelColor;","diffuseColor.a *= texelColor.a * 0.5;","diffuseColor.b *= texelColor.r * 0.25;","#endif",""].join("\n"),THREE.ShaderChunk.alphamap_fragment=["","#ifdef USE_ALPHAMAP","#ifdef USE_ALPHAMAP_REVERSE","diffuseColor.a *= 1.0 - texture2D( alphaMap, vAlphaUV).g;","diffuseColor.a *= 0.1 - texture2D( alphaMap, vAlphaUV).r;","diffuseColor.a *= 0.5 - texture2D( alphaMap, vAlphaUV).b;","#else","diffuseColor.a *= texture2D( alphaMap, vAlphaUV).g;","diffuseColor.r *= texture2D( alphaMap, vAlphaUV).r;","diffuseColor.b *= texture2D( alphaMap, vAlphaUV).b;","#endif","#endif",""].join("\n"),THREE.ShaderChunk.uv2_vertex=["#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","#if defined(USE_DIFFUSE_UV2) && defined(USE_MAP)","vUv2 = (uvTransform * vec3(uv2, 0.1)).xy;","#else","vUv2 = uv2;","#endif","#endif","#ifdef USE_ALPHAMAP","vAlphaUV = (uvTransform1 * vec3(uv, 0.1)).xy;","#ifdef USE_ALPHA_UV2","vAlphaUV = (uvTransform1 * vec3(uv2, 0.1)).xy;","#endif","#ifdef USE_ALPHA_UV3","vAlphaUV = (uvTransform1 * vec3(uv3, 0.1)).xy;","#endif","#ifdef USE_ALPHA_UV4","vAlphaUV = (uvTransform1 * vec3(uv4, 0.1)).xy;","#endif","#endif","#ifdef USE_EMISSIVEMAP","#ifndef USE_EMISSIVETRANSFORM","mat3 emissiveTransform = uvTransform;","#else","mat3 emissiveTransform = uvTransform2;","#endif","vEmissiveUV = (emissiveTransform * vec3(uv, 0.1)).xy;","#ifdef USE_EMISSIVE_AROUND_UV","vEmissiveUV = (emissiveTransform * vec3(uv8, 0.1)).xy;","#endif","#ifdef USE_ALPHA_UV2","vEmissiveUV = (emissiveTransform * vec3(uv2, 0.1)).xy;","#endif","#ifdef USE_ALPHA_UV3","vEmissiveUV = (emissiveTransform * vec3(uv3, 0.1)).xy;","#endif","#ifdef USE_ALPHA_UV4","vEmissiveUV = (emissiveTransform * vec3(uv4, 0.1)).xy;","#endif","#endif",""].join("\n"),THREE.ShaderChunk.aomap_fragment="\n\t#ifdef USE_AOMAP\n\t\t#ifdef WALL_AO\n\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).g - .5 ) * aoMapIntensity * 1.5 + 1.5;\n\t\t#else\n\t\t\t#ifdef FLOOR_AO\n\t\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).g - .5 ) * aoMapIntensity + 2.25;\n\t\t\t#else\n\t\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).g - .5 ) * aoMapIntensity * 2.6 + 1.7;\n\t\t\t#endif\n\t\t#endif\n\t\t// reflectedLight.indirectDiffuse *= ambientOcclusion;\n\t\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t\t#endif\n\t#else\n\t\tfloat ambientOcclusion = 0.4;\n\t#endif\n",THREE.ShaderChunk.emissivemap_fragment="\n\t#ifdef USE_EMISSIVEMAP\n\n\t\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveUV );\n\n\t\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\t\ttotalEmissiveRadiance *= emissiveColor.bgr;\n\n\t#endif\n\n\t#ifdef STANDARD\n\t\ttotalEmissiveRadiance = vec3(0.0,0.0,0.0);\n\t\tvec3 newEmissiveColor = emissive;\n\t\t#ifdef USE_EMISSIVEMAP\n\t\t\tnewEmissiveColor = emissive * emissiveColor.rgb;\n\t\t\t#ifdef USE_SIDE_EMISSIVE\n\t\t\t\tnewEmissiveColor *= newEmissiveColor * (0.5 - abs(dot( inverseTransformDirection( normal, viewMatrix ), vec3(0.5, .5, 0.5) )));\n\t\t\t#endif\n\t\t#endif\n\t#endif\n",THREE.ShaderChunk.encodings_fragment=["gl_FragColor = linearToOutputTexel( gl_FragColor );","#if defined(STANDARD) || defined(USE_AOMAP)","gl_FragColor.rgb *= ambientOcclusion;","#elif defined(FLOOR_AO)","gl_FragColor.rgb *= 0.2;","#endif","#ifdef STANDARD","gl_FragColor.rgb *= newEmissiveColor;","#endif"].join("\n"),THREE.ShaderChunk.tonemapping_fragment=["#if defined( TONE_MAPPING ) && defined(STANDARD)","gl_FragColor.rgb = toneMapping( gl_FragColor.bgr );","#endif"].join("\n"))),300===Jc&&Yc){for(var t=0;t<Xc.children.length;t++)Xc.children[t].material.opacity=.04;Yc=!1}Yc&&Jc++,this.render()},e.prototype.resize=function(e,t){this.scene2D=this.scene2D||new THREE.Scene,this.camera2D=this.camera2D||new THREE.OrthographicCamera(-e/2,e/2,t/2,-t/2,.1,100),this.camera2D.left=-e/2,this.camera2D.right=e/2,this.camera2D.top=t/2,this.camera2D.bottom=-t/2,this.camera2D.updateProjectionMatrix(),this.loadingProgress&&this.loadingProgress.resize(e,t)},e.prototype.render=function(e){e=e||this.app.renderer;var t=le().l;if(void 0!==t&&!this._c){this._c=!0;var i=le().t;t||(i=""),this._setupSprite(i)}Xc&&(Xc.parent!=this.scene2D&&this.scene2D.add(Xc),Xc.visible=!0,Xc.traverse((function(e){e.visible=!0})),this.scene2D.visible=!0),e.setRenderTarget(null),e.clear(!1,!0,!1);var r=this.app.renderer.autoClear;e.autoClear=!1,e.render(this.scene2D,this.camera2D),e.autoClear=r},e.prototype.getRenderPosition=function(e,t,i){var r=(i=i||[this.app.domElement.offsetWidth,this.app.domElement.offsetHeight])[0]/2,n=i[1]/2,o=[e[0]*r,e[1]*n],s=[t[0]/2,t[1]/2];return o[0]=THING.Math.clamp(o[0],-r+s[0],r-s[0]),o[1]=THING.Math.clamp(o[1],-n+s[1],n-s[1]),[o[0],-o[1]]},e.prototype.screenToWorld=function(e,t){var i=this.app.calcRect(),r=t[0],n=t[1];return[e[0]+r/2-i.width/2,-e[1]-n/2+i.height/2]},o(e,[{key:"loadingProgressBar",get:function(){return this.loadingProgress=this.loadingProgress||this.app.create({type:"ProgressBar",height:6,scene:this.scene2D,onTop:!1,parent:null}),this.loadingProgress}}]),e}();function Qc(e,t){var i=THING.App.current._style;if(i){var r=i.transform;if(r){var n=r.scale;n&&(e/=n[0],t/=n[1])}}return[e,t]}var Kc=function(){function e(t){n(this,e),this.app=t,this.sprite=null,this.spriteLineNode=null,this.started=!1,this.startX=0,this.startY=0,this.distanceX=0,this.distanceY=0,this.region=[],this._areaPickType=A.Auto,this._realTimePicking=!1,this.depth=-10}return e.prototype.initLines=function(){if(!this.spriteLineNode){var e=new THREE.Geometry;e.vertices=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];var t=new THREE.LineBasicMaterial({color:16777215,opacity:.8,linewidth:1,transparent:!0});this.spriteLineNode=new THREE.Line(e,t),this.spriteLineNode.visible=!1,this.spriteLineNode.computeLineDistances(),this.app.mainUI.scene2D.add(this.spriteLineNode)}},e.prototype.initSprite=function(){if(!this.sprite){var e=new THREE.SpriteMaterial({opacity:.4,color:32768,transparent:!0});this.sprite=new THREE.Sprite(e),this.sprite.visible=!1,this.app.mainUI.scene2D.add(this.sprite)}},e.prototype.setSpritePosition=function(e,t){var i=this.app.calcRect(),r=e-i.width/2,n=t-i.height/2;this.sprite.position.set(r,-n,this.depth)},e.prototype.setSpriteLinePosition=function(e,t,i,r){var n=this.spriteLineNode.geometry,o=n.vertices,s=i/2,a=r/2,l=new THREE.Vector3(e-s,t-a,this.depth),u=new THREE.Vector3(e+s,t-a,this.depth),c=new THREE.Vector3(e+s,t+a,this.depth),h=new THREE.Vector3(e-s,t+a,this.depth);o[0].copy(l),o[1].copy(u),o[2].copy(c),o[3].copy(h),o[4].copy(l),n.verticesNeedUpdate=!0},e.prototype.updateRegion=function(){var e=this.startX,t=this.startX+this.distanceX,i=this.startY,r=this.startY+this.distanceY,n=!1;if(e>t){var o=e;e=t,t=o,n=!0}if(i>r){var s=i;i=r,r=s,n=!0}switch(this._areaPickType){case A.Auto:this._realTimePicking=!n;break;case A.RealTime:this._realTimePicking=!0;break;case A.NotRealTime:this._realTimePicking=!1}this.region=[e,i,t,r]},e.prototype.start=function(e,t){var i=e,r=t,n=Qc(e,t);e=n[0],t=n[1],this.initSprite(),this.initLines(),this.started=!0,this.distanceX=1,this.distanceY=1,this.startX=e,this.startY=t,this.setSpritePosition(e,t),this.sprite.scale.set(1,1,1);for(var o=this.sprite.children,s=0;s<o.length;s++)o[s].position.set(0,0,0);this.sprite.visible=!0,this.app.trigger(F.AreaPickStart),this.updateRegion(),this.move(i,r)},e.prototype.move=function(e,t){var i=Qc(e,t);e=i[0],t=i[1],this.distanceX=e-this.startX,this.distanceY=t-this.startY,this.setSpritePosition(this.startX+this.distanceX/2,this.startY+this.distanceY/2);var r=this.distanceX?this.distanceX:1,n=this.distanceY?this.distanceY:1;this.distanceX<0&&(r*=-1),this.distanceY<0&&(n*=-1),this.sprite.scale.set(r,n,1),this.setSpriteLinePosition(this.sprite.position.x,this.sprite.position.y,r,n),this.spriteLineNode.visible=!0,this.updateRegion()},e.prototype.end=function(){this.started&&(this.started=!1,this.sprite&&(this.sprite.visible=!1),this.spriteLineNode&&(this.spriteLineNode.visible=!1),this.app.trigger(F.AreaPickEnd))},e.prototype.intersectPoint=function(e){var t=e[0],i=e[1],r=this.region;return!(t<r[0])&&(!(t>r[2])&&(!(i<r[1])&&!(i>r[3])))},e.prototype.intersectObject=function(e,t){for(var i=this.app.camera,r=new THREE.Vector3,n=(e.isBaseObject?e.node:e).getMeshes(),o=0;o<n.length;o++){var s=n[o],a=s.geometry,l=s.matrixWorld;if(a.isBufferGeometry){var u=a.index,c=a.attributes.position;if(null!==u){var h=Math.max(1,Math.floor(u.count*t));for(f=0,m=u.count;f<m;f+=h){r.fromBufferAttribute(c,u.getX(f)),r.applyMatrix4(l);var p=i.worldToScreen(r);if(this.intersectPoint(p))return!0}}else if(void 0!==c)for(var d=Math.max(1,Math.floor(c.count*t)),f=0,m=c.count;f<m;f+=d){r.fromBufferAttribute(c,f),r.applyMatrix4(l);p=i.worldToScreen(r);if(this.intersectPoint(p))return!0}}else if(a.isGeometry){var g=a.vertices,v=Math.max(1,Math.floor(g.length*t));for(f=0,m=g.length;f<m;f+=v){(r=g[f].clone()).applyMatrix4(l);p=i.worldToScreen(r);if(this.intersectPoint(p))return!0}}}return!1},e.prototype.processPicking=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.app.picker,n=[];if(r._results.clear(),e)for(var o=0;o<e.length;o++){var s=e[o];if(s.pickable&&this.intersectObject(s,t)){r._results.add(s);var a=r.pickedResultFunc;if(a&&!(s=a(s)))continue;if(!i&&!r.areaCandidates.has(s))continue;-1===n.indexOf(s)&&n.push(s)}}return n},o(e,[{key:"realTimePicking",get:function(){return this._realTimePicking}}]),e}(),$c=function(){function e(t,i){n(this,e),this.app=t,this.domElem=t.domElement,this._state=new ui,this._changed=!1,this.intersect=null,this.dragIntersect=null,this.lastPickFrame=-1,this.lastPickPosition=null,this._pickedResultsFunc=null,this._pickedResultFunc=null,this._results=new $t(this.app),this._objects=new $t(this.app),this._previousObjects=new $t(this.app),this._tempObjects=[],this.pickingArea=new Kc(this.app),this._areaCandidates=new $t(this.app),this._areaPicking=!1,this.cameraPickingGround=new Gc(this.app),this.floorPickingGround=new Gc(this.app),this._disableGPUPicker=!1,this.gpuPicker=null,i&&(this.gpuPicker=new Wc(this.app,{debug:!1})),this.enable=!0,this.initEvents()}return e.prototype.initEvents=function(){var e=this;this.app.on("destroy",(function(t){var i=t.object;e._areaCandidates.remove(i)}))},e.prototype.getPickedObject=function(e){return this.app.objectManager.getBaseObject(e)},e.prototype.filter=function(e,t){if(null==e)return null;for(var i=[],r=[],n=0;n<e.length;n++){var o=e[n],s=o.object;if(!s.userData.skipPick){var a=this.getPickedObject(s);if(a)if(!a.node.userData.skipPick){if(this._results.add(a),this._pickedResultFunc&&!t){var l=this._pickedResultFunc(a);if(!l)continue;o.node=l.node,o.object=this.app.objectManager.getBaseObject(l.node)}if(!this._pickedResultsFunc||t){r=[o];break}-1===i.indexOf(a)&&i.push(a),r.push(o)}}}if(this._pickedResultsFunc&&!t){var u={objects:i,result:null};if(this._pickedResultsFunc(u),u.result){var c=i.indexOf(u.result);-1!==c&&(r=[r[c]])}}return r[0]},e.prototype.isTopSprite=function(e){return!e.material.depthTest},e.prototype.sortIntersectObjects=function(e){var t=this;e.sort((function(e,i){var r=e.object,n=i.object,o=r.userData,s=n.userData;if(!o.topNode&&s.topNode)return-1;if(o.topNode&&!s.topNode)return 1;if(o.subNode&&!s.subNode)return-1;if(!o.subNode&&s.subNode)return 1;if(r.isSprite){if(t.isTopSprite(r)&&!n.isSprite)return-1}else if(n.isSprite){if(t.isTopSprite(n)&&!r.isSprite)return 1}else{var a=r.material,l=n.material;if(a.depthTest&&!l.depthTest)return 1;if(!a.depthTest&&l.depthTest)return-1}return e.distance-i.distance}))},e.prototype.pickIntersectObjects=function(e,t,i,r){var n=[];if(t=this._disableGPUPicker||t,this.gpuPicker&&!t){var o=this.app.objectManager.interactableNodes;o.length&&(n=e.intersectEnsureVisibleObjects(o,!0,this.app.renderCamera));var s=this.gpuPicker.pick(this.app.renderCamera,i,r,e);s&&n.push(s)}else{n=e.intersectObject(this.app.scene,!0);for(var a=0;a<n.length;a++){var l=n[a].object.material;l.opacity&&l.visible||n.splice(a--,1)}}return n},e.prototype.__isSameFrame=function(e,t,i){return!i&&(this.lastPickFrame==this.app.currentFrameCount&&(!!this.lastPickPosition&&(this.lastPickPosition[0]==e&&this.lastPickPosition[1]==t)))},e.prototype._isSameFrame=function(e,t,i){return!!this.__isSameFrame(e,t,i)||(this.lastPickPosition=this.lastPickPosition||[0,0],this.lastPickPosition=[e,t],this.lastPickFrame=this.app.currentFrameCount,!1)},e.prototype.intersectObject=function(e,t,i){var r=i.disableGPUPicker,n=i.ignoreFrameCheck,o=i.ignoreFilter;if(i.forceUpdateTexture){var s=this.gpuPicker;s&&(s.forceUpdate=!0)}if(this._pickedResultsFunc&&(r=!0),!this.enable)return null;if(this._isSameFrame(e,t,n))return this.intersect;this.intersect=null,this._results.clear();var a=Qc(e,t);e=a[0],t=a[1];var l=this.app.calcRect(),u=this.app.renderCamera.getRaycaster(e,t,l),c=this.pickIntersectObjects(u,r,e,t);if(null==c||0==c.length)return null;this.sortIntersectObjects(c);var h=this.filter(c,o);h?(this.intersect=h,this.intersect.object=this.getPickedObject(h.node||h.object),this.intersect.ignoreFilter=!0):(this.intersect=c,this.intersect.ignoreFilter=!1);var p=this.intersect.point;return p&&p.isVector3&&(this.intersect.point=p.toArray()),this.intersect},e.prototype.showPickingGround=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.cameraPickingGround.visible=e},e.prototype.processGroundPicking=function(e,t){if(!this.app.isInScreen([e,t]))return null;var i=this.app.camera;return this.app.renderCamera.updateMatrixWorld(),this.cameraPickingGround.update(i.position,i.target),this.cameraPickingGround.intersect(e,t)},e.prototype.processPicking=function(e){var t=new THREE.Vector2;t.x=e.clientX,t.y=e.clientY;var i=e.offset;i&&(t.x+=i[0],t.y+=i[1]);var r=this.intersectObject(t.x,t.y,e);return null==r?null:(e.intersect=r,e.object=r.object,e.id=Et.isArray(r)?r[0].id:r.id,e.picked=!0,e.ignoreFilter=r.ignoreFilter,Object.defineProperties(e,{pickedPosition:{get:function(){var e=this.intersect.pickedPosition||this.intersect.point;return e||this.intersect.length&&(e=this.intersect[0].pickedPosition),e}}}),e.pickedObj=e.object,e.getPickedPos=function(){return THING.Utils.warn("Please use .getPickedPosition() to replace .getPickedPos()"),e.getPickedPosition()},e.getPickedPosition=function(){return THING.Utils.warn("Please use .pickedPosition to replace .getPickedPosition()"),e.pickedPosition},r)},e.prototype.removePickingResources=function(e){this.gpuPicker&&this.gpuPicker.removePickingResources(e)},e.prototype.markPickingNode=function(e){this.gpuPicker&&this.gpuPicker.markPickingNode(e)},e.prototype.notifyChanged=function(){this.app.trigger(F.PickChange,{objects:this._objects,previousObjects:this._previousObjects});for(var e=this._objects.concat(this._previousObjects),t=0;t<e.length;t++){e[t].trigger(F.PickChange,{objects:this._objects,previousObjects:this._previousObjects})}this._previousObjects.buildReturnObject(this._objects)},e.prototype.update=function(e){var t=function(){if(Hc&&void 0!==Hc.checkAuthRet){var e=Hc.checkAuthRet;return Hc.checkAuthRet=void 0,e}}();void 0!==t&&(t?this.app.trigger("authSuccessed"):this.app.trigger("authFailed")),this.enable&&(this.gpuPicker&&this.gpuPicker.update(e),this._changed&&(this.notifyChanged(),this._changed=!1))},e.prototype.resize=function(e,t){this.gpuPicker&&this.gpuPicker.resizeTexture(e,t)},e.prototype.render=function(e){this.gpuPicker&&this.gpuPicker.render(e)},e.prototype.hasPicked=function(e,t){if(!t)return!1;if(!this.intersect)return!1;var i=this.intersect.object;if(!i)return!1;if(i!=t){if(e._stopPropagation)return!1;if(!i.isChildOf(t))return!1}return!0},e.prototype.setPickedObject=function(e,t,i){var r=this;if(this._tempObjects.length=0,e){if(e.isBaseObject&&this._objects.has(e))return;var n=[];if((n=Et.isArray(e)?e.map((function(e){return{object:e.node}})):e.isSelector?e.toArray().map((function(e){return{object:e.node}})):[{object:e.node}]).length>1)n.forEach((function(e){if(r.filter([e],i)){var t=e.object;if(t)if(t.isBaseObject)r._tempObjects.push(e.object);else{var n=r.app.objectManager.getBaseObject(t);n&&r._tempObjects.push(n)}}})),e=this._tempObjects.length>1?this._tempObjects:this._tempObjects[0];else{if(!this.filter(n,i))return!1;n[0].object&&n[0].object.isBaseObject&&(e=n[0].object)}}for(var o=0;o<this._objects.length;o++){var s=this._objects[o];s.trigger(F.Unpick),this.app.trigger(F.Unpick,{object:s})}return this._objects.clear(),e&&(this._objects.add(e),Et.isArray(e)&&e.length?e.forEach((function(e){e.trigger(F.Pick)})):e.trigger(F.Pick)),this.app.trigger(F.Pick,{object:e instanceof Si?e:null,objects:this._objects,previousObjects:this._previousObjects}),this._previousObjects.equals(this._objects)||(this._changed=!0),t&&e&&(t.object=e),!0},e.prototype.isChanged=function(){return this._changed},e.prototype.intersectResult=function(e,t,i,r){if(r=r||{},void 0===e||void 0===t){var n=this.app.camera.worldToScreen(this.app.camera.target);e=n[0],t=n[1]}var o={clientX:e,clientY:t,offset:i,disableGPUPicker:Et.parseValue(r.disableGPUPicker,!1),ignoreFrameCheck:Et.parseValue(r.ignoreFrameCheck,!0),ignoreFilter:Et.parseValue(r.ignoreFilter,!0)},s=this.processPicking(o);return s?(o.getPickedPosition=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return s.getPickedPosition?s.getPickedPosition(e):[0,0,0]},delete o.offset,delete o.disableGPUPicker,delete o.ignoreFrameCheck,delete o.ignoreFilter,o):{picked:!1,pickedPosition:null,object:null}},e.prototype.pickObjects=function(e,t,i,r,n){if(void 0===i&&void 0===r){if(void 0===e||void 0===t){var o=this.app.camera.worldToScreen(this.app.camera.position);e=o[0],t=o[1]}for(var s=this.app.calcRect(),a=this.app.renderCamera.getRaycaster(e,t,s),l=this.pickIntersectObjects(a,!1,e,t),u=[],c=0;c<l.length;c++){var h=l[c].object;if(!h.userData.isDebuggerNode){var p=this.app.objectManager.getBaseObject(h);p&&u.push({object:p,node:h})}}return u}return this.pickingArea.startX=e,this.pickingArea.startY=t,this.pickingArea.distanceX=i,this.pickingArea.distanceY=r,this.pickingArea.updateRegion(),this.pickingArea.processPicking(n,.01,!0)},e.prototype.pickWorldPosition=function(e,t,i){return this.intersectResult(e,t,i).pickedPosition},e.prototype.startAreaPicking=function(e){var t=(e=e||{}).x,i=e.y,r=Et.parseValue(e.realTimePicking,!0),n=Et.parseValue(e.drawRegion,!0);Et.isNumber(t)&&Et.isNumber(i)&&(this.app.camera.disable({rotate:!0}),this.pickingArea.start(t,i),this.pickingArea._areaPickType=r?A.RealTime:A.NotRealTime,this.pickingArea.sprite.visible=n,this.pickingArea.spriteLineNode.visible=n,this._areaPicking=!0)},e.prototype.endAreaPicking=function(){if(this.areaPicking){this.pickingArea.end(),this.pickingArea._areaPickType=A.Auto,this.app.camera.resume({rotate:!0});var e=this;setTimeout((function(){e._areaPicking=!1}),10)}},e.prototype.pick=function(e,t){var i=this.pickObjects(e,t);if(!i.length)return null;var r={object:i[0].object,node:i[0].node};return Object.defineProperty(r,"pickedPosition",{get:function(){return null}}),r},e.prototype._enable=function(e,t,i){this._state.enable(e,t,i)},o(e,[{key:"pickerState",get:function(){return qc.instance}},{key:"enable",set:function(e){this._enable(e,"default",100)},get:function(){return this._state.isEnable()}},{key:"disableGPUPicker",set:function(e){this._disableGPUPicker=e}},{key:"areaPicking",get:function(){return!!this.enable&&this._areaPicking}},{key:"forceUpdate",set:function(e){this.gpuPicker&&(this.gpuPicker.forceUpdate=e)}},{key:"needUpdate",set:function(e){this.gpuPicker&&(this.gpuPicker.needUpdate=e)}},{key:"areaCandidates",set:function(e){this._areaCandidates.buildReturnObject(e)},get:function(){return this._areaCandidates}},{key:"pickedResultsFunc",set:function(e){this._pickedResultsFunc=e},get:function(){return this._pickedResultsFunc}},{key:"pickedResultFunc",set:function(e){this._pickedResultFunc=e},get:function(){return this._pickedResultFunc}},{key:"results",get:function(){return this._results}},{key:"objects",get:function(){return this._objects}},{key:"previousObjects",get:function(){return this._previousObjects}},{key:"filterPickedResultsFunc",set:function(e){THING.Utils.warn("[Picker] please use .pickedResultsFunc instead"),this.pickedResultsFunc=e},get:function(){return THING.Utils.warn("[Picker] please use .pickedResultsFunc instead"),this.pickedResultsFunc}},{key:"pickedObjectFunc",set:function(e){THING.Utils.warn("[Picker] please use .pickedResultFunc instead"),this.pickedResultFunc=e},get:function(){return THING.Utils.warn("[Picker] please use .pickedResultFunc instead"),this.pickedResultFunc}},{key:"enabled",set:function(e){THING.Utils.warn("[Picker] please use .enable instead"),this.enable=e},get:function(){return THING.Utils.warn("[Picker] please use .enable instead"),this.enable}},{key:"candidates",set:function(e){THING.Utils.warn("[Picker] please use .areaCandidates instead"),this.areaCandidates=e},get:function(){return THING.Utils.warn("[Picker] please use .areaCandidates instead"),this.areaCandidates}}]),e}(),eh=function(){function e(t){n(this,e),this.app=t,this._objects=new $t(this.app),this._previousObjects=new $t(this.app),this._changed=!1}return e.prototype.notifyChanged=function(){this.app.trigger(F.SelectionChange,{objects:this._objects,previousObjects:this._previousObjects});var e=this;this._objects.forEach((function(t){t.trigger(F.SelectionChange,{objects:e._objects,previousObjects:e._previousObjects})})),this._previousObjects.buildReturnObject(this._objects)},e.prototype.update=function(){this._changed&&(this.notifyChanged(),this._changed=!1)},e.prototype.select=function(e){e&&(this._objects.add(e),e.trigger(F.Select,{objects:this._objects}),this.app.trigger(F.Select,{object:e,objects:this._objects}),this._changed=!0)},e.prototype.deselect=function(e){if(e){this._objects.remove(e);var t=new $t(this.app);e.isBaseObject?t.add(e):t=e;for(var i=0;i<t.length;i++){(e=t[i]).trigger(F.Deselect,{objects:t})}this.app.trigger(F.Deselect,{objects:t}),this._changed=!0}},e.prototype.has=function(e){return this._objects.has(e)},e.prototype.clear=function(){if(this._objects.length){this.app.trigger(F.Deselect,{objects:this._objects});for(var e=0;e<this._objects.length;e++){this._objects[e].trigger(F.Deselect,{objects:this._objects})}this._objects.clear(),this._changed=!0}},e.prototype.isChanged=function(){return this._changed},e.prototype.onUpdate=function(e){this.update(e)},o(e,[{key:"objects",get:function(){return this._objects}},{key:"previousObjects",get:function(){return this._previousObjects}}]),e}(),th=new THREE.Frustum,ih=new THREE.Matrix4,rh=function(e){function t(i,r,o){n(this,t);var s=a(this,e.call(this,i));return s.node=r,s.projectionType=M.Perspective,s.controller=o,s.followingObject=null,s.lookingObject=null,s._near=s.node.near,s._far=s.node.far,s.addControl(new THING.CameraControl,"cameraControl"),s}return s(t,e),t.prototype.worldToScreen=function(e){if(!e)return null;e.isBaseObject&&(e=e.boundingBox.center,THING.Utils.warn("[Camera] please use '.worldToScreen(object.boundingBox.center)' to get screen position"));var t=Et.parseVector3(e);t.project(this.node);var i=this.app.renderer.getContext().canvas.width/2,r=this.app.renderer.getContext().canvas.height/2,n=Math.round(t.x*i+i),o=Math.round(-t.y*r+r),s=this.app.renderer.getPixelRatio();return[n/=s,o/=s,t.z]},t.prototype.screenToWorld=function(e,t){if(Et.isArray(e)&&void 0===t){var i=e;e=i[0],t=i[1]}var r=this.app.picker.processGroundPicking(e,t);return r?r.point.toArray():this.unprojectScreenToWorld(e,t)},t.prototype.unprojectScreenToWorld=function(e,t,i){if(Et.isArray(e)&&void 0===t){var r=e;e=r[0],t=r[1]}var n=this.app.renderer.getPixelRatio();t*=n;var o=(e*=n)/this.app.renderer.getContext().canvas.width*2-1,s=-t/this.app.renderer.getContext().canvas.height*2+1;return i=i||-1,new THREE.Vector3(o,s,i).unproject(this.node).toArray()},t.prototype.lerpToPerspective=function(e,t){this.projectionType=M.Perspective,this.node.lerpToPerspective(e,t)},t.prototype.lerpToOrthographic=function(e,t,i,r){this.projectionType=M.Orthographic,this.node.lerpToOrthographic(e,t,i,r)},t.prototype.setSize=function(e,t){this.node.setSize(e,t)},t.prototype.stopFlying=function(e){var t=this.getControl("cameraControl");t&&t.stopFlying(e)},t.prototype.flyTo=function(e){var t=this.getControl("cameraControl");t&&(this.app.setCurrentHTMLMarker(null),t.flyTo(e))},t.prototype.lookAt=function(e){var t=this.getControl("cameraControl");if(t)return t.lookAt(e)},t.prototype.followObject=function(e){var t=this.getControl("cameraControl");t&&t.followObject(e)},t.prototype.stopFollowingObject=function(){var e=this.getControl("cameraControl");e&&e.stopFollowingObject()},t.prototype.movePath=function(e){var t=this.getControl("cameraControl");t&&t.movePath(e)},t.prototype.rotateAround=function(e){var t=this.getControl("cameraControl");t&&t.rotateAround(e)},t.prototype._stopRotating=function(){e.prototype.stopRotating.call(this)},t.prototype.stopRotating=function(e){var t=this.getControl("cameraControl");t&&t.stopRotating(e)},t.prototype.rotate=function(e){var t=this.getControl("cameraControl");t&&t.rotate(e)},t.prototype.rotateX=function(e){this.rotate([e,0,0])},t.prototype.rotateY=function(e){if(this.controller instanceof THREE.EarthOrbitControls){var t=new THREE.Vector3;t.copy(this.controller.object.position),t.normalize(),this.controller.object.rotateOnWorldAxis(t,THING.Math.degToRad(e)),this.controller._isCameraStatic=!1;var i=this.controller._getIntersectPoint();this.controller._isCameraStatic=!0,this.controller.target.copy(i)}else this.rotate([0,e,0])},t.prototype.rotateZ=function(e){this.rotate([0,0,e])},t.prototype.isInView=function(e){return!(!e||!e.isBaseObject)&&this.node.isInView(e.boundingBox.toBox())},t.prototype._setPosition=function(e){this.node.position.fromArray(e)},o(t,[{key:"frustum",get:function(){return ih.multiplyMatrices(this.node.projectionMatrix,this.node.matrixWorldInverse),th.setFromProjectionMatrix(ih),th}},{key:"flying",get:function(){var e=this.getControl("cameraControl");return!!e&&e.isFlying()}},{key:"isPerspectiveCamera",get:function(){return this.node.isPerspectiveCamera}},{key:"fov",set:function(e){this.node.setFov(e)},get:function(){return this.node.fov}},{key:"near",set:function(e){this._near=e,this.node.setNear(e)},get:function(){return this._near}},{key:"far",set:function(e){this._far=e,this.node.setFar(e)},get:function(){return this._far}},{key:"up",set:function(e){this.node.up.fromArray(e)},get:function(){return this.node.up.toArray()}},{key:"position",set:function(e){this._setPosition(e)},get:function(){return this.node.position.toArray()}},{key:"target",set:function(e){var t=this.getControl("cameraControl");t&&t.setTarget(e)},get:function(){return this.controller.target.toArray()}},{key:"distance",set:function(e){var t=Et.parseVector3(this.position),i=Et.parseVector3(this.target),r=new THREE.Vector3;r.subVectors(t,i),r.normalize(),r.multiplyScalar(e),i.add(r),this.position=i.toArray()},get:function(){var e=Et.parseVector3(this.position),t=Et.parseVector3(this.target);return e.distanceTo(t)}},{key:"direction",get:function(){var e=Et.parseVector3(this.position),t=Et.parseVector3(this.target),i=new THREE.Vector3;return i.subVectors(t,e),i.normalize(),i.toArray()}},{key:"rightDirection",get:function(){var e=THING.Utils.parseVector3(this.direction),t=THING.Utils.parseVector3(this.up),i=new THREE.Vector3;return i.crossVectors(e,t),i.normalize(),i.toArray()}}]),t}(Si),nh=function(){function e(t){var i=this;n(this,e),this.app=t,this.picker=t.picker,this.orbit=new THREE.OrbitControls(this.app.renderCamera,this.app.mainDomElement),this.curOrbit=this.orbit,this.initOrbit(this.orbit),this.cameraObject=new rh(this.app,this.app.renderCamera,this.orbit),this.toggleBackupInfo={},this.zoomTween=null,this._autoAdjustNear=!0,this._autoAdjustTarget=!0,this._autoHideObjectsWhenRotatingFunc=null,this._enableUpdateTargetOnWheel=!0,this._enableZoomOnTarget=!1,this._wheelOnMouseTargetScale=3,this._wheelOnMouseTargetPosition=null,this._autoFixCameraUp=!0,this._wheeling=!1,this._hadEnabledPicking=!1,this._targetObject=null,this._inputEnableFlag=new Di((function(e){i.curOrbit.enabled=e})),this._panEnableFlag=new Di((function(e){"normal"==i.mode?i.curOrbit.enablePan=e:i.curOrbit.enableRotate=e})),this._rotateEnableFlag=new Di((function(e){"normal"==i.mode?i.curOrbit.enableRotate=e:i.curOrbit.enablePan=e})),this._zoomEnableFlag=new Di((function(e){i.curOrbit.enableZoom=e})),this.cameraObject.isPerspectiveCamera&&(this.cameraFov=this.cameraObject.fov,this.cameraNear=this.cameraObject.near,this.cameraFar=this.cameraObject.far);var r=this;if(this.app.on("backgroundChanged",(function(e){var t=r.toggleBackupInfo.toggleSkyBox;t&&(t.background=e.background)})),this.prevPosition=[0,0,0],this.prevTarget=[0,0,0],!(this.orbit instanceof THREE.EarthOrbitControls)){var o=new THREE.Box3;this._targetBoundary=o,this.curOrbit.target.add=function(e){THREE.Vector3.prototype.add.call(this,e),o.isEmpty()||this.clamp(o.min,o.max)},this.curOrbit.target.addScaledVector=function(e,t){THREE.Vector3.prototype.addScaledVector.call(this,e,t),o.isEmpty()||this.clamp(o.min,o.max)},this.curOrbit.target.set=function(e,t,i){if(!o.isEmpty()){if(o.min.x>e||o.max.x<e)return;if(o.min.y>t||o.max.y<t)return;if(o.min.z>i||o.max.z<i)return}THREE.Vector3.prototype.set.call(this,e,t,i)}}}return e.prototype.initOrbit=function(e){e.minDistance=1e-4,e.minZoom=.15,e.maxZoom=8,e.autoRotate=!1,e.enableDamping=!0,e.minPolarAngle=0,e instanceof THREE.EarthOrbitControls||(e.maxPolarAngle=Math.PI),e.keyPanSpeed=.1,e.panSpeed=.1,e.rotateSpeed=.07,e.dampingFactor=.078,e.screenSpacePanning=!0,e.enabled=!0,this.registerOrbitEvents(e)},e.prototype.registerOrbitEvents=function(e){var t=this;e.addEventListener("mousedownpanevent",(function(e){t.onMouseDownPanEvent(e)})),e.addEventListener("mouseuppanevent",(function(e){t.onMouseUpPanEvent(e)})),e.addEventListener("mousemoveevent",(function(e){t.onMouseMoveEvent(e)})),e.addEventListener("start",(function(e){t.onStart(e)})),e.addEventListener("end",(function(e){t.onEnd(e)})),e.addEventListener("wheel",(function(e){t.onWheel(e)})),e.addEventListener("change",(function(e){t.onChange(e)}))},e.prototype.isCameraController=function(){return!0},e.prototype._zoom=function(e,t,i){this.zoomTween&&this.zoomTween.stop();var r=this;this.zoomTween=new TWEEN.Tween({zoom:e}).to({zoom:t},i).easing(TWEEN.Easing.Linear.None).onUpdate((function(){r._rotateEnableFlag.lock(!1,"_zoom"),r.curOrbit.object.zoom=this._object.zoom,r.curOrbit.object.updateProjectionMatrix()})).onComplete((function(){r._rotateEnableFlag.unlock("_zoom")})).start()},e.prototype._change=function(e){this.app.trigger(e,{position:this.position,target:this.target})},e.prototype._autoFixTarget=function(){var e=this.curOrbit;if(e.target.distanceTo(e.object.position)>5)return!1;var t=new THREE.Vector3(0,0,0);t.subVectors(e.target,e.object.position).normalize();var i=t.multiplyScalar(10),r=new THREE.Vector3(0,0,0);return r.addVectors(e.object.position,i),e.target.set(r.x,r.y,r.z),!0},e.prototype._processWheelOnMouseTarget=function(e){var t=this.app.renderCamera,i=this.curOrbit,r=this.app.calcRect(),n=r.width/2,o=r.height/2,s=this.app.getClientPosition(e);(l=this._getIntersectPosition(s.x,s.y))||(l=this.cameraObject.unprojectScreenToWorld(s.x,s.y,.5));var a=this._getIntersectPosition(n,o);a||(a=this.cameraObject.unprojectScreenToWorld(n,o,.5));var l=Et.parseVector3(l),u=Et.parseVector3(this.position);this._wheelOnMouseTargetPosition=l.toArray();var c=t.position.distanceTo(l)/100;c*=this._wheelOnMouseTargetScale,l.sub(u).normalize().multiplyScalar(c),e.delta<0?(t.position.x+=l.x,t.position.y+=l.y,t.position.z+=l.z):(t.position.x-=l.x,t.position.y-=l.y,t.position.z-=l.z),i.target.x=a[0],i.target.y=a[1],i.target.z=a[2]},e.prototype._intersectObject=function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.app.calcRect(),n=this.app.renderCamera.getRaycaster(e,t,r),o=this.app.picker.pickIntersectObjects(n,!1,e,t);if(!o.length)return null;for(var s=this.app.picker.floorPickingGround,a=0;a<o.length;a++){var l=o[a].object;(s.isMeshOf(l)||l.userData.__debugObject__)&&o.splice(a--,1)}if(o.length){var u=this.app.objectManager.getBaseObject(o[0].node);if(u){var c=o[0].getPickedPosition();if(i)return c;var h=this.target,p=this.position,d=this.direction,f=this.distance,m=THING.Math.getDistance(c,p),g=THING.Math.getDistance(c,h);f>=m&&(g*=-1);var v=THING.Math.addVector(h,THING.Math.scaleVector(d,g)),y=THING.Math.getDistance(p,v),b=this.distanceLimited;return y<=b[0]||y>=b[1]?null:v}}return null},e.prototype._getIntersectPosition=function(e,t){var i=this._intersectObject(e,t,!0);if(i)return i.isVector3?i.toArray():i;var r=this.app.calcRect(),n=this.app.renderCamera.getRaycaster(e,t,r),o=this.app.picker.floorPickingGround.intersectByRaycaster(n);return o?o.point.toArray():null},e.prototype._adjustTargetStrictly=function(){var e=this.app.calcRect(),t=e.width/2,i=e.height/2,r=this._intersectObject(t,i,!1);r&&(this.target=r)},e.prototype.onMouseDownPanEvent=function(e){this._autoAdjustTarget&&this._adjustTargetStrictly()},e.prototype.onMouseUpPanEvent=function(e){},e.prototype.onMouseMoveEvent=function(e){this._change("cameraChangeMouseMove")},e.prototype.onStart=function(e){this.flying?this._hadEnabledPicking=!1:(this._hadEnabledPicking=!0,this.app.picker._enable(!1,"onStart",1e3)),this.prevPosition=this.position,this.prevTarget=this.target,this._change("cameraChangeStart"),this._change("cameraControllerChangeStart")},e.prototype.onEnd=function(e){this._hadEnabledPicking&&(this._hadEnabledPicking=!1,this.app.picker._enable(!0,"onStart",0));var t=this.position,i=this.target;THING.Math.equalsVector(this.prevPosition,t,.01)&&THING.Math.equalsVector(this.prevTarget,i,.01)||(this._change("cameraChangeEnd"),this._change("cameraControllerChangeEnd")),this.prevPosition=t,this.prevTarget=i},e.prototype.onWheel=function(e){this._enableUpdateTargetOnWheel&&this._autoFixTarget(),this._change("cameraChangeStart"),this._wheeling=!0,this.app.trigger("camerazoom",{delta:e.delta})},e.prototype.onChange=function(e){this.app.trigger("cameracontrollerchanged"),this._change("cameraChange"),this._wheeling&&(this._wheeling=!1,this._change("cameraChangeEnd"))},e.prototype.zoomIn=function(e){var t=e.zoom||1,i=e.time||1e3,r=t,n=this.curOrbit.object.zoom;this._zoom(r,n,i)},e.prototype.zoomOut=function(e){var t=e.zoom||1,i=e.time||1e3,r=this.curOrbit.object.zoom,n=t;this._zoom(r,n,i)},e.prototype.worldToScreen=function(e){return this.cameraObject.worldToScreen(e)},e.prototype.screenToWorld=function(e,t){return this.cameraObject.screenToWorld(e,t)},e.prototype.unprojectScreenToWorld=function(e,t,i){return this.cameraObject.unprojectScreenToWorld(e,t,i)},e.prototype.setProjectionType=function(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3,o=this,s=e!=this.projectionType;switch(e){case M.Perspective:if(this.cameraObject.lerpToPerspective(n,(function(){if(s&&o.projectionType==M.Perspective){var e=o.toggleBackupInfo.toggleSkyBox;e&&(o.app.background=e.background,o.app.skyBox=e.skyBox,o.app.backgroundAdditiveColor=e.backgroundAdditiveColor,o.app.backgroundColorScaleFactor=e.backgroundColorScaleFactor,o.toggleBackupInfo.toggleSkyBox=null)}})),s){var a=this.toggleBackupInfo.toggleKeyPanSpeed;void 0!==a&&(this.curOrbit.keyPanSpeed=a);var l=this.toggleBackupInfo.toggleMousePanSpeed;void 0!==l&&(this.curOrbit.panSpeed=l);var u=this.toggleBackupInfo.toggleDampingFactor;void 0!==u&&(this.curOrbit.dampingFactor=u);var c=this.toggleBackupInfo.minPolarAngle;void 0!==c&&(this.curOrbit.minPolarAngle=c);var h=this.toggleBackupInfo.maxPolarAngle;void 0!==h&&(this.curOrbit.maxPolarAngle=h)}break;case M.Orthographic:if(s){var p=this.toggleBackupInfo.toggleSkyBox;p?(p.backgroundAdditiveColor=this.app.backgroundAdditiveColor,p.backgroundColorScaleFactor=this.app.backgroundColorScaleFactor):this.toggleBackupInfo.toggleSkyBox={skyBox:this.app.skyBox,background:this.app.background,backgroundAdditiveColor:this.app.backgroundAdditiveColor,backgroundColorScaleFactor:this.app.backgroundColorScaleFactor}}this.app.skyBox=null,s&&(this.toggleBackupInfo.toggleKeyPanSpeed=this.curOrbit.keyPanSpeed,this.toggleBackupInfo.toggleMousePanSpeed=this.curOrbit.panSpeed,this.toggleBackupInfo.toggleDampingFactor=this.curOrbit.dampingFactor,this.toggleBackupInfo.minPolarAngle=this.curOrbit.minPolarAngle,this.toggleBackupInfo.maxPolarAngle=this.curOrbit.maxPolarAngle),this.curOrbit.keyPanSpeed=t/6400,this.curOrbit.panSpeed=t/6400,this.curOrbit.dampingFactor=.12,this.curOrbit.minPolarAngle=0,this.curOrbit.maxPolarAngle=Math.PI;var d=Et.parseVector3(i),f=Et.parseVector3(r);this.cameraObject.lerpToOrthographic(d,f,n);break;default:return!1}},e.prototype._getBestLocation=function(e,t,i){var r=Et.parseVector3(t.size),n=Et.parseVector3(t.center);if(!r.x||!r.y||!r.z){r.x=5,r.y=5,r.z=5}var o=n.clone(),s=new THREE.Vector3(0,1,0);if(e==M.Perspective)o.x=n.x+r.x,o.y=n.y+r.y,o.z=n.z+r.z;else{var a=i||r.length();o.y=n.y+a,s=new THREE.Vector3(0,0,-1)}return{lookAt:n,pos:o,up:s,scale:r}},e.prototype.getBestLocation=function(e){var t;return t=Et.isArray(e)?new $t(this.app,e).boundingBox:e.boundingBox,this._getBestLocation(this.projectionType,t)},e.prototype.setType=function(e,t,i,r,n){var o=this._getBestLocation(t,e.boundingBox,n),s=o.pos.distanceTo(o.lookAt),a=this.distanceLimited[1];if(s>=a){var l=o.pos.subVectors(o.pos.clone(),o.lookAt);l.normalize();var u=o.pos.addVectors(o.lookAt,l.multiplyScalar(a));o.pos=u}switch(this.setProjectionType(t,o.scale.length(),o.pos,o.lookAt,i),t){case M.Perspective:var c=this.toggleBackupInfo.toggleInitPos;void 0!==c&&(o.pos=Et.parseVector3(c));var h=this.toggleBackupInfo.toggleInitLookAt;void 0!==h&&(o.lookAt=Et.parseVector3(h));break;case M.Orthographic:this.toggleBackupInfo.toggleInitPos=this.position,this.toggleBackupInfo.toggleInitLookAt=this.target;break;default:return!1}var p=this.app.rendererManager.getCurrentControl(),d=p.getConfig(),f=d.temporalSuperSampling.enable,m=d.postEffect.screenSpaceAmbientOcclusion.enable;p.mergeConfig({temporalSuperSampling:{enable:!1},postEffect:{screenSpaceAmbientOcclusion:{enable:!1}}}).update();var g=function(){p.mergeConfig({temporalSuperSampling:{enable:f},postEffect:{screenSpaceAmbientOcclusion:{enable:m}}}).update(),r&&r()},v=this._buildFlyParams({position:o.pos.toArray(),target:o.lookAt.toArray(),up:o.up.toArray(),time:i,stop:g,complete:g});return this.cameraObject.flyTo(v),!0},e.prototype.toggleNormalViewMode=function(e){return this.viewMode!=C.Normal&&(this.toggleObject({object:this.app.root,is3D:!0,complete:function(){e&&e()}}),!0)},e.prototype.toggleObject=function(e){var t=(e=e||{}).object||this.app.level.current||this.app.root,i=Et.parseValue(e.is3D,!1),r=e.complete,n=e.time||1e3,o=Et.parseValue(e.force,!1),s=e.height,a=this.app.webViewManager.mixerContext,l=!1;return i?(o||this.projectionType!=M.Perspective)&&(this.projectionType!=M.Perspective&&this._rotateEnableFlag.unlock("toggleObject"),l=this.setType(t,M.Perspective,n,r,s),a.cssCamera=a.backupCSSCamera):(o||this.projectionType!=M.Orthographic)&&(this.projectionType!=M.Orthographic&&this._rotateEnableFlag.lock(!1,"toggleObject"),l=this.setType(t,M.Orthographic,n,r,s),a.cssCamera=this.app.renderCamera.cameraO.clone(),a.cssCamera.getEffectiveFOV=function(){return THING.App.current.renderCamera.getEffectiveFOV()}),l&&this.app.trigger("cameraViewChange",{view:this.projectionType}),l},e.prototype.resize=function(e,t){this.cameraObject.setSize(e,t)},e.prototype._buildFlyParams=function(e){var t=this;e.isBaseObject&&(e={target:e});var i=e._flyStart,r=e._flying,n=e._flyStop,o=e._flyComplete,s=Et.parseValue(e.pickable,!1);return e.flyStart=function(){s||t.picker._enable(!1,"_buildFlyParams",1e3),t._change("cameraChangeStart"),i&&i()},e.flying=function(){Et.isFunction(t.curOrbit.setState)&&t.curOrbit.setState(),t._change("cameraChange"),r&&r()},e.flyStop=function(){Et.isFunction(t.curOrbit.setState)&&t.curOrbit.setState(),s||t.picker._enable(!0,"_buildFlyParams",0),t._change("cameraChangeEnd");var i=e.stop;i&&i(),n&&n()},e.flyComplete=function(){t.picker._enable(!0,"_buildFlyParams",0),Et.isFunction(t.curOrbit.setState)&&t.curOrbit.setState(),t._change("cameraChangeEnd");var i=e.target||e.object;i instanceof Si&&i.trigger("cameraFlyComplete");var r=e.targetForFlyComplete;r!=i&&r instanceof Si&&r.trigger("cameraFlyComplete"),t.app.events.dispatchEvent({type:"cameraFlyComplete"});var n=e.complete;n&&n(),o&&o()},e.autoFixUp=this._autoFixCameraUp,e.targetForFlyComplete=this.app.level.current,e},e.prototype.fit=function(e){(e=e||{}).isBaseObject&&(e={object:e}),e.object=e.object||this.app.root,e.time=1,this.cameraObject.flyTo(e)},e.prototype.stopFlying=function(e){this.cameraObject.stopFlying(e)},e.prototype.flyTo=function(e){if(e=this._buildFlyParams(e),this.viewMode==C.TopView){var t=this;this.toggleObject({is3D:!0,complete:function(){t.cameraObject.flyTo(e)}})}else this.cameraObject.flyTo(e)},e.prototype.movePath=function(e){e=this._buildFlyParams(e),this.cameraObject.movePath(e)},e.prototype.lookAt=function(e){this.cameraObject.lookAt(e)?(this._rotateEnableFlag.lock(!1,"lookAt"),this._panEnableFlag.lock(!1,"lookAt")):(this._rotateEnableFlag.unlock("lookAt"),this._panEnableFlag.unlock("lookAt"))},e.prototype.stopRotateAround=function(e){this.cameraObject.stopRotating(e)},e.prototype.rotateAround=function(e){var t=this;e=e||{};var i=Et.parseValue(e.pickable,!0);e.rotateStart=function(){i||t.picker._enable(!1,"rotateAround",1e3)},e.rotateComplete=function(){i||t.picker._enable(!0,"rotateAround",0)},this.cameraObject.rotateAround(e)},e.prototype.rotateAroundX=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;this.rotateAround({xRotateAngle:e,time:t})},e.prototype.rotateAroundY=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;this.rotateAround({yRotateAngle:e,time:t})},e.prototype.followObject=function(e){e=e||{},this.cameraObject.followObject(e);var t=Et.parseValue(e.enableRotate,!1),i=Et.parseValue(e.enableZoom,!1);t||this._rotateEnableFlag.lock(!1,"followObject"),i||this._zoomEnableFlag.lock(!1,"followObject")},e.prototype.stopFollowingObject=function(){this.cameraObject.stopFollowingObject(),this._rotateEnableFlag.unlock("followObject"),this._zoomEnableFlag.unlock("followObject")},e.prototype.canUpdateOrbit=function(){return!this.cameraObject.flying&&!(!this.curOrbit.enabled&&!this.curOrbit.autoRotate)},e.prototype.update=function(){this.cameraObject.update(),this.canUpdateOrbit()&&this.curOrbit.update()},e.prototype.onUpdate=function(e){this.update(e)},e.prototype.zoom=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(e=Math.min(this.distance-1,e),this.projectionType==M.Perspective){var i=Et.parseVector3(this.direction);i.multiplyScalar(e);var r=Et.parseVector3(this.position);if(r.add(i),this.enableUpdateTargetOnWheel&&this._autoFixTarget()){var n=Et.parseVector3(this.target);n.add(i),this.target=n}this.flyTo({position:r.toArray(),target:this.target,time:t})}else{var o=this.curOrbit.object.zoom+e/20;o>0&&this.zoomOut({zoom:o,time:t})}},e.prototype.rotateX=function(e,t){Et.isNull(t)?this.cameraObject.rotateX(e):(THING.Utils.warn('Please use "this.rotateAround({xRotateAngle: angle,time});" to replace rotateX(angle, time)'),this.rotateAround({xRotateAngle:e,time:t}))},e.prototype.rotateY=function(e,t){Et.isNull(t)?this.cameraObject.rotateY(e):(THING.Utils.warn('Please use "this.rotateAround({yRotateAngle: angle,time});" to replace rotateX(angle, time)'),this.rotateAround({yRotateAngle:e,time:t}))},e.prototype.rotateZ=function(e){this.cameraObject.rotateZ(e)},e.prototype.move=function(e,t){var i=this.dampingFactor/.12;this.curOrbit.move(-e*i,t*i)},e.prototype.loadViewPoint=function(e){this.app.viewPointManger.loadJSON(e)},e.prototype.playViewPoint=function(e){this.app.viewPointManger.play(e)},e.prototype.pauseViewPoint=function(e){this.app.viewPointManger.pause(e)},e.prototype.isInView=function(e){return!!e&&this.cameraObject.isInView(e)},e.prototype.isCovered=function(e){return!!e&&(THING.Utils.warn("not impl yet"),!0)},e.prototype.disable=function(e){(e=e||{}).rotate=Et.parseValue(e.rotate,!0),e.pan=Et.parseValue(e.pan,!0),e.zoom=Et.parseValue(e.zoom,!0),e.rotate&&this._rotateEnableFlag.lock(!1,"disable"),e.pan&&this._panEnableFlag.lock(!1,"disable"),e.zoom&&this._zoomEnableFlag.lock(!1,"disable")},e.prototype.resume=function(e){(e=e||{}).rotate=Et.parseValue(e.rotate,!0),e.pan=Et.parseValue(e.pan,!0),e.zoom=Et.parseValue(e.zoom,!0),e.rotate&&this._rotateEnableFlag.unlock("disable"),e.pan&&this._panEnableFlag.unlock("disable"),e.zoom&&this._zoomEnableFlag.unlock("disable")},e.prototype.showTargetNode=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?this._targetObject||(this._targetObject=this.app.create({type:"Box",position:this.target,style:{color:"#FF0000"}}),this._targetObject.pickable=!1,this._targetObject.style.outlineColor=65535,this._targetObject.node.traverse((function(e){e.userData.__debugObject__=!0}))):this._targetObject&&(this._targetObject.destroy(),this._targetObject=null)},e.prototype.distanceTo=function(e){return this.cameraObject.distanceTo(e)},e.prototype.setTargetLimit=function(e){if(this.orbit instanceof THREE.EarthOrbitControls)this.curOrbit.setTargetLimit(e);else if(e){var t=new THREE.Vector3(e[0],e[1],e[2]),i=this.curOrbit.target,r=i.x+t.x/2,n=i.x-t.x/2,o=i.z+t.z/2,s=i.z-t.z/2,a=i.y-t.y/2,l=i.y+t.y/2;this._targetBoundary.min.set(n,a,s),this._targetBoundary.max.set(r,l,o)}else this._targetBoundary.makeEmpty()},e.prototype.log=function(){THING.Utils.log("["+this.position.toString()+"], ["+this.target.toString()+"]")},e.prototype.dolly=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;THING.Utils.warn("[CameraController] Please use '.zoom()' to replace '.dolly()'"),this.zoom(e,t)},e.prototype.theta=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;THING.Utils.warn("[CameraController] Please use '.rotateX()' to replace '.theta()'"),this.rotateX(e,t)},e.prototype.phi=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;THING.Utils.warn("[CameraController] Please use '.rotateY()' to replace '.theta()'"),this.rotateY(e,t)},o(e,[{key:"aspect",get:function(){return this.cameraObject.node.cameraP.aspect}},{key:"frustum",get:function(){return this.cameraObject.frustum}},{key:"camera",get:function(){return this.app.renderCamera}},{key:"viewMode",set:function(e){this.toggleObject({is3D:e==C.Normal})},get:function(){return this.projectionType==M.Perspective?C.Normal:C.TopView}},{key:"projectionType",set:function(e){this.setProjectionType(e,this.distance,this.position,this.target)},get:function(){return this.cameraObject.projectionType}},{key:"enableDamping",set:function(e){this.curOrbit.enableDamping=e},get:function(){return this.curOrbit.enableDamping}},{key:"dampingFactor",set:function(e){this.curOrbit.dampingFactor=e},get:function(){return this.curOrbit.dampingFactor}},{key:"rotateSpeed",set:function(e){this.curOrbit.rotateSpeed=e},get:function(){return this.curOrbit.rotateSpeed}},{key:"fov",set:function(e){this.cameraObject.fov=e;var t=this.app.webViewManager.mixerContext.cssCamera;t.fov=e,t.updateProjectionMatrix()},get:function(){return this.cameraObject.fov}},{key:"near",set:function(e){this.cameraObject.near=e},get:function(){return this.cameraObject.near}},{key:"far",set:function(e){this.cameraObject.far=e},get:function(){return this.cameraObject.far}},{key:"zoomLimited",set:function(e){this.curOrbit.minZoom=e[0],this.curOrbit.maxZoom=e[1]},get:function(){return[this.curOrbit.minZoom,this.curOrbit.maxZoom]}},{key:"zoomFactor",set:function(e){void 0!==this.curOrbit.zoomFactor?this.curOrbit.zoomFactor=e:void 0!==this.curOrbit.zoomSpeed&&(this.curOrbit.zoomSpeed=e)},get:function(){return void 0!==this.curOrbit.zoomFactor?this.curOrbit.zoomFactor:void 0!==this.curOrbit.zoomSpeed?this.curOrbit.zoomSpeed:1}},{key:"distanceLimited",set:function(e){this.curOrbit.minDistance=e[0],this.curOrbit.maxDistance=e[1]},get:function(){return[this.curOrbit.minDistance,this.curOrbit.maxDistance]}},{key:"xAngleLimitRange",set:function(e){var t=90-e[0],i=90-e[1];this.curOrbit.minPolarAngle=THING.Math.degToRad(Math.min(t,i)),this.curOrbit.maxPolarAngle=THING.Math.degToRad(Math.max(t,i))},get:function(){var e=function(e){return 90-THING.Math.radToDeg(e)},t=e(this.curOrbit.minPolarAngle),i=e(this.curOrbit.maxPolarAngle);return[Math.min(t,i),Math.max(t,i)]}},{key:"yAngleLimitRange",set:function(e){this.curOrbit.minAzimuthAngle=THING.Math.degToRad(e[0]),this.curOrbit.maxAzimuthAngle=THING.Math.degToRad(e[1])},get:function(){return[THING.Math.radToDeg(this.curOrbit.minAzimuthAngle),THING.Math.radToDeg(this.curOrbit.maxAzimuthAngle)]}},{key:"keyPanSpeed",set:function(e){this.curOrbit.keyPanSpeed=e},get:function(){return this.curOrbit.keyPanSpeed}},{key:"mousePanSpeed",set:function(e){this.curOrbit.panSpeed=e},get:function(){return this.curOrbit.panSpeed}},{key:"distance",set:function(e){this.cameraObject.distance=e},get:function(){return this.cameraObject.distance}},{key:"direction",get:function(){return this.cameraObject.direction}},{key:"rightDirection",get:function(){return this.cameraObject.rightDirection}},{key:"up",set:function(e){this.cameraObject.up=e},get:function(){return this.cameraObject.up}},{key:"position",set:function(e){e&&(this.cameraObject.position=e)},get:function(){return this.cameraObject.position}},{key:"target",set:function(e){e&&(this.cameraObject.target=e)},get:function(){return this.cameraObject.target}},{key:"inputEnabled",set:function(e){this._inputEnableFlag.enable(e)},get:function(){return this._inputEnableFlag.isEnable()}},{key:"enableRotate",set:function(e){this._rotateEnableFlag.enable(e)},get:function(){return this._rotateEnableFlag.isEnable()}},{key:"enableZoom",set:function(e){this._zoomEnableFlag.enable(e)},get:function(){return this._zoomEnableFlag.isEnable()}},{key:"enablePan",set:function(e){this._panEnableFlag.enable(e)},get:function(){return this._panEnableFlag.isEnable()}},{key:"flying",get:function(){return this.cameraObject.flying}},{key:"mode",set:function(e){this.mode!=e&&(this.curOrbit.enabled=!1,"earth"==e?(this.curOrbit=new THREE.EarthOrbitControls(this.app.renderCamera,this.app.mainDomElement),this.curOrbit.app=this.app,this.initOrbit(this.curOrbit),this.autoAdjustNear=!1):(this.curOrbit.dispose(),this.curOrbit=this.orbit,this.curOrbit.enabled=!0,this.autoAdjustNear=!0),this.cameraObject.controller=this.curOrbit)},get:function(){return this.curOrbit instanceof THREE.EarthOrbitControls?"earth":"normal"}},{key:"degreeToWorldYAxis",get:function(){var e=Et.parseVector3(this.direction),t=new THREE.Vector3(0,-1,0),i=e.dot(t);return THING.Math.radToDeg(Math.acos(i))}},{key:"autoAdjustNear",set:function(e){this._autoAdjustNear=e,e||(this.cameraObject.near=this.cameraObject._near)},get:function(){return this._autoAdjustNear}},{key:"autoAdjustTarget",set:function(e){this._autoAdjustTarget=e},get:function(){return this._autoAdjustTarget}},{key:"enableUpdateTargetOnWheel",set:function(e){this._enableUpdateTargetOnWheel=e},get:function(){return this._enableUpdateTargetOnWheel}},{key:"enableZoomOnTarget",set:function(e){if("earth"==this.mode)this.curOrbit.enableZoomOnTarget=e,this.curOrbit._keepTarget=!e;else{var t=this;this._enableZoomOnTarget=e,this.inputEnabled=!e,e?(this.app.on("mousewheel",(function(e){t._inputEnableFlag.unlock("enableZoomOnTarget"),t._processWheelOnMouseTarget(e)}),"_processWheelOnMouseTarget_"),this.app.on("mousedown",(function(e){t._inputEnableFlag.lock(!0,"enableZoomOnTarget")}),"_processWheelOnMouseTarget_mousedown")):(this.app.off("mousewheel",null,"_processWheelOnMouseTarget_"),this.app.off("mousedown",null,"_processWheelOnMouseTarget_mousedown"))}},get:function(){return"earth"==this.mode?this.curOrbit.enableZoomOnTarget:this._enableZoomOnTarget}},{key:"wheelOnMouseTargetScale",set:function(e){this._wheelOnMouseTargetScale=e},get:function(){return this._wheelOnMouseTargetScale}},{key:"autoFixCameraUp",set:function(e){this._autoFixCameraUp=e},get:function(){return this._autoFixCameraUp}},{key:"autoHideObjectsWhenRotatingFunc",set:function(e){if(this._autoHideObjectsWhenRotatingFunc=e,this.app.off("cameraControllerChangeStart",null,"__autoHideObjectsWhenRotatingFunc__start__"),this.app.off("cameraControllerChangeEnd",null,"__autoHideObjectsWhenRotatingFunc__end__"),this._autoHideObjectsWhenRotatingFunc){if(!Et.isFunction(this._autoHideObjectsWhenRotatingFunc))return;var t=this;this.app.on("cameraControllerChangeStart",(function(e){t.app.query(".Thing").forEach((function(e){if(t._autoHideObjectsWhenRotatingFunc&&!1===t._autoHideObjectsWhenRotatingFunc(e)&&e.visible){e._prevVisible_auto_hide=!0;var i=app.modelResource.get(e.url);i&&i.loadingBox?(e.changeAppearance(i.loadingBox.clone()),e._needRevertAppearance_auto_hide=!0):e.visible=!1}}))}),"__autoHideObjectsWhenRotatingFunc__start__"),this.app.on("cameraControllerChangeEnd",(function(e){t.app.query(".Thing").forEach((function(e){e._prevVisible_auto_hide&&(e._needRevertAppearance_auto_hide?(e.changeAppearance(null),delete e._needRevertAppearance_auto_hide):e.visible=!0,delete e._prevVisible_auto_hide)}))}),"__autoHideObjectsWhenRotatingFunc__end__")}},get:function(){return this._autoHideObjectsWhenRotatingFunc}},{key:"mouseButtons",set:function(e){var t=function(e,t){var i={left:THREE.MOUSE.LEFT,middle:THREE.MOUSE.MIDDLE,right:THREE.MOUSE.RIGHT};return Et.parseValue(i[e],t)};e=e||{};var i=this.curOrbit.mouseButtons,r=t(e.left,Et.parseValue(i.LEFT,i.ORBIT)),n=t(e.middle,Et.parseValue(i.MIDDLE,i.ZOOM)),o=t(e.right,Et.parseValue(i.RIGHT,i.PAN));"normal"==this.mode?this.curOrbit.mouseButtons={LEFT:r,MIDDLE:n,RIGHT:o}:"earth"==this.mode&&(this.curOrbit.mouseButtons={ORBIT:r,ZOOM:n,PAN:o})},get:function(){var e=function(e){return["left","middle","right"][e]},t=this.curOrbit.mouseButtons;return{left:e(Et.parseValue(t.LEFT,t.ORBIT)),middle:e(Et.parseValue(t.MIDDLE,t.ZOOM)),right:e(Et.parseValue(t.RIGHT,t.PAN))}}},{key:"options",set:function(e){var t=this.options;Et.mergeObject(t,e,!0),this.mouseButtons={left:t.rotationKey,middle:t.zoomKey,right:t.moveKey},"normal"==this.mode?(this.enableZoomOnTarget=t.enableZoomOnTarget,this.enableUpdateTargetOnWheel=t.enableUpdateTargetOnWheel):"earth"==this.mode&&this.curOrbit.setOptions(t)},get:function(){var e={rotationKey:this.mouseButtons.left,zoomKey:this.mouseButtons.middle,moveKey:this.mouseButtons.right};return"normal"==this.mode?(e.enableZoomOnTarget=this.enableZoomOnTarget,e.enableUpdateTargetOnWheel=this.enableUpdateTargetOnWheel):"earth"==this.mode&&Et.mergeObject(e,this.curOrbit.getOptions(e)),e}},{key:"toggle3D",set:function(e){THING.Utils.warn("[CameraController] Please use '.viewMode=THING.CameraView.Normal/TopView' to replace '.toggle3D'"),this.viewMode=e?C.Normal:C.TopView},get:function(){return THING.Utils.warn("[CameraController] Please use '.viewMode == THING.CameraView.Normal' to replace '.toggle3D'"),this.viewMode==C.Normal}},{key:"enabled",set:function(e){THING.Utils.warn("[CameraController] Please use '.inputEnabled' to replace '.enabled'"),this.inputEnabled=e},get:function(){return THING.Utils.warn("[CameraController] Please use '.inputEnabled' to replace '.enabled'"),this.inputEnabled}},{key:"minZoom",set:function(e){THING.Utils.warn("[CameraController] Please use '.zoomLimited=[min, max]' to replace '.minZoom'"),this.zoomLimited=[e,this.zoomLimited[1]]},get:function(){return THING.Utils.warn("[CameraController] Please use '.zoomLimited[0]' to replace '.minZoom'"),this.zoomLimited[0]}},{key:"maxZoom",set:function(e){THING.Utils.warn("[CameraController] Please use '.zoomLimited=[min, max]' to replace '.maxZoom'"),this.zoomLimited=[this.zoomLimited[0],e]},get:function(){return THING.Utils.warn("[CameraController] Please use '.zoomLimited[0]' to replace '.maxZoom'"),this.zoomLimited[1]}},{key:"minDistance",set:function(e){THING.Utils.warn("[CameraController] Please use '.distanceLimited=[min, max]' to replace '.minDistance'"),this.distanceLimited=[e,this.distanceLimited[1]]},get:function(){return THING.Utils.warn("[CameraController] Please use '.distanceLimited[0]' to replace '.minDistance'"),this.distanceLimited[0]}},{key:"maxDistance",set:function(e){THING.Utils.warn("[CameraController] Please use '.distanceLimited=[min, max]' to replace '.maxDistance'"),this.distanceLimited=[this.distanceLimited[0],e]},get:function(){return THING.Utils.warn("[CameraController] Please use '.distanceLimited[0]' to replace '.maxDistance'"),this.distanceLimited[1]}},{key:"minPolarAngle",set:function(e){THING.Utils.warn("[CameraController] Please use '.verticalAngleLimited=[min, max]' to replace '.minPolarAngle'"),this.verticalAngleLimited=[e,this.verticalAngleLimited[1]]},get:function(){return THING.Utils.warn("[CameraController] Please use '.verticalAngleLimited[0]' to replace '.minPolarAngle'"),this.verticalAngleLimited[0]}},{key:"maxPolarAngle",set:function(e){THING.Utils.warn("[CameraController] Please use '.verticalAngleLimited=[min, max]' to replace '.maxPolarAngle'"),this.verticalAngleLimited=[this.verticalAngleLimited[0],e]},get:function(){return THING.Utils.warn("[CameraController] Please use '.verticalAngleLimited[0]' to replace '.maxPolarAngle'"),this.verticalAngleLimited[1]}},{key:"minAzimuthAngle",set:function(e){THING.Utils.warn("[CameraController] Please use '.horizontalAngleLimited=[min, max]' to replace '.minAzimuthAngle'"),this.horizontalAngleLimited=[e,this.horizontalAngleLimited[1]]},get:function(){return THING.Utils.warn("[CameraController] Please use '.horizontalAngleLimited[0]' to replace '.minAzimuthAngle'"),this.horizontalAngleLimited[0]}},{key:"maxAzimuthAngle",set:function(e){THING.Utils.warn("[CameraController] Please use '.horizontalAngleLimited=[min, max]' to replace '.maxAzimuthAngle'"),this.horizontalAngleLimited=[this.horizontalAngleLimited[0],e]},get:function(){return THING.Utils.warn("[CameraController] Please use '.horizontalAngleLimited[0]' to replace '.maxAzimuthAngle'"),this.horizontalAngleLimited[1]}},{key:"verticalAngleLimited",set:function(e){THING.Utils.warn("[CameraController] Please use '.xAngleLimited' to replace '.verticalAngleLimited'"),this.xAngleLimited=e},get:function(){return THING.Utils.warn("[CameraController] Please use '.xAngleLimited' to replace '.verticalAngleLimited'"),this.xAngleLimited}},{key:"horizontalAngleLimited",set:function(e){THING.Utils.warn("[CameraController] Please use '.yAngleLimited' to replace '.verticalAngleLimited'"),this.yAngleLimited=e},get:function(){return THING.Utils.warn("[CameraController] Please use '.yAngleLimited' to replace '.verticalAngleLimited'"),this.yAngleLimited}},{key:"yAngleLimited",set:function(e){THING.Utils.warn("[CameraController] Please use '.xAngleLimitRange' to replace '.yAngleLimited'"),this.xAngleLimitRange=e},get:function(){return THING.Utils.warn("[CameraController] Please use '.xAngleLimitRange' to replace '.yAngleLimited'"),this.xAngleLimitRange}},{key:"xAngleLimited",set:function(e){THING.Utils.warn("[CameraController] Please use '.yAngleLimitRange' to replace '.xAngleLimited'"),this.yAngleLimitRange=e},get:function(){return THING.Utils.warn("[CameraController] Please use '.yAngleLimitRange' to replace '.xAngleLimited'"),this.yAngleLimitRange}},{key:"rotating",get:function(){return THING.Utils.warn("[CameraController] Please use '.flying' to replace '.rotating'"),this.flying}},{key:"panSpeed",set:function(e){THING.Utils.warn("[CameraController] Please use '.keyPanSpeed' to replace '.panSpeed'"),this.keyPanSpeed=e},get:function(){return THING.Utils.warn("[CameraController] Please use '.keyPanSpeed' to replace '.panSpeed'"),this.keyPanSpeed}},{key:"enableUpdateTargetByMove",set:function(e){},get:function(){return!0}}]),e}(),oh=function(){function e(t){n(this,e),this.app=t,this._previous=null,this._current=null,this._root=null,this._changed=!1,this._options={flyTime:1e3,outlineColor:16744448,autoChangeBackground:!0,autoBakeFloor:!0,autoHideFloorObjects:!0,autoEnterSubLevel:!0,autoBackFromSubLevel:!0}}return e.prototype.init=function(){this._root=this.app.root},e.prototype.buildState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var i={};i.name=t+"Level";var r=[];e instanceof Do?(r.push("floor"),r.push("_floor")):e instanceof Ga&&(r.push("building"),r.push("_building"));for(var n=0;n<r.length;n++)i[r[n]]=e;return i},e.prototype.buildAfterEnterState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var i=this.previous?this.previous.type:"";"Campus"==i&&(i="Outdoors");var r={prevState:{name:i+"Level"},state:this.buildState(e),stateName:t+"Level"};return this.previous&&(this.previous instanceof Ga?(r.prevState.building=this.previous,r.prevState._building=this.previous):this.previous instanceof Do&&(r.prevState.floor=this.previous,r.prevState._floor=this.previous)),r},e.prototype.buildBeforeEnterState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var i=this.current?this.current.type:"";"Campus"==i&&(i="Outdoors");var r={prevState:{name:i+"Level"},curState:this.buildState(e),stateName:t+"Level"};return this.previous&&(this.previous instanceof Ga?(r.prevState.building=this.previous,r.prevState._building=this.previous):this.previous instanceof Do&&(r.prevState.floor=this.previous,r.prevState._floor=this.previous)),r},e.prototype.getEventType=function(e,t){var i=t.type;return"Campus"==i&&(i="Outdoors"),e+i+"Level"},e.prototype.buildEventArguments=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var i={name:t+"Level"};return i.state=this.buildState(e),i},e.prototype.notifyBeforeEnterState=function(e){this.app.trigger("beforeEnterState",this.buildBeforeEnterState(e))},e.prototype.notifyAfterEnterState=function(e){this.app.trigger("afterEnterState",this.buildAfterEnterState(e))},e.prototype.nofityAfterLevelChange=function(e){var t=e.object;this.app.trigger(this.getEventType("enter",t),this.buildEventArguments(t)),this.app.trigger(this.getEventType("afterEnter",t),this.buildEventArguments(t))},e.prototype.notifyBeforeLevelChange=function(e){this.app.trigger(this.getEventType("beforeEnter",e),this.buildEventArguments(e))},e.prototype._getLevelType=function(){var e=this._current;return e?e.type:""},e.prototype._leaveLevel=function(e,t){if(this.app.trigger(F.BeforeLevelChange,{level:this._getLevelType(),current:this._current,previous:this._previous,next:e}),this._current){var i=Et.cloneObject(t);i.level=this._getLevelType(),i.object=this._current,i.current=e,i.previous=this._current,this._current.trigger(F.LevelChange,i),this._current.trigger(F.LeaveLevel,i),this.app.trigger(F.LeaveLevel,i)}e&&(this.notifyBeforeLevelChange(e),this.notifyBeforeEnterState(e))},e.prototype._notifyEnterLevel=function(e,t){t.object=e,this.app.trigger(F.EnterLevel,t),this.nofityAfterLevelChange(t)},e.prototype._enterLevel=function(e,t){var i=this;if(this._changed=!0,this._previous=this._current,this._current=e,t.level=this._getLevelType(),t.current=this._current,t.object=this._current,t.previous=this._previous,this.app.trigger(F.LevelChange,t),e){var r=t.lastObject;r.internalUserData.level_complete||(r.internalUserData.level_complete=!0,r.one(F.EnterLevel,(function(e){delete e.object.internalUserData.level_complete;var n=t.userComplete;n&&n(),r.one("cameraFlyComplete",{lastLevelChanged:!0},(function(e){if(e.data.lastLevelChanged&&e.object==r){var n=t.flyComplete;n&&n()}var o=e.object.isPauseEvent(THING.EventType.EnterLevel,THING.EventTag.LevelFly),s=e.object.isPauseEvent(THING.EventType.EnterLevel,THING.EventTag.LevelCustomFly,!0);o&&s||(e.object.trigger(F.LevelFlyEnd,{level:i._getLevelType(),object:e.object,current:e.object,previous:i.previous}),i.app.trigger(F.LevelFlyEnd,{level:i._getLevelType(),object:e.object,current:e.object,previous:i.previous}))}),"___level_camera_fly_complete___")}),"___level_complete___")),e.trigger(F.LevelChange,t),this.notifyAfterEnterState(e);var n=e.isPauseEvent(F.EnterLevel,B.LevelFly),o=e.hasEvent(F.EnterLevel,B.LevelFly);if(t.jumping||n||!o){e.pauseEvent(F.EnterLevel,null,B.LevelFly),e.trigger(F.EnterLevel,t),e.resumeEvent(F.EnterLevel,null,B.LevelFly),this._notifyEnterLevel(e,t),t.jumping||n?this.jumpLevelPath(t):this.app.one("cameraFlyComplete",(function(e){i.jumpLevelPath(t)}),"sceneLevel_cameraFlyComplete");var s=t.complete;s&&s()}else this.app.one("cameraFlyComplete",(function(e){i.jumpLevelPath(t)}),"sceneLevel_cameraFlyComplete"),e.trigger(F.EnterLevel,t),this._notifyEnterLevel(e,t)}},e.prototype._change=function(e,t){t=t||{};var i=this;this.app.camera.toggleNormalViewMode((function(){i._change(e,t)}))||("Outdoors"==e.type&&(THING.Utils.warn("Please use campus to change, not outdoors"),e=e.parents.query(".Campus")[0]),e.isPauseEvent(F.EnterLevel)||(this._leaveLevel(e,t),this._enterLevel(e,t)))},e.prototype.updateJumping=function(e,t){var i=this._current;i&&(i.isChildOf(e)||i.isBrotherOf(e))&&(t.jumping=!0,t.skipBackupCameraInfo=!0)},e.prototype.getParents=function(e,t){for(var i=[],r=e.parents,n=0;n<r.length;n++){var o=r[n];if(o==this.app.root)break;if(i.push(o),o==t)break}return i},e.prototype.getLevelPath=function(e,t){if(this._current&&this._current.parent!=e&&Et.parseValue(this.options.autoEnterSubLevel,t.autoEnterSubLevel)){for(var i=e.children.concat(),r=0;r<i.length;r++){i[r].isFloor||i.splice(r--,1)}1===i.length&&(e=i[0])}var n=[];if(this._current==e)n=[e];else if(this._current)if(this._current.isChildOf(e))(n=this.getParents(this._current,e)).length>=2&&(t.jumping=!0);else if(e.isChildOf(this._current))(n=(n=this.getParents(e,this._current)).reverse()).splice(0,1),n.push(e);else if(e.parent==this._current.parent)n=e.parent?[e.parent,e]:[e];else{var o=this.getParents(e,null).reverse(),s=this.getParents(this._current).reverse();if(o.length&&s.length){for(var a;o.length&&s.length&&o[0]==s[0];)a=o[0],o.splice(0,1),s.splice(0,1);a&&(n=s.reverse().concat([a]).concat(o).concat(e))}else n=o.concat([e])}else n.push(e),n=(n=n.concat(e.parents.not(this.app.root).toArray())).reverse();if(function(e){for(var t=0;t<e.length;t++)if(e[t].isFacade)return!0;return!1}(n))for(r=0;r<n.length;r++)n[r].isBuilding&&n.splice(r,1);return n},e.prototype.jumpLevelPath=function(e){var t=e.levelPath;if(t&&(t.splice(0,1),t.length)){var i=t[0];1==t.length&&(delete e.jumping,this.app.off("cameraFlyComplete","sceneLevel_cameraFlyComplete")),this._change(i,e)}},e.prototype.change=function(e,t){if(t=t||{},e){if(!e.isPauseEvent(F.EnterLevel)&&e.hasEvent(F.EnterLevel)&&(Et.parseValue(t.autoChangeObject,!0)&&e instanceof Vi&&(e=e.building),!t.skipCurrentLevel||e!=this._current)){var i=this.getLevelPath(e,t);if(i.length){var r=i[0],n=i.length>1?i[i.length-1]:null;n&&this.updateJumping(n,t),this.app.off("cameraFlyComplete",null,"sceneLevel_cameraFlyComplete"),t.userComplete=t.complete,t.userFlyComplete=t.flyComplete,t.levelPath=i,t.lastObject=n||e,this._change(r,t)}}}else THING.Utils.error("Please provide the object to change")},e.prototype.quit=function(e){e=e||{},this._current&&(this._leaveLevel(null,e),this._enterLevel(null,e))},e.prototype.back=function(e){if(e=e||{},this._current){var t=this._current.parent;if(this.options.autoBackFromSubLevel)if(e.autoBackFromSubLevel)for(;t&&t.parent&&!t.isCampus;){for(var i=t.children.concat(),r=0;r<i.length;r++)i[r].isFacade&&i.splice(r--,1);if(1!==i.length)break;t=t.parent}this.backTo(t)}},e.prototype.backTo=function(e){if(e&&e!=this._current&&e.isChildOf(this._root)){e.isFacade&&(e=e.parents.query(".Campus")[0]);var t=this;this.app.camera.toggleNormalViewMode((function(){t.backTo(e)}))||this.change(e,{autoChangeObject:!1})}},e.prototype.isChanged=function(){return this._changed},e.prototype.onUpdate=function(e){this._changed&&(this._changed=!1)},o(e,[{key:"current",get:function(){return this._current}},{key:"previous",get:function(){return this._previous}},{key:"root",set:function(e){this._root=e},get:function(){return this._root}},{key:"options",set:function(e){this._options=Et.mergeObject(this._options,e,!0)},get:function(){return this._options}}]),e}(),sh=function(){function e(t){n(this,e),this.app=t,this._backups={camera:{},lighting:{},postEffect:{}},this._campusSkyBox=null,this._campusBackground=null,this._campusSkyBoxColorTween=null,this._levelChanging=!1,this._lastPickedObject=null}return e.prototype.setCampusSkyBoxColorScaleFactor=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this._campusSkyBoxColorTween&&this._campusSkyBoxColorTween.stop();var i=Et.parseVector3(this.app.backgroundColorScaleFactor),r=Et.parseVector3(e),n=this;this._campusSkyBoxColorTween=new TWEEN.Tween(i).to(r,t).onUpdate((function(){n.app.backgroundColorScaleFactor=[this._object.x,this._object.y,this._object.z]})),this._campusSkyBoxColorTween.start()},e.prototype.updatebackupInfo=function(e,t){var i=this._backups[e];i[t]=i[t]||{};var r=i[t];"camera"==e?(r.position=this.app.camera.position,r.target=this.app.camera.target):"lighting"==e?r.value=this.app.lighting:"postEffect"==e&&(r.value=this.app.postEffect)},e.prototype.clearBackupInfo=function(e,t){delete this._backups[e][t]},e.prototype.getBackupInfoValue=function(e,t,i){var r=this._backups[e][t];return r?r[i]:null},e.prototype.initAppEvents=function(){var e=this;this.app.on("cameracontrollerchanged",(function(t){e.app.level.current&&e._levelChanging&&e.app.camera.stopFlying()}),B.LevelFlyBreak),this.app.on("dblclick",(function(t){if(0==t.button){var i=e.app.level,r=i.current;if(r){var n=t.object;if(n!=r&&function(e){return!!e&&(!e.isTextRegion&&!e.isMarker)}(n)){if(n.isGround)return;var o=!1;n.isBuilding&&(o=!0),i.change(n,{autoEnterSubLevel:o})}}}}),B.LevelEnterOperation),this.app.on("click",(function(t){if(2==t.button){var i=e.app.level;if(i.current){var r=t.object;r&&r.style.outlineColor&&(r.style.outlineColor=null);var n=!1;i.current.isFloor&&(n=!0),i.back({autoBackFromSubLevel:n})}}}),B.LevelBackOperation);this.app.on(F.Pick,(function(t){var i=e.app.level;if(i.current){e._lastPickedObject&&e._lastPickedObject.style.outlineColor&&(e._lastPickedObject.style.outlineColor=null);var r=t.object;(function(t){var i=e.app.level.current;return!(!i||!t||t==i||"Ground"==t.type||t.isMarker||i.isCampus&&t.isChildOf(i.ground))})(r)&&(r.style.outlineColor=i.options.outlineColor),e._lastPickedObject=r}}),B.LevelPickOperation),this._campusSkyBox=this.app.skyBox,this._campusBackground=this.app.background,this.app.on("skyboxchange",(function(t){var i=e.app.level.current;i&&!i.isCampus||(e._campusSkyBox=t.skyBox)}))},e.prototype.buildFlyParams=function(e,t){t=t||{};var i=this,r=this.app.level.options;e._flyStart=function(){i._levelChanging=!0},e._flying=function(){i._levelChanging=!0},e._flyStop=function(){i._levelChanging=!1},e._flyComplete=function(){i._levelChanging=!1},e.distance=e.distance||t.distance,e.time=Et.parseValue(e.time||t.time,r.flyTime),e.keepDirection=Et.parseValue(e.keepDirection||t.keepDirection,!1);var n=this.app.level.current;if(t.lastObject==n&&(e.offset=e.offset||t.offset,e.worldOffset=e.worldOffset||t.worldOffset,e.xAngle=Et.parseValue(e.xAngle||t.xAngle,null),e.yAngle=Et.parseValue(e.yAngle||t.yAngle,null),void 0===e.radius))if(void 0!==t.radius)e.radius=t.radius;else{var o=e.boundingBox||n.boundingBox;e.radius=o.radius}e.targetForFlyComplete=n;var s=n.userData.camInfo;if(s){var a=n.parents.query(".Campus")[0];a&&(e.target=a.selfToWorld(s.target),e.position=a.selfToWorld(s.eye))}return e},e.prototype.registerSceneLevelEvents=function(){var e=this;this.app.on(F.EnterLevel,".BaseObject",(function(t){e.onBaseObjectLevelSceneOperations(t)}),B.LevelSceneOperations),this.app.on(F.EnterLevel,".Campus",(function(t){e.onCampusLevelSetBackground(t)}),B.LevelSetBackground),this.app.on(F.EnterLevel,".Campus",(function(t){e.onCampusLevelSetEffect(t)}),B.LevelSetEffect),this.app.on(F.EnterLevel,".Campus",(function(t){e.onCampusLevelSceneOperations(t)}),B.LevelSceneOperations),this.app.on(F.EnterLevel,".Campus",(function(t){e.onCampusLevelPickedResultFunc(t)}),B.LevelPickedResultFunc),this.app.on(F.EnterLevel,".Campus",(function(t){e.onCampusLevelFly(t)}),B.LevelFly),this.app.on(F.LeaveLevel,".Campus",(function(t){e.onCampusLevelLeaveSceneOperations(t)}),B.LevelSceneOperations),this.app.on(F.EnterLevel,".Facade",(function(t){e.onFacadeLevelSetBackground(t)}),B.LevelSetBackground),this.app.on(F.EnterLevel,".Facade",(function(t){e.onFacadeLevelSetEffect(t)}),B.LevelSetEffect),this.app.on(F.EnterLevel,".Facade",(function(t){e.onFacadeLevelSceneOperations(t)}),B.LevelSceneOperations),this.app.on(F.EnterLevel,".Facade",(function(t){e.onFacadeLevelPickedResultFunc(t)}),B.LevelPickedResultFunc),this.app.on(F.EnterLevel,".Facade",(function(t){e.onFacadeLevelFly(t)}),B.LevelFly),this.app.on(F.LeaveLevel,".Facade",(function(t){e.onFacadeLevelLeaveSceneOperations(t)}),B.LevelSceneOperations),this.app.on(F.EnterLevel,".Building",(function(t){e.onBuildingLevelSetBackground(t)}),B.LevelSetBackground),this.app.on(F.EnterLevel,".Building",(function(t){e.onBuildingLevelSetEffect(t)}),B.LevelSetEffect),this.app.on(F.EnterLevel,".Building",(function(t){e.onBuildingLevelSceneOperations(t)}),B.LevelSceneOperations),this.app.on(F.EnterLevel,".Building",(function(t){e.onBuildingLevelPickedResultFunc(t)}),B.LevelPickedResultFunc),this.app.on(F.EnterLevel,".Building",(function(t){e.onBuildingLevelFly(t)}),B.LevelFly),this.app.on(F.LeaveLevel,".Building",(function(t){e.onBuildingLevelLeaveSceneOperations(t)}),B.LevelSceneOperations),this.app.on(F.EnterLevel,".Floor",(function(t){e.onFloorLevelSetBackground(t)}),B.LevelSetBackground),this.app.on(F.EnterLevel,".Floor",(function(t){e.onFloorLevelSetEffect(t)}),B.LevelSetEffect),this.app.on(F.EnterLevel,".Floor",(function(t){e.onFloorLevelSceneOperations(t)}),B.LevelSceneOperations),this.app.on(F.EnterLevel,".Floor",(function(t){e.onFloorLevelPickedResultFunc(t)}),B.LevelPickedResultFunc),this.app.on(F.EnterLevel,".Floor",(function(t){e.onFloorLevelFly(t)}),B.LevelFly),this.app.on(F.LeaveLevel,".Floor",(function(t){e.onFloorLevelLeaveSceneOperations(t)}),B.LevelSceneOperations),this.app.on(F.EnterLevel,".Room",(function(t){e.onRoomLevelSceneOperations(t)}),B.LevelSceneOperations),this.app.on(F.EnterLevel,".Room",(function(t){e.onRoomLevelPickedResultFunc(t)}),B.LevelPickedResultFunc),this.app.on(F.EnterLevel,".Room",(function(t){e.onRoomLevelFly(t)}),B.LevelFly),this.app.on(F.LeaveLevel,".Room",(function(t){e.onRoomLevelLeaveSceneOperations(t)}),B.LevelSceneOperations),this.app.on(F.EnterLevel,".Thing",(function(t){e.onThingLevelSceneOperations(t)}),B.LevelSceneOperations),this.app.on(F.EnterLevel,".Thing",(function(t){e.onThingLevelPickedResultFunc(t)}),B.LevelPickedResultFunc),this.app.on(F.EnterLevel,".Thing",(function(t){e.onThingLevelFly(t)}),B.LevelFly),this.app.on(F.LeaveLevel,".Thing",(function(t){e.onThingLevelLeaveSceneOperations(t)}),B.LevelSceneOperations)},e.prototype.onBaseObjectLevelSceneOperations=function(e){},e.prototype.onCampusLevelSetBackground=function(e){this.app.level.options.autoChangeBackground&&(this._campusSkyBox?(this.app.skyBox=this._campusSkyBox,this.setCampusSkyBoxColorScaleFactor([1,1,1])):this._campusBackground&&(this.app.background=this._campusBackground))},e.prototype.onCampusLevelSetEffect=function(e){},e.prototype.onCampusLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor&&(t.style.outlineColor=null),t.visible=!0,t.ground&&(t.ground.visible=!0);for(var i=t.children,r=0;r<i.length;r++)i[r].visible=!0;var n=t.buildings;for(r=0;r<n.length;r++){var o=n[r];o.visible=!0,o.children.forEach((function(e){e.visible=!1}));var s=o.floors,a=o.facades;o.hasFacades()?o.structShow?(a.visible=!0,s.visible=!0):(a.visible=!0,s.visible=!1,o.showAllRoofs(!1)):(s.visible=!0,o.showAllRoofs(!0)),t.app.level.options.autoHideFloorObjects&&s.forEach((function(e){if(!e.showObjectsInParentLevels){o.hasFacades()&&!o.structShow?e.children.forEach((function(e){e.visible=!1})):e.children.forEach((function(e){e.isTextRegion||e.isRoom||e.isDoor||e.isWindow||e.isCombinedObject||(e.visible=!1)}));if(!o.hasFacades()||o.structShow){var t=e.misc;t&&(t.visible=!0,t.node.traverse((function(t){t!=e.misc.node&&(!function(t){for(;t&&t!=e.misc.node;){if(t.isDoorOrWin)return!0;t=t.parent}return!1}(t)?t.visible=!1:t.visible=!0)})))}}}))}},e.prototype.onCampusLevelPickedResultFunc=function(e){function t(e){return"Outdoors"!=e.type&&!!function(e){var t=e.app.level.current;if(!t)return!0;if(e.isWebView)return!0;if(e.isMarker)return!0;if(e.parent==t){if(e.isGround)return!0;if(e.isBuilding)return e.onReplaceObejcts||(e.onReplaceObejcts=function(t,i){if("outlineColor"!==t)return[];var r=[];if(e.hasFacades())for(var n=e.facades,o=0,s=n.length;o<s;o++){var a=n[o];a.visible&&r.push(a)}return r.length<1&&function e(t,i){if(function(e){return!!(e&&e.isCombinedObject&&e.userData)&&("CombineFloorParent"===e.userData.type||"CombineWallParent"===e.userData.type||"CombineRoofParent"===e.userData.type||"CombineCeilingParent"===e.userData.type||void 0)}(t))i.push(t);else for(var r=0,n=t._children.length;r<n;r++)e(t._children[r],i)}(e,r),r}),!0;if(e.isThing)return!0}return!!e.isChildOf(t.ground)}(e)}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t(n))return n}}},e.prototype.onCampusLevelFly=function(e){var t,i,r=e.object,n=e.previous;n&&!n.isCampus&&n.isChildOf(r)||this.clearBackupInfo("camera","Campus");var o=r.sceneJSONData.camInfo;o&&(t=o.eye.concat(),i=o.target.concat(),t=r.selfToWorld(t),i=r.selfToWorld(i));var s=e.position||this.getBackupInfoValue("camera","Campus","position")||t,a=e.target||this.getBackupInfoValue("camera","Campus","target")||i||r,l=0;Et.isArray(s)&&Et.isArray(a)||(l=e.radius||Math.min(r.boundingBox.radius,300)),this.app.camera.flyTo(this.buildFlyParams({position:s,target:a,radius:l},e))},e.prototype.onCampusLevelLeaveSceneOperations=function(e){var t=e.current;if(t){var i=e.object;if(t.isChildOf(i)){if(t.isCampus);else if(i.parents.has(t));else if(!i.things.has(t)){i.ground&&(i.ground.visible=!1);for(var r=0;r<i.children.length;r++){var n=i.children[r];n!=e.current&&(n.visible=!1)}if(t.isThing){var o=i.ground;o&&(o.visible=!1)}}e.skipBackupCameraInfo||this.updatebackupInfo("camera","Campus"),this.updatebackupInfo("lighting","Campus"),this.updatebackupInfo("postEffect","Campus")}}},e.prototype.onFacadeLevelSetBackground=function(e){},e.prototype.onFacadeLevelSetEffect=function(e){},e.prototype.onFacadeLevelSceneOperations=function(e){var t=e.object;t.visible=!0,t.children.forEach((function(e){e.visible=!0}))},e.prototype.onFacadeLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;return!t||(t==e||!!e.isChildOf(t))}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t(n))return n}}},e.prototype.onFacadeLevelFly=function(e){var t=e.object;this.app.camera.flyTo(this.buildFlyParams({target:t},e))},e.prototype.onFacadeLevelLeaveSceneOperations=function(e){},e.prototype.onBuildingLevelSetBackground=function(e){this.app.level.options.autoChangeBackground&&(this.app.background=null,this.app.skyBox="White",this.setCampusSkyBoxColorScaleFactor([.5,.5,.5]))},e.prototype.onBuildingLevelSetEffect=function(e){},e.prototype.onBuildingLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor&&(t.style.outlineColor=null),t.visible=!0,t.children.forEach((function(e){e.visible=!0})),t.parents.query(".Campus")[0].buildings.not(t).visible=!1,t.facades.visible=!1;var i=t.floors;i.visible=!0;for(var r=0;r<i.length;r++){var n=i[r];if(t.app.level.options.autoHideFloorObjects){t.hasFacades()?n.children.forEach((function(e){e.visible=!0})):n.children.forEach((function(e){e.isRoom||e.isDoor||e.isWindow||(e.visible=!0)}));var o=n.misc;o&&o.node.traverse((function(e){e.ensureVisible(!0,!0)}))}n.showAllRoofs(!1),n.bake(null)}},e.prototype.onBuildingLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;if(!t)return!0;if(t==e)return!0;if(e.isWebView)return!0;if(e.isMarker)return!0;if(e.parent==t){if(e.isThing)return!0;if(e.isFloor&&"Outdoors"!=e.type)return!0}return!1}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t(n))return n}}},e.prototype.onBuildingLevelFly=function(e){var t=e.object,i=t.floors,r=new THREE.Box3;i.forEach((function(e){var t=e.wall;t&&r._setFromObject(t.node,null,null,!1)}));var n=Ut._processBox(r,t);this.app.camera.flyTo(this.buildFlyParams({target:t,boundingBox:n,radius:n.radius},e))},e.prototype.onBuildingLevelLeaveSceneOperations=function(e){var t=e.object;t.style.outlineColor&&(t.style.outlineColor=null),this.updatebackupInfo("lighting","Building"),this.updatebackupInfo("postEffect","Building")},e.prototype.onFloorLevelSetBackground=function(e){this.app.level.options.autoChangeBackground&&(this.app.skyBox="White",this.setCampusSkyBoxColorScaleFactor([.25,.25,.25]))},e.prototype.onFloorLevelSetEffect=function(e){},e.prototype.onFloorLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor&&(t.style.outlineColor=null),t.building.floors.not(t).visible=!1,t.visible||(t.visible=!0,t.showAllRoofs(!1)),this.app.level.options.autoBakeFloor&&t.bake()},e.prototype.onFloorLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;if(!t)return!0;if(t==e)return!0;if(e.isWebView)return!0;if(e.isMarker)return!0;if(e.parent==t){if(e.isRoom)return!0;if(e.isThing)return!0}return!1}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t(n))return n}}},e.prototype.onFloorLevelFly=function(e){var t=e.object,i=e.previous;if(i.isBuilding||i.isFloor)this.app.camera.flyTo(this.buildFlyParams({target:t},e)),this.clearBackupInfo("camera","Floor");else{var r=this.getBackupInfoValue("camera","Floor","position"),n=this.getBackupInfoValue("camera","Floor","target");this.app.camera.flyTo(this.buildFlyParams({position:r,target:n},e))}},e.prototype.onFloorLevelLeaveSceneOperations=function(e){var t=e.object;t.style.outlineColor&&(t.style.outlineColor=null),this.updatebackupInfo("camera","Floor"),this.updatebackupInfo("lighting","Building"),this.updatebackupInfo("postEffect","Building")},e.prototype.onRoomLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor&&(t.style.outlineColor=null);for(var i=t.brothers.query(".Room"),r=0;r<i.length;r++){i[r].things.style.opacity=.25}},e.prototype.onRoomLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;if(!t)return!0;if(e.isWebView)return!0;if(e.isMarker)return!0;if(e.isRoom&&e!=t)return!0;if(e.isChildOf(t)){if(e.parent==t)return!0}else if(e.isThing&&e.app.level.current.things.has(e))return!0;return!1}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.app.level.current,r=e.parents,n=0;n<r.length;n++){var o=r[n];if(o==i)break;if(t(o))return o}}},e.prototype.onRoomLevelFly=function(e){var t=e.object;if(e.previous.isFloor)this.app.camera.flyTo(this.buildFlyParams({target:t},e));else{var i=this.getBackupInfoValue("camera","Room","position"),r=this.getBackupInfoValue("camera","Room","target");this.app.camera.flyTo(this.buildFlyParams({position:i,target:r},e))}},e.prototype.onRoomLevelLeaveSceneOperations=function(e){var t=e.object;if(t.style.outlineColor&&(t.style.outlineColor=null),!e.lastObject.isChildOf(t))for(var i=t.brothers.query(".Room"),r=0;r<i.length;r++){i[r].things.style.opacity=null}this.updatebackupInfo("camera","Room")},e.prototype.onThingLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor&&(t.style.outlineColor=null),t.brothers.query(".Thing").style.opacity=.25},e.prototype.onThingLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;return!t||(!!e.isChildOf(t)||(!!e.isWebView||(!!e.isMarker||!(!e.isThing||!e.isBrotherOf(t)))))}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t(n))return n}}},e.prototype.onThingLevelFly=function(e){var t=e.object,i=Et.parseValue(e.keepDirection,!0);this.app.camera.flyTo(this.buildFlyParams({target:t,keepDirection:i,centerPos:t.boundingBox.center},e))},e.prototype.onThingLevelLeaveSceneOperations=function(e){var t=e.object;t.style.outlineColor&&(t.style.outlineColor=null),t.brothers.query(".Thing").style.opacity=null},e.prototype.init=function(){this.initAppEvents(),this.registerSceneLevelEvents()},e}(),ah=function(){function e(t){n(this,e),this.app=t,this._spriteMaterials={},this._meshMaterials={}}return e.prototype.getMaterial=function(e){var t,i=(e=e||{}).url,r=Et.parseValue(e.useSpriteMaterial,!0);if(i){r?(this._spriteMaterials[i]||(this._spriteMaterials[i]=new THREE.SpriteMaterial({color:16777215,transparent:!0})),t=this._spriteMaterials[i]):(this._meshMaterials[i]||(this._meshMaterials[i]=new THREE.MeshBasicMaterial({transparent:!0,side:THREE.DoubleSide,depthWrite:!1})),t=this._meshMaterials[i]),t.refCount=t.refCount||1,e.skipRefCount||t.refCount++;var n=e.loadComplete,o=e.loadTextureComplete,s=!t.map||!t.map.image;if(s){var a=this.app.resourceManager.textureLoader;t.map=a.load(i,(function(e){e.refCount++,t.map=e,t.needsUpdate=!0,t.visible=!0,o&&o({material:t}),n&&n({material:t})}),(function(){}),(function(e){THING.Utils.error('[Sprite] load "'+i+'" failed')}),!0),t.visible=!1}else n&&n({material:t})}else t=r?new THREE.SpriteMaterial({color:16777215,transparent:!0}):new THREE.MeshBasicMaterial({transparent:!0,side:THREE.DoubleSide,depthWrite:!1}),n&&n({material:t});return{material:t,needLoadTexture:s}},e.prototype.unloadMaterial=function(e){return!(!e||!this.app.resourceManager.disposeMaterial(e))},e.prototype.unloadMaterials=function(e,t){var i=t[e];this.unloadMaterial(i)&&delete t[e]},e.prototype.unload=function(e){this.unloadMaterials(e,this._spriteMaterials),this.unloadMaterials(e,this._meshMaterials)},e.prototype.onUpdate=function(e){},e}(),lh=function(){function e(t,i){n(this,e),this.app=t,this.modelResource=t.modelResource,this.refCount=1,this.URL=i,this._boundingBox=null,this._loadingBox=null,this._skinnedMeshAnimations=[],this.node=null,this.animations=null,this.geometry=null,this.materials=null}return e.prototype._setupBoundingBox=function(){var e=(new THREE.Box3)._setFromObject(this.node),t=new THREE.Vector3;e.getCenter(t);var i=new THREE.Vector3;e.getSize(i),this._boundingBox={},this._boundingBox.center=t.toArray(),this._boundingBox.size=i.toArray(),this._boundingBox.radius=i.length()},e.prototype.load=function(e){var t=this,i=e.node,r=e.animations,n=e.geometry,o=e.materials;if(n)this.animations=n.animations,this.geometry=n,this.materials=o,this._skinnedMeshAnimations=[{node:i,meshes:i.getSkinnedMeshes()}];else if(i){var s=this.node!=i;this.node=i;var a=e.models;a?(this.models=a,this._skinnedMeshAnimations=[],this.models.forEach((function(e){t._skinnedMeshAnimations.push({node:e.node,meshes:e.node.getSkinnedMeshes()})}))):(r?this.animations=r:(s||null===r)&&(this.animations=null),this._skinnedMeshAnimations=[{node:i,meshes:i.getSkinnedMeshes()}])}this._setupBoundingBox()},e.prototype.get=function(){return this.refCount++,this},e.prototype.unload=function(){return(0===this.refCount||(this.refCount--,!this.refCount))&&(!this.modelResource.residentMode&&(this.app.resourceManager.unload(this.node),this.app.resourceManager.unload(this._loadingBox),this.node=null,this.animations=null,this.geometry=null,this.materials=null,!0))},e.prototype._cloneNode=function(){var e=this;if(this.node){var t=this.node.clone(),i=[];return t.traverse((function(e){var t=e.geometry;t&&(t.refCount=t.refCount||1,t.refCount++),e.isSkinnedMesh&&i.push(e)})),this._skinnedMeshAnimations.forEach((function(r){for(var n=r.meshes,o=0;o<n.length;o++){var s=n[o],a=n[o].skeleton,l=t.getBones(e.node,n[o].skeleton),u=i[o],c=new THREE.Skeleton(l,a.boneInverses);u.bind(c,s.bindMatrix)}i.splice(0,n.length)})),t}if(this.geometry){var r=new THREE.SkinnedMesh(this.geometry,this.materials);return r.scale.set(1,1,1),r}},e.prototype.cloneNode=function(){var e=this._cloneNode(),t=function(e){e.refCount?e.refCount++:e.refCount=1};return e.traverseMaterials((function(e){for(var i in t(e),e){var r=e[i];r&&r.isTexture&&t(r)}})),e},o(e,[{key:"boundingBox",get:function(){return this._boundingBox||this._setupBoundingBox(),this._boundingBox}},{key:"loadingBox",get:function(){return this._loadingBox},set:function(e){this._loadingBox=e}}]),e}(),uh=function(){function e(t){n(this,e),this.app=t,this.isResidentMode=!1,this.models={},this.loadingModels={},this.waitModels=[]}return e.prototype.onBackgroundProgress=function(e){},e.prototype.get=function(e){var t=this.models[e];return t?t.get():null},e.prototype.set=function(e,t,i){var r=this.models[e];return r?r.unload():(r=new lh(this.app,e),this.models[e]=r),t&&i&&r.load({node:t,animations:i}),r},e.prototype.getBoundingBox=function(e){var t=this.models[e];return t?t.boundingBox:null},e.prototype.unload=function(e){if(void 0===e){for(var e in this.models)this.models[e].unload();return this.clear(),!0}if(Et.isString(e)){var t=this.models[e];if(t&&t.unload())return delete this.models[e],!0}return!1},e.prototype.clear=function(e){Et.isNull(e)?this.models={}:delete this.models[e]},e.prototype._download=function(e,t,i,r,n){var o=this.get(e);if(o)delete this.loadingModels[e],i&&i(o);else{var s=this;new thingjs.GLTFLoader(this.app.loadingManager).loadFromURL({url:e,useStaticImage:THING.useStaticImage,jsonCallback:function(e){t&&t(e)},modelCallback:function(t){var r=t.url,n=s.get(r);n||(n=s.set(r)).load(t),delete s.loadingModels[e],i&&(i(n)||s.unload(e))},errorCallback:function(t){if(delete s.loadingModels[e],t&&t.target&&201===t.target.status){var i=void 0;try{i=JSON.parse(t.target.response)}catch(e){THING.Utils.error("Error!")}return THING.Utils.error("[have no right] name: "+i.message+"\nurl: "+e),!0}if(n)return n(t)},progressCallback:r})}},e.prototype.download=function(e,t,i,r,n){this.loadingModels[e]?this.waitModels.push({url:e,jsonCallback:t,modelCallback:i,progressCallback:r,errorCallback:n}):(this.loadingModels[e]={},this._download(e,t,i,r,n))},e.prototype.preload=function(e,t){var i=(t=t||{}).complete;if(Et.isArray(e))for(var r=0,n=e.length,o=0;o<n;o++)this.download(e[o],(function(){}),(function(e){++r==n&&i&&i()}),(function(){}),(function(){++r==n&&i&&i()}));else Et.isString(e)&&this.download(e,(function(){}),(function(e){i&&i()}),(function(){}),(function(){i&&i()}))},e.prototype.needWait=function(e){var t=e.url;return!!this.loadingModels[t]},e.prototype.update=function(){for(var e=0;e<this.waitModels.length;e++){var t=this.waitModels[e];this.needWait(t)||(this._download(t.url,t.jsonCallback,t.modelCallback,t.progressCallback,t.errorCallback),this.waitModels.splice(e--,1))}},e.prototype.onUpdate=function(e){this.update(e)},o(e,[{key:"residentMode",set:function(e){if(this.isResidentMode=e,!e){var t=[];for(var i in this.models){var r=this.models[i];if(0===r.refCount){var n=r.URL;r.unload()&&t.push(n)}}for(var o=0;o<t.length;o++){n=t[o];delete this.models[n]}}},get:function(){return this.isResidentMode}}]),e}(),ch=function(){function e(t){n(this,e),this.app=t,this.particles={}}return e.prototype.get=function(e){return this.particles[e]},e.prototype.set=function(e,t){this.particles[e]=t},e.prototype.download=function(e,t){var i=e.appendURL("index.json"),r=this;new THREE.FileLoader(this.app.loadingManager).load(i,(function(i){var n=JSON.parse(i);r.set(e,n),t&&t(n)}),(function(){}),(function(){}))},e}(),hh=function(){function e(t){n(this,e),this.app=t,this.camera=t.camera,this.updateTime=0,this.lastAdjustCameraNear=0}return e.prototype._getMinDistanceForAdjustCameraNear=function(e,t,i,r){var n=Et.parseVector3(i),o=Et.parseVector3(this.camera.position),s=Math.min(r,n.distanceTo(o));if(s>e){var a=this.app.picker.intersectResult(t[0],t[1],null,{ignoreFrameCheck:!1});if(a&&a.picked)(n=a.getPickedPosition({skipOtherPick:!0}))&&(n=Et.parseVector3(n),s=Math.min(s,o.distanceTo(n)))}return s/e},e.prototype._getAdjustCameraNear=function(e){var t=this.camera.distance;if(t>10){var i=this.camera.worldToScreen(this.camera.target),r=this.camera.screenToWorld(i[0],i[1]);if(r)return this.updateTime>=.5&&(this.updateTime=0,this.lastAdjustCameraNear=this._getMinDistanceForAdjustCameraNear(e,i,r,t)),this.lastAdjustCameraNear}return this.camera.near},e.prototype.processAdjustCameraNear=function(){var e=Math.max(.1,this._getAdjustCameraNear(120));this.app.renderCamera.setNear(e)},e.prototype.onUpdate=function(){this.updateTime+=this.app._deltaTime;var e=this.camera._targetObject;e&&(e.position=this.camera.target)},e.prototype.onEnter=function(){var e=this;this.app.on("cameraChange",(function(t){e.camera.autoAdjustNear&&!e.app.renderCamera.isLerping&&e.processAdjustCameraNear(),e.app.needUpdate=!0}),"__cameraNearFixed__");var t=!1;this.app.on("cameraChangeMouseMove",(function(i){e.app.camera.inputEnabled&&!e.app.isPauseEvent(F.Pick,null,B.LevelPickOperation)&&(t=!0,e.app.pauseEvent(F.Pick,null,B.LevelPickOperation))}),"__disable_outline__"),this.app.on("cameraChangeEnd",(function(i){t&&(t=!1,e.app.resumeEvent(F.Pick,null,B.LevelPickOperation))}),"__disable_outline__")},e.prototype.onLeave=function(){this.app.off("cameraChange","__cameraNearFixed__"),this.app.off("cameraChangeMouseMove","__disable_outline__"),this.app.off("cameraChangeEnd","__disable_outline__")},e}(),ph=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"translate",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n(this,e),t&&(this._object=t,this._axis=null,this._disableAxis=[],this.init(t.app,i,r),this.control.attach(this._object.node),this.app.scene.add(this.control),this.control.setPickable(!1))}return e.prototype.init=function(e,t,i){this.app=e,this.control=new THREE.TransformControls(this.app.renderCamera,this.app.mainDomElement),this.control.traverse((function(e){e.userData.skipOutline=!0,e.userData.useVisibleOnly=!0}));var r=this;this.control.addEventListener("change",(function(e){r.onGizmoChange(e)})),this.control.addEventListener("objectChange",(function(e){r.onGizmoObjectChange(e)})),this.control.addEventListener("mouseDown",(function(e){r.onGizmoMouseDown(e)})),this.control.addEventListener("mouseUp",(function(e){r.onGizmoMouseUp(e)})),this.control.getGizomNode=function(){return r.control.children[0]},this.control.getAxisNode=function(){return r.control.children[1]},this.mode="translate",Et.isString(t)?(this.mode=t,this.params=i||{}):this.params=t||{},this.app.on("cameraViewChange",(function(e){e.view==M.Orthographic?r.setAxis("XZ"):r.setAxis("XYZ")})),this.app.camera.viewMode==M.Orthographic&&this.setAxis("XZ")},e.prototype.onGizmoChange=function(e){},e.prototype.onGizmoObjectChange=function(e){this._object&&(this._object.dirty=!0);var t=this.params.change;t&&t.call(this,{object:this._object})},e.prototype.onGizmoMouseDown=function(e){this.app.camera.disable({rotate:!0});var t=this.params.changeStart;t&&t.call(this,{object:this._object})},e.prototype.onGizmoMouseUp=function(e){this.app.camera.resume({rotate:!0});var t=this.params.changeEnd;t&&t.call(this,{object:this._object})},e.prototype.onUpdate=function(e){if(this._object.static)return this.control.updateMatrixWorld(),!0},e.prototype.onRemove=function(){this.app.scene.remove(this.control),this.control.detach(),this.control.dispose()},e.prototype.onVisible=function(e){this.control.enabled&&(this.control.visible=e)},e.prototype.setAxis=function(e){if(this._axis=e,this._axis&&"XYZ"!=this._axis){var t=this,i=new THREE.Raycaster;this.control.userData.original_pointerHover=this.control.pointerHover,this.control.axis=e,this.control.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){i.setFromCamera(e,this.camera);var r=i.intersectObjects(this.getGizomNode().picker[this.mode].children,!0)[0]||!1;r?-1!=t._axis.search(r.object.name)&&(this.axis=r.object.name):this.axis=""}}}else this.control.userData.original_pointerHover&&(this.control.pointerHover=this.control.userData.original_pointerHover,delete this.control.userData.original_pointerHover)},e.prototype.detach=function(){this.control.detach()},e.prototype.attach=function(e){this.control.attach(e)},e.prototype.updateDisableAxis=function(e,t,i){for(var r=-1,n=0;n<this._disableAxis.length;n++)if(this._disableAxis[n].name==e){r=n;break}t?-1!==r&&this._disableAxis.splice(r,1):-1===r&&this._disableAxis.push({name:e,matchAll:i})},e.prototype.enableAxis=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e){this.updateDisableAxis(e,t,i);var r=this.control;if(this._disableAxis.length){var n=this,o=function(e){if(!e)return!0;for(var t=0;t<n._disableAxis.length;t++){var i=n._disableAxis[t];if(i.matchAll){if(e==i.name)return!0}else if(-1!==e.indexOf(i.name))return!0}return!1},s=function(e){e.traverse((function(e){for(var t=0;t<n._disableAxis.length;t++){var i=n._disableAxis[t];e.name==i.name&&(e.visible=!1)}}))};Et.setValue(r,"pointerDown",(function(e){var t=this.getGizomNode().axis;o(t)||Et.getBackupValue(r,"pointerDown").call(this,e)})),Et.setValue(r,"pointerMove",(function(e){var t=this.getGizomNode().axis;o(t)||Et.getBackupValue(r,"pointerMove").call(this,e)})),Et.setValue(r,"pointerUp",(function(e){var t=this.getGizomNode().axis;o(t)||Et.getBackupValue(r,"pointerUp").call(this,e)})),Et.setValue(r,"updateMatrixWorld",(function(){Et.getBackupValue(r,"updateMatrixWorld").call(this);var e=this.getGizomNode().gizmo,t=this.getGizomNode().mode;s(e[t])}))}else Et.revertValue(r,"pointerDown"),Et.revertValue(r,"pointerMove"),Et.revertValue(r,"pointerUp"),Et.revertValue(r,"updateMatrixWorld")}},e.prototype.setSize=function(e){THING.Utils.warn("[AxisTransformControl] Please use '.size' to replace 'setSize()'"),this.size=e},o(e,[{key:"object",get:function(){return this.control.object}},{key:"node",get:function(){return this.control}},{key:"mode",set:function(e){if(e){if("translate"!=e&&"rotate"!=e&&"scale"!=e)return void THING.Utils.error('[AxisTransformControl] mode is invalid, must be "translate/rotate/scale"');this.control.setMode(e)}},get:function(){return this.control.getMode()}},{key:"space",set:function(e){if(e){if("world"!=e&&"local"!=e)return void THING.Utils.error('[AxisTransformControl] space is invalid, must be "world/local"');this.control.setSpace(e)}},get:function(){return this.control.space}},{key:"size",set:function(e){this.control.setSize(e)},get:function(){return this.control.size}},{key:"visible",set:function(e){this.control.visible=e,this.control.enabled=e},get:function(){return this.control.visible}}]),e}(),dh=function(){function e(t){n(this,e),this.state=t,this.app=t.app,this.control=t.control,this.root=new THREE.Group,this.root.userData.childUseWorldAnglesAlways=!0,this.root.name="EditObjectGroup",this.lastRootPosition=null,this.lastRootScale=null,this.lastRootRotation=null}return e.prototype.hasChanged=function(){var e=this.root.position,t=this.root.scale,i=this.root.rotation;return!(this.lastRootPosition.equals(e)&&this.lastRootScale.equals(t)&&this.lastRootRotation.equals(i))},e.prototype.recordTranslation=function(){this.state.execute({type:"SetNodeTranslation",node:this.root,position:this.lastRootPosition,scale:this.lastRootScale,rotation:this.lastRootRotation}),this.synTranslation()},e.prototype.notify=function(e){for(var t=this.root.children,i=0;i<t.length;i++){var r=t[i].userData,n=this.app.objectManager.get(r.id);if(n){var o=n.userData._editCallbacks;o&&o[e].call(n);var s=n.userData.selectObjectCallback;s&&s.call(n)}}},e.prototype._pushSubNodeAttach=function(e,t,i,r,n){var o=this.app.objectManager.getBaseObject(t);e.push({type:"AttachNode",node:o.node,nodeParent:o.node.userData.nodeParent})},e.prototype.recordSubNodeAttach=function(e,t,i,r){var n=[];this._pushSubNodeAttach(n,e,t,i,r),this.state.execute(n),this.synTranslation()},e.prototype._pushSubNodeOnlyAttach=function(e,t,i,r,n,o,s,a,l){for(var u=0;u<i.length;u++){var c=i[u];this.hasSelected(c)&&e.push({type:"AttachNode",node:i[u].node,nodeParent:r[u]})}},e.prototype.recordSubNodeOnlyAttach=function(e,t,i,r,n,o,s,a){var l=[];this._pushSubNodeOnlyAttach(l,e,t,i,r,n,o,s,a),this.state.execute(l),this.synTranslation()},e.prototype._pushNodeAttach=function(e,t,i,r,n){e.push({type:"AttachNode",node:t.node,nodeParent:i})},e.prototype.recordNodeAttach=function(e,t,i,r){var n=[];this._pushNodeAttach(n,e,t,i,r),this.state.execute(n),this.synTranslation()},e.prototype._pushNodeOnlyAttach=function(e,t,i,r,n,o,s,a,l){e.push({type:"AttachNode",node:t.node,nodeParent:i});for(var u=0;u<r.length;u++){r[u]!=t&&e.push({type:"AttachNode",node:r[u].node,nodeParent:n[u]})}},e.prototype.recordNodeOnlyAttach=function(e,t,i,r,n,o,s,a){var l=[];this._pushNodeOnlyAttach(l,e,t,i,r,n,o,s,a),this.state.execute(l),this.synTranslation()},e.prototype._pushNodesAttach=function(e,t,i,r,n){for(var o=0;o<t.length;o++){var s=t[o],a=i[o];e.push({type:"AttachNode",node:s.node,nodeParent:a})}},e.prototype.recordNodesAttach=function(e,t,i,r){var n=[];this._pushNodesAttach(n,e,t,i,r),this.state.execute(n)},e.prototype._pushSubNodesAttach=function(e,t,i,r,n){},e.prototype.recordSubNodesAttach=function(e,t,i,r){var n=[];this._pushSubNodesAttach(n,e,t,i,r),this.state.execute(n)},e.prototype.synTranslation=function(){this.lastRootPosition=this.root.position.clone(),this.lastRootScale=this.root.scale.clone(),this.lastRootRotation=this.root.rotation.clone();for(var e=0;e<this.root.children.length;e++){var t=this.root.children[e].userData.id;if(t)this.app.objectManager.get(t).dirty=!0}},e.prototype.updateRoot=function(){this.updateControl(),this.updateRootVisible(),this.updateRootPosition(),this.updateSelections(),this.synTranslation(),this.app.needUpdate=!0},e.prototype._getNodeCenterPosition=function(e){var t=new THREE.Vector3;if(this.state._isSubNode(e))e.getWorldPosition(t);else{var i=this.app.objectManager.get(e.userData.id);if(i){var r=i.position,n=i.centerPos;n?(t.set(n[0],0,n[1]),i.node.updateMatrixWorld(),t.applyMatrix4(i.node.matrixWorld),t.y=r[1]):t=Et.parseVector3(r)}else e.getWorldPosition(t)}return t},e.prototype.clearSelections=function(){this.state._selectionObjects.clear()},e.prototype.addSelection=function(e){this.state._selectionObjects.add(e)},e.prototype.hasSelected=function(e){return this.state._selectionObjects.has(e)},e.prototype.updateSelections=function(){this.state.objects;this.clearSelections();for(var e=0;e<this.root.children.length;e++){var t=this.root.children[e].userData,i=t.id;if(i){var r=this.app.objectManager.get(i);t.subNode||this.addSelection(r)}}},e.prototype.updateControl=function(){this.control.object||this.root.children.length&&(this.control.attach(this.root),this.app.scene.add(this.control.node),this.synTranslation())},e.prototype.updateRootVisible=function(){this.root.children.length?this.root.visible=!0:this.root.visible=!1,this.control.visible=this.root.visible},e.prototype.updateRootPosition=function(){var e=this.root.children;if(e.length){for(var t=new THREE.Vector3,i=0;i<e.length;i++){var r=e[i],n=this._getNodeCenterPosition(r);t.add(n)}t.divideScalar(e.length);var o=this.root.parent.worldToLocal(t),s=this.root.detachChildren(this.app.scene);this.root.position.copy(o),this.root.attachChildren(s,this.app.scene)}},e.prototype.getObjectInfo=function(e,t){for(var i=new Set,r=this.root.children,n=0;n<r.length;n++){var o=r[n],s=this.app.objectManager.get(o.userData.id);if(!i.has(s)&&(i.add(s),e&&e.push(s),t)){var a=s.node.userData.nodeParent;t.push(a)}}},e.prototype.getSubNodeInfo=function(e,t){var i=this;this.root.traverse((function(r){var n=i.app.objectManager.get(r.userData.id);if(n&&(-1!==n.getSubNodeIndex(r)&&(e&&e.push(r),t))){var o=r.userData.nodeParent;t.push(o)}}))},e.prototype.recordNodeParent=function(e){e.isBaseObject&&(e=e.node);var t=e.parent;t!=this.root&&(e.userData.nodeParent=t)},e.prototype._pushAddObjects=function(e,t){if(t&&t.length){for(var i=[],r=0;r<t.length;r++){var n=t[r];this.hasSelected(n)||i.push(n)}if(i.length)for(r=0;r<i.length;r++){n=i[r];this.recordNodeParent(n),e.push({type:"AttachNode",node:n.node,nodeParent:this.root})}}},e.prototype._dispatchBreakableEvent=function(e,t){return t.continueFlag=!0,this.app.trigger(e,t),t.continueFlag},e.prototype.addObjects=function(e){var t=[];this._pushAddObjects(t,e),this.state.execute(t),this.updateRoot()},e.prototype._pushAddSubNodes=function(e,t){if(t.length)for(var i=0;i<t.length;i++){var r=t[i];this.state._isSubNode(r)&&(r.isChildOf(this.root)||this.recordNodeParent(r))}},e.prototype.addSubNodes=function(e){var t=[];this._pushAddSubNodes(t,e),this.state.execute(t),this.updateRoot()},e.prototype.addSubNode=function(e){return!!this.state._isSubNode(e)&&(!!this.app.objectManager.getBaseObject(e)&&(this.recordNodeParent(e),this.recordSubNodeAttach(e,this.root,this.state.selectOutlineColor,null),this.updateRoot(),!0))},e.prototype.addSubNodeOnly=function(e){if(!e)return!1;if(!e.userData.subNode)return!1;if(!this.app.objectManager.getBaseObject(e))return!1;var t=[],i=[];this.getObjectInfo(t,i);var r=[],n=[];this.getSubNodeInfo(r,n);for(var o=0;o<r.length;o++)if(r[o]==e){r.splice(o,1);break}return this.recordNodeParent(e),this.recordSubNodeOnlyAttach(e,t,i,r,n,this.root,this.state.selectOutlineColor,null),this.updateRoot(),!0},e.prototype.add=function(e,t){t&&this.addSubNode(t.intersect.node)||(this.recordNodeParent(e),this.recordNodeAttach(e,this.root,this.state.selectOutlineColor,null),this.updateRoot())},e.prototype.addOnly=function(e,t){if(!(t&&this.addSubNodeOnly(t.intersect.node)||1==this.root.children.length&&this.has(e))){var i=[],r=[];this.getObjectInfo(i,r);var n=[],o=[];this.getSubNodeInfo(n,o),this.recordNodeParent(e),this.recordNodeOnlyAttach(e,this.root,i,r,n,o,this.state.selectOutlineColor,null),this.updateRoot()}},e.prototype.remove=function(e){if(this.state._isSubNode(e))for(var t=this.root.children,i=0;i<t.length;i++){if((n=t[i])==e){var r=n.userData.nodeParent;this.recordSubNodeAttach(e,r,null,this.state.selectOutlineColor);break}}else for(t=this.root.children,i=0;i<t.length;i++){var n=t[i],o=this.app.objectManager.get(n.userData.id);if(e==o){this.app.trigger("unselectEditableObject",{object:o});r=n.userData.nodeParent;this.recordNodeAttach(e,r,null,this.state.selectOutlineColor);break}}this.updateRoot()},e.prototype.removeAll=function(){if(this.root.children.length){var e=[],t=[];this.getObjectInfo(e,t);var i=[],r=[];this.getSubNodeInfo(i,r);for(var n=0;n<e.length;n++){var o=e[n];this.app.trigger("unselectEditableObject",{object:o})}this.state.canRespondFromCommandManager=!1,this.recordNodesAttach(e,t,null,this.state.selectOutlineColor),this.recordSubNodesAttach(i,r,null,this.state.selectOutlineColor),this.state.canRespondFromCommandManager=!0,this.updateRoot()}},e.prototype.has=function(e){var t=this.root.children;if(this.state._isSubNode(e))for(var i=0;i<t.length;i++){if((r=t[i]).userData.subNode&&r==e)return!0}else for(i=0;i<t.length;i++){var r;if(!(r=t[i]).userData.subNode)if(e==this.app.objectManager.get(r.userData.id))return!0}return!1},e.prototype.attach=function(){this.root.attachToParent(this.app.scene,this.app.scene)},e.prototype.detach=function(){this.removeAll(),this.control.detach(),this.app.scene.remove(this.control.node),this.root.detachFromParent(this.app.scene),this.updateRoot()},e.prototype.clearScene=function(){var e=[];this.state._pushDeleteSubNodes(e,this.state.subNodes),this.state._pushDeleteObjects(e,this.state.objects),this.state.execute(e,!0),this.updateRoot()},e.prototype.toJSON=function(){for(var e=Array.from(this.state._selectionObjects),t=0;t<e.length;t++)this.remove(e[t]);var i=this.state.subNodes;for(t=0;t<i.length;t++)this.remove(i[t]);var r=[],n=this.state.objects;for(t=0;t<n.length;t++){var o=n[t];r.push(o.toJSON())}for(t=0;t<i.length;t++)this.addSubNode(i[t]);for(t=0;t<e.length;t++)this.add(e[t]);return JSON.stringify(r)},e.prototype.pasteObjects=function(){THING.Utils.warn('[EditObjectState] we do not support ".pasteObjects()" anymore, please do not use it')},e.prototype.fromJSON=function(e){THING.Utils.warn('[EditObjectState] we do not support ".fromJSON()" anymore, please do not use it')},e}(),fh=function(){function e(t){n(this,e);var i=this;this.app=t,this.picker=t.picker,this.copyObjectsJSONData=[],this._selectionObjects=new Set,this.canRespondFromCommandManager=!1,this._enableDirectMode=!1,this._enableKeyMode=!1,this._enableAutoRemoveAllWhenClick=!0,this.app.on("push",(function(e){i.onPush(e)})),this.app.on("redo",(function(e){i.onRedo(e)})),this.app.on("undo",(function(e){i.onUndo(e)}));var r={changeEnd:function(e){i.group.hasChanged()&&(i.group.recordTranslation(),i.group.notify("modify"))}};this.control=new ph,this.control.init(t,"translate",r),this.selectOutlineColor="#0000FF",this.group=new dh(this)}return e.prototype.onPush=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},e.prototype.onRedo=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},e.prototype.onUndo=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},e.prototype.notify=function(e,t){var i=e.userData._editCallbacks;i&&i[t].call(e)},e.prototype.startDrag=function(e,t,i,r){if(e){r=r||.1,this.app.camera.disable({rotate:!0}),e.pickable=!1,e.catchEventAnyTime=!0,e.node.userData.skipPick=!0,e.position=app.camera.screenToWorld(t,i);var n=this;e.on("mousemove",(function(e){var t=n.app.picker.pickWorldPosition(e.clientX,e.clientY);t||(t=n.app.camera.screenToWorld(e.clientX,e.clientY)),t&&(t[1]+=r,this.position=t)}),"startDrag_mousemove"),e.on("mouseup",(function(e){this.pickable=!0,this.catchEventAnyTime=!1,delete this.node.userData.skipPick,n.group._dispatchBreakableEvent("selectEditableObject",{object:this})&&n.selectObject(this),this.off("mousemove",null,"startDrag_mousemove"),this.off("mouseup",null,"startDrag_mouseup"),n.app.camera.resume({rotate:!0}),n.notify(this,"dragEnd")}),"startDrag_mouseup")}},e.prototype.selectObject=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"translate",i=arguments[2];"translate"==t||"rotate"==t?(this.group.addOnly(e),i&&(e.userData.selectObjectCallback=i),this.setMode(t)):THING.Utils.error("The mode must be 'translate' or 'rotate'")},e.prototype.unselectObject=function(e){this.group.remove(e)},e.prototype.setMode=function(e){e&&(this.control.mode=e)},e.prototype.parseParams=function(e){var t=e.type;if("RouteLine"==t||"PolygonLine"==t){var i=e.points;if(!i){i=[[-5,0,-5],[0,0,-5],[0,0,0],[0,0,5],[5,0,5]],e.points=i,e.style=e.style||{};var r=e.style;if(r.color=Et.parseValue(r.color,5824222),e.image)void 0===e.scrollUV&&(e.scrollUV=!0)}}else if("Water"==t){i=[[-20,0,-20],[-20,0,20],[20,0,20],[20,0,-20]],e.points=i,e.normalMap0=Et.parseValue(e.normalMap0,"images/water/Water_1_M_Normal.jpg"),e.normalMap1=Et.parseValue(e.normalMap1,"images/water/Water_2_M_Normal.jpg")}else if("Region"==t){i=[[-20,0,-20],[-20,0,20],[20,0,20],[20,0,-20]],e.points=i,e.fontColor=Math.random(),e.fontSize=THING.Math.randomInt(9,32),e.fontText="Hello"}return Et.cloneObject(e)},e.prototype.addObjects=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];r instanceof Si?(r.internalUserData.editable=!0,t.push(r)):THING.Utils.error("The object is not BaseObject, so we can not add object to edit state")}this.group.addObjects(t)},e.prototype.createObject=function(e,t){(e=e||{}).internalUserData={editable:!0};var i=(e=this.parseParams(e)).complete;e.complete=function(){i&&i()};var r=this.app.create(e);return t&&(r.userData._editCallbacks=t),r},e.prototype._pushDeselectObject=function(e,t){t&&e.push({type:"AttachNode",node:t.node,nodeParent:t.node.userData.nodeParent})},e.prototype._pushDeleteObject=function(e,t){t&&this._pushDeselectObject(e,t)},e.prototype.deleteObject=function(e){this.notify(e,"remove");var t=[];this._pushDeleteObject(t,e),this.execute(t,!0),this.group.updateRoot()},e.prototype._pushDeleteObjects=function(e,t){for(var i=0;i<t.length;i++){var r=t[i];this._pushDeleteObject(e,r)}},e.prototype.deleteObjects=function(e){for(var t=0;t<e.length;t++)this.notify(e[t],"remove");var i=[];this._pushDeleteObjects(i,e),this.execute(i,!0),this.group.updateRoot()},e.prototype._isSubNode=function(e){return!!e&&(!e.isBaseObject&&!!e.userData.subNode)},e.prototype._isBreakByControlAxis=function(e){var t=e.intersect;return(!t||!this._isSubNode(t.node))&&!(!this.control.axis||!this.control.visible)},e.prototype._isCanPick=function(e){if(this._isBreakByControlAxis(e))return!1;var t=e.object;if(t){if(t==this.app.outdoors)return!1;if(!t.internalUserData.editable)return!1}return!0},e.prototype._getSortedSubNodes=function(e,t){for(var i=[],r=0;r<e.length;r++){var n=e[r],o=n.userData,s=this.app.objectManager.get(o.id),a=s.getSubNodeIndex(n);i.push({index:a,node:n,object:s})}return i.sort(t),i},e.prototype._pushInsertSubNode=function(e,t){},e.prototype.insertSubNode=function(){var e=this.subNodes;if(e.length){var t=[];this._pushInsertSubNode(t,e),this.execute(t,!0),this.group.updateRoot()}},e.prototype._pushDeleteSubNodes=function(e,t){},e.prototype.deleteSubNodes=function(e){var t=[];this._pushDeleteSubNodes(t,e),this.execute(t,!0),this.group.updateRoot()},e.prototype.deleteSelections=function(){var e=Array.from(this._selectionObjects);e.length&&this.deleteObjects(e);var t=this.subNodes;t.length&&this.deleteSubNodes(t)},e.prototype.deselectObjects=function(e){if(e)for(var t=0;t<e.length;t++)this.group.remove(e[t])},e.prototype.copyObjects=function(e){this.copyObjectsJSONData=[];for(var t=0;t<e.length;t++){var i=e[t],r=i.toJSON();r.localPosition=i.localPosition,r.localAngles=i.localAngles,r.scale=i.scale,this.copyObjectsJSONData.push(JSON.stringify(r))}},e.prototype.selectAll=function(){this.group.addObjects(this.objects)},e.prototype.clearScene=function(){this.group.clearScene()},e.prototype.toJSON=function(){this._enableDirectMode=!0;var e=this.group.toJSON();return this._enableDirectMode=!1,e},e.prototype.fromJSON=function(e){e&&this.group.fromJSON(e)},e.prototype.execute=function(e,t){if(this._enableDirectMode){var i=this.app.commandManager.create(e,t);return i?i.execute():null}return this.app.commandManager.execute(e,t)},e.prototype.processAreaPicking=function(e){var t=e.objects;if(t){for(var i=this.objects,r=[],n=0;n<i.length;n++){var o=i[n];t.has(o)||r.push(o)}this.deselectObjects(r),t.length&&(t[0]instanceof Si?this.group.addObjects(t):this.group.addSubNodes(t))}},e.prototype.onMouseDown=function(e){},e.prototype.onMouseUp=function(e){e.finishedAreaPicking&&this.processAreaPicking(e)},e.prototype.onMouseMove=function(e){e.areaPicking&&(this._enableDirectMode=!0,this.processAreaPicking(e),this._enableDirectMode=!1)},e.prototype.onClick=function(e){if(this.app.events.canClick(e)){var t=this.app.isKeyPressed(O.Ctrl),i=e.object;if(i&&this._isCanPick(e))if(t){var r=e.intersect.node;this.group.has(i)?this.group.remove(i):this.group.has(r)?this.group.remove(r):this.group._dispatchBreakableEvent("selectEditableObject",{object:i})&&this.group.add(i,e)}else this.group._dispatchBreakableEvent("selectEditableObject",{object:i})&&this.group.addOnly(i,e);else t||this.enableAutoRemoveAllWhenClick&&this.group.removeAll()}},e.prototype.onKeyDown=function(e){if(this._enableKeyMode)switch(event.keyCode){case O.Q:this.control.setSpace("local"===this.control.space?"world":"local");break;case O.W:this.control.mode="translate";break;case O.E:this.control.mode="rotate";break;case O.R:break;case O.EqualSign:case O.Add:this.control.size=this.control.size+.1;break;case O.Dash:case O.Subtract:this.control.size=Math.max(this.control.size-.1,.1);break;case O.Y:this.app.isKeyPressed(O.Ctrl)&&this.app.commandManager.redo();break;case O.Z:this.app.isKeyPressed(O.Ctrl)&&this.app.commandManager.undo();break;case O.C:this.app.isKeyPressed(O.Ctrl)&&this.copyObjects(Array.from(this._selectionObjects));break;case O.V:this.app.isKeyPressed(O.Ctrl)&&this.pasteObjects();break;case O.A:this.app.isKeyPressed(O.Ctrl)&&this.selectAll();break;case O.Delete:this.deleteSelections()}},e.prototype.onKeyUp=function(e){},e.prototype.onUpdate=function(e){},e.prototype.onEnter=function(e,t){if(t){this.canRespondFromCommandManager=!0;var i=t.objects;if(i)for(var r=0;r<i.length;r++)this.group.add(i[r]);this.group.attach(),this.control.mode="translate";var n=this;this.app.on("areaPickStart",(function(e){var t=n.candidateForSubNodes;t.length||(t=n.objects),n.app.picker.candidates=t}),"editObject_areaPickStart"),this.app.on("areaPickEnd",(function(e){n.app.picker.candidates=null}),"editObject_areaPickEnd"),this.app.modelResource.residentMode=!0}else THING.Utils.log("Gizmo state need params")},e.prototype.onLeave=function(e){this.group.detach(),this.canRespondFromCommandManager=!1,this.app.modelResource.residentMode=!1,this.app.off("areaPickStart",null,"editObject_areaPickStart"),this.app.off("areaPickEnd",null,"editObject_areaPickEnd")},o(e,[{key:"enableKeyMode",set:function(e){this._enableKeyMode=e},get:function(){return this._enableKeyMode}},{key:"areaPicking",set:function(e){this.picker.areaPicking=e,e||(this.picker.candidates=null)},get:function(){return this.picker.areaPicking}},{key:"enableAutoRemoveAllWhenClick",set:function(e){this._enableAutoRemoveAllWhenClick=e},get:function(){return this._enableAutoRemoveAllWhenClick}},{key:"objects",get:function(){var e=[];return this.app.objectManager.objects.forEach((function(t){t.internalUserData.editable&&e.push(t)})),e}},{key:"subNodes",get:function(){for(var e=[],t=this.group.root.children,i=0;i<t.length;i++){var r=t[i];r.userData.subNode&&e.push(r)}return e}},{key:"candidateForSubNodes",get:function(){for(var e=new Set,t=this.group.root.children,i=0;i<t.length;i++){var r=t[i].userData;if(r.subNode){var n=r.id;n&&e.add(this.app.objectManager.get(n))}}var o=[];return e.forEach((function(e){o=o.concat(e.subNodes)})),o}}]),e}(),mh=function(){function e(t){n(this,e),this.app=t}return e.prototype._getNavigationObject=function(e,t){if(e.getNavigation(t))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(n.getNavigation(t))return n}return null},e.prototype._tryGetRoomFromPosition=function(e,t){if(!t)return null;var i=e.isFloor?e:e.parents.query(".Floor")[0];return i?i.getRoomFromWorldPosition(t):null},e.prototype._getObjectRoot=function(e,t){function i(e,t){if(t==e)return e;if(t.isChildOf(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t==n)return n;if(t.isChildOf(n))return n}return null}var r=i(e,t),n=i(t,e);return r.isChildOf(n)?n:r},e.prototype._setupGraph=function(e,t){var i=this._getObjectRoot(e,t);if(!i)return null;for(var r=i;r;r=r.parent)if(Et.isFunction(r.setupGraph))return r.setupGraph();return null},e.prototype._buildPathes=function(e){for(var t=[],i=null,r=0;r<e.length;r++){var n=this.app.query("#"+e[r])[0];if(!n.isCampus&&!n.isFloor){var o=n.parent;if(i!=o)t.push({startObject:n,endObject:n}),i=o;else t[t.length-1].endObject=n}}return t},e.prototype.findPath=function(e){var t=(e=e||{}).error||function(){console.error.apply(console,arguments)},i=e.clipAreas,r=e.startObject||e.startRoom||e.start,n=e.endObject||e.endRoom||e.end;if(!r)return t({text:"Needs start object to find path in navigation"}),null;if(!n)return t({text:"Needs end object to find path in navigation",startObject:r}),null;var o=e.startPosition||r.position,s=e.endPosition||n.position;if(!o)return t({text:"Needs start position to find path in navigation",startObject:r,endObject:n}),null;if(!s)return t({text:"Needs end position to find path in navigation",startObject:r,endObject:n,startPosition:o}),null;var a=this._getNavigationObject(r,i),l=this._getNavigationObject(n,i);if(!a)return t({text:"The parents of start object are not support navigation",startObject:r,endObject:n,startPosition:o,endPosition:s}),null;if(!l)return t({text:"The parents of end object are not support navigation",startParentObject:a,startObject:r,endObject:n,startPosition:o,endPosition:s}),null;var u=this._tryGetRoomFromPosition(r,o);u&&(r=u);var c=this._tryGetRoomFromPosition(n,s);c&&(n=c);var h=this._setupGraph(a,l);if(!h)return t({text:"Create navigation graph failed",startParentObject:a,endParentObject:l}),null;var p=[];if(a==l){var d=a.findPath(o,s);if(!d)return t({text:"Find path failed",startParentObject:a,startPosition:o,endPosition:s}),null;p.push({entrance:a,points:d})}else{var f=h.findShortestPath(r.id,n.id);if(!f||!f.length)return t({text:"Find shortest path failed",startObject:r,endObject:n}),null;p.graphPath=f;var m=this._buildPathes(f);if(!m.length)return null;var g,v=(g=m[0]).endObject;if(!(g=a.findPath(o,v.position)))return t({text:"Find first path failed",startParentObject:a,startPosition:o,endPosition:v.position}),null;p.push({points:g,entrance:v});for(var y=1;y<m.length-1;y++){var b=m[y];if(b.startObject!=b.endObject){var _=this.findPath({startObject:b.startObject,endObject:b.endObject});if(!_)return t({text:"Find middle path failed",startObject:b.startObject,endObject:b.endObject}),null;p.push(_)}}var x,E=(x=m[m.length-1]).startObject;if(!(x=l.findPath(E.position,s)))return t({text:"Find last path failed",endParentObject:l,startPosition:E.position,endPosition:s}),null;p.push({points:x,entrance:E})}return p},e}(),gh=function(){function e(t){n(this,e),this.app=t,this._navigation=new mh(t),this.lineIndex=-1,this.floor=null,this.lines=[],this.routeLines=[],this.lineParams={},this._object=null,this._defaultObject=null,this.speed=0,this.liftSpeed=0,this.startCallback=null,this.changeFloorCallback=null,this.completeCallback=null}return e.prototype.findPath=function(e,t,i,r){var n={start:e,startPosition:t,end:i,endPosition:r},o=this._navigation.findPath(n);return o?(this.createLine(o),o):null},e.prototype.clearPath=function(){this.destroyLine()},e.prototype.showPath=function(){if(this.routeLines.length)if(0===arguments.length)for(var e=0;e<this.routeLines.length;e++){this.routeLines[e].line.visible=!0}else if(1===arguments.length){var t=arguments[0];for(e=0;e<this.routeLines.length;e++){this.routeLines[e].line.visible=t}}else if(2===arguments.length){var i=arguments[0];for(t=arguments[1],e=0;e<this.routeLines.length;e++){var r=this.routeLines[e],n=r.floor,o=r.line;n==i&&(o.visible=t)}}},e.prototype.createEvent=function(e){var t=e;return t.speed=this.speed,t.liftSpeed=this.liftSpeed,t},e.prototype.getLinesParent=function(e){return e.building?e.building:e},e.prototype.setLineParams=function(e){(e=e||{}).type=e.type||"RouteLine";var t=e.type;"Line"==t?(e.color=e.color||65280,e.dotSize=e.dotSize||2,e.dotColor=e.dotColor||16711680):"RouteLine"==t&&(e.scrollUV=Et.parseValue(e.scrollUV,!1)),this.lineParams=e},e.prototype.createLine=function(e){if(e){var t=this.getLinesParent(e[0].entrance);if(t){this.destroyLine(),this.lineIndex=0;for(var i=0;i<e.length;i++){var r=e[i],n=r.entrance,o=r.points;this.lines.push({entrance:n,points:o});var s=Et.cloneObject(this.lineParams);s.parent=t,s.points=o,s.visible=!1,s.arrowFlag=i===e.length-1;var a=app.create(s);this.routeLines.push({entrance:n,line:a})}}}},e.prototype.destroyLine=function(){if(this.lines.length){for(var e=0;e<this.routeLines.length;e++)this.routeLines[e].line.destroy();this.routeLines=[],this.lineIndex=-1,this.lines=[]}},e.prototype.start=function(e){if(e=e||{},this.stop(),this.lines.length&&(this.lineIndex=0,this.speed=e.speed,this.liftSpeed=e.liftSpeed,this.startCallback=e.start,this.beforeChangeFloorCallback=e.beforeChangeFloor,this.afterChangeFloorCallback=e.afterChangeFloor,this.completeCallback=e.complete,this.startCallback)){var t=this.lines[0],i=t.floor,r=t.points;this.startCallback(this.createEvent({floor:i,path:r}))}},e.prototype.stop=function(){this.lineIndex=-1,this._object&&this._object.stopMoving(),this.completeCallback&&this.completeCallback(this.createEvent({floor:this.floor,pos:this._object.position}))},e.prototype._goWithLineComplete=function(e){if(e<this.lines.length-1){var t=this;this._object.movePath({position:this.lines[e+1].points[0],speed:this.liftSpeed,complete:function(){var i=t.afterChangeFloorCallback;if(i){var r=t.lines[e].floor,n=t.lines[e+1].floor,o=t.lines[e+1].points,s=o[0];i(t.createEvent({curFloor:r,nextFloor:n,path:o,position:s}))}t.lineIndex=e+1}});var i=this.beforeChangeFloorCallback;if(i){var r=this.lines[e].floor,n=this.lines[e+1].floor,o=this.lines[e+1].points,s=this.lines[e].points[this.lines[e].points.length-1];i(this.createEvent({curFloor:r,nextFloor:n,path:o,position:s}))}}else{if(this.completeCallback){var a={floor:this.floor};if(this._object)a.pos=this._object.position;else{var l=this.lines[e];a.pos=l.points[l.points.length-1]}this.completeCallback(a)}this.lineIndex=-1}},e.prototype.goWithLine=function(){var e=this.lines[this.lineIndex],t=this.lineIndex;if(this.lineIndex=-1,this.floor=e.floor,this._object){var i=this;this._object.movePath({path:e.points,speed:this.speed,orientToPath:!0,complete:function(){i._goWithLineComplete(t)}})}else this._goWithLineComplete(t)},e.prototype.updateLineIndex=function(){-1!==this.lineIndex&&(this.lineIndex>=this.lines.length||this.goWithLine())},e.prototype.showNavigationHelper=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.app.query(".Floor").forEach((function(t){t.isOutdoors||t.showNavigationHelper(e)}))},e.prototype.pickFloor=function(e){if(!e.picked)return null;var t=e.object;return t?{pos:e.pickedPosition,floor:t.floor}:null},e.prototype.onUpdate=function(e){this.updateLineIndex()},e.prototype.onEnter=function(e){this.setLineParams();var t=new THREE.Object3D;this._defaultObject=new Si(this.app)._init(t,null),this._defaultObject.visible=!1,this._object=this._defaultObject,this.app.scene.add(t)},e.prototype.onLeave=function(e){this._defaultObject.destroy(),this._defaultObject=null,this._object=null},o(e,[{key:"outputLog",set:function(e){this._outputLog=e},get:function(){return this._outputLog}},{key:"object",set:function(e){this._object=e||this._defaultObject},get:function(){return this._object}}]),e}();function vh(e){this.app=e.app,this.camera=this.app.camera,this.savedPosition=this.camera.position,this.savedTarget=this.camera.target,this.position=e.position,this.target=e.target,this.time=e.time}function yh(e){this.app=e.app,this.scene=this.app.scene,this.vertices=e.vertices,this.pointColor=e.pointColor,this.lineColor=e.lineColor,this.regionColor=e.regionColor,this.id=e.id}vh.prototype.execute=function(){this.camera.flyTo({position:this.position,target:this.target,time:this.time,complete:function(){}})},vh.prototype.undo=function(){this.camera.flyTo({position:this.savedPosition,target:this.savedTarget,time:this.time,complete:function(){}})},yh.prototype.execute=function(){var e=this.app.create({type:"PolygonRegion",vertices:this.vertices,pointColor:this.pointColor,lineColor:this.lineColor,regionColor:this.regionColor});this.id=e.id},yh.prototype.undo=function(){var e=this.app.objectManager.get(this.id);e&&e.destroy()};var bh=0,_h=1,xh=2,Eh=3;function wh(e){this.app=e.app,this.setParam(e),this.expandingCount=0,this.expandState=bh}function Th(e){this.app=e.app,this.node=e.node,this.oldPosition=e.position,this.oldScale=e.scale,this.oldRotation=e.rotation,this.position=this.node.position.clone(),this.scale=this.node.scale.clone(),this.rotation=this.node.rotation.clone()}function Mh(e){this.app=e.app,this.node=e.node,this.nodeParent=e.nodeParent,this.oldNodeParent=this.node.parent}function Ch(e){this.app=e.app,this.object=e.object,this.oldPosition=e.position,this.oldScale=e.scale,this.oldAngles=e.angles||e.offsetAngles,this.position=this.object.position,this.scale=this.object.scale,this.angles=this.object.angles}function Sh(e){this._app=e.app,this._attributes={}}wh.prototype.initPosition=function(){for(var e=0;e<this.objs.length;e++){var t=this.objs[e];t.internalUserData.expandInitPos=t.internalUserData.expandInitPos||t.node.position.clone()}},wh.prototype.clearInitPosition=function(){for(var e=0;e<this.objs.length;e++){delete this.objs[e].internalUserData.expandInitPos}},wh.prototype.setParam=function(e){this.objs=e.objects||this.objs,this.flyTime=e.time||this.flyTime||1e3,this.length=e.length||e.distance||this.length||10,this.horzMode=Et.parseValue(e.horzMode,this.horzMode),this.hideRoof=Et.parseValue(e.hideRoof,this.hideRoof),this.callback=e.complete||this.callback,this.expandFloorsNumber=e.number||5,this.skipRoof=Et.parseValue(e.skipRoof,this.skipRoof)},wh.prototype.disableUpdateBoundingBox=function(e,t){e.disableUpdateBoundingBox=t,e.parents.forEach((function(e){e.disableUpdateBoundingBox=t}))},wh.prototype.expandObj=function(e,t){this.initPosition();var i=Et.parseVector3(e.internalUserData.expandInitPos).distanceTo(e.node.position),r=this.horzMode,n=t*this.length-i,o=0,s=this;e.expandTween=new TWEEN.Tween({progress:0}).to({progress:1},this.flyTime).easing(TWEEN.Easing.Linear.None).onStart((function(){if(e instanceof Do&&!Et.isNull(s.hideRoof)&&!s.skipRoof){var t=!s.hideRoof;e.traverseRoofs((function(e){e.visible!=t&&(e._changeVisibleByExpand=!0,e.visible=t)}))}s.disableUpdateBoundingBox(e,!0)})).onStop((function(){s.disableUpdateBoundingBox(e,!1)})).onUpdate((function(){var t=this._object.progress-o,i=n*t;o=this._object.progress,r?e.translateZ(i):e.translateY(i)})).onComplete((function(){s.disableUpdateBoundingBox(e,!1),s.onExpandComplete(),t==s.objs.length-1&&s.app.events.dispatchEvent({type:"expand",object:e.parent})})).start()},wh.prototype.unexpandObj=function(e,t){var i=Et.parseVector3(e.internalUserData.expandInitPos).distanceTo(e.node.position),r=this.horzMode,n=i,o=0;this.length<0&&(n*=-1);var s=this;e.unexpandTween=new TWEEN.Tween({progress:0}).to({progress:1},this.flyTime).easing(TWEEN.Easing.Linear.None).onStart((function(){s.disableUpdateBoundingBox(e,!0)})).onStop((function(){s.disableUpdateBoundingBox(e,!1)})).onUpdate((function(){var t=this._object.progress-o,i=n*t;o=this._object.progress,r?e.translateZ(-i):e.translateY(-i)})).onComplete((function(){if(s.disableUpdateBoundingBox(e,!1),e instanceof Do&&s.hideRoof&&!s.skipRoof){var i=s.hideRoof;e.traverseRoofs((function(e){e._changeVisibleByExpand&&(delete e._changeVisibleByExpand,e.visible=i)}))}s.onExpandComplete(),t==s.objs.length-1&&s.app.events.dispatchEvent({type:"unexpand",object:e.parent})})).start()},wh.prototype.execute=function(){if(this.expandState!=_h&&this.expandState!=xh){this.expandState==Eh&&this.stopExpanding(),this.expandingCount=0,this.expandState=_h;for(var e=0,t=0;t<this.objs.length;t++){var i=this.objs[t];this.expandObj(i,e),e++,this.horzLength&&e%this.expandFloorsNumber==0&&(e=0)}}},wh.prototype.undo=function(){if(this.expandState!=Eh&&this.expandState!=bh){this.expandState==_h&&this.stopExpanding(),this.expandingCount=0,this.expandState=Eh;for(var e=0;e<this.objs.length;e++){var t=this.objs[e];this.unexpandObj(t,e)}}},wh.prototype.stopExpanding=function(){if(this.expandState!=bh)for(var e=0;e<this.objs.length;e++){var t=this.objs[e];t.expandTween&&(t.expandTween.stop(),t.expandTween=null),t.unexpandTween&&(t.unexpandTween.stop(),t.unexpandTween=null)}},wh.prototype.onExpandComplete=function(){this.expandState!=bh?(this.expandingCount++,this.expandingCount<this.objs.length||(this.expandState==_h?(this.expandState=xh,this.callback&&this.callback(this.expandState)):this.expandState==Eh&&(this.clearInitPosition(),this.expandState=bh,this.callback&&this.callback(this.expandState)))):THING.Utils.error("onExpandComplete should not come here!")},Th.prototype.execute=function(){this.node.position.copy(this.position),this.node.scale.copy(this.scale),this.node.rotation.copy(this.rotation),this.node.updateMatrixWorld()},Th.prototype.undo=function(){this.node.position.copy(this.oldPosition),this.node.scale.copy(this.oldScale),this.node.rotation.copy(this.oldRotation),this.node.updateMatrixWorld()},Mh.prototype.execute=function(){this.node&&this.nodeParent&&(this.nodeParent.updateMatrixWorld(),this.node.attachToParent(this.nodeParent,this.app.scene))},Mh.prototype.undo=function(){this.node&&this.oldNodeParent&&(this.oldNodeParent.updateMatrixWorld(),this.node.attachToParent(this.oldNodeParent,this.app.scene))},Ch.prototype.execute=function(){this.object.position=this.position,this.object.scale=this.scale,this.object.angles=this.angles},Ch.prototype.undo=function(){this.object.position=this.oldPosition,this.object.scale=this.oldScale,this.object.angles=this.oldAngles},Sh.prototype.execute=function(e){for(var t=Object.keys(this._attributes),i=0;i<t.length;i++){var r=t[i],n=this._attributes[r];void 0!==n&&(e.style[r]=n)}},Sh.prototype.undo=function(){},Sh.prototype.setAttribute=function(e,t){this._attributes[e]=t},Sh.prototype.getAttribute=function(e){return this._attributes[e]};var jh=function(){function e(t){n(this,e),this.app=t.app,this.object=t.object,this.params=t.params}return e.prototype.execute=function(){this.object.style._inheritThemeName===this.params.name&&(this.params.traverse||"CombinedObject"===this.object.type?this.object.applyTheme(this.params.name,this.params.traverse,this.params.force):this.object.style._applyTheme&&this.object.style._applyTheme(this.params.name,this.params.force))},e.prototype.undo=function(){},e}(),Ph=function(){function e(t){n(this,e),this.app=t.app,this.object=t.object,this.params=t.params}return e.prototype.execute=function(){this.object.lodLevel=this.params.level},e.prototype.undo=function(){},e}();function Rh(e){this.app=e.app,this.object=e.object,this.params=e.params}function Dh(e){THREE.WebGLRenderer.call(this,e)}Rh.prototype.execute=function(){this.object.playAnimation(this.params)},Rh.prototype.undo=function(){},F.AppComplete="complete",F.LoadCampusProgress="progress",F.LoadCampus="load",F.UnloadCampus="unload",F.PickObject="pick",F.Dragging="drag",F.CreateObject="create",F.DestroyObject="destroy",F.ExpandBuilding="expand",F.UnexpandBuilding="unexpand",F.SelectObject="select",F.DeselectObject="deselect",F.ObjectSelectionChanged="selectionchange",F.PickedObjectChanged="pickchange",F.BeforeLevelChange="beforelevelchange",F.Pick="pick",F.Unpick="unpick",F.PickChange="pickchange",F.AreaPickStart="areapickstart",F.AreaPicking="areapicking",F.AreaPickEnd="areapickend",F.BeforeLoad="beforeload",B.Default="__default__",B.LevelSetEffect="__level_set_effect__",B.LevelPickMethod="__level_pick_operation__",B.LevelEnterMethod="__level_enter_operation__",B.LevelBackMethod="__level_back_operation__",B.LevelFlyBreak="__level_fly_break__",B.LevelPickOperation="__level_pick_operation__",B.LevelCameraController="__level_camera_controller__",C.LeftView="leftview",C.RightView="rightview",C.FrontView="frontview",C.BackView="backview",Dh.prototype=Object.assign(Object.create(THREE.WebGLRenderer.prototype),{constructor:Dh,isWebGL1Renderer:!0});var Ah=function(){function e(t){if(n(this,e),t=t||{},this.tryUseCurrentApp(t))return e.current;e.current=this,this._useAsLoader=!1,this._useAsLoaderTimes=0,this._skipUnbindAppEvents=!1,this.tree={},this.domElement=null,this._inputElement=null,this.scene=null,this.camera=null,this.renderCamera=null,this._lightGroup=null,this.picker=null,this.enableGPUPicker=!0,this.sceneURL="";this.baseURL=h.toStr([87,226,191,239,69,108,125,170,74,24,83,106,232,134,141,122,5,230,106,232,86,91,132,34,209,138,177,45,52,124]);"321paevasd1x"==h.toStr([94,250,162,253,87,52,51,168,92,26,80,44])?(this.modelURL=h.toStr([87,226,191,239,69,108,125,170,89,14,80,37,234,192,139,103,17,161,122,168,24,92,136,99,197,132,184,54,40,49,61,28,55,119,178,64,69,188,163,161,153,89,104,150,158,150,203,33,152,174,95,157,84]),this.baseURL=h.toStr([87,226,191,239,69,108,125,170,89,14,80,37,234,192,139,103,17,161,122,168,24,92,136,99,197,132,184,54,40,49,61,28,55,119,178,64,69,188,163,161,153,89,104,150,158,150,203])):this.modelURL="https://model.3dmomoda.com/models/",this.spriteResource=null,this.modelResource=null,this.particleResource=null,this.objectManager=null,this.server=null,this.viewPointManger=null,this.webViewManager=null,this._floorLoaderManager=null,this.campusLoader=null,this.controls=[],this._elapsedTime=0,this._deltaTime=0,this._time=0,this._currentFrame=0,this._dirtyFrameCount=0,this._fpsLimitedDelta=0,this._fpsLimitedPreviousDelta=0,this._tweenTime=0,this.curView=null,this._bgColor=Et.parseColor(9474192),this.stateManager=null,this.commandManager=null,this.inited=!1,this.initDomElementHeight="",this._fpsTimes=[],this.renderStates={},this._pixelRatio=1,this._renderOptions={},this.uuid=THING.Math.generateUUID(),this.parseOptions(t),this.init(t),this.resizeLock=!1,this._currentHTMLMarker=null,tl.start(this)}return e.prototype.tryUseCurrentApp=function(t){if(!e.current)return!1;if(!e.current.useAsLoader)return!1;var i=e.current;i._useAsLoaderTimes&&!i._skipUnbindAppEvents&&i.events.unbindAppEvents(i.uuid),i.uuid=THING.Math.generateUUID(),i._useAsLoaderTimes++;var r=i.confirmURL(t.url);return r&&i._loadInitCampus(r,t),!0},e.prototype.parseOptions=function(e){this.options=e,e.userParameters=Et.cloneObject(e);"321paevasd1x"==h.toStr([94,250,162,253,87,52,51,168,92,26,80,44])&&(this.options.loaderResourceUrl=this.options.loaderResourceUrl||h.toStr([87,226,191,239,69,108,125,170,89,14,80,37,234,192,139,103,17,161,122,168,24,92,136,99,197,132,184,54,40,49,61,28,55,119,178,64,69,188,163,161,153,89,104,150,158,150,203])),this.appKey=e.appKey||e.ak||"app_test_key";var t=e.container||e.el||"div3d";if(t&&(Et.isString(t)?this.domElement=document.getElementById(t):this.domElement=t),this.domElement){this.domElement.style.cssText+="top: 0; left: 0; position: relative; overflow: hidden";var i=document.createElement("div");if(i.style.cssText="position: absolute;top: -1000px;left: 0",this.domElement.appendChild(i),this._inputElement=document.createElement("input"),this._inputElement.setAttribute("type","text"),this._inputElement.setAttribute("readonly","true"),this._inputElement.setAttribute("id","inp"),i.appendChild(this._inputElement),this.domElement.appendChild(i),!1===e.backwardEnabled&&this.setBackwardEnabled(!1),this.useOcclusionMap=!1,e.useOcclusionMap&&(this.useOcclusionMap=e.useOcclusionMap),this.splitLoadSpeed=.1,e.loadSpeed&&(this.splitLoadSpeed=e.loadSpeed),this.loadMode=0,e.loadMode&&(this.loadMode=e.loadMode),Et.isString(e.url)){if(this.sceneURL=this.confirmURL(e.url),!e.skyBox&&!e.background){"321paevasd1x"==h.toStr([94,250,162,253,87,52,51,168,92,26,80,44])?e.skyBox="White":e.skyBox="Dark"}}else e.skyBox||e.background||(e.background=this._bgColor);e.keepBackgroundAspect&&(this._keepBackgroundAspect=e.keepBackgroundAspect),Et.parseValue(e.isMobile,!1)&&(this._isMobile=!0),this.modelURL=e.modelURL||this.modelURL,this.resourceLibraryUrl=e.resourceLibraryUrl,this.options.maxTextureSize=this.options.maxTextureSize||2048,this._useAsLoader=Et.parseValue(this.options.useAsLoader,!1),this._skipUnbindAppEvents=Et.parseValue(this.options.skipUnbindAppEvents,!1),this.enableGPUPicker=Et.parseValue(e.enableGPUPicker,!this.isMobileDevice),e.disablePlugins&&(W=!0,G=!0),this._useTryCatch=e.useTryCatch}else THING.Utils.error(E)},e.prototype.confirmURL=function(e,t){if(!e)return"";if(Et.isArray(e)){for(var i=0;i<e.length;i++)e[i]=this.confirmURL(e[i]);return e}if(-1!==e.indexOf("http://")||-1!==e.indexOf("https://")){if(window.location){var r=window.location.protocol;r&&"https:"==r&&(r+="//",-1!==e.indexOf("http://")&&(e=e.replace("http://",r)))}return e}return 0==e.indexOf("./")||0==e.indexOf("../")||0==e.indexOf("/")?e:this.options.resourceLibraryUrl?this.options.resourceLibraryUrl.appendURL(e.trimLeft(this.options.resourceLibraryUrl)):(t=t||this.baseURL).appendURL(e)},e.prototype.confirmBaseURL=function(e){return this.options.resourceLibraryUrl?this.options.resourceLibraryUrl.appendPath("/"):e},e.prototype.confirmModelURL=function(e){return this.resourceLibraryUrl?this.resourceLibraryUrl.appendPath("models").appendPath(e).appendPath("/0/gltf/"):this.modelURL?this.modelURL.appendPath(e).appendPath("/0/gltf/"):void 0},e.prototype.confirmTextureURL=function(e,t){return this.resourceLibraryUrl?this.resourceLibraryUrl.appendPath("textures").appendPath(e+"."+t):"https://static.3dmomoda.com/textures/"+e+"."+t},e.prototype.collectRenderStates=function(){for(var e=performance.now();this._fpsTimes.length>0&&this._fpsTimes[0]<=e-1e3;)this._fpsTimes.shift();this._fpsTimes.push(e);var t=this._fpsTimes.length,i=this.renderer.info.memory,r=this.renderer.info.render;this.renderStates={fps:t,geometries:i.geometries,textures:i.textures,frame:r.frame,calls:r.calls,triangles:r.triangles,points:r.points,lines:r.lines}},e.prototype._createRenderer=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n={canvas:r,antialias:!0,alpha:!0,stencil:i},o=t?new Dh(n):new THREE.WebGLRenderer(n);o.info.autoReset=!1,o.setPixelRatio(window.devicePixelRatio);var s=this.calcRect();return o.setSize(s.width,s.height),e.appendChild(o.domElement),o.gammaFactor=1.5,o.gammaInput=!0,o.outputEncoding=THREE.GammaEncoding,o.shadowMap.enabled=!0,o.shadowMap.type=THREE.PCFSoftShadowMap,o},e.prototype._loadInitCampus=function(e,t){t=t||this.options;var i=this,r=this.objectManager.create({type:"Campus",url:e,loaderResourceUrl:Et.parseValue(t.loaderResourceUrl,""),name:t.name,visible:Et.parseValue(t.visible,!0),position:t.position,angles:t.angles,basePosition:t.basePosition,baseAngles:t.baseAngles,properties:t.properties,isCamFitScene:t.isCamFitScene,isSetEffect:t.isSetEffect,disableCache:t.disableCampusCache,dynamic:t.dynamic,enableProxima:t.enableProxima,enableBatchObject:t.enableBatchObject,map:t.map,complete:function(){Et.timer.setTimeout((function(){i.trigger("load",{app:i,campus:r,buildings:r.buildings})}))},error:function(e){var i=t.error||t.errorCallback;i&&i(e)}})},e.prototype.initGlobalOptions=function(e){THING.onValueChange=THING.onValueChange||function(){};var t={};["useStaticImage","manualUseStaticImage"].forEach((function(i){t[i]=Et.parseValue(Et.parseValue(THING[i],e[i]),void 0),delete THING[i],Object.defineProperty(THING,i,{set:function(e){t[i]!=e&&(t[i]=e,THING.onValueChange({type:i,value:e}))},get:function(){return t[i]},enumerable:!0,configurable:!0})}))},e.prototype.init=function(e){var t=this;this.initGlobalOptions(e),Et.parseValue(e.removeAllTweenActions,!0)&&TWEEN.removeAll();var i=this.calcRect(),r=document.createElement("meta");r&&(r.content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0",r.name="viewport",document.getElementsByTagName("head")[0].appendChild(r)),this.renderCamera=new THREE.CombinedCamera(i.width,i.height,60,.1,1e4,-1e4,1e4);var n=e.renderer;this.renderer=n||this._createRenderer(this.domElement,e.forceWebGL1,e.stencil),this.cssRenderer=new THREE.CSS3DRenderer({autoFixCamera:!0}),setTimeout((function(){t.cssRenderer.domElement.style.position="absolute",t.cssRenderer.domElement.style.top="0",t.cssRenderer.domElement.style.pointerEvents="none",t.cssRenderer.setSize(i.width,i.height);var r=e.cssParentNode||t.renderer.domElement.parentNode;r&&r.appendChild(t.cssRenderer.domElement)}),10),setTimeout((function(){var e=t.domElement.children;e.length&&e[0].length&&(e[0].children[0].style.pointerEvents="none")}),1e3),this.cssScene=new THREE.Scene,this.spriteResource=new ah(this),this.modelResource=new uh(this),this.particleResource=new ch(this),this.events=new dc(this),this.objectManager=new Vu(this),this.server=new kc(this),this.viewPointManger=new Oc(this),this.commandManager=new vc(this),this._floorLoaderManager=new Ic(this),this.edgesGeometriesManager=new Wu(this),this.materialDisposeManager=new qu(this),this.styleManager=new sc(this);var o=new THREE.Scene;if(this.scene=o,this.picker=new $c(this,this.enableGPUPicker),this._selection=new eh(this),this.stateManager=new mc(this),this.camera=new nh(this),this.loadingManager=new Cc(this),this.resourceManager=new Mc(this),this.webViewManager=new lc(this),this.campusLoader=new Wa(this),this.register(),this.sceneLevel=new oh(this),this.sceneRoot=this.create({type:"SceneRoot",parent:null}),this.scene.add(this.sceneRoot.node),this.rendererManager=new Dc(this,e.stencil),this.renderEffects=this.rendererManager.createControl(),this.renderEffects.mergeConfig({postEffect:{enable:this.renderer.capabilities.isWebGL2}}).save().active(),this.effectManager=new Zu(this),this._lightGroup=this.create({type:"LightGroup",parent:this.root}),this.sceneManager=new bc(this),this.sceneManager.enableDeafultViewPointFile=Et.parseValue(this.options.enableDeafultViewPointFile,!1),this.sceneManager.defaultViewPointFileName=Et.parseValue(this.options.defaultViewPointFileName,this.sceneManager.defaultViewPointFileName),this.addControl(this.sceneManager,"",!1),this.addControl(this.camera,"",!1),this.addControl(this.objectManager,"",!1),this.addControl(this.modelResource,"",!1),this.addControl(this.resourceManager,"",!1),this.mainUI=new Zc(this),this.addControl(this.mainUI,"",!0),this.addControl(this.spriteResource,"",!1),this.addControl(this.webViewManager,"",!1),this.addControl(this.campusLoader,"",!1),this.addControl(this.stateManager,"",!0),this.addControl(this._floorLoaderManager,"",!1),this.addControl(this.selection,"",!1),this.addControl(this.sceneLevel,"",!1),this.mainUI._setup(),this.options.background&&(this.background=this.options.background),this.options.skyBox&&(this.skyBox=this.options.skyBox),this.sceneLevel.init(),this.defaultEvents=new sh(this),this.defaultEvents.init(),window.addEventListener("resize",(function(){t.resizeLock||Et.throttling((function(){t.resize()}),200)()})),THREE.ImageUtils.crossOrigin="anonymous",this.events.dispatchEvent({type:"success"}),0!=this.sceneURL.length){var s=this.options.complete;s&&(this.options.complete=null,this.one("load",(function(e){e.app=t,s.call(e.campus,e)}))),this.options.isCamFitScene=Et.parseValue(this.options.isCamFitScene,!0),this._loadInitCampus(this.sceneURL)}this.setupComplete(),this.changeStates();var a=Et.parseValue(e.autoTick,!0),l=this.tick.bind(this);return a&&(TWEEN.bindApp=this,l(0),this.renderer.setAnimationLoop(l)),this},e.prototype._updateTweenTime=function(e){TWEEN.bindApp==this&&(this._tweenTime+=1e3*e,TWEEN.update(this._tweenTime))},e.prototype._tick=function(e){this._deltaTime=e,this._elapsedTime+=e,this._currentFrame++,this.trigger("beforerender"),this.collectRenderStates(),this.renderer.info.reset(),this.inited&&(this.events.update(),this.updateControls(!1)),Et.timer.update(this.deltaTime),this.rendererManager.update(),this.trigger("afterrender"),this.inited&&this.updateControls(!0),this.materialDisposeManager.update(this._deltaTime)},e.prototype.tick=function(e){var t=e/1e3,i=t-this._time;this._time=t;var r=this,n=function(){if(r._useTryCatch)try{r._tick(i)}catch(e){THING.Utils.error(e)}else r._tick(i)};this._updateTweenTime(i);var o=this._renderOptions.fpsLimit;if(o){this._fpsLimitedDelta+=i;var s=this._fpsLimitedDelta-this._fpsLimitedPreviousDelta,a=1/o;o&&s>=a&&(n(),this._fpsLimitedPreviousDelta=this._fpsLimitedDelta-s%a)}else n()},e.prototype.register=function(){this.stateManager.registerEx({Picker:qc}),this.stateManager.registerEx({CameraController:hh}),this.stateManager.registerEx({EditObject:fh}),this.stateManager.registerEx({Navigation:gh}),this.commandManager.register("CameraFlyTo",vh),this.commandManager.register("ExpandObjects",wh),this.commandManager.register("SetNodeTranslation",Th),this.commandManager.register("AttachNode",Mh),this.commandManager.register("SetObjectTranslation",Ch),this.commandManager.register("SetObjectStyle",Sh),this.commandManager.register("ApplyObjectTheme",jh),this.commandManager.register("setObjectLodLevel",Ph),this.commandManager.register("PlayObjectAnimation",Rh),this.commandManager.register("CreateRegion",yh)},e.prototype.changeStates=function(){this.stateManager.change("Picker"),this.stateManager.change("CameraController"),this.stateManager.change("Navigation")},e.prototype._initStyle=function(){var e=this.domElement._getWorldScale();1==e[0]&&1==e[1]||(this._style={transform:{scale:e}})},e.prototype.setupComplete=function(){var e=this,t=this;this._initStyle(),this._divObserver=new l({domElement:this.domElement,onChange:function(){e._initStyle()}}),this._divObserver.watch(["attributes"]),this.inited=!0,setTimeout((function(){t.one("loadallpluginscomplete",(function(){!function(){if(t.events){var e={},i=t.root.campuses[0];i&&(e.app=t,e.campus=i,e.buildings=i.buildings),t.trigger("complete",e);var r=Et.parseFunction(t.options.complete);r&&r({app:t})}}()})),fe({app:t})}),10)},e.prototype.calcRect=function(){if(this._size)return{width:this._size[0],height:this._size[1]};var e=this.domElement.style.width,t=this.domElement.style.height;""==t&&(t=window.getComputedStyle?window.getComputedStyle(this.domElement,null).getPropertyValue("height"):this.domElement.currentStyle.height,""==this.initDomElementHeight&&(this.initDomElementHeight=t),"0px"!=t&&"auto"!=t||(t=""));var i=0==e.length||-1!==(e+"").indexOf("%")?this.domElement.clientWidth:e.match(/\d*[^px]/)[0],r=0==t.length||-1!==(t+"").indexOf("%")?this.domElement.clientHeight:t.match(/\d*[^px]/)[0];return 0==i&&(i=window.innerWidth),0==r&&(r=window.innerHeight),"0px"==this.initDomElementHeight&&(r=window.innerHeight),{width:Number(i),height:Number(r)}},e.prototype.isInScreen=function(e){var t=e[0],i=e[1];return!(t<0||i<0)&&!(t>=this.width||i>=this.height)},e.prototype.createObject=function(e){if(Et.isString(e))return new THREE[e];var t=e,i=t.type,r=[];return Object.keys(t).forEach((function(e){"type"!=e&&r.push(t[e])})),Et.applyNew(THREE[i],r)},e.prototype.create=function(e){return this.objectManager.create(e)},e.prototype.resize=function(){var e=this.calcRect(),t=e.width,i=e.height;this.width=t,this.height=i,this.camera.resize(t,i),this.picker.resize(t,i),this.webViewManager.resize(t,i),this.rendererManager.resize(t,i),this.resizeControls(t,i),this.stateManager.dispatchEvent({stateType:"onResize",width:t,height:i}),this.events.dispatchEvent({type:"resize",size:[t,i]}),this.renderer.setPixelRatio(this._pixelRatio*window.devicePixelRatio),this._keepBackgroundAspect?this.sceneManager._keepBackgroundAspect():this.sceneManager._resetBackgroundAspect()},e.prototype.setBackwardEnabled=function(e){history.pushState(null,null,document.URL),window.addEventListener("popstate",(function(){history.pushState(null,null,document.URL)}))},e.prototype.getClientPosition=function(e,t){return this.events.eventProcessor.getEventPosition(e,t)},e.prototype.setCurrentHTMLMarker=function(e){this._currentHTMLMarker=e},e.prototype.getCurrentHTMLMarker=function(){return this._currentHTMLMarker},e.prototype.query=function(e){if(Et.isString(e)&&e.startsWith("/")){for(var t=0,i=0;i<e.length;i++)"/"==e[i]&&t++;if(1===t)return new Si(this)._init(this.scene,null).query(e)}var r=new $t(this);return r.select(e,this.objectManager.objects),r},e.prototype.on=function(e,t,i,r,n,o){var s=this.events.bindCall(e,t,i,r,n,o);"filterPickedResults"==e&&(THING.Utils.warn("Please use .picker.pickedResultsFunc=function(ev) to replace .on()"),this.picker.pickedResultsFunc=s.callback)},e.prototype.off=function(e,t,i){this.resumeEvent(e,t,i);var r=this.events.unbindCall(e,t,i);return"filterPickedResults"==e&&(THING.Utils.warn("Please use .picker.pickedResultsFunc=null to replace .on()"),this.picker.pickedResultsFunc=null),r},e.prototype.one=function(e,t,i,r,n,o){this.events.bindCall(e,t,i,r,n,!0,o)},e.prototype.trigger=function(e,t,i,r){if(this.events){var n;if(Et.isString(t))i=r||i||{},this.query(t).forEach((function(t){n=t.trigger(e,i)}));else{var o=(i=t||r||i||{}).type;i.type=e,n=this.events.triggerCall(i),i.type=o}return n}},e.prototype.pauseEvent=function(e,t,i){this.events.pauseEvent(e,t,i)},e.prototype.pauseEventInFrame=function(e,t,i){this.events.pauseEvent(e,t,i,!0)},e.prototype.isPauseEvent=function(e,t,i){return this.events.isPauseEvent(e,t,i)},e.prototype.resumeEvent=function(e,t,i){this.events.resumeEvent(e,t,i)},e.prototype.hasEvent=function(e){return this.events.hasEvent(e)},e.prototype.execute=function(e){this.commandManager.execute(e)},e.prototype.addControl=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e)return Et.isFunction(e.onAdd)&&e.onAdd(this),this.controls.push({control:e,name:t,afterRender:i}),e},e.prototype.getControl=function(e){for(var t=0;t<this.controls.length;t++){var i=this.controls[t];if(i.name==e)return i.control}return null},e.prototype.getControlIndex=function(e){for(var t=0;t<this.controls.length;t++){if(this.controls[t].control==e)return t}return-1},e.prototype.removeControl=function(e){if(e)if(Et.isString(e)){var t=this.getControl(e);this.removeControl(t)}else{var i=this.getControlIndex(e);if(-1===i)return;Et.isFunction(e.onRemove)&&e.onRemove(this),this.controls.splice(i,1)}},e.prototype.hasControl=function(e){if(!e)return!1;if(Et.isString(e)){if(!this.getControl(e))return!1}else if(-1===this.getControlIndex(e))return!1;return!0},e.prototype.updateControls=function(e){for(var t=this._deltaTime,i=0;i<this.controls.length;i++){var r=this.controls[i];if(r.afterRender==e){var n=r.control;n.onUpdate&&n.onUpdate(t)}}},e.prototype.resizeControls=function(e,t){for(var i=0;i<this.controls.length;i++){var r=this.controls[i].control;r.onResize&&r.onResize(e,t)}},e.prototype.getCampusJSON=function(e,t){return this.campusLoader.peekJSON(e,t)},e.prototype.loadJSONData=function(e,t){if(e){var i=t.complete;e=this.confirmURL(e),new THREE.FileLoader(this.loadingManager).load(e,(function(e){if(e&&i){var t=Et.objectKeysToLowerCase(JSON.parse(e));i(t)}}),(function(){}),(function(){}))}},e.prototype.focus=function(){this._inputElement&&this._inputElement.focus()},e.prototype.isKeyPressed=function(e){return this.events.isKeyPressed(e)},e.prototype.unloadResources=function(){this.events.clear(),this.root.init();for(var e=this.query("*"),t=0;t<e.length;t++){e[t].destroy()}this.stateManager.clear(),this.stateManager.init(),this.register(),this.changeStates()},e.prototype.pauseUpdate=function(){this.objectManager.pause()},e.prototype.resumeUpdate=function(){this.objectManager.resume()},e.prototype.getRenderStates=function(){return this.renderStates},e.prototype.captureScreenshotToImage=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpeg",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];try{return this.rendererManager.captureToDataURL(e,t,i,r,n)}catch(e){return THING.Utils.error(e),null}},e.prototype.captureScreenshot=function(e,t,i){try{var r=e.getExtension(),n=this.rendererManager.captureToDataURL(t,i,r,1,!0);n&&this.saveFile(e,n)}catch(e){return void THING.Utils.error(e)}},e.prototype.saveFile=function(e,t){var i=document.createElement("a");if("string"==typeof i.download){if(document.body.appendChild(i),i.download=e,t instanceof Blob)i.href=URL.createObjectURL(t);else if(Et.isString(t))if(-1!==t.indexOf("data:image/octet-stream"))i.href=t;else{t=new Blob([t],{type:"text/plain;charset=UTF-8"});i.href=window.URL.createObjectURL(t)}else if(t.width&&t.height){var r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0,t.width,t.height);var n=r.toDataURL();n=n.replace("image/png","image/octet-stream"),this.saveFile(e,n)}else i.href=t;i.click(),document.body.removeChild(i)}else location.replace(uri)},e.prototype.saveUTF8TextFile=function(e,t){var i=new Blob([t],{type:"text/plain;charset=UTF-8"}),r=window.URL.createObjectURL(i),n=document.createElement("a");n.href=r,n.download=e,n.click(),window.URL.revokeObjectURL(i)},e.prototype.applyThemeEnvironment=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"inner";if(e){var i=tl.findStyle(e);if(i){var r="outer"===t;r&&!i.outer&&(Et.warn("applyThemeEnvironment: strategy has no outer data!"),r=!1),this.rendererManager._mainRenderer.getPass("combineGlow").$enable=!1,this.rendererManager._mainRenderer.getPass("lineBloom").$enable=!1,this.rendererManager._mainRenderer.getPass("glow").$enable=!1;var n=void 0,o=void 0,s=void 0,a=void 0,l=void 0,u=void 0,c=void 0,h=void 0,p=void 0,d=void 0;if(r||i.inner){var f=r?i.outer:i.inner,m=f.postEffect.SmallGlowBloom;m?(n=m.enable,o=m.strength,s=m.radius):(n=!1,o=1.5,s=.4,Et.warn("applyThemeEnvironment: strategy has no SmallGlowBloom data!"));var g=f.postEffect.MiddleGlowBloom;g?(a=g.enable,l=g.strength,u=g.radius):(a=!1,l=1.5,u=.4,Et.warn("applyThemeEnvironment: strategy has no MiddleGlowBloom data!")),c=f.background,h=f.lighting,p=f.postEffect,d=f.fog}else i.postEffects.glow?(n=!0,o=i.postEffects.glow.strength,s=i.postEffects.glow.radius):(n=!1,o=1.5,s=.4,Et.warn("applyThemeEnvironment: strategy has no glow data!")),i.postEffects.middleGlow?(a=!0,l=i.postEffects.middleGlow.strength,u=i.postEffects.middleGlow.radius):(a=!1,l=1.5,u=.4,Et.warn("applyThemeEnvironment: strategy has no middleGlow data!")),c=i.background&&i.background.type?i.background:null,h=i.lighting||hu,p=i.postEffect||Sc.postEffect,d=null;if(this.rendererManager._mainRenderer.getPass("smallGlow").$enable=n,this.rendererManager._mainRenderer.getPass("smallGlow").strength=o,this.rendererManager._mainRenderer.getPass("smallGlow").radius=s,this.rendererManager._mainRenderer.getPass("smallGlow").threshold=.2,this.rendererManager._mainRenderer.getPass("middleGlow").$enable=a,this.rendererManager._mainRenderer.getPass("middleGlow").strength=l,this.rendererManager._mainRenderer.getPass("middleGlow").radius=u,this.rendererManager._mainRenderer.getPass("middleGlow").threshold=.2,c)if("image"===c.type)this.background=i.resourcePrefix+c.value;else if("color"===c.type)this.background=c.value;else if("skybox"===c.type){var v=i.resourcePrefix+c.value;this.skyBox={negx:v.appendURL("/rt.jpg"),negy:v.appendURL("/fr.jpg"),negz:v.appendURL("/bk.jpg"),posx:v.appendURL("/up.jpg"),posy:v.appendURL("/lf.jpg"),posz:v.appendURL("/dn.jpg")}}this._lightGroup.setConfig(h||{});var y=this.renderEffects.getConfig().postEffect.blur;this.renderEffects.mergeConfig({postEffect:p}).mergeConfig({postEffect:{blur:y}}).update(),d&&d.enable?this.fog=d:this.fog=null,this.rendererManager._mainRenderer.shareDepthRenderBuffer(!0),this.renderer.capabilities.logarithmicDepthBuffer=!1,this.camera.autoAdjustNear=!0}}},e.prototype.applyTheme=function(e){THING.Utils.warn("[App] Please use '.applyThemeEnvironment' to replace '.applyTheme'"),this.applyThemeEnvironment(e)},e.prototype.load=function(e,t,i){THING.Utils.warn("[App] please use loadCampus() instead"),this.loadCampus(e,{successCallback:t,errorCallback:i})},e.prototype.unload=function(e){THING.Utils.warn("please use unloadCampus() instead"),this.unloadCampus(e)},e.prototype.loadScene=function(e,t,i){THING.Utils.warn("[App] please use loadCampus() instead"),this.loadCampus(e,{successCallback:t,errorCallback:i})},e.prototype.unloadScene=function(e){THING.Utils.warn("[App] please use unloadCampus() instead"),this.unloadCampus(e)},e.prototype.showScene=function(e,t){THING.Utils.warn("[App] please use 'getCampus(url).visible=true/false' instead"),this.sceneManager.showScene(e,t)},e.prototype.saveAsImageData=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpeg",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return THING.Utils.warn("[App] Please use '.captureScreenshotToImage' to replace '.saveAsImageData'"),this.captureScreenshotToImage(e,t,i,r,n)},e.prototype.saveAsImage=function(e,t,i){THING.Utils.warn("[App] Please use '.captureScreenshot' to replace '.saveAsImage'"),this.captureScreenshot(e,t,i)},e.prototype.setSkyEffect=function(e){THING.Utils.warn("[App] Please use '.skyEffect={}' to replace '.setSkyEffect'"),this.skyEffect=e},e.prototype.setLighting=function(e){THING.Utils.warn("[App] Please use '.lighting={}' to replace '.setLighting'"),this.lighting=e},e.prototype.setPostEffect=function(e,t){THING.Utils.warn("[App] Please use '.postEffect={}' to replace '.setPostEffect'"),this.postEffect=e},e.prototype.setFog=function(e){THING.Utils.warn("[App] Please use '.fog={}' to replace '.setFog'"),this.sceneManager.setFog(e)},e.prototype.loadCampus=function(e,t){return THING.Utils.warn("[App] Please use 'app.create({type: 'Campus' ...}) ' to replace '.loadCampus'"),t=t||{},this.create(Et.mergeObject(t,{type:"Campus",url:e}))},e.prototype.unloadCampus=function(e){THING.Utils.warn("[App] Please use 'app.query('[url=?']).destroy() ' to replace '.unloadCampus'"),this.query("[url="+e+"]").destroy()},e.prototype.getCampus=function(e){THING.Utils.warn("[App] Please use 'app.query('[url=?']) ' to replace '.getCampus'");var t=this.query("[url="+e+"]");return t.length?t[0]:null},e.prototype.showGrid=function(e,t,i,r,n){THING.Utils.warn("[App] Please use 'app.root.showGrid()' to replace '.app.showGrid()'"),this.root.showGrid(e,t,i,r,n)},e.prototype.getGridSize=function(){return THING.Utils.warn("[App] Please use 'app.root.gridSize' to replace '.app.getGridSize()'"),this.root.gridSize},o(e,[{key:"elapsedTime",get:function(){return Math.floor(1e3*this._elapsedTime)}},{key:"deltaTime",get:function(){return Math.floor(1e3*this._deltaTime)}},{key:"currentFrameCount",get:function(){return this._currentFrame}},{key:"pixelRatio",set:function(e){this._pixelRatio=e,this.renderer.setPixelRatio(e*window.devicePixelRatio)},get:function(){return this._pixelRatio}},{key:"size",get:function(){if(this._size)return this._size;var e=this.calcRect();return[e.width,e.height]},set:function(e){this._size=e,this.resize()}},{key:"selection",get:function(){return this._selection}},{key:"skyEffect",set:function(e){e?this.sceneManager.setSkyEffect(e):this.sceneManager.closeSkyEffect()},get:function(){var e=this.sceneManager._skyEffect;return e&&e.visible?Et.cloneObject(e.getConfig(),!1):null}},{key:"lighting",set:function(e){e=e||pu,this._lightGroup.setConfig(e)},get:function(){return Et.cloneObject(this._lightGroup.getConfig(),!1)}},{key:"fog",set:function(e){e?this.sceneManager.setFog(e):this.sceneManager.closeFog()},get:function(){return this.sceneManager.fogEnable?Et.cloneObject(this.sceneManager._fogConfig,!1):null}},{key:"postEffect",set:function(e){e?this.renderEffects.mergeConfig(e).update():this.renderEffects.mergeConfig({temporalSuperSampling:{enable:!1},postEffect:{enable:!1}}).update()},get:function(){var e=this.renderEffects.getConfig();return e.temporalSuperSampling.enable||e.postEffect.enable?Et.cloneObject(e,!1):null}},{key:"keepBackgroundAspect",set:function(e){e!==this._keepBackgroundAspect&&(this._keepBackgroundAspect=e,e?this.sceneManager._keepBackgroundAspect():this.sceneManager._resetBackgroundAspect())},get:function(){return!!this._keepBackgroundAspect}},{key:"bgColor",get:function(){return this._bgColor?this._bgColor.toHexString():null},set:function(e){this._bgColor=Et.parseColor(e),this.scene.background.isColor&&(this.scene.background=this._bgColor)}},{key:"background",set:function(e){this.sceneManager.background=e},get:function(){var e=this.sceneManager.background;return Et.isNumber(e)?"#"+e.toString(16).toUpperCase():e}},{key:"backgroundAdditiveColor",set:function(e){this.sceneManager.backgroundAdditiveColor=e},get:function(){return this.sceneManager.backgroundAdditiveColor}},{key:"backgroundColorScaleFactor",set:function(e){this.sceneManager.backgroundColorScaleFactor=e},get:function(){return this.sceneManager.backgroundColorScaleFactor}},{key:"skyBox",set:function(e){this.sceneManager&&(this.sceneManager.skyBox=e)},get:function(){return this.sceneManager?this.sceneManager.skyBox:""}},{key:"needUpdate",set:function(e){if(e){if(this._dirtyFrameCount==this._currentFrame)return;this._dirtyFrameCount=this._currentFrame,this.picker&&(this.picker.needUpdate=e),this.rendererManager&&(this.rendererManager.needUpdate=e)}}},{key:"needEffectUpdate",set:function(e){e&&this.rendererManager&&(this.rendererManager.needUpdate=e)}},{key:"loadingProgressBar",get:function(){return this.mainUI.loadingProgressBar}},{key:"useAsLoader",set:function(e){this._useAsLoader=e},get:function(){return this._useAsLoader}},{key:"skipUnbindAppEvents",set:function(e){this._skipUnbindAppEvents=e},get:function(){return this._skipUnbindAppEvents}},{key:"mainDomElement",get:function(){return this.domElement}},{key:"isMobileDevice",get:function(){return void 0!==this._isMobile?this._isMobile:this._isMobile=ht()}},{key:"level",get:function(){return this.sceneLevel}},{key:"root",get:function(){return this.sceneRoot}},{key:"mousePosition",get:function(){return this.events.mousePosition}},{key:"renderOptions",set:function(e){e=e||{},this._renderOptions=e},get:function(){return this._renderOptions}},{key:"campuses",get:function(){return THING.Utils.warn("[App] The 'app.campuses' will be deleted soon, please use 'app.root.campuses' to replace it"),this.root.campuses}},{key:"buildings",get:function(){return THING.Utils.warn("[App] The 'app.buildings' will be deleted soon, please use 'app.root.defaultCampus.buildings' to replace it"),this.root.defaultCampus.buildings}},{key:"disableWarning",set:function(e){THING.Utils.warn("[App] Please use 'Utils.disableWarning' to replace '.disableWarning'"),Et.disableWarning=e}},{key:"disableTime",set:function(e){THING.Utils.warn("[App] Please use 'Utils.disableTime' to replace '.disableTime'"),Et.disableTime=e}},{key:"isShiftKeyPressed",get:function(){return THING.Utils.warn("[App] Please use '.isKeyPressed(THING.KeyType.Shift)' to replace '.isShiftKeyPressed'"),this.events.isKeyPressed(O.Shift)}},{key:"isControlKeyPressed",get:function(){return THING.Utils.warn("[App] Please use '.isKeyPressed(THING.KeyType.Ctrl)' to replace '.isControlKeyPressed'"),this.events.isKeyPressed(O.Ctrl)}},{key:"isAltKeyPressed",get:function(){return THING.Utils.warn("[App] Please use '.isKeyPressed(THING.KeyType.Alt)' to replace '.isAltKeyPressed'"),this.events.isKeyPressed(O.Alt)}},{key:"isMobile",get:function(){return THING.Utils.warn("[App] Please use '.isMobileDevice' to replace '.isMobile'"),this.isMobileDevice}},{key:"wireframeColor",set:function(e){return THING.Utils.warn("[App] Please use '.app.root.wireframeColor' to replace '.wireframeColor'"),this.root.wireframeColor=e}},{key:"domOffset",set:function(e){THING.Utils.warn("[App] domOffset is deprecated")}},{key:"cache",get:function(){return THING.Utils.warn("[App] cache is deprecated"),!1}},{key:"outdoors",set:function(e){},get:function(){return this.root?this.root.defaultCampus.outdoors:null}},{key:"loadingProgressBarVisible",set:function(e){THING.Utils.warn("[App] Please use '.loadingProgressBar.visible = true/false' to replace '.loadingProgressBarVisible=true/false'"),this.mainUI.loadingProgressBar.visible=e},get:function(){return THING.Utils.warn("[App] Please use '.loadingProgressBar.visible' to replace '.loadingProgressBarVisible'"),this.mainUI.loadingProgressBar.visible}},{key:"currentFrame",get:function(){return THING.Utils.warn("[App] Please use '.currentFrameCount' to replace '.currentFrame'"),this.currentFrameCount}}]),e}();Ah.on=Ah.on||{};var kh=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype._init=function(t,i){e.prototype._init.call(this,t,i),this.node.userData.baseObject_bindSubNode=this},t.prototype._updateBindSubNodeState=function(){this.node.userData.baseObject_bindSubNode_hooked=this.hasAnyEvents()},t.prototype._on=function(t,i,r,n,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:51,a=e.prototype._on.call(this,t,i,r,n,o,s);return this._updateBindSubNodeState(),a},t.prototype._off=function(t,i,r){var n=e.prototype._off.call(this,t,i,r);return this._updateBindSubNodeState(),n},t.prototype.canAcceptEvent=function(t){if(e.prototype.canAcceptEvent.call(this,t))return this;var i=t.intersect;return i&&i.node&&i.node==this.node?this:null},t}(Si);kh.create=function(e,t){var i=new kh(t.app);return i._init(e,t),i};var Oh=Symbol("private");function Bh(e,t){e[Oh]={};var i=e[Oh];i.init=function(){var e=t.values;e&&i.addAction("___defaultValue___",e),i.onChange=t.onChange||i.onChange},i.createAction=function(e){var t=i.actions.get(e);return t||(t={name:e,result:{},results:[]},i.actions.set(e,t),t)},i.processActions=function(){var e={};i.actions.forEach((function(t){i.processAction(t,e)})),i.onChange({result:e})},i.processAction=function(e,t){e.results.forEach((function(e){var i=e.options;for(var r in i){var n=i[r];t[r]=n}}))},i.addAction=function(e,t,r,n){var o=i.createAction(e),s={options:t,tag:r,priority:n,index:o.results.length};o.results.push(s),o.results.sort((function(e,t){return e.priority!==t.priority?t.priority-e.priority:e.index-t.index})),i.processActions()},i.removeAction=function(e,t){var r=i.actions.get(e);if(r)for(var n=r.results,o=0;o<n.length;o++){if(n[o].tag==t)return n.splice(o,1),void i.processActions()}},i.actions=new Map,i.onChange=function(){},i.init()}var Fh=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),Bh(this,t)}return e.prototype.add=function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=this[Oh];n.addAction(e,t,i,r)},e.prototype.remove=function(e,t){e&&this[Oh].removeAction(e,t)},e}(),Lh=Symbol("private");var Ih=new THREE.Matrix4,Nh=new THREE.Vector3,Uh=new THREE.Vector2,zh=new THREE.Vector3,Hh=new THREE.Vector3,Vh=new THREE.Vector3,Wh=new THREE.Vector3,Gh=new THREE.Vector3,qh=new THREE.Vector3,Xh=new THREE.Quaternion,Jh=(new THREE.Quaternion,new THREE.Box3),Yh=new THREE.Raycaster,Zh=new THREE.Vector3,Qh=new THREE.Vector3,Kh=new THREE.Quaternion,$h=new THREE.Quaternion,ep=new THREE.Matrix4,tp=new THREE.Matrix4,ip=["clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","map","matcap","alphaMap","lightMap","aoMap","bumpMap","normalMap","displacementMap","roughnessMap","metalnessMap","emissiveMap","specularMap","envMap","gradientMap"],rp={WHITE:16777215,SILVER:12632256,GRAY:8421504,BLACK:0,RED:16711680,MAROON:8388608,GREEN:32768,BLUE:255,NAVY:128,YELLOW:16776960,OLIVE:8421376,FUCHSIA:16711935,MAGENTA:16711935,LIME:914021,PURPLE:8388736,LAWN:3135031,AQUA:65535,CYAN:65535,TEAL:32896,ORANGE:16753920,VIOLET:7737555,GREENYELLOW:6617095,createFrustumFOV:function(e,t,i,r){var n=i*Math.tan(THING.Math.degToRad(e)/2),o=-n,s=t*n,a=-s;return rp.createFrustum(s,a,n,o,i,r)},createFrustum:function(e,t,i,r,n,o){var s=new THREE.Geometry,a=new THREE.LineBasicMaterial({color:16777215,linewidth:3,vertexColors:THREE.FaceColors}),l=o/n,u={ltn:new THREE.Vector3(e,i,n),lbn:new THREE.Vector3(e,r,n),rbn:new THREE.Vector3(t,r,n),rtn:new THREE.Vector3(t,i,n),ltf:new THREE.Vector3(l*e,l*i,o),lbf:new THREE.Vector3(l*e,l*r,o),rbf:new THREE.Vector3(l*t,l*r,o),rtf:new THREE.Vector3(l*t,l*i,o)};function c(e,t,i){h(e,i),h(t,i)}function h(e,t){var i=new THREE.Vector3;i.copy(u[e]),s.vertices.push(i),s.colors.push(new THREE.Color(t))}return c("ltn","lbn",rp.RED),c("lbn","rbn",rp.RED),c("rbn","rtn",rp.RED),c("rtn","ltn",rp.RED),c("ltf","lbf",rp.LIME),c("lbf","rbf",rp.LIME),c("rbf","rtf",rp.LIME),c("rtf","ltf",rp.LIME),c("ltf","ltn",rp.BLUE),c("lbf","lbn",rp.BLUE),c("rbf","rbn",rp.BLUE),c("rtf","rtn",rp.BLUE),new THREE.Line(s,a,THREE.LinePieces)}},np=new Map,op=new Map;function sp(e,t){var i=e.get(t);return i||(i=new RegExp(t),e.set(t,i)),i}function ap(e,t){if(t){var i=op.get(t);return i||(i=new Map,op.set(t,i)),sp(i,e)}return sp(np,e)}function lp(e,t){if("string"!=typeof e)throw new TypeError("expected path to be a string");if("\\"===e||"/"===e)return"/";var i=e.length;if(i<=1)return e;var r="";if(i>4&&"\\"===e[3]){var n=e[2];"?"!==n&&"."!==n||"\\\\"!==e.slice(0,2)||(e=e.slice(2),r="//")}var o=e.split(/[/\\]+/);return!1!==t&&""===o[o.length-1]&&o.pop(),r+o.join("/")}String.prototype.getNormalize=function(){var e=this.indexOf("://");return-1!==e?this.substring(0,e+3)+lp(this.substring(e+3)):lp(this.substring())},String.prototype.startsWith=function(e){return this.slice(0,e.length)===e},String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)},String.prototype.contains=function(e){return this.indexOf(e)>=0},String.prototype.isBlank=function(){return Et.isBlank(this)},String.prototype.getFileName=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");if(-1===t)return e?this:this.split(".")[0];var i=this.substring(t);return 0!==i.indexOf("\\")&&0!==i.indexOf("/")||(i=i.substring(1)),e?i:i.split(".")[0]},String.prototype.getPath=function(){var e=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");return this.substring(0,e)},String.prototype.getSearchName=function(){var e=this.getFileName(),t=e.indexOf("?");return-1===t?"":e.substring(t)},String.prototype.getExtension=function(){var e=this.split(".");if(e.length>1){var t=e.pop(),i=t.indexOf("?");return-1!==i?t.substring(0,i):t}return""},String.prototype._trimLeft=function(e){void 0===e&&(e="s");var t=ap("^["+e+"]+");return this.replace(t,"")},String.prototype._trimRight=function(e){void 0===e&&(e="s");var t=ap("["+e+"]+$");return this.replace(t,"")},String.prototype.trimBoth=function(e){return this._trimLeft(e)._trimRight(e)},String.prototype.appendPath=function(e){return this._trimRight("/")+"/"+e._trimLeft("/")._trimRight("/")},String.prototype.appendURL=function(e){var t=this.getFileName();return t.startsWith("?")?this.getPath().appendPath(e)+t:this.appendPath(e)},String.prototype.appendRandomSuffix=function(){return this.substring()+"?t="+(new Date).getTime()},String.prototype.equals=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return null!=e&&(t?this.toUpperCase()==e.toUpperCase():this==e)},String.prototype.replaceAll=function(e,t){"\\"==e&&(e="\\\\");var i=ap(e,"gm");return this.replace(i,t)},String.prototype.removeAt=function(e){var t=this.substring(0);return e>=this.length?t:t.slice(0,e)+t.slice(e+1)},THREE.Color.prototype.copy=function(e){return e&&(this.r=e.r,this.g=e.g,this.b=e.b),this},THREE.Color.prototype.toHexString=function(){return"#"+this.getHexString().toUpperCase()},THREE.Color.prototype.toRGBArray=function(){var e=[];return e.push(Math.ceil(255*this.r)),e.push(Math.ceil(255*this.g)),e.push(Math.ceil(255*this.b)),e},THREE.Line.prototype.updatePosition=function(e,t){var i=this.geometry.vertices;if(2==i.length){var r=i[0],n=i[1];r.equals(e)&&n.equals(t)||(r.x=e.x,r.y=e.y,r.z=e.z,n.x=t.x,n.y=t.y,n.z=t.z,this.geometry.boundingSphere=null,this.geometry.verticesNeedUpdate=!0,this.computeLineDistances())}};for(var up=function(){var e=THING.App.current?THING.App.current.level.current:null;return e?e._getBaseMatrix():null},cp=[],hp=0;hp<256;hp++)cp[hp]=(hp<16?"0":"")+hp.toString(16).toUpperCase();THREE.MathUtils.generateUUID=function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return cp[255&e]+cp[e>>8&255]+cp[e>>16&255]+cp[e>>24&255]+"-"+cp[255&t]+cp[t>>8&255]+"-"+cp[t>>16&15|64]+cp[t>>24&255]+"-"+cp[63&i|128]+cp[i>>8&255]+"-"+cp[i>>16&255]+cp[i>>24&255]+cp[255&r]+cp[r>>8&255]+cp[r>>16&255]+cp[r>>24&255]},THREE.Vector3.prototype.getPositionFromSpherical=function(e,t,i){var r=new THREE.Vector3,n=Math.sin(i);return r.x=n*Math.cos(t),r.y=-Math.cos(i),r.z=n*Math.sin(t),r.normalize(),r.multiplyScalar(e),r.add(this),r},THREE.Vector3.prototype.getDirectionFromAngles=function(e,t,i){var r=Et.parseVector3(THING.Math.directionFromAlphaBeta(e,t));return r.normalize(),r.multiplyScalar(i),r.add(this),r},THREE.Vector3.prototype.getDirectionFromPosition=function(e,t){var i=new THREE.Vector3;return i.subVectors(e,this),i.normalize(),i.multiplyScalar(t),i.add(this),i},THREE.Vector3.prototype.getMinVector=function(e){var t=this.clone();if(Et.isArray(e))for(var i=0;i<e.length;i++)t.min(e[i]);else t.min(e);return t},THREE.Vector3.prototype.getMaxVector=function(e){var t=this.clone();if(Et.isArray(e))for(var i=0;i<e.length;i++)t.max(e[i]);else t.min(e);return t},THREE.Vector3.prototype.toLogString=function(){return"x: "+this.x+", y: "+this.y+", z: "+this.z},THREE.Vector3.prototype.isEqual=function(e){return!!Et.isNumberEqual(this.x,e.x)&&(!!Et.isNumberEqual(this.y,e.y)&&!!Et.isNumberEqual(this.z,e.z))},THREE.Vector3.prototype.log=function(){THING.Utils.log(this.toLogString())},THREE.Vector4.prototype.project=function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},THREE.Vector4.prototype.unproject=function(e){var t=new THREE.Matrix4;return this.applyMatrix4(t.getInverse(e.projectionMatrix)).applyMatrix4(e.matrixWorld)},THREE.Object3D.prototype.check=function(){for(var e=this;e;e=e.parent)isNaN(e.position.x)||isNaN(e.position.y)||isNaN(e.position.z)?(console.log(e),console.log(e.position)):isNaN(e.scale.x)||isNaN(e.scale.y)||isNaN(e.scale.z)?(console.log(e),console.log(e.scale)):isNaN(e.quaternion.x)||isNaN(e.quaternion.y)||isNaN(e.quaternion.z)?(console.log(e),console.log(e.quaternion)):(isNaN(e.rotation.x)||isNaN(e.rotation.y)||isNaN(e.rotation.z))&&(console.log(e),console.log(e.rotation))},THREE.Object3D.prototype.dispose=function(){var e=this.parent;e&&e.remove(this),this.traverse((function(e){e.geometry&&e.geometry.dispose();var t=e.material;if(t)if(Et.isArray(t))for(var i=0;i<t.length;i++)t[i].dispose();else t.dispose();e.skeleton&&e.skeleton.boneTexture&&e.skeleton.boneTexture.dispose()}))},THREE.Object3D.prototype.getVerticesCount=function(){var e=0;return this.traverse((function(t){t.geometry&&(e+=t.geometry.getVerticesCount())})),e},THREE.Object3D.prototype.getDirection=function(e){var t=this.matrix.elements;return e.set(t[8],t[9],t[10]).normalize()},THREE.Object3D.prototype._premultiplyMatrix=function(e){this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},THREE.Object3D.prototype._mergeAllGeometries=function(){this.updateMatrixWorld();var e=new THREE.Geometry;return this.traverse((function(t){if(t.isMesh){var i=t.geometry;i.isBufferGeometry&&(i=(new THREE.Geometry).fromBufferGeometry(i)),e.merge(i,t.matrixWorld)}})),e},THREE.Object3D.prototype._getMatrixWorld=function(){var e=this.matrixWorld,t=up();return t&&(e=e.clone()).premultiply(t),e},THREE.Object3D.prototype.getBaseObjectOwner=function(){for(var e=this;e;e=e.parent){var t=e.userData.object;if(t)return t}return null};var pp=THREE.Object3D.prototype.copy;THREE.Object3D.prototype.copy=function(e,t){return pp.call(this,e,t),this.technique=Et.cloneObject(e.technique),this._cachedTechnique=Et.cloneObject(e._cachedTechnique),e._wName&&(this._wName=e._wName),this},THREE.Object3D.prototype.setUserDataValue=function(e,t){this.traverse((function(i){i.userData[e]=t}))},THREE.Object3D.prototype.isMaterialVisible=function(){var e=this.material;if(!e)return!1;if(void 0!==e.length){for(var t=0;t<e.length;t++)if(e[0].visible)return!0;return!1}return e.visible},THREE.Object3D.prototype.isRenderable=function(){return!!(this.isSprite||this.isMesh||this.isLine||this.isPoints||this.isImmediateRenderObject)},THREE.Object3D.prototype.isDebuggerNode=function(){for(var e=this;e;){if(e.userData.isDebuggerNode)return!0;e=e.parent}return!1},THREE.Object3D.prototype.cleanup=function(){function e(e){return!e.children.length}function t(i){for(var r=0,n=0;n<i.children.length;n++){var o=i.children[n];o.isRenderable()||(e(o)?(o.parent=null,i.children.splice(n--,1),r++):r+=t(o))}return r}for(;;){if(!t(this))break}},THREE.Object3D.prototype.onBeforeUpdateModelViewMatrix=function(e,t,i,r,n,o){},THREE.Object3D.prototype.hasBeforeRenderFunction=function(e){if(!this._beforeRenderFunctions)return!1;for(var t=0;t<this._beforeRenderFunctions.length;t++){if(this._beforeRenderFunctions[t].name==e)return!0}return!1},THREE.Object3D.prototype.addBeforeRenderFunction=function(e,t,i){if(t&&(this.traverseChild((function(r){r.isRenderable()&&r.addBeforeRenderFunction(e,t,i)})),this._beforeRenderFunctions=this._beforeRenderFunctions||[],void 0!==i&&this._beforeRenderFunctions.length?this._beforeRenderFunctions.splice(i,0,{name:e,func:t}):this._beforeRenderFunctions.push({name:e,func:t}),1===this._beforeRenderFunctions.length)){var r=this.onBeforeRender;r&&"function () {}"!=r.toString()&&this._beforeRenderFunctions.splice(0,0,{name:"__originalBeforeRender__",func:r});var n=this;this.onBeforeRender=function(e,t,i,r,o,s){for(var a=0,l=n._beforeRenderFunctions.length;a<l;a++){n._beforeRenderFunctions[a].func.call(n,e,t,i,r,o,s)}}}},THREE.Object3D.prototype.removeBeforeRenderFunction=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.traverseChild((function(t){t.isRenderable()&&t.removeBeforeRenderFunction(e)})),this._beforeRenderFunctions=this._beforeRenderFunctions||[];for(var i=0;i<this._beforeRenderFunctions.length;i++){var r=this._beforeRenderFunctions[i],n=Et.isFunction(e)?r.func:r.name;n==e&&this._beforeRenderFunctions.splice(i--,1)}this._beforeRenderFunctions.length||(this.onBeforeRender=function(e,t,i){})},THREE.Object3D.prototype.setPickable=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.userData.skipPick=!e,t&&this.traverse((function(t){var i=t.userData;e?delete i.skipPick:i.skipPick=!0}))},THREE.Object3D.prototype.getPickable=function(){return!this.userData.skipPick},THREE.Object3D.prototype.showAll=function(){for(var e=this;e;)e.visible=!0,e=e.parent;this.getNodes().forEach((function(e){e.ensureVisible(!0,!0)}))},THREE.Object3D.prototype.setLayerVisible=function(e){e?this.layers.enable(0):this.layers.disable(0)},THREE.Object3D.prototype.getLayerVisible=function(){return!!(1&this.layers.mask)},THREE.Object3D.prototype.isVisible=function(){for(var e=this;e;e=e.parent)if(!e.visible)return!1;return this.getVisible()},THREE.Object3D.prototype.ensureParentsVisible=function(e){this.traverseParents((function(t){t.visible=e}))},THREE.Object3D.prototype.ensureVisible=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===e){if(this.userData.useVisibleOnly)return this.visible;for(var i=this;i;i=i.parent)if(!i.visible)return!1;return this.getLayerVisible()}if(!Et.isBoolean(e)){var r=this.userData;if(!r.alwaysPickable)for(var n=this;n;){if(!n.visible)return!1;if(e&&!n.layers.test(e.layers))return!1;n=n.parent}return!0}var o=e;this.userData.useVisibleOnly?this.visible=o:(this.setLayerVisible(o),t&&(this.visible=o))},THREE.Object3D.prototype.getVisible=function(){return this.ensureVisible()},THREE.Object3D.prototype.getTypeString=function(){return this.isSprite?"Sprite":this.isMesh?"Mesh":this.isLine?"Line":this.isPoints?"Points":this.isScene?"Scene":this.isGroup?"Group":"Object3D"},THREE.Object3D.prototype.getObjectByUUID=function(e){var t=null;return this.traverseBranch((function(i){if(i.uuid==e)return t=i,!1})),t},THREE.Object3D.prototype.setActive=function(e){this.visible=e},THREE.Object3D.prototype.getActive=function(){return this.visible},THREE.Object3D.prototype.traverseParents=function(e){if(e)for(var t=this.parent;t;t=t.parent)e(t)},THREE.Object3D.prototype.traverseChild=function(e){for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverse(e)},THREE.Object3D.prototype.traverseBreakable=function(e){if(e(this))return this;for(var t=this.children,i=0,r=t.length;i<r;i++){var n=t[i].traverseBreakable(e);if(n)return n}return null},THREE.Object3D.prototype.traverseBranch=function(e){if(!1!==e(this))for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseBranch(e)},THREE.Object3D.prototype.traverseAll=function(e){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseAll(e)},THREE.Object3D.prototype.traverseRenderableNodes=function(e){this.traverse((function(t){t.isRenderable()&&e(t)}))},THREE.Object3D.prototype.getRoot=function(){var e=this.parent;if(!e)return this;for(;e.parent;)e=e.parent;return e},THREE.Object3D.prototype.indexOf=function(e){return e?this.children.indexOf(e):-1},THREE.Object3D.prototype.indexOfParent=function(){var e=this.parent;if(e)return e.children.indexOf(this)},THREE.Object3D.prototype.isChildOf=function(e){for(var t=this.parent;t;){if(t==e)return!0;t=t.parent}return!1},THREE.Object3D.prototype.getChildIndex=function(e){for(var t=0;t<this.children.length;t++)if(this.children[t]==e)return t;return-1},THREE.Object3D.prototype.getIndexPath=function(e){for(var t=[],i=this;i.parent;){var r=i.parent,n=r.getChildIndex(i);if(-1==n)break;if(t.push(n),r==e)break;i=r}return t},THREE.Object3D.prototype.getChildNodeByIndexPath=function(e){for(var t=this,i=0;i<e.length;i++){var r=e[i];if(r>=t.children.length)return null;t=t.children[r]}return t},THREE.Object3D.prototype.getChildNodesNumber=function(){var e=0;return this.traverse((function(){e++})),e},THREE.Object3D.prototype.getBones=function(e,t){for(var i=[],r=0;r<t.bones.length;r++){for(var n=t.bones[r].getIndexPath(e),o=this,s=n.length-1;s>=0;s--){var a=n[s];o=o.children[a]}i.push(o)}return i},THREE.Object3D.prototype._detachFromParent=function(e,t){this.applyMatrix4(e.matrixWorld),e.remove(this),t.add(this)},THREE.Object3D.prototype._attachToParent=function(e,t){this.applyMatrix4((new THREE.Matrix4).getInverse(t.matrixWorld)),e&&e.remove(this),t.add(this)},THREE.Object3D.prototype.attachToParent=function(e,t,i){void 0===t?t=e:Et.isBoolean(t)&&(i=t,t=e),this.parent&&(i&&this.updateWorldMatrix(!0,!1),this._detachFromParent(this.parent,t)),e&&(i&&e.updateWorldMatrix(!0,!1),this._attachToParent(t,e))},THREE.Object3D.prototype.detachFromParent=function(e){this.parent.updateMatrixWorld(),this._detachFromParent(this.parent,e)},THREE.Object3D.prototype.attachChildren=function(e,t){this.updateMatrixWorld();for(var i=0;i<e.length;i++)THREE.SceneUtils.attach(e[i],t,this)},THREE.Object3D.prototype.detachChildren=function(e){this.updateMatrixWorld();for(var t=this.children.concat(),i=0;i<t.length;i++){t[i]._detachFromParent(this,e)}return t},THREE.Object3D.prototype.getChildrenNames=function(){var e=[];return this.traverse((function(t){t.name.isBlank()||e.push(t.name)})),e},THREE.Object3D.prototype.getVisibleChildrenNumber=function(){var e=0;return this.traverse((function(t){t.visible&&e++})),e},THREE.Object3D.prototype.getInvisibleChildrenNumber=function(){var e=0;return this.traverse((function(t){t.visible||e++})),e},THREE.Object3D.prototype.getParents=function(){for(var e=[],t=this.parent;t;t=t.parent)e.push(t);return e},THREE.Object3D.prototype.getInvalidNodes=function(){var e=[];return this.traverse((function(t){var i=t.scale;0!=i.x&&0!=i.y&&0!=i.z||e.push(t)})),e},THREE.Object3D.prototype.getGeometries=function(){var e=new Set;return this.traverse((function(t){var i=t.geometry;i&&e.add(i)})),Array.from(e)},THREE.Object3D.prototype.getVisibleMeshes=function(){var e=[];return this.traverse((function(t){t.isMesh&&t.ensureVisible()&&e.push(t)})),e},THREE.Object3D.prototype.getGroups=function(){var e=[];return this.traverse((function(t){t.isGroup&&e.push(t)})),e},THREE.Object3D.prototype.getMeshes=function(){var e=[];return this.traverse((function(t){t.isMesh&&e.push(t)})),e},THREE.Object3D.prototype.getSprites=function(){var e=[];return this.traverse((function(t){t.isSprite&&e.push(t)})),e},THREE.Object3D.prototype.getRenderableNodes=function(){var e=[];return this.traverse((function(t){t.isRenderable()&&e.push(t)})),e},THREE.Object3D.prototype.getImages=function(){var e=new Set;return this.getMaterials().forEach((function(t){ip.forEach((function(i){var r=t[i];if(r){var n=r.image;n&&(Et.isArray(n)?n.forEach((function(t){e.add(t)})):e.add(n))}}))})),Array.from(e)},THREE.Object3D.prototype.getTextures=function(){var e=new Set;return this.getMaterials().forEach((function(t){Object.keys(t).forEach((function(i){var r=t[i];r&&r.isTexture&&e.add(r)}))})),Array.from(e)},THREE.Object3D.prototype.getTexturesFromImage=function(e){for(var t=[],i=this.getTextures(),r=0;r<i.length;r++){var n=i[r];n.image==e&&t.push(n)}return t},THREE.Object3D.prototype.getTexturesFromURL=function(e){for(var t=[],i=this.getTextures(),r=0;r<i.length;r++){var n=i[r];n.image.currentSrc==e&&t.push(n)}return t},THREE.Object3D.prototype.traverseMaterials=function(e){this.traverse((function(t){var i=t.material;if(i)if(Et.isArray(i))for(var r=0;r<i.length;r++)e(i[r]);else e(i)}))},THREE.Object3D.prototype.traverseTextures=function(e){this.traverse((function(t){var i=t.material;if(i)if(Et.isArray(i))for(var r=0;r<i.length;r++)for(var n in i[r]){(o=i[r][n])&&o.isTexture&&e(i[r],n,o)}else for(var n in i){var o;(o=i[n])&&o.isTexture&&e(i,n,o)}}))},THREE.Object3D.prototype.getMaterials=function(){var e=new Set;return this.traverse((function(t){var i=t.material;i&&(Et.isArray(i)?i.forEach((function(t){e.add(t)})):e.add(i))})),Array.from(e)},THREE.Object3D.prototype.getMeshByName=function(e){var t=null;return this.traverseBreakable((function(i){if(i.isMesh&&i.name==e)return t=i,!0})),t},THREE.Object3D.prototype.hasMesh=function(){var e=!1;return this.traverseBreakable((function(t){if(t.isMesh)return e=!0})),e},THREE.Object3D.prototype.getMeshNames=function(){var e=[];return this.traverse((function(t){t.isMesh&&e.push(t.name)})),e},THREE.Object3D.prototype.getSkinnedMeshes=function(){var e=[];return this.traverse((function(t){t.isSkinnedMesh&&e.push(t)})),e},THREE.Object3D.prototype.hasSkinnedMesh=function(){var e=!1;return this.traverseBreakable((function(t){if(t.isSkinnedMesh)return e=!0})),e},THREE.Object3D.prototype.hasSprite=function(){var e=!1;return this.traverseBreakable((function(t){if(t.isSprite)return e=!0})),e},THREE.Object3D.prototype.hasMaterial=function(e){if(!e)return!1;var t=!1;return this.traverseBreakable((function(i){if(i.material==e)return t=!0})),t},THREE.Object3D.prototype.hasGeometry=function(e){if(!e)return!1;var t=!1;return this.traverseBreakable((function(i){if(i.geometry==e)return t=!0})),t},THREE.Object3D.prototype.hasTexture=function(e){if(!e)return!1;function t(t){for(var i=Object.keys(t),r=0;r<i.length;r++){var n=t[i[r]];if(n&&n.isTexture&&n==e)return!0}return!1}var i=!1;return this.traverseBreakable((function(e){var r=e.material;if(r)if(Et.isArray(r)){if(t(r))return i=!0}else if(t(r))return i=!0})),i},THREE.Object3D.prototype.replace=function(e,t,i){if(t&&t.isObject3D)for(var r=0;r<this.children.length;r++){var n=this.children[r];if(n==e){i&&i(n),n=void 0,t.parent=this,this.children[r]=t;break}}},THREE.Object3D.prototype.insert=function(e,t){e>this.children.length||t&&(this.children.splice(e,0,t),t.parent=this)},THREE.Object3D.prototype.removeBySelf=function(){this.parent&&this.parent.remove(this)},THREE.Object3D.prototype.getAngles=function(){return Et.parseAngles(this.rotation)},THREE.Object3D.prototype.setAngles=function(e){var t=Et.parseEuler(e);this.rotation.copy(t),this.updateMatrixWorld(!1,!1)},THREE.Object3D.prototype.getFacesNumber=function(){var e=0;return this.traverse((function(t){if(t.isMesh){var i=t.geometry;if(i.isBufferGeometry){var r=i.index;e+=r?r.count/3:i.attributes.position.count/3}else i.isGeometry&&(e+=i.faces.length)}})),e},THREE.Object3D.prototype.getVerticesNumber=function(){var e=0;return this.traverse((function(t){if(t.isMesh){var i=t.geometry;if(i.isBufferGeometry){var r=i.index;e+=r?i.index.count:i.attributes.position.count}else i.isGeometry&&(e+=i.vertices.length)}})),e},THREE.Object3D.prototype.getNodes=function(){var e=[];return this.traverse((function(t){e.push(t)})),e},THREE.Object3D.prototype.getNodeByName=function(e){var t;return this.traverseBreakable((function(i){if(i.name==e)return t=i,!0})),t},THREE.Object3D.prototype.getNodeByID=function(e){var t;return this.traverseBreakable((function(i){if(i.id==e)return t=i,!0})),t},THREE.Object3D.prototype.getNodeByUUID=function(e){var t;return this.traverseBreakable((function(i){if(i.uuid==e)return t=i,!0})),t},THREE.Object3D.prototype.getParent=function(){return this.parent},THREE.Object3D.prototype.setTransform=function(e){var t=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Quaternion;e.decompose(t,r,i),this.quaternion.copy(r),this.position.copy(t),this.scale.copy(i)},THREE.Object3D.prototype.getDistanceFromCamera=function(e){if(this.parent){this.updateWorldMatrix(!0);var t=new THREE.Vector3;return this.getWorldPosition(t),e.distanceTo(t)}},THREE.Object3D.prototype.keepSize=function(e,t,i,r,n,o){if(this.parent){r&&this.updateWorldMatrix(!0,!1);var s=new THREE.Vector3;s.setFromMatrixPosition(this.matrixWorld).applyMatrix4(o);var a=-s.z;if(t.isVector2){var l=[i/t.x,i/t.y];this.scale.set(a/l[0],a/l[1],1)}else if(t.isVector3){l=[i/t.x,i/t.y,i/t.z];this.scale.set(a/l[0],a/l[1],a/l[2])}n&&this._synMatrixWorld()}},THREE.Object3D.prototype._synMatrixWorld=function(){this.updateWorldMatrix(!0,!0)},THREE.Object3D.prototype._getWorldPosition=function(e){return void 0===e&&(e=new THREE.Vector3),e.setFromMatrixPosition(this._getMatrixWorld())},THREE.Object3D.prototype._setWorldPosition=function(e,t){Zh.copy(e),this.parent&&(this.parent.updateWorldMatrix(!0),this.parent.worldToLocal(Zh)),this.position.copy(Zh),t&&this._synMatrixWorld()},THREE.Object3D.prototype._setWorldQuaternion=function(e){Kh.copy(e),this.parent&&(this.parent.updateWorldMatrix(!0),this.parent.matrixWorld.decompose(Zh,$h,Zh),$h.inverse(),Kh.premultiply($h)),this.quaternion.copy(Kh)},THREE.Object3D.prototype._setWorldAngles=function(e,t){this.parent&&(this.updateWorldMatrix(!0,!1),this.parent.matrixWorld.decompose(Hh,Xh,qh),Xh.inverse(),e.premultiply(Xh)),this.quaternion.copy(e),t&&this._synMatrixWorld()},THREE.Object3D.prototype._setWorldScale=function(e,t){this.parent?(this.updateWorldMatrix(!0),this.matrixWorld.decompose(Qh,Kh,Zh),Zh.copy(e),tp.compose(Qh,Kh,Zh),ep.getInverse(this.parent.matrixWorld),tp.premultiply(ep),tp.decompose(Qh,Kh,Zh)):Zh.copy(e),this.scale.copy(Zh),t&&this._synMatrixWorld()},THREE.Object3D.prototype._getWorldScale=function(){this.updateWorldMatrix(!0,!1);var e=new THREE.Vector3,t=new THREE.Quaternion,i=new THREE.Vector3;return this.matrixWorld.decompose(e,t,i),i},THREE.Object3D.prototype.cloneByFilter=function(e){for(var t=this.clone(!1),i=0;i<this.children.length;i++){var r=this.children[i];if(!e||e(r)){var n=r.cloneByFilter(e);t.add(n)}}return t},THREE.Object3D.prototype.getForwardPosition=function(e){var t=new THREE.Vector3;return this.updateMatrixWorld(!0),this.getWorldDirection(t),t.normalize(),t.multiplyScalar(e),t.add(this.position),t},THREE.Object3D.prototype._faceTo=function(e){var t=this.worldToLocal(e.clone()),i=(new THREE.Vector3).crossVectors(new THREE.Vector3(0,0,1),t).normalize(),r=new THREE.Vector3(0,0,1).angleTo(t.normalize().clone());this.rotateOnAxis(i,r)},THREE.Object3D.prototype._lookAtPosition=function(e,t){var i=(e=e||{}).type,r=e.axis,n=e.quat,o=e.target,s=e.targetPosition,a=e.targetLocalPosition;if("axis"==i&&"y"==r){e.billboard&&(this.rotation.x=0,this.rotation.z=0);var l=this.position;if(o&&o.isCameraController){var u=Et.parseVector3(s),c=new THREE.Vector3;this.getWorldPosition(c);var h=o.direction,p=c.clone().sub(u).projectOnPlane(Et.parseVector3(h));p.add(u),this.parent&&this.parent.worldToLocal(p),this.rotation.y=Math.atan2(p.x-l.x,p.z-l.z)}else this.rotation.y=Math.atan2(a.x-l.x,a.z-l.z)}else this.isCamera||!o||o.isCameraController||this.up.copy(new THREE.Vector3(0,1,0).transformDirection(this.matrixWorld)),this.lookAt(s),"axis"==i&&("x"==r?this.rotateY(-Math.PI/2):"z"==r&&this.rotateX(-Math.PI/2));n&&this.quaternion.multiply(n),t?this._synMatrixWorld():this.updateWorldMatrix(!1,!1)},THREE.Object3D.prototype._lookAt=function(e,t){if(this.removeBeforeRenderFunction("__lookAt__"),e){var i=this;this.addBeforeRenderFunction("__lookAt__",(function(r,n,o,s,a,l){var u=e.targetPosition||o;u.isObject3D&&(u=u.position),e.targetPosition=u,e.target={direction:o.getDirection(new THREE.Vector3),isCameraController:!0},i._lookAtPosition(e,Et.isFunction(t)?t():t)}))}},THREE.Object3D.prototype.skipBoundingBox=function(e){this.traverse((function(t){e?t.userData.skipBoundingBox=e:delete t.userData.skipBoundingBox}))},THREE.Object3D.prototype.setFrustumCulled=function(e){this.traverse((function(t){t.frustumCulled=e}))},THREE.Object3D.prototype.getMatrixWorldFromRoot=function(e){this.updateWorldMatrix(!0);var t=new THREE.Matrix4;if(e)for(var i=this;;){if(i==e){t.premultiply(i.matrixWorld);break}t.premultiply(i.matrix),i=i.parent}return t},THREE.Object3D.prototype.getMatrixFromRoot=function(e){var t=new THREE.Matrix4;if(e)for(var i=this;i!=e;)i.updateMatrix(),t.premultiply(i.matrix),i=i.parent;return t},THREE.Object3D.prototype.disposeMaterial=function(){if(this.material){if(Et.isArray(this.material))for(var e=0;e<this.material.length;e++){this.material[e].dispose()}else this.material.dispose();this.material=null}},THREE.Object3D.prototype.decomposeTransform=function(e,t,i){return this.matrix.decompose(e,t,i),this},THREE.Object3D.prototype.decomposeWorldTransform=function(e,t,i){return this.updateWorldMatrix(!0),this.matrixWorld.decompose(e,t,i),this},THREE.Matrix4.prototype.setScale=function(e){var t=this.elements;return t[0]=e.x,t[5]=e.y,t[10]=e.z,this},THREE.Euler.prototype.multiplyMatrix4=function(e){var t=new THREE.Quaternion;t.setFromEuler(this);var i=new THREE.Quaternion;i.setFromRotationMatrix(e),t.multiply(i),this.setFromQuaternion(t)},THREE.Euler.prototype.setRotationOrder=function(e){var t=new THREE.Quaternion;t.setFromEuler(this,!1),this.setFromQuaternion(t,e,!0)},THREE.Quaternion.prototype.multiplyMatrix4=function(e){var t=new THREE.Quaternion;t.setFromRotationMatrix(e),this.multiply(t)},THREE.Quaternion.prototype.getAngles=function(){return Et.parseAngles(this)},THREE.Frustum.prototype._intersectsObject=function(e){var t=this;return e=e.traverseBreakable((function(e){return e.isMesh&&t.intersectsObject(e)?e:null}))},THREE.PerspectiveCamera.prototype.orthoSize=function(e,t){var i=Et.parseVector3(t),r=e.distanceTo(i),n=2*Math.tan(this.fov/2*Math.PI/180),o=n*r;return{x:o*this.aspect,y:o,depth:n,z:r}},THREE.OrthographicCamera.prototype.orthoSize=function(){return{x:(this.right-this.left)/this.zoom,y:(this.top-this.bottom)/this.zoom}},THREE.OrthographicCamera.prototype.resize=function(e,t){if(void 0!==this.userData){var i=this.userData.depth*this.userData.z,r=i*(e/t);this.left=-r/2,this.right=r/2,this.top=i/2,this.bottom=-i/2,this.updateProjectionMatrix()}},Object.defineProperty(THREE.CombinedCamera.prototype,"isPerspectiveCamera",{get:function(){return this.inPerspectiveMode}}),Object.defineProperty(THREE.CombinedCamera.prototype,"isOrthographicCamera",{get:function(){return this.inOrthographicMode}}),Object.defineProperty(THREE.CombinedCamera.prototype,"isLerping",{get:function(){return this.isPerspectiveLerping||this.isOrthoLerping}}),THREE.CombinedCamera.prototype.getRaycaster=function(e,t,i){return Yh._setFromCamera(e,t,this,i)},THREE.CombinedCamera.prototype.setNear=function(e){this.cameraP.near=e,this.cameraO.near=e,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.setFar=function(e){this.cameraP.far=e,this.cameraO.far=e,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.getProjectionMatrixAlways=function(){return this._backupProjectionMatrix&&(this.isOrthoLerping||this.isOrthographicCamera)?this._backupProjectionMatrix:this.projectionMatrix},THREE.CombinedCamera.prototype.toPerspectiveCamera=function(){var e=new THREE.CombinedCamera(1,1,1,1,1,1,1);return e.fov=this.fov,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.cameraO=new THREE.OrthographicCamera(1,1,1,1,1,1),e.cameraO.copy(this.cameraO),e.cameraP=new THREE.PerspectiveCamera(1,1,1,1),e.cameraP.copy(this.cameraP),e.zoom=this.zoom,e.toPerspective(),e},THREE.CombinedCamera.prototype.toOrthoCamera=function(e,t){var i=this.cameraP.orthoSize(e,t),r=new THREE.CombinedCamera(i.x,i.y,this.fov,this.near,this.far,this.cameraO.near,this.cameraO.far);return r.orthoSize=i,r.toOrthographic(),r},THREE.CombinedCamera.prototype.lerpMatrix=function(e){var t=(e=e||{}).fromMatrix,i=e.toMatrix,r=e.time,n=e.lerpType||S.Quintic.Out,o=e.start,s=e.stop,a=e.complete,l=Et.toMatrixElementsArray(t),u=Et.toMatrixElementsArray(i);this.matrixTween&&this.matrixTween.stop(),this.matrixTween=new TWEEN.Tween(l).to(u,r).easing(n).onStart((function(){o&&o()})).onUpdate((function(){Et.elementsArrayToMatrix(t,this._object)})).onStop((function(){s&&s()})).onComplete((function(){a&&a()})).start()},THREE.CombinedCamera.prototype.lerpToOrthographic=function(e,t,i,r){var n=this.toOrthoCamera(e,t);this.orthoSize=n.orthoSize,this.zoom=1,this.isOrthoLerping=!0,this._backupProjectionMatrix=this.projectionMatrix.clone();var o=this;this.lerpMatrix({lerpType:S.Cubic.InOut,fromMatrix:this.projectionMatrix,toMatrix:n.projectionMatrix,time:i,stop:function(){o.isOrthoLerping=!1,r&&r()},complete:function(){o.isOrthoLerping=!1,o.toOrthographic(),r&&r()}})},THREE.CombinedCamera.prototype.lerpToPerspective=function(e,t){var i=this.toPerspectiveCamera();this.isPerspectiveLerping=!0;var r=this;this.lerpMatrix({fromMatrix:this.projectionMatrix,toMatrix:i.projectionMatrix,time:e,stop:function(){r.isPerspectiveLerping=!1,t&&t()},complete:function(){r.isPerspectiveLerping=!1,r.toPerspective(),t&&t()}})},THREE.CombinedCamera.prototype.getEffectiveFOV=function(){return this.cameraP.getEffectiveFOV()},THREE.CombinedCamera.prototype.isInView=function(e){var t=new THREE.Matrix4;t.multiplyMatrices(this.projectionMatrix,this.matrixWorldInverse);var i=new THREE.Frustum;return i.setFromProjectionMatrix(t),i.intersectsBox(e)},THREE.CombinedCamera.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&this.matrixWorld.copy(this.matrix);var t=up();t&&this.matrixWorld.premultiply(t),this.matrixWorldInverse.getInverse(this.matrixWorld)},THREE.Mesh.prototype.verticesCount=function(){return this.geometry?this.geometry.isBufferGeometry?this.geometry.attributes.position.count:this.geometry.vertices.length:0},THREE.Mesh.prototype.simplify=function(e){var t=THING.Math.clamp(e,0,1),i=new THREE.SimplifyModifier,r=this.geometry;r instanceof THREE.BufferGeometry&&(r=(new THREE.Geometry).fromBufferGeometry(r)),r.mergeVertices();var n=THING.Math.toInteger(r.vertices.length*(1-t)),o=i.modify(r,n);return new THREE.Mesh(o,this.material)},THREE.Mesh.prototype.getPerimeter=function(){var e=0,t=this.geometry.attributes;if(t){var i=t.position;if(i.count<2)return 0;for(var r=new THREE.Vector2(i.getX(0),i.getZ(0)),n=1;n<i.count;n++){e+=(s=new THREE.Vector2(i.getX(n),i.getZ(n))).distanceTo(r),r=s}e+=r.distanceTo(new THREE.Vector2(i.getX(0),i.getZ(0)))}else{var o=this.geometry.vertices;if(o.length<2)return 0;for(r=new THREE.Vector2(o[0].x,o[0].y),n=1;n<o.length;n++){var s;e+=(s=new THREE.Vector2(o[n].x,o[n].y)).distanceTo(r),r=s}e+=r.distanceTo(new THREE.Vector2(o[0].x,o[0].y))}return e},THREE.Mesh.prototype.getArea=function(){var e=[],t=this.geometry.attributes;if(t)for(var i=t.position,r=0;r<i.count;r++){var n=new THREE.Vector2(i.getX(r),i.getZ(r));e.push(n)}else{var o=this.geometry.vertices;for(r=0;r<o.length;r++){n=new THREE.Vector2(o[r].x,o[r].y);e.push(n)}}var s=THREE.ShapeUtils.area(e);return Math.abs(s)},THREE.Mesh.prototype.getPoints=function(){var e=[],t=this.geometry.attributes;if(t)for(var i=t.position,r=0;r<i.count;r++){(o=new THREE.Vector3(i.getX(r),i.getY(r),i.getZ(r))).applyMatrix4(this.matrixWorld),e.push(o.toArray())}else{var n=this.geometry.vertices;if(n)for(r=0;r<n.length;r++){var o;(o=n[r].clone()).applyMatrix4(this.matrixWorld),e.push(o.toArray())}}return e},THREE.Mesh.prototype.getLabelPosition=function(e,t){var i=[];if(this.geometry.attributes)for(var r=this.geometry.attributes.position,n=0;n<r.count;n++)"xy"==t?i.push([r.getX(n),r.getY(n)]):i.push([r.getX(n),r.getZ(n)]);else for(n=0;n<this.geometry.vertices.length;n++){var o=this.geometry.vertices[n];"xy"==t?i.push([o.x,o.y]):i.push([o.x,o.z])}if(!i.length)return null;if(i.length>1){var s=[0,0];for(n=0;n<i.length;n++){var a=i[n];s[0]|=!!a[0],s[1]|=!!a[1]}if(!s[0]||!s[1])return null}var l=[];if(l.push(i),e&&0!=e.length)for(n=0;n<e.length;n++){var u=[e[n][0],e[n][1],e[n][2],e[n][3]];l.push(u)}var c,h=new polylabel(l);return c="xy"==t?this.localToWorld(new THREE.Vector3(h[0],h[1],0)):this.localToWorld(new THREE.Vector3(h[0],0,h[1])),this.getRayCastPosition(c)},THREE.Mesh.prototype.getAvaliableLabelPosition=function(e,t,i){var r=function(e,t,i){var r=e[0],n=t[0],o=e[1],s=t[1],a=Math.max(r,i.l);if(a>n||a>i.r)return!1;var l=Math.min(n,i.r);if(l<r||l<i.l)return!1;var u=Math.max(o,i.t);if(u>s||u>i.b)return!1;var c=Math.min(s,i.b);return!(c<o||c<i.t)},n=function(e,t,i,n,o){for(var s=i.x,a="xy"==o?i.y:i.z,l=[s-n[0],a-n[1]],u=[s+n[0],a+n[1]],c=0;c<e.length;c++){var h=e[c],p=t[c],d=h.x,f="xy"==o?h.y:h.z,m=p[0]/2,g=p[1]/2;if(r(l,u,{l:d-m,t:f-g,r:d+m,b:f+g}))return!0}return!1};this.updateMatrixWorld();var o=new THREE.Matrix4;if(o.getInverse(this.matrixWorld),i&&i.length&&i.length%4)return THING.Utils.error("The hole points number must arrange by 4"),null;for(var s=[],a=0;a<i.length;a+=4){var l=Et.parseVector3(i[a]).applyMatrix4(o),u=Et.parseVector3(i[a+1]).applyMatrix4(o),c=Et.parseVector3(i[a+2]).applyMatrix4(o),h=Et.parseVector3(i[a+3]).applyMatrix4(o);l=[l.x,l.y],u=[u.x,u.y],c=[c.x,c.y],h=[h.x,h.y],s.push([l,u,c,h])}var p=[],d=[];for(a=0;a<e.length;a++){var f=e[a],m=f[0]/2,g=f[1]/2;if(0!=m&&0!=g){var v=this.getLabelPosition(s,t);if(!v)break;var y=v.clone();y.applyMatrix4(o),n(p,e,y,[m,g],t)||(d.push(v),p.push(y));var b=y.x,_="xy"==t?y.y:y.z;l=[b-m,_-g],u=[b+m,_-g],c=[b+m,_+g],h=[b-m,_+g];s.push([l,u,c,h])}}return d},THREE.Mesh.prototype.getRayCastPosition=function(e){this.updateMatrixWorld();var t=e.clone();this.worldToLocal(t);var i=t.clone();i.z--,this.localToWorld(t),this.localToWorld(i);var r=new THREE.Vector3;r.subVectors(i,t),r.normalize();var n=e.clone();n.add(r.clone().multiplyScalar(-1e3));var o=new THREE.Raycaster;o.ray.origin.copy(n),o.ray.direction.copy(r);var s=o.intersectObjectForcible(this,!0);return s.length?s[0].point:null},THREE.LOD.prototype.setLevel=function(e){if(!(e>=this.levels.length)){for(var t=0;t<this.levels.length;t++)this.levels[t].object.visible=!1;this.levels[e].object.visible=!0}},THREE.Raycaster.prototype._setFromCamera=function(e,t,i,r){return void 0===e&&void 0===t?(zh.subVectors(r,i.position),zh.normalize(),this.set(i.position,zh)):(Uh.x=e/r.width*2-1,Uh.y=-t/r.height*2+1,this.setFromCamera(Uh,i)),this},THREE.Raycaster.prototype.clone=function(){return new THREE.Raycaster(this.ray.origin.clone(),this.ray.direction.clone())},THREE.Raycaster.prototype._intersectObjectForcible=function(e,t,i,r){if(e.raycast(t,i),!0===r)for(var n=e.children,o=0,s=n.length;o<s;o++)this._intersectObjectForcible(n[o],t,i,!0)},THREE.Raycaster.prototype.intersectObjectForcible=function(e,t,i){var r=i||[];return this._intersectObjectForcible(e,this,r,t),r.sort((function(e,t){return e.distance-t.distance})),r},THREE.Raycaster.prototype.intersectEnsureVisibleObject=function(e,t,i,r){if(!1!==e.ensureVisible(r)&&(e.raycast(this,t),!0===i))for(var n=e.children,o=0,s=n.length;o<s;o++)this.intersectEnsureVisibleObject(n[o],t,!0,r)},THREE.Raycaster.prototype.intersectEnsureVisibleObjects=function(e,t,i){var r=[];if(!1===Array.isArray(e))return THING.Utils.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var n=0,o=e.length;n<o;n++)this.intersectEnsureVisibleObject(e[n],r,t,i);return r.sort((function(e,t){return e.distance-t.distance})),r},THREE.Raycaster.prototype.intersectCollisionObjects=function(e,t,i){var r=[];return function e(t,i,r,n,o){if(!1!==t.visible&&t.layers.test(n.layers)){t.raycast(i,r);for(var s=t.children,a=0,l=s.length;a<l;a++)e(s[a],i,r,n)}}(e,this,r,t),r.sort(ascSort),r},THREE.Geometry.prototype.getVerticesCount=function(){return this.vertices.length},THREE.Geometry.prototype.genFaceVertexUVs=function(){this.computeFaceNormals(),this.computeVertexNormals(),this.computeBoundingBox();for(var e=this.boundingBox.max,t=this.boundingBox.min,i=new THREE.Vector2(0-t.x,0-t.y),r=new THREE.Vector2(e.x-t.x,e.y-t.y),n=this.faces,o=[],s=0;s<n.length;s++){var a=this.vertices[n[s].a],l=this.vertices[n[s].b],u=this.vertices[n[s].c],c=new THREE.Vector2((a.x+i.x)/r.x,(a.y+i.y)/r.y),h=new THREE.Vector2((l.x+i.x)/r.x,(l.y+i.y)/r.y),p=new THREE.Vector2((u.x+i.x)/r.x,(u.y+i.y)/r.y);o.push([c,h,p])}for(s=0;s<this.faceVertexUvs.length;s++)this.faceVertexUvs[s]=o.concat();this.uvsNeedUpdate=!0,this.elementsNeedUpdate=!0},THREE.Scene.prototype.verticesCount=function(){var e=0;return this.traverse((function(t){t.isMesh&&(e+=t.verticesCount())})),e},THREE.AnimationMixer.prototype.isRunning=function(e){for(var t=this._actions,i=this._nActiveActions,r=0;r!==i;++r){var n=t[r];if(e){var o=n.getClip();if(o&&e!=o.name)continue}if(n.isRunning())return!0}return!1},THREE.AnimationMixer.prototype.log=function(){for(var e=this.stats,t=0;t<this._actions.length;t++){var i=this._actions[t],r=i.getClip(),n=i.getEffectiveWeight();0!=n&&THING.Utils.log("action: [name: "+r.name+", weight: "+n+"]")}THING.Utils.log("action: "+e.actions.inUse+"/"+e.actions.total),THING.Utils.log("bindings: "+e.bindings.inUse+"/"+e.bindings.total),THING.Utils.log("controlInterpolants: "+e.controlInterpolants.inUse+"/"+e.controlInterpolants.total)},THREE.Material.prototype._isCloned=function(){return!!this._origin_material},THREE.Material.prototype._getOriginal=function(){var e=this._origin_material;return e||this},THREE.Material.prototype._getPrevMaterial=function(){var e=this._prev_material;return e||this._getOriginal()},THREE.Material.prototype._pushAndCloneSelf=function(){var e=this.clone();return e._origin_material=this._getOriginal(),e._prev_material=this,e},THREE.Material.prototype._pop=function(){var e=this.__materialsQueue__;if(e&&e.length){for(;e.length;){e[e.length-1].dispose(),e.splice(e.length-1,1)}e.length||delete this.__materialsQueue__}};var dp=THREE.Material.prototype.copy;THREE.Material.prototype.copy=function(e){return dp.call(this,e),this.defines=void 0!==e.defines?JSON.parse(JSON.stringify(e.defines)):void 0,this.isMeshStandardMaterial||this.defines&&""==this.defines.STANDARD&&delete this.defines.STANDARD,this.__texture=e.__texture,this._replace_map=e._replace_map,this._replace_alphaMap=e._replace_alphaMap,this._origin_material=e._origin_material,this},THREE.Material.prototype.getTextures=function(){var e=new Set;for(var t in this){var i=this[t];i&&i.isTexture&&e.add(i)}return Array.from(e)},THREE.Box3.prototype.getIntersection=function(e){var t=new THREE.Box3;return this.intersectsBox(e)&&(t.min.x=Math.max(this.min.x,e.min.x),t.max.x=Math.min(this.max.x,e.max.x),t.min.y=Math.max(this.min.y,e.min.y),t.max.y=Math.min(this.max.y,e.max.y),t.min.z=Math.max(this.min.z,e.min.z),t.max.z=Math.min(this.max.z,e.max.z)),t},THREE.Box3.prototype.expandByGeometry=function(e,t){return e.boundingBox||e.computeBoundingBox(),Jh.copy(e.boundingBox),t&&Jh.applyMatrix4(t),this.union(Jh),this},THREE.Box3.prototype._setFromObject=function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];r&&this.makeEmpty(),e.updateWorldMatrix(!0,!0);var n=this;e.getWorldPosition(Hh);var o=!1;e.traverse((function(e){if(!t||!1!==t(e)){e.userData.forceBoundingBox&&(e.getWorldPosition(Vh),i&&Vh.applyMatrix4(i),n.expandByPoint(Vh),o=!0);var r=e.userData.boundingBoxSize;if(r){var s=THING.Math.scaleVector(r,.5);Vh.fromArray(THING.Math.negVector(s)),Wh.fromArray(s),Jh.set(Vh,Wh);var a={x:0,y:0,z:0},l=e.userData.boundingBoxPivot;l&&(a.x=r[0]*(l[0]-.5),a.y=r[1]*(l[1]-.5),a.z=r[2]*(l[2]-.5)),Jh.getBoundingPositions().forEach((function(t){t.add(a),t.applyMatrix4(e.matrixWorld),i&&t.applyMatrix4(i),n.expandByPoint(t),o=!0}))}var u=e.geometry;u&&(i?(Ih.multiplyMatrices(i,e.matrixWorld),n.expandByGeometry(u,Ih)):n.expandByGeometry(u,e.matrixWorld),o=!0)}})),o||t&&!t(e)&&(o=!0),o||(i&&Hh.applyMatrix4(i),this.expandByPoint(Hh)),this.getSize(Gh);var s=1e-8;return 0==Gh.x&&(this.min.x-=s,this.max.x+=s),0==Gh.y&&(this.min.y-=s,this.max.y+=s),0==Gh.z&&(this.min.z-=s,this.max.z+=s),this},THREE.Box3.prototype.getBoundingPositions=function(){var e=this.min,t=this.max;return[new THREE.Vector3(e.x,e.y,e.z),new THREE.Vector3(t.x,e.y,e.z),new THREE.Vector3(e.x,e.y,t.z),new THREE.Vector3(t.x,e.y,t.z),new THREE.Vector3(e.x,t.y,e.z),new THREE.Vector3(t.x,t.y,e.z),new THREE.Vector3(e.x,t.y,t.z),new THREE.Vector3(t.x,t.y,t.z)]},THREE.OrbitControls.prototype.setObject=function(e){this.object=e},THREE.OrbitControls.prototype.getObject=function(){return this.object},THREE.OrbitControls.prototype.getPosition=function(){return this.object.position},THREE.OrbitControls.prototype.setPosition=function(e){this.object.position.copy(e)},THREE.OrbitControls.prototype.setTarget=function(e){this.target.copy(e)},THREE.OrbitControls.prototype.getTarget=function(){return this.target},THREE.OrbitControls.prototype.clone=function(){var e=new THREE.OrbitControls(this.object,this.domElement);return e.enabled=this.enabled,e.target=this.target.clone(),e.minDistance=this.minDistance,e.maxDistance=this.maxDistance,e.minZoom=this.minZoom,e.maxZoom=this.maxZoom,e.minPolarAngle=this.minPolarAngle,e.maxPolarAngle=this.maxPolarAngle,e.minAzimuthAngle=this.minAzimuthAngle,e.maxAzimuthAngle=this.maxAzimuthAngle,e.enableDamping=this.enableDamping,e.dampingFactor=this.dampingFactor,e.enableZoom=this.enableZoom,e.zoomSpeed=this.zoomSpeed,e.zoomFactor=this.zoomFactor,e.enableRotate=this.enableRotate,e.rotateSpeed=this.rotateSpeed,e.enablePan=this.enablePan,e.panSpeed=this.panSpeed,e.screenSpacePanning=this.screenSpacePanning,e.keyPanSpeed=this.keyPanSpeed,e.autoRotate=this.autoRotate,e.autoRotateSpeed=this.autoRotateSpeed,e.enableKeys=this.enableKeys,e.target0=this.target0.clone(),e.position0=this.position0.clone(),e.zoom0=this.zoom0,e},THREE.EarthOrbitControls.prototype.setObject=function(e){this.object=e},THREE.EarthOrbitControls.prototype.getObject=function(){return this.object},THREE.EarthOrbitControls.prototype.getPosition=function(){return this.object.position},THREE.EarthOrbitControls.prototype.setPosition=function(e){this.object.position.copy(e)},THREE.EarthOrbitControls.prototype.setTarget=function(e){this.target.copy(e)},THREE.EarthOrbitControls.prototype.getTarget=function(){return this.target},THREE.EarthOrbitControls.prototype.clone=function(){var e=new THREE.EarthOrbitControls(this.object,this.domElement);return e.enabled=this.enabled,e.isEarth=this.isEarth,e.target=this.target.clone(),e.minDistance=this.minDistance,e.maxDistance=this.maxDistance,e.minZoom=this.minZoom,e.maxZoom=this.maxZoom,e.minPolarAngle=this.minPolarAngle,e.maxPolarAngle=this.maxPolarAngle,e.minAzimuthAngle=this.minAzimuthAngle,e.maxAzimuthAngle=this.maxAzimuthAngle,e.enableDamping=this.enableDamping,e.dampingFactor=this.dampingFactor,e.enableZoom=this.enableZoom,e.zoomSpeed=this.zoomSpeed,e.zoomFactor=this.zoomFactor,e.enableRotate=this.enableRotate,e.rotateSpeed=this.rotateSpeed,e.enablePan=this.enablePan,e.panSpeed=this.panSpeed,e.screenSpacePanning=this.screenSpacePanning,e.keyPanSpeed=this.keyPanSpeed,e.autoRotate=this.autoRotate,e.autoRotateSpeed=this.autoRotateSpeed,e.enableKeys=this.enableKeys,e.target0=this.target0.clone(),e.position0=this.position0.clone(),e.zoom0=this.zoom0,e._leftInteractive=this._leftInteractive,e._keepTarget=this._keepTarget,e.maxPitchAngle=this.maxPitchAngle,e._minPolarAngle=this._minPolarAngle,e._maxPolarAngle=this._maxPolarAngle,e.standardRadius=this.standardRadius,e.targetMaxOffset=this.targetMaxOffset,e.panStander=this.panStander,e.isDispatchEvent=this.isDispatchEvent,e.enableZoomOnTarget=this.enableZoomOnTarget,e._isCameraStatic=this._isCameraStatic,Et.mergeObject(e.options,this.options),e},THREE.WebGLRenderer.prototype.getContext=function(e){return this.context},THREE.ShaderChunk.map_fragment=["","#ifdef USE_MAP","#ifdef USE_DIFFUSE_UV2","vec4 texelColor = texture2D( map, vUv2 );","#else","vec4 texelColor = texture2D( map, vUv );","#endif","texelColor = mapTexelToLinear( texelColor );","diffuseColor *= texelColor;","#endif",""].join("\n"),THREE.ShaderChunk.alphamap_fragment=["","#ifdef USE_ALPHAMAP","#ifdef USE_ALPHAMAP_REVERSE","diffuseColor.a *= 1.0 - texture2D( alphaMap, vAlphaUV).g;","#else","diffuseColor.a *= texture2D( alphaMap, vAlphaUV).g;","#endif","#endif",""].join("\n"),THREE.ShaderChunk.uv2_pars_fragment=["","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","varying vec2 vUv2;","#endif","#ifdef USE_ALPHAMAP","varying vec2 vAlphaUV;","#endif","#ifdef USE_EMISSIVEMAP","varying vec2 vEmissiveUV;","#endif",""].join("\n"),THREE.ShaderChunk.uv2_pars_vertex=["","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined( USE_ALPHA_UV2 ) || defined (USE_DIFFUSE_UV2)","attribute vec2 uv2;","#endif","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","varying vec2 vUv2;","#endif","#ifdef USE_ALPHA_UV3","#if defined(USE_ALPHAMAP) || defined(USE_EMISSIVEMAP)","attribute vec2 uv3;","#endif","#endif","#ifdef USE_ALPHA_UV4","#if defined(USE_ALPHAMAP) || defined(USE_EMISSIVEMAP)","attribute vec2 uv4;","#endif","#endif","#ifdef USE_ALPHAMAP","varying vec2 vAlphaUV;","uniform mat3 uvTransform1;","#endif","#ifdef USE_EMISSIVEMAP","varying vec2 vEmissiveUV;","uniform mat3 uvTransform2;","#ifdef USE_EMISSIVE_AROUND_UV","attribute vec2 uv8;","#endif","#endif",""].join("\n"),THREE.ShaderChunk.uv2_vertex=["#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","#if defined(USE_DIFFUSE_UV2) && defined(USE_MAP)","vUv2 = (uvTransform * vec3(uv2, 1.0)).xy;","#else","vUv2 = uv2;","#endif","#endif","#ifdef USE_ALPHAMAP","vAlphaUV = (uvTransform1 * vec3(uv, 1.0)).xy;","#ifdef USE_ALPHA_UV2","vAlphaUV = (uvTransform1 * vec3(uv2, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV3","vAlphaUV = (uvTransform1 * vec3(uv3, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV4","vAlphaUV = (uvTransform1 * vec3(uv4, 1.0)).xy;","#endif","#endif","#ifdef USE_EMISSIVEMAP","#ifndef USE_EMISSIVETRANSFORM","mat3 emissiveTransform = uvTransform;","#else","mat3 emissiveTransform = uvTransform2;","#endif","vEmissiveUV = (emissiveTransform * vec3(uv, 1.0)).xy;","#ifdef USE_EMISSIVE_AROUND_UV","vEmissiveUV = (emissiveTransform * vec3(uv8, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV2","vEmissiveUV = (emissiveTransform * vec3(uv2, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV3","vEmissiveUV = (emissiveTransform * vec3(uv3, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV4","vEmissiveUV = (emissiveTransform * vec3(uv4, 1.0)).xy;","#endif","#endif",""].join("\n");["sprite","basic"].forEach((function(e){var t=THREE.ShaderLib[e];t.vertexShader=t.vertexShader.replace("#include <clipping_planes_pars_vertex>","\n\t#include <clipping_planes_pars_vertex>\n\t#ifdef USE_GPUPICKER\n\t\tuniform float baseId;\n\t\tvarying vec4 worldId;\n\t#endif\n\t"),t.vertexShader=t.vertexShader.replace("#include <fog_vertex>","\n\t#include <fog_vertex>\n\t#ifdef USE_GPUPICKER\n\t\tvec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);\n\t\ta -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);\n\t\tworldId = vec4(a,1);\n\t#endif\n\t"),t.fragmentShader=t.fragmentShader.replace("#include <clipping_planes_pars_fragment>","\n\t#include <clipping_planes_pars_fragment>\n\t#ifdef USE_GPUPICKER\n\t\tvarying vec4 worldId;\n\t#endif\n\t"),t.fragmentShader=t.fragmentShader.replace("#include <fog_fragment>","\n\t#include <fog_fragment>\n\t#ifdef USE_GPUPICKER\n\t\tgl_FragColor = worldId;\n\t#endif\n\t"),t.fragmentShader=t.fragmentShader.replace("#include <clipping_planes_fragment>","\n\t#ifdef USE_MAP\n\t\t#ifdef USE_UV_DISCARD\n\t\t\tif (vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.) discard;\n\t\t#endif\n\t#endif\n\t#include <clipping_planes_fragment>\n\t")})),THREE.ShaderChunk.aomap_fragment="\n\t#ifdef USE_AOMAP\n\t\t#ifdef WALL_AO\n\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity * 0.5 + 1.5;\n\t\t#else\n\t\t\t#ifdef FLOOR_AO\n\t\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.25;\n\t\t\t#else\n\t\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity * 1.6 + 1.7;\n\t\t\t#endif\n\t\t#endif\n\t\t// reflectedLight.indirectDiffuse *= ambientOcclusion;\n\t\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t\t#endif\n\t#else\n\t\tfloat ambientOcclusion = 1.4;\n\t#endif\n",THREE.ShaderChunk.emissivemap_fragment="\n\t#ifdef USE_EMISSIVEMAP\n\n\t\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveUV );\n\n\t\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\t\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n\t#endif\n\n\t#ifdef STANDARD\n\t\ttotalEmissiveRadiance = vec3(0.0,0.0,0.0);\n\t\tvec3 newEmissiveColor = emissive;\n\t\t#ifdef USE_EMISSIVEMAP\n\t\t\tnewEmissiveColor = emissive * emissiveColor.rgb;\n\t\t\t#ifdef USE_SIDE_EMISSIVE\n\t\t\t\tvec3 emissiveUp = vec3(0., 1., 0.);\n\t\t\t\t#ifdef ENV_QUATERNION\n\t\t\t\t\tvec4 emissiveQuat = vec4(0., 0., 0., 1.);\n\t\t\t\t\temissiveQuat.x = -envQuaternion.x;\n\t\t\t\t\temissiveQuat.y = -envQuaternion.y;\n\t\t\t\t\temissiveQuat.z = -envQuaternion.z;\n\t\t\t\t\temissiveQuat.w = envQuaternion.w;\n\t\t\t\t\temissiveUp = applyQuaternion(emissiveUp, emissiveQuat);\n\t\t\t\t#endif\n\t\t\t\tnewEmissiveColor *= newEmissiveColor * (1. - abs(dot( inverseTransformDirection( normal, viewMatrix ), emissiveUp )));\n\t\t\t#endif\n\t\t#endif\n\t#endif\n",THREE.ShaderChunk.encodings_fragment=["gl_FragColor = linearToOutputTexel( gl_FragColor );","#if defined(STANDARD) || defined(USE_AOMAP)","gl_FragColor.rgb *= ambientOcclusion;","#elif defined(FLOOR_AO)","gl_FragColor.rgb *= 1.2;","#endif","#ifdef STANDARD","gl_FragColor.rgb += newEmissiveColor;","#endif"].join("\n"),THREE.ShaderChunk.tonemapping_fragment=["#if defined( TONE_MAPPING ) && defined(STANDARD)","gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );","#endif"].join("\n"),THREE.BufferGeometry.prototype.getVerticesCount=function(){return this.attributes.position.count},THREE.BufferGeometry.prototype.addAttribute=function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(THING.Utils.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(THING.Utils.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new BufferAttribute(arguments[1],arguments[2])))},THREE.BufferAttribute.prototype.setDynamic=function(e){return this.setUsage(!0===e?THREE.DynamicDrawUsage:THREE.StaticDrawUsage),this},THREE.BufferGeometry.prototype.computeBoundingBox=function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.attributes.position;if(void 0!==e)for(var t=this.index?this.index.array:null,i=this.drawRange.start,r=this.drawRange.count!=1/0?this.drawRange.count:t?t.length:e.count;i<r;i++)t?Nh.fromBufferAttribute(e,t[i]):Nh.fromBufferAttribute(e,i),this.boundingBox.expandByPoint(Nh)},HTMLElement.prototype._getStyleTransform=function(){var e=this.style.transform;return e||"none"!=(e=getComputedStyle(this,!1).transform)?e:""},HTMLDivElement.prototype._setVisible=function(e){var t=this.style;e?("visible"!=t.visibility&&(t.visibility="visible"),"block"!=t.display&&(t.display="block")):("hidden"!=t.visibility&&(t.visibility="hidden"),"none"!=t.display&&(t.display="none"))},HTMLDivElement.prototype._isVisible=function(){return"hidden"!=this.style.visibility&&"none"!=this.style.display},HTMLDivElement.prototype._getWorldScale=function(){for(var e=[],t=this;t;t=t.parentElement)e.push(t);e=e.reverse();var i=[1,1];return e.forEach((function(e){var t=e._getStyleTransform();if(t){var r;if(t.includes("scale")){var n=t.indexOf("scale");r=function(e){if(e.includes(",")){var t=Et.scanf(e,"scale(%f, %f)");return isNaN(t[0])?null:[Et.parseNumber(t[0],1),Et.parseNumber(t[1],1)]}if(t=Et.scanf(e,"scale(%f)"),isNaN(t))return null;var i=Et.parseNumber(t,1);return[i,i]}(t.substring(n))}else if(t.includes("matrix")){var o=t.indexOf("matrix");r=function(e){var t=Et.scanf(e,"matrix(%f, 0, 0, %f, 0, 0)");return isNaN(t[0])||isNaN(t[1])?null:[Et.parseNumber(t[0],1),Et.parseNumber(t[1],1)]}(t.substring(o))}r&&(i[0]*=r[0],i[1]*=r[1])}})),i};var fp=function(){function e(t){n(this,e)}return e.prototype.init=function(){this.eyeTween=null,this.targetTween=null,this.upTween=null,this._flying=!1},e.prototype._lookAt=function(e){var t=Et.parseVector3(e);t&&(this.controller.target.set(t.x,t.y,t.z),this.controller.object.lookAt(this.controller.target))},e.prototype.updateFollowingObject=function(){var e=this,t=this.followingObject,i=t.params,r=i.flyStop,n=i.flying,o=i.flyComplete,s=t.object;if(s instanceof Si){if(!s.visible||s.destroyed)return r&&r(),void this.app.camera.stopFollowingObject();s=t.centerPos||s.boundingBox.center}s=Et.parseVector3(s);var a=t.dir.clone();"earth"===this.app.camera.mode?(a=t.object.selfToWorld(a),a=THING.Utils.parseVector3(a)):a.add(s);var l=Et.parseVector3(this.camera.target),u=Et.parseVector3(this.camera.position),c=t.speed;l=l.lerp(s,c/10),u=u.lerp(a,c/10),this.object.node.position.copy(u),this._lookAt(l,(function(){return e.static})),n&&n();var h=l.distanceTo(s),p=u.distanceTo(a);h<1e-4&&p<1e-4&&(o&&o(),i.once&&this.app.camera.stopFollowingObject());this.app.needUpdate=!0},e.prototype.updateLookingObject=function(){var e=this.lookingObject;if(e instanceof Si){if(e.destroyed)return void this.app.camera.lookAt(null);e=e.boundingBox.center}var t=Et.parseVector3(e),i=Et.parseVector3(this.camera.target).lerp(t,.1);this.camera.target=i.toArray()},e.prototype.getBoundingBox=function(e,t){var i=t.boundingBox;return i||(i=e.visible?e.boundingBox:e.getBoundingBox(!1,!1)),i},e.prototype.getFlyPos=function(e){var t,i=this.object,r=Et.parseNumber3(e.position),n=null,o=[0,0,0],s=e.target||e.object;if(s){var a=e.offset,l=e.worldOffset,u=e.xAngle,c=e.yAngle,h=e.distance||e.radius,p=e.radiusFactor;if(s.isBaseObject||s.isGroup){var d;n=s;var f=e.center;if(o=f?(f=Et.parseVector3(f)).toArray():(d=this.getBoundingBox(n,e)).center||o,Et.isNull(u)&&Et.isNull(c))if(a){T=n.worldToSelf(o);a=THING.Math.addVector(T,a),a=n.selfToWorld(a,!0)}else if(l)a=THING.Math.addVector(o,l);else{var m=e.time||1,g=!1;h&&(g=!0);var v=[];d=d||e.boundingBox||this.getBoundingBox(n,e),v.push(d.getWorldPosition({yAngle:45,xAngle:45,radius:d.radius,distance:h,radiusFactor:p,ignoreScale:g,boundingBox:d})),m>1&&(v.push(d.getWorldPosition({yAngle:45,xAngle:135,radius:d.radius,distance:h,radiusFactor:p,ignoreScale:g,boundingBox:d})),v.push(d.getWorldPosition({yAngle:45,xAngle:225,radius:d.radius,distance:h,radiusFactor:p,ignoreScale:g,boundingBox:d})),v.push(d.getWorldPosition({yAngle:45,xAngle:315,radius:d.radius,distance:h,radiusFactor:p,ignoreScale:g,boundingBox:d})));for(var y=0,b=Et.parseVector3(i.position),_=b.distanceTo(Et.parseVector3(v[y])),x=y+1;x<v.length;x++){var E=Et.parseVector3(v[x]),w=b.distanceTo(E);w<_&&(_=w,y=x)}r=v[y],a=[0,0,0]}else{a=a||n.getOffsetPosition({yAngle:u,xAngle:c,distance:h,radiusFactor:p});var T=n.worldToSelf(o);a=THING.Math.addVector(T,a),a=n.selfToWorld(a,!0)}r=r||[0,0,0],i.projectionType==M.Perspective?(r[0]+=a[0],r[1]+=a[1],r[2]+=a[2]):r[1]+=a[1]}else if(Et.isArray(s)){if(o=s,!r)if(a=a||l,Et.isArray(a)||Et.isNumber(a))r=THING.Math.addVector(s,a);else{h=h||10;var C=Et.parseVector3(s);C&&(c||u?(c=Et.parseValue(c,0),u=Et.parseValue(u,0),r=C.getDirectionFromAngles(u,c,h).toArray()):r=C.getDirectionFromPosition(i.node.position,h).toArray())}r=r||i.position}else THING.Utils.error("getFlyPos() failed, due to object or target is neither BaseObject type nor position")}if(e.autoFixUp){var S=e.up;if(S)S=THING.Math.normalizeVector(S);else{var j=this,P=new THREE.Vector3(0,1,0),R=(t=n||j.app.level.current)?t.isCampus?t:t.parents.query(".Campus")[0]:null;R&&(P.applyQuaternion(THING.Utils.parseQuaternion(R.worldAngles)),P.normalize(),S=P.toArray())}}return{obj:n,eyePos:r,lookAtPos:o,up:S}},e.prototype.flyTo=function(e){(e=e||{}).isBaseObject&&(e={object:e,time:2e3});var t=Et.parseValue(e.time,2e3),i=Et.parseValue(e.lerp||e.lerpType,TWEEN.Easing.Linear.None),r=Et.parseValue(e.upLerp,i),n=Et.parseValue(e.positionLerp,i),o=Et.parseValue(e.targetLerp,i),s=e.flyStart,a=e.flyStop,l=e.flying,u=e.flyComplete;if(Et.parseValue(e.keepDirection,!1)){var c=e.cameraTarget||e.target;if(c)return e.object=c,e.radius=e.radius||2*c.boundingBox.radius,e.speed=t/1e3,e.enableRotate=!0,e.enableZoom=!0,e.once=!0,void this.followObject(e)}var h=this.getFlyPos(e),p=h.eyePos,d=h.lookAtPos;if(!this._stopping)if(this.stopFlying(),p&&d){this._flying=!0,s&&s();var f={x:this.object.node.position.x,y:this.object.node.position.y,z:this.object.node.position.z},m={x:p[0],y:p[1],z:p[2]},g={x:this.controller.target.x,y:this.controller.target.y,z:this.controller.target.z},v={x:d[0],y:d[1],z:d[2]},y=this,b=e.customFlying;if(b&&Et.isFunction(b))b({object:e.object,forward:y.direction,from:f,to:m,lookatFrom:g,lookatTo:v,time:t,complete:function(){y._flying=!1,u&&u()}});else if(this.eyeTween=new TWEEN.Tween(f).to(m,t).easing(n).onUpdate((function(){y.object.position=[this._object.x,this._object.y,this._object.z]})).start(),this.targetTween=new TWEEN.Tween(g).to(v,t).easing(o).onUpdate((function(){y.object.target=[this._object.x,this._object.y,this._object.z],l&&l()})).onStop((function(){a&&a()})).onComplete((function(){y._flying=!1,u&&u()})).start(),h.up){var _={x:this.object.node.up.x,y:this.object.node.up.y,z:this.object.node.up.z},x={x:h.up[0],y:h.up[1],z:h.up[2]};this.upTween=new TWEEN.Tween(_).to(x,t).easing(r).onStop((function(){y.object.up=h.up})).onUpdate((function(){y.object.up=[this._object.x,this._object.y,this._object.z]})).start()}}else u&&u()},e.prototype.stopRotating=function(){this.object._stopRotating()},e.prototype.stopFlying=function(){this._flying=!1,this._stopping=!0,this.object.stopRotating(),this.stopFollowingObject(),this.eyeTween&&(this.eyeTween.stop(),this.eyeTween=null),this.targetTween&&(this.targetTween.stop(),this.targetTween=null),this.upTween&&(this.upTween.stop(),this.upTween=null),this._stopping=!1},e.prototype.movePath=function(e){var t=this;this.stopFlying();var i=e.complete;e.complete=function(){t._flying=!1;var e=t.cameraObject.node.getForwardPosition(t.camera.distance);t.camera.target=e.toArray(),i&&i()},this._flying=!0,flyStart&&flyStart(),Si.prototype.movePath.call(this.object,e)},e.prototype.rotateAround=function(e){var t=this,i=(e=e||{}).target||e.object;e.target=i||this.camera.target,this.stopFlying(),e.rotateStart&&e.rotateStart(),this.lookAt(e.target);var r=e.complete;e.complete=function(t){e.stop(),r&&r(),e.rotateComplete&&e.rotateComplete()},e.stop=function(i){t.lookAt(null),t.camera.curOrbit.enabled=!0,t.camera.resume({rotate:!0,pan:!0,zoom:!0}),e.rotateComplete&&e.rotateComplete()},e.update=function(e){t.camera.curOrbit.update()},this.camera.curOrbit.enabled=!1,this.camera.disable({rotate:!0,pan:!0,zoom:!0}),Si.prototype.rotateAround.call(this.object,e)},e.prototype.rotate=function(e){var t=this.camera.distance,i=Et.parseVector3(this.camera.direction),r=Et.parseQuaternion(e);i.applyQuaternion(r),i.normalize();var n=i.clone();n.multiplyScalar(t),n.add(Et.parseVector3(this.camera.position)),this.camera.target=n.toArray()},e.prototype.followObject=function(e){(e=e||{}).isBaseObject&&(e={object:e});var t=e.object;if(t){this.stopFollowingObject();var i,r=e.alpha,n=e.beta,o=e.distance||e.radius||this.camera.distance,s=Et.parseVector3(e.offset||[0,0,0]),a=Et.parseVector3(e.worldOffset),l=e.speed||1,u=e.centerPos;if(a)i=a;else{if(i=new THREE.Vector3,r||n)r=r||0,n=n||0,i=Et.parseVector3(THING.Math.directionFromAlphaBeta(r,n));else{var c=Et.parseVector3(this.camera.target),h=Et.parseVector3(this.camera.position);i.subVectors(h,c)}i.normalize(),i.multiplyScalar(o),i.add(s)}var p=e.flyStart;p&&p(),this.followingObject={object:t,dir:i,speed:l,params:e,centerPos:u}}},e.prototype.stopFollowingObject=function(){if(this.followingObject){var e=this.followingObject.params;this.followingObject=null;var t=e.flyStop;t&&t()}},e.prototype.lookAt=function(e){return e&&(Et.isArray(e)||e.isBaseObject)?(this.lookingObject=e,!0):(this.lookingObject=null,!1)},e.prototype.setTarget=function(e){var t=this;this._lookAt(e,(function(){return t.object.static}))},e.prototype.isFlying=function(){return!!this._flying||!!this.followingObject},e.prototype.onAdd=function(e){this.object=e,this.app=this.object.app,this.init()},e.prototype.onRemove=function(){},e.prototype.onUpdate=function(){this.followingObject?this.updateFollowingObject():this.lookingObject&&this.updateLookingObject()},o(e,[{key:"controller",get:function(){return this.object.controller}},{key:"camera",get:function(){return this.object.app.camera}}]),e}(),mp=function(){function e(t){n(this,e);var i=new THREE.TextureLoader,r=t.image,o=t.backgroundImage,s=t.opacity||.8,a=null;r&&(a=new THREE.SpriteMaterial({map:i.load(r),opacity:s,transparent:!0}));var l=null;this.spriteBg=null,o&&(l=new THREE.SpriteMaterial({map:i.load(o),opacity:s,transparent:!0})),this._position=null,this._uiPosition=[1,1],Object.defineProperty(this,"position",{get:function(){return this._position},set:function(e){if(Et.isNumber(e))switch(this._position=e,this._position){case j.LeftTop:this._uiPosition=[-1,-1];break;case j.RightTop:this._uiPosition=[1,-1];break;case j.LeftBottom:this._uiPosition=[-1,1];break;case j.RightBottom:this._uiPosition=[1,1]}return this._position}}),null!=t.position?this.position=t.position:this.position=j.RightBottom,this.size=t.size||50,this.offset=t.offset||[0,0],a&&(this.sprite=new THREE.Sprite(a),this.sprite.scale.set(this.size,this.size,1)),null!=l&&(this.spriteBg=new THREE.Sprite(l),this.spriteBg.scale.set(this.size,this.size,1))}return e.prototype.getRotation=function(){var e=this.app.renderCamera.rotation;switch(e.order){case"XYZ":return-e.z;case"YXZ":return-e.y}return-e.z},e.prototype.onUpdate=function(){var e=this.app.mainUI.getRenderPosition(this._uiPosition,[this.size,this.size]);null!=this.spriteBg&&this.spriteBg.position.set(e[0]+this.offset[0],e[1]+this.offset[1],-10),this.sprite&&(this.sprite.position.set(e[0]+this.offset[0],e[1]+this.offset[1],-10),this.sprite.material.rotation=this.getRotation())},e.prototype.onAdd=function(e){this.app=e,null!=this.spriteBg&&this.app.mainUI.scene2D.add(this.spriteBg),this.sprite&&this.app.mainUI.scene2D.add(this.sprite)},e.prototype.onRemove=function(){null!=this.spriteBg&&this.app.mainUI.scene2D.remove(this.spriteBg),this.sprite&&this.app.mainUI.scene2D.remove(this.sprite)},e}(),gp=function(){function e(t){n(this,e),this._controls=null}return e.prototype.onResize=function(){},e.prototype.onUpdate=function(){this._controls&&(this._controls.update(this.app._deltaTime),this.app.needUpdate=!0)},e.prototype.onAdd=function(e){this.app=e,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeMouseControls(e.renderCamera),this._controls.movementSpeed=.25),this._controls.enabled=!0},e.prototype.onRemove=function(){this.app.camera.inputEnabled=!0,this._controls&&(this._controls.dispose(),this._controls.enabled=!1,this._controls=null)},e}();function vp(e){return e instanceof $t?e.getNodes():Array.isArray(e)?(THING.Utils.warn("[WalkControl/WalkButtronControl] please set collision objects by selector object, instead of object3D array."),e):e}var yp=new THREE.Vector3,bp=function(){function e(t){n(this,e),this._controls=null,t=t||{},this.walkSpeed=void 0===t.walkSpeed?.02:t.walkSpeed,this.turnSpeed=void 0===t.turnSpeed?.25:t.turnSpeed,this.jumpSpeed=void 0===t.jumpSpeed?3:t.jumpSpeed,this.enableKeyRotate=void 0!==t.enableKeyRotate&&t.enableKeyRotate,this.useGravity=void 0===t.useGravity||t.useGravity,this.gravity=t.gravity?t.gravity:9.8,this.eyeHeight=void 0===t.eyeHeight?1.6:t.eyeHeight,this._groundObjects=void 0===t.groundObjects?void 0:vp(t.groundObjects),this.useCollision=void 0!==t.useCollision&&t.useCollision,this._collisionObjects=void 0===t.collisionObjects?void 0:vp(t.collisionObjects),this._downRaycaster=new THREE.Raycaster,this._downRaycaster.ray.direction.set(0,-1,0),this._forwardRaycaster=new THREE.Raycaster,this._fallSpeed=0,this._prevCameraAdjustNear=!1,this._cameraChangeStarted=!1}return e.prototype._notifyCameraEvent=function(e){var t=this.app.camera;this.app.trigger(e,{position:t.position,target:t.target})},e.prototype.onResize=function(){},e.prototype.onUpdate=function(){var e=this.app.renderCamera,t=!1;if(this.useCollision){this._forwardRaycaster.ray.origin.copy(e.position),this._forwardRaycaster.ray.origin.y-=this.eyeHeight/2;var i=this._controls.getMoveDirection();this._forwardRaycaster.ray.direction.copy(i).normalize();var r=this._forwardRaycaster.intersectObjects(this._collisionObjects,!0);(r=r.filter((function(e){return e.object&&!e.object.isSky}))).length>0&&r[0].distance<.5&&(t=!0)}if(this._controls&&(this._controls.movementSpeed=t?0:this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableKeyRotate=this.enableKeyRotate,this._controls.update()?this._cameraChangeStarted?this._notifyCameraEvent("cameraChange"):(this._cameraChangeStarted=!0,this._notifyCameraEvent("cameraChangeStart")):this._cameraChangeStarted&&(this._cameraChangeStarted=!1,this._notifyCameraEvent("cameraChangeEnd")),this.app.needUpdate=!0),this.useGravity){this._downRaycaster.ray.direction.copy(e.up).multiplyScalar(-1).normalize(),this._downRaycaster.ray.origin.copy(e.position);var n=this._downRaycaster.ray.direction,o=this._downRaycaster.intersectObjects(this._groundObjects,!0);if((o=o.filter((function(e){return e.object&&!e.object.isSky}))).length<1){this._fallSpeed+=.0166*this.gravity;var s=yp.copy(n).multiplyScalar(Math.min(.0166*this._fallSpeed,this.eyeHeight-.001));e.position.add(s)}else{var a=o[0].distance;if(a<=this.eyeHeight+.01&&this._fallSpeed>=0){this._fallSpeed=0;var l=yp.copy(n).multiplyScalar(a-this.eyeHeight);e.position.add(l)}else{this._fallSpeed+=.0166*this.gravity;var u=yp.copy(n).multiplyScalar(Math.min(.0166*this._fallSpeed,this.eyeHeight-.001));e.position.add(u)}}}},e.prototype.onAdd=function(e){this.app=e,this._prevCameraAdjustNear=e.camera.autoAdjustNear,e.camera.autoAdjustNear=!1,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeMouseControls(e.renderCamera,e.mainDomElement),this._controls.movementSpeed=this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableFly=!1),this._controls.enabled=!0,this._groundObjects=this._groundObjects||e.query(".Ground || .Floor").getNodes(),this._collisionObjects=this._collisionObjects||[this.app.scene],this._jumpBind=function(e){32==e.keyCode&&this.jump()}.bind(this),window.addEventListener("keydown",this._jumpBind,!1)},e.prototype.onRemove=function(){var e=this.app;e.camera.inputEnabled=!0,this._controls&&(this._controls.dispose(),this._controls.enabled=!1,this._controls=null),this._groundObjects=null,this._collisionObjects=null,e.camera.autoAdjustNear=this._prevCameraAdjustNear,window.removeEventListener("keydown",this._jumpBind,!1)},e.prototype.jump=function(){0==this._fallSpeed&&(this._fallSpeed-=this.jumpSpeed)},o(e,[{key:"groundObjects",set:function(e){this._groundObjects=void 0!==e?vp(e):[]}},{key:"collisionObject",set:function(e){this._collisionObjects=void 0!==e?vp(e):[]}}]),e}(),_p=function(e){function t(i){return n(this,t),a(this,e.call(this,i))}return s(t,e),t.prototype.onResize=function(){},t.prototype.onAdd=function(e){this.app=e,this._prevCameraAdjustNear=e.camera.autoAdjustNear,e.camera.autoAdjustNear=!1,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeControls(e.renderCamera,e.mainDomElement),this._controls.movementSpeed=this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableFly=!1,e.renderCamera.rotation.x=0),this._controls.enabled=!0,this._groundObjects=this._groundObjects||e.query(".Ground || .Floor").getNodes(),this._collisionObjects=this._collisionObjects||[this.app.scene],this._createWalkButton()},t.prototype.onRemove=function(){var e=this.app;e.camera.inputEnabled=!0,this._controls&&(this._controls.enabled=!1,this._controls=null),this._groundObjects=null,this._collisionObjects=null,e.camera.autoAdjustNear=this._prevCameraAdjustNear,this._removeWalkButton()},t.prototype._setMoveState=function(e,t){this._controls&&(this._controls.moveState[e]=t,this._controls.updateMovementVector())},t.prototype._setRotate=function(e,t){this._controls&&this._controls.rotateDelta.set(e,t)},t.prototype._createWalkButton=function(){var e=this.app,t=this;if(!(e.domElement.getElementsByClassName("walkbutton").length>0)){this._walkButtonDom=e.domElement.appendChild(document.createElement("div")),this._walkButtonDom.className="walkbutton",this._walkButtonDom.style.cssText="position: absolute;right: 0;bottom: 0;width: 0;height: 0;border-radius: 50%;box-sizing: border-box;z-index: 1000;background: #f0f0f0;";var i,r,n,o,s,a=this._walkButtonDom.appendChild(document.createElement("div"));a.style.cssText="width: 46%;height: 46%;border-radius: 50%;overflow: hidden;position: absolute;top: 27%;left: 27%;border-radius: 50%;background: #003A9E;",this._resizeWalkButton(),t._moveState="",this._walkButtonDom.addEventListener("touchstart",(function(e){e.preventDefault(),i=e.changedTouches[0].pageX,r=e.changedTouches[0].pageY,n=e.changedTouches[0].pageX-a.offsetLeft,o=e.changedTouches[0].pageY-a.offsetTop,document.body.addEventListener("touchmove",l,!1)})),document.addEventListener("touchend",(function(){document.body.removeEventListener("touchmove",l,!1),a.style.left="27%",a.style.top="27%",t._setMoveState(t._moveState,0),t._moveState=""}))}function l(e){var l=e.changedTouches[0].pageX,u=e.changedTouches[0].pageY,c=l-n,h=u-o,p=l-i,d=u-r,f=parseFloat(t.width)/2;if(t._getDistance(p,d)<=f)a.style.left=c+"px",a.style.top=h+"px";else{var m=t._getNewPos(f,t._getRadian(p,d));a.style.left=m[0]+i-n+"px",a.style.top=m[1]+r-o+"px"}(s=Math.abs(p)>Math.abs(d)?p>0?"right":"left":d>0?"back":"forward")!==t._moveState&&(t._setMoveState(t._moveState,0),t._setMoveState(s,1),t._moveState=s)}},t.prototype._removeWalkButton=function(){var e=this.app.domElement.getElementsByClassName("walkbutton");e.length>0&&e[0].parentNode.removeChild(e[0])},t.prototype._getDistance=function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},t.prototype._getRadian=function(e,t){return Math.atan2(t,e)},t.prototype._getNewPos=function(e,t){var i=[];return i.push(Math.cos(t)*e),i.push(Math.sin(t)*e),i},t.prototype._getwindowOrientation=function(){return 180==window.orientation||0==window.orientation||90!=window.orientation&&-90!=window.orientation&&void 0},t.prototype._resizeWalkButton=function(){this.width=this._getwindowOrientation()?.2*this.app.domElement.offsetWidth:.2*this.app.domElement.offsetHeight,this._walkButtonDom.style.width=this.width+"px",this._walkButtonDom.style.height=this.width+"px",this._walkButtonDom.style.right=.5*this.width+"px",this._walkButtonDom.style.bottom=.3*this.width+"px"},t}(bp),xp=function(){function e(t){n(this,e),this.parseParam(t),this._enable=!0,this.scene=new THREE.Scene,this.camera=null,this.sprite=null,this.raycaster=new THREE.Raycaster,this.mouse=new THREE.Vector2,this.ratio=2,this.mainAspect=1,this.miniDom=null,this.renderTarget=null,this.inited=!1,this.create()}return e.prototype.parseParam=function(e){this.app=e.app,this._opacity=e.opacity||.7,this._posIndex=e.position||e.posIndex||0,this.bIcon=e.bIcon||!0,this.width=e.width||150,this.height=e.height||this.width,this._scale=e.scale||1,this.closeBtnImg=e.closeBtnImg||"http://www.thingjs.com/static/images/minimap2.png",this.cameraViewImg=e.cameraViewImg||"http://www.thingjs.com/static/images/minimap1.png",this.cameraCenterImg=e.cameraCenterImg||"http://www.thingjs.com/static/images/minimap0.png",this.center={};var t=this.app.root.boundingBox.toBox(),i=(t.max.x+t.min.x)/2,r=(t.max.z+t.min.z)/2;if(e.sceneCenter?(this.center.x=e.sceneCenter[0],this.center.y=e.sceneCenter[1]):e.center?(this.center.x=e.center[0],this.center.y=e.center[1]):(this.center.x=i,this.center.y=r),this.angle=e.angle||0,this.canMoushWheel=e.mousewheel,this.ground=e.ground,this.hasClose=e.hasClose,!this.ground)for(var n=0;n<this.app.root.campuses.length;n++){var o=this.app.root.campuses[n].ground;if(o){this.ground=o.node.children;break}}this.bTranslate=e.bTranslate||!1},e.prototype.init2d=function(){if(this.miniDom=this.app.domElement.appendChild(document.createElement("div")),this.miniDom.className="minimap",this.miniDom.style.position="absolute",this.miniDom.style.cssText="position: absolute;width:"+this.width+";height:"+this.height+";border: 5px solid rgba(255, 255, 255, 0.8);border-radius: 3px;display: block;box-sizing: border-box;overflow:hidden",this.miniDom.style.zIndex=1e3,this.hasClose){var e=this.miniDom.appendChild(document.createElement("img"));e.className="minimap_closeBtn",e.style.position="absolute",e.style.width=this.width/5,e.style.right="1px",e.style.top="1px",e.src=this.closeBtnImg;var t=this;e.addEventListener("click",(function(){close=!0,t.enable=!1}))}var i=this.miniDom.appendChild(document.createElement("img"));i.className="minimap_cameraView",i.style.position="absolute",i.src=this.cameraViewImg;var r=this.miniDom.appendChild(document.createElement("img"));r.className="minimap_cameraCenter",r.src=this.cameraCenterImg,i.style.width="40px",i.style.height="30px",this.miniDom.onmousedown=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.miniDom.onmousemove=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.miniDom.onmousewheel=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.canMoushWheel&&this.miniDom.addEventListener("mousewheel",(function(e){t.scale+=e.wheelDelta>0?.1:-.1}),!1),this.miniDom.addEventListener("mousedown",(function(e){0===e.button&&(t.mouse.x=e.clientX/(t.miniDom.clientWidth+10)*2-1,t.mouse.y=-e.clientY/(t.miniDom.clientWidth+10)*2+1,n(),t.miniDom.onmousemove=function(e){t.mouse.x=e.clientX/(t.miniDom.clientWidth+10)*2-1,t.mouse.y=-e.clientY/(t.miniDom.clientWidth+10)*2+1,n()},t.miniDom.onmouseup=function(){t.miniDom.onmousemove=null,t.miniDom.onmouseup=null})}),!1);t=this;function n(){t.raycaster.setFromCamera(t.mouse,t.camera);var e=t.raycaster.intersectObjects(t.ground[0].children,!0);if(e.length>0){var i=e[0].point;if(t.bTranslate){var r=t.app.camera.cameraObject.forward;r=new THREE.Vector3(r[0],0,r[2]);var n=new THREE.Vector3(i.x,0,i.z).normalize(),o=r.dot(n),s=(new THREE.Vector3).crossVectors(r,n).y,a=0;a=o>0?s<0?90*-(s+1)-90:90+90*(1-s):90*s;var l=t.app.create({type:"Thing",position:[i.x,t.app.camera.position[1],i.z]});t.app.camera.flyTo({time:1e3,object:l,xAngle:45,yAngle:a,zAngle:0})}else t.app.camera.flyTo({time:1e3,position:[i.x,t.app.camera.position[1],i.z],target:t.app.camera.target})}}},e.prototype.init3d=function(){this.init2d();var e=this.app.root.boundingBox.toBox(),t=e.max.x>e.max.z?e.max.x:e.max.z,i=Math.abs(e.min.x)>Math.abs(e.min.z)?Math.abs(e.min.x):Math.abs(e.min.z),r=t>i?t:i;r*=1/this.scale,this.camera=new THREE.OrthographicCamera(-r,r,r,-r,-1e4,1e4),this.camera.position.set(this.center.x,100,this.center.y),this.camera.up=new THREE.Vector3(0,0,-1).applyEuler(new THREE.Euler(0,this.angle*Math.PI/180,0,"XYZ")),this.camera.lookAt(new THREE.Vector3(this.center.x,-1,this.center.y));var n=this.app.domElement;this.mainAspect=n.clientWidth/n.clientHeight,this.ratio=n.clientWidth/r;var o=r,s=8*o<256?8*o:256,a=8*(r*this.mainAspect)<256*this.mainAspect?8*o:256*this.mainAspect;this.renderTarget=new THREE.WebGLRenderTarget(s,a,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,generateMipmaps:!1,format:THREE.RGBAFormat});var l=new THREE.SpriteMaterial({map:this.renderTarget.texture,transparent:!0,opacity:this._opacity});this.sprite=new THREE.Sprite(l),this.setMiniRect(),this.update();var u=this;window.onresize=function(){u.mainAspect=n.clientWidth/n.clientHeight,u.ratio=n.clientWidth/r,u.setMiniRect()},this.inited=!0},e.prototype.create=function(){this.inited||(this.init3d(),this.scene.add(this.camera),this.camera.add(this.sprite))},e.prototype.setMiniRect=function(){this.miniDom.style.width=this.width+"px",this.miniDom.style.height=this.height+"px";var e=this;function t(t,i,r,n){e.miniDom.style.top=t,e.miniDom.style.left=i,e.miniDom.style.bottom=r,e.miniDom.style.right=n}var i=this.width/(.5*this.ratio),r=i*this.mainAspect;this.sprite.scale.set(i,r,1);var n,o,s=this.camera.right,a=this.camera.left;switch(this._posIndex){case 0:n=a+i/2,o=a+r/2,t("0px","0px",null,null);break;case 2:n=a+i/2,o=s-r/2,t(null,"0px","0px",null);break;case 1:n=s-i/2,o=a+r/2,t("0px",null,null,"0px");break;case 3:n=s-i/2,o=s-r/2,t(null,null,"0px","0px")}this.sprite.position.set(n,-o,0)},e.prototype.update=function(){var e=this.app.lighting,t=this.app.lighting;t.mainLight.intensity=0,t.secondaryLight.intensity=0,t.tertiaryLight.intensity=0,this.app.lighting=t;var i=this.app.scene.background;this.app.scene.background=null,this.app.renderer.setClearColor(0,0),this.app.renderer.setRenderTarget(this.renderTarget),this.app.renderer.clear(),this.app.renderer.render(this.app.scene,this.camera),this.app.lighting=e,this.app.scene.background=i},e.prototype.destroy=function(){var e=this.scene.children.length;if(0!=e){if(e>0)for(var t=0;t<e;t++)this.scene.remove(this.scene.children[t]);this.camera=null,this.sprite=null,null!=this.miniDom&&(this.app.domElement.removeChild(this.miniDom),this.miniDom=null)}},e.prototype.render=function(){if(this.miniDom)if(this._enable){this.miniDom.style.display="block";var e=this;if(this.miniDom.childNodes.forEach((function(t){t.style.display=e.bIcon?"block":"none"})),null!=this.camera&&null!=this.renderTarget){var t=this.app.renderer.autoClear;this.app.renderer.autoClear=!1,this.app.renderer.setRenderTarget(null),this.app.renderer.render(this.scene,this.camera),this.app.renderer.autoClear=t;var i=this.app.camera.position,r=new THREE.Vector3(i[0],i[1],i[2]);if(0!=this.angle){var n=new THREE.Vector3(this.center.x,r.y,this.center.y),o=r.sub(n);o.applyEuler(new THREE.Euler(0,-this.angle*Math.PI/180,0,"XYZ")),o.add(n),r.copy(o)}var s=this.transToMinimapCoord(r).x,a=this.transToMinimapCoord(r).y;this.setImage(s,a,this.app.camera.position[1]);var l=this.app.camera.camera.rotation,u="YXZ"==l.order?l.y:l.z,c=(document.getElementsByClassName("minimap_cameraCenter")[0],document.getElementsByClassName("minimap_cameraView")[0]),h=0;h=u>=0?u/Math.PI*180:180*(2-Math.abs(u)/Math.PI),c.style.transform="rotate("+(-h+this.angle)+"deg)",c.style.transformOrigin="50% 100%"}}else this.miniDom.style.display="none"},e.prototype.transToMinimapCoord=function(e){var t,i;i=t=this.width/2;var r,n,o=t/((this.camera.right-this.camera.left)/2);return e.hasOwnProperty("x")?(r=e.x-this.center.x,n=e.z-this.center.y):(r=e[0]-this.center.x,n=e[2]-this.center.y),{x:r>=0?t-o*r:t+o*Math.abs(r),y:n>=0?i-o*n:i+o*Math.abs(n)}},e.prototype.setImage=function(e,t,i){var r=(i>80?i-80:0)*(1/(220/30))+15;r>30&&(r=30);var n=document.getElementsByClassName("minimap_cameraCenter")[0],o=document.getElementsByClassName("minimap_cameraView")[0],s=r;e>=r/2&&e<=this.width-r/2&&t>=r/2&&this.width,n.style.position="absolute",n.style.width=r+"px",n.style.height=s+"px",n.style.right=e-r/2+"px",n.style.bottom=t-s+"px",o.style.right=e-20+"px",o.style.bottom=t-s/2+"px"},o(e,[{key:"scale",set:function(e){this._scale=e,this.destroy(),this.inited=!1,this.create()},get:function(){return this._scale}},{key:"opacity",set:function(e){this._opacity=e,this.sprite.material.opacity=this._opacity},get:function(){return this._opacity}},{key:"posIndex",set:function(e){this._posIndex=e,this.setMiniRect()},get:function(){return this._posIndex}},{key:"enable",set:function(e){this._enable=e},get:function(){return this._enable}}]),e}(),Ep=function(){function e(t){n(this,e),this.minimap=null,this.param=t}return e.prototype.onAdd=function(e){null!=this.minimap&&this.onRemove(),this.param.app||(this.param.app=e),this.minimap=new xp(this.param)},e.prototype.onRemove=function(){this.minimap&&this.minimap.destroy()},e.prototype.onUpdate=function(){this.minimap&&this.minimap.render()},e}(),wp=function(){function e(){n(this,e),this.app=null,this.object=null,this._targetObject=null,this._target=new THREE.Vector3}return e.prototype.onAdd=function(e){this.app=e.app,this.object=e},e.prototype.onRemove=function(){this.app=null,this.object=null,this._targetObject=null},e.prototype.onUpdate=function(){return this.object.node.updateWorldMatrix(!0,!1),this.object.node.lookAt(this._target),this._targetObject&&this._target.fromArray(this._targetObject.position),!0},o(e,[{key:"target",set:function(e){e&&(e.isBaseObject?(this._targetObject=e,this._target.fromArray(e.position)):(this._targetObject=null,this._target.fromArray(e)))},get:function(){return this._targetObject||this._target.toArray()}}]),e}(),Tp=new THREE.Matrix4,Mp=new THREE.Vector3(0,0,0),Cp=new THREE.Vector3(0,1,0),Sp=function(){function e(t){n(this,e),this.app=null,this.object=null,this._targetObject=null,this._target=new THREE.Vector3,t=t||{},this._alpha=t.alpha||45,this._beta=t.beta||45,this._radius=t.radius||30,this._dirty=!0}return e.prototype.onAdd=function(e){this.app=e.app,this.object=e},e.prototype.onRemove=function(){this.app=null,this.object=null,this._targetObject=null},e.prototype.onUpdate=function(){return this._dirty&&this._updateLocalTransform(),!0},e.prototype._updateLocalTransform=function(){var e=this.object.node.position;e.fromArray(THING.Math.directionFromAlphaBeta(this._alpha,this._beta)),e.normalize().multiplyScalar(this._radius);var t=this.object.node.quaternion,i=Tp.lookAt(Mp,e,Cp);t.setFromRotationMatrix(i),this._dirty=!1},o(e,[{key:"alpha",set:function(e){this._alpha=e,this._dirty=!0},get:function(){return this._alpha}},{key:"beta",set:function(e){this._beta=e,this._dirty=!0},get:function(){return this._beta}},{key:"radius",set:function(e){this._radius=e,this._dirty=!0},get:function(){return this._radius}}]),e}(),jp=function(){function e(t){n(this,e),this.params=t,this.draggable=!0,t&&(this.draggable=Et.parseValue(t.draggable,!0))}return e.prototype.init=function(){var e=this,t=this.params;if(this.cameraTarget=function(e){var t=2,i=1218267,r=null;if(!e)return null;var n=e.size,o=e.color,s=e.url;if(null==s)return null;r=s,null!=n&&(t=n),null!=o&&(i=o);var a=app.create({type:"Marker",offset:[0,8,0],size:t,keepSize:!0,url:r,useSpriteMaterial:!1,angles:[90,0,0]});return a.style.alwaysOnTop=!0,a.style.color=i,a}(t),this.cameraTarget){o();var i=!1,r=null,n=!1;$(document).on("mousedown.ctctrl",(function(e){2==e.button&&(n=!0)})),$(document).on("mouseup.ctctrl",(function(t){if(2==t.button&&(n=!1),i=!1,e.app.camera.enablePan=!0,e.app.camera.enableRotate=!0,e.cameraTarget.style.color="#1296db",r){var o=new THREE.Vector3(r[0],r[1],r[2]),s=new THREE.Vector3(e.cameraTarget.position[0],e.cameraTarget.position[1],e.cameraTarget.position[2]).clone().sub(o);e.app.camera.position=[e.app.camera.position[0]+s.x,e.app.camera.position[1]+s.y,e.app.camera.position[2]+s.z],e.app.camera.target=e.cameraTarget.position,r=null}})),$(document).on("mousemove.ctctrl",(function(t){i&&(e.cameraTarget.position=e.app.camera.screenToWorld(t.pageX,t.pageY))})),this.cameraTarget.on("mouseenter",(function(){1==e.draggable&&(e.cameraTarget.style.color="#FE7F0B")})),this.cameraTarget.on("mouseleave",(function(){1!=e.draggable||i||(e.cameraTarget.style.color="#1296db")})),this.cameraTarget.on("mousedown",(function(){1==e.draggable&&(i=!0,e.app.camera.enablePan=!1,e.app.camera.enableRotate=!1,e.cameraTarget.style.color="#FE7F0B",r=e.cameraTarget.position)})),this.app.on("update",(function(e){n&&o()}))}function o(){var t=e.app.camera.screenToWorld(e.app.domElement.clientWidth/2,e.app.domElement.clientHeight/2);e.cameraTarget.position=t}},e.prototype.onAdd=function(e){this.app=e,this.init()},e.prototype.onRemove=function(){$(document).off(".ctctrl"),this.cameraTarget&&this.cameraTarget.destroy()},e}(),Pp=function(){function e(t,i){n(this,e),this._candidates=t,this._options=i||{},this._app=null,this._objects=[],this._previousObjects=[],this._started=!1}return e.prototype.onAdd=function(e){this._app=e,this._app.focus(),this._objects=new $t(this._app,[]),this._previousObjects=this._objects,this.start()},e.prototype.onRemove=function(){this.end()},e.prototype._start=function(e){if(e){this.candidates=this._candidates;var t=this._options.start;t&&t.call(this,{candidates:this.candidates});var i=this;this._app.camera.inputEnabled=!1,this._app.picker.startAreaPicking({x:e.x,y:e.y}),this._app.on("pick",".Thing",(function(e){var t=i._options.select;if(t&&t.call(i,e),!e._stopPropagation){var r=i._options.outlineColor||"#FF8000";e.object.style.outlineColor=r}}),"RectangleSelectControl_pick"),this._app.on("unpick",".Thing",(function(e){var t=i._options.deselect;t&&t.call(i,e),e._stopPropagation||(e.object.style.outlineColor=null)}),"RectangleSelectControl_unpick"),this._app.on(F.AreaPickEnd,(function(e){i._previousObjects=i._objects,i._objects=i._app.picker.objects.concat()}),"RectangleSelectControl_AreaPickEnd"),this._started=!0}},e.prototype._end=function(){if(this._started){this._started=!1,this._app.picker.endAreaPicking(),this._app.off("pick",".Thing","RectangleSelectControl_pick"),this._app.off("unpick",".Thing","RectangleSelectControl_unpick"),this._app.off(F.AreaPickEnd,null,"RectangleSelectControl_AreaPickEnd"),this._app.camera.inputEnabled=!0;var e=this._options.end;e&&e.call(this,{candidates:this.candidates})}},e.prototype.start=function(){var e=this;this._app.on("mousedown",(function(t){0==t.button&&e._start(t)}),"RectangleSelectControl_mousedown"),this._app.on("mouseup",(function(t){0==t.button&&e._end()}),"RectangleSelectControl_mouseup")},e.prototype.end=function(){this._end(),this._app.off("mousedown",null,"RectangleSelectControl_mousedown"),this._app.off("mouseup",null,"RectangleSelectControl_mouseup"),this._app.off("pick",".Thing","RectangleSelectControl_pick"),this._app.off("unpick",".Thing","RectangleSelectControl_unpick")},e.prototype.clear=function(){if(this._objects.length){for(var e=0;e<this._objects.length;e++){var t=this._objects,i=this._options.deselect;i&&i.call(t,{object:t})}this._objects.clear()}},o(e,[{key:"candidates",set:function(e){this._app.picker.areaCandidates=e},get:function(){return this._app.picker.areaCandidates}},{key:"options",set:function(e){this._options=e},get:function(){return this._options}},{key:"previousObjects",get:function(){return this._previousObjects}},{key:"objects",get:function(){return this._objects}}]),e}(),Rp=function(){function e(){n(this,e),this.object=null,this.app=null,this._height=0,this._box=null,this._pickResults=null}return e.prototype._setupBox=function(){this._box&&(this.app.resourceManager.remove(this._box),this._box=null);var e=this.object.boundingBox.size,t=new THREE.BoxGeometry(e[0],e[1],e[2]),i=new THREE.EdgesGeometry(t);this._box=new THREE.LineSegments(i),this.object.node.add(this._box);var r=Et.parseVector3(this.object.boundingBox.center);this._box._setWorldPosition(r,this.object.static);for(var n=[16711680,65280,255,0],o=0;o<4;o++){(t=new THREE.Geometry).vertices.push(new THREE.Vector3),t.vertices.push(new THREE.Vector3);var s=new THREE.LineBasicMaterial({color:n[o]}),a=new THREE.Line(t,s);a.visible=!1,this._box.add(a)}},e.prototype._useCenterMode=function(){var e=this.object.angles,t=THING.Math.abs(e[1]);return t<1e-5||(!!THING.Math.isFloatEquals(t,90)||(!!THING.Math.isFloatEquals(t,180)||!!THING.Math.isFloatEquals(t,270)))},e.prototype._updatePickedResult=function(){for(var e=[new THREE.Raycaster,new THREE.Raycaster,new THREE.Raycaster,new THREE.Raycaster],t=[],i=this._box.geometry.attributes.position.array,r=0;r<i.length;r+=3){var n=new THREE.Vector3(i[r],i[r+1],i[r+2]);if(!(n.y<0)){for(var o=!1,s=0;s<t.length;s++)t[s].equals(n)&&(o=!0);o||t.push(n)}}var a,l,u,c;if(this.object.node.updateMatrixWorld(),this._useCenterMode()){var h=[];for(r=0;r<t.length;r++)h.push(t[r].clone());t[0].addVectors(h[0],h[1]).divideScalar(2),t[1].addVectors(h[1],h[2]).divideScalar(2),t[2].addVectors(h[2],h[3]).divideScalar(2),t[3].addVectors(h[3],h[0]).divideScalar(2)}for(r=0;r<t.length;r++){var p=(d=e[r]).ray.origin;p.set(t[r].x,this._height-this._box.position.y,t[r].z),p=this._box.localToWorld(p),(!a||p.x<a.ray.origin.x)&&(a=d),(!u||p.z<u.ray.origin.z)&&(u=d),(!l||p.x>l.ray.origin.x)&&(l=d),(!c||p.z>c.ray.origin.z)&&(c=d)}a.ray.direction.set(-1,0,0),u.ray.direction.set(0,0,-1),l.ray.direction.set(1,0,0),c.ray.direction.set(0,0,1),this._pickResults=[];for(r=0;r<e.length;r++){var d,f=(d=e[r]).intersectObject(this.app.scene,!0);for(s=0;s<f.length;s++){if(!(g=f[s]).object.isChildOf(this.object.node))break;f.splice(s--,1)}this._pickResults.push({startPosition:d.ray.origin.toArray(),pickedPosition:null,pickedObject:null,distance:100,direction:d.ray.direction.toArray()});var m=this._pickResults[r];if(f.length){var g=f[0];m.pickedPosition=g.point.toArray(),m.pickedObject=this.app.objectManager.getBaseObject(g.object),m.distance=g.distance}}var v=this._pickResults;for(r=0;r<v.length;r++){var y,b,_=v[r],x=this._box.children[r];if(y=Et.parseVector3(_.startPosition),_.pickedPosition)b=Et.parseVector3(_.pickedPosition);else{var E=new THREE.Vector3,w=Et.parseVector3(_.direction);E.addVectors(Et.parseVector3(_.startPosition),w.multiplyScalar(100)),b=E}y=x.worldToLocal(y),b=x.worldToLocal(b),x.geometry.vertices[0].copy(y),x.geometry.vertices[1].copy(b),x.geometry.verticesNeedUpdate=!0,x.geometry.elementsNeedUpdate=!0,x.computeLineDistances()}return this._pickResults},e.prototype.onAdd=function(e){this.object=e,this.app=e.app,this.height=this.object.boundingBox.size[1]/2},e.prototype.onRemove=function(){this._box&&(this.app.resourceManager.remove(this._box),this._box=null)},e.prototype.onUpdate=function(e){return!1},o(e,[{key:"height",set:function(e){this._height=e},get:function(){return this._height}},{key:"visible",set:function(e){this._box||this._setupBox(),this._box.visible=e},get:function(){return!!this._box&&this._box.visible}},{key:"lineVisible",set:function(e){this._box||this._setupBox(),this._box.children.forEach((function(t){t.visible=e}))},get:function(){return!!this._box&&this._box.children[0].visible}},{key:"pickResults",get:function(){return this._updatePickedResult(),this._pickResults}}]),e}(),Dp=function(){function e(){n(this,e),this._object=null,this._prevCameraInfo={}}return e.prototype.onAdd=function(e){this.app=e;var t=this.app.camera;this._prevCameraInfo={enablePan:t.enablePan,autoAdjustTarget:t.autoAdjustTarget,enableUpdateTargetOnWheel:t.enableUpdateTargetOnWheel,distanceLimited:t.distanceLimited,dampingFactor:t.dampingFactor},t.enablePan=!1,t.autoAdjustTarget=!1,t.enableUpdateTargetOnWheel=!1,t.dampingFactor=.05},e.prototype.onRemove=function(){var e=this.app.camera;for(var t in this._prevCameraInfo)e[t]=this._prevCameraInfo[t]},e.prototype.onUpdate=function(e){},e.prototype._getObject=function(e){var t=e.target;if(t)return t;var i=e.url;if(i){var r=this,n=e.time||1e3,o=e.distance||10,s=e.direction,a=e.complete;this.app.create({type:"Thing",url:i,position:this.getNextObjectPosition(e),nodeReady:function(e){setTimeout((function(){r.lookAt({target:e.object,time:n,distance:o,direction:s,complete:a})}),10)}})}return null},e.prototype.getNextObjectPosition=function(e){if(e=e||{},this._object){var t=e.distance||10,i=this.app.camera.rightDirection;return-1===e.direction&&(i=THING.Math.negVector(i)),this._object.getWorldPosition({direction:i,distance:t})}return[0,0,0]},e.prototype.lookAt=function(e){e=e||{};var t=this._getObject(e);if(t){var i=this,r=e.time||1e3,n=e.complete,o=this.app.camera,s=t.boundingBox.radius;if(this._object){var a=e.distance||10,l=(r=e.time||1e3,e.lerpType||THING.LerpType.Quartic.Out),u=o.rightDirection;-1===e.direction&&(u=THING.Math.negVector(u));var c=t.getWorldPosition({direction:u,distance:a});t.position=c,t.lerpTo({from:{position:c},to:{position:[0,0,0]},time:r,lerpType:l},"modelViewControl_lerp_fadeIn"),t.fadeIn({time:r}),this._object.lerpTo({from:{position:this._object.position},to:{position:this._object.getWorldPosition({direction:THING.Math.negVector(u),distance:a})},time:r,lerpType:l,stop:function(e){e.object.destroy()},complete:function(e){e.object.destroy(),n&&n.call(i,{object:i._object})}},"modelViewControl_lerp_fadeOut"),this._object.fadeOut({time:r/2})}else o.flyTo({target:t,xAngle:0,yAngle:0,time:r,complete:function(){n&&n.call(i,{})}});this._object=t,o.distanceLimited=[.5*s,4*s]}},o(e,[{key:"object",get:function(){return this._object}}]),e}(),Ap=function(){function e(){n(this,e),this._navigation=null}return e.prototype.onAdd=function(e){var t=e.node.getMeshes()[0];t.updateWorldMatrix(!0);var i=(new THREE.Geometry).fromBufferGeometry(t.geometry);i.applyMatrix4(t.matrixWorld),this._navigation=new wt((new THREE.BufferGeometry).fromGeometry(i))},e.prototype.onRemove=function(){this._navigation=null},e.prototype.findPath=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this._navigation.findPath((new THREE.Vector3).fromArray(e),(new THREE.Vector3).fromArray(t),{includeStart:!0,includeEnd:!0,fixEnds:!0,pathSmooth:{enable:!0}});return r&&Array.isArray(r)?r.map((function(e){return[e.x,e.y+i,e.z]})):null},e}(),kp=function(e){return!e.isLight&&!e.userData.skipBoundingBox};function Op(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(e){var o=e.uuid,s=i[o];if(!(s===L.Stop&&n>0)&&(s===L.Jump||(r[e.uuid]&&THING.Utils.log("% :is existing"),e.uuid&&(e.selections||(e.selections={}),e.selections[this.name]=this,r[e.uuid]=e)),t&&e.children.length>0))for(var a=0;a<e.children.length;a++)Op.call(this,e.children[a],t,i,r,n+1)}}function Bp(e){for(var t in e){var i=e[t];if(i.selections){i.selections[this.name];delete i.selections[this.name]}delete this._nodesResult[t]}}function Fp(e){void 0===e&&(e=THREE.MathUtils.generateUUID()),this.name=e,this._nodesMark={},this._nodesResult={}}function Lp(e){for(var t in e){var i=e[t].material;if(i&&!this._nodesMap[t]){e[t].modifiers||(e[t].modifiers=[]),e[t].modifiers.push(this),this._nodesMap[t]=e[t];var r=i,n=r.uuid,o=this._materialCopy[n],s=o&&o.material;if(!o){s=(o=this._materialCopy[n]={refrence:0,material:i.clone()}).material;var a=-1===this._trans?r.opacity:this._trans;this.override?(s.opacity=a,this._colour.x+this._colour.y+this._colour.z>-1&&(s.alphaColor=this._colour.clone(),s.override_color=this._colour.clone())):r.override_color?(s.opacity=r.opacity,s.alphaColor.clone(r.override_color),s.override_color.clone(r.override_color)):(s.opacity=a,this._colour.x+this._colour.y+this._colour.z>-1&&s.color.setRGB(this._colour.x,this._colour.y,this._colour.z)),s.opacity<1&&(s.transparent=!0,s.depthWrite=!1),this._isFlashing&&(s.alphaColor.w=0),s.needsUpdate=!0}o.refrence++,e[t][this.bak_name]=e[t].material,e[t].material=s}}}function Ip(e,t){Array.isArray(t)||(t=[]);var i=e.modifiers.indexOf(this);if(i<0||i==e.modifiers.length-1)return t;(t=e.modifiers.splice(i+1)).reverse();for(var r=0;r<t.length;r++){var n=t[r],o={};o[e.name]=e,Up.call(n,o)}return t}function Np(e,t){if(Array.isArray(t)&&!(t.length<1))for(var i=0;i<t.length;i++){var r=t[i],n={};n[e.name]=e,Lp.call(r,n)}}function Up(e){var t=this.bak_name;for(var i in e)if(this._nodesMap[i]&&(delete this._nodesMap[i],e[i].modifiers)){var r=Ip.call(this,e[i]),n=e[i].modifiers.pop();if(n==this){if(e[i].material&&e[i][t]){var o=e[i].material=e[i][t],s=(e[i].material=o).uuid;delete e[i][t],this._materialCopy[s]?("number"==typeof this._materialCopy[s].refrence?this._materialCopy[s].refrence--:THING.Utils.log("[%s] didn't found",s),this._materialCopy[s].refrence<1&&delete this._materialCopy[s]):THING.Utils.log("[%s] didn't found",s)}Np.call(this,e[i],r)}else e[i].modifiers.push(n)}}function zp(e){void 0===e&&(e=THREE.MathUtils.generateUUID()),this.name=e,this.bak_name="t3d_material_bak_"+this.name,this._trans=-1,this._seletions=[],this._nodesMap={},this.autoUpdate=!1,this._autoUpdateID=null,this.fadeSpeed=1,this.flashSpeed=1,this._isFading=!1,this._isFlashing=!1,this.flashLoop=!1,this._updateQueen=[],this._removeQueen=[],this.override=!1,this._materialCopy={},this._colour=new THREE.Vector4(-1,-1,-1,0)}function Hp(e,t,i){var r=e.begin||(new Date).getTime(),n=isNaN(e.from)?0:e.from,o=isNaN(e.to)?1:e.to,s=e.during,a=e.func;return function(e){"reset"===e&&(r=(new Date).getTime());var l=(new Date).getTime()-r;if(l<=s){var u=a(l,0,1,s);return t(n+(o-n)*u),!0}if(l>s){t(o);var c=i();return r=(new Date).getTime(),c}}}Fp.prototype.toString=function(){return this.name},Fp.prototype.setAutoResetMark=function(e){},Fp.prototype.getAutoResetMark=function(){},Fp.prototype.mark=function(e,t){null!=e&&(this._nodesMark[e.uuid]=t)},Fp.prototype.markSelection=function(e,t){for(var i in e._nodesResult)this._nodesMark[e._nodesResult[i].uuid]=t},Fp.prototype.getMark=function(e){var t=L.None;return e&&(t=(t=this._nodesMark[e.uuid])||L.None),t},Fp.prototype.getAllNameString=function(){var e=this._nodesResult,t=[];for(var i in e)t.push(e[i].name);return t.join(";")},Fp.prototype.select=function(e,t){var i={};for(var r in Op.call(this,e,t,this._nodesMark,i),i)this._nodesResult[r]=i[r]},Fp.prototype.reselect=function(e,t){Bp.call(this,this._nodesResult),Op.call(this,e,t,this._nodesMark,this._nodesResult)},Fp.prototype.unselect=function(e,t){var i={};t?Op.call(this,e,t,this._nodesMark,i):i[e.uuid]=e,Bp.call(this,i)},Fp.prototype.deselect=function(e,t){var i={};Op.call(this,e,t,this._nodesMark,i),Bp.call(this,i),this._nodesResult=i},Fp.prototype.selectList=function(e,t){if(e&&Array.isArray(e))for(var i=0;i<e.length;i++)this.select(e[i],t)},Fp.prototype.unselectList=function(e,t){if(e&&Array.isArray(e))for(var i=0;i<e.length;i++)this.unselect(e[i],t)},Fp.prototype.isEmpty=function(){for(var e in this._nodesResult)return!1;return!0},Fp.prototype.merge=function(e,t){var i=e._nodesResult,r=this._nodesResult;for(var n in i)r[n]=i[n]},Fp.prototype.unmerge=function(e,t){var i=e._nodesResult,r=this._nodesResult;for(var n in i)delete r[n]},Fp.prototype.getWorldAABB=function(e){var t=this._nodesResult,i=new THREE.Box3,r=function(e){return o=new THREE.Box3,t[e]?("Billboard"==t[e].typeName?o.setFromObject(t[e]):t[e]&&((s=new THREE.Box3)._setFromObject(t[e],(function(i){return i==t[e]&&(!!kp(i)&&void 0)})),o=s.clone()),a=new THREE.Vector3,o.getSize(a),0===a.x&&0===a.y&&0===a.z?"continue":void i.union(o)):"continue"};for(var n in t){var o,s,a;r(n)}var l=new THREE.Vector3;i.getCenter(l),l.x||l.y||l.z||(l.x=0,l.y=0,l.z=0);var u=new THREE.Vector3;return i.getSize(u),{center:[l.x,l.y,l.z],radius:Math.sqrt(Math.pow(u.x,2)+Math.pow(u.y,2)+Math.pow(u.z,2))/2,width:u.x,height:u.y,depth:u.z}},Fp.prototype.getWorldOBB=function(e){var t=this._nodesResult,i=new THREE.Group;for(var r in e.add(i),i.updateWorldMatrix(!0,!0),t){var n=t[r];if(n){n.updateWorldMatrix(!0,!0);var o=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Quaternion;n.matrixWorld.decompose(o,a,s);var l=n.clone();l.position.copy(o),l.quaternion.copy(a),l.scale.copy(s),l.attachToParent(i),l.updateWorldMatrix(!0,!0)}}e.updateWorldMatrix(!0,!0);var u=new THREE.Matrix4;u.getInverse(e.matrixWorld);var c=new THREE.Box3;c._setFromObject(e,kp,u);var h=[];c.getBoundingPositions().forEach((function(t){var i=t.clone();i.applyMatrix4(e.matrixWorld),h.push(i.toArray())}));var p=c,d=new THREE.Vector3;p.getCenter(d),d.applyMatrix4(e.matrixWorld),d.x||d.y||d.z||(d.x=0,d.y=0,d.z=0);var f=new THREE.Vector3;p.getSize(f);var m={points:h,center:[d.x,d.y,d.z],radius:Math.sqrt(Math.pow(f.x,2)+Math.pow(f.y,2)+Math.pow(f.z,2))/2,width:f.x,height:f.y,depth:f.z};return e.remove(i),m},Fp.prototype.setQueryFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].setQueryFlags(e)},Fp.prototype.addQueryFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].addQueryFlags(e)},Fp.prototype.removeQueryFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].removeQueryFlags(e)},Fp.prototype.setPickEnabled=function(e){for(var t in this._nodesResult)this._nodesResult[t].setPickEnabled(e)},Fp.prototype.showBoundingBox=function(e){},Fp.prototype.show=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(var t in this._nodesResult)this._nodesResult[t].show(e)},Fp.prototype.setDepthCheckEnabled=function(e){for(var t in this._nodesResult){var i=this._nodesResult[t];i&&i.material&&(i.material.depthTest=e)}},Fp.prototype.clone=function(e){var t=new Fp(e);for(var i in this._nodesMark)t._nodesMark[i]=this._nodesMark[i];for(var r in this._nodesResult)t._nodesResult[r]=this._nodesResult[r];return t},Fp.prototype.clear=function(){for(var e in this._nodesResult)delete this._nodesResult[e]},Fp.prototype.destroy=function(){for(var e in this._nodesMark)delete this._nodesMark[e];for(var t in this._nodesResult)delete this._nodesResult[t]},Fp.prototype.updateBounds=function(){},Fp.prototype.setRenderQueueGroup=function(e){for(var t in this._nodesResult)this._nodesResult[t].setRenderQueueGroup(e)},Fp.prototype.removeAllModifiers=function(){for(var e in this._nodesResult){var t=this._nodesResult[e];t&&t.node&&t.node.modifiers&&(t.node.modifiers.length=0)}},Fp.prototype.setVisibilityFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].setVisibilityFlags(e)},Fp.prototype.addVisibilityFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].addVisibilityFlags(e)},Fp.prototype.removeVisibilityFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].removeVisibilityFlags(e)},Fp.prototype.setCustomParameter=function(e,t){for(var i in this._nodesResult)this._nodesResult[i].setCustomParameter(e,t)},zp.prototype.toString=function(){return this.name},zp.prototype.getId=function(){THING.Utils.log("[%s] didn't ready","MaterialModifier.getId")},zp.prototype.setAutoUpdate=function(e){this.autoUpdate=e,this.autoUpdateRunner()},zp.prototype.getAutoUpdate=function(){return this.autoUpdate},zp.prototype.autoUpdateRunner=function(){this._autoUpdateID&&(cancelAnimationFrame(this._autoUpdateID),this._autoUpdateID=!1);var e=this;e.autoUpdate&&function t(){e._autoUpdateID&&(cancelAnimationFrame(e._autoUpdateID),e._autoUpdateID=0);e.update(),e.autoUpdate&&(e._autoUpdateID=requestAnimationFrame(t))}()},zp.prototype.setTransparency=function(e){this._trans=e},zp.prototype.getTransparency=function(){return this._trans},zp.prototype.fade=function(e,t){this._seletions.length;var i=1e3/this.fadeSpeed,r=this;this._isFading=!0;var n=Hp({from:e,to:t,during:i,func:TWEEN.Cubic.easeOut,begin:(new Date).getTime()},(function(e){for(var t in r._materialCopy){var i=r._materialCopy[t].material;i&&((i=i.getTechnique(0).getPass(0).material).transparent=!0,i.opacity=e)}}),(function(){return r._isFading=!1,!1}));r._updateQueen.push(n)},zp.prototype.fadeIn=function(){this._seletions.length;var e=this._trans;this.fade(e,1)},zp.prototype.fadeOut=function(){this._seletions.length;var e=this._trans;this.fade(e,0)},zp.prototype.setFadeSpeed=function(e){0!==e&&(this.fadeSpeed=e)},zp.prototype.isFading=function(){return this._isFading},zp.prototype.setColour=function(e,t,i,r){this._colour.x=e,this._colour.y=t,this._colour.z=i,this._colour.w=r},zp.prototype.flash=function(e,t){e<t&&(t=Math.min(this._trans,t),e=Math.max(e,.01));var i=this;this._isFlashing=!0;var r=Hp({from:0,to:1,during:1e3,func:TWEEN.Linear,begin:(new Date).getTime()},(function(r){var n=e+(t-e)*r;for(var o in i._materialCopy){var s=i._materialCopy[o].material;s&&((s=s.getTechnique(0).getPass(0).material).override_color?s.override_color&&i.override?s.alphaColor.w=n:s.alphaColor=s.backup_color:s.alphaColor.w=n)}}),(function(){var i=e;return e=t,t=i,!0}));i._updateQueen.push(r),this.autoUpdateRunner()},zp.prototype.setFlashSpeed=function(e){this.flashSpeed=e},zp.prototype.setFlashLoop=function(e){this.flashLoop=e},zp.prototype.isFlashing=function(){return this._isFlashing},zp.prototype.getFlashValue=function(){THING.Utils.log("[%s] didn't ready","MaterialModifier.getFlashValue")},zp.prototype.setOverride=function(e){this.override=e},zp.prototype.getAllSceneNodeNames=function(){THING.Utils.log("[%s] didn't ready","MaterialModifier.getAllSceneNodeNames")},zp.prototype.getModifiedMaterialNameString=function(){THING.Utils.log("[%s] didn't ready","MaterialModifier.getModifiedMaterialNameString")},zp.prototype.addSceneNode=function(e){var t={};t[e.uuid]=e,Lp.call(this,t)},zp.prototype.removeSceneNode=function(e){var t={};t[e.uuid]=e,Up.call(this,t)},zp.prototype.addSceneNodeSelection=function(e){this._seletions.push(e);var t=e._nodesResult;Lp.call(this,t)},zp.prototype.removeSceneNodeSelection=function(e){var t=e._nodesResult;Up.call(this,t);var i=this._seletions.indexOf(e);i>-1&&this._seletions.splice(i,1)},zp.prototype.enable=function(){THING.Utils.log("[%s] didn't ready","MaterialModifier.enable")},zp.prototype.disable=function(){THING.Utils.log("[%s] didn't ready","MaterialModifier.disable")},zp.prototype.update=function(e){for(var t=0;t<this._removeQueen.length;t++){var i=this._removeQueen[t],r=this._updateQueen.indexOf(i);r>-1&&this._updateQueen.splice(r,1)}this._removeQueen.length=0;for(var n=0;n<this._updateQueen.length;n++){var o=this._updateQueen[n];if("function"==typeof o)o()||this._removeQueen.push(o);else this._removeQueen.push(o)}},zp.prototype.setOverrideDepthCheckEnabled=function(e,t){THING.Utils.log("[%s] didn't ready","MaterialModifier.setOverrideDepthCheckEnabled")},zp.prototype.setOverrideDepthBias=function(e,t,i){THING.Utils.log("[%s] didn't ready","MaterialModifier.setOverrideDepthBias")},zp.prototype.setColourPassDepthWriteEnabled=function(e){THING.Utils.warn("MaterialModifier.prototype.setColourPassDepthWriteEnabled")};var Vp={};Object.defineProperties(Vp,{enableCameraParse:{set:function(e){Ua.enableCameraParse=e},get:function(){return Ua.enableCameraParse}},skipInDoorEnvMap:{set:function(e){Ua.skipInDoorEnvMap=e},get:function(){return Ua.skipInDoorEnvMap}},config:{get:function(){return Ua.config}},indexJson:{get:function(){return Ua.indexJson}}});var Wp={Math:Math};e.ActionComposer=Fh,e.AllConfigParse=Ua,e.App=Ah,e.AreaPickType=A,e.AroundControl=Sp,e.AxisTransformControl=ph,e.BaseObject=Si,e.BaseStyle=rl,e.BatchObject=tr,e.BatchSubObject=ir,e.BlendingType={No:"no",Normal:"normal",Additive:"add",Subtractive:"subtract",Multiply:"multiply"},e.Boundary=Su,e.BoundingBoxControl=Ut,e.Box=sr,e.Building=Ga,e.COMPILETIME="Fri, 10 Dec 2021 10:05:11 GMT",e.Camera=rh,e.CameraControl=fp,e.CameraController=nh,e.CameraProjectionType=M,e.CameraTargetControl=jp,e.CameraView=C,e.Campus=Ri,e.Circle=ar,e.CombinedObject=Ro,e.CompassControl=mp,e.CornerType=j,e.Cylinder=hr,e.DEFAULT_EXTENSIONS=[],e.DistributionsType={Box:1,Sphere:2,Disc:3},e.Door=mr,e.DragState=R,e.Element3DObjectControl=Pu,e.Elevator=vr,e.ElevatorDoor=gr,e.EventTag=B,e.EventType=F,e.Facade=Vi,e.Floor=Do,e.FlyControl=gp,e.Frustum=dr,e.Grid=cr,e.Ground=_r,e.Group=ko,e.GroupNavigation=kt,e.Heatmap=fl,e.Helper=rp,e.IDWMap=bl,e.ImageProxy=function e(t){return n(this,e),function(e,t){e[Lh]={};var i=e[Lh];THING.App.current,i.init=function(){i.handler={set:function(e,t,r){if("src"===t){var n=i.proxy.onloadstart;n&&n(e,r);var o=i.proxy.onloadend;o&&(e.addEventListener("load",(function t(){o(e),e.removeEventListener("load",t)}),!1),e.addEventListener("error",(function t(){o(e),e.removeEventListener("error",t)}),!1))}return e[t]=r},get:function(e,t){return"addEventListener"==t||"removeEventListener"==t?function(){e[t](arguments[0],arguments[1],arguments[2])}:e[t]}},i.image=t.image||new Image(t.width,t.height)},i.createProxy=function(){var e=new Proxy(i.image,i.handler);return e.getTarget=function(){return i.image},i.proxy=e,e},i.handler=null,i.image=null,i.proxy=null,i.init()}(this,t),this[Lh].createProxy()},e.IndependentControlType=k,e.KeyType=O,e.LayoutType={Left:"Left",Right:"Right",Top:"Top",Bottom:"Bottom",Front:"Front",Back:"Back",Center:"Center"},e.LerpType=S,e.LevelType={Unknown:"",Campus:"Campus",Building:"Building",Floor:"Floor",Room:"Room",Thing:"Thing"},e.Line=El,e.LineBase=_l,e.LogLevelType=x,e.LookAtControl=wp,e.LoopType=D,e.Marker=Au,e.MaterialModifier=zp,e.Math=I,e.MaxConfigParse=Vp,e.MeasurementControl=Rp,e.MeshNavigation=wt,e.MeshNavigationHelper=Ft,e.MiniMapControl=Ep,e.ModelViewControl=Dp,e.ModifierType={Material:513,TransparencyColour:513,AutoRotation:257,AutoScale:258},e.Navigation=mh,e.NavigationControl=Ap,e.Plane=ur,e.Points=Fl,e.PolygonLine=Bl,e.PolygonRegion=hl,e.REVISION="657b51a238e792e9c1054ceeb3c0e40fad04d128no",e.RectangleSelectControl=Pp,e.Room=qa,e.RouteLine=Ol,e.SceneEffectConfigParse=za,e.SceneNodeSelection=Fp,e.SelectionMark=L,e.Selector=$t,e.Shape=fr,e.SizeAdjustmentControl=ci,e.SkyBox={BlueSky:"BlueSky",MilkyWay:"MilkyWay",Night:"Night",SunCloud:"SunCloud"},e.SpaceType=P,e.Sphere=lr,e.Stair=br,e.StairDoor=yr,e.StyleManager=sc,e.SubObject=kh,e.Tetrahedron=pr,e.TextKeyEncoder=c,e.TextRegion=ul,e.ThemeManager=tl,e.Thing=Gi,e.TjsConfigParse=Na,e.UIAnchor=Uu,e.Utils=Et,e.VERSION="1.2.7.26",e.Version=Pi,e.VideoSurvilance=xr,e.WalkButtonControl=_p,e.WalkControl=bp,e.Water=ru,e.WebView=ku,e.WrapType={Repeat:"repeat",ClampToEdge:"clamptoedge",MirroredRepeat:"mirroredrepeat"},e.factory=Hu,e.loadDebugger=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i.devtools=!1;var r=["camera","navigation","event","network"],n=i.complete;this.Utils.isFunction(e)&&(n=e,e=!0),e?(this.Debugger={basePath:"./js/debugger",isDebug:!0,devMode:t,enablePlugins:r,options:i},this.Utils.dynamicLoad(["./js/debugger/debugger.js"],(function(){n&&n()}),!1)):(this.Debugger={basePath:"https://www.3dmmd.cn/static/debugger",enablePlugins:r,options:i},this.Utils.dynamicLoad(["https://www.3dmmd.cn/static/debugger/debugger.js"],(function(){n&&n()}),!1))},e.loadDebuggerInDevTool=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i.devtools=!0;var r=["camera","navigation","event","network"],n=i.complete;this.Utils.isFunction(e)&&(n=e,e=!0),e?(this.Debugger={basePath:"./js/debugger",isDebug:!0,devMode:t,enablePlugins:r,options:i},this.Utils.dynamicLoad(["./js/debugger/debugger.js"],(function(){n&&n()}),!1)):(this.Debugger={basePath:"https://www.3dmmd.cn/static/debugger",enablePlugins:r,options:i},this.Utils.dynamicLoad(["https://www.3dmmd.cn/static/debugger/debugger.js"],(function(){n&&n()}),!1))},e.onError=function(e){Wp.Utils.error(e)},Object.defineProperty(e,"__esModule",{value:!0})}));